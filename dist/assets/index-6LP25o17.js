(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))m(w);new MutationObserver(w=>{for(const C of w)if(C.type==="childList")for(const D of C.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&m(D)}).observe(document,{childList:!0,subtree:!0});function l(w){const C={};return w.integrity&&(C.integrity=w.integrity),w.referrerPolicy&&(C.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?C.credentials="include":w.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function m(w){if(w.ep)return;w.ep=!0;const C=l(w);fetch(w.href,C)}})();function CC(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Ew={exports:{}},kv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g2;function ML(){if(g2)return kv;g2=1;var u=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(m,w,C){var D=null;if(C!==void 0&&(D=""+C),w.key!==void 0&&(D=""+w.key),"key"in w){C={};for(var s in w)s!=="key"&&(C[s]=w[s])}else C=w;return w=C.ref,{$$typeof:u,type:m,key:D,ref:w!==void 0?w:null,props:C}}return kv.Fragment=n,kv.jsx=l,kv.jsxs=l,kv}var _2;function PL(){return _2||(_2=1,Ew.exports=ML()),Ew.exports}var Y=PL(),Sw={exports:{}},ir={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y2;function DL(){if(y2)return ir;y2=1;var u=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),D=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),q=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),ce=Symbol.for("react.activity"),we=Symbol.iterator;function ze(et){return et===null||typeof et!="object"?null:(et=we&&et[we]||et["@@iterator"],typeof et=="function"?et:null)}var at={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ge=Object.assign,Qe={};function xt(et,Kt,Oi){this.props=et,this.context=Kt,this.refs=Qe,this.updater=Oi||at}xt.prototype.isReactComponent={},xt.prototype.setState=function(et,Kt){if(typeof et!="object"&&typeof et!="function"&&et!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,et,Kt,"setState")},xt.prototype.forceUpdate=function(et){this.updater.enqueueForceUpdate(this,et,"forceUpdate")};function wt(){}wt.prototype=xt.prototype;function jt(et,Kt,Oi){this.props=et,this.context=Kt,this.refs=Qe,this.updater=Oi||at}var wi=jt.prototype=new wt;wi.constructor=jt,Ge(wi,xt.prototype),wi.isPureReactComponent=!0;var Ai=Array.isArray;function vi(){}var Ve={H:null,A:null,T:null,S:null},ke=Object.prototype.hasOwnProperty;function We(et,Kt,Oi){var Hi=Oi.ref;return{$$typeof:u,type:et,key:Kt,ref:Hi!==void 0?Hi:null,props:Oi}}function ht(et,Kt){return We(et.type,Kt,et.props)}function $e(et){return typeof et=="object"&&et!==null&&et.$$typeof===u}function _t(et){var Kt={"=":"=0",":":"=2"};return"$"+et.replace(/[=:]/g,function(Oi){return Kt[Oi]})}var Ue=/\/+/g;function Cn(et,Kt){return typeof et=="object"&&et!==null&&et.key!=null?_t(""+et.key):Kt.toString(36)}function mn(et){switch(et.status){case"fulfilled":return et.value;case"rejected":throw et.reason;default:switch(typeof et.status=="string"?et.then(vi,vi):(et.status="pending",et.then(function(Kt){et.status==="pending"&&(et.status="fulfilled",et.value=Kt)},function(Kt){et.status==="pending"&&(et.status="rejected",et.reason=Kt)})),et.status){case"fulfilled":return et.value;case"rejected":throw et.reason}}throw et}function Pt(et,Kt,Oi,Hi,bn){var Qt=typeof et;(Qt==="undefined"||Qt==="boolean")&&(et=null);var Li=!1;if(et===null)Li=!0;else switch(Qt){case"bigint":case"string":case"number":Li=!0;break;case"object":switch(et.$$typeof){case u:case n:Li=!0;break;case te:return Li=et._init,Pt(Li(et._payload),Kt,Oi,Hi,bn)}}if(Li)return bn=bn(et),Li=Hi===""?"."+Cn(et,0):Hi,Ai(bn)?(Oi="",Li!=null&&(Oi=Li.replace(Ue,"$&/")+"/"),Pt(bn,Kt,Oi,"",function(ur){return ur})):bn!=null&&($e(bn)&&(bn=ht(bn,Oi+(bn.key==null||et&&et.key===bn.key?"":(""+bn.key).replace(Ue,"$&/")+"/")+Li)),Kt.push(bn)),1;Li=0;var cn=Hi===""?".":Hi+":";if(Ai(et))for(var Nn=0;Nn<et.length;Nn++)Hi=et[Nn],Qt=cn+Cn(Hi,Nn),Li+=Pt(Hi,Kt,Oi,Qt,bn);else if(Nn=ze(et),typeof Nn=="function")for(et=Nn.call(et),Nn=0;!(Hi=et.next()).done;)Hi=Hi.value,Qt=cn+Cn(Hi,Nn++),Li+=Pt(Hi,Kt,Oi,Qt,bn);else if(Qt==="object"){if(typeof et.then=="function")return Pt(mn(et),Kt,Oi,Hi,bn);throw Kt=String(et),Error("Objects are not valid as a React child (found: "+(Kt==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":Kt)+"). If you meant to render a collection of children, use an array instead.")}return Li}function Si(et,Kt,Oi){if(et==null)return et;var Hi=[],bn=0;return Pt(et,Hi,"","",function(Qt){return Kt.call(Oi,Qt,bn++)}),Hi}function fn(et){if(et._status===-1){var Kt=et._result;Kt=Kt(),Kt.then(function(Oi){(et._status===0||et._status===-1)&&(et._status=1,et._result=Oi)},function(Oi){(et._status===0||et._status===-1)&&(et._status=2,et._result=Oi)}),et._status===-1&&(et._status=0,et._result=Kt)}if(et._status===1)return et._result.default;throw et._result}var jn=typeof reportError=="function"?reportError:function(et){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Kt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof et=="object"&&et!==null&&typeof et.message=="string"?String(et.message):String(et),error:et});if(!window.dispatchEvent(Kt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",et);return}console.error(et)},Wn={map:Si,forEach:function(et,Kt,Oi){Si(et,function(){Kt.apply(this,arguments)},Oi)},count:function(et){var Kt=0;return Si(et,function(){Kt++}),Kt},toArray:function(et){return Si(et,function(Kt){return Kt})||[]},only:function(et){if(!$e(et))throw Error("React.Children.only expected to receive a single React element child.");return et}};return ir.Activity=ce,ir.Children=Wn,ir.Component=xt,ir.Fragment=l,ir.Profiler=w,ir.PureComponent=jt,ir.StrictMode=m,ir.Suspense=G,ir.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ve,ir.__COMPILER_RUNTIME={__proto__:null,c:function(et){return Ve.H.useMemoCache(et)}},ir.cache=function(et){return function(){return et.apply(null,arguments)}},ir.cacheSignal=function(){return null},ir.cloneElement=function(et,Kt,Oi){if(et==null)throw Error("The argument must be a React element, but you passed "+et+".");var Hi=Ge({},et.props),bn=et.key;if(Kt!=null)for(Qt in Kt.key!==void 0&&(bn=""+Kt.key),Kt)!ke.call(Kt,Qt)||Qt==="key"||Qt==="__self"||Qt==="__source"||Qt==="ref"&&Kt.ref===void 0||(Hi[Qt]=Kt[Qt]);var Qt=arguments.length-2;if(Qt===1)Hi.children=Oi;else if(1<Qt){for(var Li=Array(Qt),cn=0;cn<Qt;cn++)Li[cn]=arguments[cn+2];Hi.children=Li}return We(et.type,bn,Hi)},ir.createContext=function(et){return et={$$typeof:D,_currentValue:et,_currentValue2:et,_threadCount:0,Provider:null,Consumer:null},et.Provider=et,et.Consumer={$$typeof:C,_context:et},et},ir.createElement=function(et,Kt,Oi){var Hi,bn={},Qt=null;if(Kt!=null)for(Hi in Kt.key!==void 0&&(Qt=""+Kt.key),Kt)ke.call(Kt,Hi)&&Hi!=="key"&&Hi!=="__self"&&Hi!=="__source"&&(bn[Hi]=Kt[Hi]);var Li=arguments.length-2;if(Li===1)bn.children=Oi;else if(1<Li){for(var cn=Array(Li),Nn=0;Nn<Li;Nn++)cn[Nn]=arguments[Nn+2];bn.children=cn}if(et&&et.defaultProps)for(Hi in Li=et.defaultProps,Li)bn[Hi]===void 0&&(bn[Hi]=Li[Hi]);return We(et,Qt,bn)},ir.createRef=function(){return{current:null}},ir.forwardRef=function(et){return{$$typeof:s,render:et}},ir.isValidElement=$e,ir.lazy=function(et){return{$$typeof:te,_payload:{_status:-1,_result:et},_init:fn}},ir.memo=function(et,Kt){return{$$typeof:q,type:et,compare:Kt===void 0?null:Kt}},ir.startTransition=function(et){var Kt=Ve.T,Oi={};Ve.T=Oi;try{var Hi=et(),bn=Ve.S;bn!==null&&bn(Oi,Hi),typeof Hi=="object"&&Hi!==null&&typeof Hi.then=="function"&&Hi.then(vi,jn)}catch(Qt){jn(Qt)}finally{Kt!==null&&Oi.types!==null&&(Kt.types=Oi.types),Ve.T=Kt}},ir.unstable_useCacheRefresh=function(){return Ve.H.useCacheRefresh()},ir.use=function(et){return Ve.H.use(et)},ir.useActionState=function(et,Kt,Oi){return Ve.H.useActionState(et,Kt,Oi)},ir.useCallback=function(et,Kt){return Ve.H.useCallback(et,Kt)},ir.useContext=function(et){return Ve.H.useContext(et)},ir.useDebugValue=function(){},ir.useDeferredValue=function(et,Kt){return Ve.H.useDeferredValue(et,Kt)},ir.useEffect=function(et,Kt){return Ve.H.useEffect(et,Kt)},ir.useEffectEvent=function(et){return Ve.H.useEffectEvent(et)},ir.useId=function(){return Ve.H.useId()},ir.useImperativeHandle=function(et,Kt,Oi){return Ve.H.useImperativeHandle(et,Kt,Oi)},ir.useInsertionEffect=function(et,Kt){return Ve.H.useInsertionEffect(et,Kt)},ir.useLayoutEffect=function(et,Kt){return Ve.H.useLayoutEffect(et,Kt)},ir.useMemo=function(et,Kt){return Ve.H.useMemo(et,Kt)},ir.useOptimistic=function(et,Kt){return Ve.H.useOptimistic(et,Kt)},ir.useReducer=function(et,Kt,Oi){return Ve.H.useReducer(et,Kt,Oi)},ir.useRef=function(et){return Ve.H.useRef(et)},ir.useState=function(et){return Ve.H.useState(et)},ir.useSyncExternalStore=function(et,Kt,Oi){return Ve.H.useSyncExternalStore(et,Kt,Oi)},ir.useTransition=function(){return Ve.H.useTransition()},ir.version="19.2.0",ir}var v2;function IT(){return v2||(v2=1,Sw.exports=DL()),Sw.exports}var st=IT();const qv=CC(st);var Aw={exports:{}},Nv={},Iw={exports:{}},Cw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x2;function OL(){return x2||(x2=1,(function(u){function n(Pt,Si){var fn=Pt.length;Pt.push(Si);e:for(;0<fn;){var jn=fn-1>>>1,Wn=Pt[jn];if(0<w(Wn,Si))Pt[jn]=Si,Pt[fn]=Wn,fn=jn;else break e}}function l(Pt){return Pt.length===0?null:Pt[0]}function m(Pt){if(Pt.length===0)return null;var Si=Pt[0],fn=Pt.pop();if(fn!==Si){Pt[0]=fn;e:for(var jn=0,Wn=Pt.length,et=Wn>>>1;jn<et;){var Kt=2*(jn+1)-1,Oi=Pt[Kt],Hi=Kt+1,bn=Pt[Hi];if(0>w(Oi,fn))Hi<Wn&&0>w(bn,Oi)?(Pt[jn]=bn,Pt[Hi]=fn,jn=Hi):(Pt[jn]=Oi,Pt[Kt]=fn,jn=Kt);else if(Hi<Wn&&0>w(bn,fn))Pt[jn]=bn,Pt[Hi]=fn,jn=Hi;else break e}}return Si}function w(Pt,Si){var fn=Pt.sortIndex-Si.sortIndex;return fn!==0?fn:Pt.id-Si.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var C=performance;u.unstable_now=function(){return C.now()}}else{var D=Date,s=D.now();u.unstable_now=function(){return D.now()-s}}var G=[],q=[],te=1,ce=null,we=3,ze=!1,at=!1,Ge=!1,Qe=!1,xt=typeof setTimeout=="function"?setTimeout:null,wt=typeof clearTimeout=="function"?clearTimeout:null,jt=typeof setImmediate<"u"?setImmediate:null;function wi(Pt){for(var Si=l(q);Si!==null;){if(Si.callback===null)m(q);else if(Si.startTime<=Pt)m(q),Si.sortIndex=Si.expirationTime,n(G,Si);else break;Si=l(q)}}function Ai(Pt){if(Ge=!1,wi(Pt),!at)if(l(G)!==null)at=!0,vi||(vi=!0,_t());else{var Si=l(q);Si!==null&&mn(Ai,Si.startTime-Pt)}}var vi=!1,Ve=-1,ke=5,We=-1;function ht(){return Qe?!0:!(u.unstable_now()-We<ke)}function $e(){if(Qe=!1,vi){var Pt=u.unstable_now();We=Pt;var Si=!0;try{e:{at=!1,Ge&&(Ge=!1,wt(Ve),Ve=-1),ze=!0;var fn=we;try{t:{for(wi(Pt),ce=l(G);ce!==null&&!(ce.expirationTime>Pt&&ht());){var jn=ce.callback;if(typeof jn=="function"){ce.callback=null,we=ce.priorityLevel;var Wn=jn(ce.expirationTime<=Pt);if(Pt=u.unstable_now(),typeof Wn=="function"){ce.callback=Wn,wi(Pt),Si=!0;break t}ce===l(G)&&m(G),wi(Pt)}else m(G);ce=l(G)}if(ce!==null)Si=!0;else{var et=l(q);et!==null&&mn(Ai,et.startTime-Pt),Si=!1}}break e}finally{ce=null,we=fn,ze=!1}Si=void 0}}finally{Si?_t():vi=!1}}}var _t;if(typeof jt=="function")_t=function(){jt($e)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,Cn=Ue.port2;Ue.port1.onmessage=$e,_t=function(){Cn.postMessage(null)}}else _t=function(){xt($e,0)};function mn(Pt,Si){Ve=xt(function(){Pt(u.unstable_now())},Si)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Pt){Pt.callback=null},u.unstable_forceFrameRate=function(Pt){0>Pt||125<Pt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ke=0<Pt?Math.floor(1e3/Pt):5},u.unstable_getCurrentPriorityLevel=function(){return we},u.unstable_next=function(Pt){switch(we){case 1:case 2:case 3:var Si=3;break;default:Si=we}var fn=we;we=Si;try{return Pt()}finally{we=fn}},u.unstable_requestPaint=function(){Qe=!0},u.unstable_runWithPriority=function(Pt,Si){switch(Pt){case 1:case 2:case 3:case 4:case 5:break;default:Pt=3}var fn=we;we=Pt;try{return Si()}finally{we=fn}},u.unstable_scheduleCallback=function(Pt,Si,fn){var jn=u.unstable_now();switch(typeof fn=="object"&&fn!==null?(fn=fn.delay,fn=typeof fn=="number"&&0<fn?jn+fn:jn):fn=jn,Pt){case 1:var Wn=-1;break;case 2:Wn=250;break;case 5:Wn=1073741823;break;case 4:Wn=1e4;break;default:Wn=5e3}return Wn=fn+Wn,Pt={id:te++,callback:Si,priorityLevel:Pt,startTime:fn,expirationTime:Wn,sortIndex:-1},fn>jn?(Pt.sortIndex=fn,n(q,Pt),l(G)===null&&Pt===l(q)&&(Ge?(wt(Ve),Ve=-1):Ge=!0,mn(Ai,fn-jn))):(Pt.sortIndex=Wn,n(G,Pt),at||ze||(at=!0,vi||(vi=!0,_t()))),Pt},u.unstable_shouldYield=ht,u.unstable_wrapCallback=function(Pt){var Si=we;return function(){var fn=we;we=Si;try{return Pt.apply(this,arguments)}finally{we=fn}}}})(Cw)),Cw}var b2;function LL(){return b2||(b2=1,Iw.exports=OL()),Iw.exports}var Rw={exports:{}},wl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w2;function zL(){if(w2)return wl;w2=1;var u=IT();function n(G){var q="https://react.dev/errors/"+G;if(1<arguments.length){q+="?args[]="+encodeURIComponent(arguments[1]);for(var te=2;te<arguments.length;te++)q+="&args[]="+encodeURIComponent(arguments[te])}return"Minified React error #"+G+"; visit "+q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var m={d:{f:l,r:function(){throw Error(n(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},w=Symbol.for("react.portal");function C(G,q,te){var ce=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:w,key:ce==null?null:""+ce,children:G,containerInfo:q,implementation:te}}var D=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(G,q){if(G==="font")return"";if(typeof q=="string")return q==="use-credentials"?q:""}return wl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=m,wl.createPortal=function(G,q){var te=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!q||q.nodeType!==1&&q.nodeType!==9&&q.nodeType!==11)throw Error(n(299));return C(G,q,null,te)},wl.flushSync=function(G){var q=D.T,te=m.p;try{if(D.T=null,m.p=2,G)return G()}finally{D.T=q,m.p=te,m.d.f()}},wl.preconnect=function(G,q){typeof G=="string"&&(q?(q=q.crossOrigin,q=typeof q=="string"?q==="use-credentials"?q:"":void 0):q=null,m.d.C(G,q))},wl.prefetchDNS=function(G){typeof G=="string"&&m.d.D(G)},wl.preinit=function(G,q){if(typeof G=="string"&&q&&typeof q.as=="string"){var te=q.as,ce=s(te,q.crossOrigin),we=typeof q.integrity=="string"?q.integrity:void 0,ze=typeof q.fetchPriority=="string"?q.fetchPriority:void 0;te==="style"?m.d.S(G,typeof q.precedence=="string"?q.precedence:void 0,{crossOrigin:ce,integrity:we,fetchPriority:ze}):te==="script"&&m.d.X(G,{crossOrigin:ce,integrity:we,fetchPriority:ze,nonce:typeof q.nonce=="string"?q.nonce:void 0})}},wl.preinitModule=function(G,q){if(typeof G=="string")if(typeof q=="object"&&q!==null){if(q.as==null||q.as==="script"){var te=s(q.as,q.crossOrigin);m.d.M(G,{crossOrigin:te,integrity:typeof q.integrity=="string"?q.integrity:void 0,nonce:typeof q.nonce=="string"?q.nonce:void 0})}}else q==null&&m.d.M(G)},wl.preload=function(G,q){if(typeof G=="string"&&typeof q=="object"&&q!==null&&typeof q.as=="string"){var te=q.as,ce=s(te,q.crossOrigin);m.d.L(G,te,{crossOrigin:ce,integrity:typeof q.integrity=="string"?q.integrity:void 0,nonce:typeof q.nonce=="string"?q.nonce:void 0,type:typeof q.type=="string"?q.type:void 0,fetchPriority:typeof q.fetchPriority=="string"?q.fetchPriority:void 0,referrerPolicy:typeof q.referrerPolicy=="string"?q.referrerPolicy:void 0,imageSrcSet:typeof q.imageSrcSet=="string"?q.imageSrcSet:void 0,imageSizes:typeof q.imageSizes=="string"?q.imageSizes:void 0,media:typeof q.media=="string"?q.media:void 0})}},wl.preloadModule=function(G,q){if(typeof G=="string")if(q){var te=s(q.as,q.crossOrigin);m.d.m(G,{as:typeof q.as=="string"&&q.as!=="script"?q.as:void 0,crossOrigin:te,integrity:typeof q.integrity=="string"?q.integrity:void 0})}else m.d.m(G)},wl.requestFormReset=function(G){m.d.r(G)},wl.unstable_batchedUpdates=function(G,q){return G(q)},wl.useFormState=function(G,q,te){return D.H.useFormState(G,q,te)},wl.useFormStatus=function(){return D.H.useHostTransitionStatus()},wl.version="19.2.0",wl}var T2;function kL(){if(T2)return Rw.exports;T2=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),Rw.exports=zL(),Rw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E2;function NL(){if(E2)return Nv;E2=1;var u=LL(),n=IT(),l=kL();function m(c){var p="https://react.dev/errors/"+c;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+c+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function C(c){var p=c,b=c;if(c.alternate)for(;p.return;)p=p.return;else{c=p;do p=c,(p.flags&4098)!==0&&(b=p.return),c=p.return;while(c)}return p.tag===3?b:null}function D(c){if(c.tag===13){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function s(c){if(c.tag===31){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function G(c){if(C(c)!==c)throw Error(m(188))}function q(c){var p=c.alternate;if(!p){if(p=C(c),p===null)throw Error(m(188));return p!==c?null:c}for(var b=c,I=p;;){var N=b.return;if(N===null)break;var j=N.alternate;if(j===null){if(I=N.return,I!==null){b=I;continue}break}if(N.child===j.child){for(j=N.child;j;){if(j===b)return G(N),c;if(j===I)return G(N),p;j=j.sibling}throw Error(m(188))}if(b.return!==I.return)b=N,I=j;else{for(var ne=!1,Te=N.child;Te;){if(Te===b){ne=!0,b=N,I=j;break}if(Te===I){ne=!0,I=N,b=j;break}Te=Te.sibling}if(!ne){for(Te=j.child;Te;){if(Te===b){ne=!0,b=j,I=N;break}if(Te===I){ne=!0,I=j,b=N;break}Te=Te.sibling}if(!ne)throw Error(m(189))}}if(b.alternate!==I)throw Error(m(190))}if(b.tag!==3)throw Error(m(188));return b.stateNode.current===b?c:p}function te(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c;for(c=c.child;c!==null;){if(p=te(c),p!==null)return p;c=c.sibling}return null}var ce=Object.assign,we=Symbol.for("react.element"),ze=Symbol.for("react.transitional.element"),at=Symbol.for("react.portal"),Ge=Symbol.for("react.fragment"),Qe=Symbol.for("react.strict_mode"),xt=Symbol.for("react.profiler"),wt=Symbol.for("react.consumer"),jt=Symbol.for("react.context"),wi=Symbol.for("react.forward_ref"),Ai=Symbol.for("react.suspense"),vi=Symbol.for("react.suspense_list"),Ve=Symbol.for("react.memo"),ke=Symbol.for("react.lazy"),We=Symbol.for("react.activity"),ht=Symbol.for("react.memo_cache_sentinel"),$e=Symbol.iterator;function _t(c){return c===null||typeof c!="object"?null:(c=$e&&c[$e]||c["@@iterator"],typeof c=="function"?c:null)}var Ue=Symbol.for("react.client.reference");function Cn(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===Ue?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case Ge:return"Fragment";case xt:return"Profiler";case Qe:return"StrictMode";case Ai:return"Suspense";case vi:return"SuspenseList";case We:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case at:return"Portal";case jt:return c.displayName||"Context";case wt:return(c._context.displayName||"Context")+".Consumer";case wi:var p=c.render;return c=c.displayName,c||(c=p.displayName||p.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case Ve:return p=c.displayName||null,p!==null?p:Cn(c.type)||"Memo";case ke:p=c._payload,c=c._init;try{return Cn(c(p))}catch{}}return null}var mn=Array.isArray,Pt=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Si=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fn={pending:!1,data:null,method:null,action:null},jn=[],Wn=-1;function et(c){return{current:c}}function Kt(c){0>Wn||(c.current=jn[Wn],jn[Wn]=null,Wn--)}function Oi(c,p){Wn++,jn[Wn]=c.current,c.current=p}var Hi=et(null),bn=et(null),Qt=et(null),Li=et(null);function cn(c,p){switch(Oi(Qt,p),Oi(bn,c),Oi(Hi,null),p.nodeType){case 9:case 11:c=(c=p.documentElement)&&(c=c.namespaceURI)?ev(c):0;break;default:if(c=p.tagName,p=p.namespaceURI)p=ev(p),c=xg(p,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}Kt(Hi),Oi(Hi,c)}function Nn(){Kt(Hi),Kt(bn),Kt(Qt)}function ur(c){c.memoizedState!==null&&Oi(Li,c);var p=Hi.current,b=xg(p,c.type);p!==b&&(Oi(bn,c),Oi(Hi,b))}function Qo(c){bn.current===c&&(Kt(Hi),Kt(bn)),Li.current===c&&(Kt(Li),Gh._currentValue=fn)}var Jo,Ya;function ys(c){if(Jo===void 0)try{throw Error()}catch(b){var p=b.stack.trim().match(/\n( *(at )?)/);Jo=p&&p[1]||"",Ya=-1<b.stack.indexOf(`
    at`)?" (<anonymous>)":-1<b.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Jo+c+Ya}var Dr=!1;function Il(c,p){if(!c||Dr)return"";Dr=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var I={DetermineComponentFrameRoot:function(){try{if(p){var ai=function(){throw Error()};if(Object.defineProperty(ai.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ai,[])}catch(qt){var Vt=qt}Reflect.construct(c,[],ai)}else{try{ai.call()}catch(qt){Vt=qt}c.call(ai.prototype)}}else{try{throw Error()}catch(qt){Vt=qt}(ai=c())&&typeof ai.catch=="function"&&ai.catch(function(){})}}catch(qt){if(qt&&Vt&&typeof qt.stack=="string")return[qt.stack,Vt.stack]}return[null,null]}};I.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(I.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(I.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var j=I.DetermineComponentFrameRoot(),ne=j[0],Te=j[1];if(ne&&Te){var tt=ne.split(`
`),Nt=Te.split(`
`);for(N=I=0;I<tt.length&&!tt[I].includes("DetermineComponentFrameRoot");)I++;for(;N<Nt.length&&!Nt[N].includes("DetermineComponentFrameRoot");)N++;if(I===tt.length||N===Nt.length)for(I=tt.length-1,N=Nt.length-1;1<=I&&0<=N&&tt[I]!==Nt[N];)N--;for(;1<=I&&0<=N;I--,N--)if(tt[I]!==Nt[N]){if(I!==1||N!==1)do if(I--,N--,0>N||tt[I]!==Nt[N]){var Jt=`
`+tt[I].replace(" at new "," at ");return c.displayName&&Jt.includes("<anonymous>")&&(Jt=Jt.replace("<anonymous>",c.displayName)),Jt}while(1<=I&&0<=N);break}}}finally{Dr=!1,Error.prepareStackTrace=b}return(b=c?c.displayName||c.name:"")?ys(b):""}function Ka(c,p){switch(c.tag){case 26:case 27:case 5:return ys(c.type);case 16:return ys("Lazy");case 13:return c.child!==p&&p!==null?ys("Suspense Fallback"):ys("Suspense");case 19:return ys("SuspenseList");case 0:case 15:return Il(c.type,!1);case 11:return Il(c.type.render,!1);case 1:return Il(c.type,!0);case 31:return ys("Activity");default:return""}}function Uc(c){try{var p="",b=null;do p+=Ka(c,b),b=c,c=c.return;while(c);return p}catch(I){return`
Error generating stack: `+I.message+`
`+I.stack}}var Tr=Object.prototype.hasOwnProperty,ls=u.unstable_scheduleCallback,Fs=u.unstable_cancelCallback,Cl=u.unstable_shouldYield,Qa=u.unstable_requestPaint,Bs=u.unstable_now,Ra=u.unstable_getCurrentPriorityLevel,no=u.unstable_ImmediatePriority,xo=u.unstable_UserBlockingPriority,Ja=u.unstable_NormalPriority,Rl=u.unstable_LowPriority,jc=u.unstable_IdlePriority,Ms=u.log,ga=u.unstable_setDisableYieldValue,ea=null,vs=null;function Vs(c){if(typeof Ms=="function"&&ga(c),vs&&typeof vs.setStrictMode=="function")try{vs.setStrictMode(ea,c)}catch{}}var Yr=Math.clz32?Math.clz32:Ts,ac=Math.log,hr=Math.LN2;function Ts(c){return c>>>=0,c===0?32:31-(ac(c)/hr|0)|0}var _a=256,Ma=262144,Hr=4194304;function ya(c){var p=c&42;if(p!==0)return p;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function va(c,p,b){var I=c.pendingLanes;if(I===0)return 0;var N=0,j=c.suspendedLanes,ne=c.pingedLanes;c=c.warmLanes;var Te=I&134217727;return Te!==0?(I=Te&~j,I!==0?N=ya(I):(ne&=Te,ne!==0?N=ya(ne):b||(b=Te&~c,b!==0&&(N=ya(b))))):(Te=I&~j,Te!==0?N=ya(Te):ne!==0?N=ya(ne):b||(b=I&~c,b!==0&&(N=ya(b)))),N===0?0:p!==0&&p!==N&&(p&j)===0&&(j=N&-N,b=p&-p,j>=b||j===32&&(b&4194048)!==0)?p:N}function xa(c,p){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&p)===0}function Ct(c,p){switch(c){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function el(){var c=Hr;return Hr<<=1,(Hr&62914560)===0&&(Hr=4194304),c}function tl(c){for(var p=[],b=0;31>b;b++)p.push(c);return p}function il(c,p){c.pendingLanes|=p,p!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Fe(c,p,b,I,N,j){var ne=c.pendingLanes;c.pendingLanes=b,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=b,c.entangledLanes&=b,c.errorRecoveryDisabledLanes&=b,c.shellSuspendCounter=0;var Te=c.entanglements,tt=c.expirationTimes,Nt=c.hiddenUpdates;for(b=ne&~b;0<b;){var Jt=31-Yr(b),ai=1<<Jt;Te[Jt]=0,tt[Jt]=-1;var Vt=Nt[Jt];if(Vt!==null)for(Nt[Jt]=null,Jt=0;Jt<Vt.length;Jt++){var qt=Vt[Jt];qt!==null&&(qt.lane&=-536870913)}b&=~ai}I!==0&&J(c,I,0),j!==0&&N===0&&c.tag!==0&&(c.suspendedLanes|=j&~(ne&~p))}function J(c,p,b){c.pendingLanes|=p,c.suspendedLanes&=~p;var I=31-Yr(p);c.entangledLanes|=p,c.entanglements[I]=c.entanglements[I]|1073741824|b&261930}function se(c,p){var b=c.entangledLanes|=p;for(c=c.entanglements;b;){var I=31-Yr(b),N=1<<I;N&p|c[I]&p&&(c[I]|=p),b&=~N}}function me(c,p){var b=p&-p;return b=(b&42)!==0?1:Re(b),(b&(c.suspendedLanes|p))!==0?0:b}function Re(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Ae(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function Ie(){var c=Si.p;return c!==0?c:(c=window.event,c===void 0?32:dv(c.type))}function Ye(c,p){var b=Si.p;try{return Si.p=c,p()}finally{Si.p=b}}var Le=Math.random().toString(36).slice(2),Xe="__reactFiber$"+Le,At="__reactProps$"+Le,gt="__reactContainer$"+Le,di="__reactEvents$"+Le,Mi="__reactListeners$"+Le,Bi="__reactHandles$"+Le,un="__reactResources$"+Le,Wi="__reactMarker$"+Le;function hn(c){delete c[Xe],delete c[At],delete c[di],delete c[Mi],delete c[Bi]}function Ln(c){var p=c[Xe];if(p)return p;for(var b=c.parentNode;b;){if(p=b[gt]||b[Xe]){if(b=p.alternate,p.child!==null||b!==null&&b.child!==null)for(c=P_(c);c!==null;){if(b=c[Xe])return b;c=P_(c)}return p}c=b,b=c.parentNode}return null}function Ki(c){if(c=c[Xe]||c[gt]){var p=c.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return c}return null}function Zn(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c.stateNode;throw Error(m(33))}function Cr(c){var p=c[un];return p||(p=c[un]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function Gn(c){c[Wi]=!0}var Vn=new Set,Rn={};function rr(c,p){sr(c,p),sr(c+"Capture",p)}function sr(c,p){for(Rn[c]=p,c=0;c<p.length;c++)Vn.add(p[c])}var Jn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Es={},Ys={};function zo(c){return Tr.call(Ys,c)?!0:Tr.call(Es,c)?!1:Jn.test(c)?Ys[c]=!0:(Es[c]=!0,!1)}function ba(c,p,b){if(zo(p))if(b===null)c.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":c.removeAttribute(p);return;case"boolean":var I=p.toLowerCase().slice(0,5);if(I!=="data-"&&I!=="aria-"){c.removeAttribute(p);return}}c.setAttribute(p,""+b)}}function Kr(c,p,b){if(b===null)c.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(p);return}c.setAttribute(p,""+b)}}function ds(c,p,b,I){if(I===null)c.removeAttribute(b);else{switch(typeof I){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(b);return}c.setAttributeNS(p,b,""+I)}}function ro(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function ta(c){var p=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function lc(c,p,b){var I=Object.getOwnPropertyDescriptor(c.constructor.prototype,p);if(!c.hasOwnProperty(p)&&typeof I<"u"&&typeof I.get=="function"&&typeof I.set=="function"){var N=I.get,j=I.set;return Object.defineProperty(c,p,{configurable:!0,get:function(){return N.call(this)},set:function(ne){b=""+ne,j.call(this,ne)}}),Object.defineProperty(c,p,{enumerable:I.enumerable}),{getValue:function(){return b},setValue:function(ne){b=""+ne},stopTracking:function(){c._valueTracker=null,delete c[p]}}}}function Rr(c){if(!c._valueTracker){var p=ta(c)?"checked":"value";c._valueTracker=lc(c,p,""+c[p])}}function Ml(c){if(!c)return!1;var p=c._valueTracker;if(!p)return!0;var b=p.getValue(),I="";return c&&(I=ta(c)?c.checked?"true":"false":c.value),c=I,c!==b?(p.setValue(c),!0):!1}function bo(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var Pl=/[\n"\\]/g;function ko(c){return c.replace(Pl,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function ia(c,p,b,I,N,j,ne,Te){c.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?c.type=ne:c.removeAttribute("type"),p!=null?ne==="number"?(p===0&&c.value===""||c.value!=p)&&(c.value=""+ro(p)):c.value!==""+ro(p)&&(c.value=""+ro(p)):ne!=="submit"&&ne!=="reset"||c.removeAttribute("value"),p!=null?wu(c,ne,ro(p)):b!=null?wu(c,ne,ro(b)):I!=null&&c.removeAttribute("value"),N==null&&j!=null&&(c.defaultChecked=!!j),N!=null&&(c.checked=N&&typeof N!="function"&&typeof N!="symbol"),Te!=null&&typeof Te!="function"&&typeof Te!="symbol"&&typeof Te!="boolean"?c.name=""+ro(Te):c.removeAttribute("name")}function id(c,p,b,I,N,j,ne,Te){if(j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(c.type=j),p!=null||b!=null){if(!(j!=="submit"&&j!=="reset"||p!=null)){Rr(c);return}b=b!=null?""+ro(b):"",p=p!=null?""+ro(p):b,Te||p===c.value||(c.value=p),c.defaultValue=p}I=I??N,I=typeof I!="function"&&typeof I!="symbol"&&!!I,c.checked=Te?c.checked:!!I,c.defaultChecked=!!I,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(c.name=ne),Rr(c)}function wu(c,p,b){p==="number"&&bo(c.ownerDocument)===c||c.defaultValue===""+b||(c.defaultValue=""+b)}function Ks(c,p,b,I){if(c=c.options,p){p={};for(var N=0;N<b.length;N++)p["$"+b[N]]=!0;for(b=0;b<c.length;b++)N=p.hasOwnProperty("$"+c[b].value),c[b].selected!==N&&(c[b].selected=N),N&&I&&(c[b].defaultSelected=!0)}else{for(b=""+ro(b),p=null,N=0;N<c.length;N++){if(c[N].value===b){c[N].selected=!0,I&&(c[N].defaultSelected=!0);return}p!==null||c[N].disabled||(p=c[N])}p!==null&&(p.selected=!0)}}function wa(c,p,b){if(p!=null&&(p=""+ro(p),p!==c.value&&(c.value=p),b==null)){c.defaultValue!==p&&(c.defaultValue=p);return}c.defaultValue=b!=null?""+ro(b):""}function No(c,p,b,I){if(p==null){if(I!=null){if(b!=null)throw Error(m(92));if(mn(I)){if(1<I.length)throw Error(m(93));I=I[0]}b=I}b==null&&(b=""),p=b}b=ro(p),c.defaultValue=b,I=c.textContent,I===b&&I!==""&&I!==null&&(c.value=I),Rr(c)}function xs(c,p){if(p){var b=c.firstChild;if(b&&b===c.lastChild&&b.nodeType===3){b.nodeValue=p;return}}c.textContent=p}var so=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Dl(c,p,b){var I=p.indexOf("--")===0;b==null||typeof b=="boolean"||b===""?I?c.setProperty(p,""):p==="float"?c.cssFloat="":c[p]="":I?c.setProperty(p,b):typeof b!="number"||b===0||so.has(p)?p==="float"?c.cssFloat=b:c[p]=(""+b).trim():c[p]=b+"px"}function sh(c,p,b){if(p!=null&&typeof p!="object")throw Error(m(62));if(c=c.style,b!=null){for(var I in b)!b.hasOwnProperty(I)||p!=null&&p.hasOwnProperty(I)||(I.indexOf("--")===0?c.setProperty(I,""):I==="float"?c.cssFloat="":c[I]="");for(var N in p)I=p[N],p.hasOwnProperty(N)&&b[N]!==I&&Dl(c,N,I)}else for(var j in p)p.hasOwnProperty(j)&&Dl(c,j,p[j])}function cc(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ol=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),nl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function uc(c){return nl.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function Fo(){}var wo=null;function Ta(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Ll=null,na=null;function hc(c){var p=Ki(c);if(p&&(c=p.stateNode)){var b=c[At]||null;e:switch(c=p.stateNode,p.type){case"input":if(ia(c,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name),p=b.name,b.type==="radio"&&p!=null){for(b=c;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll('input[name="'+ko(""+p)+'"][type="radio"]'),p=0;p<b.length;p++){var I=b[p];if(I!==c&&I.form===c.form){var N=I[At]||null;if(!N)throw Error(m(90));ia(I,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(p=0;p<b.length;p++)I=b[p],I.form===c.form&&Ml(I)}break e;case"textarea":wa(c,b.value,b.defaultValue);break e;case"select":p=b.value,p!=null&&Ks(c,!!b.multiple,p,!1)}}}var Tu=!1;function zl(c,p,b){if(Tu)return c(p,b);Tu=!0;try{var I=c(p);return I}finally{if(Tu=!1,(Ll!==null||na!==null)&&(Jl(),Ll&&(p=Ll,c=na,na=Ll=null,hc(p),c)))for(p=0;p<c.length;p++)hc(c[p])}}function on(c,p){var b=c.stateNode;if(b===null)return null;var I=b[At]||null;if(I===null)return null;b=I[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(c=c.type,I=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!I;break e;default:c=!1}if(c)return null;if(b&&typeof b!="function")throw Error(m(231,p,typeof b));return b}var To=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Eu=!1;if(To)try{var Qr={};Object.defineProperty(Qr,"passive",{get:function(){Eu=!0}}),window.addEventListener("test",Qr,Qr),window.removeEventListener("test",Qr,Qr)}catch{Eu=!1}var Pa=null,rl=null,sl=null;function Gc(){if(sl)return sl;var c,p=rl,b=p.length,I,N="value"in Pa?Pa.value:Pa.textContent,j=N.length;for(c=0;c<b&&p[c]===N[c];c++);var ne=b-c;for(I=1;I<=ne&&p[b-I]===N[j-I];I++);return sl=N.slice(c,1<I?1-I:void 0)}function dc(c){var p=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&p===13&&(c=13)):c=p,c===10&&(c=13),32<=c||c===13?c:0}function fc(){return!0}function Eo(){return!1}function ho(c){function p(b,I,N,j,ne){this._reactName=b,this._targetInst=N,this.type=I,this.nativeEvent=j,this.target=ne,this.currentTarget=null;for(var Te in c)c.hasOwnProperty(Te)&&(b=c[Te],this[Te]=b?b(j):j[Te]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?fc:Eo,this.isPropagationStopped=Eo,this}return ce(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=fc)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=fc)},persist:function(){},isPersistent:fc}),p}var kl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ra=ho(kl),Nl=ce({},kl,{view:0,detail:0}),sa=ho(Nl),ol,qc,Ps,al=ce({},Nl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Ps&&(Ps&&c.type==="mousemove"?(ol=c.screenX-Ps.screenX,qc=c.screenY-Ps.screenY):qc=ol=0,Ps=c),ol)},movementY:function(c){return"movementY"in c?c.movementY:qc}}),So=ho(al),Hc=ce({},al,{dataTransfer:0}),oh=ho(Hc),nd=ce({},Nl,{relatedTarget:0}),In=ho(nd),ah=ce({},kl,{animationName:0,elapsedTime:0,pseudoElement:0}),_f=ho(ah),Wc=ce({},kl,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Ii=ho(Wc),rd=ce({},kl,{data:0}),Ds=ho(rd),Ea={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Da={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gi(c){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(c):(c=Da[c])?!!p[c]:!1}function Sn(){return gi}var gn=ce({},Nl,{key:function(c){if(c.key){var p=Ea[c.key]||c.key;if(p!=="Unidentified")return p}return c.type==="keypress"?(c=dc(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?lh[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(c){return c.type==="keypress"?dc(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?dc(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Ao=ho(gn),pc=ce({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wn=ho(pc),z=ce({},Nl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn}),ee=ho(z),ae=ce({},kl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ce=ho(ae),pt=ce({},al,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Gt=ho(pt),Ri=ce({},kl,{newState:0,oldState:0}),Un=ho(Ri),fs=[9,13,27,32],yr=To&&"CompositionEvent"in window,Br=null;To&&"documentMode"in document&&(Br=document.documentMode);var oa=To&&"TextEvent"in window&&!Br,ps=To&&(!yr||Br&&8<Br&&11>=Br),Us=" ",ms=!1;function Su(c,p){switch(c){case"keyup":return fs.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fl(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var ns=!1;function aa(c,p){switch(c){case"compositionend":return Fl(p);case"keypress":return p.which!==32?null:(ms=!0,Us);case"textInput":return c=p.data,c===Us&&ms?null:c;default:return null}}function Xi(c,p){if(ns)return c==="compositionend"||!yr&&Su(c,p)?(c=Gc(),sl=rl=Pa=null,ns=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return ps&&p.locale!=="ko"?null:p.data;default:return null}}var ei={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sd(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p==="input"?!!ei[c.type]:p==="textarea"}function Pi(c,p,b,I){Ll?na?na.push(I):na=[I]:Ll=I,p=Yu(p,"onChange"),0<p.length&&(b=new ra("onChange","change",null,b,I),c.push({event:b,listeners:p}))}var Bl=null,mc=null;function ki(c){Zy(c,0)}function od(c){var p=Zn(c);if(Ml(p))return c}function ad(c,p){if(c==="change")return p}var ld=!1;if(To){var yf;if(To){var cd="oninput"in document;if(!cd){var rs=document.createElement("div");rs.setAttribute("oninput","return;"),cd=typeof rs.oninput=="function"}yf=cd}else yf=!1;ld=yf&&(!document.documentMode||9<document.documentMode)}function fp(){Bl&&(Bl.detachEvent("onpropertychange",gc),mc=Bl=null)}function gc(c){if(c.propertyName==="value"&&od(mc)){var p=[];Pi(p,mc,c,Ta(c)),zl(ki,p)}}function Bo(c,p,b){c==="focusin"?(fp(),Bl=p,mc=b,Bl.attachEvent("onpropertychange",gc)):c==="focusout"&&fp()}function Au(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return od(mc)}function oo(c,p){if(c==="click")return od(p)}function t_(c,p){if(c==="input"||c==="change")return od(p)}function vf(c,p){return c===p&&(c!==0||1/c===1/p)||c!==c&&p!==p}var Oa=typeof Object.is=="function"?Object.is:vf;function Iu(c,p){if(Oa(c,p))return!0;if(typeof c!="object"||c===null||typeof p!="object"||p===null)return!1;var b=Object.keys(c),I=Object.keys(p);if(b.length!==I.length)return!1;for(I=0;I<b.length;I++){var N=b[I];if(!Tr.call(p,N)||!Oa(c[N],p[N]))return!1}return!0}function ch(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function ll(c,p){var b=ch(c);c=0;for(var I;b;){if(b.nodeType===3){if(I=c+b.textContent.length,c<=p&&I>=p)return{node:b,offset:p-c};c=I}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=ch(b)}}function i_(c,p){return c&&p?c===p?!0:c&&c.nodeType===3?!1:p&&p.nodeType===3?i_(c,p.parentNode):"contains"in c?c.contains(p):c.compareDocumentPosition?!!(c.compareDocumentPosition(p)&16):!1:!1}function uh(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var p=bo(c.document);p instanceof c.HTMLIFrameElement;){try{var b=typeof p.contentWindow.location.href=="string"}catch{b=!1}if(b)c=p.contentWindow;else break;p=bo(c.document)}return p}function pp(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p&&(p==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||p==="textarea"||c.contentEditable==="true")}var mp=To&&"documentMode"in document&&11>=document.documentMode,$c=null,_c=null,Vl=null,zm=!1;function n_(c,p,b){var I=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;zm||$c==null||$c!==bo(I)||(I=$c,"selectionStart"in I&&pp(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Vl&&Iu(Vl,I)||(Vl=I,I=Yu(_c,"onSelect"),0<I.length&&(p=new ra("onSelect","select",null,p,b),c.push({event:p,listeners:I}),p.target=$c)))}function yc(c,p){var b={};return b[c.toLowerCase()]=p.toLowerCase(),b["Webkit"+c]="webkit"+p,b["Moz"+c]="moz"+p,b}var hh={animationend:yc("Animation","AnimationEnd"),animationiteration:yc("Animation","AnimationIteration"),animationstart:yc("Animation","AnimationStart"),transitionrun:yc("Transition","TransitionRun"),transitionstart:yc("Transition","TransitionStart"),transitioncancel:yc("Transition","TransitionCancel"),transitionend:yc("Transition","TransitionEnd")},ud={},La={};To&&(La=document.createElement("div").style,"AnimationEvent"in window||(delete hh.animationend.animation,delete hh.animationiteration.animation,delete hh.animationstart.animation),"TransitionEvent"in window||delete hh.transitionend.transition);function Cu(c){if(ud[c])return ud[c];if(!hh[c])return c;var p=hh[c],b;for(b in p)if(p.hasOwnProperty(b)&&b in La)return ud[c]=p[b];return c}var km=Cu("animationend"),Nm=Cu("animationiteration"),Ru=Cu("animationstart"),xf=Cu("transitionrun"),Fm=Cu("transitionstart"),Bm=Cu("transitioncancel"),dh=Cu("transitionend"),fh=new Map,bf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bf.push("scrollEnd");function Sa(c,p){fh.set(c,p),rr(p,[c])}var Vo=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},la=[],Bt=0,wf=0;function Zc(){for(var c=Bt,p=wf=Bt=0;p<c;){var b=la[p];la[p++]=null;var I=la[p];la[p++]=null;var N=la[p];la[p++]=null;var j=la[p];if(la[p++]=null,I!==null&&N!==null){var ne=I.pending;ne===null?N.next=N:(N.next=ne.next,ne.next=N),I.pending=N}j!==0&&jl(b,N,j)}}function Xc(c,p,b,I){la[Bt++]=c,la[Bt++]=p,la[Bt++]=b,la[Bt++]=I,wf|=I,c.lanes|=I,c=c.alternate,c!==null&&(c.lanes|=I)}function ph(c,p,b,I){return Xc(c,p,b,I),mh(c)}function Ul(c,p){return Xc(c,null,null,p),mh(c)}function jl(c,p,b){c.lanes|=b;var I=c.alternate;I!==null&&(I.lanes|=b);for(var N=!1,j=c.return;j!==null;)j.childLanes|=b,I=j.alternate,I!==null&&(I.childLanes|=b),j.tag===22&&(c=j.stateNode,c===null||c._visibility&1||(N=!0)),c=j,j=j.return;return c.tag===3?(j=c.stateNode,N&&p!==null&&(N=31-Yr(b),c=j.hiddenUpdates,I=c[N],I===null?c[N]=[p]:I.push(p),p.lane=b|536870912),j):null}function mh(c){if(50<cr)throw cr=0,cs=null,Error(m(185));for(var p=c.return;p!==null;)c=p,p=c.return;return c.tag===3?c.stateNode:null}var Io={};function vn(c,p,b,I){this.tag=c,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fo(c,p,b,I){return new vn(c,p,b,I)}function Vm(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Yc(c,p){var b=c.alternate;return b===null?(b=fo(c.tag,p,c.key,c.mode),b.elementType=c.elementType,b.type=c.type,b.stateNode=c.stateNode,b.alternate=c,c.alternate=b):(b.pendingProps=p,b.type=c.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=c.flags&65011712,b.childLanes=c.childLanes,b.lanes=c.lanes,b.child=c.child,b.memoizedProps=c.memoizedProps,b.memoizedState=c.memoizedState,b.updateQueue=c.updateQueue,p=c.dependencies,b.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},b.sibling=c.sibling,b.index=c.index,b.ref=c.ref,b.refCleanup=c.refCleanup,b}function Tf(c,p){c.flags&=65011714;var b=c.alternate;return b===null?(c.childLanes=0,c.lanes=p,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=b.childLanes,c.lanes=b.lanes,c.child=b.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=b.memoizedProps,c.memoizedState=b.memoizedState,c.updateQueue=b.updateQueue,c.type=b.type,p=b.dependencies,c.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),c}function gp(c,p,b,I,N,j){var ne=0;if(I=c,typeof c=="function")Vm(c)&&(ne=1);else if(typeof c=="string")ne=r0(c,b,Hi.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case We:return c=fo(31,b,p,N),c.elementType=We,c.lanes=j,c;case Ge:return or(b.children,N,j,p);case Qe:ne=8,N|=24;break;case xt:return c=fo(12,b,p,N|2),c.elementType=xt,c.lanes=j,c;case Ai:return c=fo(13,b,p,N),c.elementType=Ai,c.lanes=j,c;case vi:return c=fo(19,b,p,N),c.elementType=vi,c.lanes=j,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case jt:ne=10;break e;case wt:ne=9;break e;case wi:ne=11;break e;case Ve:ne=14;break e;case ke:ne=16,I=null;break e}ne=29,b=Error(m(130,c===null?"null":typeof c,"")),I=null}return p=fo(ne,b,p,N),p.elementType=c,p.type=I,p.lanes=j,p}function or(c,p,b,I){return c=fo(7,c,I,p),c.lanes=b,c}function _p(c,p,b){return c=fo(6,c,null,p),c.lanes=b,c}function yp(c){var p=fo(18,null,null,0);return p.stateNode=c,p}function Um(c,p,b){return p=fo(4,c.children!==null?c.children:[],c.key,p),p.lanes=b,p.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},p}var r_=new WeakMap;function cl(c,p){if(typeof c=="object"&&c!==null){var b=r_.get(c);return b!==void 0?b:(p={value:c,source:p,stack:Uc(p)},r_.set(c,p),p)}return{value:c,source:p,stack:Uc(p)}}var hd=[],gh=0,vp=null,Mu=0,ul=[],za=0,vc=null,ka=1,hl="";function ca(c,p){hd[gh++]=Mu,hd[gh++]=vp,vp=c,Mu=p}function _h(c,p,b){ul[za++]=ka,ul[za++]=hl,ul[za++]=vc,vc=c;var I=ka;c=hl;var N=32-Yr(I)-1;I&=~(1<<N),b+=1;var j=32-Yr(p)+N;if(30<j){var ne=N-N%5;j=(I&(1<<ne)-1).toString(32),I>>=ne,N-=ne,ka=1<<32-Yr(p)+N|b<<N|I,hl=j+c}else ka=1<<j|b<<N|I,hl=c}function dd(c){c.return!==null&&(ca(c,1),_h(c,1,0))}function fd(c){for(;c===vp;)vp=hd[--gh],hd[gh]=null,Mu=hd[--gh],hd[gh]=null;for(;c===vc;)vc=ul[--za],ul[za]=null,hl=ul[--za],ul[za]=null,ka=ul[--za],ul[za]=null}function yh(c,p){ul[za++]=ka,ul[za++]=hl,ul[za++]=vc,ka=p.id,hl=p.overflow,vc=c}var po=null,ss=null,mr=!1,Na=null,ua=!1,pd=Error(m(519));function xc(c){var p=Error(m(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw dl(cl(p,c)),pd}function Ef(c){var p=c.stateNode,b=c.type,I=c.memoizedProps;switch(p[Xe]=c,p[At]=I,b){case"dialog":ar("cancel",p),ar("close",p);break;case"iframe":case"object":case"embed":ar("load",p);break;case"video":case"audio":for(b=0;b<Lc.length;b++)ar(Lc[b],p);break;case"source":ar("error",p);break;case"img":case"image":case"link":ar("error",p),ar("load",p);break;case"details":ar("toggle",p);break;case"input":ar("invalid",p),id(p,I.value,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name,!0);break;case"select":ar("invalid",p);break;case"textarea":ar("invalid",p),No(p,I.value,I.defaultValue,I.children)}b=I.children,typeof b!="string"&&typeof b!="number"&&typeof b!="bigint"||p.textContent===""+b||I.suppressHydrationWarning===!0||Qx(p.textContent,b)?(I.popover!=null&&(ar("beforetoggle",p),ar("toggle",p)),I.onScroll!=null&&ar("scroll",p),I.onScrollEnd!=null&&ar("scrollend",p),I.onClick!=null&&(p.onclick=Fo),p=!0):p=!1,p||xc(c,!0)}function md(c){for(po=c.return;po;)switch(po.tag){case 5:case 31:case 13:ua=!1;return;case 27:case 3:ua=!0;return;default:po=po.return}}function vh(c){if(c!==po)return!1;if(!mr)return md(c),mr=!0,!1;var p=c.tag,b;if((b=p!==3&&p!==27)&&((b=p===5)&&(b=c.type,b=!(b!=="form"&&b!=="button")||$p(c.type,c.memoizedProps)),b=!b),b&&ss&&xc(c),md(c),p===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(m(317));ss=t0(c)}else if(p===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(m(317));ss=t0(c)}else p===27?(p=ss,Uh(c.type)?(c=iv,iv=null,ss=c):ss=p):ss=po?qa(c.stateNode.nextSibling):null;return!0}function Pu(){ss=po=null,mr=!1}function xp(){var c=Na;return c!==null&&(yn===null?yn=c:yn.push.apply(yn,c),Na=null),c}function dl(c){Na===null?Na=[c]:Na.push(c)}var bp=et(null),Du=null,Kc=null;function Ou(c,p,b){Oi(bp,p._currentValue),p._currentValue=b}function Gl(c){c._currentValue=bp.current,Kt(bp)}function gd(c,p,b){for(;c!==null;){var I=c.alternate;if((c.childLanes&p)!==p?(c.childLanes|=p,I!==null&&(I.childLanes|=p)):I!==null&&(I.childLanes&p)!==p&&(I.childLanes|=p),c===b)break;c=c.return}}function _d(c,p,b,I){var N=c.child;for(N!==null&&(N.return=c);N!==null;){var j=N.dependencies;if(j!==null){var ne=N.child;j=j.firstContext;e:for(;j!==null;){var Te=j;j=N;for(var tt=0;tt<p.length;tt++)if(Te.context===p[tt]){j.lanes|=b,Te=j.alternate,Te!==null&&(Te.lanes|=b),gd(j.return,b,c),I||(ne=null);break e}j=Te.next}}else if(N.tag===18){if(ne=N.return,ne===null)throw Error(m(341));ne.lanes|=b,j=ne.alternate,j!==null&&(j.lanes|=b),gd(ne,b,c),ne=null}else ne=N.child;if(ne!==null)ne.return=N;else for(ne=N;ne!==null;){if(ne===c){ne=null;break}if(N=ne.sibling,N!==null){N.return=ne.return,ne=N;break}ne=ne.return}N=ne}}function Fa(c,p,b,I){c=null;for(var N=p,j=!1;N!==null;){if(!j){if((N.flags&524288)!==0)j=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var ne=N.alternate;if(ne===null)throw Error(m(387));if(ne=ne.memoizedProps,ne!==null){var Te=N.type;Oa(N.pendingProps.value,ne.value)||(c!==null?c.push(Te):c=[Te])}}else if(N===Li.current){if(ne=N.alternate,ne===null)throw Error(m(387));ne.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(c!==null?c.push(Gh):c=[Gh])}N=N.return}c!==null&&_d(p,c,b,I),p.flags|=262144}function yd(c){for(c=c.firstContext;c!==null;){if(!Oa(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Qc(c){Du=c,Kc=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Co(c){return Lu(Du,c)}function bc(c,p){return Du===null&&Qc(c),Lu(c,p)}function Lu(c,p){var b=p._currentValue;if(p={context:p,memoizedValue:b,next:null},Kc===null){if(c===null)throw Error(m(308));Kc=p,c.dependencies={lanes:0,firstContext:p},c.flags|=524288}else Kc=Kc.next=p;return b}var s_=typeof AbortController<"u"?AbortController:function(){var c=[],p=this.signal={aborted:!1,addEventListener:function(b,I){c.push(I)}};this.abort=function(){p.aborted=!0,c.forEach(function(b){return b()})}},Ba=u.unstable_scheduleCallback,wp=u.unstable_NormalPriority,bs={$$typeof:jt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vd(){return{controller:new s_,data:new Map,refCount:0}}function xh(c){c.refCount--,c.refCount===0&&Ba(wp,function(){c.controller.abort()})}var bh=null,xd=0,wc=0,ql=null;function jm(c,p){if(bh===null){var b=bh=[];xd=0,wc=b_(),ql={status:"pending",value:void 0,then:function(I){b.push(I)}}}return xd++,p.then(bd,bd),p}function bd(){if(--xd===0&&bh!==null){ql!==null&&(ql.status="fulfilled");var c=bh;bh=null,wc=0,ql=null;for(var p=0;p<c.length;p++)(0,c[p])()}}function Gm(c,p){var b=[],I={status:"pending",value:null,reason:null,then:function(N){b.push(N)}};return c.then(function(){I.status="fulfilled",I.value=p;for(var N=0;N<b.length;N++)(0,b[N])(p)},function(N){for(I.status="rejected",I.reason=N,N=0;N<b.length;N++)(0,b[N])(void 0)}),I}var qm=Pt.S;Pt.S=function(c,p){as=Bs(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&jm(c,p),qm!==null&&qm(c,p)};var Jc=et(null);function eu(){var c=Jc.current;return c!==null?c:Ei.pooledCache}function Tp(c,p){p===null?Oi(Jc,Jc.current):Oi(Jc,p.pool)}function o_(){var c=eu();return c===null?null:{parent:bs._currentValue,pool:c}}var wd=Error(m(460)),Td=Error(m(474)),Ep=Error(m(542)),Sp={then:function(){}};function Ap(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Ip(c,p,b){switch(b=c[b],b===void 0?c.push(p):b!==p&&(p.then(Fo,Fo),p=b),p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,Cp(c),c;default:if(typeof p.status=="string")p.then(Fo,Fo);else{if(c=Ei,c!==null&&100<c.shellSuspendCounter)throw Error(m(482));c=p,c.status="pending",c.then(function(I){if(p.status==="pending"){var N=p;N.status="fulfilled",N.value=I}},function(I){if(p.status==="pending"){var N=p;N.status="rejected",N.reason=I}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,Cp(c),c}throw fl=p,wd}}function tu(c){try{var p=c._init;return p(c._payload)}catch(b){throw b!==null&&typeof b=="object"&&typeof b.then=="function"?(fl=b,wd):b}}var fl=null;function Hm(){if(fl===null)throw Error(m(459));var c=fl;return fl=null,c}function Cp(c){if(c===wd||c===Ep)throw Error(m(483))}var zu=null,ku=0;function Tc(c){var p=ku;return ku+=1,zu===null&&(zu=[]),Ip(zu,c,p)}function Hl(c,p){p=p.props.ref,c.ref=p!==void 0?p:null}function Wl(c,p){throw p.$$typeof===we?Error(m(525)):(c=Object.prototype.toString.call(p),Error(m(31,c==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":c)))}function Rp(c){function p(bt,ct){if(c){var Ft=bt.deletions;Ft===null?(bt.deletions=[ct],bt.flags|=16):Ft.push(ct)}}function b(bt,ct){if(!c)return null;for(;ct!==null;)p(bt,ct),ct=ct.sibling;return null}function I(bt){for(var ct=new Map;bt!==null;)bt.key!==null?ct.set(bt.key,bt):ct.set(bt.index,bt),bt=bt.sibling;return ct}function N(bt,ct){return bt=Yc(bt,ct),bt.index=0,bt.sibling=null,bt}function j(bt,ct,Ft){return bt.index=Ft,c?(Ft=bt.alternate,Ft!==null?(Ft=Ft.index,Ft<ct?(bt.flags|=67108866,ct):Ft):(bt.flags|=67108866,ct)):(bt.flags|=1048576,ct)}function ne(bt){return c&&bt.alternate===null&&(bt.flags|=67108866),bt}function Te(bt,ct,Ft,ni){return ct===null||ct.tag!==6?(ct=_p(Ft,bt.mode,ni),ct.return=bt,ct):(ct=N(ct,Ft),ct.return=bt,ct)}function tt(bt,ct,Ft,ni){var Tn=Ft.type;return Tn===Ge?Jt(bt,ct,Ft.props.children,ni,Ft.key):ct!==null&&(ct.elementType===Tn||typeof Tn=="object"&&Tn!==null&&Tn.$$typeof===ke&&tu(Tn)===ct.type)?(ct=N(ct,Ft.props),Hl(ct,Ft),ct.return=bt,ct):(ct=gp(Ft.type,Ft.key,Ft.props,null,bt.mode,ni),Hl(ct,Ft),ct.return=bt,ct)}function Nt(bt,ct,Ft,ni){return ct===null||ct.tag!==4||ct.stateNode.containerInfo!==Ft.containerInfo||ct.stateNode.implementation!==Ft.implementation?(ct=Um(Ft,bt.mode,ni),ct.return=bt,ct):(ct=N(ct,Ft.children||[]),ct.return=bt,ct)}function Jt(bt,ct,Ft,ni,Tn){return ct===null||ct.tag!==7?(ct=or(Ft,bt.mode,ni,Tn),ct.return=bt,ct):(ct=N(ct,Ft),ct.return=bt,ct)}function ai(bt,ct,Ft){if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return ct=_p(""+ct,bt.mode,Ft),ct.return=bt,ct;if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case ze:return Ft=gp(ct.type,ct.key,ct.props,null,bt.mode,Ft),Hl(Ft,ct),Ft.return=bt,Ft;case at:return ct=Um(ct,bt.mode,Ft),ct.return=bt,ct;case ke:return ct=tu(ct),ai(bt,ct,Ft)}if(mn(ct)||_t(ct))return ct=or(ct,bt.mode,Ft,null),ct.return=bt,ct;if(typeof ct.then=="function")return ai(bt,Tc(ct),Ft);if(ct.$$typeof===jt)return ai(bt,bc(bt,ct),Ft);Wl(bt,ct)}return null}function Vt(bt,ct,Ft,ni){var Tn=ct!==null?ct.key:null;if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint")return Tn!==null?null:Te(bt,ct,""+Ft,ni);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case ze:return Ft.key===Tn?tt(bt,ct,Ft,ni):null;case at:return Ft.key===Tn?Nt(bt,ct,Ft,ni):null;case ke:return Ft=tu(Ft),Vt(bt,ct,Ft,ni)}if(mn(Ft)||_t(Ft))return Tn!==null?null:Jt(bt,ct,Ft,ni,null);if(typeof Ft.then=="function")return Vt(bt,ct,Tc(Ft),ni);if(Ft.$$typeof===jt)return Vt(bt,ct,bc(bt,Ft),ni);Wl(bt,Ft)}return null}function qt(bt,ct,Ft,ni,Tn){if(typeof ni=="string"&&ni!==""||typeof ni=="number"||typeof ni=="bigint")return bt=bt.get(Ft)||null,Te(ct,bt,""+ni,Tn);if(typeof ni=="object"&&ni!==null){switch(ni.$$typeof){case ze:return bt=bt.get(ni.key===null?Ft:ni.key)||null,tt(ct,bt,ni,Tn);case at:return bt=bt.get(ni.key===null?Ft:ni.key)||null,Nt(ct,bt,ni,Tn);case ke:return ni=tu(ni),qt(bt,ct,Ft,ni,Tn)}if(mn(ni)||_t(ni))return bt=bt.get(Ft)||null,Jt(ct,bt,ni,Tn,null);if(typeof ni.then=="function")return qt(bt,ct,Ft,Tc(ni),Tn);if(ni.$$typeof===jt)return qt(bt,ct,Ft,bc(ct,ni),Tn);Wl(ct,ni)}return null}function Ji(bt,ct,Ft,ni){for(var Tn=null,jr=null,dn=ct,er=ct=0,Ar=null;dn!==null&&er<Ft.length;er++){dn.index>er?(Ar=dn,dn=null):Ar=dn.sibling;var Gr=Vt(bt,dn,Ft[er],ni);if(Gr===null){dn===null&&(dn=Ar);break}c&&dn&&Gr.alternate===null&&p(bt,dn),ct=j(Gr,ct,er),jr===null?Tn=Gr:jr.sibling=Gr,jr=Gr,dn=Ar}if(er===Ft.length)return b(bt,dn),mr&&ca(bt,er),Tn;if(dn===null){for(;er<Ft.length;er++)dn=ai(bt,Ft[er],ni),dn!==null&&(ct=j(dn,ct,er),jr===null?Tn=dn:jr.sibling=dn,jr=dn);return mr&&ca(bt,er),Tn}for(dn=I(dn);er<Ft.length;er++)Ar=qt(dn,bt,er,Ft[er],ni),Ar!==null&&(c&&Ar.alternate!==null&&dn.delete(Ar.key===null?er:Ar.key),ct=j(Ar,ct,er),jr===null?Tn=Ar:jr.sibling=Ar,jr=Ar);return c&&dn.forEach(function(Xd){return p(bt,Xd)}),mr&&ca(bt,er),Tn}function On(bt,ct,Ft,ni){if(Ft==null)throw Error(m(151));for(var Tn=null,jr=null,dn=ct,er=ct=0,Ar=null,Gr=Ft.next();dn!==null&&!Gr.done;er++,Gr=Ft.next()){dn.index>er?(Ar=dn,dn=null):Ar=dn.sibling;var Xd=Vt(bt,dn,Gr.value,ni);if(Xd===null){dn===null&&(dn=Ar);break}c&&dn&&Xd.alternate===null&&p(bt,dn),ct=j(Xd,ct,er),jr===null?Tn=Xd:jr.sibling=Xd,jr=Xd,dn=Ar}if(Gr.done)return b(bt,dn),mr&&ca(bt,er),Tn;if(dn===null){for(;!Gr.done;er++,Gr=Ft.next())Gr=ai(bt,Gr.value,ni),Gr!==null&&(ct=j(Gr,ct,er),jr===null?Tn=Gr:jr.sibling=Gr,jr=Gr);return mr&&ca(bt,er),Tn}for(dn=I(dn);!Gr.done;er++,Gr=Ft.next())Gr=qt(dn,bt,er,Gr.value,ni),Gr!==null&&(c&&Gr.alternate!==null&&dn.delete(Gr.key===null?er:Gr.key),ct=j(Gr,ct,er),jr===null?Tn=Gr:jr.sibling=Gr,jr=Gr);return c&&dn.forEach(function(d0){return p(bt,d0)}),mr&&ca(bt,er),Tn}function Zr(bt,ct,Ft,ni){if(typeof Ft=="object"&&Ft!==null&&Ft.type===Ge&&Ft.key===null&&(Ft=Ft.props.children),typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case ze:e:{for(var Tn=Ft.key;ct!==null;){if(ct.key===Tn){if(Tn=Ft.type,Tn===Ge){if(ct.tag===7){b(bt,ct.sibling),ni=N(ct,Ft.props.children),ni.return=bt,bt=ni;break e}}else if(ct.elementType===Tn||typeof Tn=="object"&&Tn!==null&&Tn.$$typeof===ke&&tu(Tn)===ct.type){b(bt,ct.sibling),ni=N(ct,Ft.props),Hl(ni,Ft),ni.return=bt,bt=ni;break e}b(bt,ct);break}else p(bt,ct);ct=ct.sibling}Ft.type===Ge?(ni=or(Ft.props.children,bt.mode,ni,Ft.key),ni.return=bt,bt=ni):(ni=gp(Ft.type,Ft.key,Ft.props,null,bt.mode,ni),Hl(ni,Ft),ni.return=bt,bt=ni)}return ne(bt);case at:e:{for(Tn=Ft.key;ct!==null;){if(ct.key===Tn)if(ct.tag===4&&ct.stateNode.containerInfo===Ft.containerInfo&&ct.stateNode.implementation===Ft.implementation){b(bt,ct.sibling),ni=N(ct,Ft.children||[]),ni.return=bt,bt=ni;break e}else{b(bt,ct);break}else p(bt,ct);ct=ct.sibling}ni=Um(Ft,bt.mode,ni),ni.return=bt,bt=ni}return ne(bt);case ke:return Ft=tu(Ft),Zr(bt,ct,Ft,ni)}if(mn(Ft))return Ji(bt,ct,Ft,ni);if(_t(Ft)){if(Tn=_t(Ft),typeof Tn!="function")throw Error(m(150));return Ft=Tn.call(Ft),On(bt,ct,Ft,ni)}if(typeof Ft.then=="function")return Zr(bt,ct,Tc(Ft),ni);if(Ft.$$typeof===jt)return Zr(bt,ct,bc(bt,Ft),ni);Wl(bt,Ft)}return typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint"?(Ft=""+Ft,ct!==null&&ct.tag===6?(b(bt,ct.sibling),ni=N(ct,Ft),ni.return=bt,bt=ni):(b(bt,ct),ni=_p(Ft,bt.mode,ni),ni.return=bt,bt=ni),ne(bt)):b(bt,ct)}return function(bt,ct,Ft,ni){try{ku=0;var Tn=Zr(bt,ct,Ft,ni);return zu=null,Tn}catch(dn){if(dn===wd||dn===Ep)throw dn;var jr=fo(29,dn,null,bt.mode);return jr.lanes=ni,jr.return=bt,jr}finally{}}}var Ec=Rp(!0),Mp=Rp(!1),Sc=!1;function Ed(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sd(c,p){c=c.updateQueue,p.updateQueue===c&&(p.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Ac(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function $l(c,p,b){var I=c.updateQueue;if(I===null)return null;if(I=I.shared,(bi&2)!==0){var N=I.pending;return N===null?p.next=p:(p.next=N.next,N.next=p),I.pending=p,p=mh(c),jl(c,null,b),p}return Xc(c,I,p,b),mh(c)}function Ic(c,p,b){if(p=p.updateQueue,p!==null&&(p=p.shared,(b&4194048)!==0)){var I=p.lanes;I&=c.pendingLanes,b|=I,p.lanes=b,se(c,b)}}function Wm(c,p){var b=c.updateQueue,I=c.alternate;if(I!==null&&(I=I.updateQueue,b===I)){var N=null,j=null;if(b=b.firstBaseUpdate,b!==null){do{var ne={lane:b.lane,tag:b.tag,payload:b.payload,callback:null,next:null};j===null?N=j=ne:j=j.next=ne,b=b.next}while(b!==null);j===null?N=j=p:j=j.next=p}else N=j=p;b={baseState:I.baseState,firstBaseUpdate:N,lastBaseUpdate:j,shared:I.shared,callbacks:I.callbacks},c.updateQueue=b;return}c=b.lastBaseUpdate,c===null?b.firstBaseUpdate=p:c.next=p,b.lastBaseUpdate=p}var Cc=!1;function Ad(){if(Cc){var c=ql;if(c!==null)throw c}}function Sf(c,p,b,I){Cc=!1;var N=c.updateQueue;Sc=!1;var j=N.firstBaseUpdate,ne=N.lastBaseUpdate,Te=N.shared.pending;if(Te!==null){N.shared.pending=null;var tt=Te,Nt=tt.next;tt.next=null,ne===null?j=Nt:ne.next=Nt,ne=tt;var Jt=c.alternate;Jt!==null&&(Jt=Jt.updateQueue,Te=Jt.lastBaseUpdate,Te!==ne&&(Te===null?Jt.firstBaseUpdate=Nt:Te.next=Nt,Jt.lastBaseUpdate=tt))}if(j!==null){var ai=N.baseState;ne=0,Jt=Nt=tt=null,Te=j;do{var Vt=Te.lane&-536870913,qt=Vt!==Te.lane;if(qt?(ui&Vt)===Vt:(I&Vt)===Vt){Vt!==0&&Vt===wc&&(Cc=!0),Jt!==null&&(Jt=Jt.next={lane:0,tag:Te.tag,payload:Te.payload,callback:null,next:null});e:{var Ji=c,On=Te;Vt=p;var Zr=b;switch(On.tag){case 1:if(Ji=On.payload,typeof Ji=="function"){ai=Ji.call(Zr,ai,Vt);break e}ai=Ji;break e;case 3:Ji.flags=Ji.flags&-65537|128;case 0:if(Ji=On.payload,Vt=typeof Ji=="function"?Ji.call(Zr,ai,Vt):Ji,Vt==null)break e;ai=ce({},ai,Vt);break e;case 2:Sc=!0}}Vt=Te.callback,Vt!==null&&(c.flags|=64,qt&&(c.flags|=8192),qt=N.callbacks,qt===null?N.callbacks=[Vt]:qt.push(Vt))}else qt={lane:Vt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Jt===null?(Nt=Jt=qt,tt=ai):Jt=Jt.next=qt,ne|=Vt;if(Te=Te.next,Te===null){if(Te=N.shared.pending,Te===null)break;qt=Te,Te=qt.next,qt.next=null,N.lastBaseUpdate=qt,N.shared.pending=null}}while(!0);Jt===null&&(tt=ai),N.baseState=tt,N.firstBaseUpdate=Nt,N.lastBaseUpdate=Jt,j===null&&(N.shared.lanes=0),$n|=ne,c.lanes=ne,c.memoizedState=ai}}function Af(c,p){if(typeof c!="function")throw Error(m(191,c));c.call(p)}function Pp(c,p){var b=c.callbacks;if(b!==null)for(c.callbacks=null,c=0;c<b.length;c++)Af(b[c],p)}var ha=et(null),Nu=et(0);function iu(c,p){c=xn,Oi(Nu,c),Oi(ha,p),xn=c|p.baseLanes}function If(){Oi(Nu,xn),Oi(ha,ha.current)}function Id(){xn=Nu.current,Kt(ha),Kt(Nu)}var Uo=et(null),jo=null;function Zl(c){var p=c.alternate;Oi(Ss,Ss.current&1),Oi(Uo,c),jo===null&&(p===null||ha.current!==null||p.memoizedState!==null)&&(jo=c)}function Dp(c){Oi(Ss,Ss.current),Oi(Uo,c),jo===null&&(jo=c)}function Fu(c){c.tag===22?(Oi(Ss,Ss.current),Oi(Uo,c),jo===null&&(jo=c)):Va()}function Va(){Oi(Ss,Ss.current),Oi(Uo,Uo.current)}function Xt(c){Kt(Uo),jo===c&&(jo=null),Kt(Ss)}var Ss=et(0);function pl(c){for(var p=c;p!==null;){if(p.tag===13){var b=p.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||R_(b)||M_(b)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Go=0,Dn=null,si=null,Os=null,Cf=!1,nu=!1,Rc=!1,wh=0,Rf=0,Th=null,Ny=0;function Ls(){throw Error(m(321))}function qo(c,p){if(p===null)return!1;for(var b=0;b<p.length&&b<c.length;b++)if(!Oa(c[b],p[b]))return!1;return!0}function Mf(c,p,b,I,N,j){return Go=j,Dn=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Pt.H=c===null||c.memoizedState===null?Bp:gs,Rc=!1,j=b(I,N),Rc=!1,nu&&(j=ru(p,b,I,N)),Ro(c),j}function Ro(c){Pt.H=Ch;var p=si!==null&&si.next!==null;if(Go=0,Os=si=Dn=null,Cf=!1,Rf=0,Th=null,p)throw Error(m(300));c===null||Gs||(c=c.dependencies,c!==null&&yd(c)&&(Gs=!0))}function ru(c,p,b,I){Dn=c;var N=0;do{if(nu&&(Th=null),Rf=0,nu=!1,25<=N)throw Error(m(301));if(N+=1,Os=si=null,c.updateQueue!=null){var j=c.updateQueue;j.lastEffect=null,j.events=null,j.stores=null,j.memoCache!=null&&(j.memoCache.index=0)}Pt.H=kd,j=p(b,I)}while(nu);return j}function a_(){var c=Pt.H,p=c.useState()[0];return p=typeof p.then=="function"?Xl(p):p,c=c.useState()[0],(si!==null?si.memoizedState:null)!==c&&(Dn.flags|=1024),p}function Pf(){var c=wh!==0;return wh=0,c}function Df(c,p,b){p.updateQueue=c.updateQueue,p.flags&=-2053,c.lanes&=~b}function Cd(c){if(Cf){for(c=c.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}Cf=!1}Go=0,Os=si=Dn=null,nu=!1,Rf=wh=0,Th=null}function js(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Os===null?Dn.memoizedState=Os=c:Os=Os.next=c,Os}function Wr(){if(si===null){var c=Dn.alternate;c=c!==null?c.memoizedState:null}else c=si.next;var p=Os===null?Dn.memoizedState:Os.next;if(p!==null)Os=p,si=c;else{if(c===null)throw Dn.alternate===null?Error(m(467)):Error(m(310));si=c,c={memoizedState:si.memoizedState,baseState:si.baseState,baseQueue:si.baseQueue,queue:si.queue,next:null},Os===null?Dn.memoizedState=Os=c:Os=Os.next=c}return Os}function Xn(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Xl(c){var p=Rf;return Rf+=1,Th===null&&(Th=[]),c=Ip(Th,c,p),p=Dn,(Os===null?p.memoizedState:Os.next)===null&&(p=p.alternate,Pt.H=p===null||p.memoizedState===null?Bp:gs),c}function Rd(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return Xl(c);if(c.$$typeof===jt)return Co(c)}throw Error(m(438,String(c)))}function Op(c){var p=null,b=Dn.updateQueue;if(b!==null&&(p=b.memoCache),p==null){var I=Dn.alternate;I!==null&&(I=I.updateQueue,I!==null&&(I=I.memoCache,I!=null&&(p={data:I.data.map(function(N){return N.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),b===null&&(b=Xn(),Dn.updateQueue=b),b.memoCache=p,b=p.data[p.index],b===void 0)for(b=p.data[p.index]=Array(c),I=0;I<c;I++)b[I]=ht;return p.index++,b}function Mo(c,p){return typeof p=="function"?p(c):p}function Md(c){var p=Wr();return su(p,si,c)}function su(c,p,b){var I=c.queue;if(I===null)throw Error(m(311));I.lastRenderedReducer=b;var N=c.baseQueue,j=I.pending;if(j!==null){if(N!==null){var ne=N.next;N.next=j.next,j.next=ne}p.baseQueue=N=j,I.pending=null}if(j=c.baseState,N===null)c.memoizedState=j;else{p=N.next;var Te=ne=null,tt=null,Nt=p,Jt=!1;do{var ai=Nt.lane&-536870913;if(ai!==Nt.lane?(ui&ai)===ai:(Go&ai)===ai){var Vt=Nt.revertLane;if(Vt===0)tt!==null&&(tt=tt.next={lane:0,revertLane:0,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null}),ai===wc&&(Jt=!0);else if((Go&Vt)===Vt){Nt=Nt.next,Vt===wc&&(Jt=!0);continue}else ai={lane:0,revertLane:Nt.revertLane,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},tt===null?(Te=tt=ai,ne=j):tt=tt.next=ai,Dn.lanes|=Vt,$n|=Vt;ai=Nt.action,Rc&&b(j,ai),j=Nt.hasEagerState?Nt.eagerState:b(j,ai)}else Vt={lane:ai,revertLane:Nt.revertLane,gesture:Nt.gesture,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},tt===null?(Te=tt=Vt,ne=j):tt=tt.next=Vt,Dn.lanes|=ai,$n|=ai;Nt=Nt.next}while(Nt!==null&&Nt!==p);if(tt===null?ne=j:tt.next=Te,!Oa(j,c.memoizedState)&&(Gs=!0,Jt&&(b=ql,b!==null)))throw b;c.memoizedState=j,c.baseState=ne,c.baseQueue=tt,I.lastRenderedState=j}return N===null&&(I.lanes=0),[c.memoizedState,I.dispatch]}function ou(c){var p=Wr(),b=p.queue;if(b===null)throw Error(m(311));b.lastRenderedReducer=c;var I=b.dispatch,N=b.pending,j=p.memoizedState;if(N!==null){b.pending=null;var ne=N=N.next;do j=c(j,ne.action),ne=ne.next;while(ne!==N);Oa(j,p.memoizedState)||(Gs=!0),p.memoizedState=j,p.baseQueue===null&&(p.baseState=j),b.lastRenderedState=j}return[j,I]}function Bu(c,p,b){var I=Dn,N=Wr(),j=mr;if(j){if(b===void 0)throw Error(m(407));b=b()}else b=p();var ne=!Oa((si||N).memoizedState,b);if(ne&&(N.memoizedState=b,Gs=!0),N=N.queue,Qm(Eh.bind(null,I,N,c),[c]),N.getSnapshot!==p||ne||Os!==null&&Os.memoizedState.tag&1){if(I.flags|=2048,au(9,{destroy:void 0},$t.bind(null,I,N,b,p),null),Ei===null)throw Error(m(349));j||(Go&127)!==0||Lt(I,p,b)}return b}function Lt(c,p,b){c.flags|=16384,c={getSnapshot:p,value:b},p=Dn.updateQueue,p===null?(p=Xn(),Dn.updateQueue=p,p.stores=[c]):(b=p.stores,b===null?p.stores=[c]:b.push(c))}function $t(c,p,b,I){p.value=b,p.getSnapshot=I,Or(p)&&Be(c)}function Eh(c,p,b){return b(function(){Or(p)&&Be(c)})}function Or(c){var p=c.getSnapshot;c=c.value;try{var b=p();return!Oa(c,b)}catch{return!0}}function Be(c){var p=Ul(c,2);p!==null&&Vr(p,c,2)}function Pd(c){var p=js();if(typeof c=="function"){var b=c;if(c=b(),Rc){Vs(!0);try{b()}finally{Vs(!1)}}}return p.memoizedState=p.baseState=c,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:c},p}function Vu(c,p,b,I){return c.baseState=b,su(c,si,typeof I=="function"?I:Mo)}function Lp(c,p,b,I,N){if(os(c))throw Error(m(485));if(c=p.action,c!==null){var j={payload:N,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){j.listeners.push(ne)}};Pt.T!==null?b(!0):j.isTransition=!1,I(j),b=p.pending,b===null?(j.next=p.pending=j,Dd(p,j)):(j.next=b.next,p.pending=b.next=j)}}function Dd(c,p){var b=p.action,I=p.payload,N=c.state;if(p.isTransition){var j=Pt.T,ne={};Pt.T=ne;try{var Te=b(N,I),tt=Pt.S;tt!==null&&tt(ne,Te),$m(c,p,Te)}catch(Nt){Uu(c,p,Nt)}finally{j!==null&&ne.types!==null&&(j.types=ne.types),Pt.T=j}}else try{j=b(N,I),$m(c,p,j)}catch(Nt){Uu(c,p,Nt)}}function $m(c,p,b){b!==null&&typeof b=="object"&&typeof b.then=="function"?b.then(function(I){ml(c,p,I)},function(I){return Uu(c,p,I)}):ml(c,p,b)}function ml(c,p,b){p.status="fulfilled",p.value=b,Zm(p),c.state=b,p=c.pending,p!==null&&(b=p.next,b===p?c.pending=null:(b=b.next,p.next=b,Dd(c,b)))}function Uu(c,p,b){var I=c.pending;if(c.pending=null,I!==null){I=I.next;do p.status="rejected",p.reason=b,Zm(p),p=p.next;while(p!==I)}c.action=null}function Zm(c){c=c.listeners;for(var p=0;p<c.length;p++)(0,c[p])()}function l_(c,p){return p}function Xm(c,p){if(mr){var b=Ei.formState;if(b!==null){e:{var I=Dn;if(mr){if(ss){t:{for(var N=ss,j=ua;N.nodeType!==8;){if(!j){N=null;break t}if(N=qa(N.nextSibling),N===null){N=null;break t}}j=N.data,N=j==="F!"||j==="F"?N:null}if(N){ss=qa(N.nextSibling),I=N.data==="F!";break e}}xc(I)}I=!1}I&&(p=b[0])}}return b=js(),b.memoizedState=b.baseState=p,I={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l_,lastRenderedState:p},b.queue=I,b=Fp.bind(null,Dn,I),I.dispatch=b,I=Pd(!1),j=Gu.bind(null,Dn,!1,I.queue),I=js(),N={state:p,dispatch:null,action:c,pending:null},I.queue=N,b=Lp.bind(null,Dn,N,j,b),N.dispatch=b,I.memoizedState=c,[p,b,!1]}function Of(c){var p=Wr();return zp(p,si,c)}function zp(c,p,b){if(p=su(c,p,l_)[0],c=Md(Mo)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var I=Xl(p)}catch(ne){throw ne===wd?Ep:ne}else I=p;p=Wr();var N=p.queue,j=N.dispatch;return b!==p.memoizedState&&(Dn.flags|=2048,au(9,{destroy:void 0},c_.bind(null,N,b),null)),[I,j,c]}function c_(c,p){c.action=p}function Ym(c){var p=Wr(),b=si;if(b!==null)return zp(p,b,c);Wr(),p=p.memoizedState,b=Wr();var I=b.queue.dispatch;return b.memoizedState=c,[p,I,!1]}function au(c,p,b,I){return c={tag:c,create:b,deps:I,inst:p,next:null},p=Dn.updateQueue,p===null&&(p=Xn(),Dn.updateQueue=p),b=p.lastEffect,b===null?p.lastEffect=c.next=c:(I=b.next,b.next=c,c.next=I,p.lastEffect=c),c}function Od(){return Wr().memoizedState}function lu(c,p,b,I){var N=js();Dn.flags|=c,N.memoizedState=au(1|p,{destroy:void 0},b,I===void 0?null:I)}function Ld(c,p,b,I){var N=Wr();I=I===void 0?null:I;var j=N.memoizedState.inst;si!==null&&I!==null&&qo(I,si.memoizedState.deps)?N.memoizedState=au(p,j,b,I):(Dn.flags|=c,N.memoizedState=au(1|p,j,b,I))}function Km(c,p){lu(8390656,8,c,p)}function Qm(c,p){Ld(2048,8,c,p)}function u_(c){Dn.flags|=4;var p=Dn.updateQueue;if(p===null)p=Xn(),Dn.updateQueue=p,p.events=[c];else{var b=p.events;b===null?p.events=[c]:b.push(c)}}function Jm(c){var p=Wr().memoizedState;return u_({ref:p,nextImpl:c}),function(){if((bi&2)!==0)throw Error(m(440));return p.impl.apply(void 0,arguments)}}function mo(c,p){return Ld(4,2,c,p)}function cu(c,p){return Ld(4,4,c,p)}function Sh(c,p){if(typeof p=="function"){c=c();var b=p(c);return function(){typeof b=="function"?b():p(null)}}if(p!=null)return c=c(),p.current=c,function(){p.current=null}}function dr(c,p,b){b=b!=null?b.concat([c]):null,Ld(4,4,Sh.bind(null,p,c),b)}function pn(){}function eg(c,p){var b=Wr();p=p===void 0?null:p;var I=b.memoizedState;return p!==null&&qo(p,I[1])?I[0]:(b.memoizedState=[c,p],c)}function uu(c,p){var b=Wr();p=p===void 0?null:p;var I=b.memoizedState;if(p!==null&&qo(p,I[1]))return I[0];if(I=c(),Rc){Vs(!0);try{c()}finally{Vs(!1)}}return b.memoizedState=[I,p],I}function hu(c,p,b){return b===void 0||(Go&1073741824)!==0&&(ui&261930)===0?c.memoizedState=p:(c.memoizedState=b,c=is(),Dn.lanes|=c,$n|=c,b)}function ju(c,p,b,I){return Oa(b,p)?b:ha.current!==null?(c=hu(c,b,I),Oa(c,p)||(Gs=!0),c):(Go&42)===0||(Go&1073741824)!==0&&(ui&261930)===0?(Gs=!0,c.memoizedState=b):(c=is(),Dn.lanes|=c,$n|=c,p)}function du(c,p,b,I,N){var j=Si.p;Si.p=j!==0&&8>j?j:8;var ne=Pt.T,Te={};Pt.T=Te,Gu(c,!1,p,b);try{var tt=N(),Nt=Pt.S;if(Nt!==null&&Nt(Te,tt),tt!==null&&typeof tt=="object"&&typeof tt.then=="function"){var Jt=Gm(tt,I);da(c,p,Jt,Sr(c))}else da(c,p,I,Sr(c))}catch(ai){da(c,p,{then:function(){},status:"rejected",reason:ai},Sr())}finally{Si.p=j,ne!==null&&Te.types!==null&&(ne.types=Te.types),Pt.T=ne}}function tg(){}function zd(c,p,b,I){if(c.tag!==5)throw Error(m(476));var N=kp(c).queue;du(c,N,p,fn,b===null?tg:function(){return Lf(c),b(I)})}function kp(c){var p=c.memoizedState;if(p!==null)return p;p={memoizedState:fn,baseState:fn,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:fn},next:null};var b={};return p.next={memoizedState:b,baseState:b,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:b},next:null},c.memoizedState=p,c=c.alternate,c!==null&&(c.memoizedState=p),p}function Lf(c){var p=kp(c);p.next===null&&(p=c.alternate.memoizedState),da(c,p.next.queue,{},Sr())}function Po(){return Co(Gh)}function fu(){return Wr().memoizedState}function Ah(){return Wr().memoizedState}function Np(c){for(var p=c.return;p!==null;){switch(p.tag){case 24:case 3:var b=Sr();c=Ac(b);var I=$l(p,c,b);I!==null&&(Vr(I,p,b),Ic(I,p,b)),p={cache:vd()},c.payload=p;return}p=p.return}}function ig(c,p,b){var I=Sr();b={lane:I,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},os(c)?Ih(p,b):(b=ph(c,p,b,I),b!==null&&(Vr(b,c,I),zf(b,p,I)))}function Fp(c,p,b){var I=Sr();da(c,p,b,I)}function da(c,p,b,I){var N={lane:I,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null};if(os(c))Ih(p,N);else{var j=c.alternate;if(c.lanes===0&&(j===null||j.lanes===0)&&(j=p.lastRenderedReducer,j!==null))try{var ne=p.lastRenderedState,Te=j(ne,b);if(N.hasEagerState=!0,N.eagerState=Te,Oa(Te,ne))return Xc(c,p,N,0),Ei===null&&Zc(),!1}catch{}finally{}if(b=ph(c,p,N,I),b!==null)return Vr(b,c,I),zf(b,p,I),!0}return!1}function Gu(c,p,b,I){if(I={lane:2,revertLane:b_(),gesture:null,action:I,hasEagerState:!1,eagerState:null,next:null},os(c)){if(p)throw Error(m(479))}else p=ph(c,b,I,2),p!==null&&Vr(p,c,2)}function os(c){var p=c.alternate;return c===Dn||p!==null&&p===Dn}function Ih(c,p){nu=Cf=!0;var b=c.pending;b===null?p.next=p:(p.next=b.next,b.next=p),c.pending=p}function zf(c,p,b){if((b&4194048)!==0){var I=p.lanes;I&=c.pendingLanes,b|=I,p.lanes=b,se(c,b)}}var Ch={readContext:Co,use:Rd,useCallback:Ls,useContext:Ls,useEffect:Ls,useImperativeHandle:Ls,useLayoutEffect:Ls,useInsertionEffect:Ls,useMemo:Ls,useReducer:Ls,useRef:Ls,useState:Ls,useDebugValue:Ls,useDeferredValue:Ls,useTransition:Ls,useSyncExternalStore:Ls,useId:Ls,useHostTransitionStatus:Ls,useFormState:Ls,useActionState:Ls,useOptimistic:Ls,useMemoCache:Ls,useCacheRefresh:Ls};Ch.useEffectEvent=Ls;var Bp={readContext:Co,use:Rd,useCallback:function(c,p){return js().memoizedState=[c,p===void 0?null:p],c},useContext:Co,useEffect:Km,useImperativeHandle:function(c,p,b){b=b!=null?b.concat([c]):null,lu(4194308,4,Sh.bind(null,p,c),b)},useLayoutEffect:function(c,p){return lu(4194308,4,c,p)},useInsertionEffect:function(c,p){lu(4,2,c,p)},useMemo:function(c,p){var b=js();p=p===void 0?null:p;var I=c();if(Rc){Vs(!0);try{c()}finally{Vs(!1)}}return b.memoizedState=[I,p],I},useReducer:function(c,p,b){var I=js();if(b!==void 0){var N=b(p);if(Rc){Vs(!0);try{b(p)}finally{Vs(!1)}}}else N=p;return I.memoizedState=I.baseState=N,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:N},I.queue=c,c=c.dispatch=ig.bind(null,Dn,c),[I.memoizedState,c]},useRef:function(c){var p=js();return c={current:c},p.memoizedState=c},useState:function(c){c=Pd(c);var p=c.queue,b=Fp.bind(null,Dn,p);return p.dispatch=b,[c.memoizedState,b]},useDebugValue:pn,useDeferredValue:function(c,p){var b=js();return hu(b,c,p)},useTransition:function(){var c=Pd(!1);return c=du.bind(null,Dn,c.queue,!0,!1),js().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,p,b){var I=Dn,N=js();if(mr){if(b===void 0)throw Error(m(407));b=b()}else{if(b=p(),Ei===null)throw Error(m(349));(ui&127)!==0||Lt(I,p,b)}N.memoizedState=b;var j={value:b,getSnapshot:p};return N.queue=j,Km(Eh.bind(null,I,j,c),[c]),I.flags|=2048,au(9,{destroy:void 0},$t.bind(null,I,j,b,p),null),b},useId:function(){var c=js(),p=Ei.identifierPrefix;if(mr){var b=hl,I=ka;b=(I&~(1<<32-Yr(I)-1)).toString(32)+b,p="_"+p+"R_"+b,b=wh++,0<b&&(p+="H"+b.toString(32)),p+="_"}else b=Ny++,p="_"+p+"r_"+b.toString(32)+"_";return c.memoizedState=p},useHostTransitionStatus:Po,useFormState:Xm,useActionState:Xm,useOptimistic:function(c){var p=js();p.memoizedState=p.baseState=c;var b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=b,p=Gu.bind(null,Dn,!0,b),b.dispatch=p,[c,p]},useMemoCache:Op,useCacheRefresh:function(){return js().memoizedState=Np.bind(null,Dn)},useEffectEvent:function(c){var p=js(),b={impl:c};return p.memoizedState=b,function(){if((bi&2)!==0)throw Error(m(440));return b.impl.apply(void 0,arguments)}}},gs={readContext:Co,use:Rd,useCallback:eg,useContext:Co,useEffect:Qm,useImperativeHandle:dr,useInsertionEffect:mo,useLayoutEffect:cu,useMemo:uu,useReducer:Md,useRef:Od,useState:function(){return Md(Mo)},useDebugValue:pn,useDeferredValue:function(c,p){var b=Wr();return ju(b,si.memoizedState,c,p)},useTransition:function(){var c=Md(Mo)[0],p=Wr().memoizedState;return[typeof c=="boolean"?c:Xl(c),p]},useSyncExternalStore:Bu,useId:fu,useHostTransitionStatus:Po,useFormState:Of,useActionState:Of,useOptimistic:function(c,p){var b=Wr();return Vu(b,si,c,p)},useMemoCache:Op,useCacheRefresh:Ah};gs.useEffectEvent=Jm;var kd={readContext:Co,use:Rd,useCallback:eg,useContext:Co,useEffect:Qm,useImperativeHandle:dr,useInsertionEffect:mo,useLayoutEffect:cu,useMemo:uu,useReducer:ou,useRef:Od,useState:function(){return ou(Mo)},useDebugValue:pn,useDeferredValue:function(c,p){var b=Wr();return si===null?hu(b,c,p):ju(b,si.memoizedState,c,p)},useTransition:function(){var c=ou(Mo)[0],p=Wr().memoizedState;return[typeof c=="boolean"?c:Xl(c),p]},useSyncExternalStore:Bu,useId:fu,useHostTransitionStatus:Po,useFormState:Ym,useActionState:Ym,useOptimistic:function(c,p){var b=Wr();return si!==null?Vu(b,si,c,p):(b.baseState=c,[c,b.queue.dispatch])},useMemoCache:Op,useCacheRefresh:Ah};kd.useEffectEvent=Jm;function kf(c,p,b,I){p=c.memoizedState,b=b(I,p),b=b==null?p:ce({},p,b),c.memoizedState=b,c.lanes===0&&(c.updateQueue.baseState=b)}var Rh={enqueueSetState:function(c,p,b){c=c._reactInternals;var I=Sr(),N=Ac(I);N.payload=p,b!=null&&(N.callback=b),p=$l(c,N,I),p!==null&&(Vr(p,c,I),Ic(p,c,I))},enqueueReplaceState:function(c,p,b){c=c._reactInternals;var I=Sr(),N=Ac(I);N.tag=1,N.payload=p,b!=null&&(N.callback=b),p=$l(c,N,I),p!==null&&(Vr(p,c,I),Ic(p,c,I))},enqueueForceUpdate:function(c,p){c=c._reactInternals;var b=Sr(),I=Ac(b);I.tag=2,p!=null&&(I.callback=p),p=$l(c,I,b),p!==null&&(Vr(p,c,b),Ic(p,c,b))}};function qu(c,p,b,I,N,j,ne){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(I,j,ne):p.prototype&&p.prototype.isPureReactComponent?!Iu(b,I)||!Iu(N,j):!0}function Vp(c,p,b,I){c=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(b,I),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(b,I),p.state!==c&&Rh.enqueueReplaceState(p,p.state,null)}function Mc(c,p){var b=p;if("ref"in p){b={};for(var I in p)I!=="ref"&&(b[I]=p[I])}if(c=c.defaultProps){b===p&&(b=ce({},b));for(var N in c)b[N]===void 0&&(b[N]=c[N])}return b}function Nd(c){Vo(c)}function Mh(c){console.error(c)}function Nf(c){Vo(c)}function Ph(c,p){try{var b=c.onUncaughtError;b(p.value,{componentStack:p.stack})}catch(I){setTimeout(function(){throw I})}}function Up(c,p,b){try{var I=c.onCaughtError;I(b.value,{componentStack:b.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function Hu(c,p,b){return b=Ac(b),b.tag=3,b.payload={element:null},b.callback=function(){Ph(c,p)},b}function Dh(c){return c=Ac(c),c.tag=3,c}function Ff(c,p,b,I){var N=b.type.getDerivedStateFromError;if(typeof N=="function"){var j=I.value;c.payload=function(){return N(j)},c.callback=function(){Up(p,b,I)}}var ne=b.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(c.callback=function(){Up(p,b,I),typeof N!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var Te=I.stack;this.componentDidCatch(I.value,{componentStack:Te!==null?Te:""})})}function h_(c,p,b,I,N){if(b.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){if(p=b.alternate,p!==null&&Fa(p,b,N,!0),b=Uo.current,b!==null){switch(b.tag){case 31:case 13:return jo===null?ao():b.alternate===null&&Qi===0&&(Qi=3),b.flags&=-257,b.flags|=65536,b.lanes=N,I===Sp?b.flags|=16384:(p=b.updateQueue,p===null?b.updateQueue=new Set([I]):p.add(I),qp(c,I,N)),!1;case 22:return b.flags|=65536,I===Sp?b.flags|=16384:(p=b.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([I])},b.updateQueue=p):(b=p.retryQueue,b===null?p.retryQueue=new Set([I]):b.add(I)),qp(c,I,N)),!1}throw Error(m(435,b.tag))}return qp(c,I,N),ao(),!1}if(mr)return p=Uo.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=N,I!==pd&&(c=Error(m(422),{cause:I}),dl(cl(c,b)))):(I!==pd&&(p=Error(m(423),{cause:I}),dl(cl(p,b))),c=c.current.alternate,c.flags|=65536,N&=-N,c.lanes|=N,I=cl(I,b),N=Hu(c.stateNode,I,N),Wm(c,N),Qi!==4&&(Qi=2)),!1;var j=Error(m(520),{cause:I});if(j=cl(j,b),Ci===null?Ci=[j]:Ci.push(j),Qi!==4&&(Qi=2),p===null)return!0;I=cl(I,b),b=p;do{switch(b.tag){case 3:return b.flags|=65536,c=N&-N,b.lanes|=c,c=Hu(b.stateNode,I,c),Wm(b,c),!1;case 1:if(p=b.type,j=b.stateNode,(b.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(Js===null||!Js.has(j))))return b.flags|=65536,N&=-N,b.lanes|=N,N=Dh(N),Ff(N,c,b,I),Wm(b,N),!1}b=b.return}while(b!==null);return!1}var Bf=Error(m(461)),Gs=!1;function Qs(c,p,b,I){p.child=c===null?Mp(p,null,b,I):Ec(p,c.child,b,I)}function ng(c,p,b,I,N){b=b.render;var j=p.ref;if("ref"in I){var ne={};for(var Te in I)Te!=="ref"&&(ne[Te]=I[Te])}else ne=I;return Qc(p),I=Mf(c,p,b,ne,j,N),Te=Pf(),c!==null&&!Gs?(Df(c,p,N),go(c,p,N)):(mr&&Te&&dd(p),p.flags|=1,Qs(c,p,I,N),p.child)}function rg(c,p,b,I,N){if(c===null){var j=b.type;return typeof j=="function"&&!Vm(j)&&j.defaultProps===void 0&&b.compare===null?(p.tag=15,p.type=j,sg(c,p,j,I,N)):(c=gp(b.type,null,I,p,p.mode,N),c.ref=p.ref,c.return=p,p.child=c)}if(j=c.child,!kh(c,N)){var ne=j.memoizedProps;if(b=b.compare,b=b!==null?b:Iu,b(ne,I)&&c.ref===p.ref)return go(c,p,N)}return p.flags|=1,c=Yc(j,I),c.ref=p.ref,c.return=p,p.child=c}function sg(c,p,b,I,N){if(c!==null){var j=c.memoizedProps;if(Iu(j,I)&&c.ref===p.ref)if(Gs=!1,p.pendingProps=I=j,kh(c,N))(c.flags&131072)!==0&&(Gs=!0);else return p.lanes=c.lanes,go(c,p,N)}return cg(c,p,b,I,N)}function og(c,p,b,I){var N=I.children,j=c!==null?c.memoizedState:null;if(c===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),I.mode==="hidden"){if((p.flags&128)!==0){if(j=j!==null?j.baseLanes|b:b,c!==null){for(I=p.child=c.child,N=0;I!==null;)N=N|I.lanes|I.childLanes,I=I.sibling;I=N&~j}else I=0,p.child=null;return ag(c,p,j,b,I)}if((b&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},c!==null&&Tp(p,j!==null?j.cachePool:null),j!==null?iu(p,j):If(),Fu(p);else return I=p.lanes=536870912,ag(c,p,j!==null?j.baseLanes|b:b,b,I)}else j!==null?(Tp(p,j.cachePool),iu(p,j),Va(),p.memoizedState=null):(c!==null&&Tp(p,null),If(),Va());return Qs(c,p,N,b),p.child}function Oh(c,p){return c!==null&&c.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function ag(c,p,b,I,N){var j=eu();return j=j===null?null:{parent:bs._currentValue,pool:j},p.memoizedState={baseLanes:b,cachePool:j},c!==null&&Tp(p,null),If(),Fu(p),c!==null&&Fa(c,p,I,!0),p.childLanes=N,null}function Vf(c,p){return p=Ud({mode:p.mode,children:p.children},c.mode),p.ref=c.ref,c.child=p,p.return=c,p}function lg(c,p,b){return Ec(p,c.child,null,b),c=Vf(p,p.pendingProps),c.flags|=2,Xt(p),p.memoizedState=null,c}function d_(c,p,b){var I=p.pendingProps,N=(p.flags&128)!==0;if(p.flags&=-129,c===null){if(mr){if(I.mode==="hidden")return c=Vf(p,I),p.lanes=536870912,Oh(null,c);if(Dp(p),(c=ss)?(c=Aa(c,ua),c=c!==null&&c.data==="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:vc!==null?{id:ka,overflow:hl}:null,retryLane:536870912,hydrationErrors:null},b=yp(c),b.return=p,p.child=b,po=p,ss=null)):c=null,c===null)throw xc(p);return p.lanes=536870912,null}return Vf(p,I)}var j=c.memoizedState;if(j!==null){var ne=j.dehydrated;if(Dp(p),N)if(p.flags&256)p.flags&=-257,p=lg(c,p,b);else if(p.memoizedState!==null)p.child=c.child,p.flags|=128,p=null;else throw Error(m(558));else if(Gs||Fa(c,p,b,!1),N=(b&c.childLanes)!==0,Gs||N){if(I=Ei,I!==null&&(ne=me(I,b),ne!==0&&ne!==j.retryLane))throw j.retryLane=ne,Ul(c,ne),Vr(I,c,ne),Bf;ao(),p=lg(c,p,b)}else c=j.treeContext,ss=qa(ne.nextSibling),po=p,mr=!0,Na=null,ua=!1,c!==null&&yh(p,c),p=Vf(p,I),p.flags|=4096;return p}return c=Yc(c.child,{mode:I.mode,children:I.children}),c.ref=p.ref,p.child=c,c.return=p,c}function jp(c,p){var b=p.ref;if(b===null)c!==null&&c.ref!==null&&(p.flags|=4194816);else{if(typeof b!="function"&&typeof b!="object")throw Error(m(284));(c===null||c.ref!==b)&&(p.flags|=4194816)}}function cg(c,p,b,I,N){return Qc(p),b=Mf(c,p,b,I,void 0,N),I=Pf(),c!==null&&!Gs?(Df(c,p,N),go(c,p,N)):(mr&&I&&dd(p),p.flags|=1,Qs(c,p,b,N),p.child)}function f_(c,p,b,I,N,j){return Qc(p),p.updateQueue=null,b=ru(p,I,b,N),Ro(c),I=Pf(),c!==null&&!Gs?(Df(c,p,j),go(c,p,j)):(mr&&I&&dd(p),p.flags|=1,Qs(c,p,b,j),p.child)}function Er(c,p,b,I,N){if(Qc(p),p.stateNode===null){var j=Io,ne=b.contextType;typeof ne=="object"&&ne!==null&&(j=Co(ne)),j=new b(I,j),p.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,j.updater=Rh,p.stateNode=j,j._reactInternals=p,j=p.stateNode,j.props=I,j.state=p.memoizedState,j.refs={},Ed(p),ne=b.contextType,j.context=typeof ne=="object"&&ne!==null?Co(ne):Io,j.state=p.memoizedState,ne=b.getDerivedStateFromProps,typeof ne=="function"&&(kf(p,b,ne,I),j.state=p.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(ne=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),ne!==j.state&&Rh.enqueueReplaceState(j,j.state,null),Sf(p,I,j,N),Ad(),j.state=p.memoizedState),typeof j.componentDidMount=="function"&&(p.flags|=4194308),I=!0}else if(c===null){j=p.stateNode;var Te=p.memoizedProps,tt=Mc(b,Te);j.props=tt;var Nt=j.context,Jt=b.contextType;ne=Io,typeof Jt=="object"&&Jt!==null&&(ne=Co(Jt));var ai=b.getDerivedStateFromProps;Jt=typeof ai=="function"||typeof j.getSnapshotBeforeUpdate=="function",Te=p.pendingProps!==Te,Jt||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(Te||Nt!==ne)&&Vp(p,j,I,ne),Sc=!1;var Vt=p.memoizedState;j.state=Vt,Sf(p,I,j,N),Ad(),Nt=p.memoizedState,Te||Vt!==Nt||Sc?(typeof ai=="function"&&(kf(p,b,ai,I),Nt=p.memoizedState),(tt=Sc||qu(p,b,tt,I,Vt,Nt,ne))?(Jt||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(p.flags|=4194308)):(typeof j.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=I,p.memoizedState=Nt),j.props=I,j.state=Nt,j.context=ne,I=tt):(typeof j.componentDidMount=="function"&&(p.flags|=4194308),I=!1)}else{j=p.stateNode,Sd(c,p),ne=p.memoizedProps,Jt=Mc(b,ne),j.props=Jt,ai=p.pendingProps,Vt=j.context,Nt=b.contextType,tt=Io,typeof Nt=="object"&&Nt!==null&&(tt=Co(Nt)),Te=b.getDerivedStateFromProps,(Nt=typeof Te=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(ne!==ai||Vt!==tt)&&Vp(p,j,I,tt),Sc=!1,Vt=p.memoizedState,j.state=Vt,Sf(p,I,j,N),Ad();var qt=p.memoizedState;ne!==ai||Vt!==qt||Sc||c!==null&&c.dependencies!==null&&yd(c.dependencies)?(typeof Te=="function"&&(kf(p,b,Te,I),qt=p.memoizedState),(Jt=Sc||qu(p,b,Jt,I,Vt,qt,tt)||c!==null&&c.dependencies!==null&&yd(c.dependencies))?(Nt||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(I,qt,tt),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(I,qt,tt)),typeof j.componentDidUpdate=="function"&&(p.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof j.componentDidUpdate!="function"||ne===c.memoizedProps&&Vt===c.memoizedState||(p.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||ne===c.memoizedProps&&Vt===c.memoizedState||(p.flags|=1024),p.memoizedProps=I,p.memoizedState=qt),j.props=I,j.state=qt,j.context=tt,I=Jt):(typeof j.componentDidUpdate!="function"||ne===c.memoizedProps&&Vt===c.memoizedState||(p.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||ne===c.memoizedProps&&Vt===c.memoizedState||(p.flags|=1024),I=!1)}return j=I,jp(c,p),I=(p.flags&128)!==0,j||I?(j=p.stateNode,b=I&&typeof b.getDerivedStateFromError!="function"?null:j.render(),p.flags|=1,c!==null&&I?(p.child=Ec(p,c.child,null,N),p.child=Ec(p,null,b,N)):Qs(c,p,b,N),p.memoizedState=j.state,c=p.child):c=go(c,p,N),c}function Fd(c,p,b,I){return Pu(),p.flags|=256,Qs(c,p,b,I),p.child}var ug={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function hg(c){return{baseLanes:c,cachePool:o_()}}function Bd(c,p,b){return c=c!==null?c.childLanes&~b:0,p&&(c|=zn),c}function Vd(c,p,b){var I=p.pendingProps,N=!1,j=(p.flags&128)!==0,ne;if((ne=j)||(ne=c!==null&&c.memoizedState===null?!1:(Ss.current&2)!==0),ne&&(N=!0,p.flags&=-129),ne=(p.flags&32)!==0,p.flags&=-33,c===null){if(mr){if(N?Zl(p):Va(),(c=ss)?(c=Aa(c,ua),c=c!==null&&c.data!=="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:vc!==null?{id:ka,overflow:hl}:null,retryLane:536870912,hydrationErrors:null},b=yp(c),b.return=p,p.child=b,po=p,ss=null)):c=null,c===null)throw xc(p);return M_(c)?p.lanes=32:p.lanes=536870912,null}var Te=I.children;return I=I.fallback,N?(Va(),N=p.mode,Te=Ud({mode:"hidden",children:Te},N),I=or(I,N,b,null),Te.return=p,I.return=p,Te.sibling=I,p.child=Te,I=p.child,I.memoizedState=hg(b),I.childLanes=Bd(c,ne,b),p.memoizedState=ug,Oh(null,I)):(Zl(p),Uf(p,Te))}var tt=c.memoizedState;if(tt!==null&&(Te=tt.dehydrated,Te!==null)){if(j)p.flags&256?(Zl(p),p.flags&=-257,p=Lh(c,p,b)):p.memoizedState!==null?(Va(),p.child=c.child,p.flags|=128,p=null):(Va(),Te=I.fallback,N=p.mode,I=Ud({mode:"visible",children:I.children},N),Te=or(Te,N,b,null),Te.flags|=2,I.return=p,Te.return=p,I.sibling=Te,p.child=I,Ec(p,c.child,null,b),I=p.child,I.memoizedState=hg(b),I.childLanes=Bd(c,ne,b),p.memoizedState=ug,p=Oh(null,I));else if(Zl(p),M_(Te)){if(ne=Te.nextSibling&&Te.nextSibling.dataset,ne)var Nt=ne.dgst;ne=Nt,I=Error(m(419)),I.stack="",I.digest=ne,dl({value:I,source:null,stack:null}),p=Lh(c,p,b)}else if(Gs||Fa(c,p,b,!1),ne=(b&c.childLanes)!==0,Gs||ne){if(ne=Ei,ne!==null&&(I=me(ne,b),I!==0&&I!==tt.retryLane))throw tt.retryLane=I,Ul(c,I),Vr(ne,c,I),Bf;R_(Te)||ao(),p=Lh(c,p,b)}else R_(Te)?(p.flags|=192,p.child=c.child,p=null):(c=tt.treeContext,ss=qa(Te.nextSibling),po=p,mr=!0,Na=null,ua=!1,c!==null&&yh(p,c),p=Uf(p,I.children),p.flags|=4096);return p}return N?(Va(),Te=I.fallback,N=p.mode,tt=c.child,Nt=tt.sibling,I=Yc(tt,{mode:"hidden",children:I.children}),I.subtreeFlags=tt.subtreeFlags&65011712,Nt!==null?Te=Yc(Nt,Te):(Te=or(Te,N,b,null),Te.flags|=2),Te.return=p,I.return=p,I.sibling=Te,p.child=I,Oh(null,I),I=p.child,Te=c.child.memoizedState,Te===null?Te=hg(b):(N=Te.cachePool,N!==null?(tt=bs._currentValue,N=N.parent!==tt?{parent:tt,pool:tt}:N):N=o_(),Te={baseLanes:Te.baseLanes|b,cachePool:N}),I.memoizedState=Te,I.childLanes=Bd(c,ne,b),p.memoizedState=ug,Oh(c.child,I)):(Zl(p),b=c.child,c=b.sibling,b=Yc(b,{mode:"visible",children:I.children}),b.return=p,b.sibling=null,c!==null&&(ne=p.deletions,ne===null?(p.deletions=[c],p.flags|=16):ne.push(c)),p.child=b,p.memoizedState=null,b)}function Uf(c,p){return p=Ud({mode:"visible",children:p},c.mode),p.return=c,c.child=p}function Ud(c,p){return c=fo(22,c,null,p),c.lanes=0,c}function Lh(c,p,b){return Ec(p,c.child,null,b),c=Uf(p,p.pendingProps.children),c.flags|=2,p.memoizedState=null,c}function Yl(c,p,b){c.lanes|=p;var I=c.alternate;I!==null&&(I.lanes|=p),gd(c.return,p,b)}function zh(c,p,b,I,N,j){var ne=c.memoizedState;ne===null?c.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:I,tail:b,tailMode:N,treeForkCount:j}:(ne.isBackwards=p,ne.rendering=null,ne.renderingStartTime=0,ne.last=I,ne.tail=b,ne.tailMode=N,ne.treeForkCount=j)}function ts(c,p,b){var I=p.pendingProps,N=I.revealOrder,j=I.tail;I=I.children;var ne=Ss.current,Te=(ne&2)!==0;if(Te?(ne=ne&1|2,p.flags|=128):ne&=1,Oi(Ss,ne),Qs(c,p,I,b),I=mr?Mu:0,!Te&&c!==null&&(c.flags&128)!==0)e:for(c=p.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Yl(c,b,p);else if(c.tag===19)Yl(c,b,p);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===p)break e;for(;c.sibling===null;){if(c.return===null||c.return===p)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(N){case"forwards":for(b=p.child,N=null;b!==null;)c=b.alternate,c!==null&&pl(c)===null&&(N=b),b=b.sibling;b=N,b===null?(N=p.child,p.child=null):(N=b.sibling,b.sibling=null),zh(p,!1,N,b,j,I);break;case"backwards":case"unstable_legacy-backwards":for(b=null,N=p.child,p.child=null;N!==null;){if(c=N.alternate,c!==null&&pl(c)===null){p.child=N;break}c=N.sibling,N.sibling=b,b=N,N=c}zh(p,!0,b,null,j,I);break;case"together":zh(p,!1,null,null,void 0,I);break;default:p.memoizedState=null}return p.child}function go(c,p,b){if(c!==null&&(p.dependencies=c.dependencies),$n|=p.lanes,(b&p.childLanes)===0)if(c!==null){if(Fa(c,p,b,!1),(b&p.childLanes)===0)return null}else return null;if(c!==null&&p.child!==c.child)throw Error(m(153));if(p.child!==null){for(c=p.child,b=Yc(c,c.pendingProps),p.child=b,b.return=p;c.sibling!==null;)c=c.sibling,b=b.sibling=Yc(c,c.pendingProps),b.return=p;b.sibling=null}return p.child}function kh(c,p){return(c.lanes&p)!==0?!0:(c=c.dependencies,!!(c!==null&&yd(c)))}function jf(c,p,b){switch(p.tag){case 3:cn(p,p.stateNode.containerInfo),Ou(p,bs,c.memoizedState.cache),Pu();break;case 27:case 5:ur(p);break;case 4:cn(p,p.stateNode.containerInfo);break;case 10:Ou(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,Dp(p),null;break;case 13:var I=p.memoizedState;if(I!==null)return I.dehydrated!==null?(Zl(p),p.flags|=128,null):(b&p.child.childLanes)!==0?Vd(c,p,b):(Zl(p),c=go(c,p,b),c!==null?c.sibling:null);Zl(p);break;case 19:var N=(c.flags&128)!==0;if(I=(b&p.childLanes)!==0,I||(Fa(c,p,b,!1),I=(b&p.childLanes)!==0),N){if(I)return ts(c,p,b);p.flags|=128}if(N=p.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Oi(Ss,Ss.current),I)break;return null;case 22:return p.lanes=0,og(c,p,b,p.pendingProps);case 24:Ou(p,bs,c.memoizedState.cache)}return go(c,p,b)}function dg(c,p,b){if(c!==null)if(c.memoizedProps!==p.pendingProps)Gs=!0;else{if(!kh(c,b)&&(p.flags&128)===0)return Gs=!1,jf(c,p,b);Gs=(c.flags&131072)!==0}else Gs=!1,mr&&(p.flags&1048576)!==0&&_h(p,Mu,p.index);switch(p.lanes=0,p.tag){case 16:e:{var I=p.pendingProps;if(c=tu(p.elementType),p.type=c,typeof c=="function")Vm(c)?(I=Mc(c,I),p.tag=1,p=Er(null,p,c,I,b)):(p.tag=0,p=cg(null,p,c,I,b));else{if(c!=null){var N=c.$$typeof;if(N===wi){p.tag=11,p=ng(null,p,c,I,b);break e}else if(N===Ve){p.tag=14,p=rg(null,p,c,I,b);break e}}throw p=Cn(c)||c,Error(m(306,p,""))}}return p;case 0:return cg(c,p,p.type,p.pendingProps,b);case 1:return I=p.type,N=Mc(I,p.pendingProps),Er(c,p,I,N,b);case 3:e:{if(cn(p,p.stateNode.containerInfo),c===null)throw Error(m(387));I=p.pendingProps;var j=p.memoizedState;N=j.element,Sd(c,p),Sf(p,I,null,b);var ne=p.memoizedState;if(I=ne.cache,Ou(p,bs,I),I!==j.cache&&_d(p,[bs],b,!0),Ad(),I=ne.element,j.isDehydrated)if(j={element:I,isDehydrated:!1,cache:ne.cache},p.updateQueue.baseState=j,p.memoizedState=j,p.flags&256){p=Fd(c,p,I,b);break e}else if(I!==N){N=cl(Error(m(424)),p),dl(N),p=Fd(c,p,I,b);break e}else{switch(c=p.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(ss=qa(c.firstChild),po=p,mr=!0,Na=null,ua=!0,b=Mp(p,null,I,b),p.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling}else{if(Pu(),I===N){p=go(c,p,b);break e}Qs(c,p,I,b)}p=p.child}return p;case 26:return jp(c,p),c===null?(b=Zp(p.type,null,p.pendingProps,null))?p.memoizedState=b:mr||(b=p.type,c=p.pendingProps,I=Vh(Qt.current).createElement(b),I[Xe]=p,I[At]=c,Do(I,b,c),Gn(I),p.stateNode=I):p.memoizedState=Zp(p.type,c.memoizedProps,p.pendingProps,c.memoizedState),null;case 27:return ur(p),c===null&&mr&&(I=p.stateNode=nv(p.type,p.pendingProps,Qt.current),po=p,ua=!0,N=ss,Uh(p.type)?(iv=N,ss=qa(I.firstChild)):ss=N),Qs(c,p,p.pendingProps.children,b),jp(c,p),c===null&&(p.flags|=4194304),p.child;case 5:return c===null&&mr&&((N=I=ss)&&(I=jh(I,p.type,p.pendingProps,ua),I!==null?(p.stateNode=I,po=p,ss=qa(I.firstChild),ua=!1,N=!0):N=!1),N||xc(p)),ur(p),N=p.type,j=p.pendingProps,ne=c!==null?c.memoizedProps:null,I=j.children,$p(N,j)?I=null:ne!==null&&$p(N,ne)&&(p.flags|=32),p.memoizedState!==null&&(N=Mf(c,p,a_,null,null,b),Gh._currentValue=N),jp(c,p),Qs(c,p,I,b),p.child;case 6:return c===null&&mr&&((c=b=ss)&&(b=T1(b,p.pendingProps,ua),b!==null?(p.stateNode=b,po=p,ss=null,c=!0):c=!1),c||xc(p)),null;case 13:return Vd(c,p,b);case 4:return cn(p,p.stateNode.containerInfo),I=p.pendingProps,c===null?p.child=Ec(p,null,I,b):Qs(c,p,I,b),p.child;case 11:return ng(c,p,p.type,p.pendingProps,b);case 7:return Qs(c,p,p.pendingProps,b),p.child;case 8:return Qs(c,p,p.pendingProps.children,b),p.child;case 12:return Qs(c,p,p.pendingProps.children,b),p.child;case 10:return I=p.pendingProps,Ou(p,p.type,I.value),Qs(c,p,I.children,b),p.child;case 9:return N=p.type._context,I=p.pendingProps.children,Qc(p),N=Co(N),I=I(N),p.flags|=1,Qs(c,p,I,b),p.child;case 14:return rg(c,p,p.type,p.pendingProps,b);case 15:return sg(c,p,p.type,p.pendingProps,b);case 19:return ts(c,p,b);case 31:return d_(c,p,b);case 22:return og(c,p,b,p.pendingProps);case 24:return Qc(p),I=Co(bs),c===null?(N=eu(),N===null&&(N=Ei,j=vd(),N.pooledCache=j,j.refCount++,j!==null&&(N.pooledCacheLanes|=b),N=j),p.memoizedState={parent:I,cache:N},Ed(p),Ou(p,bs,N)):((c.lanes&b)!==0&&(Sd(c,p),Sf(p,null,null,b),Ad()),N=c.memoizedState,j=p.memoizedState,N.parent!==I?(N={parent:I,cache:I},p.memoizedState=N,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=N),Ou(p,bs,I)):(I=j.cache,Ou(p,bs,I),I!==N.cache&&_d(p,[bs],b,!0))),Qs(c,p,p.pendingProps.children,b),p.child;case 29:throw p.pendingProps}throw Error(m(156,p.tag))}function pu(c){c.flags|=4}function Nh(c,p,b,I,N){if((p=(c.mode&32)!==0)&&(p=!1),p){if(c.flags|=16777216,(N&335544128)===N)if(c.stateNode.complete)c.flags|=8192;else if(tc())c.flags|=8192;else throw fl=Sp,Td}else c.flags&=-16777217}function p_(c,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!N_(p))if(tc())c.flags|=8192;else throw fl=Sp,Td}function Gp(c,p){p!==null&&(c.flags|=4),c.flags&16384&&(p=c.tag!==22?el():536870912,c.lanes|=p,qi|=p)}function Wu(c,p){if(!mr)switch(c.tailMode){case"hidden":p=c.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?c.tail=null:b.sibling=null;break;case"collapsed":b=c.tail;for(var I=null;b!==null;)b.alternate!==null&&(I=b),b=b.sibling;I===null?p||c.tail===null?c.tail=null:c.tail.sibling=null:I.sibling=null}}function Jr(c){var p=c.alternate!==null&&c.alternate.child===c.child,b=0,I=0;if(p)for(var N=c.child;N!==null;)b|=N.lanes|N.childLanes,I|=N.subtreeFlags&65011712,I|=N.flags&65011712,N.return=c,N=N.sibling;else for(N=c.child;N!==null;)b|=N.lanes|N.childLanes,I|=N.subtreeFlags,I|=N.flags,N.return=c,N=N.sibling;return c.subtreeFlags|=I,c.childLanes=b,p}function Ua(c,p,b){var I=p.pendingProps;switch(fd(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jr(p),null;case 1:return Jr(p),null;case 3:return b=p.stateNode,I=null,c!==null&&(I=c.memoizedState.cache),p.memoizedState.cache!==I&&(p.flags|=2048),Gl(bs),Nn(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(c===null||c.child===null)&&(vh(p)?pu(p):c===null||c.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,xp())),Jr(p),null;case 26:var N=p.type,j=p.memoizedState;return c===null?(pu(p),j!==null?(Jr(p),p_(p,j)):(Jr(p),Nh(p,N,null,I,b))):j?j!==c.memoizedState?(pu(p),Jr(p),p_(p,j)):(Jr(p),p.flags&=-16777217):(c=c.memoizedProps,c!==I&&pu(p),Jr(p),Nh(p,N,c,I,b)),null;case 27:if(Qo(p),b=Qt.current,N=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==I&&pu(p);else{if(!I){if(p.stateNode===null)throw Error(m(166));return Jr(p),null}c=Hi.current,vh(p)?Ef(p):(c=nv(N,I,b),p.stateNode=c,pu(p))}return Jr(p),null;case 5:if(Qo(p),N=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==I&&pu(p);else{if(!I){if(p.stateNode===null)throw Error(m(166));return Jr(p),null}if(j=Hi.current,vh(p))Ef(p);else{var ne=Vh(Qt.current);switch(j){case 1:j=ne.createElementNS("http://www.w3.org/2000/svg",N);break;case 2:j=ne.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;default:switch(N){case"svg":j=ne.createElementNS("http://www.w3.org/2000/svg",N);break;case"math":j=ne.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;case"script":j=ne.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild);break;case"select":j=typeof I.is=="string"?ne.createElement("select",{is:I.is}):ne.createElement("select"),I.multiple?j.multiple=!0:I.size&&(j.size=I.size);break;default:j=typeof I.is=="string"?ne.createElement(N,{is:I.is}):ne.createElement(N)}}j[Xe]=p,j[At]=I;e:for(ne=p.child;ne!==null;){if(ne.tag===5||ne.tag===6)j.appendChild(ne.stateNode);else if(ne.tag!==4&&ne.tag!==27&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===p)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===p)break e;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}p.stateNode=j;e:switch(Do(j,N,I),N){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}I&&pu(p)}}return Jr(p),Nh(p,p.type,c===null?null:c.memoizedProps,p.pendingProps,b),null;case 6:if(c&&p.stateNode!=null)c.memoizedProps!==I&&pu(p);else{if(typeof I!="string"&&p.stateNode===null)throw Error(m(166));if(c=Qt.current,vh(p)){if(c=p.stateNode,b=p.memoizedProps,I=null,N=po,N!==null)switch(N.tag){case 27:case 5:I=N.memoizedProps}c[Xe]=p,c=!!(c.nodeValue===b||I!==null&&I.suppressHydrationWarning===!0||Qx(c.nodeValue,b)),c||xc(p,!0)}else c=Vh(c).createTextNode(I),c[Xe]=p,p.stateNode=c}return Jr(p),null;case 31:if(b=p.memoizedState,c===null||c.memoizedState!==null){if(I=vh(p),b!==null){if(c===null){if(!I)throw Error(m(318));if(c=p.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(m(557));c[Xe]=p}else Pu(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Jr(p),c=!1}else b=xp(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=b),c=!0;if(!c)return p.flags&256?(Xt(p),p):(Xt(p),null);if((p.flags&128)!==0)throw Error(m(558))}return Jr(p),null;case 13:if(I=p.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(N=vh(p),I!==null&&I.dehydrated!==null){if(c===null){if(!N)throw Error(m(318));if(N=p.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(m(317));N[Xe]=p}else Pu(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Jr(p),N=!1}else N=xp(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=N),N=!0;if(!N)return p.flags&256?(Xt(p),p):(Xt(p),null)}return Xt(p),(p.flags&128)!==0?(p.lanes=b,p):(b=I!==null,c=c!==null&&c.memoizedState!==null,b&&(I=p.child,N=null,I.alternate!==null&&I.alternate.memoizedState!==null&&I.alternate.memoizedState.cachePool!==null&&(N=I.alternate.memoizedState.cachePool.pool),j=null,I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(j=I.memoizedState.cachePool.pool),j!==N&&(I.flags|=2048)),b!==c&&b&&(p.child.flags|=8192),Gp(p,p.updateQueue),Jr(p),null);case 4:return Nn(),c===null&&Yy(p.stateNode.containerInfo),Jr(p),null;case 10:return Gl(p.type),Jr(p),null;case 19:if(Kt(Ss),I=p.memoizedState,I===null)return Jr(p),null;if(N=(p.flags&128)!==0,j=I.rendering,j===null)if(N)Wu(I,!1);else{if(Qi!==0||c!==null&&(c.flags&128)!==0)for(c=p.child;c!==null;){if(j=pl(c),j!==null){for(p.flags|=128,Wu(I,!1),c=j.updateQueue,p.updateQueue=c,Gp(p,c),p.subtreeFlags=0,c=b,b=p.child;b!==null;)Tf(b,c),b=b.sibling;return Oi(Ss,Ss.current&1|2),mr&&ca(p,I.treeForkCount),p.child}c=c.sibling}I.tail!==null&&Bs()>As&&(p.flags|=128,N=!0,Wu(I,!1),p.lanes=4194304)}else{if(!N)if(c=pl(j),c!==null){if(p.flags|=128,N=!0,c=c.updateQueue,p.updateQueue=c,Gp(p,c),Wu(I,!0),I.tail===null&&I.tailMode==="hidden"&&!j.alternate&&!mr)return Jr(p),null}else 2*Bs()-I.renderingStartTime>As&&b!==536870912&&(p.flags|=128,N=!0,Wu(I,!1),p.lanes=4194304);I.isBackwards?(j.sibling=p.child,p.child=j):(c=I.last,c!==null?c.sibling=j:p.child=j,I.last=j)}return I.tail!==null?(c=I.tail,I.rendering=c,I.tail=c.sibling,I.renderingStartTime=Bs(),c.sibling=null,b=Ss.current,Oi(Ss,N?b&1|2:b&1),mr&&ca(p,I.treeForkCount),c):(Jr(p),null);case 22:case 23:return Xt(p),Id(),I=p.memoizedState!==null,c!==null?c.memoizedState!==null!==I&&(p.flags|=8192):I&&(p.flags|=8192),I?(b&536870912)!==0&&(p.flags&128)===0&&(Jr(p),p.subtreeFlags&6&&(p.flags|=8192)):Jr(p),b=p.updateQueue,b!==null&&Gp(p,b.retryQueue),b=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(b=c.memoizedState.cachePool.pool),I=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(I=p.memoizedState.cachePool.pool),I!==b&&(p.flags|=2048),c!==null&&Kt(Jc),null;case 24:return b=null,c!==null&&(b=c.memoizedState.cache),p.memoizedState.cache!==b&&(p.flags|=2048),Gl(bs),Jr(p),null;case 25:return null;case 30:return null}throw Error(m(156,p.tag))}function Fh(c,p){switch(fd(p),p.tag){case 1:return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 3:return Gl(bs),Nn(),c=p.flags,(c&65536)!==0&&(c&128)===0?(p.flags=c&-65537|128,p):null;case 26:case 27:case 5:return Qo(p),null;case 31:if(p.memoizedState!==null){if(Xt(p),p.alternate===null)throw Error(m(340));Pu()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 13:if(Xt(p),c=p.memoizedState,c!==null&&c.dehydrated!==null){if(p.alternate===null)throw Error(m(340));Pu()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 19:return Kt(Ss),null;case 4:return Nn(),null;case 10:return Gl(p.type),null;case 22:case 23:return Xt(p),Id(),c!==null&&Kt(Jc),c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 24:return Gl(bs),null;case 25:return null;default:return null}}function mu(c,p){switch(fd(p),p.tag){case 3:Gl(bs),Nn();break;case 26:case 27:case 5:Qo(p);break;case 4:Nn();break;case 31:p.memoizedState!==null&&Xt(p);break;case 13:Xt(p);break;case 19:Kt(Ss);break;case 10:Gl(p.type);break;case 22:case 23:Xt(p),Id(),c!==null&&Kt(Jc);break;case 24:Gl(bs)}}function ja(c,p){try{var b=p.updateQueue,I=b!==null?b.lastEffect:null;if(I!==null){var N=I.next;b=N;do{if((b.tag&c)===c){I=void 0;var j=b.create,ne=b.inst;I=j(),ne.destroy=I}b=b.next}while(b!==N)}}catch(Te){Ur(p,p.return,Te)}}function Ho(c,p,b){try{var I=p.updateQueue,N=I!==null?I.lastEffect:null;if(N!==null){var j=N.next;I=j;do{if((I.tag&c)===c){var ne=I.inst,Te=ne.destroy;if(Te!==void 0){ne.destroy=void 0,N=p;var tt=b,Nt=Te;try{Nt()}catch(Jt){Ur(N,tt,Jt)}}}I=I.next}while(I!==j)}}catch(Jt){Ur(p,p.return,Jt)}}function $u(c){var p=c.updateQueue;if(p!==null){var b=c.stateNode;try{Pp(p,b)}catch(I){Ur(c,c.return,I)}}}function gl(c,p,b){b.props=Mc(c.type,c.memoizedProps),b.state=c.memoizedState;try{b.componentWillUnmount()}catch(I){Ur(c,p,I)}}function jd(c,p){try{var b=c.ref;if(b!==null){switch(c.tag){case 26:case 27:case 5:var I=c.stateNode;break;case 30:I=c.stateNode;break;default:I=c.stateNode}typeof b=="function"?c.refCleanup=b(I):b.current=I}}catch(N){Ur(c,p,N)}}function gu(c,p){var b=c.ref,I=c.refCleanup;if(b!==null)if(typeof I=="function")try{I()}catch(N){Ur(c,p,N)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof b=="function")try{b(null)}catch(N){Ur(c,p,N)}else b.current=null}function f(c){var p=c.type,b=c.memoizedProps,I=c.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":b.autoFocus&&I.focus();break e;case"img":b.src?I.src=b.src:b.srcSet&&(I.srcset=b.srcSet)}}catch(N){Ur(c,c.return,N)}}function t(c,p,b){try{var I=c.stateNode;b1(I,c.type,b,p),I[At]=p}catch(N){Ur(c,c.return,N)}}function o(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Uh(c.type)||c.tag===4}function d(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||o(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Uh(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function y(c,p,b){var I=c.tag;if(I===5||I===6)c=c.stateNode,p?(b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b).insertBefore(c,p):(p=b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b,p.appendChild(c),b=b._reactRootContainer,b!=null||p.onclick!==null||(p.onclick=Fo));else if(I!==4&&(I===27&&Uh(c.type)&&(b=c.stateNode,p=null),c=c.child,c!==null))for(y(c,p,b),c=c.sibling;c!==null;)y(c,p,b),c=c.sibling}function v(c,p,b){var I=c.tag;if(I===5||I===6)c=c.stateNode,p?b.insertBefore(c,p):b.appendChild(c);else if(I!==4&&(I===27&&Uh(c.type)&&(b=c.stateNode),c=c.child,c!==null))for(v(c,p,b),c=c.sibling;c!==null;)v(c,p,b),c=c.sibling}function T(c){var p=c.stateNode,b=c.memoizedProps;try{for(var I=c.type,N=p.attributes;N.length;)p.removeAttributeNode(N[0]);Do(p,I,b),p[Xe]=c,p[At]=b}catch(j){Ur(c,c.return,j)}}var S=!1,R=!1,O=!1,k=typeof WeakSet=="function"?WeakSet:Set,U=null;function F(c,p){if(c=c.containerInfo,Jy=Kp,c=uh(c),pp(c)){if("selectionStart"in c)var b={start:c.selectionStart,end:c.selectionEnd};else e:{b=(b=c.ownerDocument)&&b.defaultView||window;var I=b.getSelection&&b.getSelection();if(I&&I.rangeCount!==0){b=I.anchorNode;var N=I.anchorOffset,j=I.focusNode;I=I.focusOffset;try{b.nodeType,j.nodeType}catch{b=null;break e}var ne=0,Te=-1,tt=-1,Nt=0,Jt=0,ai=c,Vt=null;t:for(;;){for(var qt;ai!==b||N!==0&&ai.nodeType!==3||(Te=ne+N),ai!==j||I!==0&&ai.nodeType!==3||(tt=ne+I),ai.nodeType===3&&(ne+=ai.nodeValue.length),(qt=ai.firstChild)!==null;)Vt=ai,ai=qt;for(;;){if(ai===c)break t;if(Vt===b&&++Nt===N&&(Te=ne),Vt===j&&++Jt===I&&(tt=ne),(qt=ai.nextSibling)!==null)break;ai=Vt,Vt=ai.parentNode}ai=qt}b=Te===-1||tt===-1?null:{start:Te,end:tt}}else b=null}b=b||{start:0,end:0}}else b=null;for(Is={focusedElem:c,selectionRange:b},Kp=!1,U=p;U!==null;)if(p=U,c=p.child,(p.subtreeFlags&1028)!==0&&c!==null)c.return=p,U=c;else for(;U!==null;){switch(p=U,j=p.alternate,c=p.flags,p.tag){case 0:if((c&4)!==0&&(c=p.updateQueue,c=c!==null?c.events:null,c!==null))for(b=0;b<c.length;b++)N=c[b],N.ref.impl=N.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&j!==null){c=void 0,b=p,N=j.memoizedProps,j=j.memoizedState,I=b.stateNode;try{var Ji=Mc(b.type,N);c=I.getSnapshotBeforeUpdate(Ji,j),I.__reactInternalSnapshotBeforeUpdate=c}catch(On){Ur(b,b.return,On)}}break;case 3:if((c&1024)!==0){if(c=p.stateNode.containerInfo,b=c.nodeType,b===9)C_(c);else if(b===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":C_(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(m(163))}if(c=p.sibling,c!==null){c.return=p.return,U=c;break}U=p.return}}function H(c,p,b){var I=b.flags;switch(b.tag){case 0:case 11:case 15:Oe(c,b),I&4&&ja(5,b);break;case 1:if(Oe(c,b),I&4)if(c=b.stateNode,p===null)try{c.componentDidMount()}catch(ne){Ur(b,b.return,ne)}else{var N=Mc(b.type,p.memoizedProps);p=p.memoizedState;try{c.componentDidUpdate(N,p,c.__reactInternalSnapshotBeforeUpdate)}catch(ne){Ur(b,b.return,ne)}}I&64&&$u(b),I&512&&jd(b,b.return);break;case 3:if(Oe(c,b),I&64&&(c=b.updateQueue,c!==null)){if(p=null,b.child!==null)switch(b.child.tag){case 27:case 5:p=b.child.stateNode;break;case 1:p=b.child.stateNode}try{Pp(c,p)}catch(ne){Ur(b,b.return,ne)}}break;case 27:p===null&&I&4&&T(b);case 26:case 5:Oe(c,b),p===null&&I&4&&f(b),I&512&&jd(b,b.return);break;case 12:Oe(c,b);break;case 31:Oe(c,b),I&4&&ue(c,b);break;case 13:Oe(c,b),I&4&&de(c,b),I&64&&(c=b.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(b=Uy.bind(null,b),e0(c,b))));break;case 22:if(I=b.memoizedState!==null||S,!I){p=p!==null&&p.memoizedState!==null||R,N=S;var j=R;S=I,(R=p)&&!j?qe(c,b,(b.subtreeFlags&8772)!==0):Oe(c,b),S=N,R=j}break;case 30:break;default:Oe(c,b)}}function $(c){var p=c.alternate;p!==null&&(c.alternate=null,$(p)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(p=c.stateNode,p!==null&&hn(p)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var W=null,ie=!1;function X(c,p,b){for(b=b.child;b!==null;)re(c,p,b),b=b.sibling}function re(c,p,b){if(vs&&typeof vs.onCommitFiberUnmount=="function")try{vs.onCommitFiberUnmount(ea,b)}catch{}switch(b.tag){case 26:R||gu(b,p),X(c,p,b),b.memoizedState?b.memoizedState.count--:b.stateNode&&(b=b.stateNode,b.parentNode.removeChild(b));break;case 27:R||gu(b,p);var I=W,N=ie;Uh(b.type)&&(W=b.stateNode,ie=!1),X(c,p,b),Hf(b.stateNode),W=I,ie=N;break;case 5:R||gu(b,p);case 6:if(I=W,N=ie,W=null,X(c,p,b),W=I,ie=N,W!==null)if(ie)try{(W.nodeType===9?W.body:W.nodeName==="HTML"?W.ownerDocument.body:W).removeChild(b.stateNode)}catch(j){Ur(b,p,j)}else try{W.removeChild(b.stateNode)}catch(j){Ur(b,p,j)}break;case 18:W!==null&&(ie?(c=W,A_(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,b.stateNode),$f(c)):A_(W,b.stateNode));break;case 4:I=W,N=ie,W=b.stateNode.containerInfo,ie=!0,X(c,p,b),W=I,ie=N;break;case 0:case 11:case 14:case 15:Ho(2,b,p),R||Ho(4,b,p),X(c,p,b);break;case 1:R||(gu(b,p),I=b.stateNode,typeof I.componentWillUnmount=="function"&&gl(b,p,I)),X(c,p,b);break;case 21:X(c,p,b);break;case 22:R=(I=R)||b.memoizedState!==null,X(c,p,b),R=I;break;default:X(c,p,b)}}function ue(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{$f(c)}catch(b){Ur(p,p.return,b)}}}function de(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{$f(c)}catch(b){Ur(p,p.return,b)}}function be(c){switch(c.tag){case 31:case 13:case 19:var p=c.stateNode;return p===null&&(p=c.stateNode=new k),p;case 22:return c=c.stateNode,p=c._retryCache,p===null&&(p=c._retryCache=new k),p;default:throw Error(m(435,c.tag))}}function ye(c,p){var b=be(c);p.forEach(function(I){if(!b.has(I)){b.add(I);var N=jy.bind(null,c,I);I.then(N,N)}})}function ve(c,p){var b=p.deletions;if(b!==null)for(var I=0;I<b.length;I++){var N=b[I],j=c,ne=p,Te=ne;e:for(;Te!==null;){switch(Te.tag){case 27:if(Uh(Te.type)){W=Te.stateNode,ie=!1;break e}break;case 5:W=Te.stateNode,ie=!1;break e;case 3:case 4:W=Te.stateNode.containerInfo,ie=!0;break e}Te=Te.return}if(W===null)throw Error(m(160));re(j,ne,N),W=null,ie=!1,j=N.alternate,j!==null&&(j.return=null),N.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)_e(p,c),p=p.sibling}var ge=null;function _e(c,p){var b=c.alternate,I=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:ve(p,c),xe(c),I&4&&(Ho(3,c,c.return),ja(3,c),Ho(5,c,c.return));break;case 1:ve(p,c),xe(c),I&512&&(R||b===null||gu(b,b.return)),I&64&&S&&(c=c.updateQueue,c!==null&&(I=c.callbacks,I!==null&&(b=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=b===null?I:b.concat(I))));break;case 26:var N=ge;if(ve(p,c),xe(c),I&512&&(R||b===null||gu(b,b.return)),I&4){var j=b!==null?b.memoizedState:null;if(I=c.memoizedState,b===null)if(I===null)if(c.stateNode===null){e:{I=c.type,b=c.memoizedProps,N=N.ownerDocument||N;t:switch(I){case"title":j=N.getElementsByTagName("title")[0],(!j||j[Wi]||j[Xe]||j.namespaceURI==="http://www.w3.org/2000/svg"||j.hasAttribute("itemprop"))&&(j=N.createElement(I),N.head.insertBefore(j,N.querySelector("head > title"))),Do(j,I,b),j[Xe]=c,Gn(j),I=j;break e;case"link":var ne=z_("link","href",N).get(I+(b.href||""));if(ne){for(var Te=0;Te<ne.length;Te++)if(j=ne[Te],j.getAttribute("href")===(b.href==null||b.href===""?null:b.href)&&j.getAttribute("rel")===(b.rel==null?null:b.rel)&&j.getAttribute("title")===(b.title==null?null:b.title)&&j.getAttribute("crossorigin")===(b.crossOrigin==null?null:b.crossOrigin)){ne.splice(Te,1);break t}}j=N.createElement(I),Do(j,I,b),N.head.appendChild(j);break;case"meta":if(ne=z_("meta","content",N).get(I+(b.content||""))){for(Te=0;Te<ne.length;Te++)if(j=ne[Te],j.getAttribute("content")===(b.content==null?null:""+b.content)&&j.getAttribute("name")===(b.name==null?null:b.name)&&j.getAttribute("property")===(b.property==null?null:b.property)&&j.getAttribute("http-equiv")===(b.httpEquiv==null?null:b.httpEquiv)&&j.getAttribute("charset")===(b.charSet==null?null:b.charSet)){ne.splice(Te,1);break t}}j=N.createElement(I),Do(j,I,b),N.head.appendChild(j);break;default:throw Error(m(468,I))}j[Xe]=c,Gn(j),I=j}c.stateNode=I}else k_(N,c.type,c.stateNode);else c.stateNode=ov(N,I,c.memoizedProps);else j!==I?(j===null?b.stateNode!==null&&(b=b.stateNode,b.parentNode.removeChild(b)):j.count--,I===null?k_(N,c.type,c.stateNode):ov(N,I,c.memoizedProps)):I===null&&c.stateNode!==null&&t(c,c.memoizedProps,b.memoizedProps)}break;case 27:ve(p,c),xe(c),I&512&&(R||b===null||gu(b,b.return)),b!==null&&I&4&&t(c,c.memoizedProps,b.memoizedProps);break;case 5:if(ve(p,c),xe(c),I&512&&(R||b===null||gu(b,b.return)),c.flags&32){N=c.stateNode;try{xs(N,"")}catch(Ji){Ur(c,c.return,Ji)}}I&4&&c.stateNode!=null&&(N=c.memoizedProps,t(c,N,b!==null?b.memoizedProps:N)),I&1024&&(O=!0);break;case 6:if(ve(p,c),xe(c),I&4){if(c.stateNode===null)throw Error(m(162));I=c.memoizedProps,b=c.stateNode;try{b.nodeValue=I}catch(Ji){Ur(c,c.return,Ji)}}break;case 3:if(Ag=null,N=ge,ge=Tg(p.containerInfo),ve(p,c),ge=N,xe(c),I&4&&b!==null&&b.memoizedState.isDehydrated)try{$f(p.containerInfo)}catch(Ji){Ur(c,c.return,Ji)}O&&(O=!1,Ze(c));break;case 4:I=ge,ge=Tg(c.stateNode.containerInfo),ve(p,c),xe(c),ge=I;break;case 12:ve(p,c),xe(c);break;case 31:ve(p,c),xe(c),I&4&&(I=c.updateQueue,I!==null&&(c.updateQueue=null,ye(c,I)));break;case 13:ve(p,c),xe(c),c.child.flags&8192&&c.memoizedState!==null!=(b!==null&&b.memoizedState!==null)&&(fr=Bs()),I&4&&(I=c.updateQueue,I!==null&&(c.updateQueue=null,ye(c,I)));break;case 22:N=c.memoizedState!==null;var tt=b!==null&&b.memoizedState!==null,Nt=S,Jt=R;if(S=Nt||N,R=Jt||tt,ve(p,c),R=Jt,S=Nt,xe(c),I&8192)e:for(p=c.stateNode,p._visibility=N?p._visibility&-2:p._visibility|1,N&&(b===null||tt||S||R||ot(c)),b=null,p=c;;){if(p.tag===5||p.tag===26){if(b===null){tt=b=p;try{if(j=tt.stateNode,N)ne=j.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{Te=tt.stateNode;var ai=tt.memoizedProps.style,Vt=ai!=null&&ai.hasOwnProperty("display")?ai.display:null;Te.style.display=Vt==null||typeof Vt=="boolean"?"":(""+Vt).trim()}}catch(Ji){Ur(tt,tt.return,Ji)}}}else if(p.tag===6){if(b===null){tt=p;try{tt.stateNode.nodeValue=N?"":tt.memoizedProps}catch(Ji){Ur(tt,tt.return,Ji)}}}else if(p.tag===18){if(b===null){tt=p;try{var qt=tt.stateNode;N?I_(qt,!0):I_(tt.stateNode,!1)}catch(Ji){Ur(tt,tt.return,Ji)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===c)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break e;for(;p.sibling===null;){if(p.return===null||p.return===c)break e;b===p&&(b=null),p=p.return}b===p&&(b=null),p.sibling.return=p.return,p=p.sibling}I&4&&(I=c.updateQueue,I!==null&&(b=I.retryQueue,b!==null&&(I.retryQueue=null,ye(c,b))));break;case 19:ve(p,c),xe(c),I&4&&(I=c.updateQueue,I!==null&&(c.updateQueue=null,ye(c,I)));break;case 30:break;case 21:break;default:ve(p,c),xe(c)}}function xe(c){var p=c.flags;if(p&2){try{for(var b,I=c.return;I!==null;){if(o(I)){b=I;break}I=I.return}if(b==null)throw Error(m(160));switch(b.tag){case 27:var N=b.stateNode,j=d(c);v(c,j,N);break;case 5:var ne=b.stateNode;b.flags&32&&(xs(ne,""),b.flags&=-33);var Te=d(c);v(c,Te,ne);break;case 3:case 4:var tt=b.stateNode.containerInfo,Nt=d(c);y(c,Nt,tt);break;default:throw Error(m(161))}}catch(Jt){Ur(c,c.return,Jt)}c.flags&=-3}p&4096&&(c.flags&=-4097)}function Ze(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var p=c;Ze(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),c=c.sibling}}function Oe(c,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)H(c,p.alternate,p),p=p.sibling}function ot(c){for(c=c.child;c!==null;){var p=c;switch(p.tag){case 0:case 11:case 14:case 15:Ho(4,p,p.return),ot(p);break;case 1:gu(p,p.return);var b=p.stateNode;typeof b.componentWillUnmount=="function"&&gl(p,p.return,b),ot(p);break;case 27:Hf(p.stateNode);case 26:case 5:gu(p,p.return),ot(p);break;case 22:p.memoizedState===null&&ot(p);break;case 30:ot(p);break;default:ot(p)}c=c.sibling}}function qe(c,p,b){for(b=b&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var I=p.alternate,N=c,j=p,ne=j.flags;switch(j.tag){case 0:case 11:case 15:qe(N,j,b),ja(4,j);break;case 1:if(qe(N,j,b),I=j,N=I.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Nt){Ur(I,I.return,Nt)}if(I=j,N=I.updateQueue,N!==null){var Te=I.stateNode;try{var tt=N.shared.hiddenCallbacks;if(tt!==null)for(N.shared.hiddenCallbacks=null,N=0;N<tt.length;N++)Af(tt[N],Te)}catch(Nt){Ur(I,I.return,Nt)}}b&&ne&64&&$u(j),jd(j,j.return);break;case 27:T(j);case 26:case 5:qe(N,j,b),b&&I===null&&ne&4&&f(j),jd(j,j.return);break;case 12:qe(N,j,b);break;case 31:qe(N,j,b),b&&ne&4&&ue(N,j);break;case 13:qe(N,j,b),b&&ne&4&&de(N,j);break;case 22:j.memoizedState===null&&qe(N,j,b),jd(j,j.return);break;case 30:break;default:qe(N,j,b)}p=p.sibling}}function nt(c,p){var b=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(b=c.memoizedState.cachePool.pool),c=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(c=p.memoizedState.cachePool.pool),c!==b&&(c!=null&&c.refCount++,b!=null&&xh(b))}function zt(c,p){c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&xh(c))}function He(c,p,b,I){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)Pe(c,p,b,I),p=p.sibling}function Pe(c,p,b,I){var N=p.flags;switch(p.tag){case 0:case 11:case 15:He(c,p,b,I),N&2048&&ja(9,p);break;case 1:He(c,p,b,I);break;case 3:He(c,p,b,I),N&2048&&(c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&xh(c)));break;case 12:if(N&2048){He(c,p,b,I),c=p.stateNode;try{var j=p.memoizedProps,ne=j.id,Te=j.onPostCommit;typeof Te=="function"&&Te(ne,p.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(tt){Ur(p,p.return,tt)}}else He(c,p,b,I);break;case 31:He(c,p,b,I);break;case 13:He(c,p,b,I);break;case 23:break;case 22:j=p.stateNode,ne=p.alternate,p.memoizedState!==null?j._visibility&2?He(c,p,b,I):Ke(c,p):j._visibility&2?He(c,p,b,I):(j._visibility|=2,lt(c,p,b,I,(p.subtreeFlags&10256)!==0||!1)),N&2048&&nt(ne,p);break;case 24:He(c,p,b,I),N&2048&&zt(p.alternate,p);break;default:He(c,p,b,I)}}function lt(c,p,b,I,N){for(N=N&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var j=c,ne=p,Te=b,tt=I,Nt=ne.flags;switch(ne.tag){case 0:case 11:case 15:lt(j,ne,Te,tt,N),ja(8,ne);break;case 23:break;case 22:var Jt=ne.stateNode;ne.memoizedState!==null?Jt._visibility&2?lt(j,ne,Te,tt,N):Ke(j,ne):(Jt._visibility|=2,lt(j,ne,Te,tt,N)),N&&Nt&2048&&nt(ne.alternate,ne);break;case 24:lt(j,ne,Te,tt,N),N&&Nt&2048&&zt(ne.alternate,ne);break;default:lt(j,ne,Te,tt,N)}p=p.sibling}}function Ke(c,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var b=c,I=p,N=I.flags;switch(I.tag){case 22:Ke(b,I),N&2048&&nt(I.alternate,I);break;case 24:Ke(b,I),N&2048&&zt(I.alternate,I);break;default:Ke(b,I)}p=p.sibling}}var yt=8192;function Rt(c,p,b){if(c.subtreeFlags&yt)for(c=c.child;c!==null;)Yt(c,p,b),c=c.sibling}function Yt(c,p,b){switch(c.tag){case 26:Rt(c,p,b),c.flags&yt&&c.memoizedState!==null&&P1(b,ge,c.memoizedState,c.memoizedProps);break;case 5:Rt(c,p,b);break;case 3:case 4:var I=ge;ge=Tg(c.stateNode.containerInfo),Rt(c,p,b),ge=I;break;case 22:c.memoizedState===null&&(I=c.alternate,I!==null&&I.memoizedState!==null?(I=yt,yt=16777216,Rt(c,p,b),yt=I):Rt(c,p,b));break;default:Rt(c,p,b)}}function Mt(c){var p=c.alternate;if(p!==null&&(c=p.child,c!==null)){p.child=null;do p=c.sibling,c.sibling=null,c=p;while(c!==null)}}function Tt(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var b=0;b<p.length;b++){var I=p[b];U=I,fi(I,c)}Mt(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)_i(c),c=c.sibling}function _i(c){switch(c.tag){case 0:case 11:case 15:Tt(c),c.flags&2048&&Ho(9,c,c.return);break;case 3:Tt(c);break;case 12:Tt(c);break;case 22:var p=c.stateNode;c.memoizedState!==null&&p._visibility&2&&(c.return===null||c.return.tag!==13)?(p._visibility&=-3,li(c)):Tt(c);break;default:Tt(c)}}function li(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var b=0;b<p.length;b++){var I=p[b];U=I,fi(I,c)}Mt(c)}for(c=c.child;c!==null;){switch(p=c,p.tag){case 0:case 11:case 15:Ho(8,p,p.return),li(p);break;case 22:b=p.stateNode,b._visibility&2&&(b._visibility&=-3,li(p));break;default:li(p)}c=c.sibling}}function fi(c,p){for(;U!==null;){var b=U;switch(b.tag){case 0:case 11:case 15:Ho(8,b,p);break;case 23:case 22:if(b.memoizedState!==null&&b.memoizedState.cachePool!==null){var I=b.memoizedState.cachePool.pool;I!=null&&I.refCount++}break;case 24:xh(b.memoizedState.cache)}if(I=b.child,I!==null)I.return=b,U=I;else e:for(b=c;U!==null;){I=U;var N=I.sibling,j=I.return;if($(I),I===b){U=null;break e}if(N!==null){N.return=j,U=N;break e}U=j}}}var ci={getCacheForType:function(c){var p=Co(bs),b=p.data.get(c);return b===void 0&&(b=c(),p.data.set(c,b)),b},cacheSignal:function(){return Co(bs).controller.signal}},Fi=typeof WeakMap=="function"?WeakMap:Map,bi=0,Ei=null,Ni=null,ui=0,Vi=0,_n=null,qn=!1,Gi=!1,Mn=!1,xn=0,Qi=0,$n=0,vr=0,ws=0,zn=0,qi=0,Ci=null,yn=null,Mr=!1,fr=0,as=0,As=1/0,Wo=null,Js=null,Lr=0,qs=null,Hs=null,eo=0,Ga=0,zr=null,$r=null,cr=0,cs=null;function Sr(){return(bi&2)!==0&&ui!==0?ui&-ui:Pt.T!==null?b_():Ie()}function is(){if(zn===0)if((ui&536870912)===0||mr){var c=Ma;Ma<<=1,(Ma&3932160)===0&&(Ma=262144),zn=c}else zn=536870912;return c=Uo.current,c!==null&&(c.flags|=32),zn}function Vr(c,p,b){(c===Ei&&(Vi===2||Vi===9)||c.cancelPendingCommit!==null)&&(ec(c,0),fa(c,ui,zn,!1)),il(c,b),((bi&2)===0||c!==Ei)&&(c===Ei&&((bi&2)===0&&(vr|=b),Qi===4&&fa(c,ui,zn,!1)),Xu(c))}function Kl(c,p,b){if((bi&6)!==0)throw Error(m(327));var I=!b&&(p&127)===0&&(p&c.expiredLanes)===0||xa(c,p),N=I?_1(c,p):Gd(c,p,!0),j=I;do{if(N===0){Gi&&!I&&fa(c,p,0,!1);break}else{if(b=c.current.alternate,j&&!Ql(b)){N=Gd(c,p,!1),j=!1;continue}if(N===2){if(j=p,c.errorRecoveryDisabledLanes&j)var ne=0;else ne=c.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){p=ne;e:{var Te=c;N=Ci;var tt=Te.current.memoizedState.isDehydrated;if(tt&&(ec(Te,ne).flags|=256),ne=Gd(Te,ne,!1),ne!==2){if(Mn&&!tt){Te.errorRecoveryDisabledLanes|=j,vr|=j,N=4;break e}j=yn,yn=N,j!==null&&(yn===null?yn=j:yn.push.apply(yn,j))}N=ne}if(j=!1,N!==2)continue}}if(N===1){ec(c,0),fa(c,p,0,!0);break}e:{switch(I=c,j=N,j){case 0:case 1:throw Error(m(345));case 4:if((p&4194048)!==p)break;case 6:fa(I,p,zn,!qn);break e;case 2:yn=null;break;case 3:case 5:break;default:throw Error(m(329))}if((p&62914560)===p&&(N=fr+300-Bs(),10<N)){if(fa(I,p,zn,!qn),va(I,0,!0)!==0)break e;eo=p,I.timeoutHandle=tv(Pc.bind(null,I,b,yn,Wo,Mr,p,zn,vr,qi,qn,j,"Throttled",-0,0),N);break e}Pc(I,b,yn,Wo,Mr,p,zn,vr,qi,qn,j,null,-0,0)}}break}while(!0);Xu(c)}function Pc(c,p,b,I,N,j,ne,Te,tt,Nt,Jt,ai,Vt,qt){if(c.timeoutHandle=-1,ai=p.subtreeFlags,ai&8192||(ai&16785408)===16785408){ai={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fo},Yt(p,j,ai);var Ji=(j&62914560)===j?fr-Bs():(j&4194048)===j?as-Bs():0;if(Ji=D1(ai,Ji),Ji!==null){eo=j,c.cancelPendingCommit=Ji(Ux.bind(null,c,p,j,b,I,N,ne,Te,tt,Jt,ai,null,Vt,qt)),fa(c,j,ne,!Nt);return}}Ux(c,p,j,b,I,N,ne,Te,tt)}function Ql(c){for(var p=c;;){var b=p.tag;if((b===0||b===11||b===15)&&p.flags&16384&&(b=p.updateQueue,b!==null&&(b=b.stores,b!==null)))for(var I=0;I<b.length;I++){var N=b[I],j=N.getSnapshot;N=N.value;try{if(!Oa(j(),N))return!1}catch{return!1}}if(b=p.child,p.subtreeFlags&16384&&b!==null)b.return=p,p=b;else{if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function fa(c,p,b,I){p&=~ws,p&=~vr,c.suspendedLanes|=p,c.pingedLanes&=~p,I&&(c.warmLanes|=p),I=c.expirationTimes;for(var N=p;0<N;){var j=31-Yr(N),ne=1<<j;I[j]=-1,N&=~ne}b!==0&&J(c,b,p)}function Jl(){return(bi&6)===0?(_g(0),!1):!0}function _l(){if(Ni!==null){if(Vi===0)var c=Ni.return;else c=Ni,Kc=Du=null,Cd(c),zu=null,ku=0,c=Ni;for(;c!==null;)mu(c.alternate,c),c=c.return;Ni=null}}function ec(c,p){var b=c.timeoutHandle;b!==-1&&(c.timeoutHandle=-1,bg(b)),b=c.cancelPendingCommit,b!==null&&(c.cancelPendingCommit=null,b()),eo=0,_l(),Ei=c,Ni=b=Yc(c.current,null),ui=p,Vi=0,_n=null,qn=!1,Gi=xa(c,p),Mn=!1,qi=zn=ws=vr=$n=Qi=0,yn=Ci=null,Mr=!1,(p&8)!==0&&(p|=p&32);var I=c.entangledLanes;if(I!==0)for(c=c.entanglements,I&=p;0<I;){var N=31-Yr(I),j=1<<N;p|=c[N],I&=~j}return xn=p,Zc(),b}function Dc(c,p){Dn=null,Pt.H=Ch,p===wd||p===Ep?(p=Hm(),Vi=3):p===Td?(p=Hm(),Vi=4):Vi=p===Bf?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,_n=p,Ni===null&&(Qi=1,Ph(c,cl(p,c.current)))}function tc(){var c=Uo.current;return c===null?!0:(ui&4194048)===ui?jo===null:(ui&62914560)===ui||(ui&536870912)!==0?c===jo:!1}function Oc(){var c=Pt.H;return Pt.H=Ch,c===null?Ch:c}function Gf(){var c=Pt.A;return Pt.A=ci,c}function ao(){Qi=4,qn||(ui&4194048)!==ui&&Uo.current!==null||(Gi=!0),($n&134217727)===0&&(vr&134217727)===0||Ei===null||fa(Ei,ui,zn,!1)}function Gd(c,p,b){var I=bi;bi|=2;var N=Oc(),j=Gf();(Ei!==c||ui!==p)&&(Wo=null,ec(c,p)),p=!1;var ne=Qi;e:do try{if(Vi!==0&&Ni!==null){var Te=Ni,tt=_n;switch(Vi){case 8:_l(),ne=6;break e;case 3:case 2:case 9:case 6:Uo.current===null&&(p=!0);var Nt=Vi;if(Vi=0,_n=null,Bh(c,Te,tt,Nt),b&&Gi){ne=0;break e}break;default:Nt=Vi,Vi=0,_n=null,Bh(c,Te,tt,Nt)}}g1(),ne=Qi;break}catch(Jt){Dc(c,Jt)}while(!0);return p&&c.shellSuspendCounter++,Kc=Du=null,bi=I,Pt.H=N,Pt.A=j,Ni===null&&(Ei=null,ui=0,Zc()),ne}function g1(){for(;Ni!==null;)Vx(Ni)}function _1(c,p){var b=bi;bi|=2;var I=Oc(),N=Gf();Ei!==c||ui!==p?(Wo=null,As=Bs()+500,ec(c,p)):Gi=xa(c,p);e:do try{if(Vi!==0&&Ni!==null){p=Ni;var j=_n;t:switch(Vi){case 1:Vi=0,_n=null,Bh(c,p,j,1);break;case 2:case 9:if(Ap(j)){Vi=0,_n=null,Fy(p);break}p=function(){Vi!==2&&Vi!==9||Ei!==c||(Vi=7),Xu(c)},j.then(p,p);break e;case 3:Vi=7;break e;case 4:Vi=5;break e;case 7:Ap(j)?(Vi=0,_n=null,Fy(p)):(Vi=0,_n=null,Bh(c,p,j,7));break;case 5:var ne=null;switch(Ni.tag){case 26:ne=Ni.memoizedState;case 5:case 27:var Te=Ni;if(ne?N_(ne):Te.stateNode.complete){Vi=0,_n=null;var tt=Te.sibling;if(tt!==null)Ni=tt;else{var Nt=Te.return;Nt!==null?(Ni=Nt,g_(Nt)):Ni=null}break t}}Vi=0,_n=null,Bh(c,p,j,5);break;case 6:Vi=0,_n=null,Bh(c,p,j,6);break;case 8:_l(),Qi=6;break e;default:throw Error(m(462))}}m_();break}catch(Jt){Dc(c,Jt)}while(!0);return Kc=Du=null,Pt.H=I,Pt.A=N,bi=b,Ni!==null?0:(Ei=null,ui=0,Zc(),Qi)}function m_(){for(;Ni!==null&&!Cl();)Vx(Ni)}function Vx(c){var p=dg(c.alternate,c,xn);c.memoizedProps=c.pendingProps,p===null?g_(c):Ni=p}function Fy(c){var p=c,b=p.alternate;switch(p.tag){case 15:case 0:p=f_(b,p,p.pendingProps,p.type,void 0,ui);break;case 11:p=f_(b,p,p.pendingProps,p.type.render,p.ref,ui);break;case 5:Cd(p);default:mu(b,p),p=Ni=Tf(p,xn),p=dg(b,p,xn)}c.memoizedProps=c.pendingProps,p===null?g_(c):Ni=p}function Bh(c,p,b,I){Kc=Du=null,Cd(p),zu=null,ku=0;var N=p.return;try{if(h_(c,N,p,b,ui)){Qi=1,Ph(c,cl(b,c.current)),Ni=null;return}}catch(j){if(N!==null)throw Ni=N,j;Qi=1,Ph(c,cl(b,c.current)),Ni=null;return}p.flags&32768?(mr||I===1?c=!0:Gi||(ui&536870912)!==0?c=!1:(qn=c=!0,(I===2||I===9||I===3||I===6)&&(I=Uo.current,I!==null&&I.tag===13&&(I.flags|=16384))),By(p,c)):g_(p)}function g_(c){var p=c;do{if((p.flags&32768)!==0){By(p,qn);return}c=p.return;var b=Ua(p.alternate,p,xn);if(b!==null){Ni=b;return}if(p=p.sibling,p!==null){Ni=p;return}Ni=p=c}while(p!==null);Qi===0&&(Qi=5)}function By(c,p){do{var b=Fh(c.alternate,c);if(b!==null){b.flags&=32767,Ni=b;return}if(b=c.return,b!==null&&(b.flags|=32768,b.subtreeFlags=0,b.deletions=null),!p&&(c=c.sibling,c!==null)){Ni=c;return}Ni=c=b}while(c!==null);Qi=6,Ni=null}function Ux(c,p,b,I,N,j,ne,Te,tt){c.cancelPendingCommit=null;do fg();while(Lr!==0);if((bi&6)!==0)throw Error(m(327));if(p!==null){if(p===c.current)throw Error(m(177));if(j=p.lanes|p.childLanes,j|=wf,Fe(c,b,j,ne,Te,tt),c===Ei&&(Ni=Ei=null,ui=0),Hs=p,qs=c,eo=b,Ga=j,zr=N,$r=I,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,Gx(Ja,function(){return pg(),null})):(c.callbackNode=null,c.callbackPriority=0),I=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||I){I=Pt.T,Pt.T=null,N=Si.p,Si.p=2,ne=bi,bi|=4;try{F(c,p,b)}finally{bi=ne,Si.p=N,Pt.T=I}}Lr=1,__(),_u(),Zu()}}function __(){if(Lr===1){Lr=0;var c=qs,p=Hs,b=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||b){b=Pt.T,Pt.T=null;var I=Si.p;Si.p=2;var N=bi;bi|=4;try{_e(p,c);var j=Is,ne=uh(c.containerInfo),Te=j.focusedElem,tt=j.selectionRange;if(ne!==Te&&Te&&Te.ownerDocument&&i_(Te.ownerDocument.documentElement,Te)){if(tt!==null&&pp(Te)){var Nt=tt.start,Jt=tt.end;if(Jt===void 0&&(Jt=Nt),"selectionStart"in Te)Te.selectionStart=Nt,Te.selectionEnd=Math.min(Jt,Te.value.length);else{var ai=Te.ownerDocument||document,Vt=ai&&ai.defaultView||window;if(Vt.getSelection){var qt=Vt.getSelection(),Ji=Te.textContent.length,On=Math.min(tt.start,Ji),Zr=tt.end===void 0?On:Math.min(tt.end,Ji);!qt.extend&&On>Zr&&(ne=Zr,Zr=On,On=ne);var bt=ll(Te,On),ct=ll(Te,Zr);if(bt&&ct&&(qt.rangeCount!==1||qt.anchorNode!==bt.node||qt.anchorOffset!==bt.offset||qt.focusNode!==ct.node||qt.focusOffset!==ct.offset)){var Ft=ai.createRange();Ft.setStart(bt.node,bt.offset),qt.removeAllRanges(),On>Zr?(qt.addRange(Ft),qt.extend(ct.node,ct.offset)):(Ft.setEnd(ct.node,ct.offset),qt.addRange(Ft))}}}}for(ai=[],qt=Te;qt=qt.parentNode;)qt.nodeType===1&&ai.push({element:qt,left:qt.scrollLeft,top:qt.scrollTop});for(typeof Te.focus=="function"&&Te.focus(),Te=0;Te<ai.length;Te++){var ni=ai[Te];ni.element.scrollLeft=ni.left,ni.element.scrollTop=ni.top}}Kp=!!Jy,Is=Jy=null}finally{bi=N,Si.p=I,Pt.T=b}}c.current=p,Lr=2}}function _u(){if(Lr===2){Lr=0;var c=qs,p=Hs,b=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||b){b=Pt.T,Pt.T=null;var I=Si.p;Si.p=2;var N=bi;bi|=4;try{H(c,p.alternate,p)}finally{bi=N,Si.p=I,Pt.T=b}}Lr=3}}function Zu(){if(Lr===4||Lr===3){Lr=0,Qa();var c=qs,p=Hs,b=eo,I=$r;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Lr=5:(Lr=0,Hs=qs=null,Vy(c,c.pendingLanes));var N=c.pendingLanes;if(N===0&&(Js=null),Ae(b),p=p.stateNode,vs&&typeof vs.onCommitFiberRoot=="function")try{vs.onCommitFiberRoot(ea,p,void 0,(p.current.flags&128)===128)}catch{}if(I!==null){p=Pt.T,N=Si.p,Si.p=2,Pt.T=null;try{for(var j=c.onRecoverableError,ne=0;ne<I.length;ne++){var Te=I[ne];j(Te.value,{componentStack:Te.stack})}}finally{Pt.T=p,Si.p=N}}(eo&3)!==0&&fg(),Xu(c),N=c.pendingLanes,(b&261930)!==0&&(N&42)!==0?c===cs?cr++:(cr=0,cs=c):cr=0,_g(0)}}function Vy(c,p){(c.pooledCacheLanes&=p)===0&&(p=c.pooledCache,p!=null&&(c.pooledCache=null,xh(p)))}function fg(){return __(),_u(),Zu(),pg()}function pg(){if(Lr!==5)return!1;var c=qs,p=Ga;Ga=0;var b=Ae(eo),I=Pt.T,N=Si.p;try{Si.p=32>b?32:b,Pt.T=null,b=zr,zr=null;var j=qs,ne=eo;if(Lr=0,Hs=qs=null,eo=0,(bi&6)!==0)throw Error(m(331));var Te=bi;if(bi|=4,_i(j.current),Pe(j,j.current,ne,b),bi=Te,_g(0,!1),vs&&typeof vs.onPostCommitFiberRoot=="function")try{vs.onPostCommitFiberRoot(ea,j)}catch{}return!0}finally{Si.p=N,Pt.T=I,Vy(c,p)}}function y_(c,p,b){p=cl(b,p),p=Hu(c.stateNode,p,2),c=$l(c,p,2),c!==null&&(il(c,2),Xu(c))}function Ur(c,p,b){if(c.tag===3)y_(c,c,b);else for(;p!==null;){if(p.tag===3){y_(p,c,b);break}else if(p.tag===1){var I=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Js===null||!Js.has(I))){c=cl(b,c),b=Dh(2),I=$l(p,b,2),I!==null&&(Ff(b,I,p,c),il(I,2),Xu(I));break}}p=p.return}}function qp(c,p,b){var I=c.pingCache;if(I===null){I=c.pingCache=new Fi;var N=new Set;I.set(p,N)}else N=I.get(p),N===void 0&&(N=new Set,I.set(p,N));N.has(b)||(Mn=!0,N.add(b),c=jx.bind(null,c,p,b),p.then(c,c))}function jx(c,p,b){var I=c.pingCache;I!==null&&I.delete(p),c.pingedLanes|=c.suspendedLanes&b,c.warmLanes&=~b,Ei===c&&(ui&b)===b&&(Qi===4||Qi===3&&(ui&62914560)===ui&&300>Bs()-fr?(bi&2)===0&&ec(c,0):ws|=b,qi===ui&&(qi=0)),Xu(c)}function mg(c,p){p===0&&(p=el()),c=Ul(c,p),c!==null&&(il(c,p),Xu(c))}function Uy(c){var p=c.memoizedState,b=0;p!==null&&(b=p.retryLane),mg(c,b)}function jy(c,p){var b=0;switch(c.tag){case 31:case 13:var I=c.stateNode,N=c.memoizedState;N!==null&&(b=N.retryLane);break;case 19:I=c.stateNode;break;case 22:I=c.stateNode._retryCache;break;default:throw Error(m(314))}I!==null&&I.delete(p),mg(c,b)}function Gx(c,p){return ls(c,p)}var gg=null,ic=null,v_=!1,Hp=!1,x_=!1,qd=0;function Xu(c){c!==ic&&c.next===null&&(ic===null?gg=ic=c:ic=ic.next=c),Hp=!0,v_||(v_=!0,y1())}function _g(c,p){if(!x_&&Hp){x_=!0;do for(var b=!1,I=gg;I!==null;){if(c!==0){var N=I.pendingLanes;if(N===0)var j=0;else{var ne=I.suspendedLanes,Te=I.pingedLanes;j=(1<<31-Yr(42|c)+1)-1,j&=N&~(ne&~Te),j=j&201326741?j&201326741|1:j?j|2:0}j!==0&&(b=!0,Wx(I,j))}else j=ui,j=va(I,I===Ei?j:0,I.cancelPendingCommit!==null||I.timeoutHandle!==-1),(j&3)===0||xa(I,j)||(b=!0,Wx(I,j));I=I.next}while(b);x_=!1}}function qx(){Gy()}function Gy(){Hp=v_=!1;var c=0;qd!==0&&Jx()&&(c=qd);for(var p=Bs(),b=null,I=gg;I!==null;){var N=I.next,j=Hx(I,p);j===0?(I.next=null,b===null?gg=N:b.next=N,N===null&&(ic=b)):(b=I,(c!==0||(j&3)!==0)&&(Hp=!0)),I=N}Lr!==0&&Lr!==5||_g(c),qd!==0&&(qd=0)}function Hx(c,p){for(var b=c.suspendedLanes,I=c.pingedLanes,N=c.expirationTimes,j=c.pendingLanes&-62914561;0<j;){var ne=31-Yr(j),Te=1<<ne,tt=N[ne];tt===-1?((Te&b)===0||(Te&I)!==0)&&(N[ne]=Ct(Te,p)):tt<=p&&(c.expiredLanes|=Te),j&=~Te}if(p=Ei,b=ui,b=va(c,c===p?b:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),I=c.callbackNode,b===0||c===p&&(Vi===2||Vi===9)||c.cancelPendingCommit!==null)return I!==null&&I!==null&&Fs(I),c.callbackNode=null,c.callbackPriority=0;if((b&3)===0||xa(c,b)){if(p=b&-b,p===c.callbackPriority)return p;switch(I!==null&&Fs(I),Ae(b)){case 2:case 8:b=xo;break;case 32:b=Ja;break;case 268435456:b=jc;break;default:b=Ja}return I=qy.bind(null,c),b=ls(b,I),c.callbackPriority=p,c.callbackNode=b,p}return I!==null&&I!==null&&Fs(I),c.callbackPriority=2,c.callbackNode=null,2}function qy(c,p){if(Lr!==0&&Lr!==5)return c.callbackNode=null,c.callbackPriority=0,null;var b=c.callbackNode;if(fg()&&c.callbackNode!==b)return null;var I=ui;return I=va(c,c===Ei?I:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),I===0?null:(Kl(c,I,p),Hx(c,Bs()),c.callbackNode!=null&&c.callbackNode===b?qy.bind(null,c):null)}function Wx(c,p){if(fg())return null;Kl(c,p,!0)}function y1(){wg(function(){(bi&6)!==0?ls(no,qx):Gy()})}function b_(){if(qd===0){var c=wc;c===0&&(c=_a,_a<<=1,(_a&261888)===0&&(_a=256)),qd=c}return qd}function Hy(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:uc(""+c)}function Wy(c,p){var b=p.ownerDocument.createElement("input");return b.name=p.name,b.value=p.value,c.id&&b.setAttribute("form",c.id),p.parentNode.insertBefore(b,p),c=new FormData(c),b.parentNode.removeChild(b),c}function $x(c,p,b,I,N){if(p==="submit"&&b&&b.stateNode===N){var j=Hy((N[At]||null).action),ne=I.submitter;ne&&(p=(p=ne[At]||null)?Hy(p.formAction):ne.getAttribute("formAction"),p!==null&&(j=p,ne=null));var Te=new ra("action","action",null,I,N);c.push({event:Te,listeners:[{instance:null,listener:function(){if(I.defaultPrevented){if(qd!==0){var tt=ne?Wy(N,ne):new FormData(N);zd(b,{pending:!0,data:tt,method:N.method,action:j},null,tt)}}else typeof j=="function"&&(Te.preventDefault(),tt=ne?Wy(N,ne):new FormData(N),zd(b,{pending:!0,data:tt,method:N.method,action:j},j,tt))},currentTarget:N}]})}}for(var w_=0;w_<bf.length;w_++){var T_=bf[w_],Zx=T_.toLowerCase(),$y=T_[0].toUpperCase()+T_.slice(1);Sa(Zx,"on"+$y)}Sa(km,"onAnimationEnd"),Sa(Nm,"onAnimationIteration"),Sa(Ru,"onAnimationStart"),Sa("dblclick","onDoubleClick"),Sa("focusin","onFocus"),Sa("focusout","onBlur"),Sa(xf,"onTransitionRun"),Sa(Fm,"onTransitionStart"),Sa(Bm,"onTransitionCancel"),Sa(dh,"onTransitionEnd"),sr("onMouseEnter",["mouseout","mouseover"]),sr("onMouseLeave",["mouseout","mouseover"]),sr("onPointerEnter",["pointerout","pointerover"]),sr("onPointerLeave",["pointerout","pointerover"]),rr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rr("onBeforeInput",["compositionend","keypress","textInput","paste"]),rr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_o=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lc));function Zy(c,p){p=(p&4)!==0;for(var b=0;b<c.length;b++){var I=c[b],N=I.event;I=I.listeners;e:{var j=void 0;if(p)for(var ne=I.length-1;0<=ne;ne--){var Te=I[ne],tt=Te.instance,Nt=Te.currentTarget;if(Te=Te.listener,tt!==j&&N.isPropagationStopped())break e;j=Te,N.currentTarget=Nt;try{j(N)}catch(Jt){Vo(Jt)}N.currentTarget=null,j=tt}else for(ne=0;ne<I.length;ne++){if(Te=I[ne],tt=Te.instance,Nt=Te.currentTarget,Te=Te.listener,tt!==j&&N.isPropagationStopped())break e;j=Te,N.currentTarget=Nt;try{j(N)}catch(Jt){Vo(Jt)}N.currentTarget=null,j=tt}}}}function ar(c,p){var b=p[di];b===void 0&&(b=p[di]=new Set);var I=c+"__bubble";b.has(I)||(Xx(p,c,2,!1),b.add(I))}function Xy(c,p,b){var I=0;p&&(I|=4),Xx(b,c,I,p)}var E_="_reactListening"+Math.random().toString(36).slice(2);function Yy(c){if(!c[E_]){c[E_]=!0,Vn.forEach(function(b){b!=="selectionchange"&&(_o.has(b)||Xy(b,!1,c),Xy(b,!0,c))});var p=c.nodeType===9?c:c.ownerDocument;p===null||p[E_]||(p[E_]=!0,Xy("selectionchange",!1,p))}}function Xx(c,p,b,I){switch(dv(p)){case 2:var N=U_;break;case 8:N=a0;break;default:N=hv}b=N.bind(null,p,b,c),N=void 0,!Eu||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(N=!0),I?N!==void 0?c.addEventListener(p,b,{capture:!0,passive:N}):c.addEventListener(p,b,!0):N!==void 0?c.addEventListener(p,b,{passive:N}):c.addEventListener(p,b,!1)}function Hd(c,p,b,I,N){var j=I;if((p&1)===0&&(p&2)===0&&I!==null)e:for(;;){if(I===null)return;var ne=I.tag;if(ne===3||ne===4){var Te=I.stateNode.containerInfo;if(Te===N)break;if(ne===4)for(ne=I.return;ne!==null;){var tt=ne.tag;if((tt===3||tt===4)&&ne.stateNode.containerInfo===N)return;ne=ne.return}for(;Te!==null;){if(ne=Ln(Te),ne===null)return;if(tt=ne.tag,tt===5||tt===6||tt===26||tt===27){I=j=ne;continue e}Te=Te.parentNode}}I=I.return}zl(function(){var Nt=j,Jt=Ta(b),ai=[];e:{var Vt=fh.get(c);if(Vt!==void 0){var qt=ra,Ji=c;switch(c){case"keypress":if(dc(b)===0)break e;case"keydown":case"keyup":qt=Ao;break;case"focusin":Ji="focus",qt=In;break;case"focusout":Ji="blur",qt=In;break;case"beforeblur":case"afterblur":qt=In;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=So;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=oh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=ee;break;case km:case Nm:case Ru:qt=_f;break;case dh:qt=Ce;break;case"scroll":case"scrollend":qt=sa;break;case"wheel":qt=Gt;break;case"copy":case"cut":case"paste":qt=Ii;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=wn;break;case"toggle":case"beforetoggle":qt=Un}var On=(p&4)!==0,Zr=!On&&(c==="scroll"||c==="scrollend"),bt=On?Vt!==null?Vt+"Capture":null:Vt;On=[];for(var ct=Nt,Ft;ct!==null;){var ni=ct;if(Ft=ni.stateNode,ni=ni.tag,ni!==5&&ni!==26&&ni!==27||Ft===null||bt===null||(ni=on(ct,bt),ni!=null&&On.push(Wp(ct,ni,Ft))),Zr)break;ct=ct.return}0<On.length&&(Vt=new qt(Vt,Ji,null,b,Jt),ai.push({event:Vt,listeners:On}))}}if((p&7)===0){e:{if(Vt=c==="mouseover"||c==="pointerover",qt=c==="mouseout"||c==="pointerout",Vt&&b!==wo&&(Ji=b.relatedTarget||b.fromElement)&&(Ln(Ji)||Ji[gt]))break e;if((qt||Vt)&&(Vt=Jt.window===Jt?Jt:(Vt=Jt.ownerDocument)?Vt.defaultView||Vt.parentWindow:window,qt?(Ji=b.relatedTarget||b.toElement,qt=Nt,Ji=Ji?Ln(Ji):null,Ji!==null&&(Zr=C(Ji),On=Ji.tag,Ji!==Zr||On!==5&&On!==27&&On!==6)&&(Ji=null)):(qt=null,Ji=Nt),qt!==Ji)){if(On=So,ni="onMouseLeave",bt="onMouseEnter",ct="mouse",(c==="pointerout"||c==="pointerover")&&(On=wn,ni="onPointerLeave",bt="onPointerEnter",ct="pointer"),Zr=qt==null?Vt:Zn(qt),Ft=Ji==null?Vt:Zn(Ji),Vt=new On(ni,ct+"leave",qt,b,Jt),Vt.target=Zr,Vt.relatedTarget=Ft,ni=null,Ln(Jt)===Nt&&(On=new On(bt,ct+"enter",Ji,b,Jt),On.target=Ft,On.relatedTarget=Zr,ni=On),Zr=ni,qt&&Ji)t:{for(On=yg,bt=qt,ct=Ji,Ft=0,ni=bt;ni;ni=On(ni))Ft++;ni=0;for(var Tn=ct;Tn;Tn=On(Tn))ni++;for(;0<Ft-ni;)bt=On(bt),Ft--;for(;0<ni-Ft;)ct=On(ct),ni--;for(;Ft--;){if(bt===ct||ct!==null&&bt===ct.alternate){On=bt;break t}bt=On(bt),ct=On(ct)}On=null}else On=null;qt!==null&&Yx(ai,Vt,qt,On,!1),Ji!==null&&Zr!==null&&Yx(ai,Zr,Ji,On,!0)}}e:{if(Vt=Nt?Zn(Nt):window,qt=Vt.nodeName&&Vt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&Vt.type==="file")var jr=ad;else if(sd(Vt))if(ld)jr=t_;else{jr=Au;var dn=Bo}else qt=Vt.nodeName,!qt||qt.toLowerCase()!=="input"||Vt.type!=="checkbox"&&Vt.type!=="radio"?Nt&&cc(Nt.elementType)&&(jr=ad):jr=oo;if(jr&&(jr=jr(c,Nt))){Pi(ai,jr,b,Jt);break e}dn&&dn(c,Vt,Nt),c==="focusout"&&Nt&&Vt.type==="number"&&Nt.memoizedProps.value!=null&&wu(Vt,"number",Vt.value)}switch(dn=Nt?Zn(Nt):window,c){case"focusin":(sd(dn)||dn.contentEditable==="true")&&($c=dn,_c=Nt,Vl=null);break;case"focusout":Vl=_c=$c=null;break;case"mousedown":zm=!0;break;case"contextmenu":case"mouseup":case"dragend":zm=!1,n_(ai,b,Jt);break;case"selectionchange":if(mp)break;case"keydown":case"keyup":n_(ai,b,Jt)}var er;if(yr)e:{switch(c){case"compositionstart":var Ar="onCompositionStart";break e;case"compositionend":Ar="onCompositionEnd";break e;case"compositionupdate":Ar="onCompositionUpdate";break e}Ar=void 0}else ns?Su(c,b)&&(Ar="onCompositionEnd"):c==="keydown"&&b.keyCode===229&&(Ar="onCompositionStart");Ar&&(ps&&b.locale!=="ko"&&(ns||Ar!=="onCompositionStart"?Ar==="onCompositionEnd"&&ns&&(er=Gc()):(Pa=Jt,rl="value"in Pa?Pa.value:Pa.textContent,ns=!0)),dn=Yu(Nt,Ar),0<dn.length&&(Ar=new Ds(Ar,c,null,b,Jt),ai.push({event:Ar,listeners:dn}),er?Ar.data=er:(er=Fl(b),er!==null&&(Ar.data=er)))),(er=oa?aa(c,b):Xi(c,b))&&(Ar=Yu(Nt,"onBeforeInput"),0<Ar.length&&(dn=new Ds("onBeforeInput","beforeinput",null,b,Jt),ai.push({event:dn,listeners:Ar}),dn.data=er)),$x(ai,c,Nt,b,Jt)}Zy(ai,p)})}function Wp(c,p,b){return{instance:c,listener:p,currentTarget:b}}function Yu(c,p){for(var b=p+"Capture",I=[];c!==null;){var N=c,j=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||j===null||(N=on(c,b),N!=null&&I.unshift(Wp(c,N,j)),N=on(c,p),N!=null&&I.push(Wp(c,N,j))),c.tag===3)return I;c=c.return}return[]}function yg(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function Yx(c,p,b,I,N){for(var j=p._reactName,ne=[];b!==null&&b!==I;){var Te=b,tt=Te.alternate,Nt=Te.stateNode;if(Te=Te.tag,tt!==null&&tt===I)break;Te!==5&&Te!==26&&Te!==27||Nt===null||(tt=Nt,N?(Nt=on(b,j),Nt!=null&&ne.unshift(Wp(b,Nt,tt))):N||(Nt=on(b,j),Nt!=null&&ne.push(Wp(b,Nt,tt)))),b=b.return}ne.length!==0&&c.push({event:p,listeners:ne})}var v1=/\r\n?/g,x1=/\u0000|\uFFFD/g;function Kx(c){return(typeof c=="string"?c:""+c).replace(v1,`
`).replace(x1,"")}function Qx(c,p){return p=Kx(p),Kx(c)===p}function us(c,p,b,I,N,j){switch(b){case"children":typeof I=="string"?p==="body"||p==="textarea"&&I===""||xs(c,I):(typeof I=="number"||typeof I=="bigint")&&p!=="body"&&xs(c,""+I);break;case"className":Kr(c,"class",I);break;case"tabIndex":Kr(c,"tabindex",I);break;case"dir":case"role":case"viewBox":case"width":case"height":Kr(c,b,I);break;case"style":sh(c,I,j);break;case"data":if(p!=="object"){Kr(c,"data",I);break}case"src":case"href":if(I===""&&(p!=="a"||b!=="href")){c.removeAttribute(b);break}if(I==null||typeof I=="function"||typeof I=="symbol"||typeof I=="boolean"){c.removeAttribute(b);break}I=uc(""+I),c.setAttribute(b,I);break;case"action":case"formAction":if(typeof I=="function"){c.setAttribute(b,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof j=="function"&&(b==="formAction"?(p!=="input"&&us(c,p,"name",N.name,N,null),us(c,p,"formEncType",N.formEncType,N,null),us(c,p,"formMethod",N.formMethod,N,null),us(c,p,"formTarget",N.formTarget,N,null)):(us(c,p,"encType",N.encType,N,null),us(c,p,"method",N.method,N,null),us(c,p,"target",N.target,N,null)));if(I==null||typeof I=="symbol"||typeof I=="boolean"){c.removeAttribute(b);break}I=uc(""+I),c.setAttribute(b,I);break;case"onClick":I!=null&&(c.onclick=Fo);break;case"onScroll":I!=null&&ar("scroll",c);break;case"onScrollEnd":I!=null&&ar("scrollend",c);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(m(61));if(b=I.__html,b!=null){if(N.children!=null)throw Error(m(60));c.innerHTML=b}}break;case"multiple":c.multiple=I&&typeof I!="function"&&typeof I!="symbol";break;case"muted":c.muted=I&&typeof I!="function"&&typeof I!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(I==null||typeof I=="function"||typeof I=="boolean"||typeof I=="symbol"){c.removeAttribute("xlink:href");break}b=uc(""+I),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",b);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":I!=null&&typeof I!="function"&&typeof I!="symbol"?c.setAttribute(b,""+I):c.removeAttribute(b);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":I&&typeof I!="function"&&typeof I!="symbol"?c.setAttribute(b,""):c.removeAttribute(b);break;case"capture":case"download":I===!0?c.setAttribute(b,""):I!==!1&&I!=null&&typeof I!="function"&&typeof I!="symbol"?c.setAttribute(b,I):c.removeAttribute(b);break;case"cols":case"rows":case"size":case"span":I!=null&&typeof I!="function"&&typeof I!="symbol"&&!isNaN(I)&&1<=I?c.setAttribute(b,I):c.removeAttribute(b);break;case"rowSpan":case"start":I==null||typeof I=="function"||typeof I=="symbol"||isNaN(I)?c.removeAttribute(b):c.setAttribute(b,I);break;case"popover":ar("beforetoggle",c),ar("toggle",c),ba(c,"popover",I);break;case"xlinkActuate":ds(c,"http://www.w3.org/1999/xlink","xlink:actuate",I);break;case"xlinkArcrole":ds(c,"http://www.w3.org/1999/xlink","xlink:arcrole",I);break;case"xlinkRole":ds(c,"http://www.w3.org/1999/xlink","xlink:role",I);break;case"xlinkShow":ds(c,"http://www.w3.org/1999/xlink","xlink:show",I);break;case"xlinkTitle":ds(c,"http://www.w3.org/1999/xlink","xlink:title",I);break;case"xlinkType":ds(c,"http://www.w3.org/1999/xlink","xlink:type",I);break;case"xmlBase":ds(c,"http://www.w3.org/XML/1998/namespace","xml:base",I);break;case"xmlLang":ds(c,"http://www.w3.org/XML/1998/namespace","xml:lang",I);break;case"xmlSpace":ds(c,"http://www.w3.org/XML/1998/namespace","xml:space",I);break;case"is":ba(c,"is",I);break;case"innerText":case"textContent":break;default:(!(2<b.length)||b[0]!=="o"&&b[0]!=="O"||b[1]!=="n"&&b[1]!=="N")&&(b=Ol.get(b)||b,ba(c,b,I))}}function Ky(c,p,b,I,N,j){switch(b){case"style":sh(c,I,j);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(m(61));if(b=I.__html,b!=null){if(N.children!=null)throw Error(m(60));c.innerHTML=b}}break;case"children":typeof I=="string"?xs(c,I):(typeof I=="number"||typeof I=="bigint")&&xs(c,""+I);break;case"onScroll":I!=null&&ar("scroll",c);break;case"onScrollEnd":I!=null&&ar("scrollend",c);break;case"onClick":I!=null&&(c.onclick=Fo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Rn.hasOwnProperty(b))e:{if(b[0]==="o"&&b[1]==="n"&&(N=b.endsWith("Capture"),p=b.slice(2,N?b.length-7:void 0),j=c[At]||null,j=j!=null?j[b]:null,typeof j=="function"&&c.removeEventListener(p,j,N),typeof I=="function")){typeof j!="function"&&j!==null&&(b in c?c[b]=null:c.hasAttribute(b)&&c.removeAttribute(b)),c.addEventListener(p,I,N);break e}b in c?c[b]=I:I===!0?c.setAttribute(b,""):ba(c,b,I)}}}function Do(c,p,b){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ar("error",c),ar("load",c);var I=!1,N=!1,j;for(j in b)if(b.hasOwnProperty(j)){var ne=b[j];if(ne!=null)switch(j){case"src":I=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(m(137,p));default:us(c,p,j,ne,b,null)}}N&&us(c,p,"srcSet",b.srcSet,b,null),I&&us(c,p,"src",b.src,b,null);return;case"input":ar("invalid",c);var Te=j=ne=N=null,tt=null,Nt=null;for(I in b)if(b.hasOwnProperty(I)){var Jt=b[I];if(Jt!=null)switch(I){case"name":N=Jt;break;case"type":ne=Jt;break;case"checked":tt=Jt;break;case"defaultChecked":Nt=Jt;break;case"value":j=Jt;break;case"defaultValue":Te=Jt;break;case"children":case"dangerouslySetInnerHTML":if(Jt!=null)throw Error(m(137,p));break;default:us(c,p,I,Jt,b,null)}}id(c,j,Te,tt,Nt,ne,N,!1);return;case"select":ar("invalid",c),I=ne=j=null;for(N in b)if(b.hasOwnProperty(N)&&(Te=b[N],Te!=null))switch(N){case"value":j=Te;break;case"defaultValue":ne=Te;break;case"multiple":I=Te;default:us(c,p,N,Te,b,null)}p=j,b=ne,c.multiple=!!I,p!=null?Ks(c,!!I,p,!1):b!=null&&Ks(c,!!I,b,!0);return;case"textarea":ar("invalid",c),j=N=I=null;for(ne in b)if(b.hasOwnProperty(ne)&&(Te=b[ne],Te!=null))switch(ne){case"value":I=Te;break;case"defaultValue":N=Te;break;case"children":j=Te;break;case"dangerouslySetInnerHTML":if(Te!=null)throw Error(m(91));break;default:us(c,p,ne,Te,b,null)}No(c,I,N,j);return;case"option":for(tt in b)if(b.hasOwnProperty(tt)&&(I=b[tt],I!=null))switch(tt){case"selected":c.selected=I&&typeof I!="function"&&typeof I!="symbol";break;default:us(c,p,tt,I,b,null)}return;case"dialog":ar("beforetoggle",c),ar("toggle",c),ar("cancel",c),ar("close",c);break;case"iframe":case"object":ar("load",c);break;case"video":case"audio":for(I=0;I<Lc.length;I++)ar(Lc[I],c);break;case"image":ar("error",c),ar("load",c);break;case"details":ar("toggle",c);break;case"embed":case"source":case"link":ar("error",c),ar("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Nt in b)if(b.hasOwnProperty(Nt)&&(I=b[Nt],I!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":throw Error(m(137,p));default:us(c,p,Nt,I,b,null)}return;default:if(cc(p)){for(Jt in b)b.hasOwnProperty(Jt)&&(I=b[Jt],I!==void 0&&Ky(c,p,Jt,I,b,void 0));return}}for(Te in b)b.hasOwnProperty(Te)&&(I=b[Te],I!=null&&us(c,p,Te,I,b,null))}function b1(c,p,b,I){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,j=null,ne=null,Te=null,tt=null,Nt=null,Jt=null;for(qt in b){var ai=b[qt];if(b.hasOwnProperty(qt)&&ai!=null)switch(qt){case"checked":break;case"value":break;case"defaultValue":tt=ai;default:I.hasOwnProperty(qt)||us(c,p,qt,null,I,ai)}}for(var Vt in I){var qt=I[Vt];if(ai=b[Vt],I.hasOwnProperty(Vt)&&(qt!=null||ai!=null))switch(Vt){case"type":j=qt;break;case"name":N=qt;break;case"checked":Nt=qt;break;case"defaultChecked":Jt=qt;break;case"value":ne=qt;break;case"defaultValue":Te=qt;break;case"children":case"dangerouslySetInnerHTML":if(qt!=null)throw Error(m(137,p));break;default:qt!==ai&&us(c,p,Vt,qt,I,ai)}}ia(c,ne,Te,tt,Nt,Jt,j,N);return;case"select":qt=ne=Te=Vt=null;for(j in b)if(tt=b[j],b.hasOwnProperty(j)&&tt!=null)switch(j){case"value":break;case"multiple":qt=tt;default:I.hasOwnProperty(j)||us(c,p,j,null,I,tt)}for(N in I)if(j=I[N],tt=b[N],I.hasOwnProperty(N)&&(j!=null||tt!=null))switch(N){case"value":Vt=j;break;case"defaultValue":Te=j;break;case"multiple":ne=j;default:j!==tt&&us(c,p,N,j,I,tt)}p=Te,b=ne,I=qt,Vt!=null?Ks(c,!!b,Vt,!1):!!I!=!!b&&(p!=null?Ks(c,!!b,p,!0):Ks(c,!!b,b?[]:"",!1));return;case"textarea":qt=Vt=null;for(Te in b)if(N=b[Te],b.hasOwnProperty(Te)&&N!=null&&!I.hasOwnProperty(Te))switch(Te){case"value":break;case"children":break;default:us(c,p,Te,null,I,N)}for(ne in I)if(N=I[ne],j=b[ne],I.hasOwnProperty(ne)&&(N!=null||j!=null))switch(ne){case"value":Vt=N;break;case"defaultValue":qt=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(m(91));break;default:N!==j&&us(c,p,ne,N,I,j)}wa(c,Vt,qt);return;case"option":for(var Ji in b)if(Vt=b[Ji],b.hasOwnProperty(Ji)&&Vt!=null&&!I.hasOwnProperty(Ji))switch(Ji){case"selected":c.selected=!1;break;default:us(c,p,Ji,null,I,Vt)}for(tt in I)if(Vt=I[tt],qt=b[tt],I.hasOwnProperty(tt)&&Vt!==qt&&(Vt!=null||qt!=null))switch(tt){case"selected":c.selected=Vt&&typeof Vt!="function"&&typeof Vt!="symbol";break;default:us(c,p,tt,Vt,I,qt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var On in b)Vt=b[On],b.hasOwnProperty(On)&&Vt!=null&&!I.hasOwnProperty(On)&&us(c,p,On,null,I,Vt);for(Nt in I)if(Vt=I[Nt],qt=b[Nt],I.hasOwnProperty(Nt)&&Vt!==qt&&(Vt!=null||qt!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":if(Vt!=null)throw Error(m(137,p));break;default:us(c,p,Nt,Vt,I,qt)}return;default:if(cc(p)){for(var Zr in b)Vt=b[Zr],b.hasOwnProperty(Zr)&&Vt!==void 0&&!I.hasOwnProperty(Zr)&&Ky(c,p,Zr,void 0,I,Vt);for(Jt in I)Vt=I[Jt],qt=b[Jt],!I.hasOwnProperty(Jt)||Vt===qt||Vt===void 0&&qt===void 0||Ky(c,p,Jt,Vt,I,qt);return}}for(var bt in b)Vt=b[bt],b.hasOwnProperty(bt)&&Vt!=null&&!I.hasOwnProperty(bt)&&us(c,p,bt,null,I,Vt);for(ai in I)Vt=I[ai],qt=b[ai],!I.hasOwnProperty(ai)||Vt===qt||Vt==null&&qt==null||us(c,p,ai,Vt,I,qt)}function Qy(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function vg(){if(typeof performance.getEntriesByType=="function"){for(var c=0,p=0,b=performance.getEntriesByType("resource"),I=0;I<b.length;I++){var N=b[I],j=N.transferSize,ne=N.initiatorType,Te=N.duration;if(j&&Te&&Qy(ne)){for(ne=0,Te=N.responseEnd,I+=1;I<b.length;I++){var tt=b[I],Nt=tt.startTime;if(Nt>Te)break;var Jt=tt.transferSize,ai=tt.initiatorType;Jt&&Qy(ai)&&(tt=tt.responseEnd,ne+=Jt*(tt<Te?1:(Te-Nt)/(tt-Nt)))}if(--I,p+=8*(j+ne)/(N.duration/1e3),c++,10<c)break}}if(0<c)return p/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var Jy=null,Is=null;function Vh(c){return c.nodeType===9?c:c.ownerDocument}function ev(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xg(c,p){if(c===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&p==="foreignObject"?0:c}function $p(c,p){return c==="textarea"||c==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var qf=null;function Jx(){var c=window.event;return c&&c.type==="popstate"?c===qf?!1:(qf=c,!0):(qf=null,!1)}var tv=typeof setTimeout=="function"?setTimeout:void 0,bg=typeof clearTimeout=="function"?clearTimeout:void 0,S_=typeof Promise=="function"?Promise:void 0,wg=typeof queueMicrotask=="function"?queueMicrotask:typeof S_<"u"?function(c){return S_.resolve(null).then(c).catch(w1)}:tv;function w1(c){setTimeout(function(){throw c})}function Uh(c){return c==="head"}function A_(c,p){var b=p,I=0;do{var N=b.nextSibling;if(c.removeChild(b),N&&N.nodeType===8)if(b=N.data,b==="/$"||b==="/&"){if(I===0){c.removeChild(N),$f(p);return}I--}else if(b==="$"||b==="$?"||b==="$~"||b==="$!"||b==="&")I++;else if(b==="html")Hf(c.ownerDocument.documentElement);else if(b==="head"){b=c.ownerDocument.head,Hf(b);for(var j=b.firstChild;j;){var ne=j.nextSibling,Te=j.nodeName;j[Wi]||Te==="SCRIPT"||Te==="STYLE"||Te==="LINK"&&j.rel.toLowerCase()==="stylesheet"||b.removeChild(j),j=ne}}else b==="body"&&Hf(c.ownerDocument.body);b=N}while(b);$f(p)}function I_(c,p){var b=c;c=0;do{var I=b.nextSibling;if(b.nodeType===1?p?(b._stashedDisplay=b.style.display,b.style.display="none"):(b.style.display=b._stashedDisplay||"",b.getAttribute("style")===""&&b.removeAttribute("style")):b.nodeType===3&&(p?(b._stashedText=b.nodeValue,b.nodeValue=""):b.nodeValue=b._stashedText||""),I&&I.nodeType===8)if(b=I.data,b==="/$"){if(c===0)break;c--}else b!=="$"&&b!=="$?"&&b!=="$~"&&b!=="$!"||c++;b=I}while(b)}function C_(c){var p=c.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var b=p;switch(p=p.nextSibling,b.nodeName){case"HTML":case"HEAD":case"BODY":C_(b),hn(b);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(b.rel.toLowerCase()==="stylesheet")continue}c.removeChild(b)}}function jh(c,p,b,I){for(;c.nodeType===1;){var N=b;if(c.nodeName.toLowerCase()!==p.toLowerCase()){if(!I&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(I){if(!c[Wi])switch(p){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(j=c.getAttribute("rel"),j==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(j!==N.rel||c.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||c.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||c.getAttribute("title")!==(N.title==null?null:N.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(j=c.getAttribute("src"),(j!==(N.src==null?null:N.src)||c.getAttribute("type")!==(N.type==null?null:N.type)||c.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&j&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(p==="input"&&c.type==="hidden"){var j=N.name==null?null:""+N.name;if(N.type==="hidden"&&c.getAttribute("name")===j)return c}else return c;if(c=qa(c.nextSibling),c===null)break}return null}function T1(c,p,b){if(p==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!b||(c=qa(c.nextSibling),c===null))return null;return c}function Aa(c,p){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!p||(c=qa(c.nextSibling),c===null))return null;return c}function R_(c){return c.data==="$?"||c.data==="$~"}function M_(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function e0(c,p){var b=c.ownerDocument;if(c.data==="$~")c._reactRetry=p;else if(c.data!=="$?"||b.readyState!=="loading")p();else{var I=function(){p(),b.removeEventListener("DOMContentLoaded",I)};b.addEventListener("DOMContentLoaded",I),c._reactRetry=I}}function qa(c){for(;c!=null;c=c.nextSibling){var p=c.nodeType;if(p===1||p===3)break;if(p===8){if(p=c.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return c}var iv=null;function t0(c){c=c.nextSibling;for(var p=0;c;){if(c.nodeType===8){var b=c.data;if(b==="/$"||b==="/&"){if(p===0)return qa(c.nextSibling);p--}else b!=="$"&&b!=="$!"&&b!=="$?"&&b!=="$~"&&b!=="&"||p++}c=c.nextSibling}return null}function P_(c){c=c.previousSibling;for(var p=0;c;){if(c.nodeType===8){var b=c.data;if(b==="$"||b==="$!"||b==="$?"||b==="$~"||b==="&"){if(p===0)return c;p--}else b!=="/$"&&b!=="/&"||p++}c=c.previousSibling}return null}function nv(c,p,b){switch(p=Vh(b),c){case"html":if(c=p.documentElement,!c)throw Error(m(452));return c;case"head":if(c=p.head,!c)throw Error(m(453));return c;case"body":if(c=p.body,!c)throw Error(m(454));return c;default:throw Error(m(451))}}function Hf(c){for(var p=c.attributes;p.length;)c.removeAttributeNode(p[0]);hn(c)}var yl=new Map,rv=new Set;function Tg(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Ku=Si.d;Si.d={f:i0,r:D_,D:E1,C:S1,L:A1,m:I1,X:R1,S:C1,M:M1};function i0(){var c=Ku.f(),p=Jl();return c||p}function D_(c){var p=Ki(c);p!==null&&p.tag===5&&p.type==="form"?Lf(p):Ku.r(c)}var Ha=typeof document>"u"?null:document;function sv(c,p,b){var I=Ha;if(I&&typeof p=="string"&&p){var N=ko(p);N='link[rel="'+c+'"][href="'+N+'"]',typeof b=="string"&&(N+='[crossorigin="'+b+'"]'),rv.has(N)||(rv.add(N),c={rel:c,crossOrigin:b,href:p},I.querySelector(N)===null&&(p=I.createElement("link"),Do(p,"link",c),Gn(p),I.head.appendChild(p)))}}function E1(c){Ku.D(c),sv("dns-prefetch",c,null)}function S1(c,p){Ku.C(c,p),sv("preconnect",c,p)}function A1(c,p,b){Ku.L(c,p,b);var I=Ha;if(I&&c&&p){var N='link[rel="preload"][as="'+ko(p)+'"]';p==="image"&&b&&b.imageSrcSet?(N+='[imagesrcset="'+ko(b.imageSrcSet)+'"]',typeof b.imageSizes=="string"&&(N+='[imagesizes="'+ko(b.imageSizes)+'"]')):N+='[href="'+ko(c)+'"]';var j=N;switch(p){case"style":j=Wf(c);break;case"script":j=Wd(c)}yl.has(j)||(c=ce({rel:"preload",href:p==="image"&&b&&b.imageSrcSet?void 0:c,as:p},b),yl.set(j,c),I.querySelector(N)!==null||p==="style"&&I.querySelector(Xp(j))||p==="script"&&I.querySelector($d(j))||(p=I.createElement("link"),Do(p,"link",c),Gn(p),I.head.appendChild(p)))}}function I1(c,p){Ku.m(c,p);var b=Ha;if(b&&c){var I=p&&typeof p.as=="string"?p.as:"script",N='link[rel="modulepreload"][as="'+ko(I)+'"][href="'+ko(c)+'"]',j=N;switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":j=Wd(c)}if(!yl.has(j)&&(c=ce({rel:"modulepreload",href:c},p),yl.set(j,c),b.querySelector(N)===null)){switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(b.querySelector($d(j)))return}I=b.createElement("link"),Do(I,"link",c),Gn(I),b.head.appendChild(I)}}}function C1(c,p,b){Ku.S(c,p,b);var I=Ha;if(I&&c){var N=Cr(I).hoistableStyles,j=Wf(c);p=p||"default";var ne=N.get(j);if(!ne){var Te={loading:0,preload:null};if(ne=I.querySelector(Xp(j)))Te.loading=5;else{c=ce({rel:"stylesheet",href:c,"data-precedence":p},b),(b=yl.get(j))&&Sg(c,b);var tt=ne=I.createElement("link");Gn(tt),Do(tt,"link",c),tt._p=new Promise(function(Nt,Jt){tt.onload=Nt,tt.onerror=Jt}),tt.addEventListener("load",function(){Te.loading|=1}),tt.addEventListener("error",function(){Te.loading|=2}),Te.loading|=4,O_(ne,p,I)}ne={type:"stylesheet",instance:ne,count:1,state:Te},N.set(j,ne)}}}function R1(c,p){Ku.X(c,p);var b=Ha;if(b&&c){var I=Cr(b).hoistableScripts,N=Wd(c),j=I.get(N);j||(j=b.querySelector($d(N)),j||(c=ce({src:c,async:!0},p),(p=yl.get(N))&&L_(c,p),j=b.createElement("script"),Gn(j),Do(j,"link",c),b.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},I.set(N,j))}}function M1(c,p){Ku.M(c,p);var b=Ha;if(b&&c){var I=Cr(b).hoistableScripts,N=Wd(c),j=I.get(N);j||(j=b.querySelector($d(N)),j||(c=ce({src:c,async:!0,type:"module"},p),(p=yl.get(N))&&L_(c,p),j=b.createElement("script"),Gn(j),Do(j,"link",c),b.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},I.set(N,j))}}function Zp(c,p,b,I){var N=(N=Qt.current)?Tg(N):null;if(!N)throw Error(m(446));switch(c){case"meta":case"title":return null;case"style":return typeof b.precedence=="string"&&typeof b.href=="string"?(p=Wf(b.href),b=Cr(N).hoistableStyles,I=b.get(p),I||(I={type:"style",instance:null,count:0,state:null},b.set(p,I)),I):{type:"void",instance:null,count:0,state:null};case"link":if(b.rel==="stylesheet"&&typeof b.href=="string"&&typeof b.precedence=="string"){c=Wf(b.href);var j=Cr(N).hoistableStyles,ne=j.get(c);if(ne||(N=N.ownerDocument||N,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},j.set(c,ne),(j=N.querySelector(Xp(c)))&&!j._p&&(ne.instance=j,ne.state.loading=5),yl.has(c)||(b={rel:"preload",as:"style",href:b.href,crossOrigin:b.crossOrigin,integrity:b.integrity,media:b.media,hrefLang:b.hrefLang,referrerPolicy:b.referrerPolicy},yl.set(c,b),j||n0(N,c,b,ne.state))),p&&I===null)throw Error(m(528,""));return ne}if(p&&I!==null)throw Error(m(529,""));return null;case"script":return p=b.async,b=b.src,typeof b=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=Wd(b),b=Cr(N).hoistableScripts,I=b.get(p),I||(I={type:"script",instance:null,count:0,state:null},b.set(p,I)),I):{type:"void",instance:null,count:0,state:null};default:throw Error(m(444,c))}}function Wf(c){return'href="'+ko(c)+'"'}function Xp(c){return'link[rel="stylesheet"]['+c+"]"}function Eg(c){return ce({},c,{"data-precedence":c.precedence,precedence:null})}function n0(c,p,b,I){c.querySelector('link[rel="preload"][as="style"]['+p+"]")?I.loading=1:(p=c.createElement("link"),I.preload=p,p.addEventListener("load",function(){return I.loading|=1}),p.addEventListener("error",function(){return I.loading|=2}),Do(p,"link",b),Gn(p),c.head.appendChild(p))}function Wd(c){return'[src="'+ko(c)+'"]'}function $d(c){return"script[async]"+c}function ov(c,p,b){if(p.count++,p.instance===null)switch(p.type){case"style":var I=c.querySelector('style[data-href~="'+ko(b.href)+'"]');if(I)return p.instance=I,Gn(I),I;var N=ce({},b,{"data-href":b.href,"data-precedence":b.precedence,href:null,precedence:null});return I=(c.ownerDocument||c).createElement("style"),Gn(I),Do(I,"style",N),O_(I,b.precedence,c),p.instance=I;case"stylesheet":N=Wf(b.href);var j=c.querySelector(Xp(N));if(j)return p.state.loading|=4,p.instance=j,Gn(j),j;I=Eg(b),(N=yl.get(N))&&Sg(I,N),j=(c.ownerDocument||c).createElement("link"),Gn(j);var ne=j;return ne._p=new Promise(function(Te,tt){ne.onload=Te,ne.onerror=tt}),Do(j,"link",I),p.state.loading|=4,O_(j,b.precedence,c),p.instance=j;case"script":return j=Wd(b.src),(N=c.querySelector($d(j)))?(p.instance=N,Gn(N),N):(I=b,(N=yl.get(j))&&(I=ce({},b),L_(I,N)),c=c.ownerDocument||c,N=c.createElement("script"),Gn(N),Do(N,"link",I),c.head.appendChild(N),p.instance=N);case"void":return null;default:throw Error(m(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(I=p.instance,p.state.loading|=4,O_(I,b.precedence,c));return p.instance}function O_(c,p,b){for(var I=b.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=I.length?I[I.length-1]:null,j=N,ne=0;ne<I.length;ne++){var Te=I[ne];if(Te.dataset.precedence===p)j=Te;else if(j!==N)break}j?j.parentNode.insertBefore(c,j.nextSibling):(p=b.nodeType===9?b.head:b,p.insertBefore(c,p.firstChild))}function Sg(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.title==null&&(c.title=p.title)}function L_(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.integrity==null&&(c.integrity=p.integrity)}var Ag=null;function z_(c,p,b){if(Ag===null){var I=new Map,N=Ag=new Map;N.set(b,I)}else N=Ag,I=N.get(b),I||(I=new Map,N.set(b,I));if(I.has(c))return I;for(I.set(c,null),b=b.getElementsByTagName(c),N=0;N<b.length;N++){var j=b[N];if(!(j[Wi]||j[Xe]||c==="link"&&j.getAttribute("rel")==="stylesheet")&&j.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=j.getAttribute(p)||"";ne=c+ne;var Te=I.get(ne);Te?Te.push(j):I.set(ne,[j])}}return I}function k_(c,p,b){c=c.ownerDocument||c,c.head.insertBefore(b,p==="title"?c.querySelector("head > title"):null)}function r0(c,p,b){if(b===1||p.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return c=p.disabled,typeof p.precedence=="string"&&c==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function N_(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function P1(c,p,b,I){if(b.type==="stylesheet"&&(typeof I.media!="string"||matchMedia(I.media).matches!==!1)&&(b.state.loading&4)===0){if(b.instance===null){var N=Wf(I.href),j=p.querySelector(Xp(N));if(j){p=j._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(c.count++,c=F_.bind(c),p.then(c,c)),b.state.loading|=4,b.instance=j,Gn(j);return}j=p.ownerDocument||p,I=Eg(I),(N=yl.get(N))&&Sg(I,N),j=j.createElement("link"),Gn(j);var ne=j;ne._p=new Promise(function(Te,tt){ne.onload=Te,ne.onerror=tt}),Do(j,"link",I),b.instance=j}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(b,p),(p=b.state.preload)&&(b.state.loading&3)===0&&(c.count++,b=F_.bind(c),p.addEventListener("load",b),p.addEventListener("error",b))}}var av=0;function D1(c,p){return c.stylesheets&&c.count===0&&yu(c,c.stylesheets),0<c.count||0<c.imgCount?function(b){var I=setTimeout(function(){if(c.stylesheets&&yu(c,c.stylesheets),c.unsuspend){var j=c.unsuspend;c.unsuspend=null,j()}},6e4+p);0<c.imgBytes&&av===0&&(av=62500*vg());var N=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&yu(c,c.stylesheets),c.unsuspend)){var j=c.unsuspend;c.unsuspend=null,j()}},(c.imgBytes>av?50:800)+p);return c.unsuspend=b,function(){c.unsuspend=null,clearTimeout(I),clearTimeout(N)}}:null}function F_(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)yu(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var Ig=null;function yu(c,p){c.stylesheets=null,c.unsuspend!==null&&(c.count++,Ig=new Map,p.forEach(Cg,c),Ig=null,F_.call(c))}function Cg(c,p){if(!(p.state.loading&4)){var b=Ig.get(c);if(b)var I=b.get(null);else{b=new Map,Ig.set(c,b);for(var N=c.querySelectorAll("link[data-precedence],style[data-precedence]"),j=0;j<N.length;j++){var ne=N[j];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(b.set(ne.dataset.precedence,ne),I=ne)}I&&b.set(null,I)}N=p.instance,ne=N.getAttribute("data-precedence"),j=b.get(ne)||I,j===I&&b.set(null,N),b.set(ne,N),this.count++,I=F_.bind(this),N.addEventListener("load",I),N.addEventListener("error",I),j?j.parentNode.insertBefore(N,j.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(N,c.firstChild)),p.state.loading|=4}}var Gh={$$typeof:jt,Provider:null,Consumer:null,_currentValue:fn,_currentValue2:fn,_threadCount:0};function B_(c,p,b,I,N,j,ne,Te,tt){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tl(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tl(0),this.hiddenUpdates=tl(null),this.identifierPrefix=I,this.onUncaughtError=N,this.onCaughtError=j,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=tt,this.incompleteTransitions=new Map}function Yp(c,p,b,I,N,j,ne,Te,tt,Nt,Jt,ai){return c=new B_(c,p,b,ne,tt,Nt,Jt,ai,Te),p=1,j===!0&&(p|=24),j=fo(3,null,null,p),c.current=j,j.stateNode=c,p=vd(),p.refCount++,c.pooledCache=p,p.refCount++,j.memoizedState={element:I,isDehydrated:b,cache:p},Ed(j),c}function lv(c){return c?(c=Io,c):Io}function cv(c,p,b,I,N,j){N=lv(N),I.context===null?I.context=N:I.pendingContext=N,I=Ac(p),I.payload={element:b},j=j===void 0?null:j,j!==null&&(I.callback=j),b=$l(c,I,p),b!==null&&(Vr(b,c,p),Ic(b,c,p))}function uv(c,p){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var b=c.retryLane;c.retryLane=b!==0&&b<p?b:p}}function V_(c,p){uv(c,p),(c=c.alternate)&&uv(c,p)}function s0(c){if(c.tag===13||c.tag===31){var p=Ul(c,67108864);p!==null&&Vr(p,c,67108864),V_(c,67108864)}}function o0(c){if(c.tag===13||c.tag===31){var p=Sr();p=Re(p);var b=Ul(c,p);b!==null&&Vr(b,c,p),V_(c,p)}}var Kp=!0;function U_(c,p,b,I){var N=Pt.T;Pt.T=null;var j=Si.p;try{Si.p=2,hv(c,p,b,I)}finally{Si.p=j,Pt.T=N}}function a0(c,p,b,I){var N=Pt.T;Pt.T=null;var j=Si.p;try{Si.p=8,hv(c,p,b,I)}finally{Si.p=j,Pt.T=N}}function hv(c,p,b,I){if(Kp){var N=j_(I);if(N===null)Hd(c,p,I,Qp,b),fv(c,I);else if(H_(N,c,p,b,I))I.stopPropagation();else if(fv(c,I),p&4&&-1<l0.indexOf(c)){for(;N!==null;){var j=Ki(N);if(j!==null)switch(j.tag){case 3:if(j=j.stateNode,j.current.memoizedState.isDehydrated){var ne=ya(j.pendingLanes);if(ne!==0){var Te=j;for(Te.pendingLanes|=2,Te.entangledLanes|=2;ne;){var tt=1<<31-Yr(ne);Te.entanglements[1]|=tt,ne&=~tt}Xu(j),(bi&6)===0&&(As=Bs()+500,_g(0))}}break;case 31:case 13:Te=Ul(j,2),Te!==null&&Vr(Te,j,2),Jl(),V_(j,2)}if(j=j_(I),j===null&&Hd(c,p,I,Qp,b),j===N)break;N=j}N!==null&&I.stopPropagation()}else Hd(c,p,I,null,b)}}function j_(c){return c=Ta(c),G_(c)}var Qp=null;function G_(c){if(Qp=null,c=Ln(c),c!==null){var p=C(c);if(p===null)c=null;else{var b=p.tag;if(b===13){if(c=D(p),c!==null)return c;c=null}else if(b===31){if(c=s(p),c!==null)return c;c=null}else if(b===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;c=null}else p!==c&&(c=null)}}return Qp=c,null}function dv(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ra()){case no:return 2;case xo:return 8;case Ja:case Rl:return 32;case jc:return 268435456;default:return 32}default:return 32}}var q_=!1,qh=null,Hh=null,Zd=null,Jp=new Map,em=new Map,vl=[],l0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function fv(c,p){switch(c){case"focusin":case"focusout":qh=null;break;case"dragenter":case"dragleave":Hh=null;break;case"mouseover":case"mouseout":Zd=null;break;case"pointerover":case"pointerout":Jp.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":em.delete(p.pointerId)}}function tm(c,p,b,I,N,j){return c===null||c.nativeEvent!==j?(c={blockedOn:p,domEventName:b,eventSystemFlags:I,nativeEvent:j,targetContainers:[N]},p!==null&&(p=Ki(p),p!==null&&s0(p)),c):(c.eventSystemFlags|=I,p=c.targetContainers,N!==null&&p.indexOf(N)===-1&&p.push(N),c)}function H_(c,p,b,I,N){switch(p){case"focusin":return qh=tm(qh,c,p,b,I,N),!0;case"dragenter":return Hh=tm(Hh,c,p,b,I,N),!0;case"mouseover":return Zd=tm(Zd,c,p,b,I,N),!0;case"pointerover":var j=N.pointerId;return Jp.set(j,tm(Jp.get(j)||null,c,p,b,I,N)),!0;case"gotpointercapture":return j=N.pointerId,em.set(j,tm(em.get(j)||null,c,p,b,I,N)),!0}return!1}function c0(c){var p=Ln(c.target);if(p!==null){var b=C(p);if(b!==null){if(p=b.tag,p===13){if(p=D(b),p!==null){c.blockedOn=p,Ye(c.priority,function(){o0(b)});return}}else if(p===31){if(p=s(b),p!==null){c.blockedOn=p,Ye(c.priority,function(){o0(b)});return}}else if(p===3&&b.stateNode.current.memoizedState.isDehydrated){c.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Rg(c){if(c.blockedOn!==null)return!1;for(var p=c.targetContainers;0<p.length;){var b=j_(c.nativeEvent);if(b===null){b=c.nativeEvent;var I=new b.constructor(b.type,b);wo=I,b.target.dispatchEvent(I),wo=null}else return p=Ki(b),p!==null&&s0(p),c.blockedOn=b,!1;p.shift()}return!0}function im(c,p,b){Rg(c)&&b.delete(p)}function u0(){q_=!1,qh!==null&&Rg(qh)&&(qh=null),Hh!==null&&Rg(Hh)&&(Hh=null),Zd!==null&&Rg(Zd)&&(Zd=null),Jp.forEach(im),em.forEach(im)}function Mg(c,p){c.blockedOn===p&&(c.blockedOn=null,q_||(q_=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,u0)))}var W_=null;function h0(c){W_!==c&&(W_=c,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){W_===c&&(W_=null);for(var p=0;p<c.length;p+=3){var b=c[p],I=c[p+1],N=c[p+2];if(typeof I!="function"){if(G_(I||b)===null)continue;break}var j=Ki(b);j!==null&&(c.splice(p,3),p-=3,zd(j,{pending:!0,data:N,method:b.method,action:I},I,N))}}))}function $f(c){function p(tt){return Mg(tt,c)}qh!==null&&Mg(qh,c),Hh!==null&&Mg(Hh,c),Zd!==null&&Mg(Zd,c),Jp.forEach(p),em.forEach(p);for(var b=0;b<vl.length;b++){var I=vl[b];I.blockedOn===c&&(I.blockedOn=null)}for(;0<vl.length&&(b=vl[0],b.blockedOn===null);)c0(b),b.blockedOn===null&&vl.shift();if(b=(c.ownerDocument||c).$$reactFormReplay,b!=null)for(I=0;I<b.length;I+=3){var N=b[I],j=b[I+1],ne=N[At]||null;if(typeof j=="function")ne||h0(b);else if(ne){var Te=null;if(j&&j.hasAttribute("formAction")){if(N=j,ne=j[At]||null)Te=ne.formAction;else if(G_(N)!==null)continue}else Te=ne.action;typeof Te=="function"?b[I+1]=Te:(b.splice(I,3),I-=3),h0(b)}}}function nm(){function c(j){j.canIntercept&&j.info==="react-transition"&&j.intercept({handler:function(){return new Promise(function(ne){return N=ne})},focusReset:"manual",scroll:"manual"})}function p(){N!==null&&(N(),N=null),I||setTimeout(b,20)}function b(){if(!I&&!navigation.transition){var j=navigation.currentEntry;j&&j.url!=null&&navigation.navigate(j.url,{state:j.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var I=!1,N=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(b,100),function(){I=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),N!==null&&(N(),N=null)}}}function Pg(c){this._internalRoot=c}Qu.prototype.render=Pg.prototype.render=function(c){var p=this._internalRoot;if(p===null)throw Error(m(409));var b=p.current,I=Sr();cv(b,I,c,p,null,null)},Qu.prototype.unmount=Pg.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var p=c.containerInfo;cv(c.current,2,null,c,null,null),Jl(),p[gt]=null}};function Qu(c){this._internalRoot=c}Qu.prototype.unstable_scheduleHydration=function(c){if(c){var p=Ie();c={blockedOn:null,target:c,priority:p};for(var b=0;b<vl.length&&p!==0&&p<vl[b].priority;b++);vl.splice(b,0,c),b===0&&c0(c)}};var Zf=n.version;if(Zf!=="19.2.0")throw Error(m(527,Zf,"19.2.0"));Si.findDOMNode=function(c){var p=c._reactInternals;if(p===void 0)throw typeof c.render=="function"?Error(m(188)):(c=Object.keys(c).join(","),Error(m(268,c)));return c=q(p),c=c!==null?te(c):null,c=c===null?null:c.stateNode,c};var Dg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Pt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rm.isDisabled&&rm.supportsFiber)try{ea=rm.inject(Dg),vs=rm}catch{}}return Nv.createRoot=function(c,p){if(!w(c))throw Error(m(299));var b=!1,I="",N=Nd,j=Mh,ne=Nf;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(I=p.identifierPrefix),p.onUncaughtError!==void 0&&(N=p.onUncaughtError),p.onCaughtError!==void 0&&(j=p.onCaughtError),p.onRecoverableError!==void 0&&(ne=p.onRecoverableError)),p=Yp(c,1,!1,null,null,b,I,null,N,j,ne,nm),c[gt]=p.current,Yy(c),new Pg(p)},Nv.hydrateRoot=function(c,p,b){if(!w(c))throw Error(m(299));var I=!1,N="",j=Nd,ne=Mh,Te=Nf,tt=null;return b!=null&&(b.unstable_strictMode===!0&&(I=!0),b.identifierPrefix!==void 0&&(N=b.identifierPrefix),b.onUncaughtError!==void 0&&(j=b.onUncaughtError),b.onCaughtError!==void 0&&(ne=b.onCaughtError),b.onRecoverableError!==void 0&&(Te=b.onRecoverableError),b.formState!==void 0&&(tt=b.formState)),p=Yp(c,1,!0,p,b??null,I,N,tt,j,ne,Te,nm),p.context=lv(null),b=p.current,I=Sr(),I=Re(I),N=Ac(I),N.callback=null,$l(b,N,I),b=I,p.current.lanes=b,il(p,b),Xu(p),c[gt]=p.current,Yy(c),new Qu(p)},Nv.version="19.2.0",Nv}var S2;function FL(){if(S2)return Aw.exports;S2=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),Aw.exports=NL(),Aw.exports}var BL=FL();/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var A2="popstate";function VL(u={}){function n(m,w){let{pathname:C,search:D,hash:s}=m.location;return Xw("",{pathname:C,search:D,hash:s},w.state&&w.state.usr||null,w.state&&w.state.key||"default")}function l(m,w){return typeof w=="string"?w:sx(w)}return jL(n,l,null,u)}function io(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function Qh(u,n){if(!u){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function UL(){return Math.random().toString(36).substring(2,10)}function I2(u,n){return{usr:u.state,key:u.key,idx:n}}function Xw(u,n,l=null,m){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof n=="string"?Iy(n):n,state:l,key:n&&n.key||m||UL()}}function sx({pathname:u="/",search:n="",hash:l=""}){return n&&n!=="?"&&(u+=n.charAt(0)==="?"?n:"?"+n),l&&l!=="#"&&(u+=l.charAt(0)==="#"?l:"#"+l),u}function Iy(u){let n={};if(u){let l=u.indexOf("#");l>=0&&(n.hash=u.substring(l),u=u.substring(0,l));let m=u.indexOf("?");m>=0&&(n.search=u.substring(m),u=u.substring(0,m)),u&&(n.pathname=u)}return n}function jL(u,n,l,m={}){let{window:w=document.defaultView,v5Compat:C=!1}=m,D=w.history,s="POP",G=null,q=te();q==null&&(q=0,D.replaceState({...D.state,idx:q},""));function te(){return(D.state||{idx:null}).idx}function ce(){s="POP";let Qe=te(),xt=Qe==null?null:Qe-q;q=Qe,G&&G({action:s,location:Ge.location,delta:xt})}function we(Qe,xt){s="PUSH";let wt=Xw(Ge.location,Qe,xt);q=te()+1;let jt=I2(wt,q),wi=Ge.createHref(wt);try{D.pushState(jt,"",wi)}catch(Ai){if(Ai instanceof DOMException&&Ai.name==="DataCloneError")throw Ai;w.location.assign(wi)}C&&G&&G({action:s,location:Ge.location,delta:1})}function ze(Qe,xt){s="REPLACE";let wt=Xw(Ge.location,Qe,xt);q=te();let jt=I2(wt,q),wi=Ge.createHref(wt);D.replaceState(jt,"",wi),C&&G&&G({action:s,location:Ge.location,delta:0})}function at(Qe){return GL(Qe)}let Ge={get action(){return s},get location(){return u(w,D)},listen(Qe){if(G)throw new Error("A history only accepts one active listener");return w.addEventListener(A2,ce),G=Qe,()=>{w.removeEventListener(A2,ce),G=null}},createHref(Qe){return n(w,Qe)},createURL:at,encodeLocation(Qe){let xt=at(Qe);return{pathname:xt.pathname,search:xt.search,hash:xt.hash}},push:we,replace:ze,go(Qe){return D.go(Qe)}};return Ge}function GL(u,n=!1){let l="http://localhost";typeof window<"u"&&(l=window.location.origin!=="null"?window.location.origin:window.location.href),io(l,"No window.location.(origin|href) available to create URL");let m=typeof u=="string"?u:sx(u);return m=m.replace(/ $/,"%20"),!n&&m.startsWith("//")&&(m=l+m),new URL(m,l)}function RC(u,n,l="/"){return qL(u,n,l,!1)}function qL(u,n,l,m){let w=typeof n=="string"?Iy(n):n,C=ip(w.pathname||"/",l);if(C==null)return null;let D=MC(u);HL(D);let s=null;for(let G=0;s==null&&G<D.length;++G){let q=iz(C);s=ez(D[G],q,m)}return s}function MC(u,n=[],l=[],m="",w=!1){let C=(D,s,G=w,q)=>{let te={relativePath:q===void 0?D.path||"":q,caseSensitive:D.caseSensitive===!0,childrenIndex:s,route:D};if(te.relativePath.startsWith("/")){if(!te.relativePath.startsWith(m)&&G)return;io(te.relativePath.startsWith(m),`Absolute route path "${te.relativePath}" nested under path "${m}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),te.relativePath=te.relativePath.slice(m.length)}let ce=Qf([m,te.relativePath]),we=l.concat(te);D.children&&D.children.length>0&&(io(D.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${ce}".`),MC(D.children,n,we,ce,G)),!(D.path==null&&!D.index)&&n.push({path:ce,score:QL(ce,D.index),routesMeta:we})};return u.forEach((D,s)=>{if(D.path===""||!D.path?.includes("?"))C(D,s);else for(let G of PC(D.path))C(D,s,!0,G)}),n}function PC(u){let n=u.split("/");if(n.length===0)return[];let[l,...m]=n,w=l.endsWith("?"),C=l.replace(/\?$/,"");if(m.length===0)return w?[C,""]:[C];let D=PC(m.join("/")),s=[];return s.push(...D.map(G=>G===""?C:[C,G].join("/"))),w&&s.push(...D),s.map(G=>u.startsWith("/")&&G===""?"/":G)}function HL(u){u.sort((n,l)=>n.score!==l.score?l.score-n.score:JL(n.routesMeta.map(m=>m.childrenIndex),l.routesMeta.map(m=>m.childrenIndex)))}var WL=/^:[\w-]+$/,$L=3,ZL=2,XL=1,YL=10,KL=-2,C2=u=>u==="*";function QL(u,n){let l=u.split("/"),m=l.length;return l.some(C2)&&(m+=KL),n&&(m+=ZL),l.filter(w=>!C2(w)).reduce((w,C)=>w+(WL.test(C)?$L:C===""?XL:YL),m)}function JL(u,n){return u.length===n.length&&u.slice(0,-1).every((m,w)=>m===n[w])?u[u.length-1]-n[n.length-1]:0}function ez(u,n,l=!1){let{routesMeta:m}=u,w={},C="/",D=[];for(let s=0;s<m.length;++s){let G=m[s],q=s===m.length-1,te=C==="/"?n:n.slice(C.length)||"/",ce=db({path:G.relativePath,caseSensitive:G.caseSensitive,end:q},te),we=G.route;if(!ce&&q&&l&&!m[m.length-1].route.index&&(ce=db({path:G.relativePath,caseSensitive:G.caseSensitive,end:!1},te)),!ce)return null;Object.assign(w,ce.params),D.push({params:w,pathname:Qf([C,ce.pathname]),pathnameBase:oz(Qf([C,ce.pathnameBase])),route:we}),ce.pathnameBase!=="/"&&(C=Qf([C,ce.pathnameBase]))}return D}function db(u,n){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[l,m]=tz(u.path,u.caseSensitive,u.end),w=n.match(l);if(!w)return null;let C=w[0],D=C.replace(/(.)\/+$/,"$1"),s=w.slice(1);return{params:m.reduce((q,{paramName:te,isOptional:ce},we)=>{if(te==="*"){let at=s[we]||"";D=C.slice(0,C.length-at.length).replace(/(.)\/+$/,"$1")}const ze=s[we];return ce&&!ze?q[te]=void 0:q[te]=(ze||"").replace(/%2F/g,"/"),q},{}),pathname:C,pathnameBase:D,pattern:u}}function tz(u,n=!1,l=!0){Qh(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let m=[],w="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(D,s,G)=>(m.push({paramName:s,isOptional:G!=null}),G?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(m.push({paramName:"*"}),w+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?w+="\\/*$":u!==""&&u!=="/"&&(w+="(?:(?=\\/|$))"),[new RegExp(w,n?void 0:"i"),m]}function iz(u){try{return u.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Qh(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),u}}function ip(u,n){if(n==="/")return u;if(!u.toLowerCase().startsWith(n.toLowerCase()))return null;let l=n.endsWith("/")?n.length-1:n.length,m=u.charAt(l);return m&&m!=="/"?null:u.slice(l)||"/"}function nz(u,n="/"){let{pathname:l,search:m="",hash:w=""}=typeof u=="string"?Iy(u):u;return{pathname:l?l.startsWith("/")?l:rz(l,n):n,search:az(m),hash:lz(w)}}function rz(u,n){let l=n.replace(/\/+$/,"").split("/");return u.split("/").forEach(w=>{w===".."?l.length>1&&l.pop():w!=="."&&l.push(w)}),l.length>1?l.join("/"):"/"}function Mw(u,n,l,m){return`Cannot include a '${u}' character in a manually specified \`to.${n}\` field [${JSON.stringify(m)}].  Please separate it out to the \`to.${l}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sz(u){return u.filter((n,l)=>l===0||n.route.path&&n.route.path.length>0)}function CT(u){let n=sz(u);return n.map((l,m)=>m===n.length-1?l.pathname:l.pathnameBase)}function RT(u,n,l,m=!1){let w;typeof u=="string"?w=Iy(u):(w={...u},io(!w.pathname||!w.pathname.includes("?"),Mw("?","pathname","search",w)),io(!w.pathname||!w.pathname.includes("#"),Mw("#","pathname","hash",w)),io(!w.search||!w.search.includes("#"),Mw("#","search","hash",w)));let C=u===""||w.pathname==="",D=C?"/":w.pathname,s;if(D==null)s=l;else{let ce=n.length-1;if(!m&&D.startsWith("..")){let we=D.split("/");for(;we[0]==="..";)we.shift(),ce-=1;w.pathname=we.join("/")}s=ce>=0?n[ce]:"/"}let G=nz(w,s),q=D&&D!=="/"&&D.endsWith("/"),te=(C||D===".")&&l.endsWith("/");return!G.pathname.endsWith("/")&&(q||te)&&(G.pathname+="/"),G}var Qf=u=>u.join("/").replace(/\/\/+/g,"/"),oz=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),az=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,lz=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function cz(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var DC=["POST","PUT","PATCH","DELETE"];new Set(DC);var uz=["GET",...DC];new Set(uz);var Cy=st.createContext(null);Cy.displayName="DataRouter";var Bb=st.createContext(null);Bb.displayName="DataRouterState";st.createContext(!1);var OC=st.createContext({isTransitioning:!1});OC.displayName="ViewTransition";var hz=st.createContext(new Map);hz.displayName="Fetchers";var dz=st.createContext(null);dz.displayName="Await";var ed=st.createContext(null);ed.displayName="Navigation";var yx=st.createContext(null);yx.displayName="Location";var ff=st.createContext({outlet:null,matches:[],isDataRoute:!1});ff.displayName="Route";var MT=st.createContext(null);MT.displayName="RouteError";function fz(u,{relative:n}={}){io(Ry(),"useHref() may be used only in the context of a <Router> component.");let{basename:l,navigator:m}=st.useContext(ed),{hash:w,pathname:C,search:D}=vx(u,{relative:n}),s=C;return l!=="/"&&(s=C==="/"?l:Qf([l,C])),m.createHref({pathname:s,search:D,hash:w})}function Ry(){return st.useContext(yx)!=null}function rh(){return io(Ry(),"useLocation() may be used only in the context of a <Router> component."),st.useContext(yx).location}var LC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function zC(u){st.useContext(ed).static||st.useLayoutEffect(u)}function hp(){let{isDataRoute:u}=st.useContext(ff);return u?Az():pz()}function pz(){io(Ry(),"useNavigate() may be used only in the context of a <Router> component.");let u=st.useContext(Cy),{basename:n,navigator:l}=st.useContext(ed),{matches:m}=st.useContext(ff),{pathname:w}=rh(),C=JSON.stringify(CT(m)),D=st.useRef(!1);return zC(()=>{D.current=!0}),st.useCallback((G,q={})=>{if(Qh(D.current,LC),!D.current)return;if(typeof G=="number"){l.go(G);return}let te=RT(G,JSON.parse(C),w,q.relative==="path");u==null&&n!=="/"&&(te.pathname=te.pathname==="/"?n:Qf([n,te.pathname])),(q.replace?l.replace:l.push)(te,q.state,q)},[n,l,C,w,u])}st.createContext(null);function vx(u,{relative:n}={}){let{matches:l}=st.useContext(ff),{pathname:m}=rh(),w=JSON.stringify(CT(l));return st.useMemo(()=>RT(u,JSON.parse(w),m,n==="path"),[u,w,m,n])}function mz(u,n){return kC(u,n)}function kC(u,n,l,m,w){io(Ry(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:C}=st.useContext(ed),{matches:D}=st.useContext(ff),s=D[D.length-1],G=s?s.params:{},q=s?s.pathname:"/",te=s?s.pathnameBase:"/",ce=s&&s.route;{let wt=ce&&ce.path||"";NC(q,!ce||wt.endsWith("*")||wt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${q}" (under <Route path="${wt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${wt}"> to <Route path="${wt==="/"?"*":`${wt}/*`}">.`)}let we=rh(),ze;if(n){let wt=typeof n=="string"?Iy(n):n;io(te==="/"||wt.pathname?.startsWith(te),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${te}" but pathname "${wt.pathname}" was given in the \`location\` prop.`),ze=wt}else ze=we;let at=ze.pathname||"/",Ge=at;if(te!=="/"){let wt=te.replace(/^\//,"").split("/");Ge="/"+at.replace(/^\//,"").split("/").slice(wt.length).join("/")}let Qe=RC(u,{pathname:Ge});Qh(ce||Qe!=null,`No routes matched location "${ze.pathname}${ze.search}${ze.hash}" `),Qh(Qe==null||Qe[Qe.length-1].route.element!==void 0||Qe[Qe.length-1].route.Component!==void 0||Qe[Qe.length-1].route.lazy!==void 0,`Matched leaf route at location "${ze.pathname}${ze.search}${ze.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let xt=xz(Qe&&Qe.map(wt=>Object.assign({},wt,{params:Object.assign({},G,wt.params),pathname:Qf([te,C.encodeLocation?C.encodeLocation(wt.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:wt.pathname]),pathnameBase:wt.pathnameBase==="/"?te:Qf([te,C.encodeLocation?C.encodeLocation(wt.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:wt.pathnameBase])})),D,l,m,w);return n&&xt?st.createElement(yx.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ze},navigationType:"POP"}},xt):xt}function gz(){let u=Sz(),n=cz(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),l=u instanceof Error?u.stack:null,m="rgba(200,200,200, 0.5)",w={padding:"0.5rem",backgroundColor:m},C={padding:"2px 4px",backgroundColor:m},D=null;return console.error("Error handled by React Router default ErrorBoundary:",u),D=st.createElement(st.Fragment,null,st.createElement("p",null," Hey developer "),st.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",st.createElement("code",{style:C},"ErrorBoundary")," or"," ",st.createElement("code",{style:C},"errorElement")," prop on your route.")),st.createElement(st.Fragment,null,st.createElement("h2",null,"Unexpected Application Error!"),st.createElement("h3",{style:{fontStyle:"italic"}},n),l?st.createElement("pre",{style:w},l):null,D)}var _z=st.createElement(gz,null),yz=class extends st.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,n){return n.location!==u.location||n.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:n.error,location:n.location,revalidation:u.revalidation||n.revalidation}}componentDidCatch(u,n){this.props.unstable_onError?this.props.unstable_onError(u,n):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?st.createElement(ff.Provider,{value:this.props.routeContext},st.createElement(MT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vz({routeContext:u,match:n,children:l}){let m=st.useContext(Cy);return m&&m.static&&m.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=n.route.id),st.createElement(ff.Provider,{value:u},l)}function xz(u,n=[],l=null,m=null,w=null){if(u==null){if(!l)return null;if(l.errors)u=l.matches;else if(n.length===0&&!l.initialized&&l.matches.length>0)u=l.matches;else return null}let C=u,D=l?.errors;if(D!=null){let q=C.findIndex(te=>te.route.id&&D?.[te.route.id]!==void 0);io(q>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(D).join(",")}`),C=C.slice(0,Math.min(C.length,q+1))}let s=!1,G=-1;if(l)for(let q=0;q<C.length;q++){let te=C[q];if((te.route.HydrateFallback||te.route.hydrateFallbackElement)&&(G=q),te.route.id){let{loaderData:ce,errors:we}=l,ze=te.route.loader&&!ce.hasOwnProperty(te.route.id)&&(!we||we[te.route.id]===void 0);if(te.route.lazy||ze){s=!0,G>=0?C=C.slice(0,G+1):C=[C[0]];break}}}return C.reduceRight((q,te,ce)=>{let we,ze=!1,at=null,Ge=null;l&&(we=D&&te.route.id?D[te.route.id]:void 0,at=te.route.errorElement||_z,s&&(G<0&&ce===0?(NC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ze=!0,Ge=null):G===ce&&(ze=!0,Ge=te.route.hydrateFallbackElement||null)));let Qe=n.concat(C.slice(0,ce+1)),xt=()=>{let wt;return we?wt=at:ze?wt=Ge:te.route.Component?wt=st.createElement(te.route.Component,null):te.route.element?wt=te.route.element:wt=q,st.createElement(vz,{match:te,routeContext:{outlet:q,matches:Qe,isDataRoute:l!=null},children:wt})};return l&&(te.route.ErrorBoundary||te.route.errorElement||ce===0)?st.createElement(yz,{location:l.location,revalidation:l.revalidation,component:at,error:we,children:xt(),routeContext:{outlet:null,matches:Qe,isDataRoute:!0},unstable_onError:m}):xt()},null)}function PT(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bz(u){let n=st.useContext(Cy);return io(n,PT(u)),n}function wz(u){let n=st.useContext(Bb);return io(n,PT(u)),n}function Tz(u){let n=st.useContext(ff);return io(n,PT(u)),n}function DT(u){let n=Tz(u),l=n.matches[n.matches.length-1];return io(l.route.id,`${u} can only be used on routes that contain a unique "id"`),l.route.id}function Ez(){return DT("useRouteId")}function Sz(){let u=st.useContext(MT),n=wz("useRouteError"),l=DT("useRouteError");return u!==void 0?u:n.errors?.[l]}function Az(){let{router:u}=bz("useNavigate"),n=DT("useNavigate"),l=st.useRef(!1);return zC(()=>{l.current=!0}),st.useCallback(async(w,C={})=>{Qh(l.current,LC),l.current&&(typeof w=="number"?u.navigate(w):await u.navigate(w,{fromRouteId:n,...C}))},[u,n])}var R2={};function NC(u,n,l){!n&&!R2[u]&&(R2[u]=!0,Qh(!1,l))}st.memo(Iz);function Iz({routes:u,future:n,state:l,unstable_onError:m}){return kC(u,void 0,l,m,n)}function Yw({to:u,replace:n,state:l,relative:m}){io(Ry(),"<Navigate> may be used only in the context of a <Router> component.");let{static:w}=st.useContext(ed);Qh(!w,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:C}=st.useContext(ff),{pathname:D}=rh(),s=hp(),G=RT(u,CT(C),D,m==="path"),q=JSON.stringify(G);return st.useEffect(()=>{s(JSON.parse(q),{replace:n,state:l,relative:m})},[s,q,m,n,l]),null}function Xh(u){io(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Cz({basename:u="/",children:n=null,location:l,navigationType:m="POP",navigator:w,static:C=!1}){io(!Ry(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let D=u.replace(/^\/*/,"/"),s=st.useMemo(()=>({basename:D,navigator:w,static:C,future:{}}),[D,w,C]);typeof l=="string"&&(l=Iy(l));let{pathname:G="/",search:q="",hash:te="",state:ce=null,key:we="default"}=l,ze=st.useMemo(()=>{let at=ip(G,D);return at==null?null:{location:{pathname:at,search:q,hash:te,state:ce,key:we},navigationType:m}},[D,G,q,te,ce,we,m]);return Qh(ze!=null,`<Router basename="${D}"> is not able to match the URL "${G}${q}${te}" because it does not start with the basename, so the <Router> won't render anything.`),ze==null?null:st.createElement(ed.Provider,{value:s},st.createElement(yx.Provider,{children:n,value:ze}))}function Rz({children:u,location:n}){return mz(Kw(u),n)}function Kw(u,n=[]){let l=[];return st.Children.forEach(u,(m,w)=>{if(!st.isValidElement(m))return;let C=[...n,w];if(m.type===st.Fragment){l.push.apply(l,Kw(m.props.children,C));return}io(m.type===Xh,`[${typeof m.type=="string"?m.type:m.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),io(!m.props.index||!m.props.children,"An index route cannot have child routes.");let D={id:m.props.id||C.join("-"),caseSensitive:m.props.caseSensitive,element:m.props.element,Component:m.props.Component,index:m.props.index,path:m.props.path,middleware:m.props.middleware,loader:m.props.loader,action:m.props.action,hydrateFallbackElement:m.props.hydrateFallbackElement,HydrateFallback:m.props.HydrateFallback,errorElement:m.props.errorElement,ErrorBoundary:m.props.ErrorBoundary,hasErrorBoundary:m.props.hasErrorBoundary===!0||m.props.ErrorBoundary!=null||m.props.errorElement!=null,shouldRevalidate:m.props.shouldRevalidate,handle:m.props.handle,lazy:m.props.lazy};m.props.children&&(D.children=Kw(m.props.children,C)),l.push(D)}),l}var J0="get",eb="application/x-www-form-urlencoded";function Vb(u){return u!=null&&typeof u.tagName=="string"}function Mz(u){return Vb(u)&&u.tagName.toLowerCase()==="button"}function Pz(u){return Vb(u)&&u.tagName.toLowerCase()==="form"}function Dz(u){return Vb(u)&&u.tagName.toLowerCase()==="input"}function Oz(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function Lz(u,n){return u.button===0&&(!n||n==="_self")&&!Oz(u)}var G0=null;function zz(){if(G0===null)try{new FormData(document.createElement("form"),0),G0=!1}catch{G0=!0}return G0}var kz=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Pw(u){return u!=null&&!kz.has(u)?(Qh(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${eb}"`),null):u}function Nz(u,n){let l,m,w,C,D;if(Pz(u)){let s=u.getAttribute("action");m=s?ip(s,n):null,l=u.getAttribute("method")||J0,w=Pw(u.getAttribute("enctype"))||eb,C=new FormData(u)}else if(Mz(u)||Dz(u)&&(u.type==="submit"||u.type==="image")){let s=u.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let G=u.getAttribute("formaction")||s.getAttribute("action");if(m=G?ip(G,n):null,l=u.getAttribute("formmethod")||s.getAttribute("method")||J0,w=Pw(u.getAttribute("formenctype"))||Pw(s.getAttribute("enctype"))||eb,C=new FormData(s,u),!zz()){let{name:q,type:te,value:ce}=u;if(te==="image"){let we=q?`${q}.`:"";C.append(`${we}x`,"0"),C.append(`${we}y`,"0")}else q&&C.append(q,ce)}}else{if(Vb(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');l=J0,m=null,w=eb,D=u}return C&&w==="text/plain"&&(D=C,C=void 0),{action:m,method:l.toLowerCase(),encType:w,formData:C,body:D}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function OT(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function Fz(u,n,l){let m=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return m.pathname==="/"?m.pathname=`_root.${l}`:n&&ip(m.pathname,n)==="/"?m.pathname=`${n.replace(/\/$/,"")}/_root.${l}`:m.pathname=`${m.pathname.replace(/\/$/,"")}.${l}`,m}async function Bz(u,n){if(u.id in n)return n[u.id];try{let l=await import(u.module);return n[u.id]=l,l}catch(l){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(l),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Vz(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function Uz(u,n,l){let m=await Promise.all(u.map(async w=>{let C=n.routes[w.route.id];if(C){let D=await Bz(C,l);return D.links?D.links():[]}return[]}));return Hz(m.flat(1).filter(Vz).filter(w=>w.rel==="stylesheet"||w.rel==="preload").map(w=>w.rel==="stylesheet"?{...w,rel:"prefetch",as:"style"}:{...w,rel:"prefetch"}))}function M2(u,n,l,m,w,C){let D=(G,q)=>l[q]?G.route.id!==l[q].route.id:!0,s=(G,q)=>l[q].pathname!==G.pathname||l[q].route.path?.endsWith("*")&&l[q].params["*"]!==G.params["*"];return C==="assets"?n.filter((G,q)=>D(G,q)||s(G,q)):C==="data"?n.filter((G,q)=>{let te=m.routes[G.route.id];if(!te||!te.hasLoader)return!1;if(D(G,q)||s(G,q))return!0;if(G.route.shouldRevalidate){let ce=G.route.shouldRevalidate({currentUrl:new URL(w.pathname+w.search+w.hash,window.origin),currentParams:l[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:G.params,defaultShouldRevalidate:!0});if(typeof ce=="boolean")return ce}return!0}):[]}function jz(u,n,{includeHydrateFallback:l}={}){return Gz(u.map(m=>{let w=n.routes[m.route.id];if(!w)return[];let C=[w.module];return w.clientActionModule&&(C=C.concat(w.clientActionModule)),w.clientLoaderModule&&(C=C.concat(w.clientLoaderModule)),l&&w.hydrateFallbackModule&&(C=C.concat(w.hydrateFallbackModule)),w.imports&&(C=C.concat(w.imports)),C}).flat(1))}function Gz(u){return[...new Set(u)]}function qz(u){let n={},l=Object.keys(u).sort();for(let m of l)n[m]=u[m];return n}function Hz(u,n){let l=new Set;return new Set(n),u.reduce((m,w)=>{let C=JSON.stringify(qz(w));return l.has(C)||(l.add(C),m.push({key:C,link:w})),m},[])}function FC(){let u=st.useContext(Cy);return OT(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function Wz(){let u=st.useContext(Bb);return OT(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var LT=st.createContext(void 0);LT.displayName="FrameworkContext";function BC(){let u=st.useContext(LT);return OT(u,"You must render this element inside a <HydratedRouter> element"),u}function $z(u,n){let l=st.useContext(LT),[m,w]=st.useState(!1),[C,D]=st.useState(!1),{onFocus:s,onBlur:G,onMouseEnter:q,onMouseLeave:te,onTouchStart:ce}=n,we=st.useRef(null);st.useEffect(()=>{if(u==="render"&&D(!0),u==="viewport"){let Ge=xt=>{xt.forEach(wt=>{D(wt.isIntersecting)})},Qe=new IntersectionObserver(Ge,{threshold:.5});return we.current&&Qe.observe(we.current),()=>{Qe.disconnect()}}},[u]),st.useEffect(()=>{if(m){let Ge=setTimeout(()=>{D(!0)},100);return()=>{clearTimeout(Ge)}}},[m]);let ze=()=>{w(!0)},at=()=>{w(!1),D(!1)};return l?u!=="intent"?[C,we,{}]:[C,we,{onFocus:Fv(s,ze),onBlur:Fv(G,at),onMouseEnter:Fv(q,ze),onMouseLeave:Fv(te,at),onTouchStart:Fv(ce,ze)}]:[!1,we,{}]}function Fv(u,n){return l=>{u&&u(l),l.defaultPrevented||n(l)}}function Zz({page:u,...n}){let{router:l}=FC(),m=st.useMemo(()=>RC(l.routes,u,l.basename),[l.routes,u,l.basename]);return m?st.createElement(Yz,{page:u,matches:m,...n}):null}function Xz(u){let{manifest:n,routeModules:l}=BC(),[m,w]=st.useState([]);return st.useEffect(()=>{let C=!1;return Uz(u,n,l).then(D=>{C||w(D)}),()=>{C=!0}},[u,n,l]),m}function Yz({page:u,matches:n,...l}){let m=rh(),{manifest:w,routeModules:C}=BC(),{basename:D}=FC(),{loaderData:s,matches:G}=Wz(),q=st.useMemo(()=>M2(u,n,G,w,m,"data"),[u,n,G,w,m]),te=st.useMemo(()=>M2(u,n,G,w,m,"assets"),[u,n,G,w,m]),ce=st.useMemo(()=>{if(u===m.pathname+m.search+m.hash)return[];let at=new Set,Ge=!1;if(n.forEach(xt=>{let wt=w.routes[xt.route.id];!wt||!wt.hasLoader||(!q.some(jt=>jt.route.id===xt.route.id)&&xt.route.id in s&&C[xt.route.id]?.shouldRevalidate||wt.hasClientLoader?Ge=!0:at.add(xt.route.id))}),at.size===0)return[];let Qe=Fz(u,D,"data");return Ge&&at.size>0&&Qe.searchParams.set("_routes",n.filter(xt=>at.has(xt.route.id)).map(xt=>xt.route.id).join(",")),[Qe.pathname+Qe.search]},[D,s,m,w,q,n,u,C]),we=st.useMemo(()=>jz(te,w),[te,w]),ze=Xz(te);return st.createElement(st.Fragment,null,ce.map(at=>st.createElement("link",{key:at,rel:"prefetch",as:"fetch",href:at,...l})),we.map(at=>st.createElement("link",{key:at,rel:"modulepreload",href:at,...l})),ze.map(({key:at,link:Ge})=>st.createElement("link",{key:at,nonce:l.nonce,...Ge})))}function Kz(...u){return n=>{u.forEach(l=>{typeof l=="function"?l(n):l!=null&&(l.current=n)})}}var VC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{VC&&(window.__reactRouterVersion="7.9.4")}catch{}function Qz({basename:u,children:n,window:l}){let m=st.useRef();m.current==null&&(m.current=VL({window:l,v5Compat:!0}));let w=m.current,[C,D]=st.useState({action:w.action,location:w.location}),s=st.useCallback(G=>{st.startTransition(()=>D(G))},[D]);return st.useLayoutEffect(()=>w.listen(s),[w,s]),st.createElement(Cz,{basename:u,children:n,location:C.location,navigationType:C.action,navigator:w})}var UC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yy=st.forwardRef(function({onClick:n,discover:l="render",prefetch:m="none",relative:w,reloadDocument:C,replace:D,state:s,target:G,to:q,preventScrollReset:te,viewTransition:ce,...we},ze){let{basename:at}=st.useContext(ed),Ge=typeof q=="string"&&UC.test(q),Qe,xt=!1;if(typeof q=="string"&&Ge&&(Qe=q,VC))try{let We=new URL(window.location.href),ht=q.startsWith("//")?new URL(We.protocol+q):new URL(q),$e=ip(ht.pathname,at);ht.origin===We.origin&&$e!=null?q=$e+ht.search+ht.hash:xt=!0}catch{Qh(!1,`<Link to="${q}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let wt=fz(q,{relative:w}),[jt,wi,Ai]=$z(m,we),vi=ik(q,{replace:D,state:s,target:G,preventScrollReset:te,relative:w,viewTransition:ce});function Ve(We){n&&n(We),We.defaultPrevented||vi(We)}let ke=st.createElement("a",{...we,...Ai,href:Qe||wt,onClick:xt||C?n:Ve,ref:Kz(ze,wi),target:G,"data-discover":!Ge&&l==="render"?"true":void 0});return jt&&!Ge?st.createElement(st.Fragment,null,ke,st.createElement(Zz,{page:wt})):ke});yy.displayName="Link";var Jz=st.forwardRef(function({"aria-current":n="page",caseSensitive:l=!1,className:m="",end:w=!1,style:C,to:D,viewTransition:s,children:G,...q},te){let ce=vx(D,{relative:q.relative}),we=rh(),ze=st.useContext(Bb),{navigator:at,basename:Ge}=st.useContext(ed),Qe=ze!=null&&ak(ce)&&s===!0,xt=at.encodeLocation?at.encodeLocation(ce).pathname:ce.pathname,wt=we.pathname,jt=ze&&ze.navigation&&ze.navigation.location?ze.navigation.location.pathname:null;l||(wt=wt.toLowerCase(),jt=jt?jt.toLowerCase():null,xt=xt.toLowerCase()),jt&&Ge&&(jt=ip(jt,Ge)||jt);const wi=xt!=="/"&&xt.endsWith("/")?xt.length-1:xt.length;let Ai=wt===xt||!w&&wt.startsWith(xt)&&wt.charAt(wi)==="/",vi=jt!=null&&(jt===xt||!w&&jt.startsWith(xt)&&jt.charAt(xt.length)==="/"),Ve={isActive:Ai,isPending:vi,isTransitioning:Qe},ke=Ai?n:void 0,We;typeof m=="function"?We=m(Ve):We=[m,Ai?"active":null,vi?"pending":null,Qe?"transitioning":null].filter(Boolean).join(" ");let ht=typeof C=="function"?C(Ve):C;return st.createElement(yy,{...q,"aria-current":ke,className:We,ref:te,style:ht,to:D,viewTransition:s},typeof G=="function"?G(Ve):G)});Jz.displayName="NavLink";var ek=st.forwardRef(({discover:u="render",fetcherKey:n,navigate:l,reloadDocument:m,replace:w,state:C,method:D=J0,action:s,onSubmit:G,relative:q,preventScrollReset:te,viewTransition:ce,...we},ze)=>{let at=sk(),Ge=ok(s,{relative:q}),Qe=D.toLowerCase()==="get"?"get":"post",xt=typeof s=="string"&&UC.test(s),wt=jt=>{if(G&&G(jt),jt.defaultPrevented)return;jt.preventDefault();let wi=jt.nativeEvent.submitter,Ai=wi?.getAttribute("formmethod")||D;at(wi||jt.currentTarget,{fetcherKey:n,method:Ai,navigate:l,replace:w,state:C,relative:q,preventScrollReset:te,viewTransition:ce})};return st.createElement("form",{ref:ze,method:Qe,action:Ge,onSubmit:m?G:wt,...we,"data-discover":!xt&&u==="render"?"true":void 0})});ek.displayName="Form";function tk(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jC(u){let n=st.useContext(Cy);return io(n,tk(u)),n}function ik(u,{target:n,replace:l,state:m,preventScrollReset:w,relative:C,viewTransition:D}={}){let s=hp(),G=rh(),q=vx(u,{relative:C});return st.useCallback(te=>{if(Lz(te,n)){te.preventDefault();let ce=l!==void 0?l:sx(G)===sx(q);s(u,{replace:ce,state:m,preventScrollReset:w,relative:C,viewTransition:D})}},[G,s,q,l,m,n,u,w,C,D])}var nk=0,rk=()=>`__${String(++nk)}__`;function sk(){let{router:u}=jC("useSubmit"),{basename:n}=st.useContext(ed),l=Ez();return st.useCallback(async(m,w={})=>{let{action:C,method:D,encType:s,formData:G,body:q}=Nz(m,n);if(w.navigate===!1){let te=w.fetcherKey||rk();await u.fetch(te,l,w.action||C,{preventScrollReset:w.preventScrollReset,formData:G,body:q,formMethod:w.method||D,formEncType:w.encType||s,flushSync:w.flushSync})}else await u.navigate(w.action||C,{preventScrollReset:w.preventScrollReset,formData:G,body:q,formMethod:w.method||D,formEncType:w.encType||s,replace:w.replace,state:w.state,fromRouteId:l,flushSync:w.flushSync,viewTransition:w.viewTransition})},[u,n,l])}function ok(u,{relative:n}={}){let{basename:l}=st.useContext(ed),m=st.useContext(ff);io(m,"useFormAction must be used inside a RouteContext");let[w]=m.matches.slice(-1),C={...vx(u||".",{relative:n})},D=rh();if(u==null){C.search=D.search;let s=new URLSearchParams(C.search),G=s.getAll("index");if(G.some(te=>te==="")){s.delete("index"),G.filter(ce=>ce).forEach(ce=>s.append("index",ce));let te=s.toString();C.search=te?`?${te}`:""}}return(!u||u===".")&&w.route.index&&(C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index"),l!=="/"&&(C.pathname=C.pathname==="/"?l:Qf([l,C.pathname])),sx(C)}function ak(u,{relative:n}={}){let l=st.useContext(OC);io(l!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:m}=jC("useViewTransitionState"),w=vx(u,{relative:n});if(!l.isTransitioning)return!1;let C=ip(l.currentLocation.pathname,m)||l.currentLocation.pathname,D=ip(l.nextLocation.pathname,m)||l.nextLocation.pathname;return db(w.pathname,D)!=null||db(w.pathname,C)!=null}const lk=()=>{};var P2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC=function(u){const n=[];let l=0;for(let m=0;m<u.length;m++){let w=u.charCodeAt(m);w<128?n[l++]=w:w<2048?(n[l++]=w>>6|192,n[l++]=w&63|128):(w&64512)===55296&&m+1<u.length&&(u.charCodeAt(m+1)&64512)===56320?(w=65536+((w&1023)<<10)+(u.charCodeAt(++m)&1023),n[l++]=w>>18|240,n[l++]=w>>12&63|128,n[l++]=w>>6&63|128,n[l++]=w&63|128):(n[l++]=w>>12|224,n[l++]=w>>6&63|128,n[l++]=w&63|128)}return n},ck=function(u){const n=[];let l=0,m=0;for(;l<u.length;){const w=u[l++];if(w<128)n[m++]=String.fromCharCode(w);else if(w>191&&w<224){const C=u[l++];n[m++]=String.fromCharCode((w&31)<<6|C&63)}else if(w>239&&w<365){const C=u[l++],D=u[l++],s=u[l++],G=((w&7)<<18|(C&63)<<12|(D&63)<<6|s&63)-65536;n[m++]=String.fromCharCode(55296+(G>>10)),n[m++]=String.fromCharCode(56320+(G&1023))}else{const C=u[l++],D=u[l++];n[m++]=String.fromCharCode((w&15)<<12|(C&63)<<6|D&63)}}return n.join("")},qC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(u,n){if(!Array.isArray(u))throw Error("encodeByteArray takes an array as a parameter");this.init_();const l=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,m=[];for(let w=0;w<u.length;w+=3){const C=u[w],D=w+1<u.length,s=D?u[w+1]:0,G=w+2<u.length,q=G?u[w+2]:0,te=C>>2,ce=(C&3)<<4|s>>4;let we=(s&15)<<2|q>>6,ze=q&63;G||(ze=64,D||(we=64)),m.push(l[te],l[ce],l[we],l[ze])}return m.join("")},encodeString(u,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(u):this.encodeByteArray(GC(u),n)},decodeString(u,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(u):ck(this.decodeStringToByteArray(u,n))},decodeStringToByteArray(u,n){this.init_();const l=n?this.charToByteMapWebSafe_:this.charToByteMap_,m=[];for(let w=0;w<u.length;){const C=l[u.charAt(w++)],s=w<u.length?l[u.charAt(w)]:0;++w;const q=w<u.length?l[u.charAt(w)]:64;++w;const ce=w<u.length?l[u.charAt(w)]:64;if(++w,C==null||s==null||q==null||ce==null)throw new uk;const we=C<<2|s>>4;if(m.push(we),q!==64){const ze=s<<4&240|q>>2;if(m.push(ze),ce!==64){const at=q<<6&192|ce;m.push(at)}}}return m},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let u=0;u<this.ENCODED_VALS.length;u++)this.byteToCharMap_[u]=this.ENCODED_VALS.charAt(u),this.charToByteMap_[this.byteToCharMap_[u]]=u,this.byteToCharMapWebSafe_[u]=this.ENCODED_VALS_WEBSAFE.charAt(u),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[u]]=u,u>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(u)]=u,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(u)]=u)}}};class uk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hk=function(u){const n=GC(u);return qC.encodeByteArray(n,!0)},fb=function(u){return hk(u).replace(/\./g,"")},HC=function(u){try{return qC.decodeString(u,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dk(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=()=>dk().__FIREBASE_DEFAULTS__,pk=()=>{if(typeof process>"u"||typeof P2>"u")return;const u=P2.__FIREBASE_DEFAULTS__;if(u)return JSON.parse(u)},mk=()=>{if(typeof document>"u")return;let u;try{u=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=u&&HC(u[1]);return n&&JSON.parse(n)},Ub=()=>{try{return lk()||fk()||pk()||mk()}catch(u){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${u}`);return}},WC=u=>Ub()?.emulatorHosts?.[u],$C=u=>{const n=WC(u);if(!n)return;const l=n.lastIndexOf(":");if(l<=0||l+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const m=parseInt(n.substring(l+1),10);return n[0]==="["?[n.substring(1,l-1),m]:[n.substring(0,l),m]},ZC=()=>Ub()?.config,XC=u=>Ub()?.[`_${u}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,l)=>{this.resolve=n,this.reject=l})}wrapCallback(n){return(l,m)=>{l?this.reject(l):this.resolve(m),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(l):n(l,m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pm(u){try{return(u.startsWith("http://")||u.startsWith("https://")?new URL(u).hostname:u).endsWith(".cloudworkstations.dev")}catch{return!1}}async function zT(u){return(await fetch(u,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(u,n){if(u.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const l={alg:"none",type:"JWT"},m=n||"demo-project",w=u.iat||0,C=u.sub||u.user_id;if(!C)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const D={iss:`https://securetoken.google.com/${m}`,aud:m,iat:w,exp:w+3600,auth_time:w,sub:C,user_id:C,firebase:{sign_in_provider:"custom",identities:{}},...u};return[fb(JSON.stringify(l)),fb(JSON.stringify(D)),""].join(".")}const Qv={};function _k(){const u={prod:[],emulator:[]};for(const n of Object.keys(Qv))Qv[n]?u.emulator.push(n):u.prod.push(n);return u}function yk(u){let n=document.getElementById(u),l=!1;return n||(n=document.createElement("div"),n.setAttribute("id",u),l=!0),{created:l,element:n}}let D2=!1;function kT(u,n){if(typeof window>"u"||typeof document>"u"||!Pm(window.location.host)||Qv[u]===n||Qv[u]||D2)return;Qv[u]=n;function l(we){return`__firebase__banner__${we}`}const m="__firebase__banner",C=_k().prod.length>0;function D(){const we=document.getElementById(m);we&&we.remove()}function s(we){we.style.display="flex",we.style.background="#7faaf0",we.style.position="fixed",we.style.bottom="5px",we.style.left="5px",we.style.padding=".5em",we.style.borderRadius="5px",we.style.alignItems="center"}function G(we,ze){we.setAttribute("width","24"),we.setAttribute("id",ze),we.setAttribute("height","24"),we.setAttribute("viewBox","0 0 24 24"),we.setAttribute("fill","none"),we.style.marginLeft="-6px"}function q(){const we=document.createElement("span");return we.style.cursor="pointer",we.style.marginLeft="16px",we.style.fontSize="24px",we.innerHTML=" &times;",we.onclick=()=>{D2=!0,D()},we}function te(we,ze){we.setAttribute("id",ze),we.innerText="Learn more",we.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",we.setAttribute("target","__blank"),we.style.paddingLeft="5px",we.style.textDecoration="underline"}function ce(){const we=yk(m),ze=l("text"),at=document.getElementById(ze)||document.createElement("span"),Ge=l("learnmore"),Qe=document.getElementById(Ge)||document.createElement("a"),xt=l("preprendIcon"),wt=document.getElementById(xt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(we.created){const jt=we.element;s(jt),te(Qe,Ge);const wi=q();G(wt,xt),jt.append(wt,at,Qe,wi),document.body.appendChild(jt)}C?(at.innerText="Preview backend disconnected.",wt.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(wt.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,at.innerText="Preview backend running in this workspace."),at.setAttribute("id",ze)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",ce):ce()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Al(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function vk(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Al())}function xk(){const u=Ub()?.forceEnvironment;if(u==="node")return!0;if(u==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function wk(){const u=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof u=="object"&&u.id!==void 0}function Tk(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ek(){const u=Al();return u.indexOf("MSIE ")>=0||u.indexOf("Trident/")>=0}function Sk(){return!xk()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ak(){try{return typeof indexedDB=="object"}catch{return!1}}function Ik(){return new Promise((u,n)=>{try{let l=!0;const m="validate-browser-context-for-indexeddb-analytics-module",w=self.indexedDB.open(m);w.onsuccess=()=>{w.result.close(),l||self.indexedDB.deleteDatabase(m),u(!0)},w.onupgradeneeded=()=>{l=!1},w.onerror=()=>{n(w.error?.message||"")}}catch(l){n(l)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck="FirebaseError";class pf extends Error{constructor(n,l,m){super(l),this.code=n,this.customData=m,this.name=Ck,Object.setPrototypeOf(this,pf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xx.prototype.create)}}class xx{constructor(n,l,m){this.service=n,this.serviceName=l,this.errors=m}create(n,...l){const m=l[0]||{},w=`${this.service}/${n}`,C=this.errors[n],D=C?Rk(C,m):"Error",s=`${this.serviceName}: ${D} (${w}).`;return new pf(w,s,m)}}function Rk(u,n){return u.replace(Mk,(l,m)=>{const w=n[m];return w!=null?String(w):`<${m}?>`})}const Mk=/\{\$([^}]+)}/g;function Pk(u){for(const n in u)if(Object.prototype.hasOwnProperty.call(u,n))return!1;return!0}function Hg(u,n){if(u===n)return!0;const l=Object.keys(u),m=Object.keys(n);for(const w of l){if(!m.includes(w))return!1;const C=u[w],D=n[w];if(O2(C)&&O2(D)){if(!Hg(C,D))return!1}else if(C!==D)return!1}for(const w of m)if(!l.includes(w))return!1;return!0}function O2(u){return u!==null&&typeof u=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(u){const n=[];for(const[l,m]of Object.entries(u))Array.isArray(m)?m.forEach(w=>{n.push(encodeURIComponent(l)+"="+encodeURIComponent(w))}):n.push(encodeURIComponent(l)+"="+encodeURIComponent(m));return n.length?"&"+n.join("&"):""}function Hv(u){const n={};return u.replace(/^\?/,"").split("&").forEach(m=>{if(m){const[w,C]=m.split("=");n[decodeURIComponent(w)]=decodeURIComponent(C)}}),n}function Wv(u){const n=u.indexOf("?");if(!n)return"";const l=u.indexOf("#",n);return u.substring(n,l>0?l:void 0)}function Dk(u,n){const l=new Ok(u,n);return l.subscribe.bind(l)}class Ok{constructor(n,l){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=l,this.task.then(()=>{n(this)}).catch(m=>{this.error(m)})}next(n){this.forEachObserver(l=>{l.next(n)})}error(n){this.forEachObserver(l=>{l.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,l,m){let w;if(n===void 0&&l===void 0&&m===void 0)throw new Error("Missing Observer.");Lk(n,["next","error","complete"])?w=n:w={next:n,error:l,complete:m},w.next===void 0&&(w.next=Dw),w.error===void 0&&(w.error=Dw),w.complete===void 0&&(w.complete=Dw);const C=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?w.error(this.finalError):w.complete()}catch{}}),this.observers.push(w),C}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let l=0;l<this.observers.length;l++)this.sendOne(l,n)}sendOne(n,l){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{l(this.observers[n])}catch(m){typeof console<"u"&&console.error&&console.error(m)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Lk(u,n){if(typeof u!="object"||u===null)return!1;for(const l of n)if(l in u&&typeof u[l]=="function")return!0;return!1}function Dw(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zs(u){return u&&u._delegate?u._delegate:u}class wm{constructor(n,l,m){this.name=n,this.instanceFactory=l,this.type=m,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ng="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(n,l){this.name=n,this.container=l,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const l=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(l)){const m=new gk;if(this.instancesDeferred.set(l,m),this.isInitialized(l)||this.shouldAutoInitialize())try{const w=this.getOrInitializeService({instanceIdentifier:l});w&&m.resolve(w)}catch{}}return this.instancesDeferred.get(l).promise}getImmediate(n){const l=this.normalizeInstanceIdentifier(n?.identifier),m=n?.optional??!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(w){if(m)return null;throw w}else{if(m)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(Nk(n))try{this.getOrInitializeService({instanceIdentifier:Ng})}catch{}for(const[l,m]of this.instancesDeferred.entries()){const w=this.normalizeInstanceIdentifier(l);try{const C=this.getOrInitializeService({instanceIdentifier:w});m.resolve(C)}catch{}}}}clearInstance(n=Ng){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(l=>"INTERNAL"in l).map(l=>l.INTERNAL.delete()),...n.filter(l=>"_delete"in l).map(l=>l._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=Ng){return this.instances.has(n)}getOptions(n=Ng){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:l={}}=n,m=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(m))throw Error(`${this.name}(${m}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const w=this.getOrInitializeService({instanceIdentifier:m,options:l});for(const[C,D]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(C);m===s&&D.resolve(w)}return w}onInit(n,l){const m=this.normalizeInstanceIdentifier(l),w=this.onInitCallbacks.get(m)??new Set;w.add(n),this.onInitCallbacks.set(m,w);const C=this.instances.get(m);return C&&n(C,m),()=>{w.delete(n)}}invokeOnInitCallbacks(n,l){const m=this.onInitCallbacks.get(l);if(m)for(const w of m)try{w(n,l)}catch{}}getOrInitializeService({instanceIdentifier:n,options:l={}}){let m=this.instances.get(n);if(!m&&this.component&&(m=this.component.instanceFactory(this.container,{instanceIdentifier:kk(n),options:l}),this.instances.set(n,m),this.instancesOptions.set(n,l),this.invokeOnInitCallbacks(m,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,m)}catch{}return m||null}normalizeInstanceIdentifier(n=Ng){return this.component?this.component.multipleInstances?n:Ng:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function kk(u){return u===Ng?void 0:u}function Nk(u){return u.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const l=this.getProvider(n.name);if(l.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);l.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const l=new zk(n,this);return this.providers.set(n,l),l}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kr;(function(u){u[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT"})(kr||(kr={}));const Bk={debug:kr.DEBUG,verbose:kr.VERBOSE,info:kr.INFO,warn:kr.WARN,error:kr.ERROR,silent:kr.SILENT},Vk=kr.INFO,Uk={[kr.DEBUG]:"log",[kr.VERBOSE]:"log",[kr.INFO]:"info",[kr.WARN]:"warn",[kr.ERROR]:"error"},jk=(u,n,...l)=>{if(n<u.logLevel)return;const m=new Date().toISOString(),w=Uk[n];if(w)console[w](`[${m}]  ${u.name}:`,...l);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class NT{constructor(n){this.name=n,this._logLevel=Vk,this._logHandler=jk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in kr))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?Bk[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,kr.DEBUG,...n),this._logHandler(this,kr.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,kr.VERBOSE,...n),this._logHandler(this,kr.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,kr.INFO,...n),this._logHandler(this,kr.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,kr.WARN,...n),this._logHandler(this,kr.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,kr.ERROR,...n),this._logHandler(this,kr.ERROR,...n)}}const Gk=(u,n)=>n.some(l=>u instanceof l);let L2,z2;function qk(){return L2||(L2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hk(){return z2||(z2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const KC=new WeakMap,Qw=new WeakMap,QC=new WeakMap,Ow=new WeakMap,FT=new WeakMap;function Wk(u){const n=new Promise((l,m)=>{const w=()=>{u.removeEventListener("success",C),u.removeEventListener("error",D)},C=()=>{l(ym(u.result)),w()},D=()=>{m(u.error),w()};u.addEventListener("success",C),u.addEventListener("error",D)});return n.then(l=>{l instanceof IDBCursor&&KC.set(l,u)}).catch(()=>{}),FT.set(n,u),n}function $k(u){if(Qw.has(u))return;const n=new Promise((l,m)=>{const w=()=>{u.removeEventListener("complete",C),u.removeEventListener("error",D),u.removeEventListener("abort",D)},C=()=>{l(),w()},D=()=>{m(u.error||new DOMException("AbortError","AbortError")),w()};u.addEventListener("complete",C),u.addEventListener("error",D),u.addEventListener("abort",D)});Qw.set(u,n)}let Jw={get(u,n,l){if(u instanceof IDBTransaction){if(n==="done")return Qw.get(u);if(n==="objectStoreNames")return u.objectStoreNames||QC.get(u);if(n==="store")return l.objectStoreNames[1]?void 0:l.objectStore(l.objectStoreNames[0])}return ym(u[n])},set(u,n,l){return u[n]=l,!0},has(u,n){return u instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in u}};function Zk(u){Jw=u(Jw)}function Xk(u){return u===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...l){const m=u.call(Lw(this),n,...l);return QC.set(m,n.sort?n.sort():[n]),ym(m)}:Hk().includes(u)?function(...n){return u.apply(Lw(this),n),ym(KC.get(this))}:function(...n){return ym(u.apply(Lw(this),n))}}function Yk(u){return typeof u=="function"?Xk(u):(u instanceof IDBTransaction&&$k(u),Gk(u,qk())?new Proxy(u,Jw):u)}function ym(u){if(u instanceof IDBRequest)return Wk(u);if(Ow.has(u))return Ow.get(u);const n=Yk(u);return n!==u&&(Ow.set(u,n),FT.set(n,u)),n}const Lw=u=>FT.get(u);function Kk(u,n,{blocked:l,upgrade:m,blocking:w,terminated:C}={}){const D=indexedDB.open(u,n),s=ym(D);return m&&D.addEventListener("upgradeneeded",G=>{m(ym(D.result),G.oldVersion,G.newVersion,ym(D.transaction),G)}),l&&D.addEventListener("blocked",G=>l(G.oldVersion,G.newVersion,G)),s.then(G=>{C&&G.addEventListener("close",()=>C()),w&&G.addEventListener("versionchange",q=>w(q.oldVersion,q.newVersion,q))}).catch(()=>{}),s}const Qk=["get","getKey","getAll","getAllKeys","count"],Jk=["put","add","delete","clear"],zw=new Map;function k2(u,n){if(!(u instanceof IDBDatabase&&!(n in u)&&typeof n=="string"))return;if(zw.get(n))return zw.get(n);const l=n.replace(/FromIndex$/,""),m=n!==l,w=Jk.includes(l);if(!(l in(m?IDBIndex:IDBObjectStore).prototype)||!(w||Qk.includes(l)))return;const C=async function(D,...s){const G=this.transaction(D,w?"readwrite":"readonly");let q=G.store;return m&&(q=q.index(s.shift())),(await Promise.all([q[l](...s),w&&G.done]))[0]};return zw.set(n,C),C}Zk(u=>({...u,get:(n,l,m)=>k2(n,l)||u.get(n,l,m),has:(n,l)=>!!k2(n,l)||u.has(n,l)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(l=>{if(t3(l)){const m=l.getImmediate();return`${m.library}/${m.version}`}else return null}).filter(l=>l).join(" ")}}function t3(u){return u.getComponent()?.type==="VERSION"}const eT="@firebase/app",N2="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np=new NT("@firebase/app"),i3="@firebase/app-compat",n3="@firebase/analytics-compat",r3="@firebase/analytics",s3="@firebase/app-check-compat",o3="@firebase/app-check",a3="@firebase/auth",l3="@firebase/auth-compat",c3="@firebase/database",u3="@firebase/data-connect",h3="@firebase/database-compat",d3="@firebase/functions",f3="@firebase/functions-compat",p3="@firebase/installations",m3="@firebase/installations-compat",g3="@firebase/messaging",_3="@firebase/messaging-compat",y3="@firebase/performance",v3="@firebase/performance-compat",x3="@firebase/remote-config",b3="@firebase/remote-config-compat",w3="@firebase/storage",T3="@firebase/storage-compat",E3="@firebase/firestore",S3="@firebase/ai",A3="@firebase/firestore-compat",I3="firebase",C3="12.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="[DEFAULT]",R3={[eT]:"fire-core",[i3]:"fire-core-compat",[r3]:"fire-analytics",[n3]:"fire-analytics-compat",[o3]:"fire-app-check",[s3]:"fire-app-check-compat",[a3]:"fire-auth",[l3]:"fire-auth-compat",[c3]:"fire-rtdb",[u3]:"fire-data-connect",[h3]:"fire-rtdb-compat",[d3]:"fire-fn",[f3]:"fire-fn-compat",[p3]:"fire-iid",[m3]:"fire-iid-compat",[g3]:"fire-fcm",[_3]:"fire-fcm-compat",[y3]:"fire-perf",[v3]:"fire-perf-compat",[x3]:"fire-rc",[b3]:"fire-rc-compat",[w3]:"fire-gcs",[T3]:"fire-gcs-compat",[E3]:"fire-fst",[A3]:"fire-fst-compat",[S3]:"fire-vertex","fire-js":"fire-js",[I3]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb=new Map,M3=new Map,iT=new Map;function F2(u,n){try{u.container.addComponent(n)}catch(l){np.debug(`Component ${n.name} failed to register with FirebaseApp ${u.name}`,l)}}function Wg(u){const n=u.name;if(iT.has(n))return np.debug(`There were multiple attempts to register component ${n}.`),!1;iT.set(n,u);for(const l of pb.values())F2(l,u);for(const l of M3.values())F2(l,u);return!0}function jb(u,n){const l=u.container.getProvider("heartbeat").getImmediate({optional:!0});return l&&l.triggerHeartbeat(),u.container.getProvider(n)}function Nc(u){return u==null?!1:u.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vm=new xx("app","Firebase",P3);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D3{constructor(n,l,m){this._isDeleted=!1,this._options={...n},this._config={...l},this._name=l.name,this._automaticDataCollectionEnabled=l.automaticDataCollectionEnabled,this._container=m,this.container.addComponent(new wm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw vm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg=C3;function JC(u,n={}){let l=u;typeof n!="object"&&(n={name:n});const m={name:tT,automaticDataCollectionEnabled:!0,...n},w=m.name;if(typeof w!="string"||!w)throw vm.create("bad-app-name",{appName:String(w)});if(l||(l=ZC()),!l)throw vm.create("no-options");const C=pb.get(w);if(C){if(Hg(l,C.options)&&Hg(m,C.config))return C;throw vm.create("duplicate-app",{appName:w})}const D=new Fk(w);for(const G of iT.values())D.addComponent(G);const s=new D3(l,m,D);return pb.set(w,s),s}function BT(u=tT){const n=pb.get(u);if(!n&&u===tT&&ZC())return JC();if(!n)throw vm.create("no-app",{appName:u});return n}function rf(u,n,l){let m=R3[u]??u;l&&(m+=`-${l}`);const w=m.match(/\s|\//),C=n.match(/\s|\//);if(w||C){const D=[`Unable to register library "${m}" with version "${n}":`];w&&D.push(`library name "${m}" contains illegal characters (whitespace or "/")`),w&&C&&D.push("and"),C&&D.push(`version name "${n}" contains illegal characters (whitespace or "/")`),np.warn(D.join(" "));return}Wg(new wm(`${m}-version`,()=>({library:m,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O3="firebase-heartbeat-database",L3=1,ox="firebase-heartbeat-store";let kw=null;function eR(){return kw||(kw=Kk(O3,L3,{upgrade:(u,n)=>{switch(n){case 0:try{u.createObjectStore(ox)}catch(l){console.warn(l)}}}}).catch(u=>{throw vm.create("idb-open",{originalErrorMessage:u.message})})),kw}async function z3(u){try{const l=(await eR()).transaction(ox),m=await l.objectStore(ox).get(tR(u));return await l.done,m}catch(n){if(n instanceof pf)np.warn(n.message);else{const l=vm.create("idb-get",{originalErrorMessage:n?.message});np.warn(l.message)}}}async function B2(u,n){try{const m=(await eR()).transaction(ox,"readwrite");await m.objectStore(ox).put(n,tR(u)),await m.done}catch(l){if(l instanceof pf)np.warn(l.message);else{const m=vm.create("idb-set",{originalErrorMessage:l?.message});np.warn(m.message)}}}function tR(u){return`${u.name}!${u.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3=1024,N3=30;class F3{constructor(n){this.container=n,this._heartbeatsCache=null;const l=this.container.getProvider("app").getImmediate();this._storage=new V3(l),this._heartbeatsCachePromise=this._storage.read().then(m=>(this._heartbeatsCache=m,m))}async triggerHeartbeat(){try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),m=V2();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===m||this._heartbeatsCache.heartbeats.some(w=>w.date===m))return;if(this._heartbeatsCache.heartbeats.push({date:m,agent:l}),this._heartbeatsCache.heartbeats.length>N3){const w=U3(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(w,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){np.warn(n)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=V2(),{heartbeatsToSend:l,unsentEntries:m}=B3(this._heartbeatsCache.heartbeats),w=fb(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=n,m.length>0?(this._heartbeatsCache.heartbeats=m,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),w}catch(n){return np.warn(n),""}}}function V2(){return new Date().toISOString().substring(0,10)}function B3(u,n=k3){const l=[];let m=u.slice();for(const w of u){const C=l.find(D=>D.agent===w.agent);if(C){if(C.dates.push(w.date),U2(l)>n){C.dates.pop();break}}else if(l.push({agent:w.agent,dates:[w.date]}),U2(l)>n){l.pop();break}m=m.slice(1)}return{heartbeatsToSend:l,unsentEntries:m}}class V3{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ak()?Ik().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const l=await z3(this.app);return l?.heartbeats?l:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const m=await this.read();return B2(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??m.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const m=await this.read();return B2(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??m.lastSentHeartbeatDate,heartbeats:[...m.heartbeats,...n.heartbeats]})}else return}}function U2(u){return fb(JSON.stringify({version:2,heartbeats:u})).length}function U3(u){if(u.length===0)return-1;let n=0,l=u[0].date;for(let m=1;m<u.length;m++)u[m].date<l&&(l=u[m].date,n=m);return n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j3(u){Wg(new wm("platform-logger",n=>new e3(n),"PRIVATE")),Wg(new wm("heartbeat",n=>new F3(n),"PRIVATE")),rf(eT,N2,u),rf(eT,N2,"esm2020"),rf("fire-js","")}j3("");function iR(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const G3=iR,nR=new xx("auth","Firebase",iR());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mb=new NT("@firebase/auth");function q3(u,...n){mb.logLevel<=kr.WARN&&mb.warn(`Auth (${Qg}): ${u}`,...n)}function tb(u,...n){mb.logLevel<=kr.ERROR&&mb.error(`Auth (${Qg}): ${u}`,...n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(u,...n){throw UT(u,...n)}function Kh(u,...n){return UT(u,...n)}function VT(u,n,l){const m={...G3(),[n]:l};return new xx("auth","Firebase",m).create(n,{appName:u.name})}function Jf(u){return VT(u,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function H3(u,n,l){const m=l;if(!(n instanceof m))throw m.name!==n.constructor.name&&nh(u,"argument-error"),VT(u,"argument-error",`Type of ${n.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function UT(u,...n){if(typeof u!="string"){const l=n[0],m=[...n.slice(1)];return m[0]&&(m[0].appName=u.name),u._errorFactory.create(l,...m)}return nR.create(u,...n)}function Fn(u,n,...l){if(!u)throw UT(n,...l)}function Yf(u){const n="INTERNAL ASSERTION FAILED: "+u;throw tb(n),new Error(n)}function rp(u,n){u||Yf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(){return typeof self<"u"&&self.location?.href||""}function W3(){return j2()==="http:"||j2()==="https:"}function j2(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $3(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(W3()||wk()||"connection"in navigator)?navigator.onLine:!0}function Z3(){if(typeof navigator>"u")return null;const u=navigator;return u.languages&&u.languages[0]||u.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{constructor(n,l){this.shortDelay=n,this.longDelay=l,rp(l>n,"Short delay should be less than long delay!"),this.isMobile=vk()||Tk()}get(){return $3()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(u,n){rp(u.emulator,"Emulator should always be set here");const{url:l}=u.emulator;return n?`${l}${n.startsWith("/")?n.slice(1):n}`:l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{static initialize(n,l,m){this.fetchImpl=n,l&&(this.headersImpl=l),m&&(this.responseImpl=m)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Yf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Yf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Yf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X3={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y3=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],K3=new wx(3e4,6e4);function mf(u,n){return u.tenantId&&!n.tenantId?{...n,tenantId:u.tenantId}:n}async function gf(u,n,l,m,w={}){return sR(u,w,async()=>{let C={},D={};m&&(n==="GET"?D=m:C={body:JSON.stringify(m)});const s=bx({key:u.config.apiKey,...D}).slice(1),G=await u._getAdditionalHeaders();G["Content-Type"]="application/json",u.languageCode&&(G["X-Firebase-Locale"]=u.languageCode);const q={method:n,headers:G,...C};return bk()||(q.referrerPolicy="no-referrer"),u.emulatorConfig&&Pm(u.emulatorConfig.host)&&(q.credentials="include"),rR.fetch()(await oR(u,u.config.apiHost,l,s),q)})}async function sR(u,n,l){u._canInitEmulator=!1;const m={...X3,...n};try{const w=new J3(u),C=await Promise.race([l(),w.promise]);w.clearNetworkTimeout();const D=await C.json();if("needConfirmation"in D)throw q0(u,"account-exists-with-different-credential",D);if(C.ok&&!("errorMessage"in D))return D;{const s=C.ok?D.errorMessage:D.error.message,[G,q]=s.split(" : ");if(G==="FEDERATED_USER_ID_ALREADY_LINKED")throw q0(u,"credential-already-in-use",D);if(G==="EMAIL_EXISTS")throw q0(u,"email-already-in-use",D);if(G==="USER_DISABLED")throw q0(u,"user-disabled",D);const te=m[G]||G.toLowerCase().replace(/[_\s]+/g,"-");if(q)throw VT(u,te,q);nh(u,te)}}catch(w){if(w instanceof pf)throw w;nh(u,"network-request-failed",{message:String(w)})}}async function Tx(u,n,l,m,w={}){const C=await gf(u,n,l,m,w);return"mfaPendingCredential"in C&&nh(u,"multi-factor-auth-required",{_serverResponse:C}),C}async function oR(u,n,l,m){const w=`${n}${l}?${m}`,C=u,D=C.config.emulator?jT(u.config,w):`${u.config.apiScheme}://${w}`;return Y3.includes(l)&&(await C._persistenceManagerAvailable,C._getPersistenceType()==="COOKIE")?C._getPersistence()._getFinalTarget(D).toString():D}function Q3(u){switch(u){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class J3{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((l,m)=>{this.timer=setTimeout(()=>m(Kh(this.auth,"network-request-failed")),K3.get())})}}function q0(u,n,l){const m={appName:u.name};l.email&&(m.email=l.email),l.phoneNumber&&(m.phoneNumber=l.phoneNumber);const w=Kh(u,n,m);return w.customData._tokenResponse=l,w}function G2(u){return u!==void 0&&u.enterprise!==void 0}class eN{constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const l of this.recaptchaEnforcementState)if(l.provider&&l.provider===n)return Q3(l.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tN(u,n){return gf(u,"GET","/v2/recaptchaConfig",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iN(u,n){return gf(u,"POST","/v1/accounts:delete",n)}async function gb(u,n){return gf(u,"POST","/v1/accounts:lookup",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jv(u){if(u)try{const n=new Date(Number(u));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function nN(u,n=!1){const l=Zs(u),m=await l.getIdToken(n),w=GT(m);Fn(w&&w.exp&&w.auth_time&&w.iat,l.auth,"internal-error");const C=typeof w.firebase=="object"?w.firebase:void 0,D=C?.sign_in_provider;return{claims:w,token:m,authTime:Jv(Nw(w.auth_time)),issuedAtTime:Jv(Nw(w.iat)),expirationTime:Jv(Nw(w.exp)),signInProvider:D||null,signInSecondFactor:C?.sign_in_second_factor||null}}function Nw(u){return Number(u)*1e3}function GT(u){const[n,l,m]=u.split(".");if(n===void 0||l===void 0||m===void 0)return tb("JWT malformed, contained fewer than 3 sections"),null;try{const w=HC(l);return w?JSON.parse(w):(tb("Failed to decode base64 JWT payload"),null)}catch(w){return tb("Caught error parsing JWT payload as JSON",w?.toString()),null}}function q2(u){const n=GT(u);return Fn(n,"internal-error"),Fn(typeof n.exp<"u","internal-error"),Fn(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ax(u,n,l=!1){if(l)return n;try{return await n}catch(m){throw m instanceof pf&&rN(m)&&u.auth.currentUser===u&&await u.auth.signOut(),m}}function rN({code:u}){return u==="auth/user-disabled"||u==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){if(n){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const m=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,m)}}schedule(n=!1){if(!this.isRunning)return;const l=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},l)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){n?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(n,l){this.createdAt=n,this.lastLoginAt=l,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jv(this.lastLoginAt),this.creationTime=Jv(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _b(u){const n=u.auth,l=await u.getIdToken(),m=await ax(u,gb(n,{idToken:l}));Fn(m?.users.length,n,"internal-error");const w=m.users[0];u._notifyReloadListener(w);const C=w.providerUserInfo?.length?aR(w.providerUserInfo):[],D=aN(u.providerData,C),s=u.isAnonymous,G=!(u.email&&w.passwordHash)&&!D?.length,q=s?G:!1,te={uid:w.localId,displayName:w.displayName||null,photoURL:w.photoUrl||null,email:w.email||null,emailVerified:w.emailVerified||!1,phoneNumber:w.phoneNumber||null,tenantId:w.tenantId||null,providerData:D,metadata:new rT(w.createdAt,w.lastLoginAt),isAnonymous:q};Object.assign(u,te)}async function oN(u){const n=Zs(u);await _b(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function aN(u,n){return[...u.filter(m=>!n.some(w=>w.providerId===m.providerId)),...n]}function aR(u){return u.map(({providerId:n,...l})=>({providerId:n,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lN(u,n){const l=await sR(u,{},async()=>{const m=bx({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:w,apiKey:C}=u.config,D=await oR(u,w,"/v1/token",`key=${C}`),s=await u._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";const G={method:"POST",headers:s,body:m};return u.emulatorConfig&&Pm(u.emulatorConfig.host)&&(G.credentials="include"),rR.fetch()(D,G)});return{accessToken:l.access_token,expiresIn:l.expires_in,refreshToken:l.refresh_token}}async function cN(u,n){return gf(u,"POST","/v2/accounts:revokeToken",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){Fn(n.idToken,"internal-error"),Fn(typeof n.idToken<"u","internal-error"),Fn(typeof n.refreshToken<"u","internal-error");const l="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):q2(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,l)}updateFromIdToken(n){Fn(n.length!==0,"internal-error");const l=q2(n);this.updateTokensAndExpiration(n,null,l)}async getToken(n,l=!1){return!l&&this.accessToken&&!this.isExpired?this.accessToken:(Fn(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,l){const{accessToken:m,refreshToken:w,expiresIn:C}=await lN(n,l);this.updateTokensAndExpiration(m,w,Number(C))}updateTokensAndExpiration(n,l,m){this.refreshToken=l||null,this.accessToken=n||null,this.expirationTime=Date.now()+m*1e3}static fromJSON(n,l){const{refreshToken:m,accessToken:w,expirationTime:C}=l,D=new fy;return m&&(Fn(typeof m=="string","internal-error",{appName:n}),D.refreshToken=m),w&&(Fn(typeof w=="string","internal-error",{appName:n}),D.accessToken=w),C&&(Fn(typeof C=="number","internal-error",{appName:n}),D.expirationTime=C),D}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new fy,this.toJSON())}_performRefresh(){return Yf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(u,n){Fn(typeof u=="string"||typeof u>"u","internal-error",{appName:n})}class Yh{constructor({uid:n,auth:l,stsTokenManager:m,...w}){this.providerId="firebase",this.proactiveRefresh=new sN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=l,this.stsTokenManager=m,this.accessToken=m.accessToken,this.displayName=w.displayName||null,this.email=w.email||null,this.emailVerified=w.emailVerified||!1,this.phoneNumber=w.phoneNumber||null,this.photoURL=w.photoURL||null,this.isAnonymous=w.isAnonymous||!1,this.tenantId=w.tenantId||null,this.providerData=w.providerData?[...w.providerData]:[],this.metadata=new rT(w.createdAt||void 0,w.lastLoginAt||void 0)}async getIdToken(n){const l=await ax(this,this.stsTokenManager.getToken(this.auth,n));return Fn(l,this.auth,"internal-error"),this.accessToken!==l&&(this.accessToken=l,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),l}getIdTokenResult(n){return nN(this,n)}reload(){return oN(this)}_assign(n){this!==n&&(Fn(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(l=>({...l})),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const l=new Yh({...this,auth:n,stsTokenManager:this.stsTokenManager._clone()});return l.metadata._copy(this.metadata),l}_onReload(n){Fn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,l=!1){let m=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),m=!0),l&&await _b(this),await this.auth._persistUserIfCurrent(this),m&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Nc(this.auth.app))return Promise.reject(Jf(this.auth));const n=await this.getIdToken();return await ax(this,iN(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>({...n})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,l){const m=l.displayName??void 0,w=l.email??void 0,C=l.phoneNumber??void 0,D=l.photoURL??void 0,s=l.tenantId??void 0,G=l._redirectEventId??void 0,q=l.createdAt??void 0,te=l.lastLoginAt??void 0,{uid:ce,emailVerified:we,isAnonymous:ze,providerData:at,stsTokenManager:Ge}=l;Fn(ce&&Ge,n,"internal-error");const Qe=fy.fromJSON(this.name,Ge);Fn(typeof ce=="string",n,"internal-error"),hm(m,n.name),hm(w,n.name),Fn(typeof we=="boolean",n,"internal-error"),Fn(typeof ze=="boolean",n,"internal-error"),hm(C,n.name),hm(D,n.name),hm(s,n.name),hm(G,n.name),hm(q,n.name),hm(te,n.name);const xt=new Yh({uid:ce,auth:n,email:w,emailVerified:we,displayName:m,isAnonymous:ze,photoURL:D,phoneNumber:C,tenantId:s,stsTokenManager:Qe,createdAt:q,lastLoginAt:te});return at&&Array.isArray(at)&&(xt.providerData=at.map(wt=>({...wt}))),G&&(xt._redirectEventId=G),xt}static async _fromIdTokenResponse(n,l,m=!1){const w=new fy;w.updateFromServerResponse(l);const C=new Yh({uid:l.localId,auth:n,stsTokenManager:w,isAnonymous:m});return await _b(C),C}static async _fromGetAccountInfoResponse(n,l,m){const w=l.users[0];Fn(w.localId!==void 0,"internal-error");const C=w.providerUserInfo!==void 0?aR(w.providerUserInfo):[],D=!(w.email&&w.passwordHash)&&!C?.length,s=new fy;s.updateFromIdToken(m);const G=new Yh({uid:w.localId,auth:n,stsTokenManager:s,isAnonymous:D}),q={uid:w.localId,displayName:w.displayName||null,photoURL:w.photoUrl||null,email:w.email||null,emailVerified:w.emailVerified||!1,phoneNumber:w.phoneNumber||null,tenantId:w.tenantId||null,providerData:C,metadata:new rT(w.createdAt,w.lastLoginAt),isAnonymous:!(w.email&&w.passwordHash)&&!C?.length};return Object.assign(G,q),G}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=new Map;function Kf(u){rp(u instanceof Function,"Expected a class definition");let n=H2.get(u);return n?(rp(n instanceof u,"Instance stored in cache mismatched with class"),n):(n=new u,H2.set(u,n),n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,l){this.storage[n]=l}async _get(n){const l=this.storage[n];return l===void 0?null:l}async _remove(n){delete this.storage[n]}_addListener(n,l){}_removeListener(n,l){}}lR.type="NONE";const W2=lR;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(u,n,l){return`firebase:${u}:${n}:${l}`}class py{constructor(n,l,m){this.persistence=n,this.auth=l,this.userKey=m;const{config:w,name:C}=this.auth;this.fullUserKey=ib(this.userKey,w.apiKey,C),this.fullPersistenceKey=ib("persistence",w.apiKey,C),this.boundEventHandler=l._onStorageEvent.bind(l),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);if(!n)return null;if(typeof n=="string"){const l=await gb(this.auth,{idToken:n}).catch(()=>{});return l?Yh._fromGetAccountInfoResponse(this.auth,l,n):null}return Yh._fromJSON(this.auth,n)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const l=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,l)return this.setCurrentUser(l)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,l,m="authUser"){if(!l.length)return new py(Kf(W2),n,m);const w=(await Promise.all(l.map(async q=>{if(await q._isAvailable())return q}))).filter(q=>q);let C=w[0]||Kf(W2);const D=ib(m,n.config.apiKey,n.name);let s=null;for(const q of l)try{const te=await q._get(D);if(te){let ce;if(typeof te=="string"){const we=await gb(n,{idToken:te}).catch(()=>{});if(!we)break;ce=await Yh._fromGetAccountInfoResponse(n,we,te)}else ce=Yh._fromJSON(n,te);q!==C&&(s=ce),C=q;break}}catch{}const G=w.filter(q=>q._shouldAllowMigration);return!C._shouldAllowMigration||!G.length?new py(C,n,m):(C=G[0],s&&await C._set(D,s.toJSON()),await Promise.all(l.map(async q=>{if(q!==C)try{await q._remove(D)}catch{}})),new py(C,n,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $2(u){const n=u.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(dR(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(cR(n))return"Firefox";if(n.includes("silk/"))return"Silk";if(pR(n))return"Blackberry";if(mR(n))return"Webos";if(uR(n))return"Safari";if((n.includes("chrome/")||hR(n))&&!n.includes("edge/"))return"Chrome";if(fR(n))return"Android";{const l=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,m=u.match(l);if(m?.length===2)return m[1]}return"Other"}function cR(u=Al()){return/firefox\//i.test(u)}function uR(u=Al()){const n=u.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function hR(u=Al()){return/crios\//i.test(u)}function dR(u=Al()){return/iemobile/i.test(u)}function fR(u=Al()){return/android/i.test(u)}function pR(u=Al()){return/blackberry/i.test(u)}function mR(u=Al()){return/webos/i.test(u)}function qT(u=Al()){return/iphone|ipad|ipod/i.test(u)||/macintosh/i.test(u)&&/mobile/i.test(u)}function uN(u=Al()){return qT(u)&&!!window.navigator?.standalone}function hN(){return Ek()&&document.documentMode===10}function gR(u=Al()){return qT(u)||fR(u)||mR(u)||pR(u)||/windows phone/i.test(u)||dR(u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(u,n=[]){let l;switch(u){case"Browser":l=$2(Al());break;case"Worker":l=`${$2(Al())}-${u}`;break;default:l=u}const m=n.length?n.join(","):"FirebaseCore-web";return`${l}/JsCore/${Qg}/${m}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,l){const m=C=>new Promise((D,s)=>{try{const G=n(C);D(G)}catch(G){s(G)}});m.onAbort=l,this.queue.push(m);const w=this.queue.length-1;return()=>{this.queue[w]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const l=[];try{for(const m of this.queue)await m(n),m.onAbort&&l.push(m.onAbort)}catch(m){l.reverse();for(const w of l)try{w()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:m?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fN(u,n={}){return gf(u,"GET","/v2/passwordPolicy",mf(u,n))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pN=6;class mN{constructor(n){const l=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=l.minPasswordLength??pN,l.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=l.maxPasswordLength),l.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=l.containsLowercaseCharacter),l.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=l.containsUppercaseCharacter),l.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=l.containsNumericCharacter),l.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=l.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=n.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=n.forceUpgradeOnSignin??!1,this.schemaVersion=n.schemaVersion}validatePassword(n){const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,l),this.validatePasswordCharacterOptions(n,l),l.isValid&&(l.isValid=l.meetsMinPasswordLength??!0),l.isValid&&(l.isValid=l.meetsMaxPasswordLength??!0),l.isValid&&(l.isValid=l.containsLowercaseLetter??!0),l.isValid&&(l.isValid=l.containsUppercaseLetter??!0),l.isValid&&(l.isValid=l.containsNumericCharacter??!0),l.isValid&&(l.isValid=l.containsNonAlphanumericCharacter??!0),l}validatePasswordLengthOptions(n,l){const m=this.customStrengthOptions.minPasswordLength,w=this.customStrengthOptions.maxPasswordLength;m&&(l.meetsMinPasswordLength=n.length>=m),w&&(l.meetsMaxPasswordLength=n.length<=w)}validatePasswordCharacterOptions(n,l){this.updatePasswordCharacterOptionsStatuses(l,!1,!1,!1,!1);let m;for(let w=0;w<n.length;w++)m=n.charAt(w),this.updatePasswordCharacterOptionsStatuses(l,m>="a"&&m<="z",m>="A"&&m<="Z",m>="0"&&m<="9",this.allowedNonAlphanumericCharacters.includes(m))}updatePasswordCharacterOptionsStatuses(n,l,m,w,C){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=l)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=m)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=w)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(n,l,m,w){this.app=n,this.heartbeatServiceProvider=l,this.appCheckServiceProvider=m,this.config=w,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Z2(this),this.idTokenSubscription=new Z2(this),this.beforeStateQueue=new dN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nR,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=w.sdkClientVersion,this._persistenceManagerAvailable=new Promise(C=>this._resolvePersistenceManagerAvailable=C)}_initializeWithPersistence(n,l){return l&&(this._popupRedirectResolver=Kf(l)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await py.create(this,n),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(l),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const l=await gb(this,{idToken:n}),m=await Yh._fromGetAccountInfoResponse(this,l,n);await this.directlySetCurrentUser(m)}catch(l){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",l),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){if(Nc(this.app)){const C=this.app.settings.authIdToken;return C?new Promise(D=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(C).then(D,D))}):this.directlySetCurrentUser(null)}const l=await this.assertedPersistence.getCurrentUser();let m=l,w=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const C=this.redirectUser?._redirectEventId,D=m?._redirectEventId,s=await this.tryRedirectSignIn(n);(!C||C===D)&&s?.user&&(m=s.user,w=!0)}if(!m)return this.directlySetCurrentUser(null);if(!m._redirectEventId){if(w)try{await this.beforeStateQueue.runMiddleware(m)}catch(C){m=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(C))}return m?this.reloadAndSetCurrentUserOrClear(m):this.directlySetCurrentUser(null)}return Fn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===m._redirectEventId?this.directlySetCurrentUser(m):this.reloadAndSetCurrentUserOrClear(m)}async tryRedirectSignIn(n){let l=null;try{l=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return l}async reloadAndSetCurrentUserOrClear(n){try{await _b(n)}catch(l){if(l?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=Z3()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(Nc(this.app))return Promise.reject(Jf(this));const l=n?Zs(n):null;return l&&Fn(l.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(l&&l._clone(this))}async _updateCurrentUser(n,l=!1){if(!this._deleted)return n&&Fn(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),l||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return Nc(this.app)?Promise.reject(Jf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return Nc(this.app)?Promise.reject(Jf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Kf(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const l=this._getPasswordPolicyInternal();return l.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):l.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await fN(this),l=new mN(n);this.tenantId===null?this._projectPasswordPolicy=l:this._tenantPasswordPolicies[this.tenantId]=l}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(n){this._errorFactory=new xx("auth","Firebase",n())}onAuthStateChanged(n,l,m){return this.registerStateListener(this.authStateSubscription,n,l,m)}beforeAuthStateChanged(n,l){return this.beforeStateQueue.pushCallback(n,l)}onIdTokenChanged(n,l,m){return this.registerStateListener(this.idTokenSubscription,n,l,m)}authStateReady(){return new Promise((n,l)=>{if(this.currentUser)n();else{const m=this.onAuthStateChanged(()=>{m(),n()},l)}})}async revokeAccessToken(n){if(this.currentUser){const l=await this.currentUser.getIdToken(),m={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:l};this.tenantId!=null&&(m.tenantId=this.tenantId),await cN(this,m)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(n,l){const m=await this.getOrInitRedirectPersistenceManager(l);return n===null?m.removeCurrentUser():m.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const l=n&&Kf(n)||this._popupRedirectResolver;Fn(l,this,"argument-error"),this.redirectPersistenceManager=await py.create(this,[Kf(l._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===n?this._currentUser:this.redirectUser?._redirectEventId===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=this.currentUser?.uid??null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,l,m,w){if(this._deleted)return()=>{};const C=typeof l=="function"?l:l.next.bind(l);let D=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Fn(s,this,"internal-error"),s.then(()=>{D||C(this.currentUser)}),typeof l=="function"){const G=n.addObserver(l,m,w);return()=>{D=!0,G()}}else{const G=n.addObserver(l);return()=>{D=!0,G()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return Fn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=_R(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const l=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();l&&(n["X-Firebase-Client"]=l);const m=await this._getAppCheckToken();return m&&(n["X-Firebase-AppCheck"]=m),n}async _getAppCheckToken(){if(Nc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return n?.error&&q3(`Error while retrieving App Check token: ${n.error}`),n?.token}}function dp(u){return Zs(u)}class Z2{constructor(n){this.auth=n,this.observer=null,this.addObserver=Dk(l=>this.observer=l)}get next(){return Fn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _N(u){Gb=u}function yR(u){return Gb.loadJS(u)}function yN(){return Gb.recaptchaEnterpriseScript}function vN(){return Gb.gapiScript}function xN(u){return`__${u}${Math.floor(Math.random()*1e6)}`}class bN{constructor(){this.enterprise=new wN}ready(n){n()}execute(n,l){return Promise.resolve("token")}render(n,l){return""}}class wN{ready(n){n()}execute(n,l){return Promise.resolve("token")}render(n,l){return""}}const TN="recaptcha-enterprise",vR="NO_RECAPTCHA";class EN{constructor(n){this.type=TN,this.auth=dp(n)}async verify(n="verify",l=!1){async function m(C){if(!l){if(C.tenantId==null&&C._agentRecaptchaConfig!=null)return C._agentRecaptchaConfig.siteKey;if(C.tenantId!=null&&C._tenantRecaptchaConfigs[C.tenantId]!==void 0)return C._tenantRecaptchaConfigs[C.tenantId].siteKey}return new Promise(async(D,s)=>{tN(C,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(G=>{if(G.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const q=new eN(G);return C.tenantId==null?C._agentRecaptchaConfig=q:C._tenantRecaptchaConfigs[C.tenantId]=q,D(q.siteKey)}}).catch(G=>{s(G)})})}function w(C,D,s){const G=window.grecaptcha;G2(G)?G.enterprise.ready(()=>{G.enterprise.execute(C,{action:n}).then(q=>{D(q)}).catch(()=>{D(vR)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new bN().execute("siteKey",{action:"verify"}):new Promise((C,D)=>{m(this.auth).then(s=>{if(!l&&G2(window.grecaptcha))w(s,C,D);else{if(typeof window>"u"){D(new Error("RecaptchaVerifier is only supported in browser"));return}let G=yN();G.length!==0&&(G+=s),yR(G).then(()=>{w(s,C,D)}).catch(q=>{D(q)})}}).catch(s=>{D(s)})})}}async function X2(u,n,l,m=!1,w=!1){const C=new EN(u);let D;if(w)D=vR;else try{D=await C.verify(l)}catch{D=await C.verify(l,!0)}const s={...n};if(l==="mfaSmsEnrollment"||l==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const G=s.phoneEnrollmentInfo.phoneNumber,q=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:G,recaptchaToken:q,captchaResponse:D,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const G=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:G,captchaResponse:D,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return m?Object.assign(s,{captchaResp:D}):Object.assign(s,{captchaResponse:D}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function yb(u,n,l,m,w){if(u._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const C=await X2(u,n,l,l==="getOobCode");return m(u,C)}else return m(u,n).catch(async C=>{if(C.code==="auth/missing-recaptcha-token"){console.log(`${l} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const D=await X2(u,n,l,l==="getOobCode");return m(u,D)}else return Promise.reject(C)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SN(u,n){const l=jb(u,"auth");if(l.isInitialized()){const w=l.getImmediate(),C=l.getOptions();if(Hg(C,n??{}))return w;nh(w,"already-initialized")}return l.initialize({options:n})}function AN(u,n){const l=n?.persistence||[],m=(Array.isArray(l)?l:[l]).map(Kf);n?.errorMap&&u._updateErrorMap(n.errorMap),u._initializeWithPersistence(m,n?.popupRedirectResolver)}function IN(u,n,l){const m=dp(u);Fn(/^https?:\/\//.test(n),m,"invalid-emulator-scheme");const w=!1,C=xR(n),{host:D,port:s}=CN(n),G=s===null?"":`:${s}`,q={url:`${C}//${D}${G}/`},te=Object.freeze({host:D,port:s,protocol:C.replace(":",""),options:Object.freeze({disableWarnings:w})});if(!m._canInitEmulator){Fn(m.config.emulator&&m.emulatorConfig,m,"emulator-config-failed"),Fn(Hg(q,m.config.emulator)&&Hg(te,m.emulatorConfig),m,"emulator-config-failed");return}m.config.emulator=q,m.emulatorConfig=te,m.settings.appVerificationDisabledForTesting=!0,Pm(D)?(zT(`${C}//${D}${G}`),kT("Auth",!0)):RN()}function xR(u){const n=u.indexOf(":");return n<0?"":u.substr(0,n+1)}function CN(u){const n=xR(u),l=/(\/\/)?([^?#/]+)/.exec(u.substr(n.length));if(!l)return{host:"",port:null};const m=l[2].split("@").pop()||"",w=/^(\[[^\]]+\])(:|$)/.exec(m);if(w){const C=w[1];return{host:C,port:Y2(m.substr(C.length+1))}}else{const[C,D]=m.split(":");return{host:C,port:Y2(D)}}}function Y2(u){if(!u)return null;const n=Number(u);return isNaN(n)?null:n}function RN(){function u(){const n=document.createElement("p"),l=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",l.position="fixed",l.width="100%",l.backgroundColor="#ffffff",l.border=".1em solid #000000",l.color="#b50000",l.bottom="0px",l.left="0px",l.margin="0px",l.zIndex="10000",l.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(n,l){this.providerId=n,this.signInMethod=l}toJSON(){return Yf("not implemented")}_getIdTokenResponse(n){return Yf("not implemented")}_linkToIdToken(n,l){return Yf("not implemented")}_getReauthenticationResolver(n){return Yf("not implemented")}}async function MN(u,n){return gf(u,"POST","/v1/accounts:signUp",n)}async function PN(u,n){return gf(u,"POST","/v1/accounts:update",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DN(u,n){return Tx(u,"POST","/v1/accounts:signInWithPassword",mf(u,n))}async function ON(u,n){return gf(u,"POST","/v1/accounts:sendOobCode",mf(u,n))}async function LN(u,n){return ON(u,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zN(u,n){return Tx(u,"POST","/v1/accounts:signInWithEmailLink",mf(u,n))}async function kN(u,n){return Tx(u,"POST","/v1/accounts:signInWithEmailLink",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx extends HT{constructor(n,l,m,w=null){super("password",m),this._email=n,this._password=l,this._tenantId=w}static _fromEmailAndPassword(n,l){return new lx(n,l,"password")}static _fromEmailAndCode(n,l,m=null){return new lx(n,l,"emailLink",m)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const l=typeof n=="string"?JSON.parse(n):n;if(l?.email&&l?.password){if(l.signInMethod==="password")return this._fromEmailAndPassword(l.email,l.password);if(l.signInMethod==="emailLink")return this._fromEmailAndCode(l.email,l.password,l.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const l={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yb(n,l,"signInWithPassword",DN);case"emailLink":return zN(n,{email:this._email,oobCode:this._password});default:nh(n,"internal-error")}}async _linkToIdToken(n,l){switch(this.signInMethod){case"password":const m={idToken:l,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yb(n,m,"signUpPassword",MN);case"emailLink":return kN(n,{idToken:l,email:this._email,oobCode:this._password});default:nh(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function my(u,n){return Tx(u,"POST","/v1/accounts:signInWithIdp",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN="http://localhost";class $g extends HT{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const l=new $g(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(l.idToken=n.idToken),n.accessToken&&(l.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(l.nonce=n.nonce),n.pendingToken&&(l.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(l.accessToken=n.oauthToken,l.secret=n.oauthTokenSecret):nh("argument-error"),l}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const l=typeof n=="string"?JSON.parse(n):n,{providerId:m,signInMethod:w,...C}=l;if(!m||!w)return null;const D=new $g(m,w);return D.idToken=C.idToken||void 0,D.accessToken=C.accessToken||void 0,D.secret=C.secret,D.nonce=C.nonce,D.pendingToken=C.pendingToken||null,D}_getIdTokenResponse(n){const l=this.buildRequest();return my(n,l)}_linkToIdToken(n,l){const m=this.buildRequest();return m.idToken=l,my(n,m)}_getReauthenticationResolver(n){const l=this.buildRequest();return l.autoCreate=!1,my(n,l)}buildRequest(){const n={requestUri:NN,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const l={};this.idToken&&(l.id_token=this.idToken),this.accessToken&&(l.access_token=this.accessToken),this.secret&&(l.oauth_token_secret=this.secret),l.providerId=this.providerId,this.nonce&&!this.pendingToken&&(l.nonce=this.nonce),n.postBody=bx(l)}return n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FN(u){switch(u){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function BN(u){const n=Hv(Wv(u)).link,l=n?Hv(Wv(n)).deep_link_id:null,m=Hv(Wv(u)).deep_link_id;return(m?Hv(Wv(m)).link:null)||m||l||n||u}class WT{constructor(n){const l=Hv(Wv(n)),m=l.apiKey??null,w=l.oobCode??null,C=FN(l.mode??null);Fn(m&&w&&C,"argument-error"),this.apiKey=m,this.operation=C,this.code=w,this.continueUrl=l.continueUrl??null,this.languageCode=l.lang??null,this.tenantId=l.tenantId??null}static parseLink(n){const l=BN(n);try{return new WT(l)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(){this.providerId=My.PROVIDER_ID}static credential(n,l){return lx._fromEmailAndPassword(n,l)}static credentialWithLink(n,l){const m=WT.parseLink(l);return Fn(m,"argument-error"),lx._fromEmailAndCode(n,m.code,m.tenantId)}}My.PROVIDER_ID="password";My.EMAIL_PASSWORD_SIGN_IN_METHOD="password";My.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $T{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex extends $T{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm extends Ex{constructor(){super("facebook.com")}static credential(n){return $g._fromParams({providerId:fm.PROVIDER_ID,signInMethod:fm.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return fm.credentialFromTaggedObject(n)}static credentialFromError(n){return fm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return fm.credential(n.oauthAccessToken)}catch{return null}}}fm.FACEBOOK_SIGN_IN_METHOD="facebook.com";fm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef extends Ex{constructor(){super("google.com"),this.addScope("profile")}static credential(n,l){return $g._fromParams({providerId:ef.PROVIDER_ID,signInMethod:ef.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:l})}static credentialFromResult(n){return ef.credentialFromTaggedObject(n)}static credentialFromError(n){return ef.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:l,oauthAccessToken:m}=n;if(!l&&!m)return null;try{return ef.credential(l,m)}catch{return null}}}ef.GOOGLE_SIGN_IN_METHOD="google.com";ef.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm extends Ex{constructor(){super("github.com")}static credential(n){return $g._fromParams({providerId:pm.PROVIDER_ID,signInMethod:pm.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return pm.credentialFromTaggedObject(n)}static credentialFromError(n){return pm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return pm.credential(n.oauthAccessToken)}catch{return null}}}pm.GITHUB_SIGN_IN_METHOD="github.com";pm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm extends Ex{constructor(){super("twitter.com")}static credential(n,l){return $g._fromParams({providerId:mm.PROVIDER_ID,signInMethod:mm.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:l})}static credentialFromResult(n){return mm.credentialFromTaggedObject(n)}static credentialFromError(n){return mm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:l,oauthTokenSecret:m}=n;if(!l||!m)return null;try{return mm.credential(l,m)}catch{return null}}}mm.TWITTER_SIGN_IN_METHOD="twitter.com";mm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VN(u,n){return Tx(u,"POST","/v1/accounts:signUp",mf(u,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zg{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,l,m,w=!1){const C=await Yh._fromIdTokenResponse(n,m,w),D=K2(m);return new Zg({user:C,providerId:D,_tokenResponse:m,operationType:l})}static async _forOperation(n,l,m){await n._updateTokensIfNecessary(m,!0);const w=K2(m);return new Zg({user:n,providerId:w,_tokenResponse:m,operationType:l})}}function K2(u){return u.providerId?u.providerId:"phoneNumber"in u?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb extends pf{constructor(n,l,m,w){super(l.code,l.message),this.operationType=m,this.user=w,Object.setPrototypeOf(this,vb.prototype),this.customData={appName:n.name,tenantId:n.tenantId??void 0,_serverResponse:l.customData._serverResponse,operationType:m}}static _fromErrorAndOperation(n,l,m,w){return new vb(n,l,m,w)}}function bR(u,n,l,m){return(n==="reauthenticate"?l._getReauthenticationResolver(u):l._getIdTokenResponse(u)).catch(C=>{throw C.code==="auth/multi-factor-auth-required"?vb._fromErrorAndOperation(u,C,n,m):C})}async function UN(u,n,l=!1){const m=await ax(u,n._linkToIdToken(u.auth,await u.getIdToken()),l);return Zg._forOperation(u,"link",m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jN(u,n,l=!1){const{auth:m}=u;if(Nc(m.app))return Promise.reject(Jf(m));const w="reauthenticate";try{const C=await ax(u,bR(m,w,n,u),l);Fn(C.idToken,m,"internal-error");const D=GT(C.idToken);Fn(D,m,"internal-error");const{sub:s}=D;return Fn(u.uid===s,m,"user-mismatch"),Zg._forOperation(u,w,C)}catch(C){throw C?.code==="auth/user-not-found"&&nh(m,"user-mismatch"),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wR(u,n,l=!1){if(Nc(u.app))return Promise.reject(Jf(u));const m="signIn",w=await bR(u,m,n),C=await Zg._fromIdTokenResponse(u,m,w);return l||await u._updateCurrentUser(C.user),C}async function GN(u,n){return wR(dp(u),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TR(u){const n=dp(u);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function qN(u,n,l){const m=dp(u);await yb(m,{requestType:"PASSWORD_RESET",email:n,clientType:"CLIENT_TYPE_WEB"},"getOobCode",LN)}async function HN(u,n){await PN(Zs(u),{oobCode:n})}async function WN(u,n,l){if(Nc(u.app))return Promise.reject(Jf(u));const m=dp(u),D=await yb(m,{returnSecureToken:!0,email:n,password:l,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",VN).catch(G=>{throw G.code==="auth/password-does-not-meet-requirements"&&TR(u),G}),s=await Zg._fromIdTokenResponse(m,"signIn",D);return await m._updateCurrentUser(s.user),s}function $N(u,n,l){return Nc(u.app)?Promise.reject(Jf(u)):GN(Zs(u),My.credential(n,l)).catch(async m=>{throw m.code==="auth/password-does-not-meet-requirements"&&TR(u),m})}function ZN(u,n,l,m){return Zs(u).onIdTokenChanged(n,l,m)}function XN(u,n,l){return Zs(u).beforeAuthStateChanged(n,l)}function YN(u,n,l,m){return Zs(u).onAuthStateChanged(n,l,m)}function KN(u){return Zs(u).signOut()}const xb="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(n,l){this.storageRetriever=n,this.type=l}_isAvailable(){try{return this.storage?(this.storage.setItem(xb,"1"),this.storage.removeItem(xb),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,l){return this.storage.setItem(n,JSON.stringify(l)),Promise.resolve()}_get(n){const l=this.storage.getItem(n);return Promise.resolve(l?JSON.parse(l):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=1e3,JN=10;class SR extends ER{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,l)=>this.onStorageEvent(n,l),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gR(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const l of Object.keys(this.listeners)){const m=this.storage.getItem(l),w=this.localCache[l];m!==w&&n(l,w,m)}}onStorageEvent(n,l=!1){if(!n.key){this.forAllChangedKeys((D,s,G)=>{this.notifyListeners(D,G)});return}const m=n.key;l?this.detachListener():this.stopPolling();const w=()=>{const D=this.storage.getItem(m);!l&&this.localCache[m]===D||this.notifyListeners(m,D)},C=this.storage.getItem(m);hN()&&C!==n.newValue&&n.newValue!==n.oldValue?setTimeout(w,JN):w()}notifyListeners(n,l){this.localCache[n]=l;const m=this.listeners[n];if(m)for(const w of Array.from(m))w(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,l,m)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:l,newValue:m}),!0)})},QN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,l){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(l)}_removeListener(n,l){this.listeners[n]&&(this.listeners[n].delete(l),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,l){await super._set(n,l),this.localCache[n]=JSON.stringify(l)}async _get(n){const l=await super._get(n);return this.localCache[n]=JSON.stringify(l),l}async _remove(n){await super._remove(n),delete this.localCache[n]}}SR.type="LOCAL";const eF=SR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR extends ER{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,l){}_removeListener(n,l){}}AR.type="SESSION";const IR=AR;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tF(u){return Promise.all(u.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(l){return{fulfilled:!1,reason:l}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const l=this.receivers.find(w=>w.isListeningto(n));if(l)return l;const m=new qb(n);return this.receivers.push(m),m}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const l=n,{eventId:m,eventType:w,data:C}=l.data,D=this.handlersMap[w];if(!D?.size)return;l.ports[0].postMessage({status:"ack",eventId:m,eventType:w});const s=Array.from(D).map(async q=>q(l.origin,C)),G=await tF(s);l.ports[0].postMessage({status:"done",eventId:m,eventType:w,response:G})}_subscribe(n,l){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(l)}_unsubscribe(n,l){this.handlersMap[n]&&l&&this.handlersMap[n].delete(l),(!l||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(u="",n=10){let l="";for(let m=0;m<n;m++)l+=Math.floor(Math.random()*10);return u+l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,l,m=50){const w=typeof MessageChannel<"u"?new MessageChannel:null;if(!w)throw new Error("connection_unavailable");let C,D;return new Promise((s,G)=>{const q=ZT("",20);w.port1.start();const te=setTimeout(()=>{G(new Error("unsupported_event"))},m);D={messageChannel:w,onMessage(ce){const we=ce;if(we.data.eventId===q)switch(we.data.status){case"ack":clearTimeout(te),C=setTimeout(()=>{G(new Error("timeout"))},3e3);break;case"done":clearTimeout(C),s(we.data.response);break;default:clearTimeout(te),clearTimeout(C),G(new Error("invalid_response"));break}}},this.handlers.add(D),w.port1.addEventListener("message",D.onMessage),this.target.postMessage({eventType:n,eventId:q,data:l},[w.port2])}).finally(()=>{D&&this.removeMessageHandler(D)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(){return window}function nF(u){sf().location.href=u}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CR(){return typeof sf().WorkerGlobalScope<"u"&&typeof sf().importScripts=="function"}async function rF(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function sF(){return navigator?.serviceWorker?.controller||null}function oF(){return CR()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="firebaseLocalStorageDb",aF=1,bb="firebaseLocalStorage",MR="fbase_key";class Sx{constructor(n){this.request=n}toPromise(){return new Promise((n,l)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{l(this.request.error)})})}}function Hb(u,n){return u.transaction([bb],n?"readwrite":"readonly").objectStore(bb)}function lF(){const u=indexedDB.deleteDatabase(RR);return new Sx(u).toPromise()}function sT(){const u=indexedDB.open(RR,aF);return new Promise((n,l)=>{u.addEventListener("error",()=>{l(u.error)}),u.addEventListener("upgradeneeded",()=>{const m=u.result;try{m.createObjectStore(bb,{keyPath:MR})}catch(w){l(w)}}),u.addEventListener("success",async()=>{const m=u.result;m.objectStoreNames.contains(bb)?n(m):(m.close(),await lF(),n(await sT()))})})}async function Q2(u,n,l){const m=Hb(u,!0).put({[MR]:n,value:l});return new Sx(m).toPromise()}async function cF(u,n){const l=Hb(u,!1).get(n),m=await new Sx(l).toPromise();return m===void 0?null:m.value}function J2(u,n){const l=Hb(u,!0).delete(n);return new Sx(l).toPromise()}const uF=800,hF=3;class PR{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sT(),this.db)}async _withRetries(n){let l=0;for(;;)try{const m=await this._openDb();return await n(m)}catch(m){if(l++>hF)throw m;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return CR()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qb._getInstance(oF()),this.receiver._subscribe("keyChanged",async(n,l)=>({keyProcessed:(await this._poll()).includes(l.key)})),this.receiver._subscribe("ping",async(n,l)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await rF(),!this.activeServiceWorker)return;this.sender=new iF(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&n[0]?.fulfilled&&n[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||sF()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await sT();return await Q2(n,xb,"1"),await J2(n,xb),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,l){return this._withPendingWrite(async()=>(await this._withRetries(m=>Q2(m,n,l)),this.localCache[n]=l,this.notifyServiceWorker(n)))}async _get(n){const l=await this._withRetries(m=>cF(m,n));return this.localCache[n]=l,l}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(l=>J2(l,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(w=>{const C=Hb(w,!1).getAll();return new Sx(C).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const l=[],m=new Set;if(n.length!==0)for(const{fbase_key:w,value:C}of n)m.add(w),JSON.stringify(this.localCache[w])!==JSON.stringify(C)&&(this.notifyListeners(w,C),l.push(w));for(const w of Object.keys(this.localCache))this.localCache[w]&&!m.has(w)&&(this.notifyListeners(w,null),l.push(w));return l}notifyListeners(n,l){this.localCache[n]=l;const m=this.listeners[n];if(m)for(const w of Array.from(m))w(l)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),uF)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,l){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(l)}_removeListener(n,l){this.listeners[n]&&(this.listeners[n].delete(l),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}PR.type="LOCAL";const dF=PR;new wx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DR(u,n){return n?Kf(n):(Fn(u._popupRedirectResolver,u,"argument-error"),u._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT extends HT{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return my(n,this._buildIdpRequest())}_linkToIdToken(n,l){return my(n,this._buildIdpRequest(l))}_getReauthenticationResolver(n){return my(n,this._buildIdpRequest())}_buildIdpRequest(n){const l={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(l.idToken=n),l}}function fF(u){return wR(u.auth,new XT(u),u.bypassAuthState)}function pF(u){const{auth:n,user:l}=u;return Fn(l,n,"internal-error"),jN(l,new XT(u),u.bypassAuthState)}async function mF(u){const{auth:n,user:l}=u;return Fn(l,n,"internal-error"),UN(l,new XT(u),u.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(n,l,m,w,C=!1){this.auth=n,this.resolver=m,this.user=w,this.bypassAuthState=C,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(l)?l:[l]}execute(){return new Promise(async(n,l)=>{this.pendingPromise={resolve:n,reject:l};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(m){this.reject(m)}})}async onAuthEvent(n){const{urlResponse:l,sessionId:m,postBody:w,tenantId:C,error:D,type:s}=n;if(D){this.reject(D);return}const G={auth:this.auth,requestUri:l,sessionId:m,tenantId:C||void 0,postBody:w||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(G))}catch(q){this.reject(q)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return fF;case"linkViaPopup":case"linkViaRedirect":return mF;case"reauthViaPopup":case"reauthViaRedirect":return pF;default:nh(this.auth,"internal-error")}}resolve(n){rp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){rp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gF=new wx(2e3,1e4);async function _F(u,n,l){if(Nc(u.app))return Promise.reject(Kh(u,"operation-not-supported-in-this-environment"));const m=dp(u);H3(u,n,$T);const w=DR(m,l);return new Bg(m,"signInViaPopup",n,w).executeNotNull()}class Bg extends OR{constructor(n,l,m,w,C){super(n,l,w,C),this.provider=m,this.authWindow=null,this.pollId=null,Bg.currentPopupAction&&Bg.currentPopupAction.cancel(),Bg.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return Fn(n,this.auth,"internal-error"),n}async onExecution(){rp(this.filter.length===1,"Popup operations only handle one event");const n=ZT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(l=>{this.reject(l)}),this.resolver._isIframeWebStorageSupported(this.auth,l=>{l||this.reject(Kh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Kh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Bg.currentPopupAction=null}pollUserCancellation(){const n=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Kh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,gF.get())};n()}}Bg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF="pendingRedirect",nb=new Map;class vF extends OR{constructor(n,l,m=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],l,void 0,m),this.eventId=null}async execute(){let n=nb.get(this.auth._key());if(!n){try{const m=await xF(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(m)}catch(l){n=()=>Promise.reject(l)}nb.set(this.auth._key(),n)}return this.bypassAuthState||nb.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const l=await this.auth._redirectUserForId(n.eventId);if(l)return this.user=l,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function xF(u,n){const l=TF(n),m=wF(u);if(!await m._isAvailable())return!1;const w=await m._get(l)==="true";return await m._remove(l),w}function bF(u,n){nb.set(u._key(),n)}function wF(u){return Kf(u._redirectPersistence)}function TF(u){return ib(yF,u.config.apiKey,u.name)}async function EF(u,n,l=!1){if(Nc(u.app))return Promise.reject(Jf(u));const m=dp(u),w=DR(m,n),D=await new vF(m,w,l).execute();return D&&!l&&(delete D.user._redirectEventId,await m._persistUserIfCurrent(D.user),await m._setRedirectUser(null,n)),D}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SF=600*1e3;class AF{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let l=!1;return this.consumers.forEach(m=>{this.isEventForConsumer(n,m)&&(l=!0,this.sendToConsumer(n,m),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!IF(n)||(this.hasHandledPotentialRedirect=!0,l||(this.queuedRedirectEvent=n,l=!0)),l}sendToConsumer(n,l){if(n.error&&!LR(n)){const m=n.error.code?.split("auth/")[1]||"internal-error";l.onError(Kh(this.auth,m))}else l.onAuthEvent(n)}isEventForConsumer(n,l){const m=l.eventId===null||!!n.eventId&&n.eventId===l.eventId;return l.filter.includes(n.type)&&m}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=SF&&this.cachedEventUids.clear(),this.cachedEventUids.has(eI(n))}saveEventToCache(n){this.cachedEventUids.add(eI(n)),this.lastProcessedEventTime=Date.now()}}function eI(u){return[u.type,u.eventId,u.sessionId,u.tenantId].filter(n=>n).join("-")}function LR({type:u,error:n}){return u==="unknown"&&n?.code==="auth/no-auth-event"}function IF(u){switch(u.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LR(u);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CF(u,n={}){return gf(u,"GET","/v1/projects",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,MF=/^https?/;async function PF(u){if(u.config.emulator)return;const{authorizedDomains:n}=await CF(u);for(const l of n)try{if(DF(l))return}catch{}nh(u,"unauthorized-domain")}function DF(u){const n=nT(),{protocol:l,hostname:m}=new URL(n);if(u.startsWith("chrome-extension://")){const D=new URL(u);return D.hostname===""&&m===""?l==="chrome-extension:"&&u.replace("chrome-extension://","")===n.replace("chrome-extension://",""):l==="chrome-extension:"&&D.hostname===m}if(!MF.test(l))return!1;if(RF.test(u))return m===u;const w=u.replace(/\./g,"\\.");return new RegExp("^(.+\\."+w+"|"+w+")$","i").test(m)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OF=new wx(3e4,6e4);function tI(){const u=sf().___jsl;if(u?.H){for(const n of Object.keys(u.H))if(u.H[n].r=u.H[n].r||[],u.H[n].L=u.H[n].L||[],u.H[n].r=[...u.H[n].L],u.CP)for(let l=0;l<u.CP.length;l++)u.CP[l]=null}}function LF(u){return new Promise((n,l)=>{function m(){tI(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{tI(),l(Kh(u,"network-request-failed"))},timeout:OF.get()})}if(sf().gapi?.iframes?.Iframe)n(gapi.iframes.getContext());else if(sf().gapi?.load)m();else{const w=xN("iframefcb");return sf()[w]=()=>{gapi.load?m():l(Kh(u,"network-request-failed"))},yR(`${vN()}?onload=${w}`).catch(C=>l(C))}}).catch(n=>{throw rb=null,n})}let rb=null;function zF(u){return rb=rb||LF(u),rb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kF=new wx(5e3,15e3),NF="__/auth/iframe",FF="emulator/auth/iframe",BF={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},VF=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function UF(u){const n=u.config;Fn(n.authDomain,u,"auth-domain-config-required");const l=n.emulator?jT(n,FF):`https://${u.config.authDomain}/${NF}`,m={apiKey:n.apiKey,appName:u.name,v:Qg},w=VF.get(u.config.apiHost);w&&(m.eid=w);const C=u._getFrameworks();return C.length&&(m.fw=C.join(",")),`${l}?${bx(m).slice(1)}`}async function jF(u){const n=await zF(u),l=sf().gapi;return Fn(l,u,"internal-error"),n.open({where:document.body,url:UF(u),messageHandlersFilter:l.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:BF,dontclear:!0},m=>new Promise(async(w,C)=>{await m.restyle({setHideOnLeave:!1});const D=Kh(u,"network-request-failed"),s=sf().setTimeout(()=>{C(D)},kF.get());function G(){sf().clearTimeout(s),w(m)}m.ping(G).then(G,()=>{C(D)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qF=500,HF=600,WF="_blank",$F="http://localhost";class iI{constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ZF(u,n,l,m=qF,w=HF){const C=Math.max((window.screen.availHeight-w)/2,0).toString(),D=Math.max((window.screen.availWidth-m)/2,0).toString();let s="";const G={...GF,width:m.toString(),height:w.toString(),top:C,left:D},q=Al().toLowerCase();l&&(s=hR(q)?WF:l),cR(q)&&(n=n||$F,G.scrollbars="yes");const te=Object.entries(G).reduce((we,[ze,at])=>`${we}${ze}=${at},`,"");if(uN(q)&&s!=="_self")return XF(n||"",s),new iI(null);const ce=window.open(n||"",s,te);Fn(ce,u,"popup-blocked");try{ce.focus()}catch{}return new iI(ce)}function XF(u,n){const l=document.createElement("a");l.href=u,l.target=n;const m=document.createEvent("MouseEvent");m.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),l.dispatchEvent(m)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YF="__/auth/handler",KF="emulator/auth/handler",QF=encodeURIComponent("fac");async function nI(u,n,l,m,w,C){Fn(u.config.authDomain,u,"auth-domain-config-required"),Fn(u.config.apiKey,u,"invalid-api-key");const D={apiKey:u.config.apiKey,appName:u.name,authType:l,redirectUrl:m,v:Qg,eventId:w};if(n instanceof $T){n.setDefaultLanguage(u.languageCode),D.providerId=n.providerId||"",Pk(n.getCustomParameters())||(D.customParameters=JSON.stringify(n.getCustomParameters()));for(const[te,ce]of Object.entries({}))D[te]=ce}if(n instanceof Ex){const te=n.getScopes().filter(ce=>ce!=="");te.length>0&&(D.scopes=te.join(","))}u.tenantId&&(D.tid=u.tenantId);const s=D;for(const te of Object.keys(s))s[te]===void 0&&delete s[te];const G=await u._getAppCheckToken(),q=G?`#${QF}=${encodeURIComponent(G)}`:"";return`${JF(u)}?${bx(s).slice(1)}${q}`}function JF({config:u}){return u.emulator?jT(u,KF):`https://${u.authDomain}/${YF}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="webStorageSupport";class eB{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=IR,this._completeRedirectFn=EF,this._overrideRedirectResult=bF}async _openPopup(n,l,m,w){rp(this.eventManagers[n._key()]?.manager,"_initialize() not called before _openPopup()");const C=await nI(n,l,m,nT(),w);return ZF(n,C,ZT())}async _openRedirect(n,l,m,w){await this._originValidation(n);const C=await nI(n,l,m,nT(),w);return nF(C),new Promise(()=>{})}_initialize(n){const l=n._key();if(this.eventManagers[l]){const{manager:w,promise:C}=this.eventManagers[l];return w?Promise.resolve(w):(rp(C,"If manager is not set, promise should be"),C)}const m=this.initAndGetManager(n);return this.eventManagers[l]={promise:m},m.catch(()=>{delete this.eventManagers[l]}),m}async initAndGetManager(n){const l=await jF(n),m=new AF(n);return l.register("authEvent",w=>(Fn(w?.authEvent,n,"invalid-auth-event"),{status:m.onEvent(w.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:m},this.iframes[n._key()]=l,m}_isIframeWebStorageSupported(n,l){this.iframes[n._key()].send(Fw,{type:Fw},w=>{const C=w?.[0]?.[Fw];C!==void 0&&l(!!C),nh(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const l=n._key();return this.originValidationPromises[l]||(this.originValidationPromises[l]=PF(n)),this.originValidationPromises[l]}get _shouldInitProactively(){return gR()||uR()||qT()}}const tB=eB;var rI="@firebase/auth",sI="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iB{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const l=this.auth.onIdTokenChanged(m=>{n(m?.stsTokenManager.accessToken||null)});this.internalListeners.set(n,l),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const l=this.internalListeners.get(n);l&&(this.internalListeners.delete(n),l(),this.updateProactiveRefresh())}assertAuthConfigured(){Fn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nB(u){switch(u){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rB(u){Wg(new wm("auth",(n,{options:l})=>{const m=n.getProvider("app").getImmediate(),w=n.getProvider("heartbeat"),C=n.getProvider("app-check-internal"),{apiKey:D,authDomain:s}=m.options;Fn(D&&!D.includes(":"),"invalid-api-key",{appName:m.name});const G={apiKey:D,authDomain:s,clientPlatform:u,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_R(u)},q=new gN(m,w,C,G);return AN(q,l),q},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,l,m)=>{n.getProvider("auth-internal").initialize()})),Wg(new wm("auth-internal",n=>{const l=dp(n.getProvider("auth").getImmediate());return(m=>new iB(m))(l)},"PRIVATE").setInstantiationMode("EXPLICIT")),rf(rI,sI,nB(u)),rf(rI,sI,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sB=300,oB=XC("authIdTokenMaxAge")||sB;let oI=null;const aB=u=>async n=>{const l=n&&await n.getIdTokenResult(),m=l&&(new Date().getTime()-Date.parse(l.issuedAtTime))/1e3;if(m&&m>oB)return;const w=l?.token;oI!==w&&(oI=w,await fetch(u,{method:w?"POST":"DELETE",headers:w?{Authorization:`Bearer ${w}`}:{}}))};function Ax(u=BT()){const n=jb(u,"auth");if(n.isInitialized())return n.getImmediate();const l=SN(u,{popupRedirectResolver:tB,persistence:[dF,eF,IR]}),m=XC("authTokenSyncURL");if(m&&typeof isSecureContext=="boolean"&&isSecureContext){const C=new URL(m,location.origin);if(location.origin===C.origin){const D=aB(C.toString());XN(l,D,()=>D(l.currentUser)),ZN(l,s=>D(s))}}const w=WC("auth");return w&&IN(l,`http://${w}`),l}function lB(){return document.getElementsByTagName("head")?.[0]??document}_N({loadJS(u){return new Promise((n,l)=>{const m=document.createElement("script");m.setAttribute("src",u),m.onload=n,m.onerror=w=>{const C=Kh("internal-error");C.customData=w,l(C)},m.type="text/javascript",m.charset="UTF-8",lB().appendChild(m)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rB("Browser");var aI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xm,zR;(function(){var u;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n(Ve,ke){function We(){}We.prototype=ke.prototype,Ve.F=ke.prototype,Ve.prototype=new We,Ve.prototype.constructor=Ve,Ve.D=function(ht,$e,_t){for(var Ue=Array(arguments.length-2),Cn=2;Cn<arguments.length;Cn++)Ue[Cn-2]=arguments[Cn];return ke.prototype[$e].apply(ht,Ue)}}function l(){this.blockSize=-1}function m(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}n(m,l),m.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function w(Ve,ke,We){We||(We=0);const ht=Array(16);if(typeof ke=="string")for(var $e=0;$e<16;++$e)ht[$e]=ke.charCodeAt(We++)|ke.charCodeAt(We++)<<8|ke.charCodeAt(We++)<<16|ke.charCodeAt(We++)<<24;else for($e=0;$e<16;++$e)ht[$e]=ke[We++]|ke[We++]<<8|ke[We++]<<16|ke[We++]<<24;ke=Ve.g[0],We=Ve.g[1],$e=Ve.g[2];let _t=Ve.g[3],Ue;Ue=ke+(_t^We&($e^_t))+ht[0]+3614090360&4294967295,ke=We+(Ue<<7&4294967295|Ue>>>25),Ue=_t+($e^ke&(We^$e))+ht[1]+3905402710&4294967295,_t=ke+(Ue<<12&4294967295|Ue>>>20),Ue=$e+(We^_t&(ke^We))+ht[2]+606105819&4294967295,$e=_t+(Ue<<17&4294967295|Ue>>>15),Ue=We+(ke^$e&(_t^ke))+ht[3]+3250441966&4294967295,We=$e+(Ue<<22&4294967295|Ue>>>10),Ue=ke+(_t^We&($e^_t))+ht[4]+4118548399&4294967295,ke=We+(Ue<<7&4294967295|Ue>>>25),Ue=_t+($e^ke&(We^$e))+ht[5]+1200080426&4294967295,_t=ke+(Ue<<12&4294967295|Ue>>>20),Ue=$e+(We^_t&(ke^We))+ht[6]+2821735955&4294967295,$e=_t+(Ue<<17&4294967295|Ue>>>15),Ue=We+(ke^$e&(_t^ke))+ht[7]+4249261313&4294967295,We=$e+(Ue<<22&4294967295|Ue>>>10),Ue=ke+(_t^We&($e^_t))+ht[8]+1770035416&4294967295,ke=We+(Ue<<7&4294967295|Ue>>>25),Ue=_t+($e^ke&(We^$e))+ht[9]+2336552879&4294967295,_t=ke+(Ue<<12&4294967295|Ue>>>20),Ue=$e+(We^_t&(ke^We))+ht[10]+4294925233&4294967295,$e=_t+(Ue<<17&4294967295|Ue>>>15),Ue=We+(ke^$e&(_t^ke))+ht[11]+2304563134&4294967295,We=$e+(Ue<<22&4294967295|Ue>>>10),Ue=ke+(_t^We&($e^_t))+ht[12]+1804603682&4294967295,ke=We+(Ue<<7&4294967295|Ue>>>25),Ue=_t+($e^ke&(We^$e))+ht[13]+4254626195&4294967295,_t=ke+(Ue<<12&4294967295|Ue>>>20),Ue=$e+(We^_t&(ke^We))+ht[14]+2792965006&4294967295,$e=_t+(Ue<<17&4294967295|Ue>>>15),Ue=We+(ke^$e&(_t^ke))+ht[15]+1236535329&4294967295,We=$e+(Ue<<22&4294967295|Ue>>>10),Ue=ke+($e^_t&(We^$e))+ht[1]+4129170786&4294967295,ke=We+(Ue<<5&4294967295|Ue>>>27),Ue=_t+(We^$e&(ke^We))+ht[6]+3225465664&4294967295,_t=ke+(Ue<<9&4294967295|Ue>>>23),Ue=$e+(ke^We&(_t^ke))+ht[11]+643717713&4294967295,$e=_t+(Ue<<14&4294967295|Ue>>>18),Ue=We+(_t^ke&($e^_t))+ht[0]+3921069994&4294967295,We=$e+(Ue<<20&4294967295|Ue>>>12),Ue=ke+($e^_t&(We^$e))+ht[5]+3593408605&4294967295,ke=We+(Ue<<5&4294967295|Ue>>>27),Ue=_t+(We^$e&(ke^We))+ht[10]+38016083&4294967295,_t=ke+(Ue<<9&4294967295|Ue>>>23),Ue=$e+(ke^We&(_t^ke))+ht[15]+3634488961&4294967295,$e=_t+(Ue<<14&4294967295|Ue>>>18),Ue=We+(_t^ke&($e^_t))+ht[4]+3889429448&4294967295,We=$e+(Ue<<20&4294967295|Ue>>>12),Ue=ke+($e^_t&(We^$e))+ht[9]+568446438&4294967295,ke=We+(Ue<<5&4294967295|Ue>>>27),Ue=_t+(We^$e&(ke^We))+ht[14]+3275163606&4294967295,_t=ke+(Ue<<9&4294967295|Ue>>>23),Ue=$e+(ke^We&(_t^ke))+ht[3]+4107603335&4294967295,$e=_t+(Ue<<14&4294967295|Ue>>>18),Ue=We+(_t^ke&($e^_t))+ht[8]+1163531501&4294967295,We=$e+(Ue<<20&4294967295|Ue>>>12),Ue=ke+($e^_t&(We^$e))+ht[13]+2850285829&4294967295,ke=We+(Ue<<5&4294967295|Ue>>>27),Ue=_t+(We^$e&(ke^We))+ht[2]+4243563512&4294967295,_t=ke+(Ue<<9&4294967295|Ue>>>23),Ue=$e+(ke^We&(_t^ke))+ht[7]+1735328473&4294967295,$e=_t+(Ue<<14&4294967295|Ue>>>18),Ue=We+(_t^ke&($e^_t))+ht[12]+2368359562&4294967295,We=$e+(Ue<<20&4294967295|Ue>>>12),Ue=ke+(We^$e^_t)+ht[5]+4294588738&4294967295,ke=We+(Ue<<4&4294967295|Ue>>>28),Ue=_t+(ke^We^$e)+ht[8]+2272392833&4294967295,_t=ke+(Ue<<11&4294967295|Ue>>>21),Ue=$e+(_t^ke^We)+ht[11]+1839030562&4294967295,$e=_t+(Ue<<16&4294967295|Ue>>>16),Ue=We+($e^_t^ke)+ht[14]+4259657740&4294967295,We=$e+(Ue<<23&4294967295|Ue>>>9),Ue=ke+(We^$e^_t)+ht[1]+2763975236&4294967295,ke=We+(Ue<<4&4294967295|Ue>>>28),Ue=_t+(ke^We^$e)+ht[4]+1272893353&4294967295,_t=ke+(Ue<<11&4294967295|Ue>>>21),Ue=$e+(_t^ke^We)+ht[7]+4139469664&4294967295,$e=_t+(Ue<<16&4294967295|Ue>>>16),Ue=We+($e^_t^ke)+ht[10]+3200236656&4294967295,We=$e+(Ue<<23&4294967295|Ue>>>9),Ue=ke+(We^$e^_t)+ht[13]+681279174&4294967295,ke=We+(Ue<<4&4294967295|Ue>>>28),Ue=_t+(ke^We^$e)+ht[0]+3936430074&4294967295,_t=ke+(Ue<<11&4294967295|Ue>>>21),Ue=$e+(_t^ke^We)+ht[3]+3572445317&4294967295,$e=_t+(Ue<<16&4294967295|Ue>>>16),Ue=We+($e^_t^ke)+ht[6]+76029189&4294967295,We=$e+(Ue<<23&4294967295|Ue>>>9),Ue=ke+(We^$e^_t)+ht[9]+3654602809&4294967295,ke=We+(Ue<<4&4294967295|Ue>>>28),Ue=_t+(ke^We^$e)+ht[12]+3873151461&4294967295,_t=ke+(Ue<<11&4294967295|Ue>>>21),Ue=$e+(_t^ke^We)+ht[15]+530742520&4294967295,$e=_t+(Ue<<16&4294967295|Ue>>>16),Ue=We+($e^_t^ke)+ht[2]+3299628645&4294967295,We=$e+(Ue<<23&4294967295|Ue>>>9),Ue=ke+($e^(We|~_t))+ht[0]+4096336452&4294967295,ke=We+(Ue<<6&4294967295|Ue>>>26),Ue=_t+(We^(ke|~$e))+ht[7]+1126891415&4294967295,_t=ke+(Ue<<10&4294967295|Ue>>>22),Ue=$e+(ke^(_t|~We))+ht[14]+2878612391&4294967295,$e=_t+(Ue<<15&4294967295|Ue>>>17),Ue=We+(_t^($e|~ke))+ht[5]+4237533241&4294967295,We=$e+(Ue<<21&4294967295|Ue>>>11),Ue=ke+($e^(We|~_t))+ht[12]+1700485571&4294967295,ke=We+(Ue<<6&4294967295|Ue>>>26),Ue=_t+(We^(ke|~$e))+ht[3]+2399980690&4294967295,_t=ke+(Ue<<10&4294967295|Ue>>>22),Ue=$e+(ke^(_t|~We))+ht[10]+4293915773&4294967295,$e=_t+(Ue<<15&4294967295|Ue>>>17),Ue=We+(_t^($e|~ke))+ht[1]+2240044497&4294967295,We=$e+(Ue<<21&4294967295|Ue>>>11),Ue=ke+($e^(We|~_t))+ht[8]+1873313359&4294967295,ke=We+(Ue<<6&4294967295|Ue>>>26),Ue=_t+(We^(ke|~$e))+ht[15]+4264355552&4294967295,_t=ke+(Ue<<10&4294967295|Ue>>>22),Ue=$e+(ke^(_t|~We))+ht[6]+2734768916&4294967295,$e=_t+(Ue<<15&4294967295|Ue>>>17),Ue=We+(_t^($e|~ke))+ht[13]+1309151649&4294967295,We=$e+(Ue<<21&4294967295|Ue>>>11),Ue=ke+($e^(We|~_t))+ht[4]+4149444226&4294967295,ke=We+(Ue<<6&4294967295|Ue>>>26),Ue=_t+(We^(ke|~$e))+ht[11]+3174756917&4294967295,_t=ke+(Ue<<10&4294967295|Ue>>>22),Ue=$e+(ke^(_t|~We))+ht[2]+718787259&4294967295,$e=_t+(Ue<<15&4294967295|Ue>>>17),Ue=We+(_t^($e|~ke))+ht[9]+3951481745&4294967295,Ve.g[0]=Ve.g[0]+ke&4294967295,Ve.g[1]=Ve.g[1]+($e+(Ue<<21&4294967295|Ue>>>11))&4294967295,Ve.g[2]=Ve.g[2]+$e&4294967295,Ve.g[3]=Ve.g[3]+_t&4294967295}m.prototype.v=function(Ve,ke){ke===void 0&&(ke=Ve.length);const We=ke-this.blockSize,ht=this.C;let $e=this.h,_t=0;for(;_t<ke;){if($e==0)for(;_t<=We;)w(this,Ve,_t),_t+=this.blockSize;if(typeof Ve=="string"){for(;_t<ke;)if(ht[$e++]=Ve.charCodeAt(_t++),$e==this.blockSize){w(this,ht),$e=0;break}}else for(;_t<ke;)if(ht[$e++]=Ve[_t++],$e==this.blockSize){w(this,ht),$e=0;break}}this.h=$e,this.o+=ke},m.prototype.A=function(){var Ve=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);Ve[0]=128;for(var ke=1;ke<Ve.length-8;++ke)Ve[ke]=0;ke=this.o*8;for(var We=Ve.length-8;We<Ve.length;++We)Ve[We]=ke&255,ke/=256;for(this.v(Ve),Ve=Array(16),ke=0,We=0;We<4;++We)for(let ht=0;ht<32;ht+=8)Ve[ke++]=this.g[We]>>>ht&255;return Ve};function C(Ve,ke){var We=s;return Object.prototype.hasOwnProperty.call(We,Ve)?We[Ve]:We[Ve]=ke(Ve)}function D(Ve,ke){this.h=ke;const We=[];let ht=!0;for(let $e=Ve.length-1;$e>=0;$e--){const _t=Ve[$e]|0;ht&&_t==ke||(We[$e]=_t,ht=!1)}this.g=We}var s={};function G(Ve){return-128<=Ve&&Ve<128?C(Ve,function(ke){return new D([ke|0],ke<0?-1:0)}):new D([Ve|0],Ve<0?-1:0)}function q(Ve){if(isNaN(Ve)||!isFinite(Ve))return ce;if(Ve<0)return Qe(q(-Ve));const ke=[];let We=1;for(let ht=0;Ve>=We;ht++)ke[ht]=Ve/We|0,We*=4294967296;return new D(ke,0)}function te(Ve,ke){if(Ve.length==0)throw Error("number format error: empty string");if(ke=ke||10,ke<2||36<ke)throw Error("radix out of range: "+ke);if(Ve.charAt(0)=="-")return Qe(te(Ve.substring(1),ke));if(Ve.indexOf("-")>=0)throw Error('number format error: interior "-" character');const We=q(Math.pow(ke,8));let ht=ce;for(let _t=0;_t<Ve.length;_t+=8){var $e=Math.min(8,Ve.length-_t);const Ue=parseInt(Ve.substring(_t,_t+$e),ke);$e<8?($e=q(Math.pow(ke,$e)),ht=ht.j($e).add(q(Ue))):(ht=ht.j(We),ht=ht.add(q(Ue)))}return ht}var ce=G(0),we=G(1),ze=G(16777216);u=D.prototype,u.m=function(){if(Ge(this))return-Qe(this).m();let Ve=0,ke=1;for(let We=0;We<this.g.length;We++){const ht=this.i(We);Ve+=(ht>=0?ht:4294967296+ht)*ke,ke*=4294967296}return Ve},u.toString=function(Ve){if(Ve=Ve||10,Ve<2||36<Ve)throw Error("radix out of range: "+Ve);if(at(this))return"0";if(Ge(this))return"-"+Qe(this).toString(Ve);const ke=q(Math.pow(Ve,6));var We=this;let ht="";for(;;){const $e=wi(We,ke).g;We=xt(We,$e.j(ke));let _t=((We.g.length>0?We.g[0]:We.h)>>>0).toString(Ve);if(We=$e,at(We))return _t+ht;for(;_t.length<6;)_t="0"+_t;ht=_t+ht}},u.i=function(Ve){return Ve<0?0:Ve<this.g.length?this.g[Ve]:this.h};function at(Ve){if(Ve.h!=0)return!1;for(let ke=0;ke<Ve.g.length;ke++)if(Ve.g[ke]!=0)return!1;return!0}function Ge(Ve){return Ve.h==-1}u.l=function(Ve){return Ve=xt(this,Ve),Ge(Ve)?-1:at(Ve)?0:1};function Qe(Ve){const ke=Ve.g.length,We=[];for(let ht=0;ht<ke;ht++)We[ht]=~Ve.g[ht];return new D(We,~Ve.h).add(we)}u.abs=function(){return Ge(this)?Qe(this):this},u.add=function(Ve){const ke=Math.max(this.g.length,Ve.g.length),We=[];let ht=0;for(let $e=0;$e<=ke;$e++){let _t=ht+(this.i($e)&65535)+(Ve.i($e)&65535),Ue=(_t>>>16)+(this.i($e)>>>16)+(Ve.i($e)>>>16);ht=Ue>>>16,_t&=65535,Ue&=65535,We[$e]=Ue<<16|_t}return new D(We,We[We.length-1]&-2147483648?-1:0)};function xt(Ve,ke){return Ve.add(Qe(ke))}u.j=function(Ve){if(at(this)||at(Ve))return ce;if(Ge(this))return Ge(Ve)?Qe(this).j(Qe(Ve)):Qe(Qe(this).j(Ve));if(Ge(Ve))return Qe(this.j(Qe(Ve)));if(this.l(ze)<0&&Ve.l(ze)<0)return q(this.m()*Ve.m());const ke=this.g.length+Ve.g.length,We=[];for(var ht=0;ht<2*ke;ht++)We[ht]=0;for(ht=0;ht<this.g.length;ht++)for(let $e=0;$e<Ve.g.length;$e++){const _t=this.i(ht)>>>16,Ue=this.i(ht)&65535,Cn=Ve.i($e)>>>16,mn=Ve.i($e)&65535;We[2*ht+2*$e]+=Ue*mn,wt(We,2*ht+2*$e),We[2*ht+2*$e+1]+=_t*mn,wt(We,2*ht+2*$e+1),We[2*ht+2*$e+1]+=Ue*Cn,wt(We,2*ht+2*$e+1),We[2*ht+2*$e+2]+=_t*Cn,wt(We,2*ht+2*$e+2)}for(Ve=0;Ve<ke;Ve++)We[Ve]=We[2*Ve+1]<<16|We[2*Ve];for(Ve=ke;Ve<2*ke;Ve++)We[Ve]=0;return new D(We,0)};function wt(Ve,ke){for(;(Ve[ke]&65535)!=Ve[ke];)Ve[ke+1]+=Ve[ke]>>>16,Ve[ke]&=65535,ke++}function jt(Ve,ke){this.g=Ve,this.h=ke}function wi(Ve,ke){if(at(ke))throw Error("division by zero");if(at(Ve))return new jt(ce,ce);if(Ge(Ve))return ke=wi(Qe(Ve),ke),new jt(Qe(ke.g),Qe(ke.h));if(Ge(ke))return ke=wi(Ve,Qe(ke)),new jt(Qe(ke.g),ke.h);if(Ve.g.length>30){if(Ge(Ve)||Ge(ke))throw Error("slowDivide_ only works with positive integers.");for(var We=we,ht=ke;ht.l(Ve)<=0;)We=Ai(We),ht=Ai(ht);var $e=vi(We,1),_t=vi(ht,1);for(ht=vi(ht,2),We=vi(We,2);!at(ht);){var Ue=_t.add(ht);Ue.l(Ve)<=0&&($e=$e.add(We),_t=Ue),ht=vi(ht,1),We=vi(We,1)}return ke=xt(Ve,$e.j(ke)),new jt($e,ke)}for($e=ce;Ve.l(ke)>=0;){for(We=Math.max(1,Math.floor(Ve.m()/ke.m())),ht=Math.ceil(Math.log(We)/Math.LN2),ht=ht<=48?1:Math.pow(2,ht-48),_t=q(We),Ue=_t.j(ke);Ge(Ue)||Ue.l(Ve)>0;)We-=ht,_t=q(We),Ue=_t.j(ke);at(_t)&&(_t=we),$e=$e.add(_t),Ve=xt(Ve,Ue)}return new jt($e,Ve)}u.B=function(Ve){return wi(this,Ve).h},u.and=function(Ve){const ke=Math.max(this.g.length,Ve.g.length),We=[];for(let ht=0;ht<ke;ht++)We[ht]=this.i(ht)&Ve.i(ht);return new D(We,this.h&Ve.h)},u.or=function(Ve){const ke=Math.max(this.g.length,Ve.g.length),We=[];for(let ht=0;ht<ke;ht++)We[ht]=this.i(ht)|Ve.i(ht);return new D(We,this.h|Ve.h)},u.xor=function(Ve){const ke=Math.max(this.g.length,Ve.g.length),We=[];for(let ht=0;ht<ke;ht++)We[ht]=this.i(ht)^Ve.i(ht);return new D(We,this.h^Ve.h)};function Ai(Ve){const ke=Ve.g.length+1,We=[];for(let ht=0;ht<ke;ht++)We[ht]=Ve.i(ht)<<1|Ve.i(ht-1)>>>31;return new D(We,Ve.h)}function vi(Ve,ke){const We=ke>>5;ke%=32;const ht=Ve.g.length-We,$e=[];for(let _t=0;_t<ht;_t++)$e[_t]=ke>0?Ve.i(_t+We)>>>ke|Ve.i(_t+We+1)<<32-ke:Ve.i(_t+We);return new D($e,Ve.h)}m.prototype.digest=m.prototype.A,m.prototype.reset=m.prototype.u,m.prototype.update=m.prototype.v,zR=m,D.prototype.add=D.prototype.add,D.prototype.multiply=D.prototype.j,D.prototype.modulo=D.prototype.B,D.prototype.compare=D.prototype.l,D.prototype.toNumber=D.prototype.m,D.prototype.toString=D.prototype.toString,D.prototype.getBits=D.prototype.i,D.fromNumber=q,D.fromString=te,xm=D}).apply(typeof aI<"u"?aI:typeof self<"u"?self:typeof window<"u"?window:{});var H0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kR,$v,NR,sb,oT,FR,BR,VR;(function(){var u,n=Object.defineProperty;function l(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof H0=="object"&&H0];for(var ee=0;ee<z.length;++ee){var ae=z[ee];if(ae&&ae.Math==Math)return ae}throw Error("Cannot find global object")}var m=l(this);function w(z,ee){if(ee)e:{var ae=m;z=z.split(".");for(var Ce=0;Ce<z.length-1;Ce++){var pt=z[Ce];if(!(pt in ae))break e;ae=ae[pt]}z=z[z.length-1],Ce=ae[z],ee=ee(Ce),ee!=Ce&&ee!=null&&n(ae,z,{configurable:!0,writable:!0,value:ee})}}w("Symbol.dispose",function(z){return z||Symbol("Symbol.dispose")}),w("Array.prototype.values",function(z){return z||function(){return this[Symbol.iterator]()}}),w("Object.entries",function(z){return z||function(ee){var ae=[],Ce;for(Ce in ee)Object.prototype.hasOwnProperty.call(ee,Ce)&&ae.push([Ce,ee[Ce]]);return ae}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var C=C||{},D=this||self;function s(z){var ee=typeof z;return ee=="object"&&z!=null||ee=="function"}function G(z,ee,ae){return z.call.apply(z.bind,arguments)}function q(z,ee,ae){return q=G,q.apply(null,arguments)}function te(z,ee){var ae=Array.prototype.slice.call(arguments,1);return function(){var Ce=ae.slice();return Ce.push.apply(Ce,arguments),z.apply(this,Ce)}}function ce(z,ee){function ae(){}ae.prototype=ee.prototype,z.Z=ee.prototype,z.prototype=new ae,z.prototype.constructor=z,z.Ob=function(Ce,pt,Gt){for(var Ri=Array(arguments.length-2),Un=2;Un<arguments.length;Un++)Ri[Un-2]=arguments[Un];return ee.prototype[pt].apply(Ce,Ri)}}var we=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?z=>z&&AsyncContext.Snapshot.wrap(z):z=>z;function ze(z){const ee=z.length;if(ee>0){const ae=Array(ee);for(let Ce=0;Ce<ee;Ce++)ae[Ce]=z[Ce];return ae}return[]}function at(z,ee){for(let Ce=1;Ce<arguments.length;Ce++){const pt=arguments[Ce];var ae=typeof pt;if(ae=ae!="object"?ae:pt?Array.isArray(pt)?"array":ae:"null",ae=="array"||ae=="object"&&typeof pt.length=="number"){ae=z.length||0;const Gt=pt.length||0;z.length=ae+Gt;for(let Ri=0;Ri<Gt;Ri++)z[ae+Ri]=pt[Ri]}else z.push(pt)}}class Ge{constructor(ee,ae){this.i=ee,this.j=ae,this.h=0,this.g=null}get(){let ee;return this.h>0?(this.h--,ee=this.g,this.g=ee.next,ee.next=null):ee=this.i(),ee}}function Qe(z){D.setTimeout(()=>{throw z},0)}function xt(){var z=Ve;let ee=null;return z.g&&(ee=z.g,z.g=z.g.next,z.g||(z.h=null),ee.next=null),ee}class wt{constructor(){this.h=this.g=null}add(ee,ae){const Ce=jt.get();Ce.set(ee,ae),this.h?this.h.next=Ce:this.g=Ce,this.h=Ce}}var jt=new Ge(()=>new wi,z=>z.reset());class wi{constructor(){this.next=this.g=this.h=null}set(ee,ae){this.h=ee,this.g=ae,this.next=null}reset(){this.next=this.g=this.h=null}}let Ai,vi=!1,Ve=new wt,ke=()=>{const z=Promise.resolve(void 0);Ai=()=>{z.then(We)}};function We(){for(var z;z=xt();){try{z.h.call(z.g)}catch(ae){Qe(ae)}var ee=jt;ee.j(z),ee.h<100&&(ee.h++,z.next=ee.g,ee.g=z)}vi=!1}function ht(){this.u=this.u,this.C=this.C}ht.prototype.u=!1,ht.prototype.dispose=function(){this.u||(this.u=!0,this.N())},ht.prototype[Symbol.dispose]=function(){this.dispose()},ht.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $e(z,ee){this.type=z,this.g=this.target=ee,this.defaultPrevented=!1}$e.prototype.h=function(){this.defaultPrevented=!0};var _t=(function(){if(!D.addEventListener||!Object.defineProperty)return!1;var z=!1,ee=Object.defineProperty({},"passive",{get:function(){z=!0}});try{const ae=()=>{};D.addEventListener("test",ae,ee),D.removeEventListener("test",ae,ee)}catch{}return z})();function Ue(z){return/^[\s\xa0]*$/.test(z)}function Cn(z,ee){$e.call(this,z?z.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,z&&this.init(z,ee)}ce(Cn,$e),Cn.prototype.init=function(z,ee){const ae=this.type=z.type,Ce=z.changedTouches&&z.changedTouches.length?z.changedTouches[0]:null;this.target=z.target||z.srcElement,this.g=ee,ee=z.relatedTarget,ee||(ae=="mouseover"?ee=z.fromElement:ae=="mouseout"&&(ee=z.toElement)),this.relatedTarget=ee,Ce?(this.clientX=Ce.clientX!==void 0?Ce.clientX:Ce.pageX,this.clientY=Ce.clientY!==void 0?Ce.clientY:Ce.pageY,this.screenX=Ce.screenX||0,this.screenY=Ce.screenY||0):(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0),this.button=z.button,this.key=z.key||"",this.ctrlKey=z.ctrlKey,this.altKey=z.altKey,this.shiftKey=z.shiftKey,this.metaKey=z.metaKey,this.pointerId=z.pointerId||0,this.pointerType=z.pointerType,this.state=z.state,this.i=z,z.defaultPrevented&&Cn.Z.h.call(this)},Cn.prototype.h=function(){Cn.Z.h.call(this);const z=this.i;z.preventDefault?z.preventDefault():z.returnValue=!1};var mn="closure_listenable_"+(Math.random()*1e6|0),Pt=0;function Si(z,ee,ae,Ce,pt){this.listener=z,this.proxy=null,this.src=ee,this.type=ae,this.capture=!!Ce,this.ha=pt,this.key=++Pt,this.da=this.fa=!1}function fn(z){z.da=!0,z.listener=null,z.proxy=null,z.src=null,z.ha=null}function jn(z,ee,ae){for(const Ce in z)ee.call(ae,z[Ce],Ce,z)}function Wn(z,ee){for(const ae in z)ee.call(void 0,z[ae],ae,z)}function et(z){const ee={};for(const ae in z)ee[ae]=z[ae];return ee}const Kt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Oi(z,ee){let ae,Ce;for(let pt=1;pt<arguments.length;pt++){Ce=arguments[pt];for(ae in Ce)z[ae]=Ce[ae];for(let Gt=0;Gt<Kt.length;Gt++)ae=Kt[Gt],Object.prototype.hasOwnProperty.call(Ce,ae)&&(z[ae]=Ce[ae])}}function Hi(z){this.src=z,this.g={},this.h=0}Hi.prototype.add=function(z,ee,ae,Ce,pt){const Gt=z.toString();z=this.g[Gt],z||(z=this.g[Gt]=[],this.h++);const Ri=Qt(z,ee,Ce,pt);return Ri>-1?(ee=z[Ri],ae||(ee.fa=!1)):(ee=new Si(ee,this.src,Gt,!!Ce,pt),ee.fa=ae,z.push(ee)),ee};function bn(z,ee){const ae=ee.type;if(ae in z.g){var Ce=z.g[ae],pt=Array.prototype.indexOf.call(Ce,ee,void 0),Gt;(Gt=pt>=0)&&Array.prototype.splice.call(Ce,pt,1),Gt&&(fn(ee),z.g[ae].length==0&&(delete z.g[ae],z.h--))}}function Qt(z,ee,ae,Ce){for(let pt=0;pt<z.length;++pt){const Gt=z[pt];if(!Gt.da&&Gt.listener==ee&&Gt.capture==!!ae&&Gt.ha==Ce)return pt}return-1}var Li="closure_lm_"+(Math.random()*1e6|0),cn={};function Nn(z,ee,ae,Ce,pt){if(Array.isArray(ee)){for(let Gt=0;Gt<ee.length;Gt++)Nn(z,ee[Gt],ae,Ce,pt);return null}return ae=Uc(ae),z&&z[mn]?z.J(ee,ae,s(Ce)?!!Ce.capture:!1,pt):ur(z,ee,ae,!1,Ce,pt)}function ur(z,ee,ae,Ce,pt,Gt){if(!ee)throw Error("Invalid event type");const Ri=s(pt)?!!pt.capture:!!pt;let Un=Il(z);if(Un||(z[Li]=Un=new Hi(z)),ae=Un.add(ee,ae,Ce,Ri,Gt),ae.proxy)return ae;if(Ce=Qo(),ae.proxy=Ce,Ce.src=z,Ce.listener=ae,z.addEventListener)_t||(pt=Ri),pt===void 0&&(pt=!1),z.addEventListener(ee.toString(),Ce,pt);else if(z.attachEvent)z.attachEvent(ys(ee.toString()),Ce);else if(z.addListener&&z.removeListener)z.addListener(Ce);else throw Error("addEventListener and attachEvent are unavailable.");return ae}function Qo(){function z(ae){return ee.call(z.src,z.listener,ae)}const ee=Dr;return z}function Jo(z,ee,ae,Ce,pt){if(Array.isArray(ee))for(var Gt=0;Gt<ee.length;Gt++)Jo(z,ee[Gt],ae,Ce,pt);else Ce=s(Ce)?!!Ce.capture:!!Ce,ae=Uc(ae),z&&z[mn]?(z=z.i,Gt=String(ee).toString(),Gt in z.g&&(ee=z.g[Gt],ae=Qt(ee,ae,Ce,pt),ae>-1&&(fn(ee[ae]),Array.prototype.splice.call(ee,ae,1),ee.length==0&&(delete z.g[Gt],z.h--)))):z&&(z=Il(z))&&(ee=z.g[ee.toString()],z=-1,ee&&(z=Qt(ee,ae,Ce,pt)),(ae=z>-1?ee[z]:null)&&Ya(ae))}function Ya(z){if(typeof z!="number"&&z&&!z.da){var ee=z.src;if(ee&&ee[mn])bn(ee.i,z);else{var ae=z.type,Ce=z.proxy;ee.removeEventListener?ee.removeEventListener(ae,Ce,z.capture):ee.detachEvent?ee.detachEvent(ys(ae),Ce):ee.addListener&&ee.removeListener&&ee.removeListener(Ce),(ae=Il(ee))?(bn(ae,z),ae.h==0&&(ae.src=null,ee[Li]=null)):fn(z)}}}function ys(z){return z in cn?cn[z]:cn[z]="on"+z}function Dr(z,ee){if(z.da)z=!0;else{ee=new Cn(ee,this);const ae=z.listener,Ce=z.ha||z.src;z.fa&&Ya(z),z=ae.call(Ce,ee)}return z}function Il(z){return z=z[Li],z instanceof Hi?z:null}var Ka="__closure_events_fn_"+(Math.random()*1e9>>>0);function Uc(z){return typeof z=="function"?z:(z[Ka]||(z[Ka]=function(ee){return z.handleEvent(ee)}),z[Ka])}function Tr(){ht.call(this),this.i=new Hi(this),this.M=this,this.G=null}ce(Tr,ht),Tr.prototype[mn]=!0,Tr.prototype.removeEventListener=function(z,ee,ae,Ce){Jo(this,z,ee,ae,Ce)};function ls(z,ee){var ae,Ce=z.G;if(Ce)for(ae=[];Ce;Ce=Ce.G)ae.push(Ce);if(z=z.M,Ce=ee.type||ee,typeof ee=="string")ee=new $e(ee,z);else if(ee instanceof $e)ee.target=ee.target||z;else{var pt=ee;ee=new $e(Ce,z),Oi(ee,pt)}pt=!0;let Gt,Ri;if(ae)for(Ri=ae.length-1;Ri>=0;Ri--)Gt=ee.g=ae[Ri],pt=Fs(Gt,Ce,!0,ee)&&pt;if(Gt=ee.g=z,pt=Fs(Gt,Ce,!0,ee)&&pt,pt=Fs(Gt,Ce,!1,ee)&&pt,ae)for(Ri=0;Ri<ae.length;Ri++)Gt=ee.g=ae[Ri],pt=Fs(Gt,Ce,!1,ee)&&pt}Tr.prototype.N=function(){if(Tr.Z.N.call(this),this.i){var z=this.i;for(const ee in z.g){const ae=z.g[ee];for(let Ce=0;Ce<ae.length;Ce++)fn(ae[Ce]);delete z.g[ee],z.h--}}this.G=null},Tr.prototype.J=function(z,ee,ae,Ce){return this.i.add(String(z),ee,!1,ae,Ce)},Tr.prototype.K=function(z,ee,ae,Ce){return this.i.add(String(z),ee,!0,ae,Ce)};function Fs(z,ee,ae,Ce){if(ee=z.i.g[String(ee)],!ee)return!0;ee=ee.concat();let pt=!0;for(let Gt=0;Gt<ee.length;++Gt){const Ri=ee[Gt];if(Ri&&!Ri.da&&Ri.capture==ae){const Un=Ri.listener,fs=Ri.ha||Ri.src;Ri.fa&&bn(z.i,Ri),pt=Un.call(fs,Ce)!==!1&&pt}}return pt&&!Ce.defaultPrevented}function Cl(z,ee){if(typeof z!="function")if(z&&typeof z.handleEvent=="function")z=q(z.handleEvent,z);else throw Error("Invalid listener argument");return Number(ee)>2147483647?-1:D.setTimeout(z,ee||0)}function Qa(z){z.g=Cl(()=>{z.g=null,z.i&&(z.i=!1,Qa(z))},z.l);const ee=z.h;z.h=null,z.m.apply(null,ee)}class Bs extends ht{constructor(ee,ae){super(),this.m=ee,this.l=ae,this.h=null,this.i=!1,this.g=null}j(ee){this.h=arguments,this.g?this.i=!0:Qa(this)}N(){super.N(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ra(z){ht.call(this),this.h=z,this.g={}}ce(Ra,ht);var no=[];function xo(z){jn(z.g,function(ee,ae){this.g.hasOwnProperty(ae)&&Ya(ee)},z),z.g={}}Ra.prototype.N=function(){Ra.Z.N.call(this),xo(this)},Ra.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ja=D.JSON.stringify,Rl=D.JSON.parse,jc=class{stringify(z){return D.JSON.stringify(z,void 0)}parse(z){return D.JSON.parse(z,void 0)}};function Ms(){}function ga(){}var ea={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function vs(){$e.call(this,"d")}ce(vs,$e);function Vs(){$e.call(this,"c")}ce(Vs,$e);var Yr={},ac=null;function hr(){return ac=ac||new Tr}Yr.Ia="serverreachability";function Ts(z){$e.call(this,Yr.Ia,z)}ce(Ts,$e);function _a(z){const ee=hr();ls(ee,new Ts(ee))}Yr.STAT_EVENT="statevent";function Ma(z,ee){$e.call(this,Yr.STAT_EVENT,z),this.stat=ee}ce(Ma,$e);function Hr(z){const ee=hr();ls(ee,new Ma(ee,z))}Yr.Ja="timingevent";function ya(z,ee){$e.call(this,Yr.Ja,z),this.size=ee}ce(ya,$e);function va(z,ee){if(typeof z!="function")throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){z()},ee)}function xa(){this.g=!0}xa.prototype.ua=function(){this.g=!1};function Ct(z,ee,ae,Ce,pt,Gt){z.info(function(){if(z.g)if(Gt){var Ri="",Un=Gt.split("&");for(let yr=0;yr<Un.length;yr++){var fs=Un[yr].split("=");if(fs.length>1){const Br=fs[0];fs=fs[1];const oa=Br.split("_");Ri=oa.length>=2&&oa[1]=="type"?Ri+(Br+"="+fs+"&"):Ri+(Br+"=redacted&")}}}else Ri=null;else Ri=Gt;return"XMLHTTP REQ ("+Ce+") [attempt "+pt+"]: "+ee+`
`+ae+`
`+Ri})}function el(z,ee,ae,Ce,pt,Gt,Ri){z.info(function(){return"XMLHTTP RESP ("+Ce+") [ attempt "+pt+"]: "+ee+`
`+ae+`
`+Gt+" "+Ri})}function tl(z,ee,ae,Ce){z.info(function(){return"XMLHTTP TEXT ("+ee+"): "+Fe(z,ae)+(Ce?" "+Ce:"")})}function il(z,ee){z.info(function(){return"TIMEOUT: "+ee})}xa.prototype.info=function(){};function Fe(z,ee){if(!z.g)return ee;if(!ee)return null;try{const Gt=JSON.parse(ee);if(Gt){for(z=0;z<Gt.length;z++)if(Array.isArray(Gt[z])){var ae=Gt[z];if(!(ae.length<2)){var Ce=ae[1];if(Array.isArray(Ce)&&!(Ce.length<1)){var pt=Ce[0];if(pt!="noop"&&pt!="stop"&&pt!="close")for(let Ri=1;Ri<Ce.length;Ri++)Ce[Ri]=""}}}}return Ja(Gt)}catch{return ee}}var J={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},se={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},me;function Re(){}ce(Re,Ms),Re.prototype.g=function(){return new XMLHttpRequest},me=new Re;function Ae(z){return encodeURIComponent(String(z))}function Ie(z){var ee=1;z=z.split(":");const ae=[];for(;ee>0&&z.length;)ae.push(z.shift()),ee--;return z.length&&ae.push(z.join(":")),ae}function Ye(z,ee,ae,Ce){this.j=z,this.i=ee,this.l=ae,this.S=Ce||1,this.V=new Ra(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Le}function Le(){this.i=null,this.g="",this.h=!1}var Xe={},At={};function gt(z,ee,ae){z.M=1,z.A=Ml(ds(ee)),z.u=ae,z.R=!0,di(z,null)}function di(z,ee){z.F=Date.now(),Wi(z),z.B=ds(z.A);var ae=z.B,Ce=z.S;Array.isArray(Ce)||(Ce=[String(Ce)]),cc(ae.i,"t",Ce),z.C=0,ae=z.j.L,z.h=new Le,z.g=Da(z.j,ae?ee:null,!z.u),z.P>0&&(z.O=new Bs(q(z.Y,z,z.g),z.P)),ee=z.V,ae=z.g,Ce=z.ba;var pt="readystatechange";Array.isArray(pt)||(pt&&(no[0]=pt.toString()),pt=no);for(let Gt=0;Gt<pt.length;Gt++){const Ri=Nn(ae,pt[Gt],Ce||ee.handleEvent,!1,ee.h||ee);if(!Ri)break;ee.g[Ri.key]=Ri}ee=z.J?et(z.J):{},z.u?(z.v||(z.v="POST"),ee["Content-Type"]="application/x-www-form-urlencoded",z.g.ea(z.B,z.v,z.u,ee)):(z.v="GET",z.g.ea(z.B,z.v,null,ee)),_a(),Ct(z.i,z.v,z.B,z.l,z.S,z.u)}Ye.prototype.ba=function(z){z=z.target;const ee=this.O;ee&&Eo(z)==3?ee.j():this.Y(z)},Ye.prototype.Y=function(z){try{if(z==this.g)e:{const Un=Eo(this.g),fs=this.g.ya(),yr=this.g.ca();if(!(Un<3)&&(Un!=3||this.g&&(this.h.h||this.g.la()||ho(this.g)))){this.K||Un!=4||fs==7||(fs==8||yr<=0?_a(3):_a(2)),Ln(this);var ee=this.g.ca();this.X=ee;var ae=Mi(this);if(this.o=ee==200,el(this.i,this.v,this.B,this.l,this.S,Un,ee),this.o){if(this.U&&!this.L){t:{if(this.g){var Ce,pt=this.g;if((Ce=pt.g?pt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ue(Ce)){var Gt=Ce;break t}}Gt=null}if(z=Gt)tl(this.i,this.l,z,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Cr(this,z);else{this.o=!1,this.m=3,Hr(12),Zn(this),Ki(this);break e}}if(this.R){z=!0;let Br;for(;!this.K&&this.C<ae.length;)if(Br=un(this,ae),Br==At){Un==4&&(this.m=4,Hr(14),z=!1),tl(this.i,this.l,null,"[Incomplete Response]");break}else if(Br==Xe){this.m=4,Hr(15),tl(this.i,this.l,ae,"[Invalid Chunk]"),z=!1;break}else tl(this.i,this.l,Br,null),Cr(this,Br);if(Bi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Un!=4||ae.length!=0||this.h.h||(this.m=1,Hr(16),z=!1),this.o=this.o&&z,!z)tl(this.i,this.l,ae,"[Invalid Chunked Response]"),Zn(this),Ki(this);else if(ae.length>0&&!this.W){this.W=!0;var Ri=this.j;Ri.g==this&&Ri.aa&&!Ri.P&&(Ri.j.info("Great, no buffering proxy detected. Bytes received: "+ae.length),ah(Ri),Ri.P=!0,Hr(11))}}else tl(this.i,this.l,ae,null),Cr(this,ae);Un==4&&Zn(this),this.o&&!this.K&&(Un==4?Ii(this.j,this):(this.o=!1,Wi(this)))}else kl(this.g),ee==400&&ae.indexOf("Unknown SID")>0?(this.m=3,Hr(12)):(this.m=0,Hr(13)),Zn(this),Ki(this)}}}catch{}finally{}};function Mi(z){if(!Bi(z))return z.g.la();const ee=ho(z.g);if(ee==="")return"";let ae="";const Ce=ee.length,pt=Eo(z.g)==4;if(!z.h.i){if(typeof TextDecoder>"u")return Zn(z),Ki(z),"";z.h.i=new D.TextDecoder}for(let Gt=0;Gt<Ce;Gt++)z.h.h=!0,ae+=z.h.i.decode(ee[Gt],{stream:!(pt&&Gt==Ce-1)});return ee.length=0,z.h.g+=ae,z.C=0,z.h.g}function Bi(z){return z.g?z.v=="GET"&&z.M!=2&&z.j.Aa:!1}function un(z,ee){var ae=z.C,Ce=ee.indexOf(`
`,ae);return Ce==-1?At:(ae=Number(ee.substring(ae,Ce)),isNaN(ae)?Xe:(Ce+=1,Ce+ae>ee.length?At:(ee=ee.slice(Ce,Ce+ae),z.C=Ce+ae,ee)))}Ye.prototype.cancel=function(){this.K=!0,Zn(this)};function Wi(z){z.T=Date.now()+z.H,hn(z,z.H)}function hn(z,ee){if(z.D!=null)throw Error("WatchDog timer not null");z.D=va(q(z.aa,z),ee)}function Ln(z){z.D&&(D.clearTimeout(z.D),z.D=null)}Ye.prototype.aa=function(){this.D=null;const z=Date.now();z-this.T>=0?(il(this.i,this.B),this.M!=2&&(_a(),Hr(17)),Zn(this),this.m=2,Ki(this)):hn(this,this.T-z)};function Ki(z){z.j.I==0||z.K||Ii(z.j,z)}function Zn(z){Ln(z);var ee=z.O;ee&&typeof ee.dispose=="function"&&ee.dispose(),z.O=null,xo(z.V),z.g&&(ee=z.g,z.g=null,ee.abort(),ee.dispose())}function Cr(z,ee){try{var ae=z.j;if(ae.I!=0&&(ae.g==z||sr(ae.h,z))){if(!z.L&&sr(ae.h,z)&&ae.I==3){try{var Ce=ae.Ba.g.parse(ee)}catch{Ce=null}if(Array.isArray(Ce)&&Ce.length==3){var pt=Ce;if(pt[0]==0){e:if(!ae.v){if(ae.g)if(ae.g.F+3e3<z.F)Wc(ae),ol(ae);else break e;In(ae),Hr(18)}}else ae.xa=pt[1],0<ae.xa-ae.K&&pt[2]<37500&&ae.F&&ae.A==0&&!ae.C&&(ae.C=va(q(ae.Va,ae),6e3));rr(ae.h)<=1&&ae.ta&&(ae.ta=void 0)}else Ds(ae,11)}else if((z.L||ae.g==z)&&Wc(ae),!Ue(ee))for(pt=ae.Ba.g.parse(ee),ee=0;ee<pt.length;ee++){let yr=pt[ee];const Br=yr[0];if(!(Br<=ae.K))if(ae.K=Br,yr=yr[1],ae.I==2)if(yr[0]=="c"){ae.M=yr[1],ae.ba=yr[2];const oa=yr[3];oa!=null&&(ae.ka=oa,ae.j.info("VER="+ae.ka));const ps=yr[4];ps!=null&&(ae.za=ps,ae.j.info("SVER="+ae.za));const Us=yr[5];Us!=null&&typeof Us=="number"&&Us>0&&(Ce=1.5*Us,ae.O=Ce,ae.j.info("backChannelRequestTimeoutMs_="+Ce)),Ce=ae;const ms=z.g;if(ms){const Su=ms.g?ms.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Su){var Gt=Ce.h;Gt.g||Su.indexOf("spdy")==-1&&Su.indexOf("quic")==-1&&Su.indexOf("h2")==-1||(Gt.j=Gt.l,Gt.g=new Set,Gt.h&&(Jn(Gt,Gt.h),Gt.h=null))}if(Ce.G){const Fl=ms.g?ms.g.getResponseHeader("X-HTTP-Session-Id"):null;Fl&&(Ce.wa=Fl,Rr(Ce.J,Ce.G,Fl))}}ae.I=3,ae.l&&ae.l.ra(),ae.aa&&(ae.T=Date.now()-z.F,ae.j.info("Handshake RTT: "+ae.T+"ms")),Ce=ae;var Ri=z;if(Ce.na=lh(Ce,Ce.L?Ce.ba:null,Ce.W),Ri.L){Es(Ce.h,Ri);var Un=Ri,fs=Ce.O;fs&&(Un.H=fs),Un.D&&(Ln(Un),Wi(Un)),Ce.g=Ri}else nd(Ce);ae.i.length>0&&Ps(ae)}else yr[0]!="stop"&&yr[0]!="close"||Ds(ae,7);else ae.I==3&&(yr[0]=="stop"||yr[0]=="close"?yr[0]=="stop"?Ds(ae,7):sa(ae):yr[0]!="noop"&&ae.l&&ae.l.qa(yr),ae.A=0)}}_a(4)}catch{}}var Gn=class{constructor(z,ee){this.g=z,this.map=ee}};function Vn(z){this.l=z||10,D.PerformanceNavigationTiming?(z=D.performance.getEntriesByType("navigation"),z=z.length>0&&(z[0].nextHopProtocol=="hq"||z[0].nextHopProtocol=="h2")):z=!!(D.chrome&&D.chrome.loadTimes&&D.chrome.loadTimes()&&D.chrome.loadTimes().wasFetchedViaSpdy),this.j=z?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Rn(z){return z.h?!0:z.g?z.g.size>=z.j:!1}function rr(z){return z.h?1:z.g?z.g.size:0}function sr(z,ee){return z.h?z.h==ee:z.g?z.g.has(ee):!1}function Jn(z,ee){z.g?z.g.add(ee):z.h=ee}function Es(z,ee){z.h&&z.h==ee?z.h=null:z.g&&z.g.has(ee)&&z.g.delete(ee)}Vn.prototype.cancel=function(){if(this.i=Ys(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const z of this.g.values())z.cancel();this.g.clear()}};function Ys(z){if(z.h!=null)return z.i.concat(z.h.G);if(z.g!=null&&z.g.size!==0){let ee=z.i;for(const ae of z.g.values())ee=ee.concat(ae.G);return ee}return ze(z.i)}var zo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ba(z,ee){if(z){z=z.split("&");for(let ae=0;ae<z.length;ae++){const Ce=z[ae].indexOf("=");let pt,Gt=null;Ce>=0?(pt=z[ae].substring(0,Ce),Gt=z[ae].substring(Ce+1)):pt=z[ae],ee(pt,Gt?decodeURIComponent(Gt.replace(/\+/g," ")):"")}}}function Kr(z){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let ee;z instanceof Kr?(this.l=z.l,ro(this,z.j),this.o=z.o,this.g=z.g,ta(this,z.u),this.h=z.h,lc(this,Ol(z.i)),this.m=z.m):z&&(ee=String(z).match(zo))?(this.l=!1,ro(this,ee[1]||"",!0),this.o=bo(ee[2]||""),this.g=bo(ee[3]||"",!0),ta(this,ee[4]),this.h=bo(ee[5]||"",!0),lc(this,ee[6]||"",!0),this.m=bo(ee[7]||"")):(this.l=!1,this.i=new No(null,this.l))}Kr.prototype.toString=function(){const z=[];var ee=this.j;ee&&z.push(Pl(ee,ia,!0),":");var ae=this.g;return(ae||ee=="file")&&(z.push("//"),(ee=this.o)&&z.push(Pl(ee,ia,!0),"@"),z.push(Ae(ae).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ae=this.u,ae!=null&&z.push(":",String(ae))),(ae=this.h)&&(this.g&&ae.charAt(0)!="/"&&z.push("/"),z.push(Pl(ae,ae.charAt(0)=="/"?wu:id,!0))),(ae=this.i.toString())&&z.push("?",ae),(ae=this.m)&&z.push("#",Pl(ae,wa)),z.join("")},Kr.prototype.resolve=function(z){const ee=ds(this);let ae=!!z.j;ae?ro(ee,z.j):ae=!!z.o,ae?ee.o=z.o:ae=!!z.g,ae?ee.g=z.g:ae=z.u!=null;var Ce=z.h;if(ae)ta(ee,z.u);else if(ae=!!z.h){if(Ce.charAt(0)!="/")if(this.g&&!this.h)Ce="/"+Ce;else{var pt=ee.h.lastIndexOf("/");pt!=-1&&(Ce=ee.h.slice(0,pt+1)+Ce)}if(pt=Ce,pt==".."||pt==".")Ce="";else if(pt.indexOf("./")!=-1||pt.indexOf("/.")!=-1){Ce=pt.lastIndexOf("/",0)==0,pt=pt.split("/");const Gt=[];for(let Ri=0;Ri<pt.length;){const Un=pt[Ri++];Un=="."?Ce&&Ri==pt.length&&Gt.push(""):Un==".."?((Gt.length>1||Gt.length==1&&Gt[0]!="")&&Gt.pop(),Ce&&Ri==pt.length&&Gt.push("")):(Gt.push(Un),Ce=!0)}Ce=Gt.join("/")}else Ce=pt}return ae?ee.h=Ce:ae=z.i.toString()!=="",ae?lc(ee,Ol(z.i)):ae=!!z.m,ae&&(ee.m=z.m),ee};function ds(z){return new Kr(z)}function ro(z,ee,ae){z.j=ae?bo(ee,!0):ee,z.j&&(z.j=z.j.replace(/:$/,""))}function ta(z,ee){if(ee){if(ee=Number(ee),isNaN(ee)||ee<0)throw Error("Bad port number "+ee);z.u=ee}else z.u=null}function lc(z,ee,ae){ee instanceof No?(z.i=ee,uc(z.i,z.l)):(ae||(ee=Pl(ee,Ks)),z.i=new No(ee,z.l))}function Rr(z,ee,ae){z.i.set(ee,ae)}function Ml(z){return Rr(z,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),z}function bo(z,ee){return z?ee?decodeURI(z.replace(/%25/g,"%2525")):decodeURIComponent(z):""}function Pl(z,ee,ae){return typeof z=="string"?(z=encodeURI(z).replace(ee,ko),ae&&(z=z.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),z):null}function ko(z){return z=z.charCodeAt(0),"%"+(z>>4&15).toString(16)+(z&15).toString(16)}var ia=/[#\/\?@]/g,id=/[#\?:]/g,wu=/[#\?]/g,Ks=/[#\?@]/g,wa=/#/g;function No(z,ee){this.h=this.g=null,this.i=z||null,this.j=!!ee}function xs(z){z.g||(z.g=new Map,z.h=0,z.i&&ba(z.i,function(ee,ae){z.add(decodeURIComponent(ee.replace(/\+/g," ")),ae)}))}u=No.prototype,u.add=function(z,ee){xs(this),this.i=null,z=nl(this,z);let ae=this.g.get(z);return ae||this.g.set(z,ae=[]),ae.push(ee),this.h+=1,this};function so(z,ee){xs(z),ee=nl(z,ee),z.g.has(ee)&&(z.i=null,z.h-=z.g.get(ee).length,z.g.delete(ee))}function Dl(z,ee){return xs(z),ee=nl(z,ee),z.g.has(ee)}u.forEach=function(z,ee){xs(this),this.g.forEach(function(ae,Ce){ae.forEach(function(pt){z.call(ee,pt,Ce,this)},this)},this)};function sh(z,ee){xs(z);let ae=[];if(typeof ee=="string")Dl(z,ee)&&(ae=ae.concat(z.g.get(nl(z,ee))));else for(z=Array.from(z.g.values()),ee=0;ee<z.length;ee++)ae=ae.concat(z[ee]);return ae}u.set=function(z,ee){return xs(this),this.i=null,z=nl(this,z),Dl(this,z)&&(this.h-=this.g.get(z).length),this.g.set(z,[ee]),this.h+=1,this},u.get=function(z,ee){return z?(z=sh(this,z),z.length>0?String(z[0]):ee):ee};function cc(z,ee,ae){so(z,ee),ae.length>0&&(z.i=null,z.g.set(nl(z,ee),ze(ae)),z.h+=ae.length)}u.toString=function(){if(this.i)return this.i;if(!this.g)return"";const z=[],ee=Array.from(this.g.keys());for(let Ce=0;Ce<ee.length;Ce++){var ae=ee[Ce];const pt=Ae(ae);ae=sh(this,ae);for(let Gt=0;Gt<ae.length;Gt++){let Ri=pt;ae[Gt]!==""&&(Ri+="="+Ae(ae[Gt])),z.push(Ri)}}return this.i=z.join("&")};function Ol(z){const ee=new No;return ee.i=z.i,z.g&&(ee.g=new Map(z.g),ee.h=z.h),ee}function nl(z,ee){return ee=String(ee),z.j&&(ee=ee.toLowerCase()),ee}function uc(z,ee){ee&&!z.j&&(xs(z),z.i=null,z.g.forEach(function(ae,Ce){const pt=Ce.toLowerCase();Ce!=pt&&(so(this,Ce),cc(this,pt,ae))},z)),z.j=ee}function Fo(z,ee){const ae=new xa;if(D.Image){const Ce=new Image;Ce.onload=te(Ta,ae,"TestLoadImage: loaded",!0,ee,Ce),Ce.onerror=te(Ta,ae,"TestLoadImage: error",!1,ee,Ce),Ce.onabort=te(Ta,ae,"TestLoadImage: abort",!1,ee,Ce),Ce.ontimeout=te(Ta,ae,"TestLoadImage: timeout",!1,ee,Ce),D.setTimeout(function(){Ce.ontimeout&&Ce.ontimeout()},1e4),Ce.src=z}else ee(!1)}function wo(z,ee){const ae=new xa,Ce=new AbortController,pt=setTimeout(()=>{Ce.abort(),Ta(ae,"TestPingServer: timeout",!1,ee)},1e4);fetch(z,{signal:Ce.signal}).then(Gt=>{clearTimeout(pt),Gt.ok?Ta(ae,"TestPingServer: ok",!0,ee):Ta(ae,"TestPingServer: server error",!1,ee)}).catch(()=>{clearTimeout(pt),Ta(ae,"TestPingServer: error",!1,ee)})}function Ta(z,ee,ae,Ce,pt){try{pt&&(pt.onload=null,pt.onerror=null,pt.onabort=null,pt.ontimeout=null),Ce(ae)}catch{}}function Ll(){this.g=new jc}function na(z){this.i=z.Sb||null,this.h=z.ab||!1}ce(na,Ms),na.prototype.g=function(){return new hc(this.i,this.h)};function hc(z,ee){Tr.call(this),this.H=z,this.o=ee,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}ce(hc,Tr),u=hc.prototype,u.open=function(z,ee){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=z,this.D=ee,this.readyState=1,on(this)},u.send=function(z){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const ee={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};z&&(ee.body=z),(this.H||D).fetch(new Request(this.D,ee)).then(this.Pa.bind(this),this.ga.bind(this))},u.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,zl(this)),this.readyState=0},u.Pa=function(z){if(this.g&&(this.l=z,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=z.headers,this.readyState=2,on(this)),this.g&&(this.readyState=3,on(this),this.g)))if(this.responseType==="arraybuffer")z.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof D.ReadableStream<"u"&&"body"in z){if(this.j=z.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tu(this)}else z.text().then(this.Oa.bind(this),this.ga.bind(this))};function Tu(z){z.j.read().then(z.Ma.bind(z)).catch(z.ga.bind(z))}u.Ma=function(z){if(this.g){if(this.o&&z.value)this.response.push(z.value);else if(!this.o){var ee=z.value?z.value:new Uint8Array(0);(ee=this.B.decode(ee,{stream:!z.done}))&&(this.response=this.responseText+=ee)}z.done?zl(this):on(this),this.readyState==3&&Tu(this)}},u.Oa=function(z){this.g&&(this.response=this.responseText=z,zl(this))},u.Na=function(z){this.g&&(this.response=z,zl(this))},u.ga=function(){this.g&&zl(this)};function zl(z){z.readyState=4,z.l=null,z.j=null,z.B=null,on(z)}u.setRequestHeader=function(z,ee){this.A.append(z,ee)},u.getResponseHeader=function(z){return this.h&&this.h.get(z.toLowerCase())||""},u.getAllResponseHeaders=function(){if(!this.h)return"";const z=[],ee=this.h.entries();for(var ae=ee.next();!ae.done;)ae=ae.value,z.push(ae[0]+": "+ae[1]),ae=ee.next();return z.join(`\r
`)};function on(z){z.onreadystatechange&&z.onreadystatechange.call(z)}Object.defineProperty(hc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(z){this.m=z?"include":"same-origin"}});function To(z){let ee="";return jn(z,function(ae,Ce){ee+=Ce,ee+=":",ee+=ae,ee+=`\r
`}),ee}function Eu(z,ee,ae){e:{for(Ce in ae){var Ce=!1;break e}Ce=!0}Ce||(ae=To(ae),typeof z=="string"?ae!=null&&Ae(ae):Rr(z,ee,ae))}function Qr(z){Tr.call(this),this.headers=new Map,this.L=z||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}ce(Qr,Tr);var Pa=/^https?$/i,rl=["POST","PUT"];u=Qr.prototype,u.Fa=function(z){this.H=z},u.ea=function(z,ee,ae,Ce){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+z);ee=ee?ee.toUpperCase():"GET",this.D=z,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():me.g(),this.g.onreadystatechange=we(q(this.Ca,this));try{this.B=!0,this.g.open(ee,String(z),!0),this.B=!1}catch(Gt){sl(this,Gt);return}if(z=ae||"",ae=new Map(this.headers),Ce)if(Object.getPrototypeOf(Ce)===Object.prototype)for(var pt in Ce)ae.set(pt,Ce[pt]);else if(typeof Ce.keys=="function"&&typeof Ce.get=="function")for(const Gt of Ce.keys())ae.set(Gt,Ce.get(Gt));else throw Error("Unknown input type for opt_headers: "+String(Ce));Ce=Array.from(ae.keys()).find(Gt=>Gt.toLowerCase()=="content-type"),pt=D.FormData&&z instanceof D.FormData,!(Array.prototype.indexOf.call(rl,ee,void 0)>=0)||Ce||pt||ae.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Gt,Ri]of ae)this.g.setRequestHeader(Gt,Ri);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(z),this.v=!1}catch(Gt){sl(this,Gt)}};function sl(z,ee){z.h=!1,z.g&&(z.j=!0,z.g.abort(),z.j=!1),z.l=ee,z.o=5,Gc(z),fc(z)}function Gc(z){z.A||(z.A=!0,ls(z,"complete"),ls(z,"error"))}u.abort=function(z){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=z||7,ls(this,"complete"),ls(this,"abort"),fc(this))},u.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fc(this,!0)),Qr.Z.N.call(this)},u.Ca=function(){this.u||(this.B||this.v||this.j?dc(this):this.Xa())},u.Xa=function(){dc(this)};function dc(z){if(z.h&&typeof C<"u"){if(z.v&&Eo(z)==4)setTimeout(z.Ca.bind(z),0);else if(ls(z,"readystatechange"),Eo(z)==4){z.h=!1;try{const Gt=z.ca();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ee=!0;break e;default:ee=!1}var ae;if(!(ae=ee)){var Ce;if(Ce=Gt===0){let Ri=String(z.D).match(zo)[1]||null;!Ri&&D.self&&D.self.location&&(Ri=D.self.location.protocol.slice(0,-1)),Ce=!Pa.test(Ri?Ri.toLowerCase():"")}ae=Ce}if(ae)ls(z,"complete"),ls(z,"success");else{z.o=6;try{var pt=Eo(z)>2?z.g.statusText:""}catch{pt=""}z.l=pt+" ["+z.ca()+"]",Gc(z)}}finally{fc(z)}}}}function fc(z,ee){if(z.g){z.m&&(clearTimeout(z.m),z.m=null);const ae=z.g;z.g=null,ee||ls(z,"ready");try{ae.onreadystatechange=null}catch{}}}u.isActive=function(){return!!this.g};function Eo(z){return z.g?z.g.readyState:0}u.ca=function(){try{return Eo(this)>2?this.g.status:-1}catch{return-1}},u.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},u.La=function(z){if(this.g){var ee=this.g.responseText;return z&&ee.indexOf(z)==0&&(ee=ee.substring(z.length)),Rl(ee)}};function ho(z){try{if(!z.g)return null;if("response"in z.g)return z.g.response;switch(z.F){case"":case"text":return z.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in z.g)return z.g.mozResponseArrayBuffer}return null}catch{return null}}function kl(z){const ee={};z=(z.g&&Eo(z)>=2&&z.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ce=0;Ce<z.length;Ce++){if(Ue(z[Ce]))continue;var ae=Ie(z[Ce]);const pt=ae[0];if(ae=ae[1],typeof ae!="string")continue;ae=ae.trim();const Gt=ee[pt]||[];ee[pt]=Gt,Gt.push(ae)}Wn(ee,function(Ce){return Ce.join(", ")})}u.ya=function(){return this.o},u.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ra(z,ee,ae){return ae&&ae.internalChannelParams&&ae.internalChannelParams[z]||ee}function Nl(z){this.za=0,this.i=[],this.j=new xa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ra("failFast",!1,z),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ra("baseRetryDelayMs",5e3,z),this.Za=ra("retryDelaySeedMs",1e4,z),this.Ta=ra("forwardChannelMaxRetries",2,z),this.va=ra("forwardChannelRequestTimeoutMs",2e4,z),this.ma=z&&z.xmlHttpFactory||void 0,this.Ua=z&&z.Rb||void 0,this.Aa=z&&z.useFetchStreams||!1,this.O=void 0,this.L=z&&z.supportsCrossDomainXhr||!1,this.M="",this.h=new Vn(z&&z.concurrentRequestLimit),this.Ba=new Ll,this.S=z&&z.fastHandshake||!1,this.R=z&&z.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=z&&z.Pb||!1,z&&z.ua&&this.j.ua(),z&&z.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&z&&z.detectBufferingProxy||!1,this.ia=void 0,z&&z.longPollingTimeout&&z.longPollingTimeout>0&&(this.ia=z.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}u=Nl.prototype,u.ka=8,u.I=1,u.connect=function(z,ee,ae,Ce){Hr(0),this.W=z,this.H=ee||{},ae&&Ce!==void 0&&(this.H.OSID=ae,this.H.OAID=Ce),this.F=this.X,this.J=lh(this,null,this.W),Ps(this)};function sa(z){if(qc(z),z.I==3){var ee=z.V++,ae=ds(z.J);if(Rr(ae,"SID",z.M),Rr(ae,"RID",ee),Rr(ae,"TYPE","terminate"),Hc(z,ae),ee=new Ye(z,z.j,ee),ee.M=2,ee.A=Ml(ds(ae)),ae=!1,D.navigator&&D.navigator.sendBeacon)try{ae=D.navigator.sendBeacon(ee.A.toString(),"")}catch{}!ae&&D.Image&&(new Image().src=ee.A,ae=!0),ae||(ee.g=Da(ee.j,null),ee.g.ea(ee.A)),ee.F=Date.now(),Wi(ee)}Ea(z)}function ol(z){z.g&&(ah(z),z.g.cancel(),z.g=null)}function qc(z){ol(z),z.v&&(D.clearTimeout(z.v),z.v=null),Wc(z),z.h.cancel(),z.m&&(typeof z.m=="number"&&D.clearTimeout(z.m),z.m=null)}function Ps(z){if(!Rn(z.h)&&!z.m){z.m=!0;var ee=z.Ea;Ai||ke(),vi||(Ai(),vi=!0),Ve.add(ee,z),z.D=0}}function al(z,ee){return rr(z.h)>=z.h.j-(z.m?1:0)?!1:z.m?(z.i=ee.G.concat(z.i),!0):z.I==1||z.I==2||z.D>=(z.Sa?0:z.Ta)?!1:(z.m=va(q(z.Ea,z,ee),rd(z,z.D)),z.D++,!0)}u.Ea=function(z){if(this.m)if(this.m=null,this.I==1){if(!z){this.V=Math.floor(Math.random()*1e5),z=this.V++;const pt=new Ye(this,this.j,z);let Gt=this.o;if(this.U&&(Gt?(Gt=et(Gt),Oi(Gt,this.U)):Gt=this.U),this.u!==null||this.R||(pt.J=Gt,Gt=null),this.S)e:{for(var ee=0,ae=0;ae<this.i.length;ae++){t:{var Ce=this.i[ae];if("__data__"in Ce.map&&(Ce=Ce.map.__data__,typeof Ce=="string")){Ce=Ce.length;break t}Ce=void 0}if(Ce===void 0)break;if(ee+=Ce,ee>4096){ee=ae;break e}if(ee===4096||ae===this.i.length-1){ee=ae+1;break e}}ee=1e3}else ee=1e3;ee=oh(this,pt,ee),ae=ds(this.J),Rr(ae,"RID",z),Rr(ae,"CVER",22),this.G&&Rr(ae,"X-HTTP-Session-Id",this.G),Hc(this,ae),Gt&&(this.R?ee="headers="+Ae(To(Gt))+"&"+ee:this.u&&Eu(ae,this.u,Gt)),Jn(this.h,pt),this.Ra&&Rr(ae,"TYPE","init"),this.S?(Rr(ae,"$req",ee),Rr(ae,"SID","null"),pt.U=!0,gt(pt,ae,null)):gt(pt,ae,ee),this.I=2}}else this.I==3&&(z?So(this,z):this.i.length==0||Rn(this.h)||So(this))};function So(z,ee){var ae;ee?ae=ee.l:ae=z.V++;const Ce=ds(z.J);Rr(Ce,"SID",z.M),Rr(Ce,"RID",ae),Rr(Ce,"AID",z.K),Hc(z,Ce),z.u&&z.o&&Eu(Ce,z.u,z.o),ae=new Ye(z,z.j,ae,z.D+1),z.u===null&&(ae.J=z.o),ee&&(z.i=ee.G.concat(z.i)),ee=oh(z,ae,1e3),ae.H=Math.round(z.va*.5)+Math.round(z.va*.5*Math.random()),Jn(z.h,ae),gt(ae,Ce,ee)}function Hc(z,ee){z.H&&jn(z.H,function(ae,Ce){Rr(ee,Ce,ae)}),z.l&&jn({},function(ae,Ce){Rr(ee,Ce,ae)})}function oh(z,ee,ae){ae=Math.min(z.i.length,ae);const Ce=z.l?q(z.l.Ka,z.l,z):null;e:{var pt=z.i;let Un=-1;for(;;){const fs=["count="+ae];Un==-1?ae>0?(Un=pt[0].g,fs.push("ofs="+Un)):Un=0:fs.push("ofs="+Un);let yr=!0;for(let Br=0;Br<ae;Br++){var Gt=pt[Br].g;const oa=pt[Br].map;if(Gt-=Un,Gt<0)Un=Math.max(0,pt[Br].g-100),yr=!1;else try{Gt="req"+Gt+"_"||"";try{var Ri=oa instanceof Map?oa:Object.entries(oa);for(const[ps,Us]of Ri){let ms=Us;s(Us)&&(ms=Ja(Us)),fs.push(Gt+ps+"="+encodeURIComponent(ms))}}catch(ps){throw fs.push(Gt+"type="+encodeURIComponent("_badmap")),ps}}catch{Ce&&Ce(oa)}}if(yr){Ri=fs.join("&");break e}}Ri=void 0}return z=z.i.splice(0,ae),ee.G=z,Ri}function nd(z){if(!z.g&&!z.v){z.Y=1;var ee=z.Da;Ai||ke(),vi||(Ai(),vi=!0),Ve.add(ee,z),z.A=0}}function In(z){return z.g||z.v||z.A>=3?!1:(z.Y++,z.v=va(q(z.Da,z),rd(z,z.A)),z.A++,!0)}u.Da=function(){if(this.v=null,_f(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var z=4*this.T;this.j.info("BP detection timer enabled: "+z),this.B=va(q(this.Wa,this),z)}},u.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Hr(10),ol(this),_f(this))};function ah(z){z.B!=null&&(D.clearTimeout(z.B),z.B=null)}function _f(z){z.g=new Ye(z,z.j,"rpc",z.Y),z.u===null&&(z.g.J=z.o),z.g.P=0;var ee=ds(z.na);Rr(ee,"RID","rpc"),Rr(ee,"SID",z.M),Rr(ee,"AID",z.K),Rr(ee,"CI",z.F?"0":"1"),!z.F&&z.ia&&Rr(ee,"TO",z.ia),Rr(ee,"TYPE","xmlhttp"),Hc(z,ee),z.u&&z.o&&Eu(ee,z.u,z.o),z.O&&(z.g.H=z.O);var ae=z.g;z=z.ba,ae.M=1,ae.A=Ml(ds(ee)),ae.u=null,ae.R=!0,di(ae,z)}u.Va=function(){this.C!=null&&(this.C=null,ol(this),In(this),Hr(19))};function Wc(z){z.C!=null&&(D.clearTimeout(z.C),z.C=null)}function Ii(z,ee){var ae=null;if(z.g==ee){Wc(z),ah(z),z.g=null;var Ce=2}else if(sr(z.h,ee))ae=ee.G,Es(z.h,ee),Ce=1;else return;if(z.I!=0){if(ee.o)if(Ce==1){ae=ee.u?ee.u.length:0,ee=Date.now()-ee.F;var pt=z.D;Ce=hr(),ls(Ce,new ya(Ce,ae)),Ps(z)}else nd(z);else if(pt=ee.m,pt==3||pt==0&&ee.X>0||!(Ce==1&&al(z,ee)||Ce==2&&In(z)))switch(ae&&ae.length>0&&(ee=z.h,ee.i=ee.i.concat(ae)),pt){case 1:Ds(z,5);break;case 4:Ds(z,10);break;case 3:Ds(z,6);break;default:Ds(z,2)}}}function rd(z,ee){let ae=z.Qa+Math.floor(Math.random()*z.Za);return z.isActive()||(ae*=2),ae*ee}function Ds(z,ee){if(z.j.info("Error code "+ee),ee==2){var ae=q(z.bb,z),Ce=z.Ua;const pt=!Ce;Ce=new Kr(Ce||"//www.google.com/images/cleardot.gif"),D.location&&D.location.protocol=="http"||ro(Ce,"https"),Ml(Ce),pt?Fo(Ce.toString(),ae):wo(Ce.toString(),ae)}else Hr(2);z.I=0,z.l&&z.l.pa(ee),Ea(z),qc(z)}u.bb=function(z){z?(this.j.info("Successfully pinged google.com"),Hr(2)):(this.j.info("Failed to ping google.com"),Hr(1))};function Ea(z){if(z.I=0,z.ja=[],z.l){const ee=Ys(z.h);(ee.length!=0||z.i.length!=0)&&(at(z.ja,ee),at(z.ja,z.i),z.h.i.length=0,ze(z.i),z.i.length=0),z.l.oa()}}function lh(z,ee,ae){var Ce=ae instanceof Kr?ds(ae):new Kr(ae);if(Ce.g!="")ee&&(Ce.g=ee+"."+Ce.g),ta(Ce,Ce.u);else{var pt=D.location;Ce=pt.protocol,ee=ee?ee+"."+pt.hostname:pt.hostname,pt=+pt.port;const Gt=new Kr(null);Ce&&ro(Gt,Ce),ee&&(Gt.g=ee),pt&&ta(Gt,pt),ae&&(Gt.h=ae),Ce=Gt}return ae=z.G,ee=z.wa,ae&&ee&&Rr(Ce,ae,ee),Rr(Ce,"VER",z.ka),Hc(z,Ce),Ce}function Da(z,ee,ae){if(ee&&!z.L)throw Error("Can't create secondary domain capable XhrIo object.");return ee=z.Aa&&!z.ma?new Qr(new na({ab:ae})):new Qr(z.ma),ee.Fa(z.L),ee}u.isActive=function(){return!!this.l&&this.l.isActive(this)};function gi(){}u=gi.prototype,u.ra=function(){},u.qa=function(){},u.pa=function(){},u.oa=function(){},u.isActive=function(){return!0},u.Ka=function(){};function Sn(){}Sn.prototype.g=function(z,ee){return new gn(z,ee)};function gn(z,ee){Tr.call(this),this.g=new Nl(ee),this.l=z,this.h=ee&&ee.messageUrlParams||null,z=ee&&ee.messageHeaders||null,ee&&ee.clientProtocolHeaderRequired&&(z?z["X-Client-Protocol"]="webchannel":z={"X-Client-Protocol":"webchannel"}),this.g.o=z,z=ee&&ee.initMessageHeaders||null,ee&&ee.messageContentType&&(z?z["X-WebChannel-Content-Type"]=ee.messageContentType:z={"X-WebChannel-Content-Type":ee.messageContentType}),ee&&ee.sa&&(z?z["X-WebChannel-Client-Profile"]=ee.sa:z={"X-WebChannel-Client-Profile":ee.sa}),this.g.U=z,(z=ee&&ee.Qb)&&!Ue(z)&&(this.g.u=z),this.A=ee&&ee.supportsCrossDomainXhr||!1,this.v=ee&&ee.sendRawJson||!1,(ee=ee&&ee.httpSessionIdParam)&&!Ue(ee)&&(this.g.G=ee,z=this.h,z!==null&&ee in z&&(z=this.h,ee in z&&delete z[ee])),this.j=new wn(this)}ce(gn,Tr),gn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){sa(this.g)},gn.prototype.o=function(z){var ee=this.g;if(typeof z=="string"){var ae={};ae.__data__=z,z=ae}else this.v&&(ae={},ae.__data__=Ja(z),z=ae);ee.i.push(new Gn(ee.Ya++,z)),ee.I==3&&Ps(ee)},gn.prototype.N=function(){this.g.l=null,delete this.j,sa(this.g),delete this.g,gn.Z.N.call(this)};function Ao(z){vs.call(this),z.__headers__&&(this.headers=z.__headers__,this.statusCode=z.__status__,delete z.__headers__,delete z.__status__);var ee=z.__sm__;if(ee){e:{for(const ae in ee){z=ae;break e}z=void 0}(this.i=z)&&(z=this.i,ee=ee!==null&&z in ee?ee[z]:void 0),this.data=ee}else this.data=z}ce(Ao,vs);function pc(){Vs.call(this),this.status=1}ce(pc,Vs);function wn(z){this.g=z}ce(wn,gi),wn.prototype.ra=function(){ls(this.g,"a")},wn.prototype.qa=function(z){ls(this.g,new Ao(z))},wn.prototype.pa=function(z){ls(this.g,new pc)},wn.prototype.oa=function(){ls(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,VR=function(){return new Sn},BR=function(){return hr()},FR=Yr,oT={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},J.NO_ERROR=0,J.TIMEOUT=8,J.HTTP_ERROR=6,sb=J,se.COMPLETE="complete",NR=se,ga.EventType=ea,ea.OPEN="a",ea.CLOSE="b",ea.ERROR="c",ea.MESSAGE="d",Tr.prototype.listen=Tr.prototype.J,$v=ga,Qr.prototype.listenOnce=Qr.prototype.K,Qr.prototype.getLastError=Qr.prototype.Ha,Qr.prototype.getLastErrorCode=Qr.prototype.ya,Qr.prototype.getStatus=Qr.prototype.ca,Qr.prototype.getResponseJson=Qr.prototype.La,Qr.prototype.getResponseText=Qr.prototype.la,Qr.prototype.send=Qr.prototype.ea,Qr.prototype.setWithCredentials=Qr.prototype.Fa,kR=Qr}).apply(typeof H0<"u"?H0:typeof self<"u"?self:typeof window<"u"?window:{});const lI="@firebase/firestore",cI="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}El.UNAUTHENTICATED=new El(null),El.GOOGLE_CREDENTIALS=new El("google-credentials-uid"),El.FIRST_PARTY=new El("first-party-uid"),El.MOCK_USER=new El("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Py="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xg=new NT("@firebase/firestore");function ay(){return Xg.logLevel}function nn(u,...n){if(Xg.logLevel<=kr.DEBUG){const l=n.map(YT);Xg.debug(`Firestore (${Py}): ${u}`,...l)}}function sp(u,...n){if(Xg.logLevel<=kr.ERROR){const l=n.map(YT);Xg.error(`Firestore (${Py}): ${u}`,...l)}}function vy(u,...n){if(Xg.logLevel<=kr.WARN){const l=n.map(YT);Xg.warn(`Firestore (${Py}): ${u}`,...l)}}function YT(u){if(typeof u=="string")return u;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(l){return JSON.stringify(l)})(u)}catch{return u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(u,n,l){let m="Unexpected state";typeof n=="string"?m=n:l=n,UR(u,m,l)}function UR(u,n,l){let m=`FIRESTORE (${Py}) INTERNAL ASSERTION FAILED: ${n} (ID: ${u.toString(16)})`;if(l!==void 0)try{m+=" CONTEXT: "+JSON.stringify(l)}catch{m+=" CONTEXT: "+l}throw sp(m),new Error(m)}function hs(u,n,l,m){let w="Unexpected state";typeof l=="string"?w=l:m=l,u||UR(n,w,m)}function nr(u,n){return u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ti={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ui extends pf{constructor(n,l){super(n,l),this.code=n,this.message=l,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(){this.promise=new Promise(((n,l)=>{this.resolve=n,this.reject=l}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(n,l){this.user=l,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class cB{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,l){n.enqueueRetryable((()=>l(El.UNAUTHENTICATED)))}shutdown(){}}class uB{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,l){this.changeListener=l,n.enqueueRetryable((()=>l(this.token.user)))}shutdown(){this.changeListener=null}}class hB{constructor(n){this.t=n,this.currentUser=El.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,l){hs(this.o===void 0,42304);let m=this.i;const w=G=>this.i!==m?(m=this.i,l(G)):Promise.resolve();let C=new ep;this.o=()=>{this.i++,this.currentUser=this.u(),C.resolve(),C=new ep,n.enqueueRetryable((()=>w(this.currentUser)))};const D=()=>{const G=C;n.enqueueRetryable((async()=>{await G.promise,await w(this.currentUser)}))},s=G=>{nn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=G,this.o&&(this.auth.addAuthTokenListener(this.o),D())};this.t.onInit((G=>s(G))),setTimeout((()=>{if(!this.auth){const G=this.t.getImmediate({optional:!0});G?s(G):(nn("FirebaseAuthCredentialsProvider","Auth not yet detected"),C.resolve(),C=new ep)}}),0),D()}getToken(){const n=this.i,l=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(l).then((m=>this.i!==n?(nn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):m?(hs(typeof m.accessToken=="string",31837,{l:m}),new jR(m.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return hs(n===null||typeof n=="string",2055,{h:n}),new El(n)}}class dB{constructor(n,l,m){this.P=n,this.T=l,this.I=m,this.type="FirstParty",this.user=El.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class fB{constructor(n,l,m){this.P=n,this.T=l,this.I=m}getToken(){return Promise.resolve(new dB(this.P,this.T,this.I))}start(n,l){n.enqueueRetryable((()=>l(El.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class uI{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class pB{constructor(n,l){this.V=l,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Nc(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,l){hs(this.o===void 0,3512);const m=C=>{C.error!=null&&nn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${C.error.message}`);const D=C.token!==this.m;return this.m=C.token,nn("FirebaseAppCheckTokenProvider",`Received ${D?"new":"existing"} token.`),D?l(C.token):Promise.resolve()};this.o=C=>{n.enqueueRetryable((()=>m(C)))};const w=C=>{nn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=C,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((C=>w(C))),setTimeout((()=>{if(!this.appCheck){const C=this.V.getImmediate({optional:!0});C?w(C):nn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new uI(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then((l=>l?(hs(typeof l.token=="string",44558,{tokenResult:l}),this.m=l.token,new uI(l.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mB(u){const n=typeof self<"u"&&(self.crypto||self.msCrypto),l=new Uint8Array(u);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(l);else for(let m=0;m<u;m++)l[m]=Math.floor(256*Math.random());return l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=62*Math.floor(4.129032258064516);let m="";for(;m.length<20;){const w=mB(40);for(let C=0;C<w.length;++C)m.length<20&&w[C]<l&&(m+=n.charAt(w[C]%62))}return m}}function Nr(u,n){return u<n?-1:u>n?1:0}function aT(u,n){const l=Math.min(u.length,n.length);for(let m=0;m<l;m++){const w=u.charAt(m),C=n.charAt(m);if(w!==C)return Bw(w)===Bw(C)?Nr(w,C):Bw(w)?1:-1}return Nr(u.length,n.length)}const gB=55296,_B=57343;function Bw(u){const n=u.charCodeAt(0);return n>=gB&&n<=_B}function xy(u,n,l){return u.length===n.length&&u.every(((m,w)=>l(m,n[w])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI="__name__";class Jd{constructor(n,l,m){l===void 0?l=0:l>n.length&&Bn(637,{offset:l,range:n.length}),m===void 0?m=n.length-l:m>n.length-l&&Bn(1746,{length:m,range:n.length-l}),this.segments=n,this.offset=l,this.len=m}get length(){return this.len}isEqual(n){return Jd.comparator(this,n)===0}child(n){const l=this.segments.slice(this.offset,this.limit());return n instanceof Jd?n.forEach((m=>{l.push(m)})):l.push(n),this.construct(l)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let l=0;l<this.length;l++)if(this.get(l)!==n.get(l))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let l=0;l<this.length;l++)if(this.get(l)!==n.get(l))return!1;return!0}forEach(n){for(let l=this.offset,m=this.limit();l<m;l++)n(this.segments[l])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,l){const m=Math.min(n.length,l.length);for(let w=0;w<m;w++){const C=Jd.compareSegments(n.get(w),l.get(w));if(C!==0)return C}return Nr(n.length,l.length)}static compareSegments(n,l){const m=Jd.isNumericId(n),w=Jd.isNumericId(l);return m&&!w?-1:!m&&w?1:m&&w?Jd.extractNumericId(n).compare(Jd.extractNumericId(l)):aT(n,l)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return xm.fromString(n.substring(4,n.length-2))}}class Rs extends Jd{construct(n,l,m){return new Rs(n,l,m)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const l=[];for(const m of n){if(m.indexOf("//")>=0)throw new Ui(ti.INVALID_ARGUMENT,`Invalid segment (${m}). Paths must not contain // in them.`);l.push(...m.split("/").filter((w=>w.length>0)))}return new Rs(l)}static emptyPath(){return new Rs([])}}const yB=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $a extends Jd{construct(n,l,m){return new $a(n,l,m)}static isValidIdentifier(n){return yB.test(n)}canonicalString(){return this.toArray().map((n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$a.isValidIdentifier(n)||(n="`"+n+"`"),n))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hI}static keyField(){return new $a([hI])}static fromServerFormat(n){const l=[];let m="",w=0;const C=()=>{if(m.length===0)throw new Ui(ti.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);l.push(m),m=""};let D=!1;for(;w<n.length;){const s=n[w];if(s==="\\"){if(w+1===n.length)throw new Ui(ti.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const G=n[w+1];if(G!=="\\"&&G!=="."&&G!=="`")throw new Ui(ti.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);m+=G,w+=2}else s==="`"?(D=!D,w++):s!=="."||D?(m+=s,w++):(C(),w++)}if(C(),D)throw new Ui(ti.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new $a(l)}static emptyPath(){return new $a([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(n){this.path=n}static fromPath(n){return new En(Rs.fromString(n))}static fromName(n){return new En(Rs.fromString(n).popFirst(5))}static empty(){return new En(Rs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Rs.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,l){return Rs.comparator(n.path,l.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new En(new Rs(n.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GR(u,n,l){if(!l)throw new Ui(ti.INVALID_ARGUMENT,`Function ${u}() cannot be called with an empty ${n}.`)}function vB(u,n,l,m){if(n===!0&&m===!0)throw new Ui(ti.INVALID_ARGUMENT,`${u} and ${l} cannot be used together.`)}function dI(u){if(!En.isDocumentKey(u))throw new Ui(ti.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${u} has ${u.length}.`)}function fI(u){if(En.isDocumentKey(u))throw new Ui(ti.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${u} has ${u.length}.`)}function qR(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}function Wb(u){if(u===void 0)return"undefined";if(u===null)return"null";if(typeof u=="string")return u.length>20&&(u=`${u.substring(0,20)}...`),JSON.stringify(u);if(typeof u=="number"||typeof u=="boolean")return""+u;if(typeof u=="object"){if(u instanceof Array)return"an array";{const n=(function(m){return m.constructor?m.constructor.name:null})(u);return n?`a custom ${n} object`:"an object"}}return typeof u=="function"?"a function":Bn(12329,{type:typeof u})}function Vc(u,n){if("_delegate"in u&&(u=u._delegate),!(u instanceof n)){if(n.name===u.constructor.name)throw new Ui(ti.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const l=Wb(u);throw new Ui(ti.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${l}`)}}return u}function xB(u,n){if(n<=0)throw new Ui(ti.INVALID_ARGUMENT,`Function ${u}() requires a positive number, but it was: ${n}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(u,n){const l={typeString:u};return n&&(l.value=n),l}function Ix(u,n){if(!qR(u))throw new Ui(ti.INVALID_ARGUMENT,"JSON must be an object");let l;for(const m in n)if(n[m]){const w=n[m].typeString,C="value"in n[m]?{value:n[m].value}:void 0;if(!(m in u)){l=`JSON missing required field: '${m}'`;break}const D=u[m];if(w&&typeof D!==w){l=`JSON field '${m}' must be a ${w}.`;break}if(C!==void 0&&D!==C.value){l=`Expected '${m}' field to equal '${C.value}'`;break}}if(l)throw new Ui(ti.INVALID_ARGUMENT,l);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pI=-62135596800,mI=1e6;class Ns{static now(){return Ns.fromMillis(Date.now())}static fromDate(n){return Ns.fromMillis(n.getTime())}static fromMillis(n){const l=Math.floor(n/1e3),m=Math.floor((n-1e3*l)*mI);return new Ns(l,m)}constructor(n,l){if(this.seconds=n,this.nanoseconds=l,l<0)throw new Ui(ti.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+l);if(l>=1e9)throw new Ui(ti.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+l);if(n<pI)throw new Ui(ti.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Ui(ti.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/mI}_compareTo(n){return this.seconds===n.seconds?Nr(this.nanoseconds,n.nanoseconds):Nr(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ns._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(n){if(Ix(n,Ns._jsonSchema))return new Ns(n.seconds,n.nanoseconds)}valueOf(){const n=this.seconds-pI;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ns._jsonSchemaVersion="firestore/timestamp/1.0",Ns._jsonSchema={type:Ko("string",Ns._jsonSchemaVersion),seconds:Ko("number"),nanoseconds:Ko("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{static fromTimestamp(n){return new Qn(n)}static min(){return new Qn(new Ns(0,0))}static max(){return new Qn(new Ns(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cx=-1;function bB(u,n){const l=u.toTimestamp().seconds,m=u.toTimestamp().nanoseconds+1,w=Qn.fromTimestamp(m===1e9?new Ns(l+1,0):new Ns(l,m));return new Tm(w,En.empty(),n)}function wB(u){return new Tm(u.readTime,u.key,cx)}class Tm{constructor(n,l,m){this.readTime=n,this.documentKey=l,this.largestBatchId=m}static min(){return new Tm(Qn.min(),En.empty(),cx)}static max(){return new Tm(Qn.max(),En.empty(),cx)}}function TB(u,n){let l=u.readTime.compareTo(n.readTime);return l!==0?l:(l=En.comparator(u.documentKey,n.documentKey),l!==0?l:Nr(u.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EB="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class SB{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((n=>n()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dy(u){if(u.code!==ti.FAILED_PRECONDITION||u.message!==EB)throw u;nn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n((l=>{this.isDone=!0,this.result=l,this.nextCallback&&this.nextCallback(l)}),(l=>{this.isDone=!0,this.error=l,this.catchCallback&&this.catchCallback(l)}))}catch(n){return this.next(void 0,n)}next(n,l){return this.callbackAttached&&Bn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(l,this.error):this.wrapSuccess(n,this.result):new mi(((m,w)=>{this.nextCallback=C=>{this.wrapSuccess(n,C).next(m,w)},this.catchCallback=C=>{this.wrapFailure(l,C).next(m,w)}}))}toPromise(){return new Promise(((n,l)=>{this.next(n,l)}))}wrapUserFunction(n){try{const l=n();return l instanceof mi?l:mi.resolve(l)}catch(l){return mi.reject(l)}}wrapSuccess(n,l){return n?this.wrapUserFunction((()=>n(l))):mi.resolve(l)}wrapFailure(n,l){return n?this.wrapUserFunction((()=>n(l))):mi.reject(l)}static resolve(n){return new mi(((l,m)=>{l(n)}))}static reject(n){return new mi(((l,m)=>{m(n)}))}static waitFor(n){return new mi(((l,m)=>{let w=0,C=0,D=!1;n.forEach((s=>{++w,s.next((()=>{++C,D&&C===w&&l()}),(G=>m(G)))})),D=!0,C===w&&l()}))}static or(n){let l=mi.resolve(!1);for(const m of n)l=l.next((w=>w?mi.resolve(w):m()));return l}static forEach(n,l){const m=[];return n.forEach(((w,C)=>{m.push(l.call(this,w,C))})),this.waitFor(m)}static mapArray(n,l){return new mi(((m,w)=>{const C=n.length,D=new Array(C);let s=0;for(let G=0;G<C;G++){const q=G;l(n[q]).next((te=>{D[q]=te,++s,s===C&&m(D)}),(te=>w(te)))}}))}static doWhile(n,l){return new mi(((m,w)=>{const C=()=>{n()===!0?l().next((()=>{C()}),w):m()};C()}))}}function AB(u){const n=u.match(/Android ([\d.]+)/i),l=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(l)}function Oy(u){return u.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(n,l){this.previousValue=n,l&&(l.sequenceNumberHandler=m=>this.ae(m),this.ue=m=>l.writeSequenceNumber(m))}ae(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ue&&this.ue(n),n}}$b.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT=-1;function Zb(u){return u==null}function wb(u){return u===0&&1/u==-1/0}function IB(u){return typeof u=="number"&&Number.isInteger(u)&&!wb(u)&&u<=Number.MAX_SAFE_INTEGER&&u>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR="";function CB(u){let n="";for(let l=0;l<u.length;l++)n.length>0&&(n=gI(n)),n=RB(u.get(l),n);return gI(n)}function RB(u,n){let l=n;const m=u.length;for(let w=0;w<m;w++){const C=u.charAt(w);switch(C){case"\0":l+="";break;case HR:l+="";break;default:l+=C}}return l}function gI(u){return u+HR+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _I(u){let n=0;for(const l in u)Object.prototype.hasOwnProperty.call(u,l)&&n++;return n}function Dm(u,n){for(const l in u)Object.prototype.hasOwnProperty.call(u,l)&&n(l,u[l])}function WR(u){for(const n in u)if(Object.prototype.hasOwnProperty.call(u,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(n,l){this.comparator=n,this.root=l||Wa.EMPTY}insert(n,l){return new co(this.comparator,this.root.insert(n,l,this.comparator).copy(null,null,Wa.BLACK,null,null))}remove(n){return new co(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Wa.BLACK,null,null))}get(n){let l=this.root;for(;!l.isEmpty();){const m=this.comparator(n,l.key);if(m===0)return l.value;m<0?l=l.left:m>0&&(l=l.right)}return null}indexOf(n){let l=0,m=this.root;for(;!m.isEmpty();){const w=this.comparator(n,m.key);if(w===0)return l+m.left.size;w<0?m=m.left:(l+=m.left.size+1,m=m.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal(((l,m)=>(n(l,m),!1)))}toString(){const n=[];return this.inorderTraversal(((l,m)=>(n.push(`${l}:${m}`),!1))),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new W0(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new W0(this.root,n,this.comparator,!1)}getReverseIterator(){return new W0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new W0(this.root,n,this.comparator,!0)}}class W0{constructor(n,l,m,w){this.isReverse=w,this.nodeStack=[];let C=1;for(;!n.isEmpty();)if(C=l?m(n.key,l):1,l&&w&&(C*=-1),C<0)n=this.isReverse?n.left:n.right;else{if(C===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const l={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return l}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Wa{constructor(n,l,m,w,C){this.key=n,this.value=l,this.color=m??Wa.RED,this.left=w??Wa.EMPTY,this.right=C??Wa.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,l,m,w,C){return new Wa(n??this.key,l??this.value,m??this.color,w??this.left,C??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,l,m){let w=this;const C=m(n,w.key);return w=C<0?w.copy(null,null,null,w.left.insert(n,l,m),null):C===0?w.copy(null,l,null,null,null):w.copy(null,null,null,null,w.right.insert(n,l,m)),w.fixUp()}removeMin(){if(this.left.isEmpty())return Wa.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,l){let m,w=this;if(l(n,w.key)<0)w.left.isEmpty()||w.left.isRed()||w.left.left.isRed()||(w=w.moveRedLeft()),w=w.copy(null,null,null,w.left.remove(n,l),null);else{if(w.left.isRed()&&(w=w.rotateRight()),w.right.isEmpty()||w.right.isRed()||w.right.left.isRed()||(w=w.moveRedRight()),l(n,w.key)===0){if(w.right.isEmpty())return Wa.EMPTY;m=w.right.min(),w=w.copy(m.key,m.value,null,null,w.right.removeMin())}w=w.copy(null,null,null,null,w.right.remove(n,l))}return w.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Wa.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Wa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),l=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,l)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Bn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Bn(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw Bn(27949);return n+(this.isRed()?0:1)}}Wa.EMPTY=null,Wa.RED=!0,Wa.BLACK=!1;Wa.EMPTY=new class{constructor(){this.size=0}get key(){throw Bn(57766)}get value(){throw Bn(16141)}get color(){throw Bn(16727)}get left(){throw Bn(29726)}get right(){throw Bn(36894)}copy(n,l,m,w,C){return this}insert(n,l,m){return new Wa(n,l)}remove(n,l){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(n){this.comparator=n,this.data=new co(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal(((l,m)=>(n(l),!1)))}forEachInRange(n,l){const m=this.data.getIteratorFrom(n[0]);for(;m.hasNext();){const w=m.getNext();if(this.comparator(w.key,n[1])>=0)return;l(w.key)}}forEachWhile(n,l){let m;for(m=l!==void 0?this.data.getIteratorFrom(l):this.data.getIterator();m.hasNext();)if(!n(m.getNext().key))return}firstAfterOrEqual(n){const l=this.data.getIteratorFrom(n);return l.hasNext()?l.getNext().key:null}getIterator(){return new yI(this.data.getIterator())}getIteratorFrom(n){return new yI(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let l=this;return l.size<n.size&&(l=n,n=this),n.forEach((m=>{l=l.add(m)})),l}isEqual(n){if(!(n instanceof ma)||this.size!==n.size)return!1;const l=this.data.getIterator(),m=n.data.getIterator();for(;l.hasNext();){const w=l.getNext().key,C=m.getNext().key;if(this.comparator(w,C)!==0)return!1}return!0}toArray(){const n=[];return this.forEach((l=>{n.push(l)})),n}toString(){const n=[];return this.forEach((l=>n.push(l))),"SortedSet("+n.toString()+")"}copy(n){const l=new ma(this.comparator);return l.data=n,l}}class yI{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(n){this.fields=n,n.sort($a.comparator)}static empty(){return new xu([])}unionWith(n){let l=new ma($a.comparator);for(const m of this.fields)l=l.add(m);for(const m of n)l=l.add(m);return new xu(l.toArray())}covers(n){for(const l of this.fields)if(l.isPrefixOf(n))return!0;return!1}isEqual(n){return xy(this.fields,n.fields,((l,m)=>l.isEqual(m)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(n){this.binaryString=n}static fromBase64String(n){const l=(function(w){try{return atob(w)}catch(C){throw typeof DOMException<"u"&&C instanceof DOMException?new $R("Invalid base64 string: "+C):C}})(n);return new Za(l)}static fromUint8Array(n){const l=(function(w){let C="";for(let D=0;D<w.length;++D)C+=String.fromCharCode(w[D]);return C})(n);return new Za(l)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(l){return btoa(l)})(this.binaryString)}toUint8Array(){return(function(l){const m=new Uint8Array(l.length);for(let w=0;w<l.length;w++)m[w]=l.charCodeAt(w);return m})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return Nr(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Za.EMPTY_BYTE_STRING=new Za("");const MB=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Em(u){if(hs(!!u,39018),typeof u=="string"){let n=0;const l=MB.exec(u);if(hs(!!l,46558,{timestamp:u}),l[1]){let w=l[1];w=(w+"000000000").substr(0,9),n=Number(w)}const m=new Date(u);return{seconds:Math.floor(m.getTime()/1e3),nanos:n}}return{seconds:Lo(u.seconds),nanos:Lo(u.nanos)}}function Lo(u){return typeof u=="number"?u:typeof u=="string"?Number(u):0}function Sm(u){return typeof u=="string"?Za.fromBase64String(u):Za.fromUint8Array(u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZR="server_timestamp",XR="__type__",YR="__previous_value__",KR="__local_write_time__";function Xb(u){return(u?.mapValue?.fields||{})[XR]?.stringValue===ZR}function Yb(u){const n=u.mapValue.fields[YR];return Xb(n)?Yb(n):n}function ux(u){const n=Em(u.mapValue.fields[KR].timestampValue);return new Ns(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PB{constructor(n,l,m,w,C,D,s,G,q,te){this.databaseId=n,this.appId=l,this.persistenceKey=m,this.host=w,this.ssl=C,this.forceLongPolling=D,this.autoDetectLongPolling=s,this.longPollingOptions=G,this.useFetchStreams=q,this.isUsingEmulator=te}}const Tb="(default)";class hx{constructor(n,l){this.projectId=n,this.database=l||Tb}static empty(){return new hx("","")}get isDefaultDatabase(){return this.database===Tb}isEqual(n){return n instanceof hx&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR="__type__",DB="__max__",$0={mapValue:{}},JR="__vector__",Eb="value";function Am(u){return"nullValue"in u?0:"booleanValue"in u?1:"integerValue"in u||"doubleValue"in u?2:"timestampValue"in u?3:"stringValue"in u?5:"bytesValue"in u?6:"referenceValue"in u?7:"geoPointValue"in u?8:"arrayValue"in u?9:"mapValue"in u?Xb(u)?4:LB(u)?9007199254740991:OB(u)?10:11:Bn(28295,{value:u})}function uf(u,n){if(u===n)return!0;const l=Am(u);if(l!==Am(n))return!1;switch(l){case 0:case 9007199254740991:return!0;case 1:return u.booleanValue===n.booleanValue;case 4:return ux(u).isEqual(ux(n));case 3:return(function(w,C){if(typeof w.timestampValue=="string"&&typeof C.timestampValue=="string"&&w.timestampValue.length===C.timestampValue.length)return w.timestampValue===C.timestampValue;const D=Em(w.timestampValue),s=Em(C.timestampValue);return D.seconds===s.seconds&&D.nanos===s.nanos})(u,n);case 5:return u.stringValue===n.stringValue;case 6:return(function(w,C){return Sm(w.bytesValue).isEqual(Sm(C.bytesValue))})(u,n);case 7:return u.referenceValue===n.referenceValue;case 8:return(function(w,C){return Lo(w.geoPointValue.latitude)===Lo(C.geoPointValue.latitude)&&Lo(w.geoPointValue.longitude)===Lo(C.geoPointValue.longitude)})(u,n);case 2:return(function(w,C){if("integerValue"in w&&"integerValue"in C)return Lo(w.integerValue)===Lo(C.integerValue);if("doubleValue"in w&&"doubleValue"in C){const D=Lo(w.doubleValue),s=Lo(C.doubleValue);return D===s?wb(D)===wb(s):isNaN(D)&&isNaN(s)}return!1})(u,n);case 9:return xy(u.arrayValue.values||[],n.arrayValue.values||[],uf);case 10:case 11:return(function(w,C){const D=w.mapValue.fields||{},s=C.mapValue.fields||{};if(_I(D)!==_I(s))return!1;for(const G in D)if(D.hasOwnProperty(G)&&(s[G]===void 0||!uf(D[G],s[G])))return!1;return!0})(u,n);default:return Bn(52216,{left:u})}}function dx(u,n){return(u.values||[]).find((l=>uf(l,n)))!==void 0}function by(u,n){if(u===n)return 0;const l=Am(u),m=Am(n);if(l!==m)return Nr(l,m);switch(l){case 0:case 9007199254740991:return 0;case 1:return Nr(u.booleanValue,n.booleanValue);case 2:return(function(C,D){const s=Lo(C.integerValue||C.doubleValue),G=Lo(D.integerValue||D.doubleValue);return s<G?-1:s>G?1:s===G?0:isNaN(s)?isNaN(G)?0:-1:1})(u,n);case 3:return vI(u.timestampValue,n.timestampValue);case 4:return vI(ux(u),ux(n));case 5:return aT(u.stringValue,n.stringValue);case 6:return(function(C,D){const s=Sm(C),G=Sm(D);return s.compareTo(G)})(u.bytesValue,n.bytesValue);case 7:return(function(C,D){const s=C.split("/"),G=D.split("/");for(let q=0;q<s.length&&q<G.length;q++){const te=Nr(s[q],G[q]);if(te!==0)return te}return Nr(s.length,G.length)})(u.referenceValue,n.referenceValue);case 8:return(function(C,D){const s=Nr(Lo(C.latitude),Lo(D.latitude));return s!==0?s:Nr(Lo(C.longitude),Lo(D.longitude))})(u.geoPointValue,n.geoPointValue);case 9:return xI(u.arrayValue,n.arrayValue);case 10:return(function(C,D){const s=C.fields||{},G=D.fields||{},q=s[Eb]?.arrayValue,te=G[Eb]?.arrayValue,ce=Nr(q?.values?.length||0,te?.values?.length||0);return ce!==0?ce:xI(q,te)})(u.mapValue,n.mapValue);case 11:return(function(C,D){if(C===$0.mapValue&&D===$0.mapValue)return 0;if(C===$0.mapValue)return 1;if(D===$0.mapValue)return-1;const s=C.fields||{},G=Object.keys(s),q=D.fields||{},te=Object.keys(q);G.sort(),te.sort();for(let ce=0;ce<G.length&&ce<te.length;++ce){const we=aT(G[ce],te[ce]);if(we!==0)return we;const ze=by(s[G[ce]],q[te[ce]]);if(ze!==0)return ze}return Nr(G.length,te.length)})(u.mapValue,n.mapValue);default:throw Bn(23264,{he:l})}}function vI(u,n){if(typeof u=="string"&&typeof n=="string"&&u.length===n.length)return Nr(u,n);const l=Em(u),m=Em(n),w=Nr(l.seconds,m.seconds);return w!==0?w:Nr(l.nanos,m.nanos)}function xI(u,n){const l=u.values||[],m=n.values||[];for(let w=0;w<l.length&&w<m.length;++w){const C=by(l[w],m[w]);if(C)return C}return Nr(l.length,m.length)}function wy(u){return lT(u)}function lT(u){return"nullValue"in u?"null":"booleanValue"in u?""+u.booleanValue:"integerValue"in u?""+u.integerValue:"doubleValue"in u?""+u.doubleValue:"timestampValue"in u?(function(l){const m=Em(l);return`time(${m.seconds},${m.nanos})`})(u.timestampValue):"stringValue"in u?u.stringValue:"bytesValue"in u?(function(l){return Sm(l).toBase64()})(u.bytesValue):"referenceValue"in u?(function(l){return En.fromName(l).toString()})(u.referenceValue):"geoPointValue"in u?(function(l){return`geo(${l.latitude},${l.longitude})`})(u.geoPointValue):"arrayValue"in u?(function(l){let m="[",w=!0;for(const C of l.values||[])w?w=!1:m+=",",m+=lT(C);return m+"]"})(u.arrayValue):"mapValue"in u?(function(l){const m=Object.keys(l.fields||{}).sort();let w="{",C=!0;for(const D of m)C?C=!1:w+=",",w+=`${D}:${lT(l.fields[D])}`;return w+"}"})(u.mapValue):Bn(61005,{value:u})}function ob(u){switch(Am(u)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=Yb(u);return n?16+ob(n):16;case 5:return 2*u.stringValue.length;case 6:return Sm(u.bytesValue).approximateByteSize();case 7:return u.referenceValue.length;case 9:return(function(m){return(m.values||[]).reduce(((w,C)=>w+ob(C)),0)})(u.arrayValue);case 10:case 11:return(function(m){let w=0;return Dm(m.fields,((C,D)=>{w+=C.length+ob(D)})),w})(u.mapValue);default:throw Bn(13486,{value:u})}}function Sb(u,n){return{referenceValue:`projects/${u.projectId}/databases/${u.database}/documents/${n.path.canonicalString()}`}}function cT(u){return!!u&&"integerValue"in u}function JT(u){return!!u&&"arrayValue"in u}function bI(u){return!!u&&"nullValue"in u}function wI(u){return!!u&&"doubleValue"in u&&isNaN(Number(u.doubleValue))}function ab(u){return!!u&&"mapValue"in u}function OB(u){return(u?.mapValue?.fields||{})[QR]?.stringValue===JR}function ex(u){if(u.geoPointValue)return{geoPointValue:{...u.geoPointValue}};if(u.timestampValue&&typeof u.timestampValue=="object")return{timestampValue:{...u.timestampValue}};if(u.mapValue){const n={mapValue:{fields:{}}};return Dm(u.mapValue.fields,((l,m)=>n.mapValue.fields[l]=ex(m))),n}if(u.arrayValue){const n={arrayValue:{values:[]}};for(let l=0;l<(u.arrayValue.values||[]).length;++l)n.arrayValue.values[l]=ex(u.arrayValue.values[l]);return n}return{...u}}function LB(u){return(((u.mapValue||{}).fields||{}).__type__||{}).stringValue===DB}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(n){this.value=n}static empty(){return new Fc({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let l=this.value;for(let m=0;m<n.length-1;++m)if(l=(l.mapValue.fields||{})[n.get(m)],!ab(l))return null;return l=(l.mapValue.fields||{})[n.lastSegment()],l||null}}set(n,l){this.getFieldsMap(n.popLast())[n.lastSegment()]=ex(l)}setAll(n){let l=$a.emptyPath(),m={},w=[];n.forEach(((D,s)=>{if(!l.isImmediateParentOf(s)){const G=this.getFieldsMap(l);this.applyChanges(G,m,w),m={},w=[],l=s.popLast()}D?m[s.lastSegment()]=ex(D):w.push(s.lastSegment())}));const C=this.getFieldsMap(l);this.applyChanges(C,m,w)}delete(n){const l=this.field(n.popLast());ab(l)&&l.mapValue.fields&&delete l.mapValue.fields[n.lastSegment()]}isEqual(n){return uf(this.value,n.value)}getFieldsMap(n){let l=this.value;l.mapValue.fields||(l.mapValue={fields:{}});for(let m=0;m<n.length;++m){let w=l.mapValue.fields[n.get(m)];ab(w)&&w.mapValue.fields||(w={mapValue:{fields:{}}},l.mapValue.fields[n.get(m)]=w),l=w}return l.mapValue.fields}applyChanges(n,l,m){Dm(l,((w,C)=>n[w]=C));for(const w of m)delete n[w]}clone(){return new Fc(ex(this.value))}}function eM(u){const n=[];return Dm(u.fields,((l,m)=>{const w=new $a([l]);if(ab(m)){const C=eM(m.mapValue).fields;if(C.length===0)n.push(w);else for(const D of C)n.push(w.child(D))}else n.push(w)})),new xu(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(n,l,m,w,C,D,s){this.key=n,this.documentType=l,this.version=m,this.readTime=w,this.createTime=C,this.data=D,this.documentState=s}static newInvalidDocument(n){return new Sl(n,0,Qn.min(),Qn.min(),Qn.min(),Fc.empty(),0)}static newFoundDocument(n,l,m,w){return new Sl(n,1,l,Qn.min(),m,w,0)}static newNoDocument(n,l){return new Sl(n,2,l,Qn.min(),Qn.min(),Fc.empty(),0)}static newUnknownDocument(n,l){return new Sl(n,3,l,Qn.min(),Qn.min(),Fc.empty(),2)}convertToFoundDocument(n,l){return!this.createTime.isEqual(Qn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=l,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=Fc.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=Fc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Qn.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof Sl&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new Sl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(n,l){this.position=n,this.inclusive=l}}function TI(u,n,l){let m=0;for(let w=0;w<u.position.length;w++){const C=n[w],D=u.position[w];if(C.field.isKeyField()?m=En.comparator(En.fromName(D.referenceValue),l.key):m=by(D,l.data.field(C.field)),C.dir==="desc"&&(m*=-1),m!==0)break}return m}function EI(u,n){if(u===null)return n===null;if(n===null||u.inclusive!==n.inclusive||u.position.length!==n.position.length)return!1;for(let l=0;l<u.position.length;l++)if(!uf(u.position[l],n.position[l]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(n,l="asc"){this.field=n,this.dir=l}}function zB(u,n){return u.dir===n.dir&&u.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{}class Yo extends tM{constructor(n,l,m){super(),this.field=n,this.op=l,this.value=m}static create(n,l,m){return n.isKeyField()?l==="in"||l==="not-in"?this.createKeyFieldInFilter(n,l,m):new NB(n,l,m):l==="array-contains"?new VB(n,m):l==="in"?new UB(n,m):l==="not-in"?new jB(n,m):l==="array-contains-any"?new GB(n,m):new Yo(n,l,m)}static createKeyFieldInFilter(n,l,m){return l==="in"?new FB(n,m):new BB(n,m)}matches(n){const l=n.data.field(this.field);return this.op==="!="?l!==null&&l.nullValue===void 0&&this.matchesComparison(by(l,this.value)):l!==null&&Am(this.value)===Am(l)&&this.matchesComparison(by(l,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return Bn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Jh extends tM{constructor(n,l){super(),this.filters=n,this.op=l,this.Pe=null}static create(n,l){return new Jh(n,l)}matches(n){return iM(this)?this.filters.find((l=>!l.matches(n)))===void 0:this.filters.find((l=>l.matches(n)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((n,l)=>n.concat(l.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function iM(u){return u.op==="and"}function nM(u){return kB(u)&&iM(u)}function kB(u){for(const n of u.filters)if(n instanceof Jh)return!1;return!0}function uT(u){if(u instanceof Yo)return u.field.canonicalString()+u.op.toString()+wy(u.value);if(nM(u))return u.filters.map((n=>uT(n))).join(",");{const n=u.filters.map((l=>uT(l))).join(",");return`${u.op}(${n})`}}function rM(u,n){return u instanceof Yo?(function(m,w){return w instanceof Yo&&m.op===w.op&&m.field.isEqual(w.field)&&uf(m.value,w.value)})(u,n):u instanceof Jh?(function(m,w){return w instanceof Jh&&m.op===w.op&&m.filters.length===w.filters.length?m.filters.reduce(((C,D,s)=>C&&rM(D,w.filters[s])),!0):!1})(u,n):void Bn(19439)}function sM(u){return u instanceof Yo?(function(l){return`${l.field.canonicalString()} ${l.op} ${wy(l.value)}`})(u):u instanceof Jh?(function(l){return l.op.toString()+" {"+l.getFilters().map(sM).join(" ,")+"}"})(u):"Filter"}class NB extends Yo{constructor(n,l,m){super(n,l,m),this.key=En.fromName(m.referenceValue)}matches(n){const l=En.comparator(n.key,this.key);return this.matchesComparison(l)}}class FB extends Yo{constructor(n,l){super(n,"in",l),this.keys=oM("in",l)}matches(n){return this.keys.some((l=>l.isEqual(n.key)))}}class BB extends Yo{constructor(n,l){super(n,"not-in",l),this.keys=oM("not-in",l)}matches(n){return!this.keys.some((l=>l.isEqual(n.key)))}}function oM(u,n){return(n.arrayValue?.values||[]).map((l=>En.fromName(l.referenceValue)))}class VB extends Yo{constructor(n,l){super(n,"array-contains",l)}matches(n){const l=n.data.field(this.field);return JT(l)&&dx(l.arrayValue,this.value)}}class UB extends Yo{constructor(n,l){super(n,"in",l)}matches(n){const l=n.data.field(this.field);return l!==null&&dx(this.value.arrayValue,l)}}class jB extends Yo{constructor(n,l){super(n,"not-in",l)}matches(n){if(dx(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const l=n.data.field(this.field);return l!==null&&l.nullValue===void 0&&!dx(this.value.arrayValue,l)}}class GB extends Yo{constructor(n,l){super(n,"array-contains-any",l)}matches(n){const l=n.data.field(this.field);return!(!JT(l)||!l.arrayValue.values)&&l.arrayValue.values.some((m=>dx(this.value.arrayValue,m)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qB{constructor(n,l=null,m=[],w=[],C=null,D=null,s=null){this.path=n,this.collectionGroup=l,this.orderBy=m,this.filters=w,this.limit=C,this.startAt=D,this.endAt=s,this.Te=null}}function SI(u,n=null,l=[],m=[],w=null,C=null,D=null){return new qB(u,n,l,m,w,C,D)}function eE(u){const n=nr(u);if(n.Te===null){let l=n.path.canonicalString();n.collectionGroup!==null&&(l+="|cg:"+n.collectionGroup),l+="|f:",l+=n.filters.map((m=>uT(m))).join(","),l+="|ob:",l+=n.orderBy.map((m=>(function(C){return C.field.canonicalString()+C.dir})(m))).join(","),Zb(n.limit)||(l+="|l:",l+=n.limit),n.startAt&&(l+="|lb:",l+=n.startAt.inclusive?"b:":"a:",l+=n.startAt.position.map((m=>wy(m))).join(",")),n.endAt&&(l+="|ub:",l+=n.endAt.inclusive?"a:":"b:",l+=n.endAt.position.map((m=>wy(m))).join(",")),n.Te=l}return n.Te}function tE(u,n){if(u.limit!==n.limit||u.orderBy.length!==n.orderBy.length)return!1;for(let l=0;l<u.orderBy.length;l++)if(!zB(u.orderBy[l],n.orderBy[l]))return!1;if(u.filters.length!==n.filters.length)return!1;for(let l=0;l<u.filters.length;l++)if(!rM(u.filters[l],n.filters[l]))return!1;return u.collectionGroup===n.collectionGroup&&!!u.path.isEqual(n.path)&&!!EI(u.startAt,n.startAt)&&EI(u.endAt,n.endAt)}function hT(u){return En.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(n,l=null,m=[],w=[],C=null,D="F",s=null,G=null){this.path=n,this.collectionGroup=l,this.explicitOrderBy=m,this.filters=w,this.limit=C,this.limitType=D,this.startAt=s,this.endAt=G,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function HB(u,n,l,m,w,C,D,s){return new Om(u,n,l,m,w,C,D,s)}function Kb(u){return new Om(u)}function AI(u){return u.filters.length===0&&u.limit===null&&u.startAt==null&&u.endAt==null&&(u.explicitOrderBy.length===0||u.explicitOrderBy.length===1&&u.explicitOrderBy[0].field.isKeyField())}function iE(u){return u.collectionGroup!==null}function gy(u){const n=nr(u);if(n.Ie===null){n.Ie=[];const l=new Set;for(const C of n.explicitOrderBy)n.Ie.push(C),l.add(C.field.canonicalString());const m=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(D){let s=new ma($a.comparator);return D.filters.forEach((G=>{G.getFlattenedFilters().forEach((q=>{q.isInequality()&&(s=s.add(q.field))}))})),s})(n).forEach((C=>{l.has(C.canonicalString())||C.isKeyField()||n.Ie.push(new fx(C,m))})),l.has($a.keyField().canonicalString())||n.Ie.push(new fx($a.keyField(),m))}return n.Ie}function of(u){const n=nr(u);return n.Ee||(n.Ee=WB(n,gy(u))),n.Ee}function WB(u,n){if(u.limitType==="F")return SI(u.path,u.collectionGroup,n,u.filters,u.limit,u.startAt,u.endAt);{n=n.map((w=>{const C=w.dir==="desc"?"asc":"desc";return new fx(w.field,C)}));const l=u.endAt?new Ty(u.endAt.position,u.endAt.inclusive):null,m=u.startAt?new Ty(u.startAt.position,u.startAt.inclusive):null;return SI(u.path,u.collectionGroup,n,u.filters,u.limit,l,m)}}function dT(u,n){const l=u.filters.concat([n]);return new Om(u.path,u.collectionGroup,u.explicitOrderBy.slice(),l,u.limit,u.limitType,u.startAt,u.endAt)}function Ab(u,n,l){return new Om(u.path,u.collectionGroup,u.explicitOrderBy.slice(),u.filters.slice(),n,l,u.startAt,u.endAt)}function Qb(u,n){return tE(of(u),of(n))&&u.limitType===n.limitType}function aM(u){return`${eE(of(u))}|lt:${u.limitType}`}function ly(u){return`Query(target=${(function(l){let m=l.path.canonicalString();return l.collectionGroup!==null&&(m+=" collectionGroup="+l.collectionGroup),l.filters.length>0&&(m+=`, filters: [${l.filters.map((w=>sM(w))).join(", ")}]`),Zb(l.limit)||(m+=", limit: "+l.limit),l.orderBy.length>0&&(m+=`, orderBy: [${l.orderBy.map((w=>(function(D){return`${D.field.canonicalString()} (${D.dir})`})(w))).join(", ")}]`),l.startAt&&(m+=", startAt: ",m+=l.startAt.inclusive?"b:":"a:",m+=l.startAt.position.map((w=>wy(w))).join(",")),l.endAt&&(m+=", endAt: ",m+=l.endAt.inclusive?"a:":"b:",m+=l.endAt.position.map((w=>wy(w))).join(",")),`Target(${m})`})(of(u))}; limitType=${u.limitType})`}function Jb(u,n){return n.isFoundDocument()&&(function(m,w){const C=w.key.path;return m.collectionGroup!==null?w.key.hasCollectionId(m.collectionGroup)&&m.path.isPrefixOf(C):En.isDocumentKey(m.path)?m.path.isEqual(C):m.path.isImmediateParentOf(C)})(u,n)&&(function(m,w){for(const C of gy(m))if(!C.field.isKeyField()&&w.data.field(C.field)===null)return!1;return!0})(u,n)&&(function(m,w){for(const C of m.filters)if(!C.matches(w))return!1;return!0})(u,n)&&(function(m,w){return!(m.startAt&&!(function(D,s,G){const q=TI(D,s,G);return D.inclusive?q<=0:q<0})(m.startAt,gy(m),w)||m.endAt&&!(function(D,s,G){const q=TI(D,s,G);return D.inclusive?q>=0:q>0})(m.endAt,gy(m),w))})(u,n)}function $B(u){return u.collectionGroup||(u.path.length%2==1?u.path.lastSegment():u.path.get(u.path.length-2))}function lM(u){return(n,l)=>{let m=!1;for(const w of gy(u)){const C=ZB(w,n,l);if(C!==0)return C;m=m||w.field.isKeyField()}return 0}}function ZB(u,n,l){const m=u.field.isKeyField()?En.comparator(n.key,l.key):(function(C,D,s){const G=D.data.field(C),q=s.data.field(C);return G!==null&&q!==null?by(G,q):Bn(42886)})(u.field,n,l);switch(u.dir){case"asc":return m;case"desc":return-1*m;default:return Bn(19790,{direction:u.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(n,l){this.mapKeyFn=n,this.equalsFn=l,this.inner={},this.innerSize=0}get(n){const l=this.mapKeyFn(n),m=this.inner[l];if(m!==void 0){for(const[w,C]of m)if(this.equalsFn(w,n))return C}}has(n){return this.get(n)!==void 0}set(n,l){const m=this.mapKeyFn(n),w=this.inner[m];if(w===void 0)return this.inner[m]=[[n,l]],void this.innerSize++;for(let C=0;C<w.length;C++)if(this.equalsFn(w[C][0],n))return void(w[C]=[n,l]);w.push([n,l]),this.innerSize++}delete(n){const l=this.mapKeyFn(n),m=this.inner[l];if(m===void 0)return!1;for(let w=0;w<m.length;w++)if(this.equalsFn(m[w][0],n))return m.length===1?delete this.inner[l]:m.splice(w,1),this.innerSize--,!0;return!1}forEach(n){Dm(this.inner,((l,m)=>{for(const[w,C]of m)n(w,C)}))}isEmpty(){return WR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XB=new co(En.comparator);function op(){return XB}const cM=new co(En.comparator);function Zv(...u){let n=cM;for(const l of u)n=n.insert(l.key,l);return n}function uM(u){let n=cM;return u.forEach(((l,m)=>n=n.insert(l,m.overlayedDocument))),n}function Vg(){return tx()}function hM(){return tx()}function tx(){return new Jg((u=>u.toString()),((u,n)=>u.isEqual(n)))}const YB=new co(En.comparator),KB=new ma(En.comparator);function Fr(...u){let n=KB;for(const l of u)n=n.add(l);return n}const QB=new ma(Nr);function JB(){return QB}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nE(u,n){if(u.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wb(n)?"-0":n}}function dM(u){return{integerValue:""+u}}function e4(u,n){return IB(n)?dM(n):nE(u,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(){this._=void 0}}function t4(u,n,l){return u instanceof px?(function(w,C){const D={fields:{[XR]:{stringValue:ZR},[KR]:{timestampValue:{seconds:w.seconds,nanos:w.nanoseconds}}}};return C&&Xb(C)&&(C=Yb(C)),C&&(D.fields[YR]=C),{mapValue:D}})(l,n):u instanceof mx?pM(u,n):u instanceof gx?mM(u,n):(function(w,C){const D=fM(w,C),s=II(D)+II(w.Ae);return cT(D)&&cT(w.Ae)?dM(s):nE(w.serializer,s)})(u,n)}function i4(u,n,l){return u instanceof mx?pM(u,n):u instanceof gx?mM(u,n):l}function fM(u,n){return u instanceof Ib?(function(m){return cT(m)||(function(C){return!!C&&"doubleValue"in C})(m)})(n)?n:{integerValue:0}:null}class px extends e1{}class mx extends e1{constructor(n){super(),this.elements=n}}function pM(u,n){const l=gM(n);for(const m of u.elements)l.some((w=>uf(w,m)))||l.push(m);return{arrayValue:{values:l}}}class gx extends e1{constructor(n){super(),this.elements=n}}function mM(u,n){let l=gM(n);for(const m of u.elements)l=l.filter((w=>!uf(w,m)));return{arrayValue:{values:l}}}class Ib extends e1{constructor(n,l){super(),this.serializer=n,this.Ae=l}}function II(u){return Lo(u.integerValue||u.doubleValue)}function gM(u){return JT(u)&&u.arrayValue.values?u.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(n,l){this.field=n,this.transform=l}}function r4(u,n){return u.field.isEqual(n.field)&&(function(m,w){return m instanceof mx&&w instanceof mx||m instanceof gx&&w instanceof gx?xy(m.elements,w.elements,uf):m instanceof Ib&&w instanceof Ib?uf(m.Ae,w.Ae):m instanceof px&&w instanceof px})(u.transform,n.transform)}class s4{constructor(n,l){this.version=n,this.transformResults=l}}class ih{constructor(n,l){this.updateTime=n,this.exists=l}static none(){return new ih}static exists(n){return new ih(void 0,n)}static updateTime(n){return new ih(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function lb(u,n){return u.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(u.updateTime):u.exists===void 0||u.exists===n.isFoundDocument()}class t1{}function _M(u,n){if(!u.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return u.isNoDocument()?new rE(u.key,ih.none()):new Cx(u.key,u.data,ih.none());{const l=u.data,m=Fc.empty();let w=new ma($a.comparator);for(let C of n.fields)if(!w.has(C)){let D=l.field(C);D===null&&C.length>1&&(C=C.popLast(),D=l.field(C)),D===null?m.delete(C):m.set(C,D),w=w.add(C)}return new Lm(u.key,m,new xu(w.toArray()),ih.none())}}function o4(u,n,l){u instanceof Cx?(function(w,C,D){const s=w.value.clone(),G=RI(w.fieldTransforms,C,D.transformResults);s.setAll(G),C.convertToFoundDocument(D.version,s).setHasCommittedMutations()})(u,n,l):u instanceof Lm?(function(w,C,D){if(!lb(w.precondition,C))return void C.convertToUnknownDocument(D.version);const s=RI(w.fieldTransforms,C,D.transformResults),G=C.data;G.setAll(yM(w)),G.setAll(s),C.convertToFoundDocument(D.version,G).setHasCommittedMutations()})(u,n,l):(function(w,C,D){C.convertToNoDocument(D.version).setHasCommittedMutations()})(0,n,l)}function ix(u,n,l,m){return u instanceof Cx?(function(C,D,s,G){if(!lb(C.precondition,D))return s;const q=C.value.clone(),te=MI(C.fieldTransforms,G,D);return q.setAll(te),D.convertToFoundDocument(D.version,q).setHasLocalMutations(),null})(u,n,l,m):u instanceof Lm?(function(C,D,s,G){if(!lb(C.precondition,D))return s;const q=MI(C.fieldTransforms,G,D),te=D.data;return te.setAll(yM(C)),te.setAll(q),D.convertToFoundDocument(D.version,te).setHasLocalMutations(),s===null?null:s.unionWith(C.fieldMask.fields).unionWith(C.fieldTransforms.map((ce=>ce.field)))})(u,n,l,m):(function(C,D,s){return lb(C.precondition,D)?(D.convertToNoDocument(D.version).setHasLocalMutations(),null):s})(u,n,l)}function a4(u,n){let l=null;for(const m of u.fieldTransforms){const w=n.data.field(m.field),C=fM(m.transform,w||null);C!=null&&(l===null&&(l=Fc.empty()),l.set(m.field,C))}return l||null}function CI(u,n){return u.type===n.type&&!!u.key.isEqual(n.key)&&!!u.precondition.isEqual(n.precondition)&&!!(function(m,w){return m===void 0&&w===void 0||!(!m||!w)&&xy(m,w,((C,D)=>r4(C,D)))})(u.fieldTransforms,n.fieldTransforms)&&(u.type===0?u.value.isEqual(n.value):u.type!==1||u.data.isEqual(n.data)&&u.fieldMask.isEqual(n.fieldMask))}class Cx extends t1{constructor(n,l,m,w=[]){super(),this.key=n,this.value=l,this.precondition=m,this.fieldTransforms=w,this.type=0}getFieldMask(){return null}}class Lm extends t1{constructor(n,l,m,w,C=[]){super(),this.key=n,this.data=l,this.fieldMask=m,this.precondition=w,this.fieldTransforms=C,this.type=1}getFieldMask(){return this.fieldMask}}function yM(u){const n=new Map;return u.fieldMask.fields.forEach((l=>{if(!l.isEmpty()){const m=u.data.field(l);n.set(l,m)}})),n}function RI(u,n,l){const m=new Map;hs(u.length===l.length,32656,{Re:l.length,Ve:u.length});for(let w=0;w<l.length;w++){const C=u[w],D=C.transform,s=n.data.field(C.field);m.set(C.field,i4(D,s,l[w]))}return m}function MI(u,n,l){const m=new Map;for(const w of u){const C=w.transform,D=l.data.field(w.field);m.set(w.field,t4(C,D,n))}return m}class rE extends t1{constructor(n,l){super(),this.key=n,this.precondition=l,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class l4 extends t1{constructor(n,l){super(),this.key=n,this.precondition=l,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4{constructor(n,l,m,w){this.batchId=n,this.localWriteTime=l,this.baseMutations=m,this.mutations=w}applyToRemoteDocument(n,l){const m=l.mutationResults;for(let w=0;w<this.mutations.length;w++){const C=this.mutations[w];C.key.isEqual(n.key)&&o4(C,n,m[w])}}applyToLocalView(n,l){for(const m of this.baseMutations)m.key.isEqual(n.key)&&(l=ix(m,n,l,this.localWriteTime));for(const m of this.mutations)m.key.isEqual(n.key)&&(l=ix(m,n,l,this.localWriteTime));return l}applyToLocalDocumentSet(n,l){const m=hM();return this.mutations.forEach((w=>{const C=n.get(w.key),D=C.overlayedDocument;let s=this.applyToLocalView(D,C.mutatedFields);s=l.has(w.key)?null:s;const G=_M(D,s);G!==null&&m.set(w.key,G),D.isValidDocument()||D.convertToNoDocument(Qn.min())})),m}keys(){return this.mutations.reduce(((n,l)=>n.add(l.key)),Fr())}isEqual(n){return this.batchId===n.batchId&&xy(this.mutations,n.mutations,((l,m)=>CI(l,m)))&&xy(this.baseMutations,n.baseMutations,((l,m)=>CI(l,m)))}}class sE{constructor(n,l,m,w){this.batch=n,this.commitVersion=l,this.mutationResults=m,this.docVersions=w}static from(n,l,m){hs(n.mutations.length===m.length,58842,{me:n.mutations.length,fe:m.length});let w=(function(){return YB})();const C=n.mutations;for(let D=0;D<C.length;D++)w=w.insert(C[D].key,m[D].version);return new sE(n,l,m,w)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{constructor(n,l){this.largestBatchId=n,this.mutation=l}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(n,l){this.count=n,this.unchangedNames=l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xo,Xr;function d4(u){switch(u){case ti.OK:return Bn(64938);case ti.CANCELLED:case ti.UNKNOWN:case ti.DEADLINE_EXCEEDED:case ti.RESOURCE_EXHAUSTED:case ti.INTERNAL:case ti.UNAVAILABLE:case ti.UNAUTHENTICATED:return!1;case ti.INVALID_ARGUMENT:case ti.NOT_FOUND:case ti.ALREADY_EXISTS:case ti.PERMISSION_DENIED:case ti.FAILED_PRECONDITION:case ti.ABORTED:case ti.OUT_OF_RANGE:case ti.UNIMPLEMENTED:case ti.DATA_LOSS:return!0;default:return Bn(15467,{code:u})}}function vM(u){if(u===void 0)return sp("GRPC error has no .code"),ti.UNKNOWN;switch(u){case Xo.OK:return ti.OK;case Xo.CANCELLED:return ti.CANCELLED;case Xo.UNKNOWN:return ti.UNKNOWN;case Xo.DEADLINE_EXCEEDED:return ti.DEADLINE_EXCEEDED;case Xo.RESOURCE_EXHAUSTED:return ti.RESOURCE_EXHAUSTED;case Xo.INTERNAL:return ti.INTERNAL;case Xo.UNAVAILABLE:return ti.UNAVAILABLE;case Xo.UNAUTHENTICATED:return ti.UNAUTHENTICATED;case Xo.INVALID_ARGUMENT:return ti.INVALID_ARGUMENT;case Xo.NOT_FOUND:return ti.NOT_FOUND;case Xo.ALREADY_EXISTS:return ti.ALREADY_EXISTS;case Xo.PERMISSION_DENIED:return ti.PERMISSION_DENIED;case Xo.FAILED_PRECONDITION:return ti.FAILED_PRECONDITION;case Xo.ABORTED:return ti.ABORTED;case Xo.OUT_OF_RANGE:return ti.OUT_OF_RANGE;case Xo.UNIMPLEMENTED:return ti.UNIMPLEMENTED;case Xo.DATA_LOSS:return ti.DATA_LOSS;default:return Bn(39323,{code:u})}}(Xr=Xo||(Xo={}))[Xr.OK=0]="OK",Xr[Xr.CANCELLED=1]="CANCELLED",Xr[Xr.UNKNOWN=2]="UNKNOWN",Xr[Xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xr[Xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xr[Xr.NOT_FOUND=5]="NOT_FOUND",Xr[Xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xr[Xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xr[Xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xr[Xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xr[Xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xr[Xr.ABORTED=10]="ABORTED",Xr[Xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xr[Xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xr[Xr.INTERNAL=13]="INTERNAL",Xr[Xr.UNAVAILABLE=14]="UNAVAILABLE",Xr[Xr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4=new xm([4294967295,4294967295],0);function PI(u){const n=f4().encode(u),l=new zR;return l.update(n),new Uint8Array(l.digest())}function DI(u){const n=new DataView(u.buffer),l=n.getUint32(0,!0),m=n.getUint32(4,!0),w=n.getUint32(8,!0),C=n.getUint32(12,!0);return[new xm([l,m],0),new xm([w,C],0)]}class oE{constructor(n,l,m){if(this.bitmap=n,this.padding=l,this.hashCount=m,l<0||l>=8)throw new Xv(`Invalid padding: ${l}`);if(m<0)throw new Xv(`Invalid hash count: ${m}`);if(n.length>0&&this.hashCount===0)throw new Xv(`Invalid hash count: ${m}`);if(n.length===0&&l!==0)throw new Xv(`Invalid padding when bitmap length is 0: ${l}`);this.ge=8*n.length-l,this.pe=xm.fromNumber(this.ge)}ye(n,l,m){let w=n.add(l.multiply(xm.fromNumber(m)));return w.compare(p4)===1&&(w=new xm([w.getBits(0),w.getBits(1)],0)),w.modulo(this.pe).toNumber()}we(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.ge===0)return!1;const l=PI(n),[m,w]=DI(l);for(let C=0;C<this.hashCount;C++){const D=this.ye(m,w,C);if(!this.we(D))return!1}return!0}static create(n,l,m){const w=n%8==0?0:8-n%8,C=new Uint8Array(Math.ceil(n/8)),D=new oE(C,w,l);return m.forEach((s=>D.insert(s))),D}insert(n){if(this.ge===0)return;const l=PI(n),[m,w]=DI(l);for(let C=0;C<this.hashCount;C++){const D=this.ye(m,w,C);this.Se(D)}}Se(n){const l=Math.floor(n/8),m=n%8;this.bitmap[l]|=1<<m}}class Xv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1{constructor(n,l,m,w,C){this.snapshotVersion=n,this.targetChanges=l,this.targetMismatches=m,this.documentUpdates=w,this.resolvedLimboDocuments=C}static createSynthesizedRemoteEventForCurrentChange(n,l,m){const w=new Map;return w.set(n,Rx.createSynthesizedTargetChangeForCurrentChange(n,l,m)),new i1(Qn.min(),w,new co(Nr),op(),Fr())}}class Rx{constructor(n,l,m,w,C){this.resumeToken=n,this.current=l,this.addedDocuments=m,this.modifiedDocuments=w,this.removedDocuments=C}static createSynthesizedTargetChangeForCurrentChange(n,l,m){return new Rx(m,l,Fr(),Fr(),Fr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(n,l,m,w){this.be=n,this.removedTargetIds=l,this.key=m,this.De=w}}class xM{constructor(n,l){this.targetId=n,this.Ce=l}}class bM{constructor(n,l,m=Za.EMPTY_BYTE_STRING,w=null){this.state=n,this.targetIds=l,this.resumeToken=m,this.cause=w}}class OI{constructor(){this.ve=0,this.Fe=LI(),this.Me=Za.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(n){n.approximateByteSize()>0&&(this.Oe=!0,this.Me=n)}ke(){let n=Fr(),l=Fr(),m=Fr();return this.Fe.forEach(((w,C)=>{switch(C){case 0:n=n.add(w);break;case 2:l=l.add(w);break;case 1:m=m.add(w);break;default:Bn(38017,{changeType:C})}})),new Rx(this.Me,this.xe,n,l,m)}qe(){this.Oe=!1,this.Fe=LI()}Qe(n,l){this.Oe=!0,this.Fe=this.Fe.insert(n,l)}$e(n){this.Oe=!0,this.Fe=this.Fe.remove(n)}Ue(){this.ve+=1}Ke(){this.ve-=1,hs(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class m4{constructor(n){this.Ge=n,this.ze=new Map,this.je=op(),this.Je=Z0(),this.He=Z0(),this.Ye=new co(Nr)}Ze(n){for(const l of n.be)n.De&&n.De.isFoundDocument()?this.Xe(l,n.De):this.et(l,n.key,n.De);for(const l of n.removedTargetIds)this.et(l,n.key,n.De)}tt(n){this.forEachTarget(n,(l=>{const m=this.nt(l);switch(n.state){case 0:this.rt(l)&&m.Le(n.resumeToken);break;case 1:m.Ke(),m.Ne||m.qe(),m.Le(n.resumeToken);break;case 2:m.Ke(),m.Ne||this.removeTarget(l);break;case 3:this.rt(l)&&(m.We(),m.Le(n.resumeToken));break;case 4:this.rt(l)&&(this.it(l),m.Le(n.resumeToken));break;default:Bn(56790,{state:n.state})}}))}forEachTarget(n,l){n.targetIds.length>0?n.targetIds.forEach(l):this.ze.forEach(((m,w)=>{this.rt(w)&&l(w)}))}st(n){const l=n.targetId,m=n.Ce.count,w=this.ot(l);if(w){const C=w.target;if(hT(C))if(m===0){const D=new En(C.path);this.et(l,D,Sl.newNoDocument(D,Qn.min()))}else hs(m===1,20013,{expectedCount:m});else{const D=this._t(l);if(D!==m){const s=this.ut(n),G=s?this.ct(s,n,D):1;if(G!==0){this.it(l);const q=G===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(l,q)}}}}}ut(n){const l=n.Ce.unchangedNames;if(!l||!l.bits)return null;const{bits:{bitmap:m="",padding:w=0},hashCount:C=0}=l;let D,s;try{D=Sm(m).toUint8Array()}catch(G){if(G instanceof $R)return vy("Decoding the base64 bloom filter in existence filter failed ("+G.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw G}try{s=new oE(D,w,C)}catch(G){return vy(G instanceof Xv?"BloomFilter error: ":"Applying bloom filter failed: ",G),null}return s.ge===0?null:s}ct(n,l,m){return l.Ce.count===m-this.Pt(n,l.targetId)?0:2}Pt(n,l){const m=this.Ge.getRemoteKeysForTarget(l);let w=0;return m.forEach((C=>{const D=this.Ge.ht(),s=`projects/${D.projectId}/databases/${D.database}/documents/${C.path.canonicalString()}`;n.mightContain(s)||(this.et(l,C,null),w++)})),w}Tt(n){const l=new Map;this.ze.forEach(((C,D)=>{const s=this.ot(D);if(s){if(C.current&&hT(s.target)){const G=new En(s.target.path);this.It(G).has(D)||this.Et(D,G)||this.et(D,G,Sl.newNoDocument(G,n))}C.Be&&(l.set(D,C.ke()),C.qe())}}));let m=Fr();this.He.forEach(((C,D)=>{let s=!0;D.forEachWhile((G=>{const q=this.ot(G);return!q||q.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)})),s&&(m=m.add(C))})),this.je.forEach(((C,D)=>D.setReadTime(n)));const w=new i1(n,l,this.Ye,this.je,m);return this.je=op(),this.Je=Z0(),this.He=Z0(),this.Ye=new co(Nr),w}Xe(n,l){if(!this.rt(n))return;const m=this.Et(n,l.key)?2:0;this.nt(n).Qe(l.key,m),this.je=this.je.insert(l.key,l),this.Je=this.Je.insert(l.key,this.It(l.key).add(n)),this.He=this.He.insert(l.key,this.dt(l.key).add(n))}et(n,l,m){if(!this.rt(n))return;const w=this.nt(n);this.Et(n,l)?w.Qe(l,1):w.$e(l),this.He=this.He.insert(l,this.dt(l).delete(n)),this.He=this.He.insert(l,this.dt(l).add(n)),m&&(this.je=this.je.insert(l,m))}removeTarget(n){this.ze.delete(n)}_t(n){const l=this.nt(n).ke();return this.Ge.getRemoteKeysForTarget(n).size+l.addedDocuments.size-l.removedDocuments.size}Ue(n){this.nt(n).Ue()}nt(n){let l=this.ze.get(n);return l||(l=new OI,this.ze.set(n,l)),l}dt(n){let l=this.He.get(n);return l||(l=new ma(Nr),this.He=this.He.insert(n,l)),l}It(n){let l=this.Je.get(n);return l||(l=new ma(Nr),this.Je=this.Je.insert(n,l)),l}rt(n){const l=this.ot(n)!==null;return l||nn("WatchChangeAggregator","Detected inactive target",n),l}ot(n){const l=this.ze.get(n);return l&&l.Ne?null:this.Ge.At(n)}it(n){this.ze.set(n,new OI),this.Ge.getRemoteKeysForTarget(n).forEach((l=>{this.et(n,l,null)}))}Et(n,l){return this.Ge.getRemoteKeysForTarget(n).has(l)}}function Z0(){return new co(En.comparator)}function LI(){return new co(En.comparator)}const g4={asc:"ASCENDING",desc:"DESCENDING"},_4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},y4={and:"AND",or:"OR"};class v4{constructor(n,l){this.databaseId=n,this.useProto3Json=l}}function fT(u,n){return u.useProto3Json||Zb(n)?n:{value:n}}function Cb(u,n){return u.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function wM(u,n){return u.useProto3Json?n.toBase64():n.toUint8Array()}function x4(u,n){return Cb(u,n.toTimestamp())}function af(u){return hs(!!u,49232),Qn.fromTimestamp((function(l){const m=Em(l);return new Ns(m.seconds,m.nanos)})(u))}function aE(u,n){return pT(u,n).canonicalString()}function pT(u,n){const l=(function(w){return new Rs(["projects",w.projectId,"databases",w.database])})(u).child("documents");return n===void 0?l:l.child(n)}function TM(u){const n=Rs.fromString(u);return hs(CM(n),10190,{key:n.toString()}),n}function mT(u,n){return aE(u.databaseId,n.path)}function Vw(u,n){const l=TM(n);if(l.get(1)!==u.databaseId.projectId)throw new Ui(ti.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+l.get(1)+" vs "+u.databaseId.projectId);if(l.get(3)!==u.databaseId.database)throw new Ui(ti.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+l.get(3)+" vs "+u.databaseId.database);return new En(SM(l))}function EM(u,n){return aE(u.databaseId,n)}function b4(u){const n=TM(u);return n.length===4?Rs.emptyPath():SM(n)}function gT(u){return new Rs(["projects",u.databaseId.projectId,"databases",u.databaseId.database]).canonicalString()}function SM(u){return hs(u.length>4&&u.get(4)==="documents",29091,{key:u.toString()}),u.popFirst(5)}function zI(u,n,l){return{name:mT(u,n),fields:l.value.mapValue.fields}}function w4(u,n){let l;if("targetChange"in n){n.targetChange;const m=(function(q){return q==="NO_CHANGE"?0:q==="ADD"?1:q==="REMOVE"?2:q==="CURRENT"?3:q==="RESET"?4:Bn(39313,{state:q})})(n.targetChange.targetChangeType||"NO_CHANGE"),w=n.targetChange.targetIds||[],C=(function(q,te){return q.useProto3Json?(hs(te===void 0||typeof te=="string",58123),Za.fromBase64String(te||"")):(hs(te===void 0||te instanceof Buffer||te instanceof Uint8Array,16193),Za.fromUint8Array(te||new Uint8Array))})(u,n.targetChange.resumeToken),D=n.targetChange.cause,s=D&&(function(q){const te=q.code===void 0?ti.UNKNOWN:vM(q.code);return new Ui(te,q.message||"")})(D);l=new bM(m,w,C,s||null)}else if("documentChange"in n){n.documentChange;const m=n.documentChange;m.document,m.document.name,m.document.updateTime;const w=Vw(u,m.document.name),C=af(m.document.updateTime),D=m.document.createTime?af(m.document.createTime):Qn.min(),s=new Fc({mapValue:{fields:m.document.fields}}),G=Sl.newFoundDocument(w,C,D,s),q=m.targetIds||[],te=m.removedTargetIds||[];l=new cb(q,te,G.key,G)}else if("documentDelete"in n){n.documentDelete;const m=n.documentDelete;m.document;const w=Vw(u,m.document),C=m.readTime?af(m.readTime):Qn.min(),D=Sl.newNoDocument(w,C),s=m.removedTargetIds||[];l=new cb([],s,D.key,D)}else if("documentRemove"in n){n.documentRemove;const m=n.documentRemove;m.document;const w=Vw(u,m.document),C=m.removedTargetIds||[];l=new cb([],C,w,null)}else{if(!("filter"in n))return Bn(11601,{Rt:n});{n.filter;const m=n.filter;m.targetId;const{count:w=0,unchangedNames:C}=m,D=new h4(w,C),s=m.targetId;l=new xM(s,D)}}return l}function T4(u,n){let l;if(n instanceof Cx)l={update:zI(u,n.key,n.value)};else if(n instanceof rE)l={delete:mT(u,n.key)};else if(n instanceof Lm)l={update:zI(u,n.key,n.data),updateMask:D4(n.fieldMask)};else{if(!(n instanceof l4))return Bn(16599,{Vt:n.type});l={verify:mT(u,n.key)}}return n.fieldTransforms.length>0&&(l.updateTransforms=n.fieldTransforms.map((m=>(function(C,D){const s=D.transform;if(s instanceof px)return{fieldPath:D.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof mx)return{fieldPath:D.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof gx)return{fieldPath:D.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof Ib)return{fieldPath:D.field.canonicalString(),increment:s.Ae};throw Bn(20930,{transform:D.transform})})(0,m)))),n.precondition.isNone||(l.currentDocument=(function(w,C){return C.updateTime!==void 0?{updateTime:x4(w,C.updateTime)}:C.exists!==void 0?{exists:C.exists}:Bn(27497)})(u,n.precondition)),l}function E4(u,n){return u&&u.length>0?(hs(n!==void 0,14353),u.map((l=>(function(w,C){let D=w.updateTime?af(w.updateTime):af(C);return D.isEqual(Qn.min())&&(D=af(C)),new s4(D,w.transformResults||[])})(l,n)))):[]}function S4(u,n){return{documents:[EM(u,n.path)]}}function A4(u,n){const l={structuredQuery:{}},m=n.path;let w;n.collectionGroup!==null?(w=m,l.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(w=m.popLast(),l.structuredQuery.from=[{collectionId:m.lastSegment()}]),l.parent=EM(u,w);const C=(function(q){if(q.length!==0)return IM(Jh.create(q,"and"))})(n.filters);C&&(l.structuredQuery.where=C);const D=(function(q){if(q.length!==0)return q.map((te=>(function(we){return{field:cy(we.field),direction:R4(we.dir)}})(te)))})(n.orderBy);D&&(l.structuredQuery.orderBy=D);const s=fT(u,n.limit);return s!==null&&(l.structuredQuery.limit=s),n.startAt&&(l.structuredQuery.startAt=(function(q){return{before:q.inclusive,values:q.position}})(n.startAt)),n.endAt&&(l.structuredQuery.endAt=(function(q){return{before:!q.inclusive,values:q.position}})(n.endAt)),{ft:l,parent:w}}function I4(u){let n=b4(u.parent);const l=u.structuredQuery,m=l.from?l.from.length:0;let w=null;if(m>0){hs(m===1,65062);const te=l.from[0];te.allDescendants?w=te.collectionId:n=n.child(te.collectionId)}let C=[];l.where&&(C=(function(ce){const we=AM(ce);return we instanceof Jh&&nM(we)?we.getFilters():[we]})(l.where));let D=[];l.orderBy&&(D=(function(ce){return ce.map((we=>(function(at){return new fx(uy(at.field),(function(Qe){switch(Qe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(at.direction))})(we)))})(l.orderBy));let s=null;l.limit&&(s=(function(ce){let we;return we=typeof ce=="object"?ce.value:ce,Zb(we)?null:we})(l.limit));let G=null;l.startAt&&(G=(function(ce){const we=!!ce.before,ze=ce.values||[];return new Ty(ze,we)})(l.startAt));let q=null;return l.endAt&&(q=(function(ce){const we=!ce.before,ze=ce.values||[];return new Ty(ze,we)})(l.endAt)),HB(n,w,D,C,s,"F",G,q)}function C4(u,n){const l=(function(w){switch(w){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Bn(28987,{purpose:w})}})(n.purpose);return l==null?null:{"goog-listen-tags":l}}function AM(u){return u.unaryFilter!==void 0?(function(l){switch(l.unaryFilter.op){case"IS_NAN":const m=uy(l.unaryFilter.field);return Yo.create(m,"==",{doubleValue:NaN});case"IS_NULL":const w=uy(l.unaryFilter.field);return Yo.create(w,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const C=uy(l.unaryFilter.field);return Yo.create(C,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const D=uy(l.unaryFilter.field);return Yo.create(D,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Bn(61313);default:return Bn(60726)}})(u):u.fieldFilter!==void 0?(function(l){return Yo.create(uy(l.fieldFilter.field),(function(w){switch(w){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Bn(58110);default:return Bn(50506)}})(l.fieldFilter.op),l.fieldFilter.value)})(u):u.compositeFilter!==void 0?(function(l){return Jh.create(l.compositeFilter.filters.map((m=>AM(m))),(function(w){switch(w){case"AND":return"and";case"OR":return"or";default:return Bn(1026)}})(l.compositeFilter.op))})(u):Bn(30097,{filter:u})}function R4(u){return g4[u]}function M4(u){return _4[u]}function P4(u){return y4[u]}function cy(u){return{fieldPath:u.canonicalString()}}function uy(u){return $a.fromServerFormat(u.fieldPath)}function IM(u){return u instanceof Yo?(function(l){if(l.op==="=="){if(wI(l.value))return{unaryFilter:{field:cy(l.field),op:"IS_NAN"}};if(bI(l.value))return{unaryFilter:{field:cy(l.field),op:"IS_NULL"}}}else if(l.op==="!="){if(wI(l.value))return{unaryFilter:{field:cy(l.field),op:"IS_NOT_NAN"}};if(bI(l.value))return{unaryFilter:{field:cy(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cy(l.field),op:M4(l.op),value:l.value}}})(u):u instanceof Jh?(function(l){const m=l.getFilters().map((w=>IM(w)));return m.length===1?m[0]:{compositeFilter:{op:P4(l.op),filters:m}}})(u):Bn(54877,{filter:u})}function D4(u){const n=[];return u.fields.forEach((l=>n.push(l.canonicalString()))),{fieldPaths:n}}function CM(u){return u.length>=4&&u.get(0)==="projects"&&u.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(n,l,m,w,C=Qn.min(),D=Qn.min(),s=Za.EMPTY_BYTE_STRING,G=null){this.target=n,this.targetId=l,this.purpose=m,this.sequenceNumber=w,this.snapshotVersion=C,this.lastLimboFreeSnapshotVersion=D,this.resumeToken=s,this.expectedCount=G}withSequenceNumber(n){return new _m(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,l){return new _m(this.target,this.targetId,this.purpose,this.sequenceNumber,l,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new _m(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new _m(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{constructor(n){this.yt=n}}function L4(u){const n=I4({parent:u.parent,structuredQuery:u.structuredQuery});return u.limitType==="LAST"?Ab(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(){this.Cn=new k4}addToCollectionParentIndex(n,l){return this.Cn.add(l),mi.resolve()}getCollectionParents(n,l){return mi.resolve(this.Cn.getEntries(l))}addFieldIndex(n,l){return mi.resolve()}deleteFieldIndex(n,l){return mi.resolve()}deleteAllFieldIndexes(n){return mi.resolve()}createTargetIndexes(n,l){return mi.resolve()}getDocumentsMatchingTarget(n,l){return mi.resolve(null)}getIndexType(n,l){return mi.resolve(0)}getFieldIndexes(n,l){return mi.resolve([])}getNextCollectionGroupToUpdate(n){return mi.resolve(null)}getMinOffset(n,l){return mi.resolve(Tm.min())}getMinOffsetFromCollectionGroup(n,l){return mi.resolve(Tm.min())}updateCollectionGroup(n,l,m){return mi.resolve()}updateIndexEntries(n,l){return mi.resolve()}}class k4{constructor(){this.index={}}add(n){const l=n.lastSegment(),m=n.popLast(),w=this.index[l]||new ma(Rs.comparator),C=!w.has(m);return this.index[l]=w.add(m),C}has(n){const l=n.lastSegment(),m=n.popLast(),w=this.index[l];return w&&w.has(m)}getEntries(n){return(this.index[n]||new ma(Rs.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},RM=41943040;class zc{static withCacheSize(n){return new zc(n,zc.DEFAULT_COLLECTION_PERCENTILE,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,l,m){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=l,this.maximumSequenceNumbersToCollect=m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zc.DEFAULT_COLLECTION_PERCENTILE=10,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zc.DEFAULT=new zc(RM,zc.DEFAULT_COLLECTION_PERCENTILE,zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zc.DISABLED=new zc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(n){this.ar=n}next(){return this.ar+=2,this.ar}static ur(){return new Ey(0)}static cr(){return new Ey(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NI="LruGarbageCollector",N4=1048576;function FI([u,n],[l,m]){const w=Nr(u,l);return w===0?Nr(n,m):w}class F4{constructor(n){this.Ir=n,this.buffer=new ma(FI),this.Er=0}dr(){return++this.Er}Ar(n){const l=[n,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(l);else{const m=this.buffer.last();FI(l,m)<0&&(this.buffer=this.buffer.delete(m).add(l))}}get maxValue(){return this.buffer.last()[0]}}class B4{constructor(n,l,m){this.garbageCollector=n,this.asyncQueue=l,this.localStore=m,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(n){nn(NI,`Garbage collection scheduled in ${n}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(l){Oy(l)?nn(NI,"Ignoring IndexedDB error during garbage collection: ",l):await Dy(l)}await this.Vr(3e5)}))}}class V4{constructor(n,l){this.mr=n,this.params=l}calculateTargetCount(n,l){return this.mr.gr(n).next((m=>Math.floor(l/100*m)))}nthSequenceNumber(n,l){if(l===0)return mi.resolve($b.ce);const m=new F4(l);return this.mr.forEachTarget(n,(w=>m.Ar(w.sequenceNumber))).next((()=>this.mr.pr(n,(w=>m.Ar(w))))).next((()=>m.maxValue))}removeTargets(n,l,m){return this.mr.removeTargets(n,l,m)}removeOrphanedDocuments(n,l){return this.mr.removeOrphanedDocuments(n,l)}collect(n,l){return this.params.cacheSizeCollectionThreshold===-1?(nn("LruGarbageCollector","Garbage collection skipped; disabled"),mi.resolve(kI)):this.getCacheSize(n).next((m=>m<this.params.cacheSizeCollectionThreshold?(nn("LruGarbageCollector",`Garbage collection skipped; Cache size ${m} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kI):this.yr(n,l)))}getCacheSize(n){return this.mr.getCacheSize(n)}yr(n,l){let m,w,C,D,s,G,q;const te=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next((ce=>(ce>this.params.maximumSequenceNumbersToCollect?(nn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ce}`),w=this.params.maximumSequenceNumbersToCollect):w=ce,D=Date.now(),this.nthSequenceNumber(n,w)))).next((ce=>(m=ce,s=Date.now(),this.removeTargets(n,m,l)))).next((ce=>(C=ce,G=Date.now(),this.removeOrphanedDocuments(n,m)))).next((ce=>(q=Date.now(),ay()<=kr.DEBUG&&nn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${D-te}ms
	Determined least recently used ${w} in `+(s-D)+`ms
	Removed ${C} targets in `+(G-s)+`ms
	Removed ${ce} documents in `+(q-G)+`ms
Total Duration: ${q-te}ms`),mi.resolve({didRun:!0,sequenceNumbersCollected:w,targetsRemoved:C,documentsRemoved:ce}))))}}function U4(u,n){return new V4(u,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(){this.changes=new Jg((n=>n.toString()),((n,l)=>n.isEqual(l))),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,l){this.assertNotApplied(),this.changes.set(n,Sl.newInvalidDocument(n).setReadTime(l))}getEntry(n,l){this.assertNotApplied();const m=this.changes.get(l);return m!==void 0?mi.resolve(m):this.getFromCache(n,l)}getEntries(n,l){return this.getAllFromCache(n,l)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4{constructor(n,l){this.overlayedDocument=n,this.mutatedFields=l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4{constructor(n,l,m,w){this.remoteDocumentCache=n,this.mutationQueue=l,this.documentOverlayCache=m,this.indexManager=w}getDocument(n,l){let m=null;return this.documentOverlayCache.getOverlay(n,l).next((w=>(m=w,this.remoteDocumentCache.getEntry(n,l)))).next((w=>(m!==null&&ix(m.mutation,w,xu.empty(),Ns.now()),w)))}getDocuments(n,l){return this.remoteDocumentCache.getEntries(n,l).next((m=>this.getLocalViewOfDocuments(n,m,Fr()).next((()=>m))))}getLocalViewOfDocuments(n,l,m=Fr()){const w=Vg();return this.populateOverlays(n,w,l).next((()=>this.computeViews(n,l,w,m).next((C=>{let D=Zv();return C.forEach(((s,G)=>{D=D.insert(s,G.overlayedDocument)})),D}))))}getOverlayedDocuments(n,l){const m=Vg();return this.populateOverlays(n,m,l).next((()=>this.computeViews(n,l,m,Fr())))}populateOverlays(n,l,m){const w=[];return m.forEach((C=>{l.has(C)||w.push(C)})),this.documentOverlayCache.getOverlays(n,w).next((C=>{C.forEach(((D,s)=>{l.set(D,s)}))}))}computeViews(n,l,m,w){let C=op();const D=tx(),s=(function(){return tx()})();return l.forEach(((G,q)=>{const te=m.get(q.key);w.has(q.key)&&(te===void 0||te.mutation instanceof Lm)?C=C.insert(q.key,q):te!==void 0?(D.set(q.key,te.mutation.getFieldMask()),ix(te.mutation,q,te.mutation.getFieldMask(),Ns.now())):D.set(q.key,xu.empty())})),this.recalculateAndSaveOverlays(n,C).next((G=>(G.forEach(((q,te)=>D.set(q,te))),l.forEach(((q,te)=>s.set(q,new G4(te,D.get(q)??null)))),s)))}recalculateAndSaveOverlays(n,l){const m=tx();let w=new co(((D,s)=>D-s)),C=Fr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,l).next((D=>{for(const s of D)s.keys().forEach((G=>{const q=l.get(G);if(q===null)return;let te=m.get(G)||xu.empty();te=s.applyToLocalView(q,te),m.set(G,te);const ce=(w.get(s.batchId)||Fr()).add(G);w=w.insert(s.batchId,ce)}))})).next((()=>{const D=[],s=w.getReverseIterator();for(;s.hasNext();){const G=s.getNext(),q=G.key,te=G.value,ce=hM();te.forEach((we=>{if(!C.has(we)){const ze=_M(l.get(we),m.get(we));ze!==null&&ce.set(we,ze),C=C.add(we)}})),D.push(this.documentOverlayCache.saveOverlays(n,q,ce))}return mi.waitFor(D)})).next((()=>m))}recalculateAndSaveOverlaysForDocumentKeys(n,l){return this.remoteDocumentCache.getEntries(n,l).next((m=>this.recalculateAndSaveOverlays(n,m)))}getDocumentsMatchingQuery(n,l,m,w){return(function(D){return En.isDocumentKey(D.path)&&D.collectionGroup===null&&D.filters.length===0})(l)?this.getDocumentsMatchingDocumentQuery(n,l.path):iE(l)?this.getDocumentsMatchingCollectionGroupQuery(n,l,m,w):this.getDocumentsMatchingCollectionQuery(n,l,m,w)}getNextDocuments(n,l,m,w){return this.remoteDocumentCache.getAllFromCollectionGroup(n,l,m,w).next((C=>{const D=w-C.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,l,m.largestBatchId,w-C.size):mi.resolve(Vg());let s=cx,G=C;return D.next((q=>mi.forEach(q,((te,ce)=>(s<ce.largestBatchId&&(s=ce.largestBatchId),C.get(te)?mi.resolve():this.remoteDocumentCache.getEntry(n,te).next((we=>{G=G.insert(te,we)}))))).next((()=>this.populateOverlays(n,q,C))).next((()=>this.computeViews(n,G,q,Fr()))).next((te=>({batchId:s,changes:uM(te)})))))}))}getDocumentsMatchingDocumentQuery(n,l){return this.getDocument(n,new En(l)).next((m=>{let w=Zv();return m.isFoundDocument()&&(w=w.insert(m.key,m)),w}))}getDocumentsMatchingCollectionGroupQuery(n,l,m,w){const C=l.collectionGroup;let D=Zv();return this.indexManager.getCollectionParents(n,C).next((s=>mi.forEach(s,(G=>{const q=(function(ce,we){return new Om(we,null,ce.explicitOrderBy.slice(),ce.filters.slice(),ce.limit,ce.limitType,ce.startAt,ce.endAt)})(l,G.child(C));return this.getDocumentsMatchingCollectionQuery(n,q,m,w).next((te=>{te.forEach(((ce,we)=>{D=D.insert(ce,we)}))}))})).next((()=>D))))}getDocumentsMatchingCollectionQuery(n,l,m,w){let C;return this.documentOverlayCache.getOverlaysForCollection(n,l.path,m.largestBatchId).next((D=>(C=D,this.remoteDocumentCache.getDocumentsMatchingQuery(n,l,m,C,w)))).next((D=>{C.forEach(((G,q)=>{const te=q.getKey();D.get(te)===null&&(D=D.insert(te,Sl.newInvalidDocument(te)))}));let s=Zv();return D.forEach(((G,q)=>{const te=C.get(G);te!==void 0&&ix(te.mutation,q,xu.empty(),Ns.now()),Jb(l,q)&&(s=s.insert(G,q))})),s}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(n){this.serializer=n,this.Lr=new Map,this.kr=new Map}getBundleMetadata(n,l){return mi.resolve(this.Lr.get(l))}saveBundleMetadata(n,l){return this.Lr.set(l.id,(function(w){return{id:w.id,version:w.version,createTime:af(w.createTime)}})(l)),mi.resolve()}getNamedQuery(n,l){return mi.resolve(this.kr.get(l))}saveNamedQuery(n,l){return this.kr.set(l.name,(function(w){return{name:w.name,query:L4(w.bundledQuery),readTime:af(w.readTime)}})(l)),mi.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(){this.overlays=new co(En.comparator),this.qr=new Map}getOverlay(n,l){return mi.resolve(this.overlays.get(l))}getOverlays(n,l){const m=Vg();return mi.forEach(l,(w=>this.getOverlay(n,w).next((C=>{C!==null&&m.set(w,C)})))).next((()=>m))}saveOverlays(n,l,m){return m.forEach(((w,C)=>{this.St(n,l,C)})),mi.resolve()}removeOverlaysForBatchId(n,l,m){const w=this.qr.get(m);return w!==void 0&&(w.forEach((C=>this.overlays=this.overlays.remove(C))),this.qr.delete(m)),mi.resolve()}getOverlaysForCollection(n,l,m){const w=Vg(),C=l.length+1,D=new En(l.child("")),s=this.overlays.getIteratorFrom(D);for(;s.hasNext();){const G=s.getNext().value,q=G.getKey();if(!l.isPrefixOf(q.path))break;q.path.length===C&&G.largestBatchId>m&&w.set(G.getKey(),G)}return mi.resolve(w)}getOverlaysForCollectionGroup(n,l,m,w){let C=new co(((q,te)=>q-te));const D=this.overlays.getIterator();for(;D.hasNext();){const q=D.getNext().value;if(q.getKey().getCollectionGroup()===l&&q.largestBatchId>m){let te=C.get(q.largestBatchId);te===null&&(te=Vg(),C=C.insert(q.largestBatchId,te)),te.set(q.getKey(),q)}}const s=Vg(),G=C.getIterator();for(;G.hasNext()&&(G.getNext().value.forEach(((q,te)=>s.set(q,te))),!(s.size()>=w)););return mi.resolve(s)}St(n,l,m){const w=this.overlays.get(m.key);if(w!==null){const D=this.qr.get(w.largestBatchId).delete(m.key);this.qr.set(w.largestBatchId,D)}this.overlays=this.overlays.insert(m.key,new u4(l,m));let C=this.qr.get(l);C===void 0&&(C=Fr(),this.qr.set(l,C)),this.qr.set(l,C.add(m.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(){this.sessionToken=Za.EMPTY_BYTE_STRING}getSessionToken(n){return mi.resolve(this.sessionToken)}setSessionToken(n,l){return this.sessionToken=l,mi.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(){this.Qr=new ma(Ca.$r),this.Ur=new ma(Ca.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(n,l){const m=new Ca(n,l);this.Qr=this.Qr.add(m),this.Ur=this.Ur.add(m)}Wr(n,l){n.forEach((m=>this.addReference(m,l)))}removeReference(n,l){this.Gr(new Ca(n,l))}zr(n,l){n.forEach((m=>this.removeReference(m,l)))}jr(n){const l=new En(new Rs([])),m=new Ca(l,n),w=new Ca(l,n+1),C=[];return this.Ur.forEachInRange([m,w],(D=>{this.Gr(D),C.push(D.key)})),C}Jr(){this.Qr.forEach((n=>this.Gr(n)))}Gr(n){this.Qr=this.Qr.delete(n),this.Ur=this.Ur.delete(n)}Hr(n){const l=new En(new Rs([])),m=new Ca(l,n),w=new Ca(l,n+1);let C=Fr();return this.Ur.forEachInRange([m,w],(D=>{C=C.add(D.key)})),C}containsKey(n){const l=new Ca(n,0),m=this.Qr.firstAfterOrEqual(l);return m!==null&&n.isEqual(m.key)}}class Ca{constructor(n,l){this.key=n,this.Yr=l}static $r(n,l){return En.comparator(n.key,l.key)||Nr(n.Yr,l.Yr)}static Kr(n,l){return Nr(n.Yr,l.Yr)||En.comparator(n.key,l.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(n,l){this.indexManager=n,this.referenceDelegate=l,this.mutationQueue=[],this.tr=1,this.Zr=new ma(Ca.$r)}checkEmpty(n){return mi.resolve(this.mutationQueue.length===0)}addMutationBatch(n,l,m,w){const C=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const D=new c4(C,l,m,w);this.mutationQueue.push(D);for(const s of w)this.Zr=this.Zr.add(new Ca(s.key,C)),this.indexManager.addToCollectionParentIndex(n,s.key.path.popLast());return mi.resolve(D)}lookupMutationBatch(n,l){return mi.resolve(this.Xr(l))}getNextMutationBatchAfterBatchId(n,l){const m=l+1,w=this.ei(m),C=w<0?0:w;return mi.resolve(this.mutationQueue.length>C?this.mutationQueue[C]:null)}getHighestUnacknowledgedBatchId(){return mi.resolve(this.mutationQueue.length===0?QT:this.tr-1)}getAllMutationBatches(n){return mi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,l){const m=new Ca(l,0),w=new Ca(l,Number.POSITIVE_INFINITY),C=[];return this.Zr.forEachInRange([m,w],(D=>{const s=this.Xr(D.Yr);C.push(s)})),mi.resolve(C)}getAllMutationBatchesAffectingDocumentKeys(n,l){let m=new ma(Nr);return l.forEach((w=>{const C=new Ca(w,0),D=new Ca(w,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([C,D],(s=>{m=m.add(s.Yr)}))})),mi.resolve(this.ti(m))}getAllMutationBatchesAffectingQuery(n,l){const m=l.path,w=m.length+1;let C=m;En.isDocumentKey(C)||(C=C.child(""));const D=new Ca(new En(C),0);let s=new ma(Nr);return this.Zr.forEachWhile((G=>{const q=G.key.path;return!!m.isPrefixOf(q)&&(q.length===w&&(s=s.add(G.Yr)),!0)}),D),mi.resolve(this.ti(s))}ti(n){const l=[];return n.forEach((m=>{const w=this.Xr(m);w!==null&&l.push(w)})),l}removeMutationBatch(n,l){hs(this.ni(l.batchId,"removed")===0,55003),this.mutationQueue.shift();let m=this.Zr;return mi.forEach(l.mutations,(w=>{const C=new Ca(w.key,l.batchId);return m=m.delete(C),this.referenceDelegate.markPotentiallyOrphaned(n,w.key)})).next((()=>{this.Zr=m}))}ir(n){}containsKey(n,l){const m=new Ca(l,0),w=this.Zr.firstAfterOrEqual(m);return mi.resolve(l.isEqual(w&&w.key))}performConsistencyCheck(n){return this.mutationQueue.length,mi.resolve()}ni(n,l){return this.ei(n)}ei(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}Xr(n){const l=this.ei(n);return l<0||l>=this.mutationQueue.length?null:this.mutationQueue[l]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(n){this.ri=n,this.docs=(function(){return new co(En.comparator)})(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,l){const m=l.key,w=this.docs.get(m),C=w?w.size:0,D=this.ri(l);return this.docs=this.docs.insert(m,{document:l.mutableCopy(),size:D}),this.size+=D-C,this.indexManager.addToCollectionParentIndex(n,m.path.popLast())}removeEntry(n){const l=this.docs.get(n);l&&(this.docs=this.docs.remove(n),this.size-=l.size)}getEntry(n,l){const m=this.docs.get(l);return mi.resolve(m?m.document.mutableCopy():Sl.newInvalidDocument(l))}getEntries(n,l){let m=op();return l.forEach((w=>{const C=this.docs.get(w);m=m.insert(w,C?C.document.mutableCopy():Sl.newInvalidDocument(w))})),mi.resolve(m)}getDocumentsMatchingQuery(n,l,m,w){let C=op();const D=l.path,s=new En(D.child("__id-9223372036854775808__")),G=this.docs.getIteratorFrom(s);for(;G.hasNext();){const{key:q,value:{document:te}}=G.getNext();if(!D.isPrefixOf(q.path))break;q.path.length>D.length+1||TB(wB(te),m)<=0||(w.has(te.key)||Jb(l,te))&&(C=C.insert(te.key,te.mutableCopy()))}return mi.resolve(C)}getAllFromCollectionGroup(n,l,m,w){Bn(9500)}ii(n,l){return mi.forEach(this.docs,(m=>l(m)))}newChangeBuffer(n){return new Y4(this)}getSize(n){return mi.resolve(this.size)}}class Y4 extends j4{constructor(n){super(),this.Nr=n}applyChanges(n){const l=[];return this.changes.forEach(((m,w)=>{w.isValidDocument()?l.push(this.Nr.addEntry(n,w)):this.Nr.removeEntry(m)})),mi.waitFor(l)}getFromCache(n,l){return this.Nr.getEntry(n,l)}getAllFromCache(n,l){return this.Nr.getEntries(n,l)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(n){this.persistence=n,this.si=new Jg((l=>eE(l)),tE),this.lastRemoteSnapshotVersion=Qn.min(),this.highestTargetId=0,this.oi=0,this._i=new lE,this.targetCount=0,this.ai=Ey.ur()}forEachTarget(n,l){return this.si.forEach(((m,w)=>l(w))),mi.resolve()}getLastRemoteSnapshotVersion(n){return mi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return mi.resolve(this.oi)}allocateTargetId(n){return this.highestTargetId=this.ai.next(),mi.resolve(this.highestTargetId)}setTargetsMetadata(n,l,m){return m&&(this.lastRemoteSnapshotVersion=m),l>this.oi&&(this.oi=l),mi.resolve()}Pr(n){this.si.set(n.target,n);const l=n.targetId;l>this.highestTargetId&&(this.ai=new Ey(l),this.highestTargetId=l),n.sequenceNumber>this.oi&&(this.oi=n.sequenceNumber)}addTargetData(n,l){return this.Pr(l),this.targetCount+=1,mi.resolve()}updateTargetData(n,l){return this.Pr(l),mi.resolve()}removeTargetData(n,l){return this.si.delete(l.target),this._i.jr(l.targetId),this.targetCount-=1,mi.resolve()}removeTargets(n,l,m){let w=0;const C=[];return this.si.forEach(((D,s)=>{s.sequenceNumber<=l&&m.get(s.targetId)===null&&(this.si.delete(D),C.push(this.removeMatchingKeysForTargetId(n,s.targetId)),w++)})),mi.waitFor(C).next((()=>w))}getTargetCount(n){return mi.resolve(this.targetCount)}getTargetData(n,l){const m=this.si.get(l)||null;return mi.resolve(m)}addMatchingKeys(n,l,m){return this._i.Wr(l,m),mi.resolve()}removeMatchingKeys(n,l,m){this._i.zr(l,m);const w=this.persistence.referenceDelegate,C=[];return w&&l.forEach((D=>{C.push(w.markPotentiallyOrphaned(n,D))})),mi.waitFor(C)}removeMatchingKeysForTargetId(n,l){return this._i.jr(l),mi.resolve()}getMatchingKeysForTargetId(n,l){const m=this._i.Hr(l);return mi.resolve(m)}containsKey(n,l){return mi.resolve(this._i.containsKey(l))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(n,l){this.ui={},this.overlays={},this.ci=new $b(0),this.li=!1,this.li=!0,this.hi=new $4,this.referenceDelegate=n(this),this.Pi=new K4(this),this.indexManager=new z4,this.remoteDocumentCache=(function(w){return new X4(w)})((m=>this.referenceDelegate.Ti(m))),this.serializer=new O4(l),this.Ii=new H4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let l=this.overlays[n.toKey()];return l||(l=new W4,this.overlays[n.toKey()]=l),l}getMutationQueue(n,l){let m=this.ui[n.toKey()];return m||(m=new Z4(l,this.referenceDelegate),this.ui[n.toKey()]=m),m}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(n,l,m){nn("MemoryPersistence","Starting transaction:",n);const w=new Q4(this.ci.next());return this.referenceDelegate.Ei(),m(w).next((C=>this.referenceDelegate.di(w).next((()=>C)))).toPromise().then((C=>(w.raiseOnCommittedEvent(),C)))}Ai(n,l){return mi.or(Object.values(this.ui).map((m=>()=>m.containsKey(n,l))))}}class Q4 extends SB{constructor(n){super(),this.currentSequenceNumber=n}}class cE{constructor(n){this.persistence=n,this.Ri=new lE,this.Vi=null}static mi(n){return new cE(n)}get fi(){if(this.Vi)return this.Vi;throw Bn(60996)}addReference(n,l,m){return this.Ri.addReference(m,l),this.fi.delete(m.toString()),mi.resolve()}removeReference(n,l,m){return this.Ri.removeReference(m,l),this.fi.add(m.toString()),mi.resolve()}markPotentiallyOrphaned(n,l){return this.fi.add(l.toString()),mi.resolve()}removeTarget(n,l){this.Ri.jr(l.targetId).forEach((w=>this.fi.add(w.toString())));const m=this.persistence.getTargetCache();return m.getMatchingKeysForTargetId(n,l.targetId).next((w=>{w.forEach((C=>this.fi.add(C.toString())))})).next((()=>m.removeTargetData(n,l)))}Ei(){this.Vi=new Set}di(n){const l=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mi.forEach(this.fi,(m=>{const w=En.fromPath(m);return this.gi(n,w).next((C=>{C||l.removeEntry(w,Qn.min())}))})).next((()=>(this.Vi=null,l.apply(n))))}updateLimboDocument(n,l){return this.gi(n,l).next((m=>{m?this.fi.delete(l.toString()):this.fi.add(l.toString())}))}Ti(n){return 0}gi(n,l){return mi.or([()=>mi.resolve(this.Ri.containsKey(l)),()=>this.persistence.getTargetCache().containsKey(n,l),()=>this.persistence.Ai(n,l)])}}class Rb{constructor(n,l){this.persistence=n,this.pi=new Jg((m=>CB(m.path)),((m,w)=>m.isEqual(w))),this.garbageCollector=U4(this,l)}static mi(n,l){return new Rb(n,l)}Ei(){}di(n){return mi.resolve()}forEachTarget(n,l){return this.persistence.getTargetCache().forEachTarget(n,l)}gr(n){const l=this.wr(n);return this.persistence.getTargetCache().getTargetCount(n).next((m=>l.next((w=>m+w))))}wr(n){let l=0;return this.pr(n,(m=>{l++})).next((()=>l))}pr(n,l){return mi.forEach(this.pi,((m,w)=>this.br(n,m,w).next((C=>C?mi.resolve():l(w)))))}removeTargets(n,l,m){return this.persistence.getTargetCache().removeTargets(n,l,m)}removeOrphanedDocuments(n,l){let m=0;const w=this.persistence.getRemoteDocumentCache(),C=w.newChangeBuffer();return w.ii(n,(D=>this.br(n,D,l).next((s=>{s||(m++,C.removeEntry(D,Qn.min()))})))).next((()=>C.apply(n))).next((()=>m))}markPotentiallyOrphaned(n,l){return this.pi.set(l,n.currentSequenceNumber),mi.resolve()}removeTarget(n,l){const m=l.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,m)}addReference(n,l,m){return this.pi.set(m,n.currentSequenceNumber),mi.resolve()}removeReference(n,l,m){return this.pi.set(m,n.currentSequenceNumber),mi.resolve()}updateLimboDocument(n,l){return this.pi.set(l,n.currentSequenceNumber),mi.resolve()}Ti(n){let l=n.key.toString().length;return n.isFoundDocument()&&(l+=ob(n.data.value)),l}br(n,l,m){return mi.or([()=>this.persistence.Ai(n,l),()=>this.persistence.getTargetCache().containsKey(n,l),()=>{const w=this.pi.get(l);return mi.resolve(w!==void 0&&w>m)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(n,l,m,w){this.targetId=n,this.fromCache=l,this.Es=m,this.ds=w}static As(n,l){let m=Fr(),w=Fr();for(const C of l.docChanges)switch(C.type){case 0:m=m.add(C.doc.key);break;case 1:w=w.add(C.doc.key)}return new uE(n,l.fromCache,m,w)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Sk()?8:AB(Al())>0?6:4})()}initialize(n,l){this.ps=n,this.indexManager=l,this.Rs=!0}getDocumentsMatchingQuery(n,l,m,w){const C={result:null};return this.ys(n,l).next((D=>{C.result=D})).next((()=>{if(!C.result)return this.ws(n,l,w,m).next((D=>{C.result=D}))})).next((()=>{if(C.result)return;const D=new J4;return this.Ss(n,l,D).next((s=>{if(C.result=s,this.Vs)return this.bs(n,l,D,s.size)}))})).next((()=>C.result))}bs(n,l,m,w){return m.documentReadCount<this.fs?(ay()<=kr.DEBUG&&nn("QueryEngine","SDK will not create cache indexes for query:",ly(l),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),mi.resolve()):(ay()<=kr.DEBUG&&nn("QueryEngine","Query:",ly(l),"scans",m.documentReadCount,"local documents and returns",w,"documents as results."),m.documentReadCount>this.gs*w?(ay()<=kr.DEBUG&&nn("QueryEngine","The SDK decides to create cache indexes for query:",ly(l),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,of(l))):mi.resolve())}ys(n,l){if(AI(l))return mi.resolve(null);let m=of(l);return this.indexManager.getIndexType(n,m).next((w=>w===0?null:(l.limit!==null&&w===1&&(l=Ab(l,null,"F"),m=of(l)),this.indexManager.getDocumentsMatchingTarget(n,m).next((C=>{const D=Fr(...C);return this.ps.getDocuments(n,D).next((s=>this.indexManager.getMinOffset(n,m).next((G=>{const q=this.Ds(l,s);return this.Cs(l,q,D,G.readTime)?this.ys(n,Ab(l,null,"F")):this.vs(n,q,l,G)}))))})))))}ws(n,l,m,w){return AI(l)||w.isEqual(Qn.min())?mi.resolve(null):this.ps.getDocuments(n,m).next((C=>{const D=this.Ds(l,C);return this.Cs(l,D,m,w)?mi.resolve(null):(ay()<=kr.DEBUG&&nn("QueryEngine","Re-using previous result from %s to execute query: %s",w.toString(),ly(l)),this.vs(n,D,l,bB(w,cx)).next((s=>s)))}))}Ds(n,l){let m=new ma(lM(n));return l.forEach(((w,C)=>{Jb(n,C)&&(m=m.add(C))})),m}Cs(n,l,m,w){if(n.limit===null)return!1;if(m.size!==l.size)return!0;const C=n.limitType==="F"?l.last():l.first();return!!C&&(C.hasPendingWrites||C.version.compareTo(w)>0)}Ss(n,l,m){return ay()<=kr.DEBUG&&nn("QueryEngine","Using full collection scan to execute query:",ly(l)),this.ps.getDocumentsMatchingQuery(n,l,Tm.min(),m)}vs(n,l,m,w){return this.ps.getDocumentsMatchingQuery(n,m,w).next((C=>(l.forEach((D=>{C=C.insert(D.key,D)})),C)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hE="LocalStore",t5=3e8;class i5{constructor(n,l,m,w){this.persistence=n,this.Fs=l,this.serializer=w,this.Ms=new co(Nr),this.xs=new Jg((C=>eE(C)),tE),this.Os=new Map,this.Ns=n.getRemoteDocumentCache(),this.Pi=n.getTargetCache(),this.Ii=n.getBundleCache(),this.Bs(m)}Bs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new q4(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(l=>n.collect(l,this.Ms)))}}function n5(u,n,l,m){return new i5(u,n,l,m)}async function PM(u,n){const l=nr(u);return await l.persistence.runTransaction("Handle user change","readonly",(m=>{let w;return l.mutationQueue.getAllMutationBatches(m).next((C=>(w=C,l.Bs(n),l.mutationQueue.getAllMutationBatches(m)))).next((C=>{const D=[],s=[];let G=Fr();for(const q of w){D.push(q.batchId);for(const te of q.mutations)G=G.add(te.key)}for(const q of C){s.push(q.batchId);for(const te of q.mutations)G=G.add(te.key)}return l.localDocuments.getDocuments(m,G).next((q=>({Ls:q,removedBatchIds:D,addedBatchIds:s})))}))}))}function r5(u,n){const l=nr(u);return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",(m=>{const w=n.batch.keys(),C=l.Ns.newChangeBuffer({trackRemovals:!0});return(function(s,G,q,te){const ce=q.batch,we=ce.keys();let ze=mi.resolve();return we.forEach((at=>{ze=ze.next((()=>te.getEntry(G,at))).next((Ge=>{const Qe=q.docVersions.get(at);hs(Qe!==null,48541),Ge.version.compareTo(Qe)<0&&(ce.applyToRemoteDocument(Ge,q),Ge.isValidDocument()&&(Ge.setReadTime(q.commitVersion),te.addEntry(Ge)))}))})),ze.next((()=>s.mutationQueue.removeMutationBatch(G,ce)))})(l,m,n,C).next((()=>C.apply(m))).next((()=>l.mutationQueue.performConsistencyCheck(m))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(m,w,n.batch.batchId))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,(function(s){let G=Fr();for(let q=0;q<s.mutationResults.length;++q)s.mutationResults[q].transformResults.length>0&&(G=G.add(s.batch.mutations[q].key));return G})(n)))).next((()=>l.localDocuments.getDocuments(m,w)))}))}function DM(u){const n=nr(u);return n.persistence.runTransaction("Get last remote snapshot version","readonly",(l=>n.Pi.getLastRemoteSnapshotVersion(l)))}function s5(u,n){const l=nr(u),m=n.snapshotVersion;let w=l.Ms;return l.persistence.runTransaction("Apply remote event","readwrite-primary",(C=>{const D=l.Ns.newChangeBuffer({trackRemovals:!0});w=l.Ms;const s=[];n.targetChanges.forEach(((te,ce)=>{const we=w.get(ce);if(!we)return;s.push(l.Pi.removeMatchingKeys(C,te.removedDocuments,ce).next((()=>l.Pi.addMatchingKeys(C,te.addedDocuments,ce))));let ze=we.withSequenceNumber(C.currentSequenceNumber);n.targetMismatches.get(ce)!==null?ze=ze.withResumeToken(Za.EMPTY_BYTE_STRING,Qn.min()).withLastLimboFreeSnapshotVersion(Qn.min()):te.resumeToken.approximateByteSize()>0&&(ze=ze.withResumeToken(te.resumeToken,m)),w=w.insert(ce,ze),(function(Ge,Qe,xt){return Ge.resumeToken.approximateByteSize()===0||Qe.snapshotVersion.toMicroseconds()-Ge.snapshotVersion.toMicroseconds()>=t5?!0:xt.addedDocuments.size+xt.modifiedDocuments.size+xt.removedDocuments.size>0})(we,ze,te)&&s.push(l.Pi.updateTargetData(C,ze))}));let G=op(),q=Fr();if(n.documentUpdates.forEach((te=>{n.resolvedLimboDocuments.has(te)&&s.push(l.persistence.referenceDelegate.updateLimboDocument(C,te))})),s.push(o5(C,D,n.documentUpdates).next((te=>{G=te.ks,q=te.qs}))),!m.isEqual(Qn.min())){const te=l.Pi.getLastRemoteSnapshotVersion(C).next((ce=>l.Pi.setTargetsMetadata(C,C.currentSequenceNumber,m)));s.push(te)}return mi.waitFor(s).next((()=>D.apply(C))).next((()=>l.localDocuments.getLocalViewOfDocuments(C,G,q))).next((()=>G))})).then((C=>(l.Ms=w,C)))}function o5(u,n,l){let m=Fr(),w=Fr();return l.forEach((C=>m=m.add(C))),n.getEntries(u,m).next((C=>{let D=op();return l.forEach(((s,G)=>{const q=C.get(s);G.isFoundDocument()!==q.isFoundDocument()&&(w=w.add(s)),G.isNoDocument()&&G.version.isEqual(Qn.min())?(n.removeEntry(s,G.readTime),D=D.insert(s,G)):!q.isValidDocument()||G.version.compareTo(q.version)>0||G.version.compareTo(q.version)===0&&q.hasPendingWrites?(n.addEntry(G),D=D.insert(s,G)):nn(hE,"Ignoring outdated watch update for ",s,". Current version:",q.version," Watch version:",G.version)})),{ks:D,qs:w}}))}function a5(u,n){const l=nr(u);return l.persistence.runTransaction("Get next mutation batch","readonly",(m=>(n===void 0&&(n=QT),l.mutationQueue.getNextMutationBatchAfterBatchId(m,n))))}function l5(u,n){const l=nr(u);return l.persistence.runTransaction("Allocate target","readwrite",(m=>{let w;return l.Pi.getTargetData(m,n).next((C=>C?(w=C,mi.resolve(w)):l.Pi.allocateTargetId(m).next((D=>(w=new _m(n,D,"TargetPurposeListen",m.currentSequenceNumber),l.Pi.addTargetData(m,w).next((()=>w)))))))})).then((m=>{const w=l.Ms.get(m.targetId);return(w===null||m.snapshotVersion.compareTo(w.snapshotVersion)>0)&&(l.Ms=l.Ms.insert(m.targetId,m),l.xs.set(n,m.targetId)),m}))}async function _T(u,n,l){const m=nr(u),w=m.Ms.get(n),C=l?"readwrite":"readwrite-primary";try{l||await m.persistence.runTransaction("Release target",C,(D=>m.persistence.referenceDelegate.removeTarget(D,w)))}catch(D){if(!Oy(D))throw D;nn(hE,`Failed to update sequence numbers for target ${n}: ${D}`)}m.Ms=m.Ms.remove(n),m.xs.delete(w.target)}function BI(u,n,l){const m=nr(u);let w=Qn.min(),C=Fr();return m.persistence.runTransaction("Execute query","readwrite",(D=>(function(G,q,te){const ce=nr(G),we=ce.xs.get(te);return we!==void 0?mi.resolve(ce.Ms.get(we)):ce.Pi.getTargetData(q,te)})(m,D,of(n)).next((s=>{if(s)return w=s.lastLimboFreeSnapshotVersion,m.Pi.getMatchingKeysForTargetId(D,s.targetId).next((G=>{C=G}))})).next((()=>m.Fs.getDocumentsMatchingQuery(D,n,l?w:Qn.min(),l?C:Fr()))).next((s=>(c5(m,$B(n),s),{documents:s,Qs:C})))))}function c5(u,n,l){let m=u.Os.get(n)||Qn.min();l.forEach(((w,C)=>{C.readTime.compareTo(m)>0&&(m=C.readTime)})),u.Os.set(n,m)}class VI{constructor(){this.activeTargetIds=JB()}zs(n){this.activeTargetIds=this.activeTargetIds.add(n)}js(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Gs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class u5{constructor(){this.Mo=new VI,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,l,m){}addLocalQueryTarget(n,l=!0){return l&&this.Mo.zs(n),this.xo[n]||"not-current"}updateQueryState(n,l,m){this.xo[n]=l}removeLocalQueryTarget(n){this.Mo.js(n)}isLocalQueryTarget(n){return this.Mo.activeTargetIds.has(n)}clearQueryState(n){delete this.xo[n]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(n){return this.Mo.activeTargetIds.has(n)}start(){return this.Mo=new VI,Promise.resolve()}handleUserChange(n,l,m){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{Oo(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UI="ConnectivityMonitor";class jI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(n){this.qo.push(n)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){nn(UI,"Network connectivity changed: AVAILABLE");for(const n of this.qo)n(0)}ko(){nn(UI,"Network connectivity changed: UNAVAILABLE");for(const n of this.qo)n(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let X0=null;function yT(){return X0===null?X0=(function(){return 268435456+Math.round(2147483648*Math.random())})():X0++,"0x"+X0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uw="RestConnection",d5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class f5{get $o(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const l=n.ssl?"https":"http",m=encodeURIComponent(this.databaseId.projectId),w=encodeURIComponent(this.databaseId.database);this.Uo=l+"://"+n.host,this.Ko=`projects/${m}/databases/${w}`,this.Wo=this.databaseId.database===Tb?`project_id=${m}`:`project_id=${m}&database_id=${w}`}Go(n,l,m,w,C){const D=yT(),s=this.zo(n,l.toUriEncodedString());nn(Uw,`Sending RPC '${n}' ${D}:`,s,m);const G={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(G,w,C);const{host:q}=new URL(s),te=Pm(q);return this.Jo(n,s,G,m,te).then((ce=>(nn(Uw,`Received RPC '${n}' ${D}: `,ce),ce)),(ce=>{throw vy(Uw,`RPC '${n}' ${D} failed with error: `,ce,"url: ",s,"request:",m),ce}))}Ho(n,l,m,w,C,D){return this.Go(n,l,m,w,C)}jo(n,l,m){n["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Py})(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),l&&l.headers.forEach(((w,C)=>n[C]=w)),m&&m.headers.forEach(((w,C)=>n[C]=w))}zo(n,l){const m=d5[n];return`${this.Uo}/v1/${l}:${m}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(n){this.Yo=n.Yo,this.Zo=n.Zo}Xo(n){this.e_=n}t_(n){this.n_=n}r_(n){this.i_=n}onMessage(n){this.s_=n}close(){this.Zo()}send(n){this.Yo(n)}o_(){this.e_()}__(){this.n_()}a_(n){this.i_(n)}u_(n){this.s_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl="WebChannelConnection";class m5 extends f5{constructor(n){super(n),this.c_=[],this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Jo(n,l,m,w,C){const D=yT();return new Promise(((s,G)=>{const q=new kR;q.setWithCredentials(!0),q.listenOnce(NR.COMPLETE,(()=>{try{switch(q.getLastErrorCode()){case sb.NO_ERROR:const ce=q.getResponseJson();nn(Tl,`XHR for RPC '${n}' ${D} received:`,JSON.stringify(ce)),s(ce);break;case sb.TIMEOUT:nn(Tl,`RPC '${n}' ${D} timed out`),G(new Ui(ti.DEADLINE_EXCEEDED,"Request time out"));break;case sb.HTTP_ERROR:const we=q.getStatus();if(nn(Tl,`RPC '${n}' ${D} failed with status:`,we,"response text:",q.getResponseText()),we>0){let ze=q.getResponseJson();Array.isArray(ze)&&(ze=ze[0]);const at=ze?.error;if(at&&at.status&&at.message){const Ge=(function(xt){const wt=xt.toLowerCase().replace(/_/g,"-");return Object.values(ti).indexOf(wt)>=0?wt:ti.UNKNOWN})(at.status);G(new Ui(Ge,at.message))}else G(new Ui(ti.UNKNOWN,"Server responded with status "+q.getStatus()))}else G(new Ui(ti.UNAVAILABLE,"Connection failed."));break;default:Bn(9055,{l_:n,streamId:D,h_:q.getLastErrorCode(),P_:q.getLastError()})}}finally{nn(Tl,`RPC '${n}' ${D} completed.`)}}));const te=JSON.stringify(w);nn(Tl,`RPC '${n}' ${D} sending request:`,w),q.send(l,"POST",te,m,15)}))}T_(n,l,m){const w=yT(),C=[this.Uo,"/","google.firestore.v1.Firestore","/",n,"/channel"],D=VR(),s=BR(),G={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},q=this.longPollingOptions.timeoutSeconds;q!==void 0&&(G.longPollingTimeout=Math.round(1e3*q)),this.useFetchStreams&&(G.useFetchStreams=!0),this.jo(G.initMessageHeaders,l,m),G.encodeInitMessageHeaders=!0;const te=C.join("");nn(Tl,`Creating RPC '${n}' stream ${w}: ${te}`,G);const ce=D.createWebChannel(te,G);this.I_(ce);let we=!1,ze=!1;const at=new p5({Yo:Qe=>{ze?nn(Tl,`Not sending because RPC '${n}' stream ${w} is closed:`,Qe):(we||(nn(Tl,`Opening RPC '${n}' stream ${w} transport.`),ce.open(),we=!0),nn(Tl,`RPC '${n}' stream ${w} sending:`,Qe),ce.send(Qe))},Zo:()=>ce.close()}),Ge=(Qe,xt,wt)=>{Qe.listen(xt,(jt=>{try{wt(jt)}catch(wi){setTimeout((()=>{throw wi}),0)}}))};return Ge(ce,$v.EventType.OPEN,(()=>{ze||(nn(Tl,`RPC '${n}' stream ${w} transport opened.`),at.o_())})),Ge(ce,$v.EventType.CLOSE,(()=>{ze||(ze=!0,nn(Tl,`RPC '${n}' stream ${w} transport closed`),at.a_(),this.E_(ce))})),Ge(ce,$v.EventType.ERROR,(Qe=>{ze||(ze=!0,vy(Tl,`RPC '${n}' stream ${w} transport errored. Name:`,Qe.name,"Message:",Qe.message),at.a_(new Ui(ti.UNAVAILABLE,"The operation could not be completed")))})),Ge(ce,$v.EventType.MESSAGE,(Qe=>{if(!ze){const xt=Qe.data[0];hs(!!xt,16349);const wt=xt,jt=wt?.error||wt[0]?.error;if(jt){nn(Tl,`RPC '${n}' stream ${w} received error:`,jt);const wi=jt.status;let Ai=(function(ke){const We=Xo[ke];if(We!==void 0)return vM(We)})(wi),vi=jt.message;Ai===void 0&&(Ai=ti.INTERNAL,vi="Unknown error status: "+wi+" with message "+jt.message),ze=!0,at.a_(new Ui(Ai,vi)),ce.close()}else nn(Tl,`RPC '${n}' stream ${w} received:`,xt),at.u_(xt)}})),Ge(s,FR.STAT_EVENT,(Qe=>{Qe.stat===oT.PROXY?nn(Tl,`RPC '${n}' stream ${w} detected buffering proxy`):Qe.stat===oT.NOPROXY&&nn(Tl,`RPC '${n}' stream ${w} detected no buffering proxy`)})),setTimeout((()=>{at.__()}),0),at}terminate(){this.c_.forEach((n=>n.close())),this.c_=[]}I_(n){this.c_.push(n)}E_(n){this.c_=this.c_.filter((l=>l===n))}}function jw(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n1(u){return new v4(u,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OM{constructor(n,l,m=1e3,w=1.5,C=6e4){this.Mi=n,this.timerId=l,this.d_=m,this.A_=w,this.R_=C,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(n){this.cancel();const l=Math.floor(this.V_+this.y_()),m=Math.max(0,Date.now()-this.f_),w=Math.max(0,l-m);w>0&&nn("ExponentialBackoff",`Backing off for ${w} ms (base delay: ${this.V_} ms, delay with jitter: ${l} ms, last attempt: ${m} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,w,(()=>(this.f_=Date.now(),n()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GI="PersistentStream";class LM{constructor(n,l,m,w,C,D,s,G){this.Mi=n,this.S_=m,this.b_=w,this.connection=C,this.authCredentialsProvider=D,this.appCheckCredentialsProvider=s,this.listener=G,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new OM(n,l)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(n){this.Q_(),this.stream.send(n)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(n,l){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,n!==4?this.M_.reset():l&&l.code===ti.RESOURCE_EXHAUSTED?(sp(l.toString()),sp("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):l&&l.code===ti.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.r_(l)}K_(){}auth(){this.state=1;const n=this.W_(this.D_),l=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([m,w])=>{this.D_===l&&this.G_(m,w)}),(m=>{n((()=>{const w=new Ui(ti.UNKNOWN,"Fetching auth token failed: "+m.message);return this.z_(w)}))}))}G_(n,l){const m=this.W_(this.D_);this.stream=this.j_(n,l),this.stream.Xo((()=>{m((()=>this.listener.Xo()))})),this.stream.t_((()=>{m((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((w=>{m((()=>this.z_(w)))})),this.stream.onMessage((w=>{m((()=>++this.F_==1?this.J_(w):this.onNext(w)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(n){return nn(GI,`close with error: ${n}`),this.stream=null,this.close(4,n)}W_(n){return l=>{this.Mi.enqueueAndForget((()=>this.D_===n?l():(nn(GI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class g5 extends LM{constructor(n,l,m,w,C,D){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",l,m,w,D),this.serializer=C}j_(n,l){return this.connection.T_("Listen",n,l)}J_(n){return this.onNext(n)}onNext(n){this.M_.reset();const l=w4(this.serializer,n),m=(function(C){if(!("targetChange"in C))return Qn.min();const D=C.targetChange;return D.targetIds&&D.targetIds.length?Qn.min():D.readTime?af(D.readTime):Qn.min()})(n);return this.listener.H_(l,m)}Y_(n){const l={};l.database=gT(this.serializer),l.addTarget=(function(C,D){let s;const G=D.target;if(s=hT(G)?{documents:S4(C,G)}:{query:A4(C,G).ft},s.targetId=D.targetId,D.resumeToken.approximateByteSize()>0){s.resumeToken=wM(C,D.resumeToken);const q=fT(C,D.expectedCount);q!==null&&(s.expectedCount=q)}else if(D.snapshotVersion.compareTo(Qn.min())>0){s.readTime=Cb(C,D.snapshotVersion.toTimestamp());const q=fT(C,D.expectedCount);q!==null&&(s.expectedCount=q)}return s})(this.serializer,n);const m=C4(this.serializer,n);m&&(l.labels=m),this.q_(l)}Z_(n){const l={};l.database=gT(this.serializer),l.removeTarget=n,this.q_(l)}}class _5 extends LM{constructor(n,l,m,w,C,D){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",l,m,w,D),this.serializer=C}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(n,l){return this.connection.T_("Write",n,l)}J_(n){return hs(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,hs(!n.writeResults||n.writeResults.length===0,55816),this.listener.ta()}onNext(n){hs(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.M_.reset();const l=E4(n.writeResults,n.commitTime),m=af(n.commitTime);return this.listener.na(m,l)}ra(){const n={};n.database=gT(this.serializer),this.q_(n)}ea(n){const l={streamToken:this.lastStreamToken,writes:n.map((m=>T4(this.serializer,m)))};this.q_(l)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{}class v5 extends y5{constructor(n,l,m,w){super(),this.authCredentials=n,this.appCheckCredentials=l,this.connection=m,this.serializer=w,this.ia=!1}sa(){if(this.ia)throw new Ui(ti.FAILED_PRECONDITION,"The client has already been terminated.")}Go(n,l,m,w){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([C,D])=>this.connection.Go(n,pT(l,m),w,C,D))).catch((C=>{throw C.name==="FirebaseError"?(C.code===ti.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),C):new Ui(ti.UNKNOWN,C.toString())}))}Ho(n,l,m,w,C){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([D,s])=>this.connection.Ho(n,pT(l,m),w,D,s,C))).catch((D=>{throw D.name==="FirebaseError"?(D.code===ti.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),D):new Ui(ti.UNKNOWN,D.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class x5{constructor(n,l){this.asyncQueue=n,this.onlineStateHandler=l,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(n){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.ca("Offline")))}set(n){this.Pa(),this.oa=0,n==="Online"&&(this.aa=!1),this.ca(n)}ca(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}la(n){const l=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(sp(l),this.aa=!1):nn("OnlineStateTracker",l)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yg="RemoteStore";class b5{constructor(n,l,m,w,C){this.localStore=n,this.datastore=l,this.asyncQueue=m,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=C,this.Aa.Oo((D=>{m.enqueueAndForget((async()=>{e_(this)&&(nn(Yg,"Restarting streams for network reachability change."),await(async function(G){const q=nr(G);q.Ea.add(4),await Mx(q),q.Ra.set("Unknown"),q.Ea.delete(4),await r1(q)})(this))}))})),this.Ra=new x5(m,w)}}async function r1(u){if(e_(u))for(const n of u.da)await n(!0)}async function Mx(u){for(const n of u.da)await n(!1)}function zM(u,n){const l=nr(u);l.Ia.has(n.targetId)||(l.Ia.set(n.targetId,n),mE(l)?pE(l):Ly(l).O_()&&fE(l,n))}function dE(u,n){const l=nr(u),m=Ly(l);l.Ia.delete(n),m.O_()&&kM(l,n),l.Ia.size===0&&(m.O_()?m.L_():e_(l)&&l.Ra.set("Unknown"))}function fE(u,n){if(u.Va.Ue(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(Qn.min())>0){const l=u.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(l)}Ly(u).Y_(n)}function kM(u,n){u.Va.Ue(n),Ly(u).Z_(n)}function pE(u){u.Va=new m4({getRemoteKeysForTarget:n=>u.remoteSyncer.getRemoteKeysForTarget(n),At:n=>u.Ia.get(n)||null,ht:()=>u.datastore.serializer.databaseId}),Ly(u).start(),u.Ra.ua()}function mE(u){return e_(u)&&!Ly(u).x_()&&u.Ia.size>0}function e_(u){return nr(u).Ea.size===0}function NM(u){u.Va=void 0}async function w5(u){u.Ra.set("Online")}async function T5(u){u.Ia.forEach(((n,l)=>{fE(u,n)}))}async function E5(u,n){NM(u),mE(u)?(u.Ra.ha(n),pE(u)):u.Ra.set("Unknown")}async function S5(u,n,l){if(u.Ra.set("Online"),n instanceof bM&&n.state===2&&n.cause)try{await(async function(w,C){const D=C.cause;for(const s of C.targetIds)w.Ia.has(s)&&(await w.remoteSyncer.rejectListen(s,D),w.Ia.delete(s),w.Va.removeTarget(s))})(u,n)}catch(m){nn(Yg,"Failed to remove targets %s: %s ",n.targetIds.join(","),m),await Mb(u,m)}else if(n instanceof cb?u.Va.Ze(n):n instanceof xM?u.Va.st(n):u.Va.tt(n),!l.isEqual(Qn.min()))try{const m=await DM(u.localStore);l.compareTo(m)>=0&&await(function(C,D){const s=C.Va.Tt(D);return s.targetChanges.forEach(((G,q)=>{if(G.resumeToken.approximateByteSize()>0){const te=C.Ia.get(q);te&&C.Ia.set(q,te.withResumeToken(G.resumeToken,D))}})),s.targetMismatches.forEach(((G,q)=>{const te=C.Ia.get(G);if(!te)return;C.Ia.set(G,te.withResumeToken(Za.EMPTY_BYTE_STRING,te.snapshotVersion)),kM(C,G);const ce=new _m(te.target,G,q,te.sequenceNumber);fE(C,ce)})),C.remoteSyncer.applyRemoteEvent(s)})(u,l)}catch(m){nn(Yg,"Failed to raise snapshot:",m),await Mb(u,m)}}async function Mb(u,n,l){if(!Oy(n))throw n;u.Ea.add(1),await Mx(u),u.Ra.set("Offline"),l||(l=()=>DM(u.localStore)),u.asyncQueue.enqueueRetryable((async()=>{nn(Yg,"Retrying IndexedDB access"),await l(),u.Ea.delete(1),await r1(u)}))}function FM(u,n){return n().catch((l=>Mb(u,l,n)))}async function s1(u){const n=nr(u),l=Im(n);let m=n.Ta.length>0?n.Ta[n.Ta.length-1].batchId:QT;for(;A5(n);)try{const w=await a5(n.localStore,m);if(w===null){n.Ta.length===0&&l.L_();break}m=w.batchId,I5(n,w)}catch(w){await Mb(n,w)}BM(n)&&VM(n)}function A5(u){return e_(u)&&u.Ta.length<10}function I5(u,n){u.Ta.push(n);const l=Im(u);l.O_()&&l.X_&&l.ea(n.mutations)}function BM(u){return e_(u)&&!Im(u).x_()&&u.Ta.length>0}function VM(u){Im(u).start()}async function C5(u){Im(u).ra()}async function R5(u){const n=Im(u);for(const l of u.Ta)n.ea(l.mutations)}async function M5(u,n,l){const m=u.Ta.shift(),w=sE.from(m,n,l);await FM(u,(()=>u.remoteSyncer.applySuccessfulWrite(w))),await s1(u)}async function P5(u,n){n&&Im(u).X_&&await(async function(m,w){if((function(D){return d4(D)&&D!==ti.ABORTED})(w.code)){const C=m.Ta.shift();Im(m).B_(),await FM(m,(()=>m.remoteSyncer.rejectFailedWrite(C.batchId,w))),await s1(m)}})(u,n),BM(u)&&VM(u)}async function qI(u,n){const l=nr(u);l.asyncQueue.verifyOperationInProgress(),nn(Yg,"RemoteStore received new credentials");const m=e_(l);l.Ea.add(3),await Mx(l),m&&l.Ra.set("Unknown"),await l.remoteSyncer.handleCredentialChange(n),l.Ea.delete(3),await r1(l)}async function D5(u,n){const l=nr(u);n?(l.Ea.delete(2),await r1(l)):n||(l.Ea.add(2),await Mx(l),l.Ra.set("Unknown"))}function Ly(u){return u.ma||(u.ma=(function(l,m,w){const C=nr(l);return C.sa(),new g5(m,C.connection,C.authCredentials,C.appCheckCredentials,C.serializer,w)})(u.datastore,u.asyncQueue,{Xo:w5.bind(null,u),t_:T5.bind(null,u),r_:E5.bind(null,u),H_:S5.bind(null,u)}),u.da.push((async n=>{n?(u.ma.B_(),mE(u)?pE(u):u.Ra.set("Unknown")):(await u.ma.stop(),NM(u))}))),u.ma}function Im(u){return u.fa||(u.fa=(function(l,m,w){const C=nr(l);return C.sa(),new _5(m,C.connection,C.authCredentials,C.appCheckCredentials,C.serializer,w)})(u.datastore,u.asyncQueue,{Xo:()=>Promise.resolve(),t_:C5.bind(null,u),r_:P5.bind(null,u),ta:R5.bind(null,u),na:M5.bind(null,u)}),u.da.push((async n=>{n?(u.fa.B_(),await s1(u)):(await u.fa.stop(),u.Ta.length>0&&(nn(Yg,`Stopping write stream with ${u.Ta.length} pending writes`),u.Ta=[]))}))),u.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(n,l,m,w,C){this.asyncQueue=n,this.timerId=l,this.targetTimeMs=m,this.op=w,this.removalCallback=C,this.deferred=new ep,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((D=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(n,l,m,w,C){const D=Date.now()+m,s=new gE(n,l,D,w,C);return s.start(m),s}start(n){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ui(ti.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((n=>this.deferred.resolve(n)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _E(u,n){if(sp("AsyncQueue",`${n}: ${u}`),Oy(u))return new Ui(ti.UNAVAILABLE,`${n}: ${u}`);throw u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{static emptySet(n){return new _y(n.comparator)}constructor(n){this.comparator=n?(l,m)=>n(l,m)||En.comparator(l.key,m.key):(l,m)=>En.comparator(l.key,m.key),this.keyedMap=Zv(),this.sortedSet=new co(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const l=this.keyedMap.get(n);return l?this.sortedSet.indexOf(l):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal(((l,m)=>(n(l),!1)))}add(n){const l=this.delete(n.key);return l.copy(l.keyedMap.insert(n.key,n),l.sortedSet.insert(n,null))}delete(n){const l=this.get(n);return l?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(l)):this}isEqual(n){if(!(n instanceof _y)||this.size!==n.size)return!1;const l=this.sortedSet.getIterator(),m=n.sortedSet.getIterator();for(;l.hasNext();){const w=l.getNext().key,C=m.getNext().key;if(!w.isEqual(C))return!1}return!0}toString(){const n=[];return this.forEach((l=>{n.push(l.toString())})),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,l){const m=new _y;return m.comparator=this.comparator,m.keyedMap=n,m.sortedSet=l,m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(){this.ga=new co(En.comparator)}track(n){const l=n.doc.key,m=this.ga.get(l);m?n.type!==0&&m.type===3?this.ga=this.ga.insert(l,n):n.type===3&&m.type!==1?this.ga=this.ga.insert(l,{type:m.type,doc:n.doc}):n.type===2&&m.type===2?this.ga=this.ga.insert(l,{type:2,doc:n.doc}):n.type===2&&m.type===0?this.ga=this.ga.insert(l,{type:0,doc:n.doc}):n.type===1&&m.type===0?this.ga=this.ga.remove(l):n.type===1&&m.type===2?this.ga=this.ga.insert(l,{type:1,doc:m.doc}):n.type===0&&m.type===1?this.ga=this.ga.insert(l,{type:2,doc:n.doc}):Bn(63341,{Rt:n,pa:m}):this.ga=this.ga.insert(l,n)}ya(){const n=[];return this.ga.inorderTraversal(((l,m)=>{n.push(m)})),n}}class Sy{constructor(n,l,m,w,C,D,s,G,q){this.query=n,this.docs=l,this.oldDocs=m,this.docChanges=w,this.mutatedKeys=C,this.fromCache=D,this.syncStateChanged=s,this.excludesMetadataChanges=G,this.hasCachedResults=q}static fromInitialDocuments(n,l,m,w,C){const D=[];return l.forEach((s=>{D.push({type:0,doc:s})})),new Sy(n,l,_y.emptySet(l),D,m,w,!0,!1,C)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&Qb(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const l=this.docChanges,m=n.docChanges;if(l.length!==m.length)return!1;for(let w=0;w<l.length;w++)if(l[w].type!==m[w].type||!l[w].doc.isEqual(m[w].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((n=>n.Da()))}}class L5{constructor(){this.queries=WI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(l,m){const w=nr(l),C=w.queries;w.queries=WI(),C.forEach(((D,s)=>{for(const G of s.Sa)G.onError(m)}))})(this,new Ui(ti.ABORTED,"Firestore shutting down"))}}function WI(){return new Jg((u=>aM(u)),Qb)}async function yE(u,n){const l=nr(u);let m=3;const w=n.query;let C=l.queries.get(w);C?!C.ba()&&n.Da()&&(m=2):(C=new O5,m=n.Da()?0:1);try{switch(m){case 0:C.wa=await l.onListen(w,!0);break;case 1:C.wa=await l.onListen(w,!1);break;case 2:await l.onFirstRemoteStoreListen(w)}}catch(D){const s=_E(D,`Initialization of query '${ly(n.query)}' failed`);return void n.onError(s)}l.queries.set(w,C),C.Sa.push(n),n.va(l.onlineState),C.wa&&n.Fa(C.wa)&&xE(l)}async function vE(u,n){const l=nr(u),m=n.query;let w=3;const C=l.queries.get(m);if(C){const D=C.Sa.indexOf(n);D>=0&&(C.Sa.splice(D,1),C.Sa.length===0?w=n.Da()?0:1:!C.ba()&&n.Da()&&(w=2))}switch(w){case 0:return l.queries.delete(m),l.onUnlisten(m,!0);case 1:return l.queries.delete(m),l.onUnlisten(m,!1);case 2:return l.onLastRemoteStoreUnlisten(m);default:return}}function z5(u,n){const l=nr(u);let m=!1;for(const w of n){const C=w.query,D=l.queries.get(C);if(D){for(const s of D.Sa)s.Fa(w)&&(m=!0);D.wa=w}}m&&xE(l)}function k5(u,n,l){const m=nr(u),w=m.queries.get(n);if(w)for(const C of w.Sa)C.onError(l);m.queries.delete(n)}function xE(u){u.Ca.forEach((n=>{n.next()}))}var vT,$I;($I=vT||(vT={})).Ma="default",$I.Cache="cache";class bE{constructor(n,l,m){this.query=n,this.xa=l,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=m||{}}Fa(n){if(!this.options.includeMetadataChanges){const m=[];for(const w of n.docChanges)w.type!==3&&m.push(w);n=new Sy(n.query,n.docs,n.oldDocs,m,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let l=!1;return this.Oa?this.Ba(n)&&(this.xa.next(n),l=!0):this.La(n,this.onlineState)&&(this.ka(n),l=!0),this.Na=n,l}onError(n){this.xa.error(n)}va(n){this.onlineState=n;let l=!1;return this.Na&&!this.Oa&&this.La(this.Na,n)&&(this.ka(this.Na),l=!0),l}La(n,l){if(!n.fromCache||!this.Da())return!0;const m=l!=="Offline";return(!this.options.qa||!m)&&(!n.docs.isEmpty()||n.hasCachedResults||l==="Offline")}Ba(n){if(n.docChanges.length>0)return!0;const l=this.Na&&this.Na.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!l)&&this.options.includeMetadataChanges===!0}ka(n){n=Sy.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.Oa=!0,this.xa.next(n)}Da(){return this.options.source!==vT.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(n){this.key=n}}class jM{constructor(n){this.key=n}}class N5{constructor(n,l){this.query=n,this.Ya=l,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Fr(),this.mutatedKeys=Fr(),this.eu=lM(n),this.tu=new _y(this.eu)}get nu(){return this.Ya}ru(n,l){const m=l?l.iu:new HI,w=l?l.tu:this.tu;let C=l?l.mutatedKeys:this.mutatedKeys,D=w,s=!1;const G=this.query.limitType==="F"&&w.size===this.query.limit?w.last():null,q=this.query.limitType==="L"&&w.size===this.query.limit?w.first():null;if(n.inorderTraversal(((te,ce)=>{const we=w.get(te),ze=Jb(this.query,ce)?ce:null,at=!!we&&this.mutatedKeys.has(we.key),Ge=!!ze&&(ze.hasLocalMutations||this.mutatedKeys.has(ze.key)&&ze.hasCommittedMutations);let Qe=!1;we&&ze?we.data.isEqual(ze.data)?at!==Ge&&(m.track({type:3,doc:ze}),Qe=!0):this.su(we,ze)||(m.track({type:2,doc:ze}),Qe=!0,(G&&this.eu(ze,G)>0||q&&this.eu(ze,q)<0)&&(s=!0)):!we&&ze?(m.track({type:0,doc:ze}),Qe=!0):we&&!ze&&(m.track({type:1,doc:we}),Qe=!0,(G||q)&&(s=!0)),Qe&&(ze?(D=D.add(ze),C=Ge?C.add(te):C.delete(te)):(D=D.delete(te),C=C.delete(te)))})),this.query.limit!==null)for(;D.size>this.query.limit;){const te=this.query.limitType==="F"?D.last():D.first();D=D.delete(te.key),C=C.delete(te.key),m.track({type:1,doc:te})}return{tu:D,iu:m,Cs:s,mutatedKeys:C}}su(n,l){return n.hasLocalMutations&&l.hasCommittedMutations&&!l.hasLocalMutations}applyChanges(n,l,m,w){const C=this.tu;this.tu=n.tu,this.mutatedKeys=n.mutatedKeys;const D=n.iu.ya();D.sort(((te,ce)=>(function(ze,at){const Ge=Qe=>{switch(Qe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Bn(20277,{Rt:Qe})}};return Ge(ze)-Ge(at)})(te.type,ce.type)||this.eu(te.doc,ce.doc))),this.ou(m),w=w??!1;const s=l&&!w?this._u():[],G=this.Xa.size===0&&this.current&&!w?1:0,q=G!==this.Za;return this.Za=G,D.length!==0||q?{snapshot:new Sy(this.query,n.tu,C,D,n.mutatedKeys,G===0,q,!1,!!m&&m.resumeToken.approximateByteSize()>0),au:s}:{au:s}}va(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new HI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(n){return!this.Ya.has(n)&&!!this.tu.has(n)&&!this.tu.get(n).hasLocalMutations}ou(n){n&&(n.addedDocuments.forEach((l=>this.Ya=this.Ya.add(l))),n.modifiedDocuments.forEach((l=>{})),n.removedDocuments.forEach((l=>this.Ya=this.Ya.delete(l))),this.current=n.current)}_u(){if(!this.current)return[];const n=this.Xa;this.Xa=Fr(),this.tu.forEach((m=>{this.uu(m.key)&&(this.Xa=this.Xa.add(m.key))}));const l=[];return n.forEach((m=>{this.Xa.has(m)||l.push(new jM(m))})),this.Xa.forEach((m=>{n.has(m)||l.push(new UM(m))})),l}cu(n){this.Ya=n.Qs,this.Xa=Fr();const l=this.ru(n.documents);return this.applyChanges(l,!0)}lu(){return Sy.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const wE="SyncEngine";class F5{constructor(n,l,m){this.query=n,this.targetId=l,this.view=m}}class B5{constructor(n){this.key=n,this.hu=!1}}class V5{constructor(n,l,m,w,C,D){this.localStore=n,this.remoteStore=l,this.eventManager=m,this.sharedClientState=w,this.currentUser=C,this.maxConcurrentLimboResolutions=D,this.Pu={},this.Tu=new Jg((s=>aM(s)),Qb),this.Iu=new Map,this.Eu=new Set,this.du=new co(En.comparator),this.Au=new Map,this.Ru=new lE,this.Vu={},this.mu=new Map,this.fu=Ey.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function U5(u,n,l=!0){const m=ZM(u);let w;const C=m.Tu.get(n);return C?(m.sharedClientState.addLocalQueryTarget(C.targetId),w=C.view.lu()):w=await GM(m,n,l,!0),w}async function j5(u,n){const l=ZM(u);await GM(l,n,!0,!1)}async function GM(u,n,l,m){const w=await l5(u.localStore,of(n)),C=w.targetId,D=u.sharedClientState.addLocalQueryTarget(C,l);let s;return m&&(s=await G5(u,n,C,D==="current",w.resumeToken)),u.isPrimaryClient&&l&&zM(u.remoteStore,w),s}async function G5(u,n,l,m,w){u.pu=(ce,we,ze)=>(async function(Ge,Qe,xt,wt){let jt=Qe.view.ru(xt);jt.Cs&&(jt=await BI(Ge.localStore,Qe.query,!1).then((({documents:Ve})=>Qe.view.ru(Ve,jt))));const wi=wt&&wt.targetChanges.get(Qe.targetId),Ai=wt&&wt.targetMismatches.get(Qe.targetId)!=null,vi=Qe.view.applyChanges(jt,Ge.isPrimaryClient,wi,Ai);return XI(Ge,Qe.targetId,vi.au),vi.snapshot})(u,ce,we,ze);const C=await BI(u.localStore,n,!0),D=new N5(n,C.Qs),s=D.ru(C.documents),G=Rx.createSynthesizedTargetChangeForCurrentChange(l,m&&u.onlineState!=="Offline",w),q=D.applyChanges(s,u.isPrimaryClient,G);XI(u,l,q.au);const te=new F5(n,l,D);return u.Tu.set(n,te),u.Iu.has(l)?u.Iu.get(l).push(n):u.Iu.set(l,[n]),q.snapshot}async function q5(u,n,l){const m=nr(u),w=m.Tu.get(n),C=m.Iu.get(w.targetId);if(C.length>1)return m.Iu.set(w.targetId,C.filter((D=>!Qb(D,n)))),void m.Tu.delete(n);m.isPrimaryClient?(m.sharedClientState.removeLocalQueryTarget(w.targetId),m.sharedClientState.isActiveQueryTarget(w.targetId)||await _T(m.localStore,w.targetId,!1).then((()=>{m.sharedClientState.clearQueryState(w.targetId),l&&dE(m.remoteStore,w.targetId),xT(m,w.targetId)})).catch(Dy)):(xT(m,w.targetId),await _T(m.localStore,w.targetId,!0))}async function H5(u,n){const l=nr(u),m=l.Tu.get(n),w=l.Iu.get(m.targetId);l.isPrimaryClient&&w.length===1&&(l.sharedClientState.removeLocalQueryTarget(m.targetId),dE(l.remoteStore,m.targetId))}async function W5(u,n,l){const m=J5(u);try{const w=await(function(D,s){const G=nr(D),q=Ns.now(),te=s.reduce(((ze,at)=>ze.add(at.key)),Fr());let ce,we;return G.persistence.runTransaction("Locally write mutations","readwrite",(ze=>{let at=op(),Ge=Fr();return G.Ns.getEntries(ze,te).next((Qe=>{at=Qe,at.forEach(((xt,wt)=>{wt.isValidDocument()||(Ge=Ge.add(xt))}))})).next((()=>G.localDocuments.getOverlayedDocuments(ze,at))).next((Qe=>{ce=Qe;const xt=[];for(const wt of s){const jt=a4(wt,ce.get(wt.key).overlayedDocument);jt!=null&&xt.push(new Lm(wt.key,jt,eM(jt.value.mapValue),ih.exists(!0)))}return G.mutationQueue.addMutationBatch(ze,q,xt,s)})).next((Qe=>{we=Qe;const xt=Qe.applyToLocalDocumentSet(ce,Ge);return G.documentOverlayCache.saveOverlays(ze,Qe.batchId,xt)}))})).then((()=>({batchId:we.batchId,changes:uM(ce)})))})(m.localStore,n);m.sharedClientState.addPendingMutation(w.batchId),(function(D,s,G){let q=D.Vu[D.currentUser.toKey()];q||(q=new co(Nr)),q=q.insert(s,G),D.Vu[D.currentUser.toKey()]=q})(m,w.batchId,l),await Px(m,w.changes),await s1(m.remoteStore)}catch(w){const C=_E(w,"Failed to persist write");l.reject(C)}}async function qM(u,n){const l=nr(u);try{const m=await s5(l.localStore,n);n.targetChanges.forEach(((w,C)=>{const D=l.Au.get(C);D&&(hs(w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size<=1,22616),w.addedDocuments.size>0?D.hu=!0:w.modifiedDocuments.size>0?hs(D.hu,14607):w.removedDocuments.size>0&&(hs(D.hu,42227),D.hu=!1))})),await Px(l,m,n)}catch(m){await Dy(m)}}function ZI(u,n,l){const m=nr(u);if(m.isPrimaryClient&&l===0||!m.isPrimaryClient&&l===1){const w=[];m.Tu.forEach(((C,D)=>{const s=D.view.va(n);s.snapshot&&w.push(s.snapshot)})),(function(D,s){const G=nr(D);G.onlineState=s;let q=!1;G.queries.forEach(((te,ce)=>{for(const we of ce.Sa)we.va(s)&&(q=!0)})),q&&xE(G)})(m.eventManager,n),w.length&&m.Pu.H_(w),m.onlineState=n,m.isPrimaryClient&&m.sharedClientState.setOnlineState(n)}}async function $5(u,n,l){const m=nr(u);m.sharedClientState.updateQueryState(n,"rejected",l);const w=m.Au.get(n),C=w&&w.key;if(C){let D=new co(En.comparator);D=D.insert(C,Sl.newNoDocument(C,Qn.min()));const s=Fr().add(C),G=new i1(Qn.min(),new Map,new co(Nr),D,s);await qM(m,G),m.du=m.du.remove(C),m.Au.delete(n),TE(m)}else await _T(m.localStore,n,!1).then((()=>xT(m,n,l))).catch(Dy)}async function Z5(u,n){const l=nr(u),m=n.batch.batchId;try{const w=await r5(l.localStore,n);WM(l,m,null),HM(l,m),l.sharedClientState.updateMutationState(m,"acknowledged"),await Px(l,w)}catch(w){await Dy(w)}}async function X5(u,n,l){const m=nr(u);try{const w=await(function(D,s){const G=nr(D);return G.persistence.runTransaction("Reject batch","readwrite-primary",(q=>{let te;return G.mutationQueue.lookupMutationBatch(q,s).next((ce=>(hs(ce!==null,37113),te=ce.keys(),G.mutationQueue.removeMutationBatch(q,ce)))).next((()=>G.mutationQueue.performConsistencyCheck(q))).next((()=>G.documentOverlayCache.removeOverlaysForBatchId(q,te,s))).next((()=>G.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(q,te))).next((()=>G.localDocuments.getDocuments(q,te)))}))})(m.localStore,n);WM(m,n,l),HM(m,n),m.sharedClientState.updateMutationState(n,"rejected",l),await Px(m,w)}catch(w){await Dy(w)}}function HM(u,n){(u.mu.get(n)||[]).forEach((l=>{l.resolve()})),u.mu.delete(n)}function WM(u,n,l){const m=nr(u);let w=m.Vu[m.currentUser.toKey()];if(w){const C=w.get(n);C&&(l?C.reject(l):C.resolve(),w=w.remove(n)),m.Vu[m.currentUser.toKey()]=w}}function xT(u,n,l=null){u.sharedClientState.removeLocalQueryTarget(n);for(const m of u.Iu.get(n))u.Tu.delete(m),l&&u.Pu.yu(m,l);u.Iu.delete(n),u.isPrimaryClient&&u.Ru.jr(n).forEach((m=>{u.Ru.containsKey(m)||$M(u,m)}))}function $M(u,n){u.Eu.delete(n.path.canonicalString());const l=u.du.get(n);l!==null&&(dE(u.remoteStore,l),u.du=u.du.remove(n),u.Au.delete(l),TE(u))}function XI(u,n,l){for(const m of l)m instanceof UM?(u.Ru.addReference(m.key,n),Y5(u,m)):m instanceof jM?(nn(wE,"Document no longer in limbo: "+m.key),u.Ru.removeReference(m.key,n),u.Ru.containsKey(m.key)||$M(u,m.key)):Bn(19791,{wu:m})}function Y5(u,n){const l=n.key,m=l.path.canonicalString();u.du.get(l)||u.Eu.has(m)||(nn(wE,"New document in limbo: "+l),u.Eu.add(m),TE(u))}function TE(u){for(;u.Eu.size>0&&u.du.size<u.maxConcurrentLimboResolutions;){const n=u.Eu.values().next().value;u.Eu.delete(n);const l=new En(Rs.fromString(n)),m=u.fu.next();u.Au.set(m,new B5(l)),u.du=u.du.insert(l,m),zM(u.remoteStore,new _m(of(Kb(l.path)),m,"TargetPurposeLimboResolution",$b.ce))}}async function Px(u,n,l){const m=nr(u),w=[],C=[],D=[];m.Tu.isEmpty()||(m.Tu.forEach(((s,G)=>{D.push(m.pu(G,n,l).then((q=>{if((q||l)&&m.isPrimaryClient){const te=q?!q.fromCache:l?.targetChanges.get(G.targetId)?.current;m.sharedClientState.updateQueryState(G.targetId,te?"current":"not-current")}if(q){w.push(q);const te=uE.As(G.targetId,q);C.push(te)}})))})),await Promise.all(D),m.Pu.H_(w),await(async function(G,q){const te=nr(G);try{await te.persistence.runTransaction("notifyLocalViewChanges","readwrite",(ce=>mi.forEach(q,(we=>mi.forEach(we.Es,(ze=>te.persistence.referenceDelegate.addReference(ce,we.targetId,ze))).next((()=>mi.forEach(we.ds,(ze=>te.persistence.referenceDelegate.removeReference(ce,we.targetId,ze)))))))))}catch(ce){if(!Oy(ce))throw ce;nn(hE,"Failed to update sequence numbers: "+ce)}for(const ce of q){const we=ce.targetId;if(!ce.fromCache){const ze=te.Ms.get(we),at=ze.snapshotVersion,Ge=ze.withLastLimboFreeSnapshotVersion(at);te.Ms=te.Ms.insert(we,Ge)}}})(m.localStore,C))}async function K5(u,n){const l=nr(u);if(!l.currentUser.isEqual(n)){nn(wE,"User change. New user:",n.toKey());const m=await PM(l.localStore,n);l.currentUser=n,(function(C,D){C.mu.forEach((s=>{s.forEach((G=>{G.reject(new Ui(ti.CANCELLED,D))}))})),C.mu.clear()})(l,"'waitForPendingWrites' promise is rejected due to a user change."),l.sharedClientState.handleUserChange(n,m.removedBatchIds,m.addedBatchIds),await Px(l,m.Ls)}}function Q5(u,n){const l=nr(u),m=l.Au.get(n);if(m&&m.hu)return Fr().add(m.key);{let w=Fr();const C=l.Iu.get(n);if(!C)return w;for(const D of C){const s=l.Tu.get(D);w=w.unionWith(s.view.nu)}return w}}function ZM(u){const n=nr(u);return n.remoteStore.remoteSyncer.applyRemoteEvent=qM.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=Q5.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=$5.bind(null,n),n.Pu.H_=z5.bind(null,n.eventManager),n.Pu.yu=k5.bind(null,n.eventManager),n}function J5(u){const n=nr(u);return n.remoteStore.remoteSyncer.applySuccessfulWrite=Z5.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=X5.bind(null,n),n}class Pb{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=n1(n.databaseInfo.databaseId),this.sharedClientState=this.Du(n),this.persistence=this.Cu(n),await this.persistence.start(),this.localStore=this.vu(n),this.gcScheduler=this.Fu(n,this.localStore),this.indexBackfillerScheduler=this.Mu(n,this.localStore)}Fu(n,l){return null}Mu(n,l){return null}vu(n){return n5(this.persistence,new e5,n.initialUser,this.serializer)}Cu(n){return new MM(cE.mi,this.serializer)}Du(n){return new u5}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Pb.provider={build:()=>new Pb};class eV extends Pb{constructor(n){super(),this.cacheSizeBytes=n}Fu(n,l){hs(this.persistence.referenceDelegate instanceof Rb,46915);const m=this.persistence.referenceDelegate.garbageCollector;return new B4(m,n.asyncQueue,l)}Cu(n){const l=this.cacheSizeBytes!==void 0?zc.withCacheSize(this.cacheSizeBytes):zc.DEFAULT;return new MM((m=>Rb.mi(m,l)),this.serializer)}}class bT{async initialize(n,l){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(l),this.remoteStore=this.createRemoteStore(l),this.eventManager=this.createEventManager(l),this.syncEngine=this.createSyncEngine(l,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=m=>ZI(this.syncEngine,m,1),this.remoteStore.remoteSyncer.handleCredentialChange=K5.bind(null,this.syncEngine),await D5(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return(function(){return new L5})()}createDatastore(n){const l=n1(n.databaseInfo.databaseId),m=(function(C){return new m5(C)})(n.databaseInfo);return(function(C,D,s,G){return new v5(C,D,s,G)})(n.authCredentials,n.appCheckCredentials,m,l)}createRemoteStore(n){return(function(m,w,C,D,s){return new b5(m,w,C,D,s)})(this.localStore,this.datastore,n.asyncQueue,(l=>ZI(this.syncEngine,l,0)),(function(){return jI.v()?new jI:new h5})())}createSyncEngine(n,l){return(function(w,C,D,s,G,q,te){const ce=new V5(w,C,D,s,G,q);return te&&(ce.gu=!0),ce})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,l)}async terminate(){await(async function(l){const m=nr(l);nn(Yg,"RemoteStore shutting down."),m.Ea.add(5),await Mx(m),m.Aa.shutdown(),m.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}bT.provider={build:()=>new bT};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.Ou(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.Ou(this.observer.error,n):sp("Uncaught Error in snapshot listener:",n.toString()))}Nu(){this.muted=!0}Ou(n,l){setTimeout((()=>{this.muted||n(l)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cm="FirestoreClient";class tV{constructor(n,l,m,w,C){this.authCredentials=n,this.appCheckCredentials=l,this.asyncQueue=m,this.databaseInfo=w,this.user=El.UNAUTHENTICATED,this.clientId=KT.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=C,this.authCredentials.start(m,(async D=>{nn(Cm,"Received user=",D.uid),await this.authCredentialListener(D),this.user=D})),this.appCheckCredentials.start(m,(D=>(nn(Cm,"Received new app check token=",D),this.appCheckCredentialListener(D,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new ep;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(l){const m=_E(l,"Failed to shutdown persistence");n.reject(m)}})),n.promise}}async function Gw(u,n){u.asyncQueue.verifyOperationInProgress(),nn(Cm,"Initializing OfflineComponentProvider");const l=u.configuration;await n.initialize(l);let m=l.initialUser;u.setCredentialChangeListener((async w=>{m.isEqual(w)||(await PM(n.localStore,w),m=w)})),n.persistence.setDatabaseDeletedListener((()=>u.terminate())),u._offlineComponents=n}async function YI(u,n){u.asyncQueue.verifyOperationInProgress();const l=await iV(u);nn(Cm,"Initializing OnlineComponentProvider"),await n.initialize(l,u.configuration),u.setCredentialChangeListener((m=>qI(n.remoteStore,m))),u.setAppCheckTokenChangeListener(((m,w)=>qI(n.remoteStore,w))),u._onlineComponents=n}async function iV(u){if(!u._offlineComponents)if(u._uninitializedComponentsProvider){nn(Cm,"Using user provided OfflineComponentProvider");try{await Gw(u,u._uninitializedComponentsProvider._offline)}catch(n){const l=n;if(!(function(w){return w.name==="FirebaseError"?w.code===ti.FAILED_PRECONDITION||w.code===ti.UNIMPLEMENTED:!(typeof DOMException<"u"&&w instanceof DOMException)||w.code===22||w.code===20||w.code===11})(l))throw l;vy("Error using user provided cache. Falling back to memory cache: "+l),await Gw(u,new Pb)}}else nn(Cm,"Using default OfflineComponentProvider"),await Gw(u,new eV(void 0));return u._offlineComponents}async function XM(u){return u._onlineComponents||(u._uninitializedComponentsProvider?(nn(Cm,"Using user provided OnlineComponentProvider"),await YI(u,u._uninitializedComponentsProvider._online)):(nn(Cm,"Using default OnlineComponentProvider"),await YI(u,new bT))),u._onlineComponents}function nV(u){return XM(u).then((n=>n.syncEngine))}async function Db(u){const n=await XM(u),l=n.eventManager;return l.onListen=U5.bind(null,n.syncEngine),l.onUnlisten=q5.bind(null,n.syncEngine),l.onFirstRemoteStoreListen=j5.bind(null,n.syncEngine),l.onLastRemoteStoreUnlisten=H5.bind(null,n.syncEngine),l}function rV(u,n,l={}){const m=new ep;return u.asyncQueue.enqueueAndForget((async()=>(function(C,D,s,G,q){const te=new EE({next:we=>{te.Nu(),D.enqueueAndForget((()=>vE(C,ce)));const ze=we.docs.has(s);!ze&&we.fromCache?q.reject(new Ui(ti.UNAVAILABLE,"Failed to get document because the client is offline.")):ze&&we.fromCache&&G&&G.source==="server"?q.reject(new Ui(ti.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):q.resolve(we)},error:we=>q.reject(we)}),ce=new bE(Kb(s.path),te,{includeMetadataChanges:!0,qa:!0});return yE(C,ce)})(await Db(u),u.asyncQueue,n,l,m))),m.promise}function sV(u,n,l={}){const m=new ep;return u.asyncQueue.enqueueAndForget((async()=>(function(C,D,s,G,q){const te=new EE({next:we=>{te.Nu(),D.enqueueAndForget((()=>vE(C,ce))),we.fromCache&&G.source==="server"?q.reject(new Ui(ti.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):q.resolve(we)},error:we=>q.reject(we)}),ce=new bE(s,te,{includeMetadataChanges:!0,qa:!0});return yE(C,ce)})(await Db(u),u.asyncQueue,n,l,m))),m.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YM(u){const n={};return u.timeoutSeconds!==void 0&&(n.timeoutSeconds=u.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KI=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KM="firestore.googleapis.com",QI=!0;class JI{constructor(n){if(n.host===void 0){if(n.ssl!==void 0)throw new Ui(ti.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=KM,this.ssl=QI}else this.host=n.host,this.ssl=n.ssl??QI;if(this.isUsingEmulator=n.emulatorOptions!==void 0,this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=RM;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<N4)throw new Ui(ti.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}vB("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=YM(n.experimentalLongPollingOptions??{}),(function(m){if(m.timeoutSeconds!==void 0){if(isNaN(m.timeoutSeconds))throw new Ui(ti.INVALID_ARGUMENT,`invalid long polling timeout: ${m.timeoutSeconds} (must not be NaN)`);if(m.timeoutSeconds<5)throw new Ui(ti.INVALID_ARGUMENT,`invalid long polling timeout: ${m.timeoutSeconds} (minimum allowed value is 5)`);if(m.timeoutSeconds>30)throw new Ui(ti.INVALID_ARGUMENT,`invalid long polling timeout: ${m.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&(function(m,w){return m.timeoutSeconds===w.timeoutSeconds})(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class o1{constructor(n,l,m,w){this._authCredentials=n,this._appCheckCredentials=l,this._databaseId=m,this._app=w,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new JI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ui(ti.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Ui(ti.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new JI(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=(function(m){if(!m)return new cB;switch(m.type){case"firstParty":return new fB(m.sessionIndex||"0",m.iamToken||null,m.authTokenFactory||null);case"provider":return m.client;default:throw new Ui(ti.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(l){const m=KI.get(l);m&&(nn("ComponentProvider","Removing Datastore"),KI.delete(l),m.terminate())})(this),Promise.resolve()}}function oV(u,n,l,m={}){u=Vc(u,o1);const w=Pm(n),C=u._getSettings(),D={...C,emulatorOptions:u._getEmulatorOptions()},s=`${n}:${l}`;w&&(zT(`https://${s}`),kT("Firestore",!0)),C.host!==KM&&C.host!==s&&vy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const G={...C,host:s,ssl:w,emulatorOptions:m};if(!Hg(G,D)&&(u._setSettings(G),m.mockUserToken)){let q,te;if(typeof m.mockUserToken=="string")q=m.mockUserToken,te=El.MOCK_USER;else{q=YC(m.mockUserToken,u._app?.options.projectId);const ce=m.mockUserToken.sub||m.mockUserToken.user_id;if(!ce)throw new Ui(ti.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");te=new El(ce)}u._authCredentials=new uB(new jR(q,te))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(n,l,m){this.converter=l,this._query=m,this.type="query",this.firestore=n}withConverter(n){return new td(this.firestore,n,this._query)}}class vo{constructor(n,l,m){this.converter=l,this._key=m,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bm(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new vo(this.firestore,n,this._key)}toJSON(){return{type:vo._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(n,l,m){if(Ix(l,vo._jsonSchema))return new vo(n,m||null,new En(Rs.fromString(l.referencePath)))}}vo._jsonSchemaVersion="firestore/documentReference/1.0",vo._jsonSchema={type:Ko("string",vo._jsonSchemaVersion),referencePath:Ko("string")};class bm extends td{constructor(n,l,m){super(n,l,Kb(m)),this._path=m,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new vo(this.firestore,null,new En(n))}withConverter(n){return new bm(this.firestore,n,this._path)}}function sc(u,n,...l){if(u=Zs(u),GR("collection","path",n),u instanceof o1){const m=Rs.fromString(n,...l);return fI(m),new bm(u,null,m)}{if(!(u instanceof vo||u instanceof bm))throw new Ui(ti.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const m=u._path.child(Rs.fromString(n,...l));return fI(m),new bm(u.firestore,null,m)}}function lo(u,n,...l){if(u=Zs(u),arguments.length===1&&(n=KT.newId()),GR("doc","path",n),u instanceof o1){const m=Rs.fromString(n,...l);return dI(m),new vo(u,null,new En(m))}{if(!(u instanceof vo||u instanceof bm))throw new Ui(ti.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const m=u._path.child(Rs.fromString(n,...l));return dI(m),new vo(u.firestore,u instanceof bm?u.converter:null,new En(m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eC="AsyncQueue";class tC{constructor(n=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new OM(this,"async_queue_retry"),this._c=()=>{const m=jw();m&&nn(eC,"Visibility state changed to "+m.visibilityState),this.M_.w_()},this.ac=n;const l=jw();l&&typeof l.addEventListener=="function"&&l.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.uc(),this.cc(n)}enterRestrictedMode(n){if(!this.ec){this.ec=!0,this.sc=n||!1;const l=jw();l&&typeof l.removeEventListener=="function"&&l.removeEventListener("visibilitychange",this._c)}}enqueue(n){if(this.uc(),this.ec)return new Promise((()=>{}));const l=new ep;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(n().then(l.resolve,l.reject),l.promise))).then((()=>l.promise))}enqueueRetryable(n){this.enqueueAndForget((()=>(this.Xu.push(n),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(n){if(!Oy(n))throw n;nn(eC,"Operation failed with retryable error: "+n)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(n){const l=this.ac.then((()=>(this.rc=!0,n().catch((m=>{throw this.nc=m,this.rc=!1,sp("INTERNAL UNHANDLED ERROR: ",iC(m)),m})).then((m=>(this.rc=!1,m))))));return this.ac=l,l}enqueueAfterDelay(n,l,m){this.uc(),this.oc.indexOf(n)>-1&&(l=0);const w=gE.createAndSchedule(this,n,l,m,(C=>this.hc(C)));return this.tc.push(w),w}uc(){this.nc&&Bn(47125,{Pc:iC(this.nc)})}verifyOperationInProgress(){}async Tc(){let n;do n=this.ac,await n;while(n!==this.ac)}Ic(n){for(const l of this.tc)if(l.timerId===n)return!0;return!1}Ec(n){return this.Tc().then((()=>{this.tc.sort(((l,m)=>l.targetTimeMs-m.targetTimeMs));for(const l of this.tc)if(l.skipDelay(),n!=="all"&&l.timerId===n)break;return this.Tc()}))}dc(n){this.oc.push(n)}hc(n){const l=this.tc.indexOf(n);this.tc.splice(l,1)}}function iC(u){let n=u.message||"";return u.stack&&(n=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nC(u){return(function(l,m){if(typeof l!="object"||l===null)return!1;const w=l;for(const C of m)if(C in w&&typeof w[C]=="function")return!0;return!1})(u,["next","error","complete"])}class ap extends o1{constructor(n,l,m,w){super(n,l,m,w),this.type="firestore",this._queue=new tC,this._persistenceKey=w?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new tC(n),this._firestoreClient=void 0,await n}}}function zy(u,n){const l=typeof u=="object"?u:BT(),m=typeof u=="string"?u:Tb,w=jb(l,"firestore").getImmediate({identifier:m});if(!w._initialized){const C=$C("firestore");C&&oV(w,...C)}return w}function a1(u){if(u._terminated)throw new Ui(ti.FAILED_PRECONDITION,"The client has already been terminated.");return u._firestoreClient||aV(u),u._firestoreClient}function aV(u){const n=u._freezeSettings(),l=(function(w,C,D,s){return new PB(w,C,D,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,YM(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator)})(u._databaseId,u._app?.options.appId||"",u._persistenceKey,n);u._componentsProvider||n.localCache?._offlineComponentProvider&&n.localCache?._onlineComponentProvider&&(u._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),u._firestoreClient=new tV(u._authCredentials,u._appCheckCredentials,u._queue,l,u._componentsProvider&&(function(w){const C=w?._online.build();return{_offline:w?._offline.build(C),_online:C}})(u._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(n){this._byteString=n}static fromBase64String(n){try{return new th(Za.fromBase64String(n))}catch(l){throw new Ui(ti.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+l)}}static fromUint8Array(n){return new th(Za.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}toJSON(){return{type:th._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(n){if(Ix(n,th._jsonSchema))return th.fromBase64String(n.bytes)}}th._jsonSchemaVersion="firestore/bytes/1.0",th._jsonSchema={type:Ko("string",th._jsonSchemaVersion),bytes:Ko("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(...n){for(let l=0;l<n.length;++l)if(n[l].length===0)throw new Ui(ti.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $a(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(n,l){if(!isFinite(n)||n<-90||n>90)throw new Ui(ti.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(l)||l<-180||l>180)throw new Ui(ti.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+l);this._lat=n,this._long=l}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}_compareTo(n){return Nr(this._lat,n._lat)||Nr(this._long,n._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:lf._jsonSchemaVersion}}static fromJSON(n){if(Ix(n,lf._jsonSchema))return new lf(n.latitude,n.longitude)}}lf._jsonSchemaVersion="firestore/geoPoint/1.0",lf._jsonSchema={type:Ko("string",lf._jsonSchemaVersion),latitude:Ko("number"),longitude:Ko("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(n){this._values=(n||[]).map((l=>l))}toArray(){return this._values.map((n=>n))}isEqual(n){return(function(m,w){if(m.length!==w.length)return!1;for(let C=0;C<m.length;++C)if(m[C]!==w[C])return!1;return!0})(this._values,n._values)}toJSON(){return{type:cf._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(n){if(Ix(n,cf._jsonSchema)){if(Array.isArray(n.vectorValues)&&n.vectorValues.every((l=>typeof l=="number")))return new cf(n.vectorValues);throw new Ui(ti.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}cf._jsonSchemaVersion="firestore/vectorValue/1.0",cf._jsonSchema={type:Ko("string",cf._jsonSchemaVersion),vectorValues:Ko("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV=/^__.*__$/;class cV{constructor(n,l,m){this.data=n,this.fieldMask=l,this.fieldTransforms=m}toMutation(n,l){return this.fieldMask!==null?new Lm(n,this.data,this.fieldMask,l,this.fieldTransforms):new Cx(n,this.data,l,this.fieldTransforms)}}class QM{constructor(n,l,m){this.data=n,this.fieldMask=l,this.fieldTransforms=m}toMutation(n,l){return new Lm(n,this.data,this.fieldMask,l,this.fieldTransforms)}}function JM(u){switch(u){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Bn(40011,{Ac:u})}}class SE{constructor(n,l,m,w,C,D){this.settings=n,this.databaseId=l,this.serializer=m,this.ignoreUndefinedProperties=w,C===void 0&&this.Rc(),this.fieldTransforms=C||[],this.fieldMask=D||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(n){return new SE({...this.settings,...n},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(n){const l=this.path?.child(n),m=this.Vc({path:l,fc:!1});return m.gc(n),m}yc(n){const l=this.path?.child(n),m=this.Vc({path:l,fc:!1});return m.Rc(),m}wc(n){return this.Vc({path:void 0,fc:!0})}Sc(n){return Ob(n,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(n){return this.fieldMask.find((l=>n.isPrefixOf(l)))!==void 0||this.fieldTransforms.find((l=>n.isPrefixOf(l.field)))!==void 0}Rc(){if(this.path)for(let n=0;n<this.path.length;n++)this.gc(this.path.get(n))}gc(n){if(n.length===0)throw this.Sc("Document fields must not be empty");if(JM(this.Ac)&&lV.test(n))throw this.Sc('Document fields cannot begin and end with "__"')}}class uV{constructor(n,l,m){this.databaseId=n,this.ignoreUndefinedProperties=l,this.serializer=m||n1(n)}Cc(n,l,m,w=!1){return new SE({Ac:n,methodName:l,Dc:m,path:$a.emptyPath(),fc:!1,bc:w},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Dx(u){const n=u._freezeSettings(),l=n1(u._databaseId);return new uV(u._databaseId,!!n.ignoreUndefinedProperties,l)}function eP(u,n,l,m,w,C={}){const D=u.Cc(C.merge||C.mergeFields?2:0,n,l,w);IE("Data must be an object, but it was:",D,m);const s=iP(m,D);let G,q;if(C.merge)G=new xu(D.fieldMask),q=D.fieldTransforms;else if(C.mergeFields){const te=[];for(const ce of C.mergeFields){const we=wT(n,ce,l);if(!D.contains(we))throw new Ui(ti.INVALID_ARGUMENT,`Field '${we}' is specified in your field mask but missing from your input data.`);rP(te,we)||te.push(we)}G=new xu(te),q=D.fieldTransforms.filter((ce=>G.covers(ce.field)))}else G=null,q=D.fieldTransforms;return new cV(new Fc(s),G,q)}class u1 extends c1{_toFieldTransform(n){if(n.Ac!==2)throw n.Ac===1?n.Sc(`${this._methodName}() can only appear at the top level of your update data`):n.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof u1}}class AE extends c1{_toFieldTransform(n){return new n4(n.path,new px)}isEqual(n){return n instanceof AE}}function hV(u,n,l,m){const w=u.Cc(1,n,l);IE("Data must be an object, but it was:",w,m);const C=[],D=Fc.empty();Dm(m,((G,q)=>{const te=CE(n,G,l);q=Zs(q);const ce=w.yc(te);if(q instanceof u1)C.push(te);else{const we=Ox(q,ce);we!=null&&(C.push(te),D.set(te,we))}}));const s=new xu(C);return new QM(D,s,w.fieldTransforms)}function dV(u,n,l,m,w,C){const D=u.Cc(1,n,l),s=[wT(n,m,l)],G=[w];if(C.length%2!=0)throw new Ui(ti.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let we=0;we<C.length;we+=2)s.push(wT(n,C[we])),G.push(C[we+1]);const q=[],te=Fc.empty();for(let we=s.length-1;we>=0;--we)if(!rP(q,s[we])){const ze=s[we];let at=G[we];at=Zs(at);const Ge=D.yc(ze);if(at instanceof u1)q.push(ze);else{const Qe=Ox(at,Ge);Qe!=null&&(q.push(ze),te.set(ze,Qe))}}const ce=new xu(q);return new QM(te,ce,D.fieldTransforms)}function tP(u,n,l,m=!1){return Ox(l,u.Cc(m?4:3,n))}function Ox(u,n){if(nP(u=Zs(u)))return IE("Unsupported field value:",n,u),iP(u,n);if(u instanceof c1)return(function(m,w){if(!JM(w.Ac))throw w.Sc(`${m._methodName}() can only be used with update() and set()`);if(!w.path)throw w.Sc(`${m._methodName}() is not currently supported inside arrays`);const C=m._toFieldTransform(w);C&&w.fieldTransforms.push(C)})(u,n),null;if(u===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),u instanceof Array){if(n.settings.fc&&n.Ac!==4)throw n.Sc("Nested arrays are not supported");return(function(m,w){const C=[];let D=0;for(const s of m){let G=Ox(s,w.wc(D));G==null&&(G={nullValue:"NULL_VALUE"}),C.push(G),D++}return{arrayValue:{values:C}}})(u,n)}return(function(m,w){if((m=Zs(m))===null)return{nullValue:"NULL_VALUE"};if(typeof m=="number")return e4(w.serializer,m);if(typeof m=="boolean")return{booleanValue:m};if(typeof m=="string")return{stringValue:m};if(m instanceof Date){const C=Ns.fromDate(m);return{timestampValue:Cb(w.serializer,C)}}if(m instanceof Ns){const C=new Ns(m.seconds,1e3*Math.floor(m.nanoseconds/1e3));return{timestampValue:Cb(w.serializer,C)}}if(m instanceof lf)return{geoPointValue:{latitude:m.latitude,longitude:m.longitude}};if(m instanceof th)return{bytesValue:wM(w.serializer,m._byteString)};if(m instanceof vo){const C=w.databaseId,D=m.firestore._databaseId;if(!D.isEqual(C))throw w.Sc(`Document reference is for database ${D.projectId}/${D.database} but should be for database ${C.projectId}/${C.database}`);return{referenceValue:aE(m.firestore._databaseId||w.databaseId,m._key.path)}}if(m instanceof cf)return(function(D,s){return{mapValue:{fields:{[QR]:{stringValue:JR},[Eb]:{arrayValue:{values:D.toArray().map((q=>{if(typeof q!="number")throw s.Sc("VectorValues must only contain numeric values.");return nE(s.serializer,q)}))}}}}}})(m,w);throw w.Sc(`Unsupported field value: ${Wb(m)}`)})(u,n)}function iP(u,n){const l={};return WR(u)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):Dm(u,((m,w)=>{const C=Ox(w,n.mc(m));C!=null&&(l[m]=C)})),{mapValue:{fields:l}}}function nP(u){return!(typeof u!="object"||u===null||u instanceof Array||u instanceof Date||u instanceof Ns||u instanceof lf||u instanceof th||u instanceof vo||u instanceof c1||u instanceof cf)}function IE(u,n,l){if(!nP(l)||!qR(l)){const m=Wb(l);throw m==="an object"?n.Sc(u+" a custom object"):n.Sc(u+" "+m)}}function wT(u,n,l){if((n=Zs(n))instanceof l1)return n._internalPath;if(typeof n=="string")return CE(u,n);throw Ob("Field path arguments must be of type string or ",u,!1,void 0,l)}const fV=new RegExp("[~\\*/\\[\\]]");function CE(u,n,l){if(n.search(fV)>=0)throw Ob(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,u,!1,void 0,l);try{return new l1(...n.split("."))._internalPath}catch{throw Ob(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,u,!1,void 0,l)}}function Ob(u,n,l,m,w){const C=m&&!m.isEmpty(),D=w!==void 0;let s=`Function ${n}() called with invalid data`;l&&(s+=" (via `toFirestore()`)"),s+=". ";let G="";return(C||D)&&(G+=" (found",C&&(G+=` in field ${m}`),D&&(G+=` in document ${w}`),G+=")"),new Ui(ti.INVALID_ARGUMENT,s+u+G)}function rP(u,n){return u.some((l=>l.isEqual(n)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(n,l,m,w,C){this._firestore=n,this._userDataWriter=l,this._key=m,this._document=w,this._converter=C}get id(){return this._key.path.lastSegment()}get ref(){return new vo(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new pV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const l=this._document.data.field(h1("DocumentSnapshot.get",n));if(l!==null)return this._userDataWriter.convertValue(l)}}}class pV extends RE{data(){return super.data()}}function h1(u,n){return typeof n=="string"?CE(u,n):n instanceof l1?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(u){if(u.limitType==="L"&&u.explicitOrderBy.length===0)throw new Ui(ti.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ME{}class Lx extends ME{}function lp(u,n,...l){let m=[];n instanceof ME&&m.push(n),m=m.concat(l),(function(C){const D=C.filter((G=>G instanceof kx)).length,s=C.filter((G=>G instanceof zx)).length;if(D>1||D>0&&s>0)throw new Ui(ti.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(m);for(const w of m)u=w._apply(u);return u}class zx extends Lx{constructor(n,l,m){super(),this._field=n,this._op=l,this._value=m,this.type="where"}static _create(n,l,m){return new zx(n,l,m)}_apply(n){const l=this._parse(n);return aP(n._query,l),new td(n.firestore,n.converter,dT(n._query,l))}_parse(n){const l=Dx(n.firestore);return(function(C,D,s,G,q,te,ce){let we;if(q.isKeyField()){if(te==="array-contains"||te==="array-contains-any")throw new Ui(ti.INVALID_ARGUMENT,`Invalid Query. You can't perform '${te}' queries on documentId().`);if(te==="in"||te==="not-in"){sC(ce,te);const at=[];for(const Ge of ce)at.push(rC(G,C,Ge));we={arrayValue:{values:at}}}else we=rC(G,C,ce)}else te!=="in"&&te!=="not-in"&&te!=="array-contains-any"||sC(ce,te),we=tP(s,D,ce,te==="in"||te==="not-in");return Yo.create(q,te,we)})(n._query,"where",l,n.firestore._databaseId,this._field,this._op,this._value)}}function Ug(u,n,l){const m=n,w=h1("where",u);return zx._create(w,m,l)}class kx extends ME{constructor(n,l){super(),this.type=n,this._queryConstraints=l}static _create(n,l){return new kx(n,l)}_parse(n){const l=this._queryConstraints.map((m=>m._parse(n))).filter((m=>m.getFilters().length>0));return l.length===1?l[0]:Jh.create(l,this._getOperator())}_apply(n){const l=this._parse(n);return l.getFilters().length===0?n:((function(w,C){let D=w;const s=C.getFlattenedFilters();for(const G of s)aP(D,G),D=dT(D,G)})(n._query,l),new td(n.firestore,n.converter,dT(n._query,l)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function mV(...u){return u.forEach((n=>vV("or",n))),kx._create("or",u)}class PE extends Lx{constructor(n,l){super(),this._field=n,this._direction=l,this.type="orderBy"}static _create(n,l){return new PE(n,l)}_apply(n){const l=(function(w,C,D){if(w.startAt!==null)throw new Ui(ti.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(w.endAt!==null)throw new Ui(ti.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fx(C,D)})(n._query,this._field,this._direction);return new td(n.firestore,n.converter,(function(w,C){const D=w.explicitOrderBy.concat([C]);return new Om(w.path,w.collectionGroup,D,w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(n._query,l))}}function Lb(u,n="asc"){const l=n,m=h1("orderBy",u);return PE._create(m,l)}class DE extends Lx{constructor(n,l,m){super(),this.type=n,this._limit=l,this._limitType=m}static _create(n,l,m){return new DE(n,l,m)}_apply(n){return new td(n.firestore,n.converter,Ab(n._query,this._limit,this._limitType))}}function TT(u){return xB("limit",u),DE._create("limit",u,"F")}class d1 extends Lx{constructor(n,l,m){super(),this.type=n,this._docOrFields=l,this._inclusive=m}static _create(n,l,m){return new d1(n,l,m)}_apply(n){const l=oP(n,this.type,this._docOrFields,this._inclusive);return new td(n.firestore,n.converter,(function(w,C){return new Om(w.path,w.collectionGroup,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,C,w.endAt)})(n._query,l))}}function gV(...u){return d1._create("startAt",u,!0)}function _V(...u){return d1._create("startAfter",u,!1)}class OE extends Lx{constructor(n,l,m){super(),this.type=n,this._docOrFields=l,this._inclusive=m}static _create(n,l,m){return new OE(n,l,m)}_apply(n){const l=oP(n,this.type,this._docOrFields,this._inclusive);return new td(n.firestore,n.converter,(function(w,C){return new Om(w.path,w.collectionGroup,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,C)})(n._query,l))}}function yV(...u){return OE._create("endAt",u,!0)}function oP(u,n,l,m){if(l[0]=Zs(l[0]),l[0]instanceof RE)return(function(C,D,s,G,q){if(!G)throw new Ui(ti.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${s}().`);const te=[];for(const ce of gy(C))if(ce.field.isKeyField())te.push(Sb(D,G.key));else{const we=G.data.field(ce.field);if(Xb(we))throw new Ui(ti.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+ce.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(we===null){const ze=ce.field.canonicalString();throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${ze}' (used as the orderBy) does not exist.`)}te.push(we)}return new Ty(te,q)})(u._query,u.firestore._databaseId,n,l[0]._document,m);{const w=Dx(u.firestore);return(function(D,s,G,q,te,ce){const we=D.explicitOrderBy;if(te.length>we.length)throw new Ui(ti.INVALID_ARGUMENT,`Too many arguments provided to ${q}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const ze=[];for(let at=0;at<te.length;at++){const Ge=te[at];if(we[at].field.isKeyField()){if(typeof Ge!="string")throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${q}(), but got a ${typeof Ge}`);if(!iE(D)&&Ge.indexOf("/")!==-1)throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${q}() must be a plain document ID, but '${Ge}' contains a slash.`);const Qe=D.path.child(Rs.fromString(Ge));if(!En.isDocumentKey(Qe))throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${q}() must result in a valid document path, but '${Qe}' is not because it contains an odd number of segments.`);const xt=new En(Qe);ze.push(Sb(s,xt))}else{const Qe=tP(G,q,Ge);ze.push(Qe)}}return new Ty(ze,ce)})(u._query,u.firestore._databaseId,w,n,l,m)}}function rC(u,n,l){if(typeof(l=Zs(l))=="string"){if(l==="")throw new Ui(ti.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iE(n)&&l.indexOf("/")!==-1)throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${l}' contains a '/' character.`);const m=n.path.child(Rs.fromString(l));if(!En.isDocumentKey(m))throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${m}' is not because it has an odd number of segments (${m.length}).`);return Sb(u,new En(m))}if(l instanceof vo)return Sb(u,l._key);throw new Ui(ti.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wb(l)}.`)}function sC(u,n){if(!Array.isArray(u)||u.length===0)throw new Ui(ti.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`)}function aP(u,n){const l=(function(w,C){for(const D of w)for(const s of D.getFlattenedFilters())if(C.indexOf(s.op)>=0)return s.op;return null})(u.filters,(function(w){switch(w){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(n.op));if(l!==null)throw l===n.op?new Ui(ti.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new Ui(ti.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${l.toString()}' filters.`)}function vV(u,n){if(!(n instanceof zx||n instanceof kx))throw new Ui(ti.INVALID_ARGUMENT,`Function ${u}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class xV{convertValue(n,l="none"){switch(Am(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Lo(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,l);case 5:return n.stringValue;case 6:return this.convertBytes(Sm(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,l);case 11:return this.convertObject(n.mapValue,l);case 10:return this.convertVectorValue(n.mapValue);default:throw Bn(62114,{value:n})}}convertObject(n,l){return this.convertObjectMap(n.fields,l)}convertObjectMap(n,l="none"){const m={};return Dm(n,((w,C)=>{m[w]=this.convertValue(C,l)})),m}convertVectorValue(n){const l=n.fields?.[Eb].arrayValue?.values?.map((m=>Lo(m.doubleValue)));return new cf(l)}convertGeoPoint(n){return new lf(Lo(n.latitude),Lo(n.longitude))}convertArray(n,l){return(n.values||[]).map((m=>this.convertValue(m,l)))}convertServerTimestamp(n,l){switch(l){case"previous":const m=Yb(n);return m==null?null:this.convertValue(m,l);case"estimate":return this.convertTimestamp(ux(n));default:return null}}convertTimestamp(n){const l=Em(n);return new Ns(l.seconds,l.nanos)}convertDocumentKey(n,l){const m=Rs.fromString(n);hs(CM(m),9688,{name:n});const w=new hx(m.get(1),m.get(3)),C=new En(m.popFirst(5));return w.isEqual(l)||sp(`Document ${C} contains a document reference within a different database (${w.projectId}/${w.database}) which is not supported. It will be treated as a reference in the current database (${l.projectId}/${l.database}) instead.`),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(u,n,l){let m;return m=u?u.toFirestore(n):n,m}class Yv{constructor(n,l){this.hasPendingWrites=n,this.fromCache=l}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class jg extends RE{constructor(n,l,m,w,C,D){super(n,l,m,w,D),this._firestore=n,this._firestoreImpl=n,this.metadata=C}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const l=new ub(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(l,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,l={}){if(this._document){const m=this._document.data.field(h1("DocumentSnapshot.get",n));if(m!==null)return this._userDataWriter.convertValue(m,l.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ui(ti.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n=this._document,l={};return l.type=jg._jsonSchemaVersion,l.bundle="",l.bundleSource="DocumentSnapshot",l.bundleName=this._key.toString(),!n||!n.isValidDocument()||!n.isFoundDocument()?l:(this._userDataWriter.convertObjectMap(n.data.value.mapValue.fields,"previous"),l.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),l)}}jg._jsonSchemaVersion="firestore/documentSnapshot/1.0",jg._jsonSchema={type:Ko("string",jg._jsonSchemaVersion),bundleSource:Ko("string","DocumentSnapshot"),bundleName:Ko("string"),bundle:Ko("string")};class ub extends jg{data(n={}){return super.data(n)}}class Gg{constructor(n,l,m,w){this._firestore=n,this._userDataWriter=l,this._snapshot=w,this.metadata=new Yv(w.hasPendingWrites,w.fromCache),this.query=m}get docs(){const n=[];return this.forEach((l=>n.push(l))),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,l){this._snapshot.docs.forEach((m=>{n.call(l,new ub(this._firestore,this._userDataWriter,m.key,m,new Yv(this._snapshot.mutatedKeys.has(m.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(n={}){const l=!!n.includeMetadataChanges;if(l&&this._snapshot.excludesMetadataChanges)throw new Ui(ti.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===l||(this._cachedChanges=(function(w,C){if(w._snapshot.oldDocs.isEmpty()){let D=0;return w._snapshot.docChanges.map((s=>{const G=new ub(w._firestore,w._userDataWriter,s.doc.key,s.doc,new Yv(w._snapshot.mutatedKeys.has(s.doc.key),w._snapshot.fromCache),w.query.converter);return s.doc,{type:"added",doc:G,oldIndex:-1,newIndex:D++}}))}{let D=w._snapshot.oldDocs;return w._snapshot.docChanges.filter((s=>C||s.type!==3)).map((s=>{const G=new ub(w._firestore,w._userDataWriter,s.doc.key,s.doc,new Yv(w._snapshot.mutatedKeys.has(s.doc.key),w._snapshot.fromCache),w.query.converter);let q=-1,te=-1;return s.type!==0&&(q=D.indexOf(s.doc.key),D=D.delete(s.doc.key)),s.type!==1&&(D=D.add(s.doc),te=D.indexOf(s.doc.key)),{type:bV(s.type),doc:G,oldIndex:q,newIndex:te}}))}})(this,l),this._cachedChangesIncludeMetadataChanges=l),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ui(ti.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n={};n.type=Gg._jsonSchemaVersion,n.bundleSource="QuerySnapshot",n.bundleName=KT.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const l=[],m=[],w=[];return this.docs.forEach((C=>{C._document!==null&&(l.push(C._document),m.push(this._userDataWriter.convertObjectMap(C._document.data.value.mapValue.fields,"previous")),w.push(C.ref.path))})),n.bundle=(this._firestore,this.query._query,n.bundleName,"NOT SUPPORTED"),n}}function bV(u){switch(u){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Bn(61501,{type:u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(u){u=Vc(u,vo);const n=Vc(u.firestore,ap);return rV(a1(n),u._key).then((l=>uP(n,u,l)))}Gg._jsonSchemaVersion="firestore/querySnapshot/1.0",Gg._jsonSchema={type:Ko("string",Gg._jsonSchemaVersion),bundleSource:Ko("string","QuerySnapshot"),bundleName:Ko("string"),bundle:Ko("string")};class LE extends xV{constructor(n){super(),this.firestore=n}convertBytes(n){return new th(n)}convertReference(n){const l=this.convertDocumentKey(n,this.firestore._databaseId);return new vo(this.firestore,null,l)}}function _x(u){u=Vc(u,td);const n=Vc(u.firestore,ap),l=a1(n),m=new LE(n);return sP(u._query),sV(l,u._query).then((w=>new Gg(n,m,u,w)))}function wV(u,n,l){u=Vc(u,vo);const m=Vc(u.firestore,ap),w=lP(u.converter,n);return f1(m,[eP(Dx(m),"setDoc",u._key,w,u.converter!==null,l).toMutation(u._key,ih.none())])}function df(u,n,l,...m){u=Vc(u,vo);const w=Vc(u.firestore,ap),C=Dx(w);let D;return D=typeof(n=Zs(n))=="string"||n instanceof l1?dV(C,"updateDoc",u._key,n,l,m):hV(C,"updateDoc",u._key,n),f1(w,[D.toMutation(u._key,ih.exists(!0))])}function zb(u){return f1(Vc(u.firestore,ap),[new rE(u._key,ih.none())])}function cP(u,n){const l=Vc(u.firestore,ap),m=lo(u),w=lP(u.converter,n);return f1(l,[eP(Dx(u.firestore),"addDoc",m._key,w,u.converter!==null,{}).toMutation(m._key,ih.exists(!1))]).then((()=>m))}function cp(u,...n){u=Zs(u);let l={includeMetadataChanges:!1,source:"default"},m=0;typeof n[m]!="object"||nC(n[m])||(l=n[m++]);const w={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(nC(n[m])){const G=n[m];n[m]=G.next?.bind(G),n[m+1]=G.error?.bind(G),n[m+2]=G.complete?.bind(G)}let C,D,s;if(u instanceof vo)D=Vc(u.firestore,ap),s=Kb(u._key.path),C={next:G=>{n[m]&&n[m](uP(D,u,G))},error:n[m+1],complete:n[m+2]};else{const G=Vc(u,td);D=Vc(G.firestore,ap),s=G._query;const q=new LE(D);C={next:te=>{n[m]&&n[m](new Gg(D,q,G,te))},error:n[m+1],complete:n[m+2]},sP(u._query)}return(function(q,te,ce,we){const ze=new EE(we),at=new bE(te,ze,ce);return q.asyncQueue.enqueueAndForget((async()=>yE(await Db(q),at))),()=>{ze.Nu(),q.asyncQueue.enqueueAndForget((async()=>vE(await Db(q),at)))}})(a1(D),s,w,C)}function f1(u,n){return(function(m,w){const C=new ep;return m.asyncQueue.enqueueAndForget((async()=>W5(await nV(m),w,C))),C.promise})(a1(u),n)}function uP(u,n,l){const m=l.docs.get(n._key),w=new LE(u);return new jg(u,w,n._key,m,new Yv(l.hasPendingWrites,l.fromCache),n.converter)}function Rm(){return new AE("serverTimestamp")}(function(n,l=!0){(function(w){Py=w})(Qg),Wg(new wm("firestore",((m,{instanceIdentifier:w,options:C})=>{const D=m.getProvider("app").getImmediate(),s=new ap(new hB(m.getProvider("auth-internal")),new pB(D,m.getProvider("app-check-internal")),(function(q,te){if(!Object.prototype.hasOwnProperty.apply(q.options,["projectId"]))throw new Ui(ti.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hx(q.options.projectId,te)})(D,w),D);return C={useFetchStreams:l,...C},s._setSettings(C),s}),"PUBLIC").setMultipleInstances(!0)),rf(lI,cI,n),rf(lI,cI,"esm2020")})();var TV="firebase",EV="12.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rf(TV,EV,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP="firebasestorage.googleapis.com",dP="storageBucket",SV=120*1e3,AV=600*1e3,IV=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo extends pf{constructor(n,l,m=0){super(qw(n),`Firebase Storage: ${l} (${qw(n)})`),this.status_=m,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,uo.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return qw(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Xs;(function(u){u.UNKNOWN="unknown",u.OBJECT_NOT_FOUND="object-not-found",u.BUCKET_NOT_FOUND="bucket-not-found",u.PROJECT_NOT_FOUND="project-not-found",u.QUOTA_EXCEEDED="quota-exceeded",u.UNAUTHENTICATED="unauthenticated",u.UNAUTHORIZED="unauthorized",u.UNAUTHORIZED_APP="unauthorized-app",u.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",u.INVALID_CHECKSUM="invalid-checksum",u.CANCELED="canceled",u.INVALID_EVENT_NAME="invalid-event-name",u.INVALID_URL="invalid-url",u.INVALID_DEFAULT_BUCKET="invalid-default-bucket",u.NO_DEFAULT_BUCKET="no-default-bucket",u.CANNOT_SLICE_BLOB="cannot-slice-blob",u.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",u.NO_DOWNLOAD_URL="no-download-url",u.INVALID_ARGUMENT="invalid-argument",u.INVALID_ARGUMENT_COUNT="invalid-argument-count",u.APP_DELETED="app-deleted",u.INVALID_ROOT_OPERATION="invalid-root-operation",u.INVALID_FORMAT="invalid-format",u.INTERNAL_ERROR="internal-error",u.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Xs||(Xs={}));function qw(u){return"storage/"+u}function zE(){const u="An unknown error occurred, please check the error payload for server response.";return new uo(Xs.UNKNOWN,u)}function CV(u){return new uo(Xs.OBJECT_NOT_FOUND,"Object '"+u+"' does not exist.")}function RV(u){return new uo(Xs.QUOTA_EXCEEDED,"Quota for bucket '"+u+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function MV(){const u="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new uo(Xs.UNAUTHENTICATED,u)}function PV(){return new uo(Xs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function DV(u){return new uo(Xs.UNAUTHORIZED,"User does not have permission to access '"+u+"'.")}function fP(){return new uo(Xs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function pP(){return new uo(Xs.CANCELED,"User canceled the upload/download.")}function OV(u){return new uo(Xs.INVALID_URL,"Invalid URL '"+u+"'.")}function LV(u){return new uo(Xs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+u+"'.")}function zV(){return new uo(Xs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+dP+"' property when initializing the app?")}function mP(){return new uo(Xs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function kV(){return new uo(Xs.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function NV(){return new uo(Xs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function FV(u){return new uo(Xs.UNSUPPORTED_ENVIRONMENT,`${u} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function ET(u){return new uo(Xs.INVALID_ARGUMENT,u)}function gP(){return new uo(Xs.APP_DELETED,"The Firebase app was deleted.")}function BV(u){return new uo(Xs.INVALID_ROOT_OPERATION,"The operation '"+u+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function nx(u,n){return new uo(Xs.INVALID_FORMAT,"String does not match format '"+u+"': "+n)}function Bv(u){throw new uo(Xs.INTERNAL_ERROR,"Internal error: "+u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(n,l){this.bucket=n,this.path_=l}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,l){let m;try{m=bu.makeFromUrl(n,l)}catch{return new bu(n,"")}if(m.path==="")return m;throw LV(n)}static makeFromUrl(n,l){let m=null;const w="([A-Za-z0-9.\\-_]+)";function C(wi){wi.path.charAt(wi.path.length-1)==="/"&&(wi.path_=wi.path_.slice(0,-1))}const D="(/(.*))?$",s=new RegExp("^gs://"+w+D,"i"),G={bucket:1,path:3};function q(wi){wi.path_=decodeURIComponent(wi.path)}const te="v[A-Za-z0-9_]+",ce=l.replace(/[.]/g,"\\."),we="(/([^?#]*).*)?$",ze=new RegExp(`^https?://${ce}/${te}/b/${w}/o${we}`,"i"),at={bucket:1,path:3},Ge=l===hP?"(?:storage.googleapis.com|storage.cloud.google.com)":l,Qe="([^?#]*)",xt=new RegExp(`^https?://${Ge}/${w}/${Qe}`,"i"),jt=[{regex:s,indices:G,postModify:C},{regex:ze,indices:at,postModify:q},{regex:xt,indices:{bucket:1,path:2},postModify:q}];for(let wi=0;wi<jt.length;wi++){const Ai=jt[wi],vi=Ai.regex.exec(n);if(vi){const Ve=vi[Ai.indices.bucket];let ke=vi[Ai.indices.path];ke||(ke=""),m=new bu(Ve,ke),Ai.postModify(m);break}}if(m==null)throw OV(n);return m}}class VV{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UV(u,n,l){let m=1,w=null,C=null,D=!1,s=0;function G(){return s===2}let q=!1;function te(...Qe){q||(q=!0,n.apply(null,Qe))}function ce(Qe){w=setTimeout(()=>{w=null,u(ze,G())},Qe)}function we(){C&&clearTimeout(C)}function ze(Qe,...xt){if(q){we();return}if(Qe){we(),te.call(null,Qe,...xt);return}if(G()||D){we(),te.call(null,Qe,...xt);return}m<64&&(m*=2);let jt;s===1?(s=2,jt=0):jt=(m+Math.random())*1e3,ce(jt)}let at=!1;function Ge(Qe){at||(at=!0,we(),!q&&(w!==null?(Qe||(s=2),clearTimeout(w),ce(0)):Qe||(s=1)))}return ce(0),C=setTimeout(()=>{D=!0,Ge(!0)},l),Ge}function jV(u){u(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GV(u){return u!==void 0}function qV(u){return typeof u=="function"}function HV(u){return typeof u=="object"&&!Array.isArray(u)}function p1(u){return typeof u=="string"||u instanceof String}function oC(u){return kE()&&u instanceof Blob}function kE(){return typeof Blob<"u"}function aC(u,n,l,m){if(m<n)throw ET(`Invalid value for '${u}'. Expected ${n} or greater.`);if(m>l)throw ET(`Invalid value for '${u}'. Expected ${l} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nx(u,n,l){let m=n;return l==null&&(m=`https://${n}`),`${l}://${m}/v0${u}`}function _P(u){const n=encodeURIComponent;let l="?";for(const m in u)if(u.hasOwnProperty(m)){const w=n(m)+"="+n(u[m]);l=l+w+"&"}return l=l.slice(0,-1),l}var qg;(function(u){u[u.NO_ERROR=0]="NO_ERROR",u[u.NETWORK_ERROR=1]="NETWORK_ERROR",u[u.ABORT=2]="ABORT"})(qg||(qg={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yP(u,n){const l=u>=500&&u<600,w=[408,429].indexOf(u)!==-1,C=n.indexOf(u)!==-1;return l||w||C}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WV{constructor(n,l,m,w,C,D,s,G,q,te,ce,we=!0,ze=!1){this.url_=n,this.method_=l,this.headers_=m,this.body_=w,this.successCodes_=C,this.additionalRetryCodes_=D,this.callback_=s,this.errorCallback_=G,this.timeout_=q,this.progressCallback_=te,this.connectionFactory_=ce,this.retry=we,this.isUsingEmulator=ze,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((at,Ge)=>{this.resolve_=at,this.reject_=Ge,this.start_()})}start_(){const n=(m,w)=>{if(w){m(!1,new Y0(!1,null,!0));return}const C=this.connectionFactory_();this.pendingConnection_=C;const D=s=>{const G=s.loaded,q=s.lengthComputable?s.total:-1;this.progressCallback_!==null&&this.progressCallback_(G,q)};this.progressCallback_!==null&&C.addUploadProgressListener(D),C.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&C.removeUploadProgressListener(D),this.pendingConnection_=null;const s=C.getErrorCode()===qg.NO_ERROR,G=C.getStatus();if(!s||yP(G,this.additionalRetryCodes_)&&this.retry){const te=C.getErrorCode()===qg.ABORT;m(!1,new Y0(!1,null,te));return}const q=this.successCodes_.indexOf(G)!==-1;m(!0,new Y0(q,C))})},l=(m,w)=>{const C=this.resolve_,D=this.reject_,s=w.connection;if(w.wasSuccessCode)try{const G=this.callback_(s,s.getResponse());GV(G)?C(G):C()}catch(G){D(G)}else if(s!==null){const G=zE();G.serverResponse=s.getErrorText(),this.errorCallback_?D(this.errorCallback_(s,G)):D(G)}else if(w.canceled){const G=this.appDelete_?gP():pP();D(G)}else{const G=fP();D(G)}};this.canceled_?l(!1,new Y0(!1,null,!0)):this.backoffId_=UV(n,l,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&jV(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Y0{constructor(n,l,m){this.wasSuccessCode=n,this.connection=l,this.canceled=!!m}}function $V(u,n){n!==null&&n.length>0&&(u.Authorization="Firebase "+n)}function ZV(u,n){u["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function XV(u,n){n&&(u["X-Firebase-GMPID"]=n)}function YV(u,n){n!==null&&(u["X-Firebase-AppCheck"]=n)}function KV(u,n,l,m,w,C,D=!0,s=!1){const G=_P(u.urlParams),q=u.url+G,te=Object.assign({},u.headers);return XV(te,n),$V(te,l),ZV(te,C),YV(te,m),new WV(q,u.method,te,u.body,u.successCodes,u.additionalRetryCodes,u.handler,u.errorHandler,u.timeout,u.progressCallback,w,D,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function JV(...u){const n=QV();if(n!==void 0){const l=new n;for(let m=0;m<u.length;m++)l.append(u[m]);return l.getBlob()}else{if(kE())return new Blob(u);throw new uo(Xs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function eU(u,n,l){return u.webkitSlice?u.webkitSlice(n,l):u.mozSlice?u.mozSlice(n,l):u.slice?u.slice(n,l):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tU(u){if(typeof atob>"u")throw FV("base-64");return atob(u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nf={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Hw{constructor(n,l){this.data=n,this.contentType=l||null}}function iU(u,n){switch(u){case nf.RAW:return new Hw(vP(n));case nf.BASE64:case nf.BASE64URL:return new Hw(xP(u,n));case nf.DATA_URL:return new Hw(rU(n),sU(n))}throw zE()}function vP(u){const n=[];for(let l=0;l<u.length;l++){let m=u.charCodeAt(l);if(m<=127)n.push(m);else if(m<=2047)n.push(192|m>>6,128|m&63);else if((m&64512)===55296)if(!(l<u.length-1&&(u.charCodeAt(l+1)&64512)===56320))n.push(239,191,189);else{const C=m,D=u.charCodeAt(++l);m=65536|(C&1023)<<10|D&1023,n.push(240|m>>18,128|m>>12&63,128|m>>6&63,128|m&63)}else(m&64512)===56320?n.push(239,191,189):n.push(224|m>>12,128|m>>6&63,128|m&63)}return new Uint8Array(n)}function nU(u){let n;try{n=decodeURIComponent(u)}catch{throw nx(nf.DATA_URL,"Malformed data URL.")}return vP(n)}function xP(u,n){switch(u){case nf.BASE64:{const w=n.indexOf("-")!==-1,C=n.indexOf("_")!==-1;if(w||C)throw nx(u,"Invalid character '"+(w?"-":"_")+"' found: is it base64url encoded?");break}case nf.BASE64URL:{const w=n.indexOf("+")!==-1,C=n.indexOf("/")!==-1;if(w||C)throw nx(u,"Invalid character '"+(w?"+":"/")+"' found: is it base64 encoded?");n=n.replace(/-/g,"+").replace(/_/g,"/");break}}let l;try{l=tU(n)}catch(w){throw w.message.includes("polyfill")?w:nx(u,"Invalid character found")}const m=new Uint8Array(l.length);for(let w=0;w<l.length;w++)m[w]=l.charCodeAt(w);return m}class bP{constructor(n){this.base64=!1,this.contentType=null;const l=n.match(/^data:([^,]+)?,/);if(l===null)throw nx(nf.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const m=l[1]||null;m!=null&&(this.base64=oU(m,";base64"),this.contentType=this.base64?m.substring(0,m.length-7):m),this.rest=n.substring(n.indexOf(",")+1)}}function rU(u){const n=new bP(u);return n.base64?xP(nf.BASE64,n.rest):nU(n.rest)}function sU(u){return new bP(u).contentType}function oU(u,n){return u.length>=n.length?u.substring(u.length-n.length)===n:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(n,l){let m=0,w="";oC(n)?(this.data_=n,m=n.size,w=n.type):n instanceof ArrayBuffer?(l?this.data_=new Uint8Array(n):(this.data_=new Uint8Array(n.byteLength),this.data_.set(new Uint8Array(n))),m=this.data_.length):n instanceof Uint8Array&&(l?this.data_=n:(this.data_=new Uint8Array(n.length),this.data_.set(n)),m=n.length),this.size_=m,this.type_=w}size(){return this.size_}type(){return this.type_}slice(n,l){if(oC(this.data_)){const m=this.data_,w=eU(m,n,l);return w===null?null:new gm(w)}else{const m=new Uint8Array(this.data_.buffer,n,l-n);return new gm(m,!0)}}static getBlob(...n){if(kE()){const l=n.map(m=>m instanceof gm?m.data_:m);return new gm(JV.apply(null,l))}else{const l=n.map(D=>p1(D)?iU(nf.RAW,D).data:D.data_);let m=0;l.forEach(D=>{m+=D.byteLength});const w=new Uint8Array(m);let C=0;return l.forEach(D=>{for(let s=0;s<D.length;s++)w[C++]=D[s]}),new gm(w,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wP(u){let n;try{n=JSON.parse(u)}catch{return null}return HV(n)?n:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aU(u){if(u.length===0)return null;const n=u.lastIndexOf("/");return n===-1?"":u.slice(0,n)}function lU(u,n){const l=n.split("/").filter(m=>m.length>0).join("/");return u.length===0?l:u+"/"+l}function TP(u){const n=u.lastIndexOf("/",u.length-2);return n===-1?u:u.slice(n+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cU(u,n){return n}class rc{constructor(n,l,m,w){this.server=n,this.local=l||n,this.writable=!!m,this.xform=w||cU}}let K0=null;function uU(u){return!p1(u)||u.length<2?u:TP(u)}function EP(){if(K0)return K0;const u=[];u.push(new rc("bucket")),u.push(new rc("generation")),u.push(new rc("metageneration")),u.push(new rc("name","fullPath",!0));function n(C,D){return uU(D)}const l=new rc("name");l.xform=n,u.push(l);function m(C,D){return D!==void 0?Number(D):D}const w=new rc("size");return w.xform=m,u.push(w),u.push(new rc("timeCreated")),u.push(new rc("updated")),u.push(new rc("md5Hash",null,!0)),u.push(new rc("cacheControl",null,!0)),u.push(new rc("contentDisposition",null,!0)),u.push(new rc("contentEncoding",null,!0)),u.push(new rc("contentLanguage",null,!0)),u.push(new rc("contentType",null,!0)),u.push(new rc("metadata","customMetadata",!0)),K0=u,K0}function hU(u,n){function l(){const m=u.bucket,w=u.fullPath,C=new bu(m,w);return n._makeStorageReference(C)}Object.defineProperty(u,"ref",{get:l})}function dU(u,n,l){const m={};m.type="file";const w=l.length;for(let C=0;C<w;C++){const D=l[C];m[D.local]=D.xform(m,n[D.server])}return hU(m,u),m}function SP(u,n,l){const m=wP(n);return m===null?null:dU(u,m,l)}function fU(u,n,l,m){const w=wP(n);if(w===null||!p1(w.downloadTokens))return null;const C=w.downloadTokens;if(C.length===0)return null;const D=encodeURIComponent;return C.split(",").map(q=>{const te=u.bucket,ce=u.fullPath,we="/b/"+D(te)+"/o/"+D(ce),ze=Nx(we,l,m),at=_P({alt:"media",token:q});return ze+at})[0]}function AP(u,n){const l={},m=n.length;for(let w=0;w<m;w++){const C=n[w];C.writable&&(l[C.server]=u[C.local])}return JSON.stringify(l)}class ky{constructor(n,l,m,w){this.url=n,this.method=l,this.handler=m,this.timeout=w,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tp(u){if(!u)throw zE()}function NE(u,n){function l(m,w){const C=SP(u,w,n);return tp(C!==null),C}return l}function pU(u,n){function l(m,w){const C=SP(u,w,n);return tp(C!==null),fU(C,w,u.host,u._protocol)}return l}function Fx(u){function n(l,m){let w;return l.getStatus()===401?l.getErrorText().includes("Firebase App Check token is invalid")?w=PV():w=MV():l.getStatus()===402?w=RV(u.bucket):l.getStatus()===403?w=DV(u.path):w=m,w.status=l.getStatus(),w.serverResponse=m.serverResponse,w}return n}function IP(u){const n=Fx(u);function l(m,w){let C=n(m,w);return m.getStatus()===404&&(C=CV(u.path)),C.serverResponse=w.serverResponse,C}return l}function mU(u,n,l){const m=n.fullServerUrl(),w=Nx(m,u.host,u._protocol),C="GET",D=u.maxOperationRetryTime,s=new ky(w,C,NE(u,l),D);return s.errorHandler=IP(n),s}function gU(u,n,l){const m=n.fullServerUrl(),w=Nx(m,u.host,u._protocol),C="GET",D=u.maxOperationRetryTime,s=new ky(w,C,pU(u,l),D);return s.errorHandler=IP(n),s}function _U(u,n){return u&&u.contentType||n&&n.type()||"application/octet-stream"}function CP(u,n,l){const m=Object.assign({},l);return m.fullPath=u.path,m.size=n.size(),m.contentType||(m.contentType=_U(null,n)),m}function yU(u,n,l,m,w){const C=n.bucketOnlyServerUrl(),D={"X-Goog-Upload-Protocol":"multipart"};function s(){let jt="";for(let wi=0;wi<2;wi++)jt=jt+Math.random().toString().slice(2);return jt}const G=s();D["Content-Type"]="multipart/related; boundary="+G;const q=CP(n,m,w),te=AP(q,l),ce="--"+G+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+te+`\r
--`+G+`\r
Content-Type: `+q.contentType+`\r
\r
`,we=`\r
--`+G+"--",ze=gm.getBlob(ce,m,we);if(ze===null)throw mP();const at={name:q.fullPath},Ge=Nx(C,u.host,u._protocol),Qe="POST",xt=u.maxUploadRetryTime,wt=new ky(Ge,Qe,NE(u,l),xt);return wt.urlParams=at,wt.headers=D,wt.body=ze.uploadData(),wt.errorHandler=Fx(n),wt}class kb{constructor(n,l,m,w){this.current=n,this.total=l,this.finalized=!!m,this.metadata=w||null}}function FE(u,n){let l=null;try{l=u.getResponseHeader("X-Goog-Upload-Status")}catch{tp(!1)}return tp(!!l&&(n||["active"]).indexOf(l)!==-1),l}function vU(u,n,l,m,w){const C=n.bucketOnlyServerUrl(),D=CP(n,m,w),s={name:D.fullPath},G=Nx(C,u.host,u._protocol),q="POST",te={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${m.size()}`,"X-Goog-Upload-Header-Content-Type":D.contentType,"Content-Type":"application/json; charset=utf-8"},ce=AP(D,l),we=u.maxUploadRetryTime;function ze(Ge){FE(Ge);let Qe;try{Qe=Ge.getResponseHeader("X-Goog-Upload-URL")}catch{tp(!1)}return tp(p1(Qe)),Qe}const at=new ky(G,q,ze,we);return at.urlParams=s,at.headers=te,at.body=ce,at.errorHandler=Fx(n),at}function xU(u,n,l,m){const w={"X-Goog-Upload-Command":"query"};function C(q){const te=FE(q,["active","final"]);let ce=null;try{ce=q.getResponseHeader("X-Goog-Upload-Size-Received")}catch{tp(!1)}ce||tp(!1);const we=Number(ce);return tp(!isNaN(we)),new kb(we,m.size(),te==="final")}const D="POST",s=u.maxUploadRetryTime,G=new ky(l,D,C,s);return G.headers=w,G.errorHandler=Fx(n),G}const lC=256*1024;function bU(u,n,l,m,w,C,D,s){const G=new kb(0,0);if(D?(G.current=D.current,G.total=D.total):(G.current=0,G.total=m.size()),m.size()!==G.total)throw kV();const q=G.total-G.current;let te=q;w>0&&(te=Math.min(te,w));const ce=G.current,we=ce+te;let ze="";te===0?ze="finalize":q===te?ze="upload, finalize":ze="upload";const at={"X-Goog-Upload-Command":ze,"X-Goog-Upload-Offset":`${G.current}`},Ge=m.slice(ce,we);if(Ge===null)throw mP();function Qe(wi,Ai){const vi=FE(wi,["active","final"]),Ve=G.current+te,ke=m.size();let We;return vi==="final"?We=NE(n,C)(wi,Ai):We=null,new kb(Ve,ke,vi==="final",We)}const xt="POST",wt=n.maxUploadRetryTime,jt=new ky(l,xt,Qe,wt);return jt.headers=at,jt.body=Ge.uploadData(),jt.progressCallback=s||null,jt.errorHandler=Fx(u),jt}const kc={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ww(u){switch(u){case"running":case"pausing":case"canceling":return kc.RUNNING;case"paused":return kc.PAUSED;case"success":return kc.SUCCESS;case"canceled":return kc.CANCELED;case"error":return kc.ERROR;default:return kc.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wU{constructor(n,l,m){if(qV(n)||l!=null||m!=null)this.next=n,this.error=l??void 0,this.complete=m??void 0;else{const C=n;this.next=C.next,this.error=C.error,this.complete=C.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ry(u){return(...n)=>{Promise.resolve().then(()=>u(...n))}}class TU{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=qg.NO_ERROR,this.sendPromise_=new Promise(n=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=qg.ABORT,n()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=qg.NETWORK_ERROR,n()}),this.xhr_.addEventListener("load",()=>{n()})})}send(n,l,m,w,C){if(this.sent_)throw Bv("cannot .send() more than once");if(Pm(n)&&m&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(l,n,!0),C!==void 0)for(const D in C)C.hasOwnProperty(D)&&this.xhr_.setRequestHeader(D,C[D].toString());return w!==void 0?this.xhr_.send(w):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Bv("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Bv("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Bv("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Bv("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(n){return this.xhr_.getResponseHeader(n)}addUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",n)}removeUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",n)}}class EU extends TU{initXhr(){this.xhr_.responseType="text"}}function hy(){return new EU}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(n,l,m=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=n,this._blob=l,this._metadata=m,this._mappings=EP(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=w=>{if(this._request=void 0,this._chunkMultiplier=1,w._codeEquals(Xs.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const C=this.isExponentialBackoffExpired();if(yP(w.status,[]))if(C)w=fP();else{this.sleepTime=Math.max(this.sleepTime*2,IV),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=w,this._transition("error")}},this._metadataErrorHandler=w=>{this._request=void 0,w._codeEquals(Xs.CANCELED)?this.completeTransitions_():(this._error=w,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((w,C)=>{this._resolve=w,this._reject=C,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const n=this._transferred;return l=>this._updateProgress(n+l)}_shouldDoResumable(n){return n.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([l,m])=>{switch(this._state){case"running":n(l,m);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((n,l)=>{const m=vU(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),w=this._ref.storage._makeRequest(m,hy,n,l);this._request=w,w.getPromise().then(C=>{this._request=void 0,this._uploadUrl=C,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const n=this._uploadUrl;this._resolveToken((l,m)=>{const w=xU(this._ref.storage,this._ref._location,n,this._blob),C=this._ref.storage._makeRequest(w,hy,l,m);this._request=C,C.getPromise().then(D=>{D=D,this._request=void 0,this._updateProgress(D.current),this._needToFetchStatus=!1,D.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const n=lC*this._chunkMultiplier,l=new kb(this._transferred,this._blob.size()),m=this._uploadUrl;this._resolveToken((w,C)=>{let D;try{D=bU(this._ref._location,this._ref.storage,m,this._blob,n,this._mappings,l,this._makeProgressCallback())}catch(G){this._error=G,this._transition("error");return}const s=this._ref.storage._makeRequest(D,hy,w,C,!1);this._request=s,s.getPromise().then(G=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(G.current),G.finalized?(this._metadata=G.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){lC*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((n,l)=>{const m=mU(this._ref.storage,this._ref._location,this._mappings),w=this._ref.storage._makeRequest(m,hy,n,l);this._request=w,w.getPromise().then(C=>{this._request=void 0,this._metadata=C,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((n,l)=>{const m=yU(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),w=this._ref.storage._makeRequest(m,hy,n,l);this._request=w,w.getPromise().then(C=>{this._request=void 0,this._metadata=C,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(n){const l=this._transferred;this._transferred=n,this._transferred!==l&&this._notifyObservers()}_transition(n){if(this._state!==n)switch(n){case"canceling":case"pausing":this._state=n,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const l=this._state==="paused";this._state=n,l&&(this._notifyObservers(),this._start());break;case"paused":this._state=n,this._notifyObservers();break;case"canceled":this._error=pP(),this._state=n,this._notifyObservers();break;case"error":this._state=n,this._notifyObservers();break;case"success":this._state=n,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const n=Ww(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:n,metadata:this._metadata,task:this,ref:this._ref}}on(n,l,m,w){const C=new wU(l||void 0,m||void 0,w||void 0);return this._addObserver(C),()=>{this._removeObserver(C)}}then(n,l){return this._promise.then(n,l)}catch(n){return this.then(null,n)}_addObserver(n){this._observers.push(n),this._notifyObserver(n)}_removeObserver(n){const l=this._observers.indexOf(n);l!==-1&&this._observers.splice(l,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(l=>{this._notifyObserver(l)})}_finishPromise(){if(this._resolve!==void 0){let n=!0;switch(Ww(this._state)){case kc.SUCCESS:ry(this._resolve.bind(null,this.snapshot))();break;case kc.CANCELED:case kc.ERROR:const l=this._reject;ry(l.bind(null,this._error))();break;default:n=!1;break}n&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(n){switch(Ww(this._state)){case kc.RUNNING:case kc.PAUSED:n.next&&ry(n.next.bind(n,this.snapshot))();break;case kc.SUCCESS:n.complete&&ry(n.complete.bind(n))();break;case kc.CANCELED:case kc.ERROR:n.error&&ry(n.error.bind(n,this._error))();break;default:n.error&&ry(n.error.bind(n,this._error))()}}resume(){const n=this._state==="paused"||this._state==="pausing";return n&&this._transition("running"),n}pause(){const n=this._state==="running";return n&&this._transition("pausing"),n}cancel(){const n=this._state==="running"||this._state==="pausing";return n&&this._transition("canceling"),n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(n,l){this._service=n,l instanceof bu?this._location=l:this._location=bu.makeFromUrl(l,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,l){return new Kg(n,l)}get root(){const n=new bu(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return TP(this._location.path)}get storage(){return this._service}get parent(){const n=aU(this._location.path);if(n===null)return null;const l=new bu(this._location.bucket,n);return new Kg(this._service,l)}_throwIfRoot(n){if(this._location.path==="")throw BV(n)}}function AU(u,n,l){return u._throwIfRoot("uploadBytesResumable"),new SU(u,new gm(n),l)}function IU(u){u._throwIfRoot("getDownloadURL");const n=gU(u.storage,u._location,EP());return u.storage.makeRequestWithTokens(n,hy).then(l=>{if(l===null)throw NV();return l})}function CU(u,n){const l=lU(u._location.path,n),m=new bu(u._location.bucket,l);return new Kg(u.storage,m)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RU(u){return/^[A-Za-z]+:\/\//.test(u)}function MU(u,n){return new Kg(u,n)}function RP(u,n){if(u instanceof BE){const l=u;if(l._bucket==null)throw zV();const m=new Kg(l,l._bucket);return n!=null?RP(m,n):m}else return n!==void 0?CU(u,n):u}function PU(u,n){if(n&&RU(n)){if(u instanceof BE)return MU(u,n);throw ET("To use ref(service, url), the first argument must be a Storage instance.")}else return RP(u,n)}function cC(u,n){const l=n?.[dP];return l==null?null:bu.makeFromBucketSpec(l,u)}function DU(u,n,l,m={}){u.host=`${n}:${l}`;const w=Pm(n);w&&(zT(`https://${u.host}/b`),kT("Storage",!0)),u._isUsingEmulator=!0,u._protocol=w?"https":"http";const{mockUserToken:C}=m;C&&(u._overrideAuthToken=typeof C=="string"?C:YC(C,u.app.options.projectId))}class BE{constructor(n,l,m,w,C,D=!1){this.app=n,this._authProvider=l,this._appCheckProvider=m,this._url=w,this._firebaseVersion=C,this._isUsingEmulator=D,this._bucket=null,this._host=hP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=SV,this._maxUploadRetryTime=AV,this._requests=new Set,w!=null?this._bucket=bu.makeFromBucketSpec(w,this._host):this._bucket=cC(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=bu.makeFromBucketSpec(this._url,n):this._bucket=cC(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){aC("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){aC("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const l=await n.getToken();if(l!==null)return l.accessToken}return null}async _getAppCheckToken(){if(Nc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new Kg(this,n)}_makeRequest(n,l,m,w,C=!0){if(this._deleted)return new VV(gP());{const D=KV(n,this._appId,m,w,l,this._firebaseVersion,C,this._isUsingEmulator);return this._requests.add(D),D.getPromise().then(()=>this._requests.delete(D),()=>this._requests.delete(D)),D}}async makeRequestWithTokens(n,l){const[m,w]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,l,m,w).getPromise()}}const uC="@firebase/storage",hC="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP="storage";function OU(u,n,l){return u=Zs(u),AU(u,n,l)}function LU(u){return u=Zs(u),IU(u)}function zU(u,n){return u=Zs(u),PU(u,n)}function kU(u=BT(),n){u=Zs(u);const m=jb(u,MP).getImmediate({identifier:n}),w=$C("storage");return w&&NU(m,...w),m}function NU(u,n,l,m={}){DU(u,n,l,m)}function FU(u,{instanceIdentifier:n}){const l=u.getProvider("app").getImmediate(),m=u.getProvider("auth-internal"),w=u.getProvider("app-check-internal");return new BE(l,m,w,n,Qg)}function BU(){Wg(new wm(MP,FU,"PUBLIC").setMultipleInstances(!0)),rf(uC,hC,""),rf(uC,hC,"esm2020")}BU();const VU={apiKey:"AIzaSyCNmByPZ9TpGW_H0vsDS7sF_Jq4GHlCzJY",authDomain:"expedify-app.firebaseapp.com",projectId:"expedify-app",storageBucket:"expedify-app.firebasestorage.app",messagingSenderId:"483138171109",appId:"1:483138171109:web:84c021fa2cfa6a101da40c"},VE=JC(VU),Bc=Ax(VE);new ef;const $s=zy(VE),UU=kU(VE),UE="/assets/gecko3-CtJXCV38.png",m1=({children:u})=>Y.jsxs("div",{className:"flex h-screen",children:[Y.jsx("div",{className:"flex flex-1 flex-col items-center justify-center bg-white text-center px-6",children:u}),Y.jsx("div",{className:"hidden md:flex absolute top-0 w-[15%] right-0 h-screen bg-[#202007] bg-expedify-dark items-center justify-center",children:Y.jsx("img",{src:UE,alt:"Expedify mascot",className:"w-[100%] scale-200 object-contain absolute top-[14%] right-[35%]"})})]}),jU=async()=>{const u=new ef;return u.setCustomParameters({prompt:"select_account"}),_F(Bc,u)},dC=u=>{let n;const l=new Set,m=(q,te)=>{const ce=typeof q=="function"?q(n):q;if(!Object.is(ce,n)){const we=n;n=te??(typeof ce!="object"||ce===null)?ce:Object.assign({},n,ce),l.forEach(ze=>ze(n,we))}},w=()=>n,s={setState:m,getState:w,getInitialState:()=>G,subscribe:q=>(l.add(q),()=>l.delete(q))},G=n=u(m,w,s);return s},GU=(u=>u?dC(u):dC),qU=u=>u;function HU(u,n=qU){const l=qv.useSyncExternalStore(u.subscribe,qv.useCallback(()=>n(u.getState()),[u,n]),qv.useCallback(()=>n(u.getInitialState()),[u,n]));return qv.useDebugValue(l),l}const WU=u=>{const n=GU(u),l=m=>HU(n,m);return Object.assign(l,n),l},$U=(u=>WU);function ZU(u,n){let l;try{l=u()}catch{return}return{getItem:w=>{var C;const D=G=>G===null?null:JSON.parse(G,void 0),s=(C=l.getItem(w))!=null?C:null;return s instanceof Promise?s.then(D):D(s)},setItem:(w,C)=>l.setItem(w,JSON.stringify(C,void 0)),removeItem:w=>l.removeItem(w)}}const ST=u=>n=>{try{const l=u(n);return l instanceof Promise?l:{then(m){return ST(m)(l)},catch(m){return this}}}catch(l){return{then(m){return this},catch(m){return ST(m)(l)}}}},XU=(u,n)=>(l,m,w)=>{let C={storage:ZU(()=>localStorage),partialize:Ge=>Ge,version:0,merge:(Ge,Qe)=>({...Qe,...Ge}),...n},D=!1;const s=new Set,G=new Set;let q=C.storage;if(!q)return u((...Ge)=>{console.warn(`[zustand persist middleware] Unable to update item '${C.name}', the given storage is currently unavailable.`),l(...Ge)},m,w);const te=()=>{const Ge=C.partialize({...m()});return q.setItem(C.name,{state:Ge,version:C.version})},ce=w.setState;w.setState=(Ge,Qe)=>(ce(Ge,Qe),te());const we=u((...Ge)=>(l(...Ge),te()),m,w);w.getInitialState=()=>we;let ze;const at=()=>{var Ge,Qe;if(!q)return;D=!1,s.forEach(wt=>{var jt;return wt((jt=m())!=null?jt:we)});const xt=((Qe=C.onRehydrateStorage)==null?void 0:Qe.call(C,(Ge=m())!=null?Ge:we))||void 0;return ST(q.getItem.bind(q))(C.name).then(wt=>{if(wt)if(typeof wt.version=="number"&&wt.version!==C.version){if(C.migrate){const jt=C.migrate(wt.state,wt.version);return jt instanceof Promise?jt.then(wi=>[!0,wi]):[!0,jt]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,wt.state];return[!1,void 0]}).then(wt=>{var jt;const[wi,Ai]=wt;if(ze=C.merge(Ai,(jt=m())!=null?jt:we),l(ze,!0),wi)return te()}).then(()=>{xt?.(ze,void 0),ze=m(),D=!0,G.forEach(wt=>wt(ze))}).catch(wt=>{xt?.(void 0,wt)})};return w.persist={setOptions:Ge=>{C={...C,...Ge},Ge.storage&&(q=Ge.storage)},clearStorage:()=>{q?.removeItem(C.name)},getOptions:()=>C,rehydrate:()=>at(),hasHydrated:()=>D,onHydrate:Ge=>(s.add(Ge),()=>{s.delete(Ge)}),onFinishHydration:Ge=>(G.add(Ge),()=>{G.delete(Ge)})},C.skipHydration||at(),ze||we},YU=XU,Xa=$U()(YU(u=>({user:null,userData:null,bookings:null,activeTab:"Scheduled",nearbyBookings:null,location:null,onboardingDone:!1,locationPermission:null,notifPermission:null,showCall:!1,hasProfile:null,loading:!0,RushBooking:null,currentTab:"current",mybookings:null,selectedClient:null,setSelectedClient:n=>u({selectedClient:n}),setShowCall:n=>u({showCall:n}),setCurrentTabs:n=>u({currentTab:n}),setRushBooking:n=>u({RushBooking:n}),setActiveTab:n=>u({activeTab:n}),setMyBookings:n=>u({mybookings:n}),setUser:n=>u({user:n}),setLocation:n=>u({location:n}),setNearbyBookings:n=>u({nearbyBookings:n}),setBookings:n=>u({bookings:n}),setUserData:n=>u({userData:n}),setOnboardingDone:n=>u({onboardingDone:n}),setLocationPermission:n=>u({locationPermission:n}),setNotifPermission:n=>u({notifPermission:n}),setHasProfile:n=>u({hasProfile:n}),setLoading:n=>u({loading:n})}),{name:"expedify-store",partialize:u=>({onboardingDone:u.onboardingDone,locationPermission:u.locationPermission,notifPermission:u.notifPermission})})),KU=()=>{const[u,n]=st.useState(""),[l,m]=st.useState(""),[w,C]=st.useState(""),D=hp(),s=rh(),{setUser:G,setUserData:q}=Xa(),te=async we=>{const ze=s.state?.from||"/dashboard";we.preventDefault();try{const Ge=(await $N(Bc,u,l)).user;G(Ge);const Qe=lo($s,"users",Ge.uid),xt=await hf(Qe);xt.exists()?q(xt.data()):q(null),D(ze,{replace:!0})}catch(at){C(at.message)}},ce=async()=>{console.log(s.state);const we=s.state?.from||"/dashboard";try{const ze=await jU();if(ze){const at=ze.user;G(at);const Ge=lo($s,"users",at.uid),Qe=await hf(Ge);Qe.exists()?q(Qe.data()):q(null),D(we,{replace:!0})}}catch(ze){C(ze.message)}};return Y.jsx(m1,{children:Y.jsxs("form",{onSubmit:te,className:"flex flex-col justify-center items-center w-full max-w-sm mx-auto bg-white shadow-lg rounded-2xl p-8 space-y-4",children:[Y.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"Sign In"}),Y.jsx("input",{type:"email",placeholder:"Email",value:u,onChange:we=>n(we.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"}),Y.jsx("input",{type:"password",placeholder:"Password",value:l,onChange:we=>m(we.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"}),Y.jsx("div",{className:"w-full flex justify-end",children:Y.jsx(yy,{to:"/forgot",className:"text-sm text-amber-600 hover:underline",children:"Forgot Password?"})}),Y.jsx("button",{type:"submit",className:"w-full bg-amber-500 text-white font-semibold py-2 rounded-full hover:bg-amber-600 transition-all",children:"Next"}),Y.jsxs("button",{type:"button",onClick:ce,className:"w-full flex items-center justify-center gap-2 border border-gray-300 rounded-full py-2 text-gray-700 hover:bg-gray-50 transition-all",children:[Y.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"Google",className:"w-5 h-5"}),"Sign in with Google"]}),w&&Y.jsx("p",{className:"text-red-500 text-sm text-center",children:w}),Y.jsxs("p",{className:"text-sm text-gray-600",children:["Dont have an account?"," ",Y.jsx(yy,{to:"/signup",className:"text-amber-600 font-semibold hover:underline",children:"Sign Up"})]})]})})},QU=()=>{const[u,n]=st.useState(""),[l,m]=st.useState(""),[w,C]=st.useState(""),[D,s]=st.useState(""),G=hp(),q=async te=>{if(te.preventDefault(),l!==w){s("Passwords do not match");return}try{await WN(Bc,u,l),G("/signin")}catch(ce){s(ce.message)}};return Y.jsx(m1,{children:Y.jsxs("form",{onSubmit:q,className:"flex flex-col justify-center items-center w-full max-w-sm mx-auto bg-white shadow-lg rounded-2xl p-8 space-y-4",children:[Y.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"Create Account"}),Y.jsx("input",{type:"email",placeholder:"Email",value:u,onChange:te=>n(te.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"}),Y.jsx("input",{type:"password",placeholder:"Password",value:l,onChange:te=>m(te.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"}),Y.jsx("input",{type:"password",placeholder:"Confirm Password",value:w,onChange:te=>C(te.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"}),Y.jsx("button",{type:"submit",className:"w-full bg-amber-500 text-white font-semibold py-2 rounded-full hover:bg-amber-600 transition-all",children:"Next"}),D&&Y.jsx("p",{className:"text-red-500 text-sm text-center",children:D}),Y.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",Y.jsx(yy,{to:"/signin",className:"text-amber-600 font-semibold hover:underline",children:"Sign In"})]})]})})},JU=()=>{const[u,n]=st.useState(""),[l,m]=st.useState(""),[w,C]=st.useState(""),D=async s=>{s.preventDefault();try{await qN(Bc,u),m("Reset link sent! Check your email."),C("")}catch(G){C(G.message)}};return Y.jsx(m1,{children:Y.jsxs("form",{className:"auth-form",onSubmit:D,children:[Y.jsx("h2",{children:"Reset Password"}),Y.jsx("input",{type:"email",placeholder:"Enter your email",value:u,onChange:s=>n(s.target.value),required:!0}),Y.jsx("button",{type:"submit",className:"btn-primary",children:"Send Reset Link"}),l&&Y.jsx("p",{className:"success",children:l}),w&&Y.jsx("p",{className:"error",children:w}),Y.jsxs("p",{className:"small",children:["Back to ",Y.jsx(yy,{to:"/signin",children:"Sign In"})]})]})})},ej="/assets/logo-Dy0fKcTx.png",PP=()=>Y.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-white animate-fade-in",children:Y.jsx("img",{src:ej,alt:"Expedify logo",className:"w-40 h-auto animate-pulse mb-2"})}),Mm="/assets/gecko-D1PLfWsO.png",jE="/assets/gecko1-BfnLn9tV.png",DP="/assets/gecko2-ulhLZo23.png",Vv=[{image:Mm,text:"Expedify is a Cebu-based mobile platform for real-time photography and videography bookings."},{image:jE,text:"Connecting clients with vetted professionals, offering instant access, transparent pricing, and user-reviewed portfolios."},{image:DP,text:"With scalable systems and a focus on speed and trust, Expedify makes hiring creative services simple and reliable."}],tj=()=>{const[u,n]=st.useState(0),l=hp(),{setOnboardingDone:m,onboardingDone:w}=Xa();st.useEffect(()=>{w&&l("/signin")},[l]);const C=()=>{u<Vv.length-1?n(D=>D+1):(m(!0),l("/signin"))};return Y.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-expedify-dark text-white text-center px-6",children:[Y.jsx("img",{src:Vv[u].image,alt:"Expedify Slide",className:"w-56 h-auto mb-8 animate-float"}),Y.jsx("p",{className:"text-lg md:text-xl leading-relaxed max-w-lg mb-8 text-black",children:Vv[u].text}),Y.jsx("div",{className:"flex space-x-2 mb-8",children:Vv.map((D,s)=>Y.jsx("span",{className:`w-3 h-3 rounded-full transition-all duration-300 ${s===u?"bg-expedify-gold":"bg-white/30"}`},s))}),Y.jsx("button",{onClick:C,className:"bg-expedify-gold text-black font-semibold px-10 py-3 rounded-full hover:scale-105 transition",children:u===Vv.length-1?"Start":"Next"})]})},ij=()=>{const u=hp(),n=Bc.currentUser,[l]=st.useState(n?.email||""),[m,w]=st.useState(""),[C,D]=st.useState(""),[s,G]=st.useState(""),[q,te]=st.useState(""),ce=async we=>{if(we.preventDefault(),!!n){if(m!==C){te("Passwords do not match");return}try{await wV(lo($s,"users",n.uid),{email:l,gender:s,fullName:"",userType:"Client",photoURL:"",createdAt:Rm(),averageRating:0,clients:0,isBook:!1}),u("/dashboard")}catch(ze){te(ze.message)}}};return Y.jsx(m1,{children:Y.jsxs("form",{onSubmit:ce,className:"flex flex-col w-full max-w-sm text-left space-y-4",children:[Y.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Create your profile"}),Y.jsx("input",{type:"email",value:l,readOnly:!0,className:"w-full p-2 border rounded-lg bg-gray-100 text-gray-600"}),Y.jsx("input",{type:"password",placeholder:"Password",value:m,onChange:we=>w(we.target.value),required:!0,className:"w-full p-2 border rounded-lg"}),Y.jsx("input",{type:"password",placeholder:"Confirm Password",value:C,onChange:we=>D(we.target.value),required:!0,className:"w-full p-2 border rounded-lg"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"font-medium mb-2",children:"Gender"}),Y.jsx("div",{className:"flex space-x-2",children:["Male","Female","Prefer not to say"].map(we=>Y.jsx("button",{type:"button",onClick:()=>G(we),className:`px-4 py-1 rounded-full border transition ${s===we?"bg-expedify-gold text-black border-expedify-gold":"border-gray-400 text-gray-700 hover:border-expedify-gold"}`,children:we},we))})]}),Y.jsx("button",{type:"submit",className:"mt-4 w-full bg-expedify-gold text-black font-semibold rounded-full py-2 hover:scale-105 transition",children:"Next"}),q&&Y.jsx("p",{className:"text-red-500 text-sm",children:q})]})})},nj="/assets/map_mock-CZhf6Agq.png",rj=()=>{const u=hp(),{setLocationPermission:n,setNotifPermission:l,locationPermission:m,notifPermission:w}=Xa(),C=async()=>{try{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(q=>{n("granted")},q=>{n("denied")}):alert("Geolocation is not supported by your browser.")}catch(q){console.error(q)}},D=async()=>{if("Notification"in window){const q=await Notification.requestPermission();l(q)}else alert("Notifications are not supported by this browser.")},s=()=>{u("/dashboard")},G=()=>{m&&w?u("/dashboard"):alert("Please allow at least one permission to continue, or click 'Not now'.")};return st.useEffect(()=>{m&&w&&G()},[m,w]),Y.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center min-h-screen bg-white px-6",children:[Y.jsx("div",{className:"w-64 h-64 rounded-full overflow-hidden mb-8 md:mb-0 md:mr-12 shadow-lg border border-gray-200",children:Y.jsx("img",{src:nj,alt:"Map preview",className:"object-cover w-full h-full"})}),Y.jsxs("div",{className:"text-center md:text-left max-w-sm",children:[Y.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Turn on your location"}),Y.jsx("p",{className:"text-gray-600 mb-6",children:"Turn on your location for a seamless booking experience."}),Y.jsxs("div",{className:"flex flex-col gap-3",children:[Y.jsx("button",{onClick:C,className:`rounded-full px-6 py-2 font-semibold transition ${m?"bg-green-500 text-white":"bg-expedify-gold text-black hover:scale-105"}`,children:m?"Location Enabled ":"Turn on location service"}),Y.jsx("button",{onClick:D,className:`rounded-full px-6 py-2 font-semibold transition ${w?"bg-green-600 text-white":"bg-gray-900 text-white hover:scale-105"}`,children:w?"Notifications Enabled ":"Enable Notification"})]}),Y.jsx("p",{onClick:s,className:"mt-6 text-gray-600 text-sm cursor-pointer hover:underline",children:"Not now"})]})]})};var hb={exports:{}},sj=hb.exports,fC;function oj(){return fC||(fC=1,(function(u,n){(function(l,m){u.exports=m()})(sj,(function(){var l,m,w;function C(s,G){if(!l)l=G;else if(!m)m=G;else{var q="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",te={};l(te),w=G(te),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}C(["exports"],(function(s){var G=1e-6,q=typeof Float32Array<"u"?Float32Array:Array;function te(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=i*g-h*a;return _?(r[0]=g*(_=1/_),r[1]=-a*_,r[2]=-h*_,r[3]=i*_,r):null}function ce(){var r=new q(9);return q!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function we(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=e[4],x=e[5],E=e[6],A=e[7],M=e[8];return r[0]=_*M-x*A,r[1]=h*A-a*M,r[2]=a*x-h*_,r[3]=x*E-g*M,r[4]=i*M-h*E,r[5]=h*g-i*x,r[6]=g*A-_*E,r[7]=a*E-i*A,r[8]=i*_-a*g,r}function ze(r,e,i){var a=e[0],h=e[1],g=e[2],_=e[3],x=e[4],E=e[5],A=e[6],M=e[7],P=e[8],L=i[0],B=i[1],V=i[2],Z=i[3],K=i[4],Q=i[5],oe=i[6],le=i[7],he=i[8];return r[0]=L*a+B*_+V*A,r[1]=L*h+B*x+V*M,r[2]=L*g+B*E+V*P,r[3]=Z*a+K*_+Q*A,r[4]=Z*h+K*x+Q*M,r[5]=Z*g+K*E+Q*P,r[6]=oe*a+le*_+he*A,r[7]=oe*h+le*x+he*M,r[8]=oe*g+le*E+he*P,r}function at(){var r=new q(16);return q!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ge(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qe(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=e[4],x=e[5],E=e[6],A=e[7],M=e[8],P=e[9],L=e[10],B=e[11],V=e[12],Z=e[13],K=e[14],Q=e[15],oe=i*x-a*_,le=i*E-h*_,he=i*A-g*_,Ee=a*E-h*x,Se=a*A-g*x,Me=h*A-g*E,De=M*Z-P*V,Ne=M*K-L*V,ft=M*Q-B*V,je=P*K-L*Z,mt=P*Q-B*Z,It=L*Q-B*K,vt=oe*It-le*mt+he*je+Ee*ft-Se*Ne+Me*De;return vt?(r[0]=(x*It-E*mt+A*je)*(vt=1/vt),r[1]=(h*mt-a*It-g*je)*vt,r[2]=(Z*Me-K*Se+Q*Ee)*vt,r[3]=(L*Se-P*Me-B*Ee)*vt,r[4]=(E*ft-_*It-A*Ne)*vt,r[5]=(i*It-h*ft+g*Ne)*vt,r[6]=(K*he-V*Me-Q*le)*vt,r[7]=(M*Me-L*he+B*le)*vt,r[8]=(_*mt-x*ft+A*De)*vt,r[9]=(a*ft-i*mt-g*De)*vt,r[10]=(V*Se-Z*he+Q*oe)*vt,r[11]=(P*he-M*Se-B*oe)*vt,r[12]=(x*Ne-_*je-E*De)*vt,r[13]=(i*je-a*Ne+h*De)*vt,r[14]=(Z*le-V*Ee-K*oe)*vt,r[15]=(M*Ee-P*le+L*oe)*vt,r):null}function xt(r,e,i){var a=e[0],h=e[1],g=e[2],_=e[3],x=e[4],E=e[5],A=e[6],M=e[7],P=e[8],L=e[9],B=e[10],V=e[11],Z=e[12],K=e[13],Q=e[14],oe=e[15],le=i[0],he=i[1],Ee=i[2],Se=i[3];return r[0]=le*a+he*x+Ee*P+Se*Z,r[1]=le*h+he*E+Ee*L+Se*K,r[2]=le*g+he*A+Ee*B+Se*Q,r[3]=le*_+he*M+Ee*V+Se*oe,r[4]=(le=i[4])*a+(he=i[5])*x+(Ee=i[6])*P+(Se=i[7])*Z,r[5]=le*h+he*E+Ee*L+Se*K,r[6]=le*g+he*A+Ee*B+Se*Q,r[7]=le*_+he*M+Ee*V+Se*oe,r[8]=(le=i[8])*a+(he=i[9])*x+(Ee=i[10])*P+(Se=i[11])*Z,r[9]=le*h+he*E+Ee*L+Se*K,r[10]=le*g+he*A+Ee*B+Se*Q,r[11]=le*_+he*M+Ee*V+Se*oe,r[12]=(le=i[12])*a+(he=i[13])*x+(Ee=i[14])*P+(Se=i[15])*Z,r[13]=le*h+he*E+Ee*L+Se*K,r[14]=le*g+he*A+Ee*B+Se*Q,r[15]=le*_+he*M+Ee*V+Se*oe,r}function wt(r,e,i){var a,h,g,_,x,E,A,M,P,L,B,V,Z=i[0],K=i[1],Q=i[2];return e===r?(r[12]=e[0]*Z+e[4]*K+e[8]*Q+e[12],r[13]=e[1]*Z+e[5]*K+e[9]*Q+e[13],r[14]=e[2]*Z+e[6]*K+e[10]*Q+e[14],r[15]=e[3]*Z+e[7]*K+e[11]*Q+e[15]):(h=e[1],g=e[2],_=e[3],x=e[4],E=e[5],A=e[6],M=e[7],P=e[8],L=e[9],B=e[10],V=e[11],r[0]=a=e[0],r[1]=h,r[2]=g,r[3]=_,r[4]=x,r[5]=E,r[6]=A,r[7]=M,r[8]=P,r[9]=L,r[10]=B,r[11]=V,r[12]=a*Z+x*K+P*Q+e[12],r[13]=h*Z+E*K+L*Q+e[13],r[14]=g*Z+A*K+B*Q+e[14],r[15]=_*Z+M*K+V*Q+e[15]),r}function jt(r,e,i){var a=i[0],h=i[1],g=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*g,r[9]=e[9]*g,r[10]=e[10]*g,r[11]=e[11]*g,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function wi(r,e,i){var a=Math.sin(i),h=Math.cos(i),g=e[4],_=e[5],x=e[6],E=e[7],A=e[8],M=e[9],P=e[10],L=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=g*h+A*a,r[5]=_*h+M*a,r[6]=x*h+P*a,r[7]=E*h+L*a,r[8]=A*h-g*a,r[9]=M*h-_*a,r[10]=P*h-x*a,r[11]=L*h-E*a,r}function Ai(r,e,i){var a=Math.sin(i),h=Math.cos(i),g=e[0],_=e[1],x=e[2],E=e[3],A=e[8],M=e[9],P=e[10],L=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*h-A*a,r[1]=_*h-M*a,r[2]=x*h-P*a,r[3]=E*h-L*a,r[8]=g*a+A*h,r[9]=_*a+M*h,r[10]=x*a+P*h,r[11]=E*a+L*h,r}function vi(r,e,i){var a=Math.sin(i),h=Math.cos(i),g=e[0],_=e[1],x=e[2],E=e[3],A=e[4],M=e[5],P=e[6],L=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=g*h+A*a,r[1]=_*h+M*a,r[2]=x*h+P*a,r[3]=E*h+L*a,r[4]=A*h-g*a,r[5]=M*h-_*a,r[6]=P*h-x*a,r[7]=L*h-E*a,r}function Ve(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ke(r,e,i){var a,h,g,_=i[0],x=i[1],E=i[2],A=Math.sqrt(_*_+x*x+E*E);return A<G?null:(_*=A=1/A,x*=A,E*=A,a=Math.sin(e),h=Math.cos(e),r[0]=_*_*(g=1-h)+h,r[1]=x*_*g+E*a,r[2]=E*_*g-x*a,r[3]=0,r[4]=_*x*g-E*a,r[5]=x*x*g+h,r[6]=E*x*g+_*a,r[7]=0,r[8]=_*E*g+x*a,r[9]=x*E*g-_*a,r[10]=E*E*g+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function We(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=i+i,x=a+a,E=h+h,A=i*_,M=a*_,P=a*x,L=h*_,B=h*x,V=h*E,Z=g*_,K=g*x,Q=g*E;return r[0]=1-P-V,r[1]=M+Q,r[2]=L-K,r[3]=0,r[4]=M-Q,r[5]=1-A-V,r[6]=B+Z,r[7]=0,r[8]=L+K,r[9]=B-Z,r[10]=1-A-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var ht=xt;function $e(){var r=new q(3);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function _t(r){var e=new q(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Ue(r){var e=r[0],i=r[1],a=r[2];return Math.sqrt(e*e+i*i+a*a)}function Cn(r,e,i){var a=new q(3);return a[0]=r,a[1]=e,a[2]=i,a}function mn(r,e,i,a){return r[0]=e,r[1]=i,r[2]=a,r}function Pt(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Si(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function fn(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function jn(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function Wn(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function et(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function Kt(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r}function Oi(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2];return i*i+a*a+h*h}function Hi(r){var e=r[0],i=r[1],a=r[2];return e*e+i*i+a*a}function bn(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Qt(r,e){var i=e[0],a=e[1],h=e[2],g=i*i+a*a+h*h;return g>0&&(g=1/Math.sqrt(g)),r[0]=e[0]*g,r[1]=e[1]*g,r[2]=e[2]*g,r}function Li(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function cn(r,e,i){var a=e[0],h=e[1],g=e[2],_=i[0],x=i[1],E=i[2];return r[0]=h*E-g*x,r[1]=g*_-a*E,r[2]=a*x-h*_,r}function Nn(r,e,i,a){var h=e[0],g=e[1],_=e[2];return r[0]=h+a*(i[0]-h),r[1]=g+a*(i[1]-g),r[2]=_+a*(i[2]-_),r}function ur(r,e,i){var a=e[0],h=e[1],g=e[2],_=i[3]*a+i[7]*h+i[11]*g+i[15];return r[0]=(i[0]*a+i[4]*h+i[8]*g+i[12])/(_=_||1),r[1]=(i[1]*a+i[5]*h+i[9]*g+i[13])/_,r[2]=(i[2]*a+i[6]*h+i[10]*g+i[14])/_,r}function Qo(r,e,i){var a=e[0],h=e[1],g=e[2];return r[0]=a*i[0]+h*i[3]+g*i[6],r[1]=a*i[1]+h*i[4]+g*i[7],r[2]=a*i[2]+h*i[5]+g*i[8],r}function Jo(r,e,i){var a=i[0],h=i[1],g=i[2],_=i[3],x=e[0],E=e[1],A=e[2],M=h*A-g*E,P=g*x-a*A,L=a*E-h*x;return r[0]=x+_*(M+=M)+h*(L+=L)-g*(P+=P),r[1]=E+_*P+g*M-a*L,r[2]=A+_*L+a*P-h*M,r}function Ya(r){return r[0]=0,r[1]=0,r[2]=0,r}function ys(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Dr=Si,Il=fn,Ka=Ue;function Uc(){var r=new q(4);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Tr(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function ls(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=i*i+a*a+h*h+g*g;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=a*_,r[2]=h*_,r[3]=g*_,r}function Fs(r,e,i){var a=e[0],h=e[1],g=e[2],_=e[3];return r[0]=i[0]*a+i[4]*h+i[8]*g+i[12]*_,r[1]=i[1]*a+i[5]*h+i[9]*g+i[13]*_,r[2]=i[2]*a+i[6]*h+i[10]*g+i[14]*_,r[3]=i[3]*a+i[7]*h+i[11]*g+i[15]*_,r}function Cl(){var r=new q(4);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Qa(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Bs(r,e,i){i*=.5;var a=e[0],h=e[1],g=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=a*E+_*x,r[1]=h*E+g*x,r[2]=g*E-h*x,r[3]=_*E-a*x,r}function Ra(r,e,i){i*=.5;var a=e[0],h=e[1],g=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=a*E-g*x,r[1]=h*E+_*x,r[2]=g*E+a*x,r[3]=_*E-h*x,r}$e(),Uc();var no,xo,Ja,Rl=ls,jc=(no=$e(),xo=Cn(1,0,0),Ja=Cn(0,1,0),function(r,e,i){var a=Li(e,i);return a<-.999999?(cn(no,xo,e),Ka(no)<1e-6&&cn(no,Ja,e),Qt(no,no),(function(h,g,_){_*=.5;var x=Math.sin(_);h[0]=x*g[0],h[1]=x*g[1],h[2]=x*g[2],h[3]=Math.cos(_)})(r,no,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(cn(no,e,i),r[0]=no[0],r[1]=no[1],r[2]=no[2],r[3]=1+a,Rl(r,r))});function Ms(){var r=new q(2);return q!=Float32Array&&(r[0]=0,r[1]=0),r}function ga(r,e){var i=new q(2);return i[0]=r,i[1]=e,i}function ea(r,e,i){return r[0]=e,r[1]=i,r}function vs(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function Vs(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function Yr(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function ac(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function hr(r,e){var i=e[0],a=e[1],h=i*i+a*a;return h>0&&(h=1/Math.sqrt(h)),r[0]=e[0]*h,r[1]=e[1]*h,r}function Ts(r,e){return r[0]*e[0]+r[1]*e[1]}Cl(),Cl(),ce();var _a,Ma,Hr=Vs;function ya(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Ms();var va=(function(){if(Ma)return _a;function r(e,i,a,h){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=h}return Ma=1,_a=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,h=0;h<8;h++){var g=this.sampleCurveX(a)-e;if(Math.abs(g)<i)return a;var _=this.sampleCurveDerivativeX(a);if(Math.abs(_)<1e-6)break;a-=g/_}var x=0,E=1;for(a=e,h=0;h<20&&(g=this.sampleCurveX(a),!(Math.abs(g-e)<i));h++)e>g?x=a:E=a,a=.5*(E-x)+x;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},_a})(),xa=ya(va);function Ct(r,e){this.x=r,this.y=e}function el(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!el(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!el(r[i],e[i]))return!1;return!0}return r===e}Ct.prototype={clone(){return new Ct(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(r,e){const i=Math.cos(r),a=Math.sin(r),h=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ct},Ct.convert=function(r){if(r instanceof Ct)return r;if(Array.isArray(r))return new Ct(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Ct(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const tl=Math.PI/180,il=180/Math.PI;function Fe(r){return r*tl}function J(r){return r*il}const se=[[0,0],[1,0],[1,1],[0,1]];function me(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Re(r,e,i,a){const h=new xa(r,e,i,a);return function(g){return h.solve(g)}}const Ae=Re(.25,.1,.25,1);function Ie(r,e,i){return Math.min(i,Math.max(e,r))}function Ye(r,e,i){return(i=Ie((i-r)/(e-r),0,1))*i*(3-2*i)}function Le(r,e,i){const a=i-e,h=((r-e)%a+a)%a+e;return h===e?i:h}function Xe(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const h=new Array(r.length);let g=null;r.forEach(((_,x)=>{e(_,((E,A)=>{E&&(g=E),h[x]=A,--a==0&&i(g,h)}))}))}let At=1;function gt(){return At++}function di(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Mi(r,e){r.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Bi(r,e,i){const a={};for(const h in r)a[h]=e.call(this,r[h],h,r);return a}function un(r,e,i){const a={};for(const h in r)e.call(this,r[h],h,r)&&(a[h]=r[h]);return a}function Wi(r){return Array.isArray(r)?r.map(Wi):typeof r=="object"&&r?Bi(r,Wi):r}function hn(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const Ln={};function Ki(r){Ln[r]||(typeof console<"u"&&console.warn(r),Ln[r]=!0)}function Zn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Cr(r){let e=0;for(let i,a,h=0,g=r.length,_=g-1;h<g;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}function Gn([r,e,i]){const a=Fe(e+90),h=Fe(i);return{x:r*Math.cos(a)*Math.sin(h),y:r*Math.sin(a)*Math.sin(h),z:r*Math.cos(h),azimuthal:e,polar:i}}function Vn(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Rn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,a,h,g)=>{const _=h||g;return e[a]=!_||_.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let rr=null;function sr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Jn(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<a?e=h+1:i=h}return e}function Es(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<=a?e=h+1:i=h}return e}function Ys(r){return r>0?1/(1.001-r):1+r}function zo(r){return r>0?1-1/(1.001-r):-r}function ba(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Kr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Kr.API_URL)return null;try{const r=new URL(Kr.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ds(r){return Kr.API_URL_REGEX.test(r)}function ro(r){return Kr.API_SPRITE_REGEX.test(r)}let ta,lc,Rr,Ml,bo,Pl;function ko(){return ta==null&&(ta=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ta}const ia={now:()=>Ml!==void 0?Ml:performance.now(),setNow(r){Ml=r},restoreNow(){Ml=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:a}=r;bo||(bo=document.createElement("canvas"));const h=bo.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>bo.width||a>bo.height)&&(bo.width=i,bo.height=a),h.clearRect(-e,-e,i+2*e,a+2*e),h.drawImage(r,0,0,i,a),h.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:r=>(lc||(lc=document.createElement("a")),lc.href=r,lc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Rr==null&&(Rr=window.matchMedia("(prefers-reduced-motion: reduce)")),Rr.matches)},hasCanvasFingerprintNoise(){if(Pl!==void 0)return Pl;if(!ko())return Pl=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const a=e.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<a.data.length;++h)if(h%4!=3&&i++!==a.data[h])return Pl=!0,!0;return Pl=!1,!1}};function id(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(r.slice(i));for(const h in e)a.set(h,e[h]);return`${r.slice(0,i)}?${a.toString()}`}function wu(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const a=new URLSearchParams,h=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const x=h.get(_);x&&a.set(_,x)}const g=a.toString();return`${r.slice(0,i)}${g.length>0?`?${g}`:""}`}const Ks="mapbox-tiles";let wa=500,No=50;const xs=["language","worldview","jobid"];let so,Dl;function sh(){try{return caches}catch{}}function cc(){const r=sh();r&&so==null&&(so=r.open(Ks))}let Ol=1/0;const nl={supported:!1,testSupport:function(r){!wo&&Fo&&(Ta?na(r):uc=r)}};let uc,Fo,wo=!1,Ta=!1;const Ll=typeof self<"u"?self:{};function na(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Fo),r.isContextLost())return;nl.supported=!0}catch{}r.deleteTexture(e),wo=!0}Ll.document&&(Fo=Ll.document.createElement("img"),Fo.onload=function(){uc&&na(uc),uc=null,Ta=!0},Fo.onerror=function(){wo=!0,uc=null},Fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const hc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(hc);class Tu extends Error{constructor(e,i,a){i===401&&ds(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zl=Vn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,on=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(zl())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(a,h){const g=new AbortController,_=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:zl(),referrerPolicy:a.referrerPolicy,signal:g.signal});let x=!1,E=!1;const A=(M=_.url).indexOf("sku=")>0&&ds(M);var M;a.type==="json"&&_.headers.set("Accept","application/json");const P=(B,V,Z)=>{if(E)return;if(B&&B.message!=="SecurityError"&&Ki(B.toString()),V&&Z)return L(V);const K=Date.now();fetch(_).then((Q=>{if(Q.ok){const oe=A?Q.clone():null;return L(Q,oe,K)}return h(new Tu(Q.statusText,Q.status,a.url))})).catch((Q=>{Q.name!=="AbortError"&&h(new Error(`${Q.message} ${a.url}`))}))},L=(B,V,Z)=>{(a.type==="arrayBuffer"?B.arrayBuffer():a.type==="json"?B.json():B.text()).then((K=>{E||(V&&Z&&(function(Q,oe,le){if(cc(),so==null)return;const he=Rn(oe.headers.get("Cache-Control")||"");if(he["no-store"])return;const Ee={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach(((De,Ne)=>Ee.headers.set(Ne,De))),he["max-age"]&&Ee.headers.set("Expires",new Date(le+1e3*he["max-age"]).toUTCString());const Se=Ee.headers.get("Expires");if(!Se||new Date(Se).getTime()-le<42e4)return;let Me=wu(Q.url,{persistentParams:xs});if(oe.status===206){const De=Q.headers.get("Range");if(!De)return;Ee.status=200,Me=id(Me,{range:De})}(function(De,Ne){if(Dl===void 0)try{new Response(new ReadableStream),Dl=!0}catch{Dl=!1}Dl?Ne(De.body):De.blob().then(Ne).catch((ft=>Ki(ft.message)))})(oe,(De=>{const Ne=new Response((ft=oe.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:De,Ee);var ft;cc(),so?.then((je=>je.put(Me,Ne))).catch((je=>Ki(je.message)))}))})(_,V,Z),x=!0,h(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))})).catch((K=>{E||h(new Error(K.message))}))};return A?(function(B,V){if(cc(),so==null)return V(null);so.then((Z=>{let K=wu(B.url,{persistentParams:xs});const Q=B.headers.get("Range");Q&&(K=id(K,{range:Q})),Z.match(K).then((oe=>{const le=(function(he){if(!he)return!1;const Ee=new Date(he.headers.get("Expires")||0),Se=Rn(he.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!Se["no-cache"]})(oe);Z.delete(K).catch(V),le&&Z.put(K,oe.clone()).catch(V),V(null,oe,le)})).catch(V)})).catch(V)})(_,P):P(null,null),{cancel:()=>{E=!0,x||g.abort()}}})(r,e);if(Vn(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(a,h){const g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in a.headers)g.setRequestHeader(_,a.headers[_]);return a.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(a.type==="json")try{_=JSON.parse(g.response)}catch(x){return h(x)}h(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new Tu(g.statusText,g.status,a.url))},g.send(a.body),{cancel:()=>g.abort()}})(r,e)},To=function(r,e){return on(Object.assign(r,{type:"arrayBuffer"}),e)};function Eu(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Qr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pa,rl;Pa=[],rl=0;const sl=function(r,e){if(nl.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),rl>=Kr.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pa.push(g),g}rl++;let i=!1;const a=()=>{if(!i)for(i=!0,rl--;Pa.length&&rl<Kr.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Pa.shift(),{requestParameters:_,callback:x,cancelled:E}=g;E||(g.cancel=sl(_,x).cancel)}},h=To(r,((g,_,x,E)=>{a(),g?e(g):_&&(self.createImageBitmap?(function(A,M){const P=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(P).then((L=>{M(null,L)})).catch((L=>{M(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((A,M)=>e(A,M,x,E))):(function(A,M){const P=new Image;P.onload=()=>{M(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame((()=>{P.src=Qr}))},P.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(A)],{type:"image/png"});P.src=A.byteLength?URL.createObjectURL(L):Qr})(_,((A,M)=>e(A,M,x,E))))}));return{cancel:()=>{h.cancel(),a()}}};var Gc,dc,fc,Eo={exports:{}},ho={exports:{}},kl={exports:{}},ra=(function(){if(fc)return Eo.exports;fc=1;var r=(Gc||(Gc=1,ho.exports=function(i,a){var h,g,_,x,E,A,M,P;for(g=i.length-(h=3&i.length),_=a,E=3432918353,A=461845907,P=0;P<g;)M=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,_=27492+(65535&(x=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,h){case 3:M^=(255&i.charCodeAt(P+2))<<16;case 2:M^=(255&i.charCodeAt(P+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(P)))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),ho.exports),e=(dc||(dc=1,kl.exports=function(i,a){for(var h,g=i.length,_=a^g,x=0;g>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:_^=(255&i.charCodeAt(x+2))<<16;case 2:_^=(255&i.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),kl.exports);return Eo.exports=r,Eo.exports.murmur3=r,Eo.exports.murmur2=e,Eo.exports})(),Nl=ya(ra);class sa{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class ol extends sa{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function qc(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Ps(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class al{on(e,i){return this._listeners=this._listeners||{},qc(e,i,this._listeners),this}off(e,i){return Ps(e,i,this._listeners),Ps(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},qc(e,i,this._oneTimeListeners),this):new Promise((a=>{this.once(e,a)}))}fire(e,i){const a=typeof e=="string"?new sa(e,i):e,h=a.type;if(this.listens(h)){a.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of g)E.call(this,a);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of _)Ps(h,E,this._oneTimeListeners),E.call(this,a);const x=this._eventedParent;if(x){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,E),x.fire(a)}}else a instanceof ol&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class So{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new So(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new So({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return So.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Hc,oh={},nd=(function(){if(Hc)return oh;Hc=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(g){return(g=Math.round(g))<0?0:g>255?255:g}function i(g){return e(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function a(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function h(g,_,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?g+(_-g)*x*6:2*x<1?_:3*x<2?g+(_-g)*(2/3-x)*6:g}try{oh.parseCSSColor=function(g){var _,x=g.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(_=parseInt(x.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:x.length===7&&(_=parseInt(x.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=x.indexOf("("),A=x.indexOf(")");if(E!==-1&&A+1===x.length){var M=x.substr(0,E),P=x.substr(E+1,A-(E+1)).split(","),L=1;switch(M){case"rgba":if(P.length!==4)return null;L=a(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),L];case"hsla":if(P.length!==4)return null;L=a(P.pop());case"hsl":if(P.length!==3)return null;var B=(parseFloat(P[0])%360+360)%360/360,V=a(P[1]),Z=a(P[2]),K=Z<=.5?Z*(V+1):Z+V-Z*V,Q=2*Z-K;return[e(255*h(Q,K,B+1/3)),e(255*h(Q,K,B)),e(255*h(Q,K,B-1/3)),L];default:return null}}return null}}catch{}return oh})();class In{constructor(e,i,a,h=1){this.r=e,this.g=i,this.b=a,this.a=h}static parse(e){if(!e)return;if(e instanceof In)return e;if(typeof e!="string")return;const i=nd.parseCSSColor(e);return i?new In(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:h,a:g}=this;return new _f(e,i,a,h,g)}toPremultipliedRenderColor(e){const{r:i,g:a,b:h,a:g}=this;return new Wc(e,i*g,a*g,h*g,g)}clone(){return new In(this.r,this.g,this.b,this.a)}}class ah{constructor(e,i,a,h,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const x=e.image.height,E=x*x;this.premultiplied?(i=g===0?0:i/g*(x-1),a=g===0?0:a/g*(x-1),h=g===0?0:h/g*(x-1)):(i*=x-1,a*=x-1,h*=x-1);const A=Math.floor(i),M=Math.floor(a),P=Math.floor(h),L=Math.ceil(i),B=Math.ceil(a),V=Math.ceil(h),Z=i-A,K=a-M,Q=h-P,oe=e.image.data,le=4*(A+M*E+P*x),he=4*(A+M*E+V*x),Ee=4*(A+B*E+P*x),Se=4*(A+B*E+V*x),Me=4*(L+M*E+P*x),De=4*(L+M*E+V*x),Ne=4*(L+B*E+P*x),ft=4*(L+B*E+V*x);if(le<0||ft>=oe.length)throw new Error("out of range");this.r=Ii(Ii(Ii(oe[le],oe[he],Q),Ii(oe[Ee],oe[Se],Q),K),Ii(Ii(oe[Me],oe[De],Q),Ii(oe[Ne],oe[ft],Q),K),Z)/255*(this.premultiplied?g:1),this.g=Ii(Ii(Ii(oe[le+1],oe[he+1],Q),Ii(oe[Ee+1],oe[Se+1],Q),K),Ii(Ii(oe[Me+1],oe[De+1],Q),Ii(oe[Ne+1],oe[ft+1],Q),K),Z)/255*(this.premultiplied?g:1),this.b=Ii(Ii(Ii(oe[le+2],oe[he+2],Q),Ii(oe[Ee+2],oe[Se+2],Q),K),Ii(Ii(oe[Me+2],oe[De+2],Q),Ii(oe[Ne+2],oe[ft+2],Q),K),Z)/255*(this.premultiplied?g:1),this.a=g}else this.r=i,this.g=a,this.b=h,this.a=g}toArray(){const{r:e,g:i,b:a,a:h}=this;return[255*e,255*i,255*a,h]}toHslaArray(){let{r:e,g:i,b:a,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const V=1/h;e*=V,i*=V,a*=V}const g=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),x=Math.min(Math.max(a,0),1),E=Math.min(g,_,x),A=Math.max(g,_,x),M=A-E,P=.5*(E+A);if(M===0)return[0,0,100*P,h];const L=P>.5?M/(2-A-E):M/(A+E);let B;switch(A){case g:B=60*((_-x)/M+(_<x?6:0));break;case _:B=60*((x-g)/M+2);break;default:B=60*((g-_)/M+4)}return[B,100*L,100*P,h]}toArray01(){const{r:e,g:i,b:a,a:h}=this;return[e,i,a,h]}toArray01Scaled(e){const{r:i,g:a,b:h}=this;return[i*e,a*e,h*e]}toArray01Linear(){const{r:e,g:i,b:a,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),h]}}class _f extends ah{constructor(e,i,a,h,g){super(e,i,a,h,g,!1)}}class Wc extends ah{constructor(e,i,a,h,g){super(e,i,a,h,g,!0)}}function Ii(r,e,i){return r*(1-i)+e*i}function rd(r,e,i){return r.map(((a,h)=>Ii(a,e[h],i)))}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1),In.blue=new In(0,0,1,1);var Ds=Object.freeze({__proto__:null,array:rd,color:function(r,e,i){return new In(Ii(r.r,e.r,i),Ii(r.g,e.g,i),Ii(r.b,e.b,i),Ii(r.a,e.a,i))},number:Ii});class Ea extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class lh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(e){return new lh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Da={kind:"null"},gi={kind:"number"},Sn={kind:"string"},gn={kind:"boolean"},Ao={kind:"color"},pc={kind:"object"},wn={kind:"value"},z={kind:"collator"},ee={kind:"formatted"},ae={kind:"resolvedImage"};function Ce(r,e){return{kind:"array",itemType:r,N:e}}function pt(r){if(r.kind==="array"){const e=pt(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Gt=[Da,gi,Sn,gn,Ao,ee,pc,Ce(wn),ae];function Ri(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ri(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Gt)if(!Ri(i,e))return null}}return`Expected ${pt(r)} but found ${pt(e)} instead.`}function Un(r,e){return e.some((i=>i.kind===r.kind))}function fs(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function yr(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&yr(r.itemType,e.itemType):r.kind===e.kind}class Br{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oa{constructor(e,i,a,h,g){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=h,this.textColor=g}}class ps{constructor(e){this.sections=e}static fromString(e){return new ps([new oa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ps?e:ps.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class Us{constructor(e,i={}){if(this.id=So.from(e),this.options=Object.assign({},i),i.transform){const{a,b:h,c:g,d:_,e:x,f:E}=i.transform;this.options.transform=new DOMMatrix([a,h,g,_,x,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:h,e:g,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:h,e:g,f:_}})}static parse(e){let i,a,h,g;try{({name:i,iconsetId:a,params:h,transform:g}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:_,b:x,c:E,d:A,e:M,f:P}=g||{};return new Us({name:i,iconsetId:a},{params:h,transform:new DOMMatrix([_,x,E,A,M,P])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class ms{constructor(e,i,a,h,g=!1){this.primaryId=So.from(e),this.primaryOptions=i,a&&(this.secondaryId=So.from(a)),this.secondaryOptions=h,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Us(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Us(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ms.build({name:e}):e}static build(e,i,a,h){return!e||typeof e=="object"&&!("name"in e)?null:new ms(e,a,i,h)}}function Su(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof In||r instanceof Br||r instanceof ps||r instanceof ms)return!0;if(Array.isArray(r)){for(const e of r)if(!Fl(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Fl(r[e]))return!1;return!0}return!1}function ns(r){if(r===null)return Da;if(typeof r=="string")return Sn;if(typeof r=="boolean")return gn;if(typeof r=="number")return gi;if(r instanceof In)return Ao;if(r instanceof Br)return z;if(r instanceof ps)return ee;if(r instanceof ms)return ae;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const h=ns(a);if(i){if(i===h)continue;i=wn;break}i=h}return Ce(i||wn,e)}return pc}function aa(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ps||r instanceof ms||r instanceof In?r.toString():JSON.stringify(r)}class Xi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Fl(e[1]))return i.error("invalid value");const a=e[1];let h=ns(a);const g=i.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Xi(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof In?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ps?this.value.serialize():this.value}}class ei{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const sd={string:Sn,number:gi,boolean:gn,object:pc};class Pi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,h=1;const g=e[0];if(g==="array"){let x,E;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in sd)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=sd[A],h++}else x=wn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],h++}a=Ce(x,E)}else a=sd[g];const _=[];for(;h<e.length;h++){const x=i.parse(e[h],h,wn);if(!x)return null;_.push(x)}return new Pi(a,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Ri(this.type,ns(a)))return a;if(i===this.args.length-1)throw new ei(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${pt(ns(a))} but was expected to be of type ${pt(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map((a=>a.serialize())))}}class Bl{constructor(e){this.type=ee,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=i.parseObjectValue(x["font-scale"],_,"font-scale",gi),!E))return null;let A=null;if(x["text-font"]&&(A=i.parseObjectValue(x["text-font"],_,"text-font",Ce(Sn)),!A))return null;let M=null;if(x["text-color"]&&(M=i.parseObjectValue(x["text-color"],_,"text-color",Ao),!M))return null;const P=h[h.length-1];P.scale=E,P.font=A,P.textColor=M}else{const E=i.parse(e[_],_,wn);if(!E)return null;const A=E.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new Bl(h)}evaluate(e){return new ps(this.sections.map((i=>{const a=i.content.evaluate(e);return yr(ns(a),ae)?new oa("",a,null,null,null):new oa(aa(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class mc{constructor(e,i,a,h){this._imageWarnHistory={},this.type=ae,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const h=[];function g(){if(a<e.length){const x=i.parse(e[a],a++,Sn);return x?(h.push({image:x,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(a<e.length){const E=e[a];if((x=E)===null||typeof x!="object"||Array.isArray(x))return!0;const A=E.params,M=E.iconset,P=i.concat(a);if(!A&&!M)return a++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const L={},B=P.concat(void 0,"params");for(const V in A){if(!V)return B.error("Image parameter name should be non-empty"),!1;const Z=B.concat(void 0,V).parse(A[V],void 0,Ao,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;L[V]=Z}h[h.length-1].options.params=L}if(M){if(typeof M!="object"||M.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!M.id)return P.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=M}return a++,!0}var x;return!0}for(let x=0;x<2;x++)if(!g()||!_())return;return new mc(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const h in i)if(i[h])try{a[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=ms.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const g=h.getPrimary().id;if(h.available=e.availableImages.some((_=>So.isEqual(_,g))),h.available){const _=h.getSecondary()?h.getSecondary().id:null;_&&(h.available=e.availableImages.some((x=>So.isEqual(x,_))))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const h in e)e[h]&&(a.params[h]=e[h].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function ki(r){return ad(r)?"string":ld(r)?"number":yf(r)?"boolean":Array.isArray(r)?"array":r===null?"null":od(r)?"object":typeof r}function od(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function ad(r){return typeof r=="string"||r instanceof String}function ld(r){return typeof r=="number"||r instanceof Number}function yf(r){return typeof r=="boolean"||r instanceof Boolean}const cd={"to-boolean":gn,"to-color":Ao,"to-number":gi,"to-string":Sn};class rs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],h=[];let g=Da;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);g=Ce(i.expectedType.itemType,_)}else{if(!(_>0&&Fl(e[1][0])))return null;g=Ce(ns(e[1][0]),_)}for(let x=0;x<_;x++){const E=e[1][x];let A;if(Array.isArray(E))A=i.parse(E,void 0,g.itemType);else{const M=ki(E);if(M!==g.itemType.kind)return i.error(`Expected ${g.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!A)return null;h.push(A)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");g=cd[a];for(let _=1;_<e.length;_++){const x=i.parse(e[_],_,wn);if(!x)return null;h.push(x)}}return new rs(g,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const h of this.args){if(i=h.evaluate(e),a=null,i instanceof In)return i;if(typeof i=="string"){const g=e.parseColor(i);if(g)return g}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Su(i[0],i[1],i[2],i[3]),!a))return new In(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ei(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new ei(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ps.fromString(aa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ms.build(aa(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):aa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Bl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const fp=["Unknown","Point","LineString","Polygon"];class gc{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=In.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Bo{constructor(e,i,a,h,g){this.name=e,this.type=i,this._evaluate=a,this.args=h,this._overloadIndex=g}evaluate(e){if(!this._evaluate){const i=Bo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const a=e[0],h=Bo.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let E=null,A=-1;for(const[M,P]of _){if(Array.isArray(M)&&M.length!==e.length-1)continue;x.push(M),A++,E=new pd(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const L=[];let B=!1;for(let V=1;V<e.length;V++){const Z=e[V],K=Array.isArray(M)?M[V-1]:M.type,Q=E.parse(Z,1+L.length,K);if(!Q){B=!0;break}L.push(Q)}if(!B)if(Array.isArray(M)&&M.length!==L.length)E.error(`Expected ${M.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const Z=Array.isArray(M)?M[V]:M.type,K=L[V];E.concat(V+1).checkSubtype(Z,K.type)}if(E.errors.length===0)return new Bo(a,g,P,L,A)}}if(x.length===1)i.errors.push(...E.errors);else{const M=(x.length?x:_.map((([L])=>L))).map(Au).join(" | "),P=[];for(let L=1;L<e.length;L++){const B=i.parse(e[L],1+P.length);if(!B)return null;P.push(pt(B.type))}i.error(`Expected arguments of type ${M}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){Bo.definitions=i;for(const a in i)e[a]=Bo}}function Au(r){return Array.isArray(r)?`(${r.map(pt).join(", ")})`:`(${pt(r.type)}...)`}class oo{constructor(e,i,a){this.type=z,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=a["case-sensitive"]===void 0?i.parse(!1,1,gn):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",gn);if(!h)return null;const g=a["diacritic-sensitive"]===void 0?i.parse(!1,1,gn):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",gn);if(!g)return null;let _=null;return a.locale&&(_=i.parseObjectValue(a.locale,1,"locale",Sn),!_)?null:new oo(h,g,_)}evaluate(e){return new Br(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function t_(r,e,i=0,a=r.length-1,h=Oa){for(;a>i;){if(a-i>600){const E=a-i+1,A=e-i+1,M=Math.log(E),P=.5*Math.exp(2*M/3),L=.5*Math.sqrt(M*P*(E-P)/E)*(A-E/2<0?-1:1);t_(r,e,Math.max(i,Math.floor(e-A*P/E+L)),Math.min(a,Math.floor(e+(E-A)*P/E+L)),h)}const g=r[e];let _=i,x=a;for(vf(r,i,e),h(r[a],g)>0&&vf(r,i,a);_<x;){for(vf(r,_,x),_++,x--;h(r[_],g)<0;)_++;for(;h(r[x],g)>0;)x--}h(r[i],g)===0?vf(r,i,x):(x++,vf(r,x,a)),x<=e&&(i=x+1),e<=x&&(a=x-1)}}function vf(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function Oa(r,e){return r<e?-1:r>e?1:0}function Iu(r){let e=0;for(let i,a,h=0,g=r.length,_=g-1;h<g;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}function ch(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ll(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function i_(r,e,i){const a=r[0]-e[0],h=r[1]-e[1],g=r[0]-i[0],_=r[1]-i[1];return a*_-g*h==0&&a*g<=0&&h*_<=0}function uh(r,e,i=!1){let a=!1;for(let x=0,E=e.length;x<E;x++){const A=e[x];for(let M=0,P=A.length,L=P-1;M<P;L=M++){const B=A[L],V=A[M];if(i_(r,B,V))return i;(g=B)[1]>(h=r)[1]!=(_=V)[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(a=!a)}}var h,g,_;return a}function pp(r,e,i,a){const h=a[0]-i[0],g=a[1]-i[1],_=(r[0]-i[0])*g-h*(r[1]-i[1]),x=(e[0]-i[0])*g-h*(e[1]-i[1]);return _>0&&x<0||_<0&&x>0}function mp(r,e,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(g=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*g[0]!=0&&!(!pp(r,e,i,a)||!pp(i,a,r,e));var h,g}function $c(r){const e=new Ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of r[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const _c=8192;function Vl(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*_c),Math.round(a*h*_c)]}function zm(r,e){for(let i=0;i<e.length;i++)if(uh(r,e[i]))return!0;return!1}function n_(r,e,i){for(const a of i)for(let h=0,g=a.length,_=g-1;h<g;_=h++)if(mp(r,e,a[_],a[h]))return!0;return!1}function yc(r,e){for(let i=0;i<r.length;++i)if(!uh(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(n_(r[i],r[i+1],e))return!1;return!0}function hh(r,e){for(let i=0;i<e.length;i++)if(yc(r,e[i]))return!0;return!1}function ud(r,e,i){const a=[];for(let h=0;h<r.length;h++){const g=[];for(let _=0;_<r[h].length;_++){const x=Vl(r[h][_],i);ch(e,x),g.push(x)}a.push(g)}return a}function La(r,e,i){const a=[];for(let h=0;h<r.length;h++){const g=ud(r[h],e,i);a.push(g)}return a}function Cu(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const h=.5*a;let g=r[0]-i[0]>h?-a:i[0]-r[0]>h?a:0;g===0&&(g=r[0]-i[2]>h?-a:i[2]-r[0]>h?a:0),r[0]+=g}ch(e,r)}function km(r,e,i,a){const h=Math.pow(2,a.z)*_c,g=[a.x*_c,a.y*_c],_=[];if(!r)return _;for(const x of r)for(const E of x){const A=[E.x+g[0],E.y+g[1]];Cu(A,e,i,h),_.push(A)}return _}function Nm(r,e,i,a){const h=Math.pow(2,a.z)*_c,g=[a.x*_c,a.y*_c],_=[];if(!r)return _;for(const E of r){const A=[];for(const M of E){const P=[M.x+g[0],M.y+g[1]];ch(e,P),A.push(P)}_.push(A)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const A of E)Cu(A,e,i,h)}var x;return _}class Ru{constructor(e,i){this.type=gn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Fl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const g=a.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ru(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ru(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ru(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(a.type==="Polygon"){const x=ud(a.coordinates,g,_),E=km(i.geometry(),h,g,_);if(!ll(h,g))return!1;for(const A of E)if(!uh(A,x))return!1}if(a.type==="MultiPolygon"){const x=La(a.coordinates,g,_),E=km(i.geometry(),h,g,_);if(!ll(h,g))return!1;for(const A of E)if(!zm(A,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(a.type==="Polygon"){const x=ud(a.coordinates,g,_),E=Nm(i.geometry(),h,g,_);if(!ll(h,g))return!1;for(const A of E)if(!yc(A,x))return!1}if(a.type==="MultiPolygon"){const x=La(a.coordinates,g,_),E=Nm(i.geometry(),h,g,_);if(!ll(h,g))return!1;for(const A of E)if(!hh(A,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Fm=1/298.257223563,Bm=Fm*(2-Fm),dh=Math.PI/180;class fh{static fromTile(e,i,a){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),g=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/dh;return new fh(g,a)}static get units(){return xf}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!xf[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(xf).join(", ")}`);const a=6378.137*dh*(i?xf[i]:1),h=Math.cos(e*dh),g=1/(1-Bm*(1-h*h)),_=Math.sqrt(g);this.kx=a*_*h,this.ky=a*_*g*(1-Bm)}distance(e,i){const a=Vo(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+h*h)}bearing(e,i){const a=Vo(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/dh}destination(e,i,a){const h=a*dh;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const h=e[a];for(let g=0,_=h.length,x=_-1;g<_;x=g++)i+=Vo(h[g][0]-h[x][0])*(h[g][1]+h[x][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const g=e[h],_=e[h+1],x=this.distance(g,_);if(a+=x,a>i)return Sa(g,_,(i-(a-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[h,g]=i,_=Vo(a[0]-h)*this.kx,x=(a[1]-g)*this.ky;if(_!==0||x!==0){const E=(Vo(e[0]-h)*this.kx*_+(e[1]-g)*this.ky*x)/(_*_+x*x);E>1?(h=a[0],g=a[1]):E>0&&(h+=_/this.kx*E,g+=x/this.ky*E)}return _=Vo(e[0]-h)*this.kx,x=(e[1]-g)*this.ky,Math.sqrt(_*_+x*x)}pointOnLine(e,i){let a=1/0,h=e[0][0],g=e[0][1],_=0,x=0;for(let E=0;E<e.length-1;E++){let A=e[E][0],M=e[E][1],P=Vo(e[E+1][0]-A)*this.kx,L=(e[E+1][1]-M)*this.ky,B=0;P===0&&L===0||(B=(Vo(i[0]-A)*this.kx*P+(i[1]-M)*this.ky*L)/(P*P+L*L),B>1?(A=e[E+1][0],M=e[E+1][1]):B>0&&(A+=P/this.kx*B,M+=L/this.ky*B)),P=Vo(i[0]-A)*this.kx,L=(i[1]-M)*this.ky;const V=P*P+L*L;V<a&&(a=V,h=A,g=M,_=E,x=B)}return{point:[h,g],index:_,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,a){let h=this.pointOnLine(a,e),g=this.pointOnLine(a,i);if(h.index>g.index||h.index===g.index&&h.t>g.t){const A=h;h=g,g=A}const _=[h.point],x=h.index+1,E=g.index;!bf(a[x],_[0])&&x<=E&&_.push(a[x]);for(let A=x+1;A<=E;A++)_.push(a[A]);return bf(a[E],g.point)||_.push(g.point),_}lineSliceAlong(e,i,a){let h=0;const g=[];for(let _=0;_<a.length-1;_++){const x=a[_],E=a[_+1],A=this.distance(x,E);if(h+=A,h>e&&g.length===0&&g.push(Sa(x,E,(e-(h-A))/A)),h>=i)return g.push(Sa(x,E,(i-(h-A))/A)),g;h>e&&g.push(E)}return g}bufferPoint(e,i){const a=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-a,e[0]+h,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-a,e[2]+h,e[3]+a]}insideBBox(e,i){return Vo(e[0]-i[0])>=0&&Vo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function bf(r,e){return r[0]===e[0]&&r[1]===e[1]}function Sa(r,e,i){const a=Vo(e[0]-r[0]);return[r[0]+a*i,r[1]+(e[1]-r[1])*i]}function Vo(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class la{constructor(e=[],i=((a,h)=>a<h?-1:a>h?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,h=i[e];for(;e>0;){const g=e-1>>1,_=i[g];if(a(h,_)>=0)break;i[e]=_,e=g}i[e]=h}_down(e){const{data:i,compare:a}=this,h=this.length>>1,g=i[e];for(;e<h;){let _=1+(e<<1);const x=_+1;if(x<this.length&&a(i[x],i[_])<0&&(_=x),a(i[_],g)>=0)break;i[e]=i[_],e=_}i[e]=g}}var Bt=8192;function wf(r,e){return e.dist-r.dist}const Zc=100,Xc=50;function ph(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function Ul(r){return r[1]-r[0]+1}function jl(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function mh(r,e){if(r[0]>r[1])return[null,null];const i=Ul(r);if(e){if(i===2)return[r,null];const a=Math.floor(i/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function Io(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!jl(e,r.length))return i;for(let a=e[0];a<=e[1];++a)ch(i,r[a]);return i}function vn(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let a=0;a<r[i].length;++a)ch(e,r[i][a]);return e}function fo(r,e,i){if(ph(r)||ph(e))return NaN;let a=0,h=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),i.distance([0,0],[a,h])}function Vm(r){return 360*r-180}function Yc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Tf(r,e){const i=Math.pow(2,e.z),a=(r.y/Bt+e.y)/i;return[Vm((r.x/Bt+e.x)/i),Yc(a)]}function gp(r,e){const i=[];for(let a=0;a<r.length;++a)i.push(Tf(r[a],e));return i}function or(r,e,i){const a=i.pointOnLine(e,r).point;return i.distance(r,a)}function _p(r,e,i,a,h){const g=i.slice(a[0],a[1]+1);let _=1/0;for(let x=e[0];x<=e[1];++x)if((_=Math.min(_,or(r[x],g,h)))===0)return 0;return _}function yp(r,e,i,a,h){const g=Math.min(h.pointToSegmentDistance(r,i,a),h.pointToSegmentDistance(e,i,a)),_=Math.min(h.pointToSegmentDistance(i,r,e),h.pointToSegmentDistance(a,r,e));return Math.min(g,_)}function Um(r,e,i,a,h){if(!jl(e,r.length)||!jl(a,i.length))return NaN;let g=1/0;for(let _=e[0];_<e[1];++_)for(let x=a[0];x<a[1];++x){if(mp(r[_],r[_+1],i[x],i[x+1]))return 0;g=Math.min(g,yp(r[_],r[_+1],i[x],i[x+1],h))}return g}function r_(r,e,i,a,h){if(!jl(e,r.length)||!jl(a,i.length))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let x=a[0];x<=a[1];++x)if((g=Math.min(g,h.distance(r[_],i[x])))===0)return g;return g}function cl(r,e,i){if(uh(r,e,!0))return 0;let a=1/0;for(const h of e){const g=h.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[g-1]&&(a=Math.min(a,i.pointToSegmentDistance(r,h[g-1],h[0])))===0||(a=Math.min(a,or(r,h,i)))===0)return a}return a}function hd(r,e,i,a){if(!jl(e,r.length))return NaN;for(let g=e[0];g<=e[1];++g)if(uh(r[g],i,!0))return 0;let h=1/0;for(let g=e[0];g<e[1];++g)for(const _ of i)for(let x=0,E=_.length,A=E-1;x<E;A=x++){if(mp(r[g],r[g+1],_[A],_[x]))return 0;h=Math.min(h,yp(r[g],r[g+1],_[A],_[x],a))}return h}function gh(r,e){for(const i of r)for(let a=0;a<=i.length-1;++a)if(uh(i[a],e,!0))return!0;return!1}function vp(r,e,i,a=1/0){const h=vn(r),g=vn(e);if(a!==1/0&&fo(h,g,i)>=a)return a;if(ll(h,g)){if(gh(r,e))return 0}else if(gh(e,r))return 0;let _=a;for(const x of r)for(let E=0,A=x.length,M=A-1;E<A;M=E++)for(const P of e)for(let L=0,B=P.length,V=B-1;L<B;V=L++){if(mp(x[M],x[E],P[V],P[L]))return 0;_=Math.min(_,yp(x[M],x[E],P[V],P[L],i))}return _}function Mu(r,e,i,a,h,g,_){if(g===null||_===null)return;const x=fo(Io(a,g),Io(h,_),i);x<e&&r.push({dist:x,range1:g,range2:_})}function ul(r,e,i,a,h=1/0){let g=Math.min(a.distance(r[0],i[0][0]),h);if(g===0)return g;const _=new la([{dist:0,range1:[0,r.length-1],range2:[0,0]}],wf),x=e?Xc:Zc,E=vn(i);for(;_.length;){const A=_.pop();if(A.dist>=g)continue;const M=A.range1;if(Ul(M)<=x){if(!jl(M,r.length))return NaN;if(e){const P=hd(r,M,i,a);if((g=Math.min(g,P))===0)return g}else for(let P=M[0];P<=M[1];++P){const L=cl(r[P],i,a);if((g=Math.min(g,L))===0)return g}}else{const P=mh(M,e);if(P[0]!==null){const L=fo(Io(r,P[0]),E,a);L<g&&_.push({dist:L,range1:P[0],range2:[0,0]})}if(P[1]!==null){const L=fo(Io(r,P[1]),E,a);L<g&&_.push({dist:L,range1:P[1],range2:[0,0]})}}}return g}function za(r,e,i,a,h,g=1/0){let _=Math.min(g,h.distance(r[0],i[0]));if(_===0)return _;const x=new la([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],wf),E=e?Xc:Zc,A=a?Xc:Zc;for(;x.length;){const M=x.pop();if(M.dist>=_)continue;const P=M.range1,L=M.range2;if(Ul(P)<=E&&Ul(L)<=A){if(!jl(P,r.length)||!jl(L,i.length))return NaN;if(e&&a?_=Math.min(_,Um(r,P,i,L,h)):e||a?e&&!a?_=Math.min(_,_p(i,L,r,P,h)):!e&&a&&(_=Math.min(_,_p(r,P,i,L,h))):_=Math.min(_,r_(r,P,i,L,h)),_===0)return _}else{const B=mh(P,e),V=mh(L,a);Mu(x,_,h,r,i,B[0],V[0]),Mu(x,_,h,r,i,B[0],V[1]),Mu(x,_,h,r,i,B[1],V[0]),Mu(x,_,h,r,i,B[1],V[1])}}return _}function vc(r,e,i,a,h=1/0){let g=h;const _=Io(r,[0,r.length-1]);for(const x of i)if(!(g!==1/0&&fo(_,Io(x,[0,x.length-1]),a)>=g)&&(g=Math.min(g,za(r,e,x,!0,a,g)),g===0))return g;return g}function ka(r,e,i,a,h=1/0){let g=h;const _=Io(r,[0,r.length-1]);for(const x of i){if(g!==1/0&&fo(_,vn(x),a)>=g)continue;const E=ul(r,e,x,a,g);if(isNaN(E))return E;if((g=Math.min(g,E))===0)return g}return g}function hl(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class ca{constructor(e,i){this.type=gi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Fl(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let h=0;h<a.features.length;++h)if(hl(a.features[h].geometry.type))return new ca(a,a.features[h].geometry)}else if(a.type==="Feature"){if(hl(a.geometry.type))return new ca(a,a.geometry)}else if(hl(a.type))return new ca(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return(function(h,g,_){const x=[];for(const A of h)for(const M of A)x.push(Tf(M,g));const E=new fh(x[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?za(x,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?vc(x,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?ka(x,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null})(i,a,this.geometries);if(e.geometryType()==="LineString")return(function(h,g,_){const x=[];for(const A of h){const M=[];for(const P of A)M.push(Tf(P,g));x.push(M)}const E=new fh(x[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return vc(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,E);if(_.type==="MultiLineString"){let A=1/0;for(let M=0;M<_.coordinates.length;M++){const P=vc(_.coordinates[M],!0,x,E,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(_.type==="Polygon"||_.type==="MultiPolygon"){let A=1/0;for(let M=0;M<x.length;M++){const P=ka(x[M],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null})(i,a,this.geometries);if(e.geometryType()==="Polygon")return(function(h,g,_){const x=[];for(const A of(function(M,P){const L=M.length;if(L<=1)return[M];const B=[];let V,Z;for(let K=0;K<L;K++){const Q=Iu(M[K]);Q!==0&&(M[K].area=Math.abs(Q),Z===void 0&&(Z=Q<0),Z===Q<0?(V&&B.push(V),V=[M[K]]):V.push(M[K]))}return V&&B.push(V),B})(h)){const M=[];for(let P=0;P<A.length;++P)M.push(gp(A[P],g));x.push(M)}const E=new fh(x[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return ka(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,E);if(_.type==="MultiLineString"){let A=1/0;for(let M=0;M<_.coordinates.length;M++){const P=ka(_.coordinates[M],!0,x,E,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(A,M,P){let L=1/0;for(const B of A)for(const V of M){const Z=vp(B,V,P,L);if(isNaN(Z))return Z;if((L=Math.min(L,Z))===0)return L}return L})(_.type==="Polygon"?[_.coordinates]:_.coordinates,x,E):null})(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function _h(r){if(r instanceof Bo&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ru||r instanceof ca)return!1;if(r instanceof Na)return r.featureConstant;let e=!0;return r.eachChild((i=>{e&&!_h(i)&&(e=!1)})),e}function dd(r){if(r instanceof Bo&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!dd(i)&&(e=!1)})),e}function fd(r){if(r instanceof Na)return new Set([r.key]);let e=new Set;return r.eachChild((i=>{e=new Set([...e,...fd(i)])})),e}function yh(r,e){if(r instanceof Bo&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((a=>{i&&!yh(a,e)&&(i=!1)})),i}function po(r,e,i){return[r,e,i].filter(Boolean).join("")}function ss(r,e){switch(r){case"string":return aa(e);case"number":return+e;case"boolean":return!!e;case"color":return In.parse(e);case"formatted":return ps.fromString(aa(e));case"resolvedImage":return ms.build(aa(e))}return e}function mr(r,e,i,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Na{constructor(e,i,a,h=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=h}static parse(e,i){let a=i.expectedType;if(a==null&&(a=wn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof Xi))return i.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const x=aa(h.value);if(e.length>=3){const E=i.parse(e[2],2);if(!(E instanceof Xi))return i.error("Scope of 'config' expression must be a string literal.");g=aa(E.value)}if(i.options){const E=po(x,g,i._scope),A=i.options.get(E);A&&(_=_h(A.value||A.default))}return new Na(a,x,g,_)}evaluate(e){const i=po(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:h,value:g,values:_,minValue:x,maxValue:E,stepValue:A}=a,M=a.default.evaluate(e);let P=M;if(g){const L=e.scope;e.scope=(L||"").split("").slice(1).join(""),P=g.evaluate(e),e.scope=L}return h&&(P=ss(h,P)),P===void 0||x===void 0&&E===void 0&&A===void 0||(typeof P=="number"?P=mr(P,x,E,A):Array.isArray(P)&&(P=P.map((L=>typeof L=="number"?mr(L,x,E,A):L)))),g!==void 0&&P!==void 0&&_&&!_.includes(P)&&(P=M,h&&(P=ss(h,P))),(h&&h!==this.type||P!==void 0&&!yr(ns(P),this.type))&&(P=ss(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class ua{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new ua(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class pd{constructor(e,i=[],a,h=new lh,g=[],_,x,E){this.registry=e,this.path=i,this.key=i.map((A=>typeof A=="string"?`['${A}']`:`[${A}]`)).join(""),this.scope=h,this.errors=g,this.expectedType=a,this._scope=_,this.options=x,this.iconImageUseTheme=E}parse(e,i,a,h,g={}){return i||a?this.concat(i,null,a,h)._parse(e,g):this._parse(e,g)}parseObjectValue(e,i,a,h,g,_={}){return this.concat(i,a,h,g)._parse(e,_)}_parse(e,i){function a(h,g,_){return _==="assert"?new Pi(g,[h]):_==="coerce"?new rs(g,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let g=h.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,x=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(_,x))return null}else g=a(g,_,i.typeAnnotation||"coerce");else g=a(g,_,i.typeAnnotation||"assert")}if(!(g instanceof Xi)&&g.type.kind!=="resolvedImage"&&xc(g)){const _=new gc(this._scope,this.options,this.iconImageUseTheme);try{g=new Xi(g.type,g.evaluate(_))}catch(x){return this.error(x.message),null}}return g}return rs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,h){let g=typeof e=="number"?this.path.concat(e):this.path;g=typeof i=="string"?g.concat(i):g;const _=h?this.scope.concat(h):this.scope;return new pd(this.registry,g,a||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Ea(a,e))}checkSubtype(e,i){const a=Ri(e,i);return a&&this.error(a),a}}function xc(r){if(r instanceof ua)return xc(r.boundExpression);if(r instanceof Bo&&r.name==="error"||r instanceof oo||r instanceof Ru||r instanceof ca||r instanceof Na)return!1;const e=r instanceof rs||r instanceof Pi;let i=!0;return r.eachChild((a=>{i=e?i&&xc(a):i&&a instanceof Xi})),!!i&&_h(r)&&yh(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ef(r,e){const i=r.length-1;let a,h,g=0,_=i,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),a=r[x],h=r[x+1],a<=e){if(x===i||e<h)return x;g=x+1}else{if(!(a>e))throw new ei("Input is not a number.");_=x-1}return 0}class md{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,gi);if(!a)return null;const h=[];let g=null;i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let _=1;_<e.length;_+=2){const x=_===1?-1/0:e[_],E=e[_+1],A=_,M=_+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=i.parse(E,M,g);if(!P)return null;g=g||P.type,h.push([x,P])}return new md(g,a,h)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const g=i.length;return h>=i[g-1]?a[g-1].evaluate(e):a[Ef(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const vh=.95047,Pu=1.08883,xp=4/29,dl=6/29,bp=3*dl*dl,Du=dl*dl*dl,Kc=Math.PI/180,Ou=180/Math.PI;function Gl(r){return r>Du?Math.pow(r,1/3):r/bp+xp}function gd(r){return r>dl?r*r*r:bp*(r-xp)}function _d(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Fa(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function yd(r){const e=Fa(r.r),i=Fa(r.g),a=Fa(r.b),h=Gl((.4124564*e+.3575761*i+.1804375*a)/vh),g=Gl((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Gl((.0193339*e+.119192*i+.9503041*a)/Pu)),alpha:r.a}}function Qc(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*gd(e),i=vh*gd(i),a=Pu*gd(a),new In(_d(3.2404542*i-1.5371385*e-.4985314*a),_d(-.969266*i+1.8760108*e+.041556*a),_d(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function Co(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const bc={forward:yd,reverse:Qc,interpolate:function(r,e,i){return{l:Ii(r.l,e.l,i),a:Ii(r.a,e.a,i),b:Ii(r.b,e.b,i),alpha:Ii(r.alpha,e.alpha,i)}}},Lu={forward:function(r){const{l:e,a:i,b:a}=yd(r),h=Math.atan2(a,i)*Ou;return{h:h<0?h+360:h,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Kc,i=r.c;return Qc({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Co(r.h,e.h,i),c:Ii(r.c,e.c,i),l:Ii(r.l,e.l,i),alpha:Ii(r.alpha,e.alpha,i)}}};var s_=Object.freeze({__proto__:null,hcl:Lu,lab:bc});class Ba{constructor(e,i,a,h,g){this.type=e,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,i,a,h){let g=0;if(e.name==="exponential")g=wp(i,e.base,a,h);else if(e.name==="linear")g=wp(i,1,a,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new xa(_[0],_[1],_[2],_[3]).solve(wp(i,1,a,h))}return g}static parse(e,i){let[a,h,g,..._]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const A=h[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:A}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const A=h.slice(1);if(A.length!==4||A.some((M=>typeof M!="number"||M<0||M>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(g=i.parse(g,2,gi),!g)return null;const x=[];let E=null;a==="interpolate-hcl"||a==="interpolate-lab"?E=Ao:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType);for(let A=0;A<_.length;A+=2){const M=_[A],P=_[A+1],L=A+3,B=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(x.length&&x[x.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const V=i.parse(P,B,E);if(!V)return null;E=E||V.type,x.push([M,V])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Ba(E,a,h,g,x):i.error(`Type ${pt(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const g=i.length;if(h>=i[g-1])return a[g-1].evaluate(e);const _=Ef(i,h),x=Ba.interpolationFactor(this.interpolation,h,i[_],i[_+1]),E=a[_].evaluate(e),A=a[_+1].evaluate(e);return this.operator==="interpolate"?Ds[this.type.kind.toLowerCase()](E,A,x):this.operator==="interpolate-hcl"?Lu.reverse(Lu.interpolate(Lu.forward(E),Lu.forward(A),x)):bc.reverse(bc.interpolate(bc.forward(E),bc.forward(A),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function wp(r,e,i,a){const h=a-i,g=r-i;return h===0?0:e===1?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}class bs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const x of e.slice(1)){const E=i.parse(x,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!E)return null;a=a||E.type,g.push(E)}const _=h&&g.some((x=>Ri(h,x.type)));return new bs(_?wn:a,g)}evaluate(e){let i,a=null,h=0;for(const g of this.args){if(h++,a=g.evaluate(e),a&&a instanceof ms&&!a.available&&(i||(i=a),a=null,h===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class vd{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=i.parse(e[g+1],g+1);if(!x)return null;a.push([_,x])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return h?new vd(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class xh{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,gi),h=i.parse(e[2],2,Ce(i.expectedType||wn));return a&&h?new xh(h.type.itemType,a,h):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ei("Array index out of bounds: negative index");if(i>=a.length)throw new ei("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new ei("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bh{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,gi),h=i.parse(e[2],2,Ce(i.expectedType||wn));return a&&h?new bh(h.type.itemType,a,h):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ei(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new ei(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const h=Math.floor(i),g=Math.ceil(i),_=a[h],x=a[g];if(typeof _!="number"||typeof x!="number")throw new ei(`Cannot interpolate between non-number values at index ${i}.`);const E=i-h;return _*(1-E)+x*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class xd{constructor(e,i){this.type=gn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,wn),h=i.parse(e[2],2,wn);return a&&h?Un(a.type,[gn,Sn,gi,Da,wn])?new xd(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pt(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!fs(i,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${pt(ns(i))} instead.`);if(!fs(a,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${pt(ns(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wc{constructor(e,i,a){this.type=gi,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,wn),h=i.parse(e[2],2,wn);if(!a||!h)return null;if(!Un(a.type,[gn,Sn,gi,Da,wn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pt(a.type)} instead`);if(e.length===4){const g=i.parse(e[3],3,gi);return g?new wc(a,h,g):null}return new wc(a,h)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!fs(i,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${pt(ns(i))} instead.`);if(!fs(a,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${pt(ns(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(i,h)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ql{constructor(e,i,a,h,g,_){this.inputType=e,this.type=i,this.input=a,this.cases=h,this.outputs=g,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const g={},_=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const P=e[A+1];Array.isArray(M)||(M=[M]);const L=i.concat(A);if(M.length===0)return L.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return L.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,ns(V)))return null}else a=ns(V);if(g[String(V)]!==void 0)return L.error("Branch labels must be unique.");g[String(V)]=_.length}const B=i.parse(P,A,h);if(!B)return null;h=h||B.type,_.push(B)}const x=i.parse(e[1],1,wn);if(!x)return null;const E=i.parse(e[e.length-1],e.length-1,h);return E?x.type.kind!=="value"&&i.concat(1).checkSubtype(a,x.type)?null:new ql(a,h,x,g,_,E):null}evaluate(e){const i=this.input.evaluate(e);return(yr(ns(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],h={};for(const _ of i){const x=h[this.cases[_]];x===void 0?(h[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[x][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of a)e.push(x.length===1?g(x[0]):x.map(g)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class jm{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const x=i.parse(e[_],_,gn);if(!x)return null;const E=i.parse(e[_+1],_+1,a);if(!E)return null;h.push([x,E]),a=a||E.type}const g=i.parse(e[e.length-1],e.length-1,a);return g?new jm(a,h,g):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class bd{constructor(e,i,a,h){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,wn),h=i.parse(e[2],2,gi);if(!a||!h)return null;if(!Un(a.type,[Ce(wn),Sn,wn]))return i.error(`Expected first argument to be of type array or string, but found ${pt(a.type)} instead`);if(e.length===4){const g=i.parse(e[3],3,gi);return g?new bd(a.type,a,h,g):null}return new bd(a.type,a,h)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!fs(i,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${pt(ns(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(a,h)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Gm{constructor(e,i){this.type=Ce(Sn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Sn),h=i.parse(e[2],2,Sn);return a&&h?new Gm(a,h):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function qm(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jc(r,e,i,a){return a.compare(e,i)===0}function eu(r,e,i){const a=r!=="=="&&r!=="!=";return class OP{constructor(g,_,x){this.type=gn,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let E=_.parse(g[1],1,wn);if(!E)return null;if(!qm(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${pt(E.type)}'.`);let A=_.parse(g[2],2,wn);if(!A)return null;if(!qm(x,A.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${pt(A.type)}'.`);if(E.type.kind!==A.type.kind&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${pt(E.type)}' and '${pt(A.type)}'.`);a&&(E.type.kind==="value"&&A.type.kind!=="value"?E=new Pi(A.type,[E]):E.type.kind!=="value"&&A.type.kind==="value"&&(A=new Pi(E.type,[A])));let M=null;if(g.length===4){if(E.type.kind!=="string"&&A.type.kind!=="string"&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(g[3],3,z),!M)return null}return new OP(E,A,M)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const E=ns(_),A=ns(x);if(E.kind!==A.kind||E.kind!=="string"&&E.kind!=="number")throw new ei(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${A.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const E=ns(_),A=ns(x);if(E.kind!=="string"||A.kind!=="string")return e(g,_,x)}return this.collator?i(g,_,x,this.collator.evaluate(g)):e(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[r];return this.eachChild((_=>{g.push(_.serialize())})),g}}}const Tp=eu("==",(function(r,e,i){return e===i}),Jc),o_=eu("!=",(function(r,e,i){return e!==i}),(function(r,e,i,a){return!Jc(0,e,i,a)})),wd=eu("<",(function(r,e,i){return e<i}),(function(r,e,i,a){return a.compare(e,i)<0})),Td=eu(">",(function(r,e,i){return e>i}),(function(r,e,i,a){return a.compare(e,i)>0})),Ep=eu("<=",(function(r,e,i){return e<=i}),(function(r,e,i,a){return a.compare(e,i)<=0})),Sp=eu(">=",(function(r,e,i){return e>=i}),(function(r,e,i,a){return a.compare(e,i)>=0}));class Ap{constructor(e,i,a,h,g,_){this.type=Sn,this.number=e,this.locale=i,this.currency=a,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,gi);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=i.parseObjectValue(h.locale,2,"locale",Sn),!g))return null;let _=null;if(h.currency&&(_=i.parseObjectValue(h.currency,2,"currency",Sn),!_))return null;let x=null;if(h.unit&&(x=i.parseObjectValue(h.unit,2,"unit",Sn),!x))return null;let E=null;if(h["min-fraction-digits"]&&(E=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",gi),!E))return null;let A=null;return h["max-fraction-digits"]&&(A=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",gi),!A)?null:new Ap(a,g,_,x,E,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ip{constructor(e){this.type=gi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pt(a.type)} instead.`):new Ip(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ei(`Expected value to be of type string or array, but found ${pt(ns(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function tu(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const fl={"==":Tp,"!=":o_,">":Td,"<":wd,">=":Sp,"<=":Ep,array:Pi,at:xh,"at-interpolated":bh,boolean:Pi,case:jm,coalesce:bs,collator:oo,format:Bl,image:mc,in:xd,"index-of":wc,interpolate:Ba,"interpolate-hcl":Ba,"interpolate-lab":Ba,length:Ip,let:vd,literal:Xi,match:ql,number:Pi,"number-format":Ap,object:Pi,slice:bd,step:md,string:Pi,"to-boolean":rs,"to-color":rs,"to-number":rs,"to-string":rs,var:ua,within:Ru,distance:ca,config:Na,split:Gm};function Hm(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const g=h?h.evaluate(r):1,_=Su(e,i,a,g);if(_)throw new ei(_);return new In(e/255,i/255,a/255,g)}function Cp(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const g=h?h.evaluate(r):1,_=(function(A,M,P,L){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof P=="number"&&P>=0&&P<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[A,M,P,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[A,M,P,L]:[A,M,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[A,M,P,L]:[A,M,P]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,a,g);if(_)throw new ei(_);const x=`hsla(${e}, ${i}%, ${a}%, ${g})`,E=In.parse(x);if(!E)throw new ei(`Failed to parse HSLA color: ${x}`);return E}function zu(r,e){return r in e}function ku(r,e){const i=e[r];return i===void 0?null:i}function Tc(r){return{type:r}}function Hl(r){return{result:"success",value:r}}function Wl(r){return{result:"error",value:r}}function Rp(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ec(r){return r["property-type"]==="data-driven"}function Mp(r){return Rp(r.expression,"measure-light")}function Sc(r){return Rp(r.expression,"zoom")}function Ed(r){return!!r.expression&&r.expression.interpolated}function Sd(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ac(r){return r}function $l(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),g=r.type||(Ed(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((A=>[A[0],In.parse(A[1])]))),r.default=In.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!s_[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,x,E;if(g==="exponential")_=Ad;else if(g==="interval")_=Cc;else if(g==="categorical"){_=Wm,x=Object.create(null);for(const A of r.stops)x[A[0]]=A[1];E=typeof r.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Sf}if(a){const A={},M=[];for(let B=0;B<r.stops.length;B++){const V=r.stops[B],Z=V[0].zoom;A[Z]===void 0&&(A[Z]={zoom:Z,type:r.type,property:r.property,default:r.default,stops:[]},M.push(Z)),A[Z].stops.push([V[0].value,V[1]])}const P=[];for(const B of M)P.push([A[B].zoom,$l(A[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ba.interpolationFactor.bind(void 0,L),zoomStops:P.map((B=>B[0])),evaluate:({zoom:B},V)=>Ad({stops:P,base:r.base},e,B).evaluate(B,V)}}if(h){const A=g==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ba.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map((M=>M[0])),evaluate:({zoom:M})=>_(r,e,M,x,E)}}return{kind:"source",evaluate(A,M){const P=M&&M.properties?M.properties[r.property]:void 0;return P===void 0?Ic(r.default,e.default):_(r,e,P,x,E)}}}function Ic(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Wm(r,e,i,a,h){return Ic(typeof i===h?a[i]:void 0,r.default,e.default)}function Cc(r,e,i){if(!ld(i))return Ic(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const h=Ef(r.stops.map((g=>g[0])),i);return r.stops[h][1]}function Ad(r,e,i){const a=r.base!==void 0?r.base:1;if(!ld(i))return Ic(r.default,e.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const g=Ef(r.stops.map((M=>M[0])),i),_=(function(M,P,L,B){const V=B-L,Z=M-L;return V===0?0:P===1?Z/V:(Math.pow(P,Z)-1)/(Math.pow(P,V)-1)})(i,a,r.stops[g][0],r.stops[g+1][0]),x=r.stops[g][1],E=r.stops[g+1][1];let A=Ds[e.type]||Ac;if(r.colorSpace&&r.colorSpace!=="rgb"){const M=s_[r.colorSpace];A=(P,L)=>M.reverse(M.interpolate(M.forward(P),M.forward(L),_))}return typeof x.evaluate=="function"?{evaluate(...M){const P=x.evaluate.apply(void 0,M),L=E.evaluate.apply(void 0,M);if(P!==void 0&&L!==void 0)return A(P,L,_)}}:A(x,E,_)}function Sf(r,e,i){return e.type==="color"?i=In.parse(i):e.type==="formatted"?i=ps.fromString(i.toString()):e.type==="resolvedImage"?i=ms.build(i.toString()):ki(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ic(i,r.default,e.default)}Bo.register(fl,{error:[{kind:"error"},[Sn],(r,[e])=>{throw new ei(e.evaluate(r))}],typeof:[Sn,[wn],(r,[e])=>pt(ns(e.evaluate(r)))],"to-rgba":[Ce(gi,4),[Ao],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ce(gi,4),[Ao],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ao,[gi,gi,gi],Hm],rgba:[Ao,[gi,gi,gi,gi],Hm],hsl:[Ao,[gi,gi,gi],Cp],hsla:[Ao,[gi,gi,gi,gi],Cp],has:{type:gn,overloads:[[[Sn],(r,[e])=>zu(e.evaluate(r),r.properties())],[[Sn,pc],(r,[e,i])=>zu(e.evaluate(r),i.evaluate(r))]]},get:{type:wn,overloads:[[[Sn],(r,[e])=>ku(e.evaluate(r),r.properties())],[[Sn,pc],(r,[e,i])=>ku(e.evaluate(r),i.evaluate(r))]]},"feature-state":[wn,[Sn],(r,[e])=>ku(e.evaluate(r),r.featureState||{})],properties:[pc,[],r=>r.properties()],"geometry-type":[Sn,[],r=>r.geometryType()],worldview:[Sn,[],r=>r.globals.worldview||""],id:[wn,[],r=>r.id()],zoom:[gi,[],r=>r.globals.zoom],pitch:[gi,[],r=>r.globals.pitch||0],"distance-from-center":[gi,[],r=>r.distanceFromCenter()],"measure-light":[gi,[Sn],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[gi,[],r=>r.globals.heatmapDensity||0],"line-progress":[gi,[],r=>r.globals.lineProgress||0],"raster-value":[gi,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[gi,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[gi,[],r=>r.globals.skyRadialProgress||0],accumulated:[wn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[gi,Tc(gi),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[gi,Tc(gi),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:gi,overloads:[[[gi,gi],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[gi],(r,[e])=>-e.evaluate(r)]]},"/":[gi,[gi,gi],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[gi,[gi,gi],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[gi,[],()=>Math.LN2],pi:[gi,[],()=>Math.PI],e:[gi,[],()=>Math.E],"^":[gi,[gi,gi],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[gi,[gi],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[gi,[gi],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[gi,[gi],(r,[e])=>Math.log(e.evaluate(r))],log2:[gi,[gi],(r,[e])=>Math.log2(e.evaluate(r))],sin:[gi,[gi],(r,[e])=>Math.sin(e.evaluate(r))],cos:[gi,[gi],(r,[e])=>Math.cos(e.evaluate(r))],tan:[gi,[gi],(r,[e])=>Math.tan(e.evaluate(r))],asin:[gi,[gi],(r,[e])=>Math.asin(e.evaluate(r))],acos:[gi,[gi],(r,[e])=>Math.acos(e.evaluate(r))],atan:[gi,[gi],(r,[e])=>Math.atan(e.evaluate(r))],min:[gi,Tc(gi),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[gi,Tc(gi),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[gi,[gi],(r,[e])=>Math.abs(e.evaluate(r))],round:[gi,[gi],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[gi,[gi],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[gi,[gi],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[gn,[Sn,wn],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[gn,[wn],(r,[e])=>r.id()===e.value],"filter-type-==":[gn,[Sn],(r,[e])=>r.geometryType()===e.value],"filter-<":[gn,[Sn,wn],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[gn,[wn],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[gn,[Sn,wn],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[gn,[wn],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[gn,[Sn,wn],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[gn,[wn],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[gn,[Sn,wn],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[gn,[wn],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[gn,[wn],(r,[e])=>e.value in r.properties()],"filter-has-id":[gn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[gn,[Ce(Sn)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[gn,[Ce(wn)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[gn,[Sn,Ce(wn)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[gn,[Sn,Ce(wn)],(r,[e,i])=>(function(a,h,g,_){for(;g<=_;){const x=g+_>>1;if(h[x]===a)return!0;h[x]>a?_=x-1:g=x+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Tc(gn),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Tc(gn),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[gn,[gn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[gn,[Sn],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Sn,[Sn],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Sn,[Sn],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Sn,Tc(wn),(r,e)=>e.map((i=>aa(i.evaluate(r)))).join("")],"resolved-locale":[Sn,[z],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[gi,[gi,gi,wn],(r,e)=>{const[i,a,h]=e.map((_=>_.evaluate(r)));if(i>a||i===a)return i;let g;if(typeof h=="string")g=(function(_){let x=0;if(_.length===0)return x;for(let E=0;E<_.length;E++)x=(x<<5)-x+_.charCodeAt(E),x|=0;return x})(h);else{if(typeof h!="number")throw new ei(`Invalid seed input: ${h}`);g=h}return i+tu(g)()*(a-i)}]});class Af{constructor(e,i,a,h,g){this.expression=e,this._warningHistory={},this._evaluator=new gc(a,h,g),this._defaultValue=i?(function(_){return _.type==="color"&&(Sd(_.default)||Array.isArray(_.default))?new In(0,0,0,0):_.type==="color"?In.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=fd(e)}evaluateWithoutErrorHandling(e,i,a,h,g,_,x,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,h,g,_,x,E,A){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map((P=>JSON.stringify(P))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Pp(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in fl}function ha(r,e,i,a,h){const g=new pd(fl,[],e?(function(x){const E={color:Ao,string:Sn,number:gi,enum:Sn,boolean:gn,formatted:ee,resolvedImage:ae};return x.type==="array"?Ce(E[x.value]||wn,x.length):E[x.type]})(e):void 0,void 0,void 0,i,a,h),_=g.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Hl(new Af(_,e,i,a,h)):Wl(g.errors)}class Nu{constructor(e,i,a,h){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!dd(i.expression),this.configDependencies=fd(i.expression)}evaluateWithoutErrorHandling(e,i,a,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,g,_)}evaluate(e,i,a,h,g,_,x){return this._styleExpression.evaluate(e,i,a,h,g,_,void 0,void 0,x)}}class iu{constructor(e,i,a,h,g,_){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!dd(i.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=fd(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,a,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,g,_)}evaluate(e,i,a,h,g,_){return this._styleExpression.evaluate(e,i,a,h,g,_)}interpolationFactor(e,i,a){return this.interpolationType?Ba.interpolationFactor(this.interpolationType,e,i,a):0}}function If(r,e,i,a,h){if((r=ha(r,e,i,a,h)).result==="error")return r;const g=r.value.expression,_=_h(g);if(!_&&!Ec(e))return Wl([new Ea("","data expressions not supported")]);const x=yh(g,["zoom","pitch","distance-from-center"]);if(!x&&!Sc(e))return Wl([new Ea("","zoom expressions not supported")]);const E=yh(g,["measure-light"]);if(!E&&!Mp(e))return Wl([new Ea("","measure-light expression not supported")]);const A=yh(g,["line-progress"]);if(!A&&!(function(L){return Rp(L.expression,"line-progress")})(e))return Wl([new Ea("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,P=Uo(g);return P||x||M?P instanceof Ea?Wl([P]):P instanceof Ba&&!Ed(e)?Wl([new Ea("",'"interpolate" expressions cannot be used with this property')]):Hl(P?new iu(_&&A?"camera":"composite",r.value,P.labels,P instanceof Ba?P.interpolation:void 0,E,A):new Nu(_&&A?"constant":"source",r.value,E,A)):Wl([new Ea("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Id{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,$l(this._parameters,this._specification))}static deserialize(e){return new Id(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Uo(r){let e=null;if(r instanceof vd)e=Uo(r.result);else if(r instanceof bs){for(const i of r.args)if(e=Uo(i),e)break}else(r instanceof md||r instanceof Ba)&&r.input instanceof Bo&&r.input.name==="zoom"&&(e=r);return e instanceof Ea||r.eachChild((i=>{const a=Uo(i);a instanceof Ea?e=a:e&&a&&e!==a&&(e=new Ea("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var jo,Zl,Dp=(function(){if(Zl)return jo;Zl=1,jo=e;var r=3;function e(i,a,h){var g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(a=_[1])+2*(h=_[2]);for(var x=0;x<this.d*this.d;x++){var E=_[r+x],A=_[r+x+1];g.push(E===A?null:_.subarray(E,A))}var M=_[r+g.length+1];this.keys=_.subarray(_[r+g.length],M),this.bboxes=_.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*h;for(var P=0;P<this.d*this.d;P++)g.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=h,this.scale=a/i,this.uid=0;var L=h/a*i;this.min=-L,this.max=i+L}return e.prototype.insert=function(i,a,h,g,_){this._forEachCell(a,h,g,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,h,g,_,x){this.cells[_].push(x)},e.prototype.query=function(i,a,h,g,_){var x=this.min,E=this.max;if(i<=x&&a<=x&&E<=h&&E<=g&&!_)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,a,h,g,this._queryCell,A,{},_),A},e.prototype._queryCell=function(i,a,h,g,_,x,E,A){var M=this.cells[_];if(M!==null)for(var P=this.keys,L=this.bboxes,B=0;B<M.length;B++){var V=M[B];if(E[V]===void 0){var Z=4*V;(A?A(L[Z+0],L[Z+1],L[Z+2],L[Z+3]):i<=L[Z+2]&&a<=L[Z+3]&&h>=L[Z+0]&&g>=L[Z+1])?(E[V]=!0,x.push(P[V])):E[V]=!1}}},e.prototype._forEachCell=function(i,a,h,g,_,x,E,A){for(var M=this._convertToCellCoord(i),P=this._convertToCellCoord(a),L=this._convertToCellCoord(h),B=this._convertToCellCoord(g),V=M;V<=L;V++)for(var Z=P;Z<=B;Z++){var K=this.d*Z+V;if((!A||A(this._convertFromCellCoord(V),this._convertFromCellCoord(Z),this._convertFromCellCoord(V+1),this._convertFromCellCoord(Z+1)))&&_.call(this,i,a,h,g,K,x,E,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=r+this.cells.length+1+1,h=0,g=0;g<this.cells.length;g++)h+=this.cells[g].length;var _=new Int32Array(a+h+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var x=a,E=0;E<i.length;E++){var A=i[E];_[r+E]=x,_.set(A,x),x+=A.length}return _[r+i.length]=x,_.set(this.keys,x),_[r+i.length+1]=x+=this.keys.length,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer},jo})(),Fu=ya(Dp);const Va={};function Xt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Va[e]={klass:r,omit:i.omit||[]}}Xt(Object,"Object"),Fu.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Fu.deserialize=function(r){return new Fu(r.buffer)},Object.defineProperty(Fu,"name",{value:"Grid"}),Xt(Fu,"Grid"),delete Ct.prototype.constructor,typeof DOMMatrix<"u"&&Xt(DOMMatrix,"DOMMatrix"),Xt(In,"Color"),Xt(Error,"Error"),Xt(ps,"Formatted"),Xt(oa,"FormattedSection"),Xt(Tu,"AJAXError"),Xt(ms,"ResolvedImage"),Xt(Id,"StylePropertyFunction"),Xt(Af,"StyleExpression",{omit:["_evaluator"]}),Xt(So,"ImageId"),Xt(Us,"ImageVariant"),Xt(iu,"ZoomDependentExpression"),Xt(Nu,"ZoomConstantExpression"),Xt(Bo,"CompoundExpression",{omit:["_evaluate"]});for(const r in fl)Va[fl[r]._classRegistryKey]||Xt(fl[r],`Expression${r}`);function Ss(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function pl(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Go(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Ss(r)||pl(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(Go(a,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[a,h]of r.entries())i.entries.push(Go(a),Go(h,e));return i}if(r instanceof Set){const i={$name:"Set"};let a=0;for(const h of r.values())i[++a]=Go(h);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of a)i[h]=r[h];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const g in r)r.hasOwnProperty(g)&&(Va[a].omit.indexOf(g)>=0||(h[g]=Go(r[g],e)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function Dn(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Ss(r)||pl(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Dn);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const h=r.entries||[],g=new Map;for(let _=0;_<h.length;_+=2)g.set(Dn(h[_]),Dn(h[_+1]));return g}if(e==="Set"){const h=new Set;for(const g of Object.keys(r))g!=="$name"&&h.add(Dn(r[g]));return h}if(e==="DOMMatrix"){let h;return h=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Va[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(a[h]=Dn(r[h]));return a}throw new Error("can't deserialize object of type "+typeof r)}const si={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Os(r){for(const e of r)if(Rc(e.charCodeAt(0)))return!0;return!1}function Cf(r){for(const e of r)if(!nu(e.charCodeAt(0)))return!1;return!0}function nu(r){return!(si.Arabic(r)||si["Arabic Supplement"](r)||si["Arabic Extended-A"](r)||si["Arabic Presentation Forms-A"](r)||si["Arabic Presentation Forms-B"](r))}function Rc(r){return!(r!==746&&r!==747&&(r<4352||!(si["Bopomofo Extended"](r)||si.Bopomofo(r)||si["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||si["CJK Compatibility Ideographs"](r)||si["CJK Compatibility"](r)||si["CJK Radicals Supplement"](r)||si["CJK Strokes"](r)||!(!si["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||si["CJK Unified Ideographs Extension A"](r)||si["CJK Unified Ideographs"](r)||si["Enclosed CJK Letters and Months"](r)||si["Hangul Compatibility Jamo"](r)||si["Hangul Jamo Extended-A"](r)||si["Hangul Jamo Extended-B"](r)||si["Hangul Jamo"](r)||si["Hangul Syllables"](r)||si.Hiragana(r)||si["Ideographic Description Characters"](r)||si.Kanbun(r)||si["Kangxi Radicals"](r)||si["Katakana Phonetic Extensions"](r)||si.Katakana(r)&&r!==12540||!(!si["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!si["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||si["Unified Canadian Aboriginal Syllabics"](r)||si["Unified Canadian Aboriginal Syllabics Extended"](r)||si["Vertical Forms"](r)||si["Yijing Hexagram Symbols"](r)||si["Yi Syllables"](r)||si["Yi Radicals"](r))))}function wh(r){return!(Rc(r)||(function(e){return!!(si["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||si["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||si["Letterlike Symbols"](e)||si["Number Forms"](e)||si["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||si["Control Pictures"](e)&&e!==9251||si["Optical Character Recognition"](e)||si["Enclosed Alphanumerics"](e)||si["Geometric Shapes"](e)||si["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||si["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||si["CJK Symbols and Punctuation"](e)||si.Katakana(e)||si["Private Use Area"](e)||si["CJK Compatibility Forms"](e)||si["Small Form Variants"](e)||si["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function Rf(r){return si.Arabic(r)||si["Arabic Supplement"](r)||si["Arabic Extended-A"](r)||si["Arabic Presentation Forms-A"](r)||si["Arabic Presentation Forms-B"](r)}function Th(r){return r>=1424&&r<=2303||si["Arabic Presentation Forms-A"](r)||si["Arabic Presentation Forms-B"](r)}function Ny(r,e){return!(!e&&Th(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||si.Khmer(r))}function Ls(r){for(const e of r)if(Th(e.charCodeAt(0)))return!0;return!1}const qo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Mf=null,Ro=qo.unavailable,ru=null;const a_=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ro=qo.error),Mf&&Mf(r)};function Pf(){Df.fire(new sa("pluginStateChange",{pluginStatus:Ro,pluginURL:ru}))}const Df=new al,Cd=function(){return Ro},js=function(){if(Ro!==qo.deferred||!ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ro=qo.loading,Pf(),ru&&To({url:ru},(r=>{r?a_(r):(Ro=qo.loaded,Pf())}))},Wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ro===qo.loaded||Wr.applyArabicShaping!=null,isLoading:()=>Ro===qo.loading,setState(r){Ro=r.pluginStatus,ru=r.pluginURL},isParsing:()=>Ro===qo.parsing,isParsed:()=>Ro===qo.parsed,getPluginURL:()=>ru};class Xn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,a){for(const h of i)if(!Ny(h.charCodeAt(0),a))return!1;return!0})(e,Wr.isLoaded())}}class Xl{constructor(e,i,a,h,g){this.property=e,this.value=i,this.expression=(function(_,x,E,A,M){if(Sd(_))return new Id(_,x);if(Pp(_)||Array.isArray(_)&&_.length>0){const P=If(_,x,E,A,M);if(P.result==="error")throw new Error(P.value.map((L=>`${L.key}: ${L.message}`)).join(", "));return P.value}{let P=_;return typeof _=="string"&&x.type==="color"&&(P=In.parse(_)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}})(i===void 0?e.specification.default:i,e.specification,a,h,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,h){return this.property.possiblyEvaluate(this,e,i,a,h)}}class Rd{constructor(e,i,a,h){this.property=e,this.value=new Xl(e,void 0,i,a,h)}transitioned(e,i){return new Mo(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Mo(this.property,this.value,null,{},0)}}class Op{constructor(e,i,a,h){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return Wi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Rd(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Xl(this._values[e].property,i===null?void 0:Wi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const h in e){const g=e[h];if(h.endsWith("-transition")){const _=h.slice(0,-11);a[_]&&this.setTransition(_,g)}else a.hasOwnProperty(h)&&this.setValue(h,g)}}getTransition(e){return Wi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Rd(this._values[e].property)),this._values[e].transition=Wi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const a=new Md(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,i._values[h]);return a}untransitioned(){const e=new Md(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Mo{constructor(e,i,a,h,g){const _=h.delay||0,x=h.duration||0;g=g||0,this.property=e,this.value=i,this.begin=g+_,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const h=e.now||0,g=this.value.possiblyEvaluate(e,i,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(e,i,a);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,a),g,me(x))}}return g}}class Md{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const h=new Bu(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,i,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class su{constructor(e,i,a,h){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return Wi(this._values[e].value)}setValue(e,i){this._values[e]=new Xl(this._values[e].property,i===null?void 0:Wi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,h){const g=new Bu(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(e,i,a,h);return g}}class ou{constructor(e,i,a,h){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,h){return this.property.evaluate(this.value,this.parameters,e,i,a,h,this.iconImageUseTheme)}}class Bu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Lt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const h=Ds[this.specification.type];return h?h(e,i,a):e}}class $t{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,h,g){return e.expression.kind==="constant"||e.expression.kind==="camera"?new ou(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,h,void 0,g)},i):new ou(this,e.expression,i,g)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new ou(this,{kind:"constant",value:void 0},e.parameters);const h=Ds[this.specification.type];return h?new ou(this,{kind:"constant",value:h(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,h,g,_,x){return e.kind==="constant"?e.value:e.evaluate(i,a,h,g,_,void 0,x)}}class Eh{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,h){return!!e.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class Or{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Xn(0,{});for(const a in e){const h=e[a];h.specification.overridable&&this.overridableProperties.push(a);const g=this.defaultPropertyValues[a]=new Xl(h,void 0),_=this.defaultTransitionablePropertyValues[a]=new Rd(h);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=g.possiblyEvaluate(i)}}}Xt($t,"DataDrivenProperty"),Xt(Lt,"DataConstantProperty"),Xt(Eh,"ColorRampProperty");var Be=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Pd(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Vu(r){if(Array.isArray(r))return r.map(Vu);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Vu(r[i]);return e}return Pd(r)}function Lp(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Lp(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Dd(r,e="",i=null,a="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lp(r)||(r=Of(r));const h=r;let g=!0;try{g=(function(M){if(!Uu(M))return M;let P=Vu(M);return ml(P),P=$m(P),P})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let _=null,x=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){x=Be[`filter_${a}`];const M=ha(g,x,e,i);if(M.result==="error")throw new Error(M.value.map((P=>`${P.key}: ${P.message}`)).join(", "));_=(P,L,B)=>M.value.evaluate(P,L,{},B)}let E=null,A=null;if(g!==h){const M=ha(h,x,e,i);if(M.result==="error")throw new Error(M.value.map((P=>`${P.key}: ${P.message}`)).join(", "));E=(P,L,B,V,Z)=>M.value.evaluate(P,L,{},B,void 0,void 0,V,Z),A=!_h(M.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:Xm(g),needFeature:!!A}}function $m(r){if(!Array.isArray(r))return r;const e=(function(i){if(Zm.has(i[0])){for(let a=1;a<i.length;a++)if(Uu(i[a]))return!0}return i})(r);return e===!0?e:e.map((i=>$m(i)))}function ml(r){let e=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||Uu(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Uu(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Uu(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}e&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)ml(r[a])}function Uu(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Uu(r[i]))return!0;return!1}const Zm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function l_(r,e){return r<e?-1:r>e?1:0}function Xm(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Xm(r[e]))return!0;return!1}function Of(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?zp(r[1],r[2],"=="):e==="!="?au(zp(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zp(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Of))):e==="all"?["all"].concat(r.slice(1).map(Of)):e==="none"?["all"].concat(r.slice(1).map(Of).map(au)):e==="in"?c_(r[1],r.slice(2)):e==="!in"?au(c_(r[1],r.slice(2))):e==="has"?Ym(r[1]):e!=="!has"||au(Ym(r[1]));var i}function zp(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function c_(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(l_)]]:["filter-in-small",r,["literal",e]]}}function Ym(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function au(r){return["!",r]}const Od="";function lu(r,e){return e?`${r}${Od}${e}`:r}let Ld;const Km=()=>Ld||(Ld=new Or({"icon-size":new $t(Be.layout_symbol["icon-size"]),"icon-image":new $t(Be.layout_symbol["icon-image"]),"icon-rotate":new $t(Be.layout_symbol["icon-rotate"]),"icon-offset":new $t(Be.layout_symbol["icon-offset"])}));class Qm{constructor(e,i,a,h,g,_){const x=ha(e,Be.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=i,a){this.properties=new Bu(Km()),this.unevaluatedLayout=new su(Km(),h,g,_);for(const E in a)this.unevaluatedLayout.setValue(E,a[E])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const u_="-transition",Jm=new Set(["fill","line","background","hillshade","raster"]);class mo extends al{constructor(e,i,a,h,g,_){if(super(),this.id=e.id,this.fqid=lu(this.id,a),this.type=e.type,this.scope=a,this.lut=h,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=ha(this.filter,Be[`filter_${e.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach((x=>{this.appearances.push(new Qm(x.condition,x.name,x.properties,this.scope,g,this.iconImageUseTheme))})),i.layout&&(this._unevaluatedLayout=new su(i.layout,this.scope,g,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Op(i.paint,this.scope,g);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Jm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(u_)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,h=a._properties.properties;if(e.endsWith(u_)){const P=e.slice(0,-11);return h[P]&&a.setTransition(P,i||void 0),!1}if(!h[e])return!1;const g=a._values[e],_=g.value.isDataDriven(),x=g.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const E=a._values[e].value,A=E.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return A||_||M||this._handleOverridablePaintPropertyUpdate(e,x,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),un(e,((i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof ou&&Ec(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Dd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,a,h,g,_,x,E,A){}}const cu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function pn(r,e=1){let i=0,a=0;return{members:r.map((h=>{const g=cu[h.type].BYTES_PER_ELEMENT,_=i=eg(i,Math.max(e,g)),x=h.components||1;return a=Math.max(a,g),i+=g*x,{name:h.name,type:h.type,components:x,offset:_}})),size:eg(i,Math.max(a,e)),alignment:e}}function eg(r,e){return Math.ceil(r/e)*e}class uu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=a,e}}uu.prototype.bytesPerElement=4,Xt(uu,"StructArrayLayout2i4");class hu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const g=3*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=h,e}}hu.prototype.bytesPerElement=6,Xt(hu,"StructArrayLayout3i6");class ju extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,h)}emplace(e,i,a,h,g){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=g,e}}ju.prototype.bytesPerElement=8,Xt(ju,"StructArrayLayout4i8");class du extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}du.prototype.bytesPerElement=4,Xt(du,"StructArrayLayout1f4");class tg extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const g=4*e,_=2*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.float32[_+1]=h,e}}tg.prototype.bytesPerElement=8,Xt(tg,"StructArrayLayout2i1f8");class zd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=h,e}}zd.prototype.bytesPerElement=8,Xt(zd,"StructArrayLayout3i8");class kp extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,g)}emplace(e,i,a,h,g,_){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=h,this.int16[x+3]=g,this.int16[x+4]=_,e}}kp.prototype.bytesPerElement=10,Xt(kp,"StructArrayLayout5i10");class Lf extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,g,_,x)}emplace(e,i,a,h,g,_,x,E){const A=6*e,M=12*e,P=3*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.uint8[M+4]=h,this.uint8[M+5]=g,this.uint8[M+6]=_,this.uint8[M+7]=x,this.float32[P+2]=E,e}}Lf.prototype.bytesPerElement=12,Xt(Lf,"StructArrayLayout2i4ub1f12");class Po extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const g=3*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,e}}Po.prototype.bytesPerElement=12,Xt(Po,"StructArrayLayout3f12");class fu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,g)}emplace(e,i,a,h,g,_){const x=6*e,E=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=a,this.uint16[x+2]=h,this.uint16[x+3]=g,this.float32[E+2]=_,e}}fu.prototype.bytesPerElement=12,Xt(fu,"StructArrayLayout4ui1f12");class Ah extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,h)}emplace(e,i,a,h,g){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=a,this.uint16[_+2]=h,this.uint16[_+3]=g,e}}Ah.prototype.bytesPerElement=8,Xt(Ah,"StructArrayLayout4ui8");class Np extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,h,g,_)}emplace(e,i,a,h,g,_,x){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=h,this.int16[E+3]=g,this.int16[E+4]=_,this.int16[E+5]=x,e}}Np.prototype.bytesPerElement=12,Xt(Np,"StructArrayLayout6i12");class ig extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,a,h,g,_,x,E,A,M,P,L)}emplace(e,i,a,h,g,_,x,E,A,M,P,L,B){const V=12*e;return this.int16[V+0]=i,this.int16[V+1]=a,this.int16[V+2]=h,this.int16[V+3]=g,this.uint16[V+4]=_,this.uint16[V+5]=x,this.uint16[V+6]=E,this.uint16[V+7]=A,this.int16[V+8]=M,this.int16[V+9]=P,this.int16[V+10]=L,this.int16[V+11]=B,e}}ig.prototype.bytesPerElement=24,Xt(ig,"StructArrayLayout4i4ui4i24");class Fp extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,h,g,_)}emplace(e,i,a,h,g,_,x){const E=10*e,A=5*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=h,this.float32[A+2]=g,this.float32[A+3]=_,this.float32[A+4]=x,e}}Fp.prototype.bytesPerElement=20,Xt(Fp,"StructArrayLayout3i3f20");class da extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,h)}emplace(e,i,a,h,g){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=g,e}}da.prototype.bytesPerElement=16,Xt(da,"StructArrayLayout4f16");class Gu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Gu.prototype.bytesPerElement=4,Xt(Gu,"StructArrayLayout1ul4");class os extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=a,e}}os.prototype.bytesPerElement=4,Xt(os,"StructArrayLayout2ui4");class Ih extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P,L,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,a,h,g,_,x,E,A,M,P,L,B)}emplace(e,i,a,h,g,_,x,E,A,M,P,L,B,V){const Z=20*e,K=10*e;return this.int16[Z+0]=i,this.int16[Z+1]=a,this.int16[Z+2]=h,this.int16[Z+3]=g,this.int16[Z+4]=_,this.float32[K+3]=x,this.float32[K+4]=E,this.float32[K+5]=A,this.float32[K+6]=M,this.int16[Z+14]=P,this.uint32[K+8]=L,this.uint16[Z+18]=B,this.uint16[Z+19]=V,e}}Ih.prototype.bytesPerElement=40,Xt(Ih,"StructArrayLayout5i4f1i1ul2ui40");class zf extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,g,_,x)}emplace(e,i,a,h,g,_,x,E){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.int16[A+2]=h,this.int16[A+4]=g,this.int16[A+5]=_,this.int16[A+6]=x,this.int16[A+7]=E,e}}zf.prototype.bytesPerElement=16,Xt(zf,"StructArrayLayout3i2i2i16");class Ch extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,g)}emplace(e,i,a,h,g,_){const x=4*e,E=8*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=h,this.int16[E+6]=g,this.int16[E+7]=_,e}}Ch.prototype.bytesPerElement=16,Xt(Ch,"StructArrayLayout2f1f2i16");class Bp extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,h,g,_)}emplace(e,i,a,h,g,_,x){const E=20*e,A=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=a,this.float32[A+1]=h,this.float32[A+2]=g,this.float32[A+3]=_,this.float32[A+4]=x,e}}Bp.prototype.bytesPerElement=20,Xt(Bp,"StructArrayLayout2ub4f20");class gs extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const g=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=h,e}}gs.prototype.bytesPerElement=6,Xt(gs,"StructArrayLayout3ui6");class kd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee)}emplace(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee,Se){const Me=30*e,De=15*e,Ne=60*e;return this.int16[Me+0]=i,this.int16[Me+1]=a,this.int16[Me+2]=h,this.float32[De+2]=g,this.float32[De+3]=_,this.uint16[Me+8]=x,this.uint16[Me+9]=E,this.uint32[De+5]=A,this.uint32[De+6]=M,this.uint32[De+7]=P,this.uint16[Me+16]=L,this.uint16[Me+17]=B,this.uint16[Me+18]=V,this.float32[De+10]=Z,this.float32[De+11]=K,this.uint8[Ne+48]=Q,this.uint8[Ne+49]=oe,this.uint8[Ne+50]=le,this.uint32[De+13]=he,this.int16[Me+28]=Ee,this.uint8[Ne+58]=Se,e}}kd.prototype.bytesPerElement=60,Xt(kd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class kf extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee,Se,Me,De,Ne,ft,je,mt,It,vt,Et,Ot,ut){const St=this.length;return this.resize(St+1),this.emplace(St,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee,Se,Me,De,Ne,ft,je,mt,It,vt,Et,Ot,ut)}emplace(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le,he,Ee,Se,Me,De,Ne,ft,je,mt,It,vt,Et,Ot,ut,St){const rt=20*e,Je=40*e,kt=80*e;return this.float32[rt+0]=i,this.float32[rt+1]=a,this.int16[Je+4]=h,this.int16[Je+5]=g,this.int16[Je+6]=_,this.int16[Je+7]=x,this.int16[Je+8]=E,this.int16[Je+9]=A,this.int16[Je+10]=M,this.int16[Je+11]=P,this.int16[Je+12]=L,this.uint16[Je+13]=B,this.uint16[Je+14]=V,this.uint16[Je+15]=Z,this.uint16[Je+16]=K,this.uint16[Je+17]=Q,this.uint16[Je+18]=oe,this.uint16[Je+19]=le,this.uint16[Je+20]=he,this.uint16[Je+21]=Ee,this.uint16[Je+22]=Se,this.uint16[Je+23]=Me,this.uint16[Je+24]=De,this.uint16[Je+25]=Ne,this.uint16[Je+26]=ft,this.uint16[Je+27]=je,this.uint32[rt+14]=mt,this.float32[rt+15]=It,this.float32[rt+16]=vt,this.float32[rt+17]=Et,this.float32[rt+18]=Ot,this.uint8[kt+76]=ut,this.uint16[Je+39]=St,e}}kf.prototype.bytesPerElement=80,Xt(kf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Rh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,h,g,_)}emplace(e,i,a,h,g,_,x){const E=6*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=h,this.float32[E+3]=g,this.float32[E+4]=_,this.float32[E+5]=x,e}}Rh.prototype.bytesPerElement=24,Xt(Rh,"StructArrayLayout6f24");class qu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,g)}emplace(e,i,a,h,g,_){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=h,this.float32[x+3]=g,this.float32[x+4]=_,e}}qu.prototype.bytesPerElement=20,Xt(qu,"StructArrayLayout5f20");class Vp extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,g,_,x)}emplace(e,i,a,h,g,_,x,E){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=a,this.float32[A+2]=h,this.float32[A+3]=g,this.float32[A+4]=_,this.float32[A+5]=x,this.float32[A+6]=E,e}}Vp.prototype.bytesPerElement=28,Xt(Vp,"StructArrayLayout7f28");class Mc extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,a,h,g,_,x,E,A,M,P)}emplace(e,i,a,h,g,_,x,E,A,M,P,L){const B=11*e;return this.float32[B+0]=i,this.float32[B+1]=a,this.float32[B+2]=h,this.float32[B+3]=g,this.float32[B+4]=_,this.float32[B+5]=x,this.float32[B+6]=E,this.float32[B+7]=A,this.float32[B+8]=M,this.float32[B+9]=P,this.float32[B+10]=L,e}}Mc.prototype.bytesPerElement=44,Xt(Mc,"StructArrayLayout11f44");class Nd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,h,g,_,x,E,A)}emplace(e,i,a,h,g,_,x,E,A,M){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=a,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=_,this.float32[P+5]=x,this.float32[P+6]=E,this.float32[P+7]=A,this.float32[P+8]=M,e}}Nd.prototype.bytesPerElement=36,Xt(Nd,"StructArrayLayout9f36");class Mh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=a,e}}Mh.prototype.bytesPerElement=8,Xt(Mh,"StructArrayLayout2f8");class Nf extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,h)}emplace(e,i,a,h,g){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=a,this.uint16[_+3]=h,this.uint16[_+4]=g,e}}Nf.prototype.bytesPerElement=12,Xt(Nf,"StructArrayLayout1ul3ui12");class Ph extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ph.prototype.bytesPerElement=2,Xt(Ph,"StructArrayLayout1ui2");class Up extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K)}emplace(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q){const oe=16*e;return this.float32[oe+0]=i,this.float32[oe+1]=a,this.float32[oe+2]=h,this.float32[oe+3]=g,this.float32[oe+4]=_,this.float32[oe+5]=x,this.float32[oe+6]=E,this.float32[oe+7]=A,this.float32[oe+8]=M,this.float32[oe+9]=P,this.float32[oe+10]=L,this.float32[oe+11]=B,this.float32[oe+12]=V,this.float32[oe+13]=Z,this.float32[oe+14]=K,this.float32[oe+15]=Q,e}}Up.prototype.bytesPerElement=64,Xt(Up,"StructArrayLayout16f64");class Hu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,g,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,g,_,x)}emplace(e,i,a,h,g,_,x,E){const A=10*e,M=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=h,this.uint16[A+3]=g,this.float32[M+2]=_,this.float32[M+3]=x,this.float32[M+4]=E,e}}Hu.prototype.bytesPerElement=20,Xt(Hu,"StructArrayLayout4ui3f20");class Dh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Dh.prototype.bytesPerElement=2,Xt(Dh,"StructArrayLayout1i2");class Ff extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Ff.prototype.bytesPerElement=1,Xt(Ff,"StructArrayLayout1ub1");class h_ extends Sh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}h_.prototype.size=40;class Bf extends Ih{get(e){return new h_(this,e)}}Xt(Bf,"CollisionBoxArray");class Gs extends Sh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Gs.prototype.size=60;class Qs extends kd{get(e){return new Gs(this,e)}}Xt(Qs,"PlacedSymbolArray");class ng extends Sh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ng.prototype.size=80;class rg extends kf{get(e){return new ng(this,e)}}Xt(rg,"SymbolInstanceArray");class sg extends du{getoffsetX(e){return this.float32[1*e+0]}}Xt(sg,"GlyphOffsetArray");class og extends uu{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Xt(og,"SymbolLineVertexArray");class Oh extends Sh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Oh.prototype.size=12;class ag extends Nf{get(e){return new Oh(this,e)}}Xt(ag,"FeatureIndexArray");class Vf extends os{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Xt(Vf,"FillExtrusionCentroidArray");class lg extends Sh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}lg.prototype.size=6;class d_ extends hu{get(e){return new lg(this,e)}}Xt(d_,"FillExtrusionWallArray");const jp=pn([{name:"a_pos",components:2,type:"Int16"}],4),cg=pn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),f_=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Er{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,h){let g=this.segments[this.segments.length-1];return e>Er.MAX_VERTEX_ARRAY_LENGTH&&Ki(`Max vertices per segment is ${Er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Er.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}prepareSegment(e,i,a,h){return this._prepareSegment(e,i.length,a.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,h){return new Er([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function Fd(r,e){return 256*(r=Ie(Math.floor(r),0,255))+Ie(Math.floor(e),0,255)}Er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(Er,"SegmentVector");const ug=pn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hg=pn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Bd=pn([{name:"a_dash",components:4,type:"Uint16"}]);class Vd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,h){this.ids.push(Uf(e)),this.positions.push(i,a,h)}eachPosition(e,i){const a=Uf(e);let h=0,g=this.ids.length-1;for(;h<g;){const _=h+g>>1;this.ids[_]>=a?g=_:h=_+1}for(;this.ids[h]===a;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Ud(a,h,0,a.length-1),i&&(i.add(a.buffer),i.add(h.buffer)),{ids:a,positions:h}}static deserialize(e){const i=new Vd;let a;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==a&&i.uniqueIds.push(h),a=h;return i.indexed=!0,i}}function Uf(r){const e=+r;return Number.isSafeInteger(e)?e:Nl(String(r))}function Ud(r,e,i,a){for(;i<a;){const h=r[i+a>>1];let g=i-1,_=a+1;for(;;){do g++;while(r[g]<h);do _--;while(r[_]>h);if(g>=_)break;Lh(r,g,_),Lh(e,3*g,3*_),Lh(e,3*g+1,3*_+1),Lh(e,3*g+2,3*_+2)}_-i<a-_?(Ud(r,e,i,_),i=_+1):(Ud(r,e,_+1,a),a=_)}}function Lh(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}Xt(Vd,"FeaturePositionMap");class Yl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class zh extends Yl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class ts extends Yl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class go extends Yl{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class kh extends Yl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class jf extends Yl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class dg extends Yl{constructor(e){super(e),this.current=In.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const pu=new Float32Array(16);class Nh extends Yl{constructor(e){super(e),this.current=pu}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let h=1;h<16;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const p_=new Float32Array(9),Gp=new Float32Array(4);class Wu extends Yl{constructor(e){super(e),this.current=Gp}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Jr(r){return[Fd(255*r.r,255*r.g),Fd(255*r.b,255*r.a)]}class Ua{constructor(e,i,a,h){this.value=e,this.uniformNames=i.map((g=>`u_${g}`)),this.type=a,this.context=h}setUniform(e,i,a,h,g){const _=h.constantOr(this.value);i.set(e,g,_ instanceof In?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new dg(e):new ts(e)}}class Fh{constructor(e,i){this.uniformNames=i.map((a=>`u_${a}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,h,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,g,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new jf(e):new ts(e)}}class mu{constructor(e,i,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map((g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,a,h,g,_,x,E){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Xn(0,{brightness:_,worldview:E}),i,{},g,h,x):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Xn(0,{brightness:_,worldview:E}),i,{},g,h,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(A,e,M,P?null:this.context.lut)}updatePaintArray(e,i,a,h,g,_,x,E){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:E},a,h,void 0,g):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Xn(0,{brightness:x,worldview:E}),a,h,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M?null:this.context.lut)}_setPaintValue(e,i,a,h){if(this.type==="color"){const g=Jr(a.toPremultipliedRenderColor(h));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ja{constructor(e,i,a,h,g,_){this.expression=e,this.uniformNames=i.map((x=>`u_${x}_t`)),this.type=a,this.useIntegerZoom=h,this.context=g,this.maxValue=0,this.paintVertexAttributes=i.map((x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,i,a,h,g,_,x,E){const A=this.expression.evaluate(new Xn(this.context.zoom,{brightness:_,worldview:E}),i,{},g,h,x),M=this.expression.evaluate(new Xn(this.context.zoom+1,{brightness:_,worldview:E}),i,{},g,h,x),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Xn(0,{brightness:_,worldview:E}),i,{},g,h,x):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,A,M,P?null:this.context.lut)}updatePaintArray(e,i,a,h,g,_,x,E){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:E},a,h,void 0,g),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:E},a,h,void 0,g),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Xn(0,{brightness:x,worldview:E}),a,h,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M,P?null:this.context.lut)}_setPaintValue(e,i,a,h,g){if(this.type==="color"){const _=Jr(a.toPremultipliedRenderColor(g)),x=Jr(a.toPremultipliedRenderColor(g));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,_[0],_[1],x[0],x[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,h,g){const _=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,x=Ie(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,g,x)}getBinding(e,i){return new ts(e)}}class Ho{constructor(e,i,a,h,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(a==="array"?Bd:ug).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Ah}populatePaintArray(e,i,a,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(g,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,h,g,_,x){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,i,a,h){if(!h||!a)return;const g=h[a[0]],_=h[a[1]];if(g){if(g){const{tl:x,br:E,pixelRatio:A}=g;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,x[0],x[1],E[0],E[1],A)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:E}=_;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,x[0],x[1],E[0],E[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,hg.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class $u{constructor(e,i,a=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const h=[];for(const g in e.paint._values){const _=e.paint.get(g);if(g.endsWith("-use-theme")||!a(g)||!(_ instanceof ou&&Ec(_.property.specification)))continue;const x=gu(g,e.type),E=_.value,A=_.property.specification.type,M=!!_.property.useIntegerZoom,P=g==="line-dasharray"||g.endsWith("pattern"),L=e.paint.get(`${g}-use-theme`),B=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(E.kind!=="constant"||B)if(E.kind==="source"||B||P){const V=o(g,A,"source");this.binders[g]=P?new Ho(E,x,A,V,e.id):new mu(E,x,A,V),h.push(`/a_${g}`)}else{const V=o(g,A,"composite");this.binders[g]=new ja(E,x,A,M,i,V),h.push(`/z_${g}`)}else this.binders[g]=P?new Fh(E.value,x):new Ua(E.value,x,A,i),h.push(`/u_${g}`);L&&(this.binders[g].lutExpression=L.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof mu||i instanceof ja?i.maxValue:0}populatePaintArrays(e,i,a,h,g,_,x,E){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof mu||M instanceof ja||M instanceof Ho)&&M.populatePaintArray(e,i,a,h,g,_,x,E)}}setConstantPatternPositions(e,i){for(const a in this.binders){const h=this.binders[a];h instanceof Fh&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ho?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,h,g,_,x,E,A,M){let P=!1;const L=Object.keys(e),B=L.length!==0&&!E,V=B?L:i.uniqueIds;this.context.lut=g.lut;for(const Z in this.binders){const K=this.binders[Z];if(K.context=this.context,(K instanceof mu||K instanceof ja||K instanceof Ho)&&K.expression&&K.expression.kind&&K.expression.kind!=="constant"&&(K.expression.isStateDependent===!0||K.expression.isLightConstant===!1)){const Q=g.paint.get(Z);K.expression=Q.value;for(const oe of V){const le=e[oe.toString()];i.eachPosition(oe,((he,Ee,Se)=>{const Me=h.feature(he);K.updatePaintArray(Ee,Se,Me,le,_,x,A,M)}))}if(!B)for(const oe of a.uniqueIds){const le=e[oe.toString()];a.eachPosition(oe,((he,Ee,Se)=>{const Me=h.feature(he);K.updatePaintArray(Ee,Se,Me,le,_,x,A,M)}))}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ua||a instanceof Fh)&&e.push(...a.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Ua||h instanceof Fh||h instanceof ja)for(const g of h.uniformNames)i.push({name:g,property:a,binding:h.getBinding(e,g)})}return i}setUniforms(e,i,a,h,g){for(const{name:_,property:x,binding:E}of a)this.binders[x].setUniform(e,E,g,h.get(x),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof mu||i instanceof ja||i instanceof Ho)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ho&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof mu||a instanceof ja||a instanceof Ho)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof mu||i instanceof ja||i instanceof Ho)&&i.destroy()}}}class gl{constructor(e,i,a=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new $u(h,i,a);this.needsUpload=!1,this._featureMap=new Vd,this._featureMapWithoutIds=new Vd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,h,g,_,x,E,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,h,g,_,x,E,A);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,h,g,_,x,E){for(const A of a)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,h,g,_,x||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jd={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function gu(r,e){return jd[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const f={"line-pattern":{source:fu,composite:fu},"fill-pattern":{source:fu,composite:fu},"fill-extrusion-pattern":{source:fu,composite:fu},"line-dasharray":{source:Ah,composite:Ah}},t={color:{source:Mh,composite:da},number:{source:du,composite:Mh}};function o(r,e,i){const a=f[r];return a&&a[i]||t[e][i]}Xt(Ua,"ConstantBinder"),Xt(Fh,"PatternConstantBinder"),Xt(mu,"SourceExpressionBinder"),Xt(Ho,"PatternCompositeBinder"),Xt(ja,"CompositeExpressionBinder"),Xt($u,"ProgramConfiguration",{omit:["_buffers"]}),Xt(gl,"ProgramConfigurationSet");const d=Bt/Math.PI/2,y=5,v=6,T=16383,S=64,R=[S,32,16],O=-d,k=d;function U(r,e,i,a=d){return i=Fe(i),[r*Math.sin(i)*a,-e*a,r*Math.cos(i)*a]}function F(r,e,i){return U(Math.cos(Fe(r)),Math.sin(Fe(r)),e,i)}const H=63710088e-1,$=2*Math.PI*H;class W{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new W(Le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,h=e.lat*i,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return H*Math.acos(Math.min(g,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new ie({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return F(this.lat,this.lng,d+e*d/H)}static convert(e){if(e instanceof W)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new W(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new W(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ie{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof W?new W(e.lng,e.lat):W.convert(e),this}setSouthWest(e){return this._sw=e instanceof W?new W(e.lng,e.lat):W.convert(e),this}extend(e){const i=this._sw,a=this._ne;let h,g;if(e instanceof W)h=e,g=e;else{if(!(e instanceof ie))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ie.convert(e)):this.extend(W.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(W.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return i||a?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),a.lng=Math.max(g.lng,a.lng),a.lat=Math.max(g.lat,a.lat)):(this._sw=new W(h.lng,h.lat),this._ne=new W(g.lng,g.lat)),this}getCenter(){return new W((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new W(this.getWest(),this.getNorth())}getSouthEast(){return new W(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=W.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(e){if(e)return e instanceof ie?e:new ie(e)}}const X=0,re=25.5;function ue(r){return $*Math.cos(r*Math.PI/180)}function de(r){return(180+r)/360}function be(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ye(r,e){return r/ue(e)}function ve(r){return 360*r-180}function ge(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function _e(r,e){return r*ue(ge(e))}const xe=85.051129;function Ze(r){return Math.cos(Fe(Ie(r,-xe,xe)))}function Oe(r,e){const i=Ie(e,X,re),a=Math.pow(2,i);return Ze(r)*$/(512*a)}function ot(r){return 1/Math.cos(r*Math.PI/180)}function qe(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/Bt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/Bt/(1<<r.z)}class nt{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=W.convert(e);return new nt(de(a.lng),be(a.lat),ye(i,a.lat))}toLngLat(){return new W(ve(this.x),ge(this.y))}toAltitude(){return _e(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$*ot(ge(this.y))}}function zt(r,e,i,a,h,g,_,x,E){const A=(e+a)/2,M=(i+h)/2,P=new Ct(A,M);x(P),(function(L,B,V,Z,K,Q){const oe=V-K,le=Z-Q;return Math.abs((Z-B)*oe-(V-L)*le)/Math.hypot(oe,le)})(P.x,P.y,g.x,g.y,_.x,_.y)>=E?(zt(r,e,i,A,M,g,P,x,E),zt(r,A,M,a,h,P,_,x,E)):r.push(_)}function He(r,e,i){let a=r[0],h=a.x,g=a.y;e(a);const _=[a];for(let x=1;x<r.length;x++){const E=r[x],{x:A,y:M}=E;e(E),zt(_,h,g,A,M,a,E,e,i),h=A,g=M,a=E}return _}function Pe(r,e,i,a){if(a(e,i)){const h=e.add(i)._mult(.5);Pe(r,e,h,a),Pe(r,h,i,a)}else r.push(i)}function lt(r,e){let i=r[0];const a=[i];for(let h=1;h<r.length;h++){const g=r[h];Pe(a,i,g,e),i=g}return a}const Ke=Math.pow(2,14)-1,yt=-Ke-1;function Rt(r,e){const i=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=Ie(i,yt,Ke),r.y=Ie(a,yt,Ke),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&Ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Yt(r,e,i){const a=r.loadGeometry(),h=r.extent,g=Bt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:E,y:A,projection:M}=i,P=L=>{const B=ve((e.x+L.x/h)/_),V=ge((e.y+L.y/h)/_),Z=M.project(B,V);L.x=(Z.x*x-E)*h,L.y=(Z.y*x-A)*h};for(let L=0;L<a.length;L++)if(r.type!==1)a[L]=He(a[L],P,1);else{const B=[];for(const V of a[L])V.x<0||V.x>=h||V.y<0||V.y>=h||(P(V),B.push(V));a[L]=B}}for(const _ of a)for(const x of _)Rt(x,g);return a}function Mt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Yt(r):[]}}class Tt{constructor(e,i,a,h,g){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=g,e.readFields(_i,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let h,g=1,_=0,x=0,E=0;for(;e.pos<i;){if(_<=0){const A=e.readVarint();g=7&A,_=A>>3}if(_--,g===1||g===2)x+=e.readSVarint(),E+=e.readSVarint(),g===1&&(h&&a.push(h),h=[]),h&&h.push(new Ct(x,E));else{if(g!==7)throw new Error(`unknown command ${g}`);h&&h.push(h[0].clone())}}return h&&a.push(h),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,h=0,g=0,_=0,x=1/0,E=-1/0,A=1/0,M=-1/0;for(;e.pos<i;){if(h<=0){const P=e.readVarint();a=7&P,h=P>>3}if(h--,a===1||a===2)g+=e.readSVarint(),_+=e.readSVarint(),g<x&&(x=g),g>E&&(E=g),_<A&&(A=_),_>M&&(M=_);else if(a!==7)throw new Error(`unknown command ${a}`)}return[x,A,E,M]}toGeoJSON(e,i,a){const h=this.extent*Math.pow(2,a),g=this.extent*e,_=this.extent*i,x=this.loadGeometry();function E(L){return[360*(L.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+_)/h)*Math.PI))-90]}function A(L){return L.map(E)}let M;if(this.type===1){const L=[];for(const V of x)L.push(V[0]);const B=A(L);M=L.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const L=x.map(A);M=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=(function(V){const Z=V.length;if(Z<=1)return[V];const K=[];let Q,oe;for(let le=0;le<Z;le++){const he=li(V[le]);he!==0&&(oe===void 0&&(oe=he<0),oe===he<0?(Q&&K.push(Q),Q=[V[le]]):Q&&Q.push(V[le]))}return Q&&K.push(Q),K})(x),B=[];for(const V of L)B.push(V.map(A));M=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const P={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function _i(r,e,i){r===1?e.id=i.readVarint():r===2?(function(a,h){const g=a.readVarint()+a.pos;for(;a.pos<g;){const _=h._keys[a.readVarint()],x=h._values[a.readVarint()];h.properties[_]=x}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function li(r){let e=0;for(let i,a,h=0,g=r.length,_=g-1;h<g;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}Tt.types=["Unknown","Point","LineString","Polygon"];class fi{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ci,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Tt(this._pbf,i,this.extent,this._keys,this._values)}}function ci(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(a){let h=null;const g=a.readVarint()+a.pos;for(;a.pos<g;){const _=a.readVarint()>>3;h=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(i))}class Fi{constructor(e,i){this.layers=e.readFields(bi,{},i)}}function bi(r,e,i){if(r===3){const a=new fi(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const Ei="3d_elevation_id",Ni="level";class ui{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,h){const g=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?a(h?h(g):g):i&&(this._valid=!1),this}}class Vi{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const _n=new Vi(((r,e,i)=>r.reset(e).require(Ei,(a=>{i.id=a})).optional("fixed_height_relative",(a=>{i.constantHeight=a}),Gi.decodeRelativeHeight).geometry((a=>{i.bounds=a}),$c).success()),((r,e,i)=>r.reset(e).require(Ei,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height_relative",(a=>{i.height=a}),Gi.decodeRelativeHeight).geometry((a=>{i.position=a}),Gi.getPoint).success())),qn=new Vi(((r,e,i)=>r.reset(e).require(Ei,(a=>{i.id=a})).optional("fixed_height",(a=>{i.constantHeight=a}),Gi.decodeMetricHeight).geometry((a=>{i.bounds=a}),$c).success()),((r,e,i)=>r.reset(e).require(Ei,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height",(a=>{i.height=a}),Gi.decodeMetricHeight).geometry((a=>{i.position=a}),Gi.getPoint).success()));class Gi{static getPoint(e){return ga(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?qn:void 0:_n}static parse(e){const i=[],a=[],h=e.length,g=new ui;for(let _=0;_<h;_++){const x=e.feature(_),E=x.properties.version,A=Gi.getVersionSchema(E);if(A===void 0){Ki(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const M=x.properties.type;if(!M)continue;const P=Tt.types[x.type];if(P==="Point"&&M==="curve_point"){const L={};A.parseVertex(g,x,L)&&i.push(L)}else if(P==="Polygon"&&M==="curve_meta"){const L={};A.parseFeature(g,x,L)&&a.push(L)}}return{vertices:i,features:a}}}class Mn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const h=Ts(i,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return a[0]=this.pos[0]+this.dir[0]*g,a[1]=this.pos[1]+this.dir[1]*g,!0}}class xn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const h=Li(i,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return a[0]=this.pos[0]+this.dir[0]*g,a[1]=this.pos[1]+this.dir[1]*g,a[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,i,a){if((function(B,V){var Z=B[0],K=B[1],Q=B[2],oe=V[0],le=V[1],he=V[2];return Math.abs(Z-oe)<=G*Math.max(1,Math.abs(Z),Math.abs(oe))&&Math.abs(K-le)<=G*Math.max(1,Math.abs(K),Math.abs(le))&&Math.abs(Q-he)<=G*Math.max(1,Math.abs(Q),Math.abs(he))})(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[h,g,_]=this.dir,x=this.pos[0]-e[0],E=this.pos[1]-e[1],A=this.pos[2]-e[2],M=h*h+g*g+_*_,P=2*(x*h+E*g+A*_),L=P*P-4*M*(x*x+E*E+A*A-i*i);if(L<0){const B=Math.max(-P/2,0),V=x+h*B,Z=E+g*B,K=A+_*B,Q=Math.hypot(V,Z,K);return a[0]=V*i/Q,a[1]=Z*i/Q,a[2]=K*i/Q,!1}{const B=(-P-Math.sqrt(L))/(2*M);if(B<0){const V=Math.hypot(x,E,A);return a[0]=x*i/V,a[1]=E*i/V,a[2]=A*i/V,!1}return a[0]=x+h*B,a[1]=E+g*B,a[2]=A+_*B,!0}}}class Qi{constructor(e,i,a,h,g){this.TL=e,this.TR=i,this.BR=a,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(e,i,a){const h=[-1,1,1],g=[1,1,1],_=[1,-1,1],x=[-1,-1,1],E=ur(h,h,e),A=ur(g,g,e),M=ur(_,_,e),P=ur(x,x,e);return new Qi(E,A,M,P,i/a)}}function $n(r,e,i){let a=1/0,h=-1/0;const g=[];for(const _ of r){Dr(g,_,e);const x=Li(g,i);a=Math.min(a,x),h=Math.max(h,x)}return[a,h]}function vr(r,e){let i=!0;for(let a=0;a<r.planes.length;a++){const h=r.planes[a];let g=0;for(let _=0;_<e.length;_++)g+=+(Li(h,e[_])+h[3]>=0);if(g===0)return 0;g!==e.length&&(i=!1)}return i?2:1}function ws(r,e){for(const i of r.projections){const a=$n(e,r.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function zn(r,e){let i=0;const a=[0,0,0,0];for(let _=0;_<r.length;_++)a[0]=r[_][0],a[1]=r[_][1],a[2]=r[_][2],a[3]=1,(h=a)[0]*(g=e)[0]+h[1]*g[1]+h[2]*g[2]+h[3]*g[3]>=0&&i++;var h,g;return i}class qi{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ci.fromPoints(this.points),this.projections=[],this.frustumEdges=[Dr([],this.points[2],this.points[3]),Dr([],this.points[0],this.points[3]),Dr([],this.points[4],this.points[0]),Dr([],this.points[5],this.points[1]),Dr([],this.points[6],this.points[2]),Dr([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const h=[0,-a[2],a[1]],g=[a[2],0,-a[0]];this.projections.push({axis:h,projection:$n(this.points,this.points[0],h)}),this.projections.push({axis:g,projection:$n(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(e,i,a,h){const g=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>{const M=Fs([],A,e),P=1/M[3]/i*g;return(L=M)[0]=(B=M)[0]*(V=[P,P,h?1/M[3]:P,P])[0],L[1]=B[1]*V[1],L[2]=B[2]*V[2],L[3]=B[3]*V[3],L;var L,B,V})),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((A=>{const M=Qt([],cn([],Dr([],_[A[0]],_[A[1]]),Dr([],_[A[2]],_[A[1]]))),P=-Li(M,_[A[1]]);return M.concat(P)})),E=[];for(let A=0;A<_.length;A++)E.push([_[A][0],_[A][1],_[A][2]]);return new qi(E,x)}intersectsPrecise(e,i,a){for(let h=0;h<i.length;h++)if(!zn(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!zn(e,this.planes[h]))return 0;for(const h of a)for(const g of this.frustumEdges){const _=cn([],h,g),x=Ue(_);if(x===0)continue;et(_,_,1/x);const E=$n(this.points,this.points[0],_),A=$n(e,this.points[0],_);if(E[0]>A[1]||A[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Li([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class Ci{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const h of e)jn(i,i,h),Wn(a,a,h);return new Ci(i,a)}static fromTileIdAndHeight(e,i,a){const h=1<<e.canonical.z,g=e.canonical.x,_=e.canonical.y;return new Ci([g/h,_/h,i],[(g+1)/h,(_+1)/h,a])}static applyTransform(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)ur(a[h],a[h],i);return Ci.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],h=[...a];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const x=i[4*_+g],E=x*e.min[_],A=x*e.max[_];a[g]+=Math.min(E,A),h[g]+=Math.max(E,A)}return new Ci(a,h)}static projectAabbCorners(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)ur(a[h],a[h],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=et([],Pt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=_t(this.min),h=_t(this.max);for(let g=0;g<i.length;g++)a[g]=i[g]?this.min[g]:this.center[g],h[g]=i[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ci(a,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?vr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?vr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ws(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ws(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Xt(Ci,"Aabb");class yn{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],h=-i[0],g=(e.extent+1)*this.metersToTile;return[new Ct(Math.trunc(e.position[0]+a*g),Math.trunc(e.position[1]+h*g)),new Ct(Math.trunc(e.position[0]-a*g),Math.trunc(e.position[1]-h*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mr{constructor(e,i,a,h,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Ms(),Ms(),Ms(),Ms(),Ms(),Ms(),Ms()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=g,this.edges=this.edges.filter((x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((E=this.vertices[x.a].position)[0]===(A=this.vertices[x.b].position)[0]&&E[1]===A[1]);var E,A})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:ga(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const E=this.vertices[x.a].position,A=this.vertices[x.b].position,M=Vs(Ms(),A,E),P=ac(M),L=Yr(Ms(),M,1/P);this.edgeProps.push({vec:M,dir:L,len:P});const B=this.vertexProps[x.a].dir,V=this.vertexProps[x.b].dir;vs(B,B,L),vs(V,V,L)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||hr(x.dir,x.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,h]=i;return Ii(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,h)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return Cn(0,0,1);const h=a[0],g=this.edges[h],_=this.edgeProps[h].vec,x=Cn(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*i),E=Cn(x[1],-x[0],0);cn(E,E,x);const A=Ue(E);return A>0?et(E,E,1/A):mn(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,h=0;const[g,_,x,E,A,M,P]=this._tmpVec2;ea(P,e.x,e.y);const L=new Mn(P,null);for(let B=0;B<this.edges.length;B++){const V=this.edges[B],Z=this.edgeProps[B].dir;L.dir=Z;const K=this.vertices[V.a].position,Q=this.vertices[V.b].position,oe=L.intersectsPlane(K,this.vertexProps[V.a].dir,g),le=L.intersectsPlane(Q,this.vertexProps[V.b].dir,_);if(!oe||!le)continue;Vs(x,_,g),Vs(E,P,g);const he=Ts(x,x),Ee=he>0?Ts(E,x)/he:0,Se=Ie(Ee,0,1),Me=Math.abs((Ee-Se)*this.edgeProps[B].len);Vs(A,P,K),ea(M,Z[1],-Z[0]);const De=Me+Math.abs(Ts(A,M));De<a&&(i=B,a=De,h=Se)}return[i,h]}tessellate(e){const i=$e(),a=$e(),h=$e(),g=$e();for(let _=this.edges.length-1;_>=0;--_){const x=this.edges[_].a,E=this.edges[_].b,{position:A,height:M,extent:P}=this.vertices[x],{position:L,height:B,extent:V}=this.vertices[E],Z=this.vertexProps[x].dir,K=this.vertexProps[E].dir;if(mn(i,A[0]/e,A[1]/e,M),mn(a,L[0]/e,L[1]/e,B),mn(h,Z[1],-Z[0],0),et(h,h,P),mn(g,K[1],-K[0],0),et(g,g,V),this.distSqLines(Cn(i[0]+.5*h[0],i[1]+.5*h[1],i[2]+.5*h[2]),Cn(a[0]-.5*g[0],a[1]-.5*g[1],a[2]-.5*g[2]),Cn(i[0]-.5*h[0],i[1]-.5*h[1],i[2]-.5*h[2]),Cn(a[0]+.5*g[0],a[1]+.5*g[1],a[2]+.5*g[2]))<=.0025000000000000005)continue;const Q=this.vertices.length,oe=vs(Ms(),A,L);this.vertices.push({position:Yr(oe,oe,.5),height:.5*(M+B),extent:.5*(P+V)});const le=vs(Ms(),Z,K);this.vertexProps.push({dir:hr(le,le)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:x,b:Q}),this.edges.push({a:Q,b:E});const he=Vs(Ms(),this.vertices[Q].position,A),Ee=ac(he),Se={vec:he,dir:Yr(Ms(),he,1/Ee),len:Ee};this.edgeProps.push(Se),this.edgeProps.push(Se)}}distSqLines(e,i,a,h){const g=Si($e(),i,e),_=Si($e(),h,a),x=Si($e(),e,a),E=Li(g,g),A=Li(g,_),M=Li(g,x),P=Li(_,_),L=Li(_,x),B=E*P-A*A;if(B===0)return Oi(Nn(g,a,h,Li(x,_)/Li(_,_)),e);const V=(E*L-A*M)/B;return Oi(Nn(g,e,i,(A*L-M*P)/B),Nn(_,a,h,V))}}class fr{static parseFrom(e,i){const a=Gi.parse(e);if(!a)return[];let{vertices:h,features:g}=a;const _=1/qe(i);g.sort(((M,P)=>M.id-P.id)),h.sort(((M,P)=>M.id-P.id||M.idx-P.idx)),h=h.filter(((M,P,L)=>P===L.findIndex((B=>B.id===M.id&&B.idx===M.idx))));const x=new Array;let E=0;const A=h.length;for(const M of g){if(M.constantHeight){x.push(new Mr(M.id,M.bounds,M.constantHeight));continue}for(;E!==A&&h[E].id<M.id;)E++;if(E===A||h[E].id!==M.id)continue;const P=new Array,L=new Array,B=E;for(;E!==A&&h[E].id===M.id;){const V=h[E];if(P.push({position:V.position,height:V.height,extent:V.extent}),E!==B&&h[E-1].idx===V.idx-1){const Z=E-B;L.push({a:Z-1,b:Z})}E++}x.push(new Mr(M.id,M.bounds,void 0,P,L,_))}return x}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Ei];return Number.isNaN(a)?void 0:i.find((h=>h.id===a))}}class as{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Bt,this.yOffset=(e.y*this.zScale-i.y)*Bt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const h=this.constantElevation(i,a);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*Ye(0,i,e>=0?e:Math.abs(.5*e))}}Xt(Mr,"ElevationFeature");class As{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new uu,this.indexArray=new gs,this.segments=new Er,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new du),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,h){const g=this.layers[0],_=[];let x=null;g.type==="circle"&&(x=g.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:P,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,V=Mt(A,B);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),V,a))continue;const Z=x?x.evaluate(V,{},a):void 0,K={id:M,properties:A.properties,type:A.type,sourceLayerIndex:L,index:P,geometry:B?V.geometry:Yt(A,a,h),patterns:{},sortKey:Z};_.push(K)}x&&_.sort(((A,M)=>A.sortKey-M.sortKey));let E=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Np,E=h.projection);for(const A of _){const{geometry:M,index:P,sourceLayerIndex:L}=A,B=e[P].feature;this.addFeature(A,M,P,i.availableImages,a,E,i.brightness,i.elevationFeatures),i.featureIndex.insert(B,M,P,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,h,g,_,x){this.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,f_.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,cg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,h,g,_,x,E){let A;this.elevationMode!=="none"&&(A=fr.getElevationFeature(e,E));for(const M of i)for(const P of M){const L=P.x,B=P.y;if(L<0||L>=Bt||B<0||B>=Bt)continue;if(_){const K=_.projectTilePoint(L,B,g),Q=_.upVector(g,L,B);this.addGlobeExtVertex(K,Q),this.addGlobeExtVertex(K,Q),this.addGlobeExtVertex(K,Q),this.addGlobeExtVertex(K,Q)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Z=V.vertexLength;if(this.addCircleVertex(L,B,-1,-1),this.addCircleVertex(L,B,1,-1),this.addCircleVertex(L,B,1,1),this.addCircleVertex(L,B,-1,1),this.elevationMode!=="none"){const K=A?A.pointElevation(new Ct(L,B)):0;this.hasElevation=this.hasElevation||K!==0;for(let Q=0;Q<4;Q++)this.elevatedLayoutVertexArray.emplaceBack(K)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h,g,x,void 0,this.worldview)}addCircleVertex(e,i,a,h){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Wo(r,e){for(let i=0;i<r.length;i++)if(Sr(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Sr(r,e[i]))return!0;return!!Hs(r,e)}function Js(r,e,i){return!!Sr(r,e)||!!$r(e,r,i)}function Lr(r,e){if(r.length===1)return cs(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let h=0;h<a.length;h++)if(Sr(r,a[h]))return!0}for(let i=0;i<r.length;i++)if(cs(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Hs(r,e[i]))return!0;return!1}function qs(r,e,i){if(r.length>1){if(Hs(r,e))return!0;for(let a=0;a<e.length;a++)if($r(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if($r(r[a],e,i))return!0;return!1}function Hs(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],h=r[i+1];for(let g=0;g<e.length-1;g++)if(eo(a,h,e[g],e[g+1]))return!0}return!1}function eo(r,e,i,a){return Zn(r,i,a)!==Zn(e,i,a)&&Zn(r,e,i)!==Zn(r,e,a)}function Ga(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function zr(r,e,i,a){const h=Ga(r,e,a),g=Ga(r,e,i);if(Math.sign(h)===Math.sign(g))return;const _=Ga(i,a,r),x=_+g-h;return Math.sign(_)!==Math.sign(x)?[_/(_-x),g/(g-h)]:void 0}function $r(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(cr(r,e[h-1],e[h])<a)return!0;return!1}function cr(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const h=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function cs(r,e){let i,a,h,g=!1;for(let _=0;_<r.length;_++){i=r[_];for(let x=0,E=i.length-1;x<i.length;E=x++)a=i[x],h=i[E],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Sr(r,e){let i=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){const g=r[a],_=r[h];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(i=!i)}return i}function is(r,e,i,a,h){for(const _ of r)if(e<=_.x&&i<=_.y&&a>=_.x&&h>=_.y)return!0;const g=[new Ct(e,i),new Ct(e,h),new Ct(a,h),new Ct(a,i)];if(r.length>2){for(const _ of g)if(Sr(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Vr(r[_],r[_+1],g))return!0;return!1}function Vr(r,e,i){const a=i[0],h=i[2];if(r.x<a.x&&e.x<a.x||r.x>h.x&&e.x>h.x||r.y<a.y&&e.y<a.y||r.y>h.y&&e.y>h.y)return!1;const g=Zn(r,e,i[0]);return g!==Zn(r,e,i[1])||g!==Zn(r,e,i[2])||g!==Zn(r,e,i[3])}function Kl(r,e,i,a,h,g){let _=e.y-r.y,x=r.x-e.x;if(g=g||0){const E=_*_+x*x;if(E===0)return!0;const A=Math.sqrt(E);_/=A,x/=A}return!((i.x-r.x)*_+(i.y-r.y)*x-g<0||(a.x-r.x)*_+(a.y-r.y)*x-g<0||(h.x-r.x)*_+(h.y-r.y)*x-g<0)}function Pc(r,e,i,a,h,g,_){return!(Kl(r,e,a,h,g,_)||Kl(e,i,a,h,g,_)||Kl(i,r,a,h,g,_)||Kl(a,h,r,e,i,_)||Kl(h,g,r,e,i,_)||Kl(g,a,r,e,i,_))}function Ql(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function fa(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Jl(r,e,i,a,h){if(!e[0]&&!e[1])return r;const g=Ct.convert(e)._mult(h);i==="viewport"&&g._rotate(-a);const _=[];for(let x=0;x<r.length;x++)_.push(r[x].sub(g));return _}function _l(r,e,i,a){const h=Ct.convert(r)._mult(a);return e==="viewport"&&h._rotate(-i),h}let ec,Dc;function tc(r,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}Xt(As,"CircleBucket",{omit:["layers"]});class Oc{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Gd(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=(function(g,_,x){var E=tc(256*g,256*(_=Math.pow(2,x)-_-1),x),A=tc(256*(g+1),256*(_+1),x);return E[0]+","+E[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),h=(function(g,_,x){let E,A="";for(let M=g;M>0;M--)E=1<<M-1,A+=(_&E?1:0)+(x&E?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gf{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Gd(e,i.z,i.z,i.x,i.y)}}class ao{constructor(e,i,a,h,g){this.overscaledZ=e,this.wrap=i,this.canonical=new Oc(a,+h,+g),this.key=i===0&&e===a?this.canonical.key:Gd(i,e,a,h,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ao(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ao(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Gd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Gd(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new ao(i,this.wrap,i,a,h),new ao(i,this.wrap,i,a+1,h),new ao(i,this.wrap,i,a,h+1),new ao(i,this.wrap,i,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ao(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gd(r,e,i,a,h){const g=1<<Math.min(i,22);let _=g*(h%g)+a%g;return r&&i<22&&(_+=g*g*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const g1=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new ao(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new ao(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new ao(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new ao(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Xt(Oc,"CanonicalTileID"),Xt(ao,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _1=pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:m_}=_1,Vx=pn([{name:"a_pos_3",components:3,type:"Int16"}]);var Fy=pn([{name:"a_pos",type:"Int16",components:2}]);function Bh(r){return r*d/H}const g_=[new Ci([O,O,O],[k,k,k]),new Ci([O,O,O],[0,0,k]),new Ci([0,O,O],[k,0,k]),new Ci([O,0,O],[0,k,k]),new Ci([0,0,O],[k,k,k])];function By(r,e,i,a=!0){const h=et([],r._camera.position,r.worldSize),g=[e,i,1,1];Fs(g,g,r.pixelMatrixInverse),Tr(g,g,1/g[3]);const _=Qt([],Dr([],g,h)),x=r.globeMatrix,E=[x[12],x[13],x[14]],A=Dr([],E,h),M=Ue(A),P=Qt([],A),L=r.worldSize/(2*Math.PI),B=Li(P,_),V=Math.asin(L/M);if(V<Math.acos(B)){if(!a)return null;const ft=[],je=[];et(ft,_,M/B),Qt(je,Dr(je,ft,A)),Qt(_,Pt(_,A,et(_,je,Math.tan(V)*M)))}const Z=[];new xn(h,_).closestPointOnSphere(E,L,Z);const K=Qt([],sr(x,0)),Q=Qt([],sr(x,1)),oe=Qt([],sr(x,2)),le=Li(K,Z),he=Li(Q,Z),Ee=Li(oe,Z),Se=J(Math.asin(-he/L));let Me=J(Math.atan2(le,Ee));Me=r.center.lng+(function(ft,je){const mt=(je-ft+180)%360-180;return mt<-180?mt+360:mt})(r.center.lng,Me);const De=de(Me),Ne=Ie(be(Se),0,1);return new nt(De,Ne)}class Ux{constructor(e,i,a){this.a=Dr([],e,a),this.b=Dr([],i,a),this.center=a;const h=Qt([],this.a),g=Qt([],this.b);this.angle=Math.acos(Li(h,g))}}function __(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(a,h,g,_){const x=Math.sin(g);return a*(Math.sin((1-_)*g)/x)+h*(Math.sin(_*g)/x)})(r.a[e],r.b[e],r.angle,Ie(i,0,1))+r.center[e]}function _u(r){if(r.z<=1)return g_[r.z+2*r.y+r.x];const e=y_(pg(r));return Ci.fromPoints(e)}function Zu(r,e,i){return et(r,r,1-i),Kt(r,r,e,i)}function Vy(r,e,i){for(const a of r)ur(a,a,e),et(a,a,i)}function fg(r,e,i,a){const h=e/r.worldSize,g=r.globeMatrix;if(i.z<=1){const Ne=_u(i).getCorners();return Vy(Ne,g,h),Ci.fromPoints(Ne)}const _=pg(i,a),x=y_(_,d+Bh(r._tileCoverLift));Vy(x,g,h);const E=Number.MAX_VALUE,A=[-E,-E,-E],M=[E,E,E];if(_.contains(r.center)){for(const je of x)jn(M,M,je),Wn(A,A,je);A[2]=0;const Ne=r.point,ft=[Ne.x*h,Ne.y*h,0];return jn(M,M,ft),Wn(A,A,ft),new Ci(M,A)}if(r._tileCoverLift>0){for(const Ne of x)jn(M,M,Ne),Wn(A,A,Ne);return new Ci(M,A)}const P=[g[12]*h,g[13]*h,g[14]*h],L=_.getCenter(),B=Ie(r.center.lat,-xe,xe),V=Ie(L.lat,-xe,xe),Z=de(r.center.lng),K=be(B);let Q=Z-de(L.lng);const oe=K-be(V);Q>.5?Q-=1:Q<-.5&&(Q+=1);let le=0;Math.abs(Q)>Math.abs(oe)?le=Q>=0?1:3:(le=oe>=0?0:2,Kt(P,P,[g[4]*h,g[5]*h,g[6]*h],-Math.sin(Fe(oe>=0?_.getSouth():_.getNorth()))*d));const he=x[le],Ee=x[(le+1)%4],Se=new Ux(he,Ee,P),Me=[__(Se,0)||he[0],__(Se,1)||he[1],__(Se,2)||he[2]],De=ic(r.zoom);if(De>0){const Ne=(function({x:je,y:mt,z:It},vt,Et,Ot,ut){const St=1/(1<<It);let rt=je*St,Je=rt+St,kt=mt*St,Dt=kt+St,xi=0;const ii=(rt+Je)/2-Ot;return ii>.5?xi=-1:ii<-.5&&(xi=1),rt=((rt+xi)*vt-(Ot*=vt))*Et+Ot,Je=((Je+xi)*vt-Ot)*Et+Ot,kt=(kt*vt-(ut*=vt))*Et+ut,Dt=(Dt*vt-ut)*Et+ut,[[rt,Dt,0],[Je,Dt,0],[Je,kt,0],[rt,kt,0]]})(i,e,r._pixelsPerMercatorPixel,Z,K);for(let je=0;je<x.length;je++)Zu(x[je],Ne[je],De);const ft=Pt([],Ne[le],Ne[(le+1)%4]);et(ft,ft,.5),Zu(Me,ft,De)}for(const Ne of x)jn(M,M,Ne),Wn(A,A,Ne);return M[2]=Math.min(he[2],Ee[2]),jn(M,M,Me),Wn(A,A,Me),new Ci(M,A)}function pg({x:r,y:e,z:i},a=!1){const h=1/(1<<i),g=new W(ve(r*h),e===(1<<i)-1&&a?-90:ge((e+1)*h)),_=new W(ve((r+1)*h),e===0&&a?90:ge(e*h));return new ie(g,_)}function y_(r,e=d){const i=Fe(r.getNorth()),a=Fe(r.getSouth()),h=Math.cos(i),g=Math.cos(a),_=Math.sin(i),x=Math.sin(a),E=r.getWest(),A=r.getEast();return[U(g,x,E,e),U(g,x,A,e),U(h,_,A,e),U(h,_,E,e)]}function Ur(r,e,i,a){const h=1<<i.z,g=(r/Bt+i.x)/h;return F(ge((e/Bt+i.y)/h),ve(g),a)}function qp({min:r,max:e}){return T/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const jx=new Float64Array(16);function mg(r){const e=qp(r),i=Ve(jx,[e,e,e]);return wt(i,i,bn([],r.min))}function Uy(r){const e=(a=r.min,(i=jx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const h=1/qp(r);return jt(e,e,[h,h,h])}function jy(r){const e=Bt/(2*Math.PI);return r/(2*Math.PI)/e}function Gx(r,e){return Bt/(512*Math.pow(2,r))*qp(_u(e))}function gg(r,e,i,a,h){const g=jy(i),_=[r,e,-i/(2*Math.PI)],x=Ge(new Float64Array(16));return wt(x,x,_),jt(x,x,[g,g,g]),wi(x,x,Fe(-h)),Ai(x,x,Fe(-a)),x}function ic(r){return Ye(y,v,r)}function v_(r,e){const i=F(e.lat,e.lng),a=(function(V){const Z=F(V._center.lat,V._center.lng);let K=cn([],Cn(0,1,0),Z);const Q=ke([],-V.angle,Z);K=ur(K,K,Q),ke(Q,-V._pitch,K);const oe=Qt([],Z);return et(oe,oe,Bh(V.cameraToCenterDistance/V.pixelsPerMeter)),ur(oe,oe,Q),Pt([],Z,oe)})(r);return _=(h=Si([],a,i))[0],x=h[1],E=h[2],A=(g=i)[0],M=g[1],P=g[2],B=(L=Math.sqrt((_*_+x*x+E*E)*(A*A+M*M+P*P)))&&Li(h,g)/L,Math.acos(Math.min(Math.max(B,-1),1));var h,g,_,x,E,A,M,P,L,B}function Hp(r,e){return v_(r,e)>Math.PI/2*1.01}const x_=Fe(85),qd=Math.cos(x_),Xu=Math.sin(x_),_g=at(),qx=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Gy(r,e,i,a,h,g,_,x,E){if(g&&r.queryGeometry.isAboveHorizon)return!1;g&&(E*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const L of P){const B=L.add(x),V=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(B.x,B.y,!0):0,Z=i.projection.projectTilePoint(B.x,B.y,A);if(V>0){const le=i.projection.upVector(A,B.x,B.y);Z.x+=le[0]*M*V,Z.y+=le[1]*M*V,Z.z+=le[2]*M*V}const K=g?B:Hx(Z.x,Z.y,Z.z,a),Q=g?r.tilespaceRays.map((le=>y1(le,V))):r.queryGeometry.screenGeometry,oe=Fs([],[Z.x,Z.y,Z.z,1],a);if(!_&&g?E*=oe[3]/i.cameraToCenterDistance:_&&!g&&(E*=i.cameraToCenterDistance/oe[3]),g){const le=ge((L.y/Bt+A.y)/(1<<A.z));E/=i.projection.pixelsPerMeter(le,1)/ye(1,le)}if(Js(Q,K,E))return!0}return!1}function Hx(r,e,i,a){const h=Fs([],[r,e,i,1],a);return new Ct(h[0]/h[3],h[1]/h[3])}const qy=Cn(0,0,0),Wx=Cn(0,0,1);function y1(r,e){const i=$e();return qy[2]=e,r.intersectsPlane(qy,Wx,i),new Ct(i[0],i[1])}class b_ extends As{}let Hy,Wy,$x,w_;function T_(r,{width:e,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=h,r}function Zx(r,e,i){const{width:a,height:h}=e;a===r.width&&h===r.height||($y(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,h)},i,null),r.width=a,r.height=h,r.data=e.data)}function $y(r,e,i,a,h,g,_,x){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const E=r.data,A=e.data,M=g===4&&x;for(let P=0;P<h.height;P++){const L=((i.y+P)*r.width+i.x)*g,B=((a.y+P)*e.width+a.x)*g;if(M)for(let V=0;V<h.width;V++){const Z=L+V*g+3,K=B+V*g;A[K+0]=255,A[K+1]=255,A[K+2]=255,A[K+3]=E[Z]}else if(_)for(let V=0;V<h.width;V++){const Z=L+V*g,K=B+V*g,Q=new In(E[Z+0]/255,E[Z+1]/255,E[Z+2]/255,E[Z+3]).toNonPremultipliedRenderColor(_).toArray();A[K+0]=Q[0],A[K+1]=Q[1],A[K+2]=Q[2],A[K+3]=Q[3]}else for(let V=0;V<h.width*g;V++)A[B+V]=E[L+V]}return e}Xt(b_,"HeatmapBucket",{omit:["layers"]});class Lc{constructor(e,i){T_(this,e,1,i)}resize(e){Zx(this,new Lc(e),1)}clone(){return new Lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,g){$y(e,i,a,h,g,1,null)}}class _o{constructor(e,i){T_(this,e,4,i)}resize(e){Zx(this,new _o(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,g,_,x){$y(e,i,a,h,g,4,_,x)}}class Zy{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function ar(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new _o({width:i,height:a}),g=(_,x,E)=>{e[r.evaluationKey]=E;const A=r.expression.evaluate(e),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(h.data[_+x+0]=Math.floor(255*M.r),h.data[_+x+1]=Math.floor(255*M.g),h.data[_+x+2]=Math.floor(255*M.b),h.data[_+x+3]=Math.floor(255*M.a))};if(r.clips)for(let _=0,x=0;_<a;++_,x+=4*i)for(let E=0,A=0;E<i;E++,A+=4){const M=E/(i-1),{start:P,end:L}=r.clips[_];g(x,A,P*(1-M)+L*M)}else for(let _=0,x=0;_<i;_++,x+=4)g(0,x,_/(i-1));return h}Xt(Lc,"AlphaImage"),Xt(_o,"RGBAImage");const Xy=pn([{name:"a_pos",components:2,type:"Int16"}],4),E_=pn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Yy=pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Xx=pn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Hd(r,e,i=2){const a=e&&e.length,h=a?e[0]*i:r.length;let g=Wp(r,0,h,i,!0);const _=[];if(!g||g.next===g.prev)return _;let x,E,A;if(a&&(g=(function(M,P,L,B){const V=[];for(let Z=0,K=P.length;Z<K;Z++){const Q=Wp(M,P[Z]*B,Z<K-1?P[Z+1]*B:M.length,B,!1);Q===Q.next&&(Q.steiner=!0),V.push(b1(Q))}V.sort(Qx);for(let Z=0;Z<V.length;Z++)L=us(V[Z],L);return L})(r,e,g,i)),r.length>80*i){x=r[0],E=r[1];let M=x,P=E;for(let L=i;L<h;L+=i){const B=r[L],V=r[L+1];B<x&&(x=B),V<E&&(E=V),B>M&&(M=B),V>P&&(P=V)}A=Math.max(M-x,P-E),A=A!==0?32767/A:0}return yg(g,_,i,x,E,A,0),_}function Wp(r,e,i,a,h){let g;if(h===(function(_,x,E,A){let M=0;for(let P=x,L=E-A;P<E;P+=A)M+=(_[L]-_[P])*(_[P+1]+_[L+1]),L=P;return M})(r,e,i,a)>0)for(let _=e;_<i;_+=a)g=tv(_/a|0,r[_],r[_+1],g);else for(let _=i-a;_>=e;_-=a)g=tv(_/a|0,r[_],r[_+1],g);return g&&Vh(g,g.next)&&(bg(g),g=g.next),g}function Yu(r,e){if(!r)return r;e||(e=r);let i,a=r;do if(i=!1,a.steiner||!Vh(a,a.next)&&Is(a.prev,a,a.next)!==0)a=a.next;else{if(bg(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function yg(r,e,i,a,h,g,_){if(!r)return;!_&&g&&(function(E,A,M,P){let L=E;do L.z===0&&(L.z=Do(L.x,L.y,A,M,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==E);L.prevZ.nextZ=null,L.prevZ=null,(function(B){let V,Z=1;do{let K,Q=B;B=null;let oe=null;for(V=0;Q;){V++;let le=Q,he=0;for(let Se=0;Se<Z&&(he++,le=le.nextZ,le);Se++);let Ee=Z;for(;he>0||Ee>0&&le;)he!==0&&(Ee===0||!le||Q.z<=le.z)?(K=Q,Q=Q.nextZ,he--):(K=le,le=le.nextZ,Ee--),oe?oe.nextZ=K:B=K,K.prevZ=oe,oe=K;Q=le}oe.nextZ=null,Z*=2}while(V>1)})(L)})(r,a,h,g);let x=r;for(;r.prev!==r.next;){const E=r.prev,A=r.next;if(g?v1(r,a,h,g):Yx(r))e.push(E.i,r.i,A.i),bg(r),r=A.next,x=A.next;else if((r=A)===x){_?_===1?yg(r=x1(Yu(r),e),e,i,a,h,g,2):_===2&&Kx(r,e,i,a,h,g):yg(Yu(r),e,i,a,h,g,1);break}}}function Yx(r){const e=r.prev,i=r,a=r.next;if(Is(e,i,a)>=0)return!1;const h=e.x,g=i.x,_=a.x,x=e.y,E=i.y,A=a.y,M=Math.min(h,g,_),P=Math.min(x,E,A),L=Math.max(h,g,_),B=Math.max(x,E,A);let V=a.next;for(;V!==e;){if(V.x>=M&&V.x<=L&&V.y>=P&&V.y<=B&&vg(h,x,g,E,_,A,V.x,V.y)&&Is(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function v1(r,e,i,a){const h=r.prev,g=r,_=r.next;if(Is(h,g,_)>=0)return!1;const x=h.x,E=g.x,A=_.x,M=h.y,P=g.y,L=_.y,B=Math.min(x,E,A),V=Math.min(M,P,L),Z=Math.max(x,E,A),K=Math.max(M,P,L),Q=Do(B,V,e,i,a),oe=Do(Z,K,e,i,a);let le=r.prevZ,he=r.nextZ;for(;le&&le.z>=Q&&he&&he.z<=oe;){if(le.x>=B&&le.x<=Z&&le.y>=V&&le.y<=K&&le!==h&&le!==_&&vg(x,M,E,P,A,L,le.x,le.y)&&Is(le.prev,le,le.next)>=0||(le=le.prevZ,he.x>=B&&he.x<=Z&&he.y>=V&&he.y<=K&&he!==h&&he!==_&&vg(x,M,E,P,A,L,he.x,he.y)&&Is(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;le&&le.z>=Q;){if(le.x>=B&&le.x<=Z&&le.y>=V&&le.y<=K&&le!==h&&le!==_&&vg(x,M,E,P,A,L,le.x,le.y)&&Is(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;he&&he.z<=oe;){if(he.x>=B&&he.x<=Z&&he.y>=V&&he.y<=K&&he!==h&&he!==_&&vg(x,M,E,P,A,L,he.x,he.y)&&Is(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function x1(r,e){let i=r;do{const a=i.prev,h=i.next.next;!Vh(a,h)&&ev(a,i,i.next,h)&&qf(a,h)&&qf(h,a)&&(e.push(a.i,i.i,h.i),bg(i),bg(i.next),i=r=h),i=i.next}while(i!==r);return Yu(i)}function Kx(r,e,i,a,h,g){let _=r;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&Jy(_,x)){let E=Jx(_,x);return _=Yu(_,_.next),E=Yu(E,E.next),yg(_,e,i,a,h,g,0),void yg(E,e,i,a,h,g,0)}x=x.next}_=_.next}while(_!==r)}function Qx(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function us(r,e){const i=(function(h,g){let _=g;const x=h.x,E=h.y;let A,M=-1/0;if(Vh(h,_))return _;do{if(Vh(h,_.next))return _.next;if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const Z=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Z<=x&&Z>M&&(M=Z,A=_.x<_.next.x?_:_.next,Z===x))return A}_=_.next}while(_!==g);if(!A)return null;const P=A,L=A.x,B=A.y;let V=1/0;_=A;do{if(x>=_.x&&_.x>=L&&x!==_.x&&Qy(E<B?x:M,E,L,B,E<B?M:x,E,_.x,_.y)){const Z=Math.abs(E-_.y)/(x-_.x);qf(_,h)&&(Z<V||Z===V&&(_.x>A.x||_.x===A.x&&Ky(A,_)))&&(A=_,V=Z)}_=_.next}while(_!==P);return A})(r,e);if(!i)return e;const a=Jx(i,r);return Yu(a,a.next),Yu(i,i.next)}function Ky(r,e){return Is(r.prev,r,e.prev)<0&&Is(e.next,r,r.next)<0}function Do(r,e,i,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function b1(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Qy(r,e,i,a,h,g,_,x){return(h-_)*(e-x)>=(r-_)*(g-x)&&(r-_)*(a-x)>=(i-_)*(e-x)&&(i-_)*(g-x)>=(h-_)*(a-x)}function vg(r,e,i,a,h,g,_,x){return!(r===_&&e===x)&&Qy(r,e,i,a,h,g,_,x)}function Jy(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,a){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&ev(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1})(r,e)&&(qf(r,e)&&qf(e,r)&&(function(i,a){let h=i,g=!1;const _=(i.x+a.x)/2,x=(i.y+a.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==i);return g})(r,e)&&(Is(r.prev,r,e.prev)||Is(r,e.prev,e))||Vh(r,e)&&Is(r.prev,r,r.next)>0&&Is(e.prev,e,e.next)>0)}function Is(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Vh(r,e){return r.x===e.x&&r.y===e.y}function ev(r,e,i,a){const h=$p(Is(r,e,i)),g=$p(Is(r,e,a)),_=$p(Is(i,a,r)),x=$p(Is(i,a,e));return h!==g&&_!==x||!(h!==0||!xg(r,i,e))||!(g!==0||!xg(r,a,e))||!(_!==0||!xg(i,r,a))||!(x!==0||!xg(i,e,a))}function xg(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function $p(r){return r>0?1:r<0?-1:0}function qf(r,e){return Is(r.prev,r,r.next)<0?Is(r,e,r.next)>=0&&Is(r,r.prev,e)>=0:Is(r,e,r.prev)<0||Is(r,r.next,e)<0}function Jx(r,e){const i=S_(r.i,r.x,r.y),a=S_(e.i,e.x,e.y),h=r.next,g=e.prev;return r.next=e,e.prev=r,i.next=h,h.prev=i,a.next=i,i.prev=a,g.next=a,a.prev=g,a}function tv(r,e,i,a){const h=S_(r,e,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function bg(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function S_(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function wg(r,e){const i=r.length;if(i<=1)return[r];const a=[];let h,g;for(let _=0;_<i;_++){const x=Cr(r[_]);x!==0&&(r[_].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(h&&a.push(h),h=[r[_]]):h.push(r[_]))}if(h&&a.push(h),e>1)for(let _=0;_<a.length;_++)a[_].length<=e||(t_(a[_],e,1,a[_].length-1,w1),a[_]=a[_].slice(0,e));return a}function w1(r,e){return e.area-r.area}function Uh(r,e,i=1){if(!r)return null;const a=typeof r=="string"?ms.from(r).getPrimary():r.getPrimary(),h=typeof r=="string"?null:r.getSecondary();for(const g of[a,h]){if(!g)continue;const _=g.id.toString();e.has(_)||e.set(_,[]),g.scaleSelf(i),e.get(_).push(g)}return{primary:a.toString(),secondary:h?h.toString():null}}function A_(r,e,i,a){const h=a.patternDependencies;let g=!1;for(const _ of e){const x=_.paint.get(`${r}-pattern`);x.isConstant()||(g=!0),Uh(x.constantOr(null),h,i)&&(g=!0)}return g}function I_(r,e,i,a,h,g){const _=g.patternDependencies;for(const x of e){const E=x.paint.get(`${r}-pattern`).value;if(E.kind!=="constant"){let A=E.evaluate({zoom:a},i,{},g.availableImages);A=A&&A.name?A.name:A;const M=Uh(A,_,h);if(!M)continue;const{primary:P,secondary:L}=M;P&&(i.patterns[x.id]=[P,L].filter(Boolean))}}return i}class C_{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class jh{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Bt&&i>=Bt}static evaluate(e){if(e.length===0)return new jh;let i=[];for(const E of e)i.push(...E.portals);if(i.length===0)return new jh;for(const E of i){const A=E.va,M=E.vb;(jh.isOnBorder(A.x,M.x)||jh.isOnBorder(A.y,M.y))&&(E.type="border")}const a=i.filter((E=>E.type!=="unevaluated")),h=i.filter((E=>E.type==="unevaluated"));if(h.length===0)return new jh;h.sort(((E,A)=>E.hash===A.hash?E.isTunnel===A.isTunnel?0:E.isTunnel?-1:1:E.hash<A.hash?1:-1)),i=a.concat(h);let g=a.length,_=g,x=g;do if(_++,_===i.length||i[g].hash!==i[_].hash){if(_-g==2){x<g&&(i[x]=i[g],i[g]=null);const E=i[x],A=i[_-1];E.type=E.isTunnel!==A.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:A.connection.a},x++}g=_}while(g!==i.length);return i.splice(x),i.sort(((E,A)=>E.hash<A.hash?1:-1)),{portals:i}}}Xt(jh,"ElevationPortalGraph"),Xt(C_,"ElevationPolygons");class T1{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let h=e[2];a!=null&&(h*=a);const g=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const x=this.outPositions.length;this.vertexLookup.set(g,x);const E=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(E,A,M),x}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const h=a.length===1,g=$e(),_=$e();for(let x=0;x<e.length;x+=3){const E=i[e[x+0]],A=i[e[x+1]],M=i[e[x+2]],P=h?a[0]:a[e[x+1]],L=h?a[0]:a[e[x+2]];mn(g,E.x,E.y,h?a[0]:a[e[x+0]]);const B=this.addVertex(g,_);mn(g,A.x,A.y,P);const V=this.addVertex(g,_);mn(g,M.x,M.y,L);const Z=this.addVertex(g,_);this.outIndices.emplaceBack(B,V,Z)}}addQuad(e,i,a,h,g,_){const x=this.addVertex(e,g,_),E=this.addVertex(i,g,_),A=this.addVertex(a,g,_),M=this.addVertex(h,g,_);this.addTriangle(x,E,A),this.addTriangle(A,M,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Aa{constructor(e,i,a,h){this.unevaluatedPortals=new jh,this.portalPolygons=new C_,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new tg,this.vertexNormals=new zd,this.indexArray=new gs,this.tileToMeters=qe(e),this.bridgeProgramConfigurations=new gl(i,{zoom:a,lut:h},(g=>g!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new gl(i,{zoom:a,lut:h},(g=>g!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const a=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return a}addTriangles(e,i,a){const h=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of e)h.push(g+i)}addRenderableRing(e,i,a,h,g,_){const x=[new Ct(g.min.x,g.min.y),new Ct(g.max.x,g.min.y),new Ct(g.max.x,g.max.y),new Ct(g.min.x,g.max.y)];for(let E=0;E<a-1;E++){const A=i+E,M=A+1,P=this.unevalVertices[A],L=this.unevalVertices[M];if(!(P.x>=g.min.x&&P.x<=g.max.x&&P.y>=g.min.y&&P.y<=g.max.y||L.x>=g.min.x&&L.x<=g.max.x&&L.y>=g.min.y&&L.y<=g.max.y||Vr(P,L,x))||this.isOnBorder(P.x,L.x)||this.isOnBorder(P.y,L.y))continue;const B=Aa.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let V,Z=this.vertexHashLookup.get(Aa.computePosHash(P));Z!=null?V=Z.next:(Z=this.vertexHashLookup.get(Aa.computePosHash(L)),V=Z!=null?Z.prev:B),this.unevalEdges.push({polygonIdx:e,a:A,b:M,hash:B,portalHash:V,isTunnel:h,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,a,h,g){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:g});const _=i[0];this.vertexHashLookup.clear();let x=Aa.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let E=0;E<_.length-1;E++){const A=_[E+0],M=_[E+1],P=ga(M.x-A.x,M.y-A.y),L=ac(P);if(L===0)continue;let B="unevaluated";const V=h.pointElevation(A),Z=h.pointElevation(M);Math.abs(V)<.01&&Math.abs(Z)<.01?B="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(B="border");const K=Aa.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:M,vab:P,length:L,hash:K,isTunnel:a,type:B});const Q=Aa.computePosHash(A);this.vertexHashLookup.set(Q,{prev:x,next:K}),x=K}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},h=new T1(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const g=i(),_=i(),x=i(),E=(L,B)=>{L.sort(((Z,K)=>Z.type===B&&K.type!==B?-1:Z.type!==B&&K.type===B?1:0));const V=L.findIndex((Z=>Z.type!==B));return V>=0?V:L.length};let A=0;this.unevalEdges.length>0&&(A=E(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),a(x);const M=i(),P=i();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(A),B=E(L,"tunnel")+A;this.unevalEdges.push(...L),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:B})}a(M),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(P),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(_),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(g),this.maskSegments=Er.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=Er.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Er.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Er.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=Er.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(e,i,a,h,g,_,x,E){this.bridgeProgramConfigurations.updatePaintArrays(e,i,g,a,h,_,x,E),this.tunnelProgramConfigurations.updatePaintArrays(e,i,g,a,h,_,x,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Yy.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Xx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,h,g){const _=(x,E)=>{for(let A=0;A<E.length-1;A++){const M=E[A].featureIndex,P=E[A+1].vertexStart,L=e.feature(M);x.populatePaintArrays(P,L,M,{},a,i,h,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,h,g){const _=new Map;for(let x=h;x<g;x++){const E=a[x],A=E.a,M=E.b,P=Aa.computePosHash(e[A]),L=Aa.computePosHash(e[M]);let B=_.get(P);B||(B={},_.set(P,B));let V=_.get(L);V||(V={},_.set(L,V)),i[A]<=0&&i[M]<=0||(B.to=M,V.from=A)}return _}isTerminalVertex(e,i){const a=Aa.computePosHash(this.unevalVertices[e]),h=i.get(a);return!h||!h.from||!h.to}constructBridgeStructures(e,i,a,h,g,_){e.clearVertexLookup();const x=this.computeVertexConnections(i,a,h,g.min,g.max),E=1/_,A=.5*E,M=(Et,Ot)=>mn(Et,i[Ot].x,i[Ot].y,a[Ot]*E),P=$e(),L=$e(),B=$e(),V=$e(),Z=$e(),K=(Et,Ot)=>{const ut=x.get(Aa.computePosHash(i[Ot])),St=ut.from,rt=ut.to;if(!St||!rt)return;M(P,St),M(L,Ot),M(B,rt),Ya(V),ys(P,L)||(Dr(Z,L,P),Qt(V,Z)),ys(B,L)||(Dr(Z,B,L),Pt(V,V,Qt(Z,Z)));const Je=Ka(V);return Je>0?et(Et,V,1/Je):void 0};let Q=Number.POSITIVE_INFINITY;this.sortSubarray(h,g.min,g.max,((Et,Ot)=>Et.featureInfo.featureIndex-Ot.featureInfo.featureIndex));const oe=$e(),le=$e(),he=$e(),Ee=$e(),Se=$e(),Me=$e(),De=$e(),Ne=$e(),ft=$e(),je=[$e(),$e(),$e(),$e()],mt=[$e(),$e(),$e(),$e()],It=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],vt=(Et,Ot)=>Et>Ot;for(let Et=g.min;Et<g.max;Et++){const Ot=h[Et];if(!Ot.featureInfo.guardRailEnabled||!this.prepareEdgePoints(It,i,a,Ot,vt))continue;const[ut,St]=It;if(mn(oe,ut.coord.x,ut.coord.y,E*ut.height),mn(le,St.coord.x,St.coord.y,E*St.height),ys(oe,le))continue;Dr(he,le,oe),Qt(he,he);const rt=K(Ne,Ot.a)||he,Je=K(ft,Ot.b)||he;mn(Ee,rt[1],-rt[0],0),Qt(Ee,Ee),mn(Se,Je[1],-Je[0],0),Qt(Se,Se),cn(Ne,Ee,rt),Qt(Me,Ne),cn(Ne,Se,Je),Qt(De,Ne),Pt(je[0],oe,et(Ne,Dr(Ne,Ee,Me),A)),Pt(je[1],oe,et(Ne,Pt(Ne,Ee,Me),A)),Pt(je[2],oe,et(Ne,Me,A)),je[3]=oe,Pt(mt[0],le,et(Ne,Dr(Ne,Se,De),A)),Pt(mt[1],le,et(Ne,Pt(Ne,Se,De),A)),Pt(mt[2],le,et(Ne,De,A)),mt[3]=le,Q=this.addFeatureSection(Ot.featureInfo.featureIndex,Q,this.bridgeFeatureSections,e);const kt=e.addVertex(je[0],Ee,_),Dt=e.addVertex(je[1],Ee,_),xi=e.addVertex(mt[0],Se,_),ii=e.addVertex(mt[1],Se,_);e.addTriangle(kt,Dt,xi),e.addTriangle(Dt,ii,xi);const hi=e.addVertex(je[1],Me,_),Ut=e.addVertex(je[2],Me,_),yi=e.addVertex(mt[1],De,_),ji=e.addVertex(mt[2],De,_);e.addTriangle(hi,Ut,yi),e.addTriangle(Ut,ji,yi),bn(Ee,Ee),bn(Se,Se);const Zt=e.addVertex(je[2],Ee,_),pi=e.addVertex(je[3],Ee,_),Di=e.addVertex(mt[2],Se,_),$i=e.addVertex(mt[3],Se,_);e.addTriangle(Zt,pi,Di),e.addTriangle(pi,$i,Di);const rn=this.isTerminalVertex(Ot.a,x),Yi=this.isTerminalVertex(Ot.b,x);ut.height<.01&&rn&&e.addQuad(je[3],je[2],je[1],je[0],bn(rt,rt),_),St.height<.01&&Yi&&e.addQuad(mt[0],mt[1],mt[2],mt[3],Je,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,h,g,_){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const E=(Q,oe)=>Q.featureInfo.featureIndex-oe.featureInfo.featureIndex;this.sortSubarray(h,g.min,g.max,E),this.sortSubarray(h,_.min,_.max,E);const A=Q=>Qt(Q,Q),M=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],P=(Q,oe)=>Q<oe,L=$e(),B=$e(),V=$e(),Z=$e(),K=$e();for(let Q=g.min;Q<g.max;Q++){if(!this.prepareEdgePoints(M,i,a,h[Q],P))continue;const[oe,le]=M,he=A(mn(K,-(le.coord.y-oe.coord.y),le.coord.x-oe.coord.x,0));x=this.addFeatureSection(h[Q].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(mn(L,oe.coord.x,oe.coord.y,oe.height),mn(B,le.coord.x,le.coord.y,le.height),mn(V,le.coord.x,le.coord.y,h[Q].isTunnel?-.1:0),mn(Z,oe.coord.x,oe.coord.y,h[Q].isTunnel?-.1:0),he)}for(let Q=_.min;Q<_.max;Q++){const oe=h[Q];oe.isTunnel&&([oe.a,oe.b]=[oe.b,oe.a]);const le=i[oe.a],he=i[oe.b],Ee=A(mn(K,-(he.y-le.y),he.x-le.x,0));x=this.addFeatureSection(oe.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(mn(L,he.x,he.y,0),mn(B,le.x,le.y,0),mn(V,le.x,le.y,a[oe.a]+4),mn(Z,he.x,he.y,a[oe.b]+4),Ee),e.addQuad(mn(L,le.x,le.y,0),mn(B,he.x,he.y,0),mn(V,he.x,he.y,a[oe.b]+4),mn(Z,le.x,le.y,a[oe.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,h){e.coord.x=i,e.coord.y=a,e.height=h}prepareEdgePoints(e,i,a,h,g){let _=i[h.a].x,x=i[h.a].y,E=i[h.b].x,A=i[h.b].y,M=a[h.a],P=a[h.b];const L=g(M,0),B=g(P,0);if(L&&B)return this.setElevatedPoint(e[0],_,x,M),this.setElevatedPoint(e[1],E,A,P),!0;if(!L&&!B)return!1;if(L){if(!B){const V=P/(P-M);E=Ii(E,_,V),A=Ii(A,x,V),P=Ii(P,M,V)}}else{const V=M/(M-P);_=Ii(_,E,V),x=Ii(x,A,V),M=Ii(M,P,V)}return this.setElevatedPoint(e[0],_,x,M),this.setElevatedPoint(e[1],E,A,P),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((x,E)=>x.hash===E.hash?E.polygonIdx-x.polygonIdx:E.hash>x.hash?1:-1));let a=0,h=0,g=0,_=i[a].polygonIdx;do h++,(h===i.length||i[a].hash!==i[h].hash)&&((h-a==1||i[h-1].polygonIdx!==_)&&(g<a&&(i[g]=i[a],i[a]=null),i[g].type="none",g++),a=h,a!==i.length&&(_=i[a].polygonIdx));while(a!==i.length);if(i.splice(g),i.length!==0&&e.length!==0){i.sort(((A,M)=>A.portalHash<M.portalHash?1:-1));let x=0,E=0;for(;x!==i.length&&E!==e.length;){const A=i[x],M=e[E];A.portalHash>M.hash?x++:M.hash>A.portalHash?E++:(A.type=M.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Bt&&i>=Bt}addFeatureSection(e,i,a,h){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,a,h){const g=e.slice(i,a);g.sort(h),e.splice(i,g.length,...g)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Aa.computePosHash(e))<<32n|BigInt(Aa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var R_,M_={exports:{}},e0=(R_||(R_=1,(function(r,e){(function(i){function a(fe,pe){return fe>pe?1:fe<pe?-1:0}var h=function(fe,pe){fe===void 0&&(fe=a),pe===void 0&&(pe=!1),this._compare=fe,this._root=null,this._size=0,this._noDuplicates=!!pe},g={size:{configurable:!0}};function _(fe,pe,it,dt,Wt){var Ht=Wt-dt;if(Ht>0){var ri=dt+Math.floor(Ht/2),Ti={key:pe[ri],data:it[ri],parent:fe};return Ti.left=_(Ti,pe,it,dt,ri),Ti.right=_(Ti,pe,it,ri+1,Wt),Ti}return null}function x(fe,pe,it,dt,Wt){if(!(it>=dt)){for(var Ht=fe[it+dt>>1],ri=it-1,Ti=dt+1;;){do ri++;while(Wt(fe[ri],Ht)<0);do Ti--;while(Wt(fe[Ti],Ht)>0);if(ri>=Ti)break;var sn=fe[ri];fe[ri]=fe[Ti],fe[Ti]=sn,sn=pe[ri],pe[ri]=pe[Ti],pe[Ti]=sn}x(fe,pe,it,Ti,Wt),x(fe,pe,Ti+1,dt,Wt)}}h.prototype.rotateLeft=function(fe){var pe=fe.right;pe&&(fe.right=pe.left,pe.left&&(pe.left.parent=fe),pe.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=pe:fe.parent.right=pe:this._root=pe,pe&&(pe.left=fe),fe.parent=pe},h.prototype.rotateRight=function(fe){var pe=fe.left;pe&&(fe.left=pe.right,pe.right&&(pe.right.parent=fe),pe.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=pe:fe.parent.right=pe:this._root=pe,pe&&(pe.right=fe),fe.parent=pe},h.prototype._splay=function(fe){for(;fe.parent;){var pe=fe.parent;pe.parent?pe.left===fe&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===fe&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===fe&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===fe?this.rotateRight(pe):this.rotateLeft(pe)}},h.prototype.splay=function(fe){for(var pe,it,dt,Wt,Ht;fe.parent;)(it=(pe=fe.parent).parent)&&it.parent?((dt=it.parent).left===it?dt.left=fe:dt.right=fe,fe.parent=dt):(fe.parent=null,this._root=fe),Wt=fe.left,Ht=fe.right,fe===pe.left?(it&&(it.left===pe?(pe.right?(it.left=pe.right,it.left.parent=it):it.left=null,pe.right=it,it.parent=pe):(Wt?(it.right=Wt,Wt.parent=it):it.right=null,fe.left=it,it.parent=fe)),Ht?(pe.left=Ht,Ht.parent=pe):pe.left=null,fe.right=pe,pe.parent=fe):(it&&(it.right===pe?(pe.left?(it.right=pe.left,it.right.parent=it):it.right=null,pe.left=it,it.parent=pe):(Ht?(it.left=Ht,Ht.parent=it):it.left=null,fe.right=it,it.parent=fe)),Wt?(pe.right=Wt,Wt.parent=pe):pe.right=null,fe.left=pe,pe.parent=fe)},h.prototype.replace=function(fe,pe){fe.parent?fe===fe.parent.left?fe.parent.left=pe:fe.parent.right=pe:this._root=pe,pe&&(pe.parent=fe.parent)},h.prototype.minNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.left;)fe=fe.left;return fe},h.prototype.maxNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.right;)fe=fe.right;return fe},h.prototype.insert=function(fe,pe){var it=this._root,dt=null,Wt=this._compare;if(this._noDuplicates)for(;it;){if(dt=it,Wt(it.key,fe)===0)return;it=Wt(it.key,fe)<0?it.right:it.left}else for(;it;)dt=it,it=Wt(it.key,fe)<0?it.right:it.left;return it={key:fe,data:pe,left:null,right:null,parent:dt},dt?Wt(dt.key,it.key)<0?dt.right=it:dt.left=it:this._root=it,this.splay(it),this._size++,it},h.prototype.find=function(fe){for(var pe=this._root,it=this._compare;pe;){var dt=it(pe.key,fe);if(dt<0)pe=pe.right;else{if(!(dt>0))return pe;pe=pe.left}}return null},h.prototype.contains=function(fe){for(var pe=this._root,it=this._compare;pe;){var dt=it(fe,pe.key);if(dt===0)return!0;pe=dt<0?pe.left:pe.right}return!1},h.prototype.remove=function(fe){var pe=this.find(fe);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var it=this.minNode(pe.right);it.parent!==pe&&(this.replace(it,it.right),it.right=pe.right,it.right.parent=it),this.replace(pe,it),it.left=pe.left,it.left.parent=it}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},h.prototype.removeNode=function(fe){if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var pe=this.minNode(fe.right);pe.parent!==fe&&(this.replace(pe,pe.right),pe.right=fe.right,pe.right.parent=pe),this.replace(fe,pe),pe.left=fe.left,pe.left.parent=pe}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},h.prototype.erase=function(fe){var pe=this.find(fe);if(pe){this.splay(pe);var it=pe.left,dt=pe.right,Wt=null;it&&(it.parent=null,Wt=this.maxNode(it),this.splay(Wt),this._root=Wt),dt&&(it?Wt.right=dt:this._root=dt,dt.parent=Wt),this._size--}},h.prototype.pop=function(){var fe=this._root,pe=null;if(fe){for(;fe.left;)fe=fe.left;pe={key:fe.key,data:fe.data},this.remove(fe.key)}return pe},h.prototype.next=function(fe){var pe=fe;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=fe.parent;pe&&pe.right===fe;)fe=pe,pe=pe.parent;return pe},h.prototype.prev=function(fe){var pe=fe;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=fe.parent;pe&&pe.left===fe;)fe=pe,pe=pe.parent;return pe},h.prototype.forEach=function(fe){for(var pe=this._root,it=[],dt=!1,Wt=0;!dt;)pe?(it.push(pe),pe=pe.left):it.length>0?(fe(pe=it.pop(),Wt++),pe=pe.right):dt=!0;return this},h.prototype.range=function(fe,pe,it,dt){for(var Wt=[],Ht=this._compare,ri=this._root;Wt.length!==0||ri;)if(ri)Wt.push(ri),ri=ri.left;else{if(Ht((ri=Wt.pop()).key,pe)>0)break;if(Ht(ri.key,fe)>=0&&it.call(dt,ri))return this;ri=ri.right}return this},h.prototype.keys=function(){for(var fe=this._root,pe=[],it=[],dt=!1;!dt;)fe?(pe.push(fe),fe=fe.left):pe.length>0?(fe=pe.pop(),it.push(fe.key),fe=fe.right):dt=!0;return it},h.prototype.values=function(){for(var fe=this._root,pe=[],it=[],dt=!1;!dt;)fe?(pe.push(fe),fe=fe.left):pe.length>0?(fe=pe.pop(),it.push(fe.data),fe=fe.right):dt=!0;return it},h.prototype.at=function(fe){for(var pe=this._root,it=[],dt=!1,Wt=0;!dt;)if(pe)it.push(pe),pe=pe.left;else if(it.length>0){if(pe=it.pop(),Wt===fe)return pe;Wt++,pe=pe.right}else dt=!0;return null},h.prototype.load=function(fe,pe,it){if(fe===void 0&&(fe=[]),pe===void 0&&(pe=[]),it===void 0&&(it=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var dt=fe.length;return it&&x(fe,pe,0,dt-1,this._compare),this._root=_(null,fe,pe,0,dt),this._size=dt,this},h.prototype.min=function(){var fe=this.minNode(this._root);return fe?fe.key:null},h.prototype.max=function(){var fe=this.maxNode(this._root);return fe?fe.key:null},h.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},h.createTree=function(fe,pe,it,dt,Wt){return new h(it,Wt).load(fe,pe,dt)},Object.defineProperties(h.prototype,g);var E=0,A=1,M=2,P=3,L=0,B=1,V=2,Z=3;function K(fe,pe,it){pe===null?(fe.inOut=!1,fe.otherInOut=!0):(fe.isSubject===pe.isSubject?(fe.inOut=!pe.inOut,fe.otherInOut=pe.otherInOut):(fe.inOut=!pe.otherInOut,fe.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(fe.prevInResult=!Q(pe,it)||pe.isVertical()?pe.prevInResult:pe));var dt=Q(fe,it);fe.resultTransition=dt?(function(Wt,Ht){var ri,Ti=!Wt.inOut,sn=!Wt.otherInOut;switch(Ht){case L:ri=Ti&&sn;break;case B:ri=Ti||sn;break;case Z:ri=Ti^sn;break;case V:ri=Wt.isSubject?Ti&&!sn:sn&&!Ti}return ri?1:-1})(fe,it):0}function Q(fe,pe){switch(fe.type){case E:switch(pe){case L:return!fe.otherInOut;case B:return fe.otherInOut;case V:return fe.isSubject&&fe.otherInOut||!fe.isSubject&&!fe.otherInOut;case Z:return!0}break;case M:return pe===L||pe===B;case P:return pe===V;case A:return!1}return!1}var oe=function(fe,pe,it,dt,Wt){this.left=pe,this.point=fe,this.otherEvent=it,this.isSubject=dt,this.type=Wt||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function he(fe,pe){return fe[0]===pe[0]&&fe[1]===pe[1]}oe.prototype.isBelow=function(fe){var pe=this.point,it=this.otherEvent.point;return this.left?(pe[0]-fe[0])*(it[1]-fe[1])-(it[0]-fe[0])*(pe[1]-fe[1])>0:(it[0]-fe[0])*(pe[1]-fe[1])-(pe[0]-fe[0])*(it[1]-fe[1])>0},oe.prototype.isAbove=function(fe){return!this.isBelow(fe)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var fe=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return fe.contourId=this.contourId,fe.resultTransition=this.resultTransition,fe.prevInResult=this.prevInResult,fe.isExteriorRing=this.isExteriorRing,fe.inOut=this.inOut,fe.otherInOut=this.otherInOut,fe},Object.defineProperties(oe.prototype,le);var Ee=11102230246251565e-32,Se=134217729,Me=(3+8*Ee)*Ee;function De(fe,pe,it,dt,Wt){var Ht,ri,Ti,sn,an=pe[0],tn=dt[0],Hn=0,Pr=0;tn>an==tn>-an?(Ht=an,an=pe[++Hn]):(Ht=tn,tn=dt[++Pr]);var en=0;if(Hn<fe&&Pr<it)for(tn>an==tn>-an?(Ti=Ht-((ri=an+Ht)-an),an=pe[++Hn]):(Ti=Ht-((ri=tn+Ht)-tn),tn=dt[++Pr]),Ht=ri,Ti!==0&&(Wt[en++]=Ti);Hn<fe&&Pr<it;)tn>an==tn>-an?(Ti=Ht-((ri=Ht+an)-(sn=ri-Ht))+(an-sn),an=pe[++Hn]):(Ti=Ht-((ri=Ht+tn)-(sn=ri-Ht))+(tn-sn),tn=dt[++Pr]),Ht=ri,Ti!==0&&(Wt[en++]=Ti);for(;Hn<fe;)Ti=Ht-((ri=Ht+an)-(sn=ri-Ht))+(an-sn),an=pe[++Hn],Ht=ri,Ti!==0&&(Wt[en++]=Ti);for(;Pr<it;)Ti=Ht-((ri=Ht+tn)-(sn=ri-Ht))+(tn-sn),tn=dt[++Pr],Ht=ri,Ti!==0&&(Wt[en++]=Ti);return Ht===0&&en!==0||(Wt[en++]=Ht),en}function Ne(fe){return new Float64Array(fe)}var ft=33306690738754716e-32,je=22204460492503146e-32,mt=11093356479670487e-47,It=Ne(4),vt=Ne(8),Et=Ne(12),Ot=Ne(16),ut=Ne(4);function St(fe,pe,it){var dt=(function(Wt,Ht,ri,Ti,sn,an){var tn=(Ht-an)*(ri-sn),Hn=(Wt-sn)*(Ti-an),Pr=tn-Hn;if(tn===0||Hn===0||tn>0!=Hn>0)return Pr;var en=Math.abs(tn+Hn);return Math.abs(Pr)>=ft*en?Pr:-(function(gr,Yn,kn,xr,br,pr,_r){var Kn,ln,tr,qr,zi,Pn,wr,es,Ir,zs,lr,Cs,xl,$o,Oo,bl,Kd,ks,to=gr-br,Zo=kn-br,Ia=Yn-pr,pa=xr-pr;It[0]=(Oo=(es=to-(wr=(Pn=Se*to)-(Pn-to)))*(zs=pa-(Ir=(Pn=Se*pa)-(Pn-pa)))-(($o=to*pa)-wr*Ir-es*Ir-wr*zs))-((lr=Oo-(Kd=(es=Ia-(wr=(Pn=Se*Ia)-(Pn-Ia)))*(zs=Zo-(Ir=(Pn=Se*Zo)-(Pn-Zo)))-((bl=Ia*Zo)-wr*Ir-es*Ir-wr*zs)))+(zi=Oo-lr))+(zi-Kd),It[1]=(xl=$o-((Cs=$o+lr)-(zi=Cs-$o))+(lr-zi))-((lr=xl-bl)+(zi=xl-lr))+(zi-bl),It[2]=Cs-((ks=Cs+lr)-(zi=ks-Cs))+(lr-zi),It[3]=ks;var um=(function(M8,p2){for(var m2=p2[0],Tw=1;Tw<4;Tw++)m2+=p2[Tw];return m2})(0,It),zv=je*_r;if(um>=zv||-um>=zv||(Kn=gr-(to+(zi=gr-to))+(zi-br),tr=kn-(Zo+(zi=kn-Zo))+(zi-br),ln=Yn-(Ia+(zi=Yn-Ia))+(zi-pr),qr=xr-(pa+(zi=xr-pa))+(zi-pr),Kn===0&&ln===0&&tr===0&&qr===0)||(zv=mt*_r+Me*Math.abs(um),(um+=to*qr+pa*Kn-(Ia*tr+Zo*ln))>=zv||-um>=zv))return um;ut[0]=(Oo=(es=Kn-(wr=(Pn=Se*Kn)-(Pn-Kn)))*(zs=pa-(Ir=(Pn=Se*pa)-(Pn-pa)))-(($o=Kn*pa)-wr*Ir-es*Ir-wr*zs))-((lr=Oo-(Kd=(es=ln-(wr=(Pn=Se*ln)-(Pn-ln)))*(zs=Zo-(Ir=(Pn=Se*Zo)-(Pn-Zo)))-((bl=ln*Zo)-wr*Ir-es*Ir-wr*zs)))+(zi=Oo-lr))+(zi-Kd),ut[1]=(xl=$o-((Cs=$o+lr)-(zi=Cs-$o))+(lr-zi))-((lr=xl-bl)+(zi=xl-lr))+(zi-bl),ut[2]=Cs-((ks=Cs+lr)-(zi=ks-Cs))+(lr-zi),ut[3]=ks;var IL=De(4,It,4,ut,vt);ut[0]=(Oo=(es=to-(wr=(Pn=Se*to)-(Pn-to)))*(zs=qr-(Ir=(Pn=Se*qr)-(Pn-qr)))-(($o=to*qr)-wr*Ir-es*Ir-wr*zs))-((lr=Oo-(Kd=(es=Ia-(wr=(Pn=Se*Ia)-(Pn-Ia)))*(zs=tr-(Ir=(Pn=Se*tr)-(Pn-tr)))-((bl=Ia*tr)-wr*Ir-es*Ir-wr*zs)))+(zi=Oo-lr))+(zi-Kd),ut[1]=(xl=$o-((Cs=$o+lr)-(zi=Cs-$o))+(lr-zi))-((lr=xl-bl)+(zi=xl-lr))+(zi-bl),ut[2]=Cs-((ks=Cs+lr)-(zi=ks-Cs))+(lr-zi),ut[3]=ks;var CL=De(IL,vt,4,ut,Et);ut[0]=(Oo=(es=Kn-(wr=(Pn=Se*Kn)-(Pn-Kn)))*(zs=qr-(Ir=(Pn=Se*qr)-(Pn-qr)))-(($o=Kn*qr)-wr*Ir-es*Ir-wr*zs))-((lr=Oo-(Kd=(es=ln-(wr=(Pn=Se*ln)-(Pn-ln)))*(zs=tr-(Ir=(Pn=Se*tr)-(Pn-tr)))-((bl=ln*tr)-wr*Ir-es*Ir-wr*zs)))+(zi=Oo-lr))+(zi-Kd),ut[1]=(xl=$o-((Cs=$o+lr)-(zi=Cs-$o))+(lr-zi))-((lr=xl-bl)+(zi=xl-lr))+(zi-bl),ut[2]=Cs-((ks=Cs+lr)-(zi=ks-Cs))+(lr-zi),ut[3]=ks;var RL=De(CL,Et,4,ut,Ot);return Ot[RL-1]})(Wt,Ht,ri,Ti,sn,an,en)})(fe[0],fe[1],pe[0],pe[1],it[0],it[1]);return dt>0?-1:dt<0?1:0}function rt(fe,pe){var it=fe.point,dt=pe.point;return it[0]>dt[0]?1:it[0]<dt[0]?-1:it[1]!==dt[1]?it[1]>dt[1]?1:-1:(function(Wt,Ht,ri,Ti){return Wt.left!==Ht.left?Wt.left?1:-1:St(ri,Wt.otherEvent.point,Ht.otherEvent.point)!==0?Wt.isBelow(Ht.otherEvent.point)?-1:1:!Wt.isSubject&&Ht.isSubject?1:-1})(fe,pe,it)}function Je(fe,pe,it){var dt=new oe(pe,!1,fe,fe.isSubject),Wt=new oe(pe,!0,fe.otherEvent,fe.isSubject);return he(fe.point,fe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",fe),dt.contourId=Wt.contourId=fe.contourId,rt(Wt,fe.otherEvent)>0&&(fe.otherEvent.left=!0,Wt.left=!1),fe.otherEvent.otherEvent=Wt,fe.otherEvent=dt,it.push(Wt),it.push(dt),it}function kt(fe,pe){return fe[0]*pe[1]-fe[1]*pe[0]}function Dt(fe,pe){return fe[0]*pe[0]+fe[1]*pe[1]}function xi(fe,pe,it){var dt=(function(sn,an,tn,Hn,Pr){var en=[an[0]-sn[0],an[1]-sn[1]],gr=[Hn[0]-tn[0],Hn[1]-tn[1]];function Yn(Pn,wr,es){return[Pn[0]+wr*es[0],Pn[1]+wr*es[1]]}var kn=[tn[0]-sn[0],tn[1]-sn[1]],xr=kt(en,gr),br=xr*xr,pr=Dt(en,en);if(br>0){var _r=kt(kn,gr)/xr;if(_r<0||_r>1)return null;var Kn=kt(kn,en)/xr;return Kn<0||Kn>1?null:_r===0||_r===1?[Yn(sn,_r,en)]:Kn===0||Kn===1?[Yn(tn,Kn,gr)]:[Yn(sn,_r,en)]}if((br=(xr=kt(kn,en))*xr)>0)return null;var ln=Dt(en,kn)/pr,tr=ln+Dt(en,gr)/pr,qr=Math.min(ln,tr),zi=Math.max(ln,tr);return qr<=1&&zi>=0?qr===1?[Yn(sn,qr>0?qr:0,en)]:zi===0?[Yn(sn,zi<1?zi:1,en)]:[Yn(sn,qr>0?qr:0,en),Yn(sn,zi<1?zi:1,en)]:null})(fe.point,fe.otherEvent.point,pe.point,pe.otherEvent.point),Wt=dt?dt.length:0;if(Wt===0||Wt===1&&(he(fe.point,pe.point)||he(fe.otherEvent.point,pe.otherEvent.point))||Wt===2&&fe.isSubject===pe.isSubject)return 0;if(Wt===1)return he(fe.point,dt[0])||he(fe.otherEvent.point,dt[0])||Je(fe,dt[0],it),he(pe.point,dt[0])||he(pe.otherEvent.point,dt[0])||Je(pe,dt[0],it),1;var Ht=[],ri=!1,Ti=!1;return he(fe.point,pe.point)?ri=!0:rt(fe,pe)===1?Ht.push(pe,fe):Ht.push(fe,pe),he(fe.otherEvent.point,pe.otherEvent.point)?Ti=!0:rt(fe.otherEvent,pe.otherEvent)===1?Ht.push(pe.otherEvent,fe.otherEvent):Ht.push(fe.otherEvent,pe.otherEvent),ri&&Ti||ri?(pe.type=A,fe.type=pe.inOut===fe.inOut?M:P,ri&&!Ti&&Je(Ht[1].otherEvent,Ht[0].point,it),2):Ti?(Je(Ht[0],Ht[1].point,it),3):Ht[0]!==Ht[3].otherEvent?(Je(Ht[0],Ht[1].point,it),Je(Ht[1],Ht[2].point,it),3):(Je(Ht[0],Ht[1].point,it),Je(Ht[3].otherEvent,Ht[2].point,it),3)}function ii(fe,pe){if(fe===pe)return 0;if(St(fe.point,fe.otherEvent.point,pe.point)!==0||St(fe.point,fe.otherEvent.point,pe.otherEvent.point)!==0)return he(fe.point,pe.point)?fe.isBelow(pe.otherEvent.point)?-1:1:fe.point[0]===pe.point[0]?fe.point[1]<pe.point[1]?-1:1:rt(fe,pe)===1?pe.isAbove(fe.point)?-1:1:fe.isBelow(pe.point)?-1:1;if(fe.isSubject!==pe.isSubject)return fe.isSubject?-1:1;var it=fe.point,dt=pe.point;return it[0]===dt[0]&&it[1]===dt[1]?(it=fe.otherEvent.point)[0]===(dt=pe.otherEvent.point)[0]&&it[1]===dt[1]?0:fe.contourId>pe.contourId?1:-1:rt(fe,pe)===1?1:-1}var hi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ut(fe,pe,it,dt){var Wt,Ht=fe+1,ri=pe[fe].point,Ti=pe.length;for(Ht<Ti&&(Wt=pe[Ht].point);Ht<Ti&&Wt[0]===ri[0]&&Wt[1]===ri[1];){if(!it[Ht])return Ht;++Ht<Ti&&(Wt=pe[Ht].point)}for(Ht=fe-1;it[Ht]&&Ht>dt;)Ht--;return Ht}hi.prototype.isExterior=function(){return this.holeOf==null};var yi=Zt,ji=Zt;function Zt(fe,pe){if(!(this instanceof Zt))return new Zt(fe,pe);if(this.data=fe||[],this.length=this.data.length,this.compare=pe||pi,this.length>0)for(var it=(this.length>>1)-1;it>=0;it--)this._down(it)}function pi(fe,pe){return fe<pe?-1:fe>pe?1:0}Zt.prototype={push:function(fe){this.data.push(fe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var fe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),fe}},peek:function(){return this.data[0]},_up:function(fe){for(var pe=this.data,it=this.compare,dt=pe[fe];fe>0;){var Wt=fe-1>>1,Ht=pe[Wt];if(it(dt,Ht)>=0)break;pe[fe]=Ht,fe=Wt}pe[fe]=dt},_down:function(fe){for(var pe=this.data,it=this.compare,dt=this.length>>1,Wt=pe[fe];fe<dt;){var Ht=1+(fe<<1),ri=Ht+1,Ti=pe[Ht];if(ri<this.length&&it(pe[ri],Ti)<0&&(Ht=ri,Ti=pe[ri]),it(Ti,Wt)>=0)break;pe[fe]=Ti,fe=Ht}pe[fe]=Wt}},yi.default=ji;var Di=Math.max,$i=Math.min,rn=0;function Yi(fe,pe,it,dt,Wt,Ht){var ri,Ti,sn,an,tn,Hn;for(ri=0,Ti=fe.length-1;ri<Ti;ri++)if(an=fe[ri+1],tn=new oe(sn=fe[ri],!1,void 0,pe),Hn=new oe(an,!1,tn,pe),tn.otherEvent=Hn,sn[0]!==an[0]||sn[1]!==an[1]){tn.contourId=Hn.contourId=it,Ht||(tn.isExteriorRing=!1,Hn.isExteriorRing=!1),rt(tn,Hn)>0?Hn.left=!0:tn.left=!0;var Pr=sn[0],en=sn[1];Wt[0]=$i(Wt[0],Pr),Wt[1]=$i(Wt[1],en),Wt[2]=Di(Wt[2],Pr),Wt[3]=Di(Wt[3],en),dt.push(tn),dt.push(Hn)}}var oi=[];function Zi(fe,pe,it){typeof fe[0][0][0]=="number"&&(fe=[fe]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var dt=(function(en,gr,Yn){var kn=null;return en.length*gr.length==0&&(Yn===L?kn=oi:Yn===V?kn=en:Yn!==B&&Yn!==Z||(kn=en.length===0?gr:en)),kn})(fe,pe,it);if(dt)return dt===oi?null:dt;var Wt=[1/0,1/0,-1/0,-1/0],Ht=[1/0,1/0,-1/0,-1/0],ri=(function(en,gr,Yn,kn,xr){var br,pr,_r,Kn,ln,tr,qr=new yi(null,rt);for(_r=0,Kn=en.length;_r<Kn;_r++)for(ln=0,tr=(br=en[_r]).length;ln<tr;ln++)(pr=ln===0)&&rn++,Yi(br[ln],!0,rn,qr,Yn,pr);for(_r=0,Kn=gr.length;_r<Kn;_r++)for(ln=0,tr=(br=gr[_r]).length;ln<tr;ln++)pr=ln===0,xr===V&&(pr=!1),pr&&rn++,Yi(br[ln],!1,rn,qr,kn,pr);return qr})(fe,pe,Wt,Ht,it);if(dt=(function(en,gr,Yn,kn,xr){var br=null;return(Yn[0]>kn[2]||kn[0]>Yn[2]||Yn[1]>kn[3]||kn[1]>Yn[3])&&(xr===L?br=oi:xr===V?br=en:xr!==B&&xr!==Z||(br=en.concat(gr))),br})(fe,pe,Wt,Ht,it))return dt===oi?null:dt;for(var Ti=(function(en){var gr,Yn,kn=(function(_r){var Kn,ln,tr,qr,zi=[];for(ln=0,tr=_r.length;ln<tr;ln++)((Kn=_r[ln]).left&&Kn.inResult||!Kn.left&&Kn.otherEvent.inResult)&&zi.push(Kn);for(var Pn=!1;!Pn;)for(Pn=!0,ln=0,tr=zi.length;ln<tr;ln++)ln+1<tr&&rt(zi[ln],zi[ln+1])===1&&(qr=zi[ln],zi[ln]=zi[ln+1],zi[ln+1]=qr,Pn=!1);for(ln=0,tr=zi.length;ln<tr;ln++)(Kn=zi[ln]).otherPos=ln;for(ln=0,tr=zi.length;ln<tr;ln++)(Kn=zi[ln]).left||(qr=Kn.otherPos,Kn.otherPos=Kn.otherEvent.otherPos,Kn.otherEvent.otherPos=qr);return zi})(en),xr={},br=[],pr=function(){if(!xr[gr]){var _r=br.length,Kn=(function(zi,Pn,wr){var es=new hi;if(zi.prevInResult!=null){var Ir=zi.prevInResult,zs=Ir.outputContourId;if(Ir.resultTransition>0){var lr=Pn[zs];if(lr.holeOf!=null){var Cs=lr.holeOf;Pn[Cs].holeIds.push(wr),es.holeOf=Cs,es.depth=Pn[zs].depth}else Pn[zs].holeIds.push(wr),es.holeOf=zs,es.depth=Pn[zs].depth+1}else es.holeOf=null,es.depth=Pn[zs].depth}else es.holeOf=null,es.depth=0;return es})(kn[gr],br,_r),ln=function(zi){xr[zi]=!0,zi<kn.length&&kn[zi]&&(kn[zi].outputContourId=_r)},tr=gr,qr=gr;for(Kn.points.push(kn[gr].point);ln(tr),ln(tr=kn[tr].otherPos),Kn.points.push(kn[tr].point),!((tr=Ut(tr,kn,xr,qr))==qr||tr>=kn.length)&&kn[tr];);br.push(Kn)}};for(gr=0,Yn=kn.length;gr<Yn;gr++)pr();return br})((function(en,gr,Yn,kn,xr,br){for(var pr,_r,Kn,ln=new h(ii),tr=[],qr=Math.min(kn[2],xr[2]);en.length!==0;){var zi=en.pop();if(tr.push(zi),br===L&&zi.point[0]>qr||br===V&&zi.point[0]>kn[2])break;if(zi.left){_r=pr=ln.insert(zi),pr=pr!==(Kn=ln.minNode())?ln.prev(pr):null,_r=ln.next(_r);var Pn=pr?pr.key:null;if(K(zi,Pn,br),_r&&xi(zi,_r.key,en)===2&&(K(zi,Pn,br),K(_r.key,zi,br)),pr&&xi(pr.key,zi,en)===2){var wr=pr;K(Pn,(wr=wr!==Kn?ln.prev(wr):null)?wr.key:null,br),K(zi,Pn,br)}}else _r=pr=ln.find(zi=zi.otherEvent),pr&&_r&&(pr=pr!==Kn?ln.prev(pr):null,_r=ln.next(_r),ln.remove(zi),_r&&pr&&xi(pr.key,_r.key,en))}return tr})(ri,0,0,Wt,Ht,it)),sn=[],an=0;an<Ti.length;an++){var tn=Ti[an];if(tn.isExterior()){for(var Hn=[tn.points],Pr=0;Pr<tn.holeIds.length;Pr++)Hn.push(Ti[tn.holeIds[Pr]].points);sn.push(Hn)}}return sn}var An={UNION:B,DIFFERENCE:V,INTERSECTION:L,XOR:Z};i.diff=function(fe,pe){return Zi(fe,pe,V)},i.intersection=function(fe,pe){return Zi(fe,pe,L)},i.operations=An,i.union=function(fe,pe){return Zi(fe,pe,B)},i.xor=function(fe,pe){return Zi(fe,pe,Z)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,M_.exports)),M_.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function qa(r,e,i,a){const h=[],g=a===0?(_,x,E,A,M,P)=>{_.push(new Ct(P,E+(P-x)/(A-x)*(M-E)))}:(_,x,E,A,M,P)=>{_.push(new Ct(x+(P-E)/(M-E)*(A-x),P))};for(const _ of r){const x=[];for(const E of _){if(E.length<=2)continue;const A=[];for(let L=0;L<E.length-1;L++){const B=E[L].x,V=E[L].y,Z=E[L+1].x,K=E[L+1].y,Q=a===0?B:V,oe=a===0?Z:K;Q<e?oe>e&&g(A,B,V,Z,K,e):Q>i?oe<i&&g(A,B,V,Z,K,i):A.push(E[L]),oe<e&&Q>=e&&g(A,B,V,Z,K,e),oe>i&&Q<=i&&g(A,B,V,Z,K,i)}let M=E[E.length-1];const P=a===0?M.x:M.y;P>=e&&P<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),x.push(A))}x.length&&h.push(x)}return h}function iv(r,e){const i=P_(r),a=P_([e]),h=e0.intersection(i,a);return h==null?[]:nv(h)}function t0(r,e){let a=P_(r,65536);const h=[];for(;e.valid();e.next()){const[g,_]=e.get(),x=g.x*65536,E=g.y*65536,A=_.x*65536,M=_.y*65536,P=A-x,L=M-E,B=Math.hypot(P,L);if(B===0)continue;const V=Math.trunc(L/B*3),Z=-Math.trunc(P/B*3);h.push([[[x,E],[A,M],[A+V,M+Z],[x+V,E+Z],[x,E]]])}return h.length>0&&(a=e0.diff(a,h)),nv(a,1/65536)}function P_(r,e=1){return[r.map((i=>i.map((a=>[a.x*e,a.y*e]))))]}function nv(r,e=1){return r.map((i=>i.map(((a,h)=>{const g=a.map((_=>new Ct(_[0]*e,_[1]*e).round()));return h>0&&g.reverse(),g}))))}class Hf{constructor(e,i){this.layoutVertexArray=new uu,this.indexArray=new gs,this.lineIndexArray=new os,this.triangleSegments=new Er,this.lineSegments=new Er,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new du)}update(e,i,a,h,g,_,x,E){this.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,E_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,h,g,_,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,h,g,_,void 0,x)}}class yl{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Hf(e,!1),this.elevationBufferData=new Hf(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,h){this.hasPattern=A_("fill",this.layers,this.pixelRatio,i);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:A,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,L=Mt(x,P);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),L,a))continue;const B=g?g.evaluate(L,{},a,i.availableImages):void 0,V={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:A,geometry:P?L.geometry:Yt(x,a,h),patterns:{},sortKey:B};_.push(V)}g&&_.sort(((x,E)=>x.sortKey-E.sortKey));for(const x of _){const{geometry:E,index:A,sourceLayerIndex:M}=x;if(this.hasPattern){const P=I_("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(x,E,A,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,E,A,M,this.index)}}update(e,i,a,h,g,_,x){this.bufferData.update(e,i,a,h,g,_,x,this.worldview),this.elevationBufferData.update(e,i,a,h,g,_,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,h,g,_,x,this.worldview)}addFeatures(e,i,a,h,g,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,h,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,h,g,_=[],x,E){const A=wg(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,h,a,E):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,a,g,_,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,g,_,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,h,g){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,h,g,this.worldview))}addElevatedRoadFeature(e,i,a,h,g){const _=new Array,x=fr.getElevationFeature(e,g);if(!x)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&_.push({polygons:A,elevationFeature:x,elevationTileID:a})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:h};for(const A of _)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Aa(A.elevationTileID,this.layers,this.zoom,this.lut));const P=A.elevationFeature.isTunnel();let L=0;e.properties.hasOwnProperty(Ni)&&(L=+e.properties[Ni]);for(const B of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,B,P,A.elevationFeature,L)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new as(a,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,E)}}addElevatedGeometry(e,i,a,h,g,_){const x={elevation:a,elevationSampler:i,bias:h,index:g,featureInfo:_},[E,A]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,a){let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;a&&(_=a.elevationSampler.constantElevation(a.elevation,a.bias),_!=null&&(h=_,g=_));const x=(E,A,M)=>{if(a!=null)if(A.push(E),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),M.push(_);else{const P=a.elevationSampler.pointElevation(E,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(P),M.push(P),h=Math.min(h,P),g=Math.max(g,P)}};for(const E of e){let A=0;for(const le of E)A+=le.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),P=M.vertexLength,L=[],B=[],V=[],Z=[],K=[],Q=i.layoutVertexArray.length;for(const le of E){if(le.length===0)continue;le!==E[0]&&B.push(L.length/2);const he=i.lineSegments.prepareSegment(le.length,i.layoutVertexArray,i.lineIndexArray),Ee=he.vertexLength;a&&K.push(i.layoutVertexArray.length-Q),x(le[0],V,Z),i.layoutVertexArray.emplaceBack(le[0].x,le[0].y),i.lineIndexArray.emplaceBack(Ee+le.length-1,Ee),L.push(le[0].x),L.push(le[0].y);for(let Se=1;Se<le.length;Se++)x(le[Se],V,Z),i.layoutVertexArray.emplaceBack(le[Se].x,le[Se].y),i.lineIndexArray.emplaceBack(Ee+Se-1,Ee+Se),L.push(le[Se].x),L.push(le[Se].y);he.vertexLength+=le.length,he.primitiveLength+=le.length}const oe=Hd(L,B);for(let le=0;le<oe.length;le+=3)i.indexArray.emplaceBack(P+oe[le],P+oe[le+1],P+oe[le+2]);if(oe.length>0&&a&&this.elevationMode==="hd-road-base"){const le=a.elevation.isTunnel(),he=a.elevation.safeArea,Ee=this.elevatedStructures.addVertices(V,Z);this.elevatedStructures.addTriangles(oe,Ee,le);const Se=K.length;if(Se>0){for(let Me=0;Me<Se-1;Me++)this.elevatedStructures.addRenderableRing(a.index,K[Me]+Ee,K[Me+1]-K[Me],le,he,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,K[Se-1]+Ee,V.length-K[Se-1],le,he,a.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=oe.length/3}return[h,g]}prepareElevatedPolygons(e,i,a){const h=1/qe(a),g=[];for(const _ of e){const x=t0(_,new yn(i,h));g.push(...x)}return g}clipPolygonsToTile(e,i){const a=-i,h=-i,g=Bt+i,_=Bt+i;let x=0;const E=[],A=[];for(;x<e.length;x++){const L=e[x],B=$c(L);(B.min.x>=a&&B.max.x<=g&&B.min.y>=h&&B.max.y<=_?E:A).push(L)}if(E.length===e.length)return e;const M=[new Ct(a,h),new Ct(g,h),new Ct(g,_),new Ct(a,_),new Ct(a,h)],P=E;for(const L of A)P.push(...iv(L,M));return P}}let rv,Tg,Ku,i0;Xt(yl,"FillBucket",{omit:["layers","patternFeatures"]}),Xt(Hf,"FillBufferData"),Xt(Aa,"ElevatedStructures");class D_{constructor(e,i,a,h){if(this.triangleCount=i.length/3,this.min=new Ct(0,0),this.max=new Ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[g,_]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const L=e[P];g.x=Math.min(g.x,L.x),g.y=Math.min(g.y,L.y),_.x=Math.max(_.x,L.x),_.y=Math.max(_.y,L.y)}if(h){const P=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/h);a=Math.max(a,P)}if(a===0)return;this.min=g,this.max=_;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const E=Math.max(x.x,x.y)/a;this.cellsX=Math.max(1,Math.ceil(x.x/E)),this.cellsY=Math.max(1,Math.ceil(x.y/E)),this.xScale=1/E,this.yScale=1/E;const A=[];for(let P=0;P<this.triangleCount;P++){const L=e[i[3*P+0]].sub(this.min),B=e[i[3*P+1]].sub(this.min),V=e[i[3*P+2]].sub(this.min),Z=Ha(Math.floor(Math.min(L.x,B.x,V.x)),this.xScale,this.cellsX),K=Ha(Math.floor(Math.max(L.x,B.x,V.x)),this.xScale,this.cellsX),Q=Ha(Math.floor(Math.min(L.y,B.y,V.y)),this.yScale,this.cellsY),oe=Ha(Math.floor(Math.max(L.y,B.y,V.y)),this.yScale,this.cellsY),le=new Ct(0,0),he=new Ct(0,0),Ee=new Ct(0,0),Se=new Ct(0,0);for(let Me=Q;Me<=oe;++Me){le.y=he.y=Me*E,Ee.y=Se.y=(Me+1)*E;for(let De=Z;De<=K;++De)le.x=Ee.x=De*E,he.x=Se.x=(De+1)*E,(Pc(L,B,V,le,he,Se)||Pc(L,B,V,le,Se,Ee))&&A.push({cellIdx:Me*this.cellsX+De,triIdx:P})}}if(A.length===0)return;A.sort(((P,L)=>P.cellIdx-L.cellIdx||P.triIdx-L.triIdx));let M=0;for(;M<A.length;){const P=A[M].cellIdx,L={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===P;)++L.len,this.payload.push(A[M++].triIdx);this.cells[P]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Ha(e.x-this.min.x,this.xScale,this.cellsX),h=Ha(e.y-this.min.y,this.yScale,this.cellsY),g=this.cells[h*this.cellsX+a];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const x=this.payload[g.start+_],E=Math.floor(x/8),A=1<<x%8;if(!(this.lookup[E]&A)&&(this.lookup[E]|=A,i.push(x),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Ha(e.x-this.min.x,this.xScale,this.cellsX),g=Ha(i.x-this.min.x,this.xScale,this.cellsX),_=Ha(e.y-this.min.y,this.yScale,this.cellsY),x=Ha(i.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=x;E++)for(let A=h;A<=g;A++){const M=this.cells[E*this.cellsX+A];if(M)for(let P=0;P<M.len;P++){const L=this.payload[M.start+P],B=Math.floor(L/8),V=1<<L%8;if(!(this.lookup[B]&V)&&(this.lookup[B]|=V,a.push(L),a.length===this.triangleCount))return}}}}function Ha(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Xt(D_,"TriangleGridIndex");class sv{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,h){const g=[];for(const{feature:_,id:x,index:E,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,P=Mt(_,M);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),P,a))continue;const L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:E,geometry:M?P.geometry:Yt(_,a,h),patterns:{}};g.push(L)}for(const _ of g){const{geometry:x,index:E,sourceLayerIndex:A}=_;this.addFeature(_,x,E,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,x,E,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,h,g,_,x){}destroy(){}addFeature(e,i,a,h,g,_=[],x){for(const E of wg(i,2)){const A=[],M=[],P=[],L=new Ct(1/0,1/0),B=new Ct(-1/0,-1/0);for(const K of E)if(K.length!==0){K!==E[0]&&P.push(M.length/2);for(let Q=0;Q<K.length;Q++)M.push(K[Q].x),M.push(K[Q].y),A.push(K[Q]),L.x=Math.min(L.x,K[Q].x),L.y=Math.min(L.y,K[Q].y),B.x=Math.max(B.x,K[Q].x),B.y=Math.max(B.y,K[Q].y)}const V=Hd(M,P),Z=new D_(A,V,8,256);this.footprints.push({vertices:A,indices:V,grid:Z,min:L,max:B})}}}Xt(sv,"ClipBucket",{omit:["layers"]});const E1=pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),S1=pn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),A1=pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),I1=pn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),C1=pn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),R1=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:M1}=E1,Zp=Number.MAX_SAFE_INTEGER,Wf=Zp-1;function Xp(r,e,i,a){return r.order<e||r.order===Zp||!(r.clipMask&i)||(function(h,g){return g.length!==0&&g.find((_=>_===h))===void 0})(a,r.clipScope)}function Eg(r,e){return r.x-e.x||r.y-e.y}function n0(r,e){return Eg(r.min,e.min)===0&&Eg(r.max,e.max)===0}function Wd(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function $d(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!n0(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!el(r[i].clipScope,e[i].clipScope))return!1;return!0}function ov(r,e,i){const a=1/Bt,h=1/(1<<i.canonical.z),g=(e.x*a+i.canonical.x)*h+i.wrap,_=(e.y*a+i.canonical.y)*h;return{min:new Ct((r.x*a+i.canonical.x)*h+i.wrap,(r.y*a+i.canonical.y)*h),max:new Ct(g,_)}}function O_(r,e,i){const a=1<<i.canonical.z,h=((e.x-i.wrap)*a-i.canonical.x)*Bt,g=(e.y*a-i.canonical.y)*Bt;return{min:new Ct(((r.x-i.wrap)*a-i.canonical.x)*Bt,(r.y*a-i.canonical.y)*Bt),max:new Ct(h,g)}}function Sg(r,e,i,a,h,g,_){const x=r.indices,E=r.vertices,A=[];for(let M=a;M<a+h;M+=3){const P=e[i[M+0]+g],L=e[i[M+1]+g],B=e[i[M+2]+g],V=Math.min(P.x,L.x,B.x),Z=Math.max(P.x,L.x,B.x),K=Math.min(P.y,L.y,B.y),Q=Math.max(P.y,L.y,B.y);A.length=0,r.grid.query(new Ct(V,K),new Ct(Z,Q),A);for(let oe=0;oe<A.length;oe++){const le=A[oe];if(Pc(E[x[3*le+0]],E[x[3*le+1]],E[x[3*le+2]],P,L,B,_))return!0}}return!1}function L_(r,e,i,a){if(!r||!i)return!1;let h=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<r.vertices.length)return L_(i,a,r,e);const g=e.canonical,_=a.canonical,x=Math.pow(2,_.z-g.z);h=r.vertices.map((E=>new Ct((E.x+g.x*Bt)*x-_.x*Bt,(E.y+g.y*Bt)*x-_.y*Bt)))}return Sg(i,h,r.indices,0,r.indices.length,0,0)}function Ag(r,e,i,a){const h=Math.pow(2,a.z-i.z);return new Ct((r+i.x*Bt)*h-a.x*Bt,(e+i.y*Bt)*h-a.y*Bt)}function z_(r,e){const i=[];e.grid.queryPoint(r,i);const a=e.indices,h=e.vertices;for(let g=0;g<i.length;g++){const _=i[g];if(Sr([h[a[3*_+0]],h[a[3*_+1]],h[a[3*_+2]]],r))return!0}return!1}const k_=[new Ct(0,0),new Ct(Bt,0),new Ct(Bt,Bt),new Ct(0,Bt)];function r0(r,e){const i=[];let a=[];if(!e||r.length<2)return[r];if(r.length===2)return Vr(r[0],r[1],k_)?[r]:[];for(let h=0;h<r.length+2;h++){const g=r[h%r.length],_=r[(h+1)%r.length],x=Vr(h===0?r[r.length-1]:r[(h-1)%r.length],g,k_),E=Vr(g,_,k_),A=x||E;A&&a.push(g),A&&E||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const N_=Tt.types,P1=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],av=["fill-extrusion-flood-light-ground-radius"],D1=Math.pow(2,13),F_=Math.pow(2,15)-1,Ig=new Ct(0,1),yu=2147483648;function Cg(r,e,i,a,h,g,_,x){r.emplaceBack((e<<1)+_,(i<<1)+g,(Math.floor(a*D1)<<1)+h,Math.round(x))}function Gh(r,e,i){r.emplaceBack(e.x*Bt,e.y*Bt,i?1:0)}function B_(r,e,i,a,h,g){r.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+h,g)}function Yp(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cv{constructor(){this.centroidXY=new Ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class uv{constructor(){this.acc=new Ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===Bt)&&i.x===a.x)!=((i.y===0||i.y===Bt)&&i.y===a.y)&&this.processBorderOverlap(i,a),h&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ii(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Bt!=e.x>Bt&&this.addBorderIntersection(1,Ii(i.y,e.y,(Bt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ii(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Bt!=e.y>Bt&&this.addBorderIntersection(3,Ii(i.x,e.x,(Bt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ct(0,0):new Ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function V_(r,e){const i=r.add(e)._unit(),a=Ie(r.x*i.x+r.y*i.y,-1,1);var h,g,_;return h=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(h)))/4*F_*((g=r).x*(_=e).y-g.y*_.x<0?-1:1)}const s0=[r=>r.x<0,r=>r.x>Bt,r=>r.y<0,r=>r.y>Bt];function o0(r,e,i,a){const h=[4];if(a===0)return h;i._mult(a);const g=r.sub(i),_=e.sub(i),x=[r,e,g,_];for(let E=0;E<4;E++)for(const A of x)if(s0[E](A)){h.push(E);break}return h}class Kp{constructor(e){this.vertexArray=new kp,this.indexArray=new gs,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut},(i=>av.includes(i))),this._segments=new Er,this.hiddenByLandmarkVertexArray=new Ff,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,h=!1){const g=e.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const A=e[0],M=e[1];E=V_(A.sub(e[g-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<g;A++){const M=A===g-1?0:A+1,P=e[A],L=e[M],B=e[M===g-1?0:M+1],V=L.sub(P)._perp()._unit(),Z=V_(V,B.sub(L)._perp()._unit()),K=E,Q=Z;if(Qp(P,L,i)||h&&G_(P,i)&&G_(L,i)){E=Z;continue}const oe=x.vertexLength;B_(this.vertexArray,P,L,1,1,K),B_(this.vertexArray,P,L,1,0,K),B_(this.vertexArray,P,L,0,1,Q),B_(this.vertexArray,P,L,0,0,Q),x.vertexLength+=4;const le=o0(P,L,V,a);for(const he of le)this._segmentToGroundQuads[_].push({id:oe,region:he}),this._segmentToRegionTriCounts[_][he]+=2,x.primitiveLength+=2;E=Z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort(((h,g)=>h.region-g.region));for(let a=0;a<i;a++){const h=this._segmentToGroundQuads[a],g=e[a],_=this._segmentToRegionTriCounts[a];_.reduce(((E,A)=>E+A),0);let x=0;for(let E=0;E<=4;E++){const A=_[E];if(A!==0){let M=this.regionSegments[E];M||(M=this.regionSegments[E]=new Er);const P={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+x,vertexLength:g.vertexLength,primitiveLength:A};M.get().push(P)}x+=A}for(let E=0;E<h.length;E++){const A=h[E].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,h,g,_,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,h,g,_,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,S1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,h,g,_,x,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,h,g,_,x,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&yu))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const h=i+e;if(i!==0){for(let g=e;g<h;++g)this.hiddenByLandmarkVertexArray.emplace(g,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,C1.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class U_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gs,this.footprintVertices=new uu,this.footprintSegments=[],this.layoutVertexArray=new ju,this.centroidVertexArray=new Vf,this.wallVertexArray=new d_,this.indexArray=new gs,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut},(i=>P1.includes(i))),this.segments=new Er,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new Kp(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,h){this.features=[],this.hasPattern=A_("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=qe(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:x,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Mt(g,A);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),M,a))continue;const P={id:_,sourceLayerIndex:E,index:x,geometry:A?M.geometry:Yt(g,a,h),properties:g.properties,type:g.type,patterns:{}},L=this.layoutVertexArray.length,B=N_[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:I_("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const V of P.geometry)for(const Z of r0(V,B))this.addFeature(g.id,P,[Z],x,a,{},i.availableImages,h,i.brightness);else this.addFeature(g.id,P,P.geometry,x,a,{},i.availableImages,h,i.brightness);i.featureIndex.insert(g,P.geometry,x,E,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,h,g,_){for(const{featureId:x,feature:E}of this.features){const A=N_[E.type]==="Polygon",{geometry:M}=E;if(this.wallMode)for(const P of M)for(const L of r0(P,A))this.addFeature(x,E,[L],E.index,i,a,h,g,_);else this.addFeature(x,E,M,E.index,i,a,h,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,h,g,_,x){this.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,this.worldview),this.groundEffect.update(e,i,g,a,h,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,M1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,I1.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,R1.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,A1.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,h,g,_,x,E,A){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,P=[new Ct(0,0),new Ct(Bt,Bt)],L=E.projection,B=L.name==="globe",V=this.wallMode||N_[i.type]==="Polygon",Z=new uv;Z.centroidDataIndex=this.centroidData.length;const K=new cv;K.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(K.buildingId=i.properties.building_id);const Q=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},g)<=0,oe=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},g);let le;if(K.height=oe,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Np),this.wallMode){if(B)return void Ki("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;le=(function(je){const mt=je[0].x===je[je.length-1].x&&je[0].y===je[je.length-1].y;(function(Ut){let yi=0;const ji=Ut.length;for(let Zt=0;Zt<ji;Zt++)yi+=(Ut[(Zt+1)%ji].x-Ut[Zt].x)*(Ut[(Zt+1)%ji].y+Ut[Zt].y);return yi>=0})(je)||(je=je.reverse());const vt={geometry:[],joinNormals:[],indices:[]},Et=[],Ot=[],ut=[];let St=je.length;for(;St>=2&&je[St-1].equals(je[St-2]);)St--;if(St<(mt?3:2))return vt;let rt,Je,kt,Dt,xi,ii=0;for(;ii<St-1&&je[ii].equals(je[ii+1]);)ii++;mt&&(rt=je[St-2],xi=je[ii].sub(rt)._unit()._perp());for(let Ut=ii;Ut<St;Ut++){if(kt=Ut===St-1?mt?je[ii+1]:void 0:je[Ut+1],kt&&je[Ut].equals(kt))continue;xi&&(Dt=xi),rt&&(Je=rt),rt=je[Ut],xi=kt?kt.sub(rt)._unit()._perp():Dt,Dt=Dt||xi;let yi=Dt.add(xi);yi.x===0&&yi.y===0||yi._unit();const ji=yi.x*xi.x+yi.y*xi.y,Zt=ji!==0?1/ji:1/0,pi=Dt.x*xi.y-Dt.y*xi.x>0;let Di="miter";const $i=2;Di==="miter"&&Zt>$i&&(Di="bevel"),Di==="bevel"&&(Zt>100&&(Di="flipbevel"),Zt<$i&&(Di="miter"));const rn=(Yi,oi,Zi,An)=>{const fe=new Ct(Yi.x,Yi.y),pe=new Ct(Yi.x,Yi.y);fe.x+=oi.x*An,fe.y+=oi.y*An,pe.x-=oi.x*Math.max(Zi,1),pe.y-=oi.y*Math.max(Zi,1),ut.push(oi),Et.push(fe),Ot.push(pe)};if(Di==="miter")yi._mult(Zt),rn(rt,yi,0,0);else if(Di==="flipbevel")yi=xi.mult(-1),rn(rt,yi,0,0),rn(rt,yi.mult(-1),0,0);else{const Yi=-Math.sqrt(Zt*Zt-1),oi=pi?Yi:0,Zi=pi?0:Yi;Je&&rn(rt,Dt,oi,Zi),kt&&rn(rt,xi,oi,Zi)}}vt.geometry=[...Et,...Ot.reverse(),Et[0]],vt.joinNormals=[...ut,...ut.reverse(),ut[ut.length-1]];const hi=vt.geometry.length-1;for(let Ut=0;Ut<hi/2;Ut++)if(Ut+1<hi/2){let yi=Ut,ji=Ut+1,Zt=hi-1-Ut,pi=hi-2-Ut;yi=yi===0?hi-1:yi-1,ji=ji===0?hi-1:ji-1,Zt=Zt===0?hi-1:Zt-1,pi=pi===0?hi-1:pi-1,vt.indices.push(Zt),vt.indices.push(ji),vt.indices.push(yi),vt.indices.push(Zt),vt.indices.push(pi),vt.indices.push(ji)}return vt})(a[0]),a=[le.geometry]}const he=(je,mt)=>je<(mt.length-1)/2||je===mt.length-1,Ee=this.wallMode?[a]:wg(a,500);for(let je=Ee.length-1;je>=0;je--){const mt=Ee[je];(mt.length===0||(Se=mt[0]).every((It=>It.x<=0))||Se.every((It=>It.x>=Bt))||Se.every((It=>It.y<=0))||Se.every((It=>It.y>=Bt)))&&Ee.splice(je,1)}var Se;let Me;if(B)Me=Hh(Ee,P,g);else{Me=[];for(const je of Ee)Me.push({polygon:je,bounds:P})}const De=V?this.edgeRadius:0,Ne=De>0&&this.zoom<17,ft=(je,mt)=>{if(je.length===0)return!1;const It=je[je.length-1];return mt.x===It.x&&mt.y===It.y};for(const{polygon:je,bounds:mt}of Me){let It=0,vt=0;for(const St of je)V&&!St[0].equals(St[St.length-1])&&St.push(St[0]),vt+=V?St.length-1:St.length;const Et=this.segments.prepareSegment((V?5:4)*vt,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const Ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ut=new lv;if(ut.vertexOffset=this.footprintVertices.length,ut.indexOffset=3*this.footprintIndices.length,ut.ringIndices=[],V){const St=[],rt=[];It=Et.vertexLength;for(let kt=0;kt<je.length;kt++){const Dt=je[kt];Dt.length&&kt!==0&&rt.push(St.length/2);const xi=[];let ii,hi;ii=Dt[1].sub(Dt[0])._perp()._unit(),ut.ringIndices.push(Dt.length-1);for(let Ut=1;Ut<Dt.length;Ut++){const yi=Dt[Ut],ji=Dt[Ut===Dt.length-1?1:Ut+1],Zt=yi.clone();if(De){hi=ji.sub(yi)._perp()._unit();const pi=ii.add(hi)._unit(),Di=De*Math.min(4,1/(ii.x*pi.x+ii.y*pi.y));Zt.x+=Di*pi.x,Zt.y+=Di*pi.y,Zt.x=Math.round(Zt.x),Zt.y=Math.round(Zt.y),ii=hi}if(!Q||De!==0&&!Ne||ft(xi,Zt)||xi.push(Zt),Cg(this.layoutVertexArray,Zt.x,Zt.y,0,0,1,1,0),this.wallMode){const pi=he(Ut,Dt);Gh(this.wallVertexArray,le.joinNormals[Ut],!pi)}Et.vertexLength++,this.footprintVertices.emplaceBack(yi.x,yi.y),St.push(yi.x,yi.y),B&&Yp(this.layoutVertexExtArray,L.projectTilePoint(Zt.x,Zt.y,g),L.upVector(g,Zt.x,Zt.y))}Q&&(De===0||Ne)&&(xi.length!==0&&ft(xi,xi[0])&&xi.pop(),this.groundEffect.addData(xi,mt,M))}const Je=this.wallMode?le.indices:Hd(St,rt);for(let kt=0;kt<Je.length;kt+=3)this.footprintIndices.emplaceBack(ut.vertexOffset+Je[kt+0],ut.vertexOffset+Je[kt+1],ut.vertexOffset+Je[kt+2]),this.indexArray.emplaceBack(It+Je[kt],It+Je[kt+2],It+Je[kt+1]),Et.primitiveLength++;ut.indexCount+=Je.length,ut.vertexCount+=this.footprintVertices.length-ut.vertexOffset}for(let St=0;St<je.length;St++){const rt=je[St];Z.startRing(K,rt[0]);let Je=rt.length>4&&dv(rt[rt.length-2],rt[0],rt[1]),kt=De?hv(rt[rt.length-2],rt[0],rt[1],De):0;const Dt=[];let xi,ii,hi;ii=rt[1].sub(rt[0])._perp()._unit();let Ut=!0;for(let yi=1,ji=0;yi<rt.length;yi++){let Zt=rt[yi-1],pi=rt[yi];const Di=rt[yi===rt.length-1?1:yi+1];if(Z.appendEdge(K,pi,Zt),Qp(pi,Zt,mt)){De&&(ii=Di.sub(pi)._perp()._unit(),Ut=!Ut);continue}const $i=pi.sub(Zt)._perp(),rn=$i.x/(Math.abs($i.x)+Math.abs($i.y)),Yi=$i.y>0?1:0,oi=Zt.dist(pi);if(ji+oi>32768&&(ji=0),De){hi=Di.sub(pi)._perp()._unit();let pe=j_(Zt,pi,Di,a0(ii,hi),De);isNaN(pe)&&(pe=0);const it=pi.sub(Zt)._unit();Zt=Zt.add(it.mult(kt))._round(),pi=pi.add(it.mult(-pe))._round(),kt=pe,ii=hi,Q&&this.zoom>=17&&(ft(Dt,Zt)||Dt.push(Zt),ft(Dt,pi)||Dt.push(pi))}const Zi=Et.vertexLength,An=rt.length>4&&dv(Zt,pi,Di);let fe=q_(ji,Je,Ut);if(Cg(this.layoutVertexArray,Zt.x,Zt.y,rn,Yi,0,0,fe),Cg(this.layoutVertexArray,Zt.x,Zt.y,rn,Yi,0,1,fe),this.wallMode){const pe=he(yi-1,rt),it=le.joinNormals[yi-1];Gh(this.wallVertexArray,it,pe),Gh(this.wallVertexArray,it,pe)}if(ji+=oi,fe=q_(ji,An,!Ut),Je=An,Cg(this.layoutVertexArray,pi.x,pi.y,rn,Yi,0,0,fe),Cg(this.layoutVertexArray,pi.x,pi.y,rn,Yi,0,1,fe),this.wallMode){const pe=he(yi,rt),it=le.joinNormals[yi];Gh(this.wallVertexArray,it,pe),Gh(this.wallVertexArray,it,pe)}if(Et.vertexLength+=4,this.indexArray.emplaceBack(Zi+0,Zi+1,Zi+2),this.indexArray.emplaceBack(Zi+1,Zi+3,Zi+2),Et.primitiveLength+=2,De){const pe=It+(yi===1?rt.length-2:yi-2),it=yi===1?It:pe+1;if(this.indexArray.emplaceBack(Zi+1,pe,Zi+3),this.indexArray.emplaceBack(pe,it,Zi+3),Et.primitiveLength+=2,xi===void 0&&(xi=Zi),!Qp(Di,rt[yi],mt)){const dt=yi===rt.length-1?xi:Et.vertexLength;this.indexArray.emplaceBack(Zi+2,Zi+3,dt),this.indexArray.emplaceBack(Zi+3,dt+1,dt),this.indexArray.emplaceBack(Zi+3,it,dt+1),Et.primitiveLength+=3}Ut=!Ut}if(B){const pe=this.layoutVertexExtArray,it=L.projectTilePoint(Zt.x,Zt.y,g),dt=L.projectTilePoint(pi.x,pi.y,g),Wt=L.upVector(g,Zt.x,Zt.y),Ht=L.upVector(g,pi.x,pi.y);Yp(pe,it,Wt),Yp(pe,it,Wt),Yp(pe,dt,Ht),Yp(pe,dt,Ht)}}V&&(It+=rt.length-1),Q&&De&&this.zoom>=17&&(Dt.length!==0&&ft(Dt,Dt[0])&&Dt.pop(),this.groundEffect.addData(Dt,mt,M,De>0))}this.footprintSegments.push(ut),Ot.triangleCount=this.indexArray.length-Ot.triangleArrayOffset,this.polygonSegments.push(Ot),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=Z.borders?Ig:this.encodeCentroid(Z,K),this.centroidData.push(K),Z.borders){this.featuresOnBorder.push(Z);const je=this.featuresOnBorder.length-1;for(let mt=0;mt<Z.borders.length;mt++)Z.borders[mt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[mt].push(je)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,x,g,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,h,_,x,g,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,oe)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0]))}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const E=this.centroidData[x],A=+(E.min.y+E.max.y>Bt),M=2*A+(+(E.min.x+E.max.x>Bt)^A);for(let P=0;P<E.polygonSegLen;P++){const L=E.polygonSegIdx+P;e.push({centroidIdx:x,subtile:M,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const i=new gs;e.sort(((x,E)=>x.triangleSegmentIdx===E.triangleSegmentIdx?x.subtile-E.subtile:x.triangleSegmentIdx-E.triangleSegmentIdx));let a=0,h=0,g=0;for(const x of e){if(x.triangleSegmentIdx!==a)break;g++}const _=e.length;for(;h!==e.length;){a=e[h].triangleSegmentIdx;let x=0,E=h,A=h;for(let M=E;M<g&&e[M].subtile===x;M++)A++;for(;E!==g;){const M=e[E];x=M.subtile;const P=this.centroidData[M.centroidIdx].min.clone(),L=this.centroidData[M.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=E;V<A;V++){const Z=e[V],K=this.polygonSegments[Z.polygonSegmentIdx],Q=this.centroidData[Z.centroidIdx].min,oe=this.centroidData[Z.centroidIdx].max,le=this.indexArray.uint16;for(let he=K.triangleArrayOffset;he<K.triangleArrayOffset+K.triangleCount;he++)i.emplaceBack(le[3*he],le[3*he+1],le[3*he+2]);B.primitiveLength+=K.triangleCount,P.x=Math.min(P.x,Q.x),P.y=Math.min(P.y,Q.y),L.x=Math.max(L.x,oe.x),L.y=Math.max(L.y,oe.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:P,max:L}),E=A;for(let V=E;V<g&&e[V].subtile===e[E].subtile;V++)A++}h=g;for(let M=h;M<_&&e[M].triangleSegmentIdx===e[h].triangleSegmentIdx;M++)g++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const h=new Er;if(this.wallMode){for(const Z of this.triangleSubSegments)h.segments.push(Z.segment);return h}let g=0,_=0;const x=1<<e.canonical.z;if(i){const Z=i.getMinMaxForTile(e);Z&&(g=Z.min,_=Z.max)}_+=this.maxHeight;const E=e.toUnwrapped();let A;const M=[E.canonical.x/x+E.wrap,E.canonical.y/x],P=[(E.canonical.x+1)/x+E.wrap,(E.canonical.y+1)/x],L=(Z,K,Q)=>[Z[0]*(1-Q[0])+K[0]*Q[0],Z[1]*(1-Q[1])+K[1]*Q[1]],B=[],V=[];for(const Z of this.triangleSubSegments){B[0]=Z.min.x/Bt,B[1]=Z.min.y/Bt,V[0]=Z.max.x/Bt,V[1]=Z.max.y/Bt;const K=L(M,P,B),Q=L(M,P,V);if(new Ci([K[0],K[1],g],[Q[0],Q[1],_]).intersectsPrecise(a)===0){A&&(h.segments.push(A),A=void 0);continue}const oe=Z.segment;A&&A.vertexOffset!==oe.vertexOffset&&(h.segments.push(A),A=void 0),A?(A.vertexLength+=oe.vertexLength,A.primitiveLength+=oe.primitiveLength):A={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&h.segments.push(A),h}encodeCentroid(e,i){const a=e.centroid(),h=i.span(),g=Math.min(7,Math.round(h.x*this.tileToMeter/10)),_=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Ct(Ie(a.x,1,Bt-1)<<3|g,Ie(a.y,1,Bt-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Ct(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const h=i[0][0]!==a?0:1;return new Ct(6|(i[0][0]!==a?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==a?2:3;return new Ct((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,h=e.flags&yu?Ig:e.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||g!==h.x){for(let _=i;_<a;++_)this.centroidVertexArray.emplace(_,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if($d(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<a)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingId){const E=_.footprint.buildingId;for(const A of this.centroidData)A.buildingId===E&&(A.flags|=yu)}else for(const E of this.centroidData)if(!(E.flags&yu||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let A=0;A<E.footprintSegLen;A++){const M=this.footprintSegments[E.footprintSegIdx+A];if(g.length=0,Zd(this.footprintVertices,M.vertexOffset,M.vertexCount,_.footprintTileId.canonical,e.canonical,g),Sg(_.footprint,g,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-x)){E.flags|=yu;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let h=!1;for(let g=0;g<a.footprintSegLen;g++){const _=this.footprintSegments[a.footprintSegIdx+g];let x=0;for(const E of _.ringIndices){for(let A=x,M=E+x-1;A<E+x;M=A++){const P=this.footprintVertices.int16[2*(A+_.vertexOffset)+0],L=this.footprintVertices.int16[2*(A+_.vertexOffset)+1],B=this.footprintVertices.int16[2*(M+_.vertexOffset)+1];L>i!=B>i&&e<(this.footprintVertices.int16[2*(M+_.vertexOffset)+0]-P)*(i-L)/(B-L)+P&&(h=!h)}x=E}}return h}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,h=!0;const g=4*(e+Bt)*Bt+(i+Bt);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&yu)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=a||this.footprintContainsPoint(e,i,_)&&(a=_.height,this.partLookup[g]=_,h=!!(_.flags&yu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:h};this.partLookup[g]=void 0}}function a0(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function hv(r,e,i,a){const h=e.sub(r)._perp()._unit(),g=i.sub(e)._perp()._unit();return j_(r,e,i,a0(h,g),a)}function j_(r,e,i,a,h){const g=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(i)/3,h*g/a)}function Qp(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function G_(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function dv(r,e,i){if(r.x<0||r.x>=Bt||e.x<0||e.x>=Bt||i.x<0||i.x>=Bt)return!1;const a=i.sub(e),h=a.perp(),g=r.sub(e);return(a.x*g.x+a.y*g.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function q_(r,e,i){const a=e?2|r:-3&r;return i?1|a:-2&a}function qh(){const r=Math.PI/32,e=Math.tan(r),i=H;return i*Math.sqrt(1+2*e*e)-i}function Hh(r,e,i){const a=1<<i.z,h=ve(i.x/a),g=ve((i.x+1)/a),_=ge(i.y/a),x=ge((i.y+1)/a);return(function(E,A,M,P,L=0,B){const V=[];if(!E.length||!M||!P)return V;const Z=(Se,Me)=>{for(const De of Se)V.push({polygon:De,bounds:Me})},K=Math.ceil(Math.log2(M)),Q=Math.ceil(Math.log2(P)),oe=K-Q,le=[];for(let Se=0;Se<Math.abs(oe);Se++)le.push(oe>0?0:1);for(let Se=0;Se<Math.min(K,Q);Se++)le.push(0),le.push(1);let he=E;if(he=qa(he,A[0].y-L,A[1].y+L,1),he=qa(he,A[0].x-L,A[1].x+L,0),!he.length)return V;const Ee=[];for(le.length?Ee.push({polygons:he,bounds:A,depth:0}):Z(he,A);Ee.length;){const Se=Ee.pop(),Me=Se.depth,De=le[Me],Ne=Se.bounds[0],ft=Se.bounds[1],je=De===0?Ne.x:Ne.y,mt=De===0?ft.x:ft.y,It=B?B(De,je,mt):.5*(je+mt),vt=qa(Se.polygons,je-L,It+L,De),Et=qa(Se.polygons,It-L,mt+L,De);if(vt.length){const Ot=[Ne,new Ct(De===0?It:ft.x,De===1?It:ft.y)];le.length>Me+1?Ee.push({polygons:vt,bounds:Ot,depth:Me+1}):Z(vt,Ot)}if(Et.length){const Ot=[new Ct(De===0?It:Ne.x,De===1?It:Ne.y),ft];le.length>Me+1?Ee.push({polygons:Et,bounds:Ot,depth:Me+1}):Z(Et,Ot)}}return V})(r,e,Math.ceil((g-h)/11.25),Math.ceil((_-x)/11.25),1,((E,A,M)=>{if(E===0)return .5*(A+M);{const P=ge((i.y+A/Bt)/a);return(be(.5*(ge((i.y+M/Bt)/a)+P))*a-i.y)*Bt}}))}function Zd(r,e,i,a,h,g){const _=Math.pow(2,a.z-h.z);for(let x=0;x<i;x++){let E=r.int16[2*(x+e)+0],A=r.int16[2*(x+e)+1];E=(E+h.x*Bt)*_-a.x*Bt,A=(A+h.y*Bt)*_-a.y*Bt,g.push(new Ct(E,A))}}let Jp,em;Xt(U_,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(cv,"PartData"),Xt(lv,"FootprintSegment"),Xt(uv,"BorderCentroidData"),Xt(Kp,"GroundEffect");class vl extends Ct{constructor(e,i,a){super(e,i),this.z=a}}class l0 extends vl{constructor(e,i,a,h){super(e,i,a),this.w=h}}function fv(r,e,i,a){const h=i==="x"?"y":"x",g=(a-r[i])/(e[i]-r[i]);r[h]=Math.round(r[h]+(e[h]-r[h])*g),r[i]=a,r.hasOwnProperty("z")&&(r.z=Ii(r.z,e.z,g)),r.hasOwnProperty("w")&&(r.w=Ii(r.w,e.w,g))}function tm(r,e,i,a){const h=i,g=a;for(const _ of["x","y"]){let x=r,E=e;x[_]>=E[_]&&(x=e,E=r),x[_]<h&&E[_]>h&&fv(x,E,_,h),x[_]<g&&E[_]>g&&fv(E,x,_,g)}}function H_(r,e,i,a,h,g){const _=[];for(let x=0;x<r.length;x++){const E=r[x];let A;const M=_.length;let P=0;for(let L=0;L<E.length-1;L++){let B=E[L],V=E[L+1],Z=0;const K=P;let Q,oe;g&&(Z=Math.hypot(V.x-B.x,V.y-B.y),P+=Z,Q=B,oe=V),B.x<e&&V.x<e||(B.x<e?B=new Ct(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x<e&&(V=new Ct(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y<i&&V.y<i||(B.y<i?B=new Ct(B.x+(i-B.y)/(V.y-B.y)*(V.x-B.x),i)._round():V.y<i&&(V=new Ct(B.x+(i-B.y)/(V.y-B.y)*(V.x-B.x),i)._round()),B.x>=a&&V.x>=a||(B.x>=a?B=new Ct(a,B.y+(a-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x>=a&&(V=new Ct(a,B.y+(a-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y>=h&&V.y>=h||(B.y>=h?B=new Ct(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round():V.y>=h&&(V=new Ct(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round()),A&&B.equals(A[A.length-1])||(A=[B],_.push(A),g&&g.push({progress:{min:K+Rg(Q,oe,B)*Z,max:1},parentIndex:x,prevPoint:Q,nextPoint:oe})),A.push(V),g&&(g[g.length-1].progress.max=K+Rg(Q,oe,V)*Z,g[g.length-1].nextPoint=oe)))))}if(g&&P>0)for(let L=M;L<_.length;L++)g[L].progress.min/=P,g[L].progress.max/=P}return _}function c0(r,e,i,a,h){if(r.length<2)return void a.push(r);const g=[];for(;e.valid();){const[A,M]=e.get();for(let P=0;P<r.length-1;P++){const L=r[P],B=r[P+1],V=zr(L,B,A,M);if(V){const[Z]=V,K=new Ct(Ii(L.x,B.x,Z),Ii(L.y,B.y,Z));g.push({t:P+Z,distance:0,point:K})}}e.next()}if(g.length===0)return void a.push(r);g.sort(((A,M)=>A.t-M.t));let _=0,x=0,E=[];for(a.push(E);_!==r.length;){if(x===g.length){for(;_!==r.length;)E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++;break}g[x].t<=_?(E.length!==0&&E[E.length-1].equals(g[x].point)||E.push(g[x].point),Math.trunc(g[x].t),x++):(E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++)}}function Rg(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function im(r,e){return r.x*e.x+r.y*e.y}function u0(r,e){if(r.length===1){let i=0;const a=e[i++];let h;for(;!h||a.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const g=e[i],_=r[0],x=h.sub(a),E=g.sub(a),A=_.sub(a),M=im(x,x),P=im(x,E),L=im(E,E),B=im(A,x),V=im(A,E),Z=M*L-P*P,K=(L*B-P*V)/Z,Q=(M*V-P*B)/Z,oe=a.z*(1-K-Q)+h.z*K+g.z*Q;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function Mg(r,e,i,a,h,g,_,x){const E=_*h.getElevationAt(r,e,!0,!0),A=g[0]!==0,M=A?g[1]===0?_*(g[0]/7-450):_*(function(P,L,B){const V=Math.floor(L[0]/8),Z=Math.floor(L[1]/8),K=10*(L[0]-8*V),Q=10*(L[1]-8*Z),oe=P.getElevationAt(V,Z,!0,!0),le=P.getMeterToDEM(B),he=Math.floor(.5*(K*le-1)),Ee=Math.floor(.5*(Q*le-1)),Se=P.tileCoordToPixel(V,Z),Me=2*he+1,De=2*Ee+1,Ne=(function(Et,Ot,ut,St,rt){return[Et.getElevationAtPixel(Ot,ut,!0),Et.getElevationAtPixel(Ot+rt,ut,!0),Et.getElevationAtPixel(Ot,ut+rt,!0),Et.getElevationAtPixel(Ot+St,ut+rt,!0)]})(P,Se.x-he,Se.y-Ee,Me,De),ft=Math.abs(Ne[0]-Ne[1]),je=Math.abs(Ne[2]-Ne[3]),mt=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),It=Math.min(.25,.5*le*(ft+je)/Me),vt=Math.min(.25,.5*le*mt/De);return oe+Math.max(It*K,vt*Q)})(h,g,x):E;return{base:E+(i===0?-1:i),top:A?Math.max(M+a,E+i+2):E+a}}class W_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class h0{constructor(){this.tasks={},this.taskQueue=[],Mi(["process"],this),this.invoker=new W_(this.process),this.nextId=0}add(e,i){const a=this.nextId++,h=(function({type:g,isSymbolTile:_,zoom:x}){return x=x||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-x:g==="maybePrepare"&&_?400-x:500:200-x:100-x})(i);if(h===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((a=>!!this.tasks[a])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<i&&(i=g.priority,e=h)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class $f{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Mi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new h0}send(e,i,a,h,g=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=_,this.callbacks[x]=a);const E=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!a,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Go(i,E)},E),{cancel:()=>{a&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[a];delete this.cancelCallbacks[a],h&&h.cancel()}else if(i.mustQueue||Vn(self)){const h=this.callbacks[a],g=this.scheduler.add((()=>this.processTask(a,i)),h&&h.metadata||{type:"message"});g&&(this.cancelCallbacks[a]=g)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Dn(i.error)):a(null,Dn(i.data)))}else{const a=new Set,h=i.hasCallback?(_,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?Go(_):null,data:Go(x,a)},a)}:()=>{},g=Dn(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,g,h);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:x,scope:E}=g;this.parent.getWorkerSource(i.sourceMapId,_[0],x,E)[_[1]](g,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var nm={workerUrl:"",workerClass:null,workerParams:void 0};const Pg="mapboxgl_preloaded_worker_pool";class Qu{constructor(){this.active={}}acquire(e,i=Qu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(nm.workerClass!=null?new nm.workerClass:new self.Worker(nm.workerUrl,nm.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Pg]}numActive(){return Object.keys(this.active).length}}Qu.workerCount=2;class Zf{constructor(e,i,a="Worker",h=Qu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=gt();const g=this.workerPool.acquire(this.id,h);for(let _=0;_<g.length;_++){const x=new Zf.Actor(g[_],i,this.id);x.name=`${a} ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,a){Xe(this.actors,((h,g)=>{h.send(e,i,g)}),a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Dg,rm;function c(){return Dg||(Dg=new Qu),Dg}Zf.Actor=$f;class p{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,h=e.roofColorRgb,g=e.wallColorRgb,_=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],h[0],h[1],h[2],g[0],g[1],g[2],_[0],_[1],_[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const x of e){const E=this.createStringBuffer(x.roofType),A=[0],M=[];for(const B of x.coordinates)if(Array.isArray(B)){for(const V of B)M.push(V.x),M.push(V.y);A.push(M.length)}const P=this.createIntArray(A),L=this.createFloatArray(M);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,E,x.roofType.length,L,P,A.length-1),this.module.free(E),this.module.free(P),this.module.free(L)}for(const x of i){let E;E=x.entrances?JSON.parse(x.entrances):[];const A=this.createFloatArray(E),M=[];for(const L of x.coordinates)M.push(L.x),M.push(L.y);const P=this.createFloatArray(M);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,A,E.length,P,M.length),this.module.free(A),this.module.free(P)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const a=this.module.getMeshCount(),h=new Array(a);for(let x=0;x<a;x++){const E=this.module.getPositionsPtr(x),A=this.module.getPositionsLength(x),M=new Float32Array(this.module.heapF32.buffer,E,A),P=this.module.getNormalsPtr(x),L=this.module.getNormalsLength(x),B=new Float32Array(this.module.heapF32.buffer,P,L),V=this.module.getColorsPtr(x),Z=this.module.getColorsLength(x),K=new Uint8Array(this.module.heapU8.buffer,V,Z),Q=this.module.getAOPtr(x),oe=this.module.getAOLength(x),le=new Float32Array(this.module.heapF32.buffer,Q,oe),he=this.module.getUVPtr(x),Ee=this.module.getUVLength(x),Se=new Float32Array(this.module.heapF32.buffer,he,Ee),Me=this.module.getFauxFacadePtr(x),De=this.module.getFauxFacadeLength(x),Ne=new Uint8Array(this.module.heapU8.buffer,Me,De),ft=this.module.getIndicesPtr(x),je=this.module.getIndicesLength(x),mt=new Int32Array(this.module.heap32.buffer,ft,je),It=this.module.getBuildingPart(x),vt=this.readStringBuffer(It);h[x]={positions:M,normals:B,colors:K,ao:le,uv:Se,isFauxFacade:Ne,indices:mt,buildingPart:vt}}const g=this.module.getRingCount(),_=[];for(let x=0;x<g;x++){const E=this.module.getRingPtr(x),A=this.module.getRingLength(x),M=new Float32Array(this.module.heapF32.buffer,E,A);_.push(M)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let b,I,N,j,ne,Te=null,tt=null,Nt=null,Jt=null;function ai(){return Vn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:I||Kr.DRACO_URL}function Vt(){if(Vn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(j)return j;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return j=WebAssembly.validate(r)?Kr.MESHOPT_SIMD_URL:Kr.MESHOPT_URL,j}function qt(){return Jt}const Ji={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},On={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Zr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function bt(r,e,i){const a=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const ct="KHR_draco_mesh_compression";function Ft(r,e){const i=r.extensions&&r.extensions[ct];if(!i)return;const a=new N.Decoder,h=Gr(e,i.bufferView),g=new N.Mesh;if(!a.DecodeArrayToMesh(h,h.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],x=Ji[_.componentType],E=_.count*x.BYTES_PER_ELEMENT,A=N._malloc(E);x===Uint16Array?a.GetTrianglesUInt16Array(g,E,A):a.GetTrianglesUInt32Array(g,E,A),bt(N.memory.buffer.slice(A,A+E),_,e),N._free(A);for(const M of Object.keys(i.attributes)){const P=a.GetAttributeByUniqueId(g,i.attributes[M]),L=e.json.accessors[r.attributes[M]],B=On[L.componentType],V=L.count*Zr[L.type]*Ji[L.componentType].BYTES_PER_ELEMENT,Z=N._malloc(V);a.GetAttributeDataArrayForAllPoints(g,P,N[B],V,Z),bt(N.memory.buffer.slice(Z,Z+V),L,e),N._free(Z)}a.destroy(),g.destroy(),delete r.extensions[ct]}const ni="EXT_meshopt_compression";function Tn(r,e){if(!r.extensions||!r.extensions[ni])return;const i=r.extensions[ni],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);ne.decodeGltfBuffer(h,i.count,i.byteStride,a,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=h.buffer,delete r.extensions[ni]}const jr=1179937895,dn=new TextDecoder("utf8");function er(r,e){return new URL(r,e).href}function Ar(r,e,i,a){return fetch(er(r.uri,a)).then((h=>h.arrayBuffer())).then((h=>{e.buffers[i]=h}))}function Gr(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Xd(r,e,i,a){if(r.uri){const h=er(r.uri,a);return fetch(h).then((g=>g.blob())).then((g=>createImageBitmap(g))).then((g=>{e.images[i]=g}))}if(r.bufferView!==void 0){const h=Gr(e,r.bufferView),g=new Blob([h],{type:r.mimeType});return createImageBitmap(g).then((_=>{e.images[i]=_}))}}function d0(r,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===jr){const M=new Uint32Array(r,e);let P=2;const L=(M[P++]>>2)-3,B=M[P++]>>2;if(P++,a.json=JSON.parse(dn.decode(M.subarray(P,P+B))),P+=B,P<L){const V=M[P++];P++;const Z=e+(P<<2);a.buffers[0]=r.slice(Z,Z+V)}}else a.json=JSON.parse(dn.decode(new Uint8Array(r,e)));const{buffers:h,images:g,meshes:_,extensionsUsed:x,bufferViews:E}=a.json;let A=Promise.resolve();if(h){const M=[];for(let P=0;P<h.length;P++){const L=h[P];L.uri?M.push(Ar(L,a,P,i)):a.buffers[P]||(a.buffers[P]=null)}A=Promise.all(M)}return A.then((()=>{const M=[],P=x&&x.includes(ct),L=x&&x.includes(ni);if(P&&M.push((function(){if(!N)return b??(b=(function(B){let V,Z=null;function K(){V=new Uint8Array(Z.buffer)}function Q(){throw new Error("Unexpected Draco error.")}const oe={a:{a:Q,d:function(le,he,Ee){return V.copyWithin(le,he,he+Ee)},c:function(le){const he=V.length,Ee=Math.max(le>>>0,Math.ceil(1.2*he)),Se=Math.ceil((Ee-he)/65536);try{return Z.grow(Se),K(),!0}catch{return!1}},b:Q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,oe):B.then((le=>le.arrayBuffer())).then((le=>WebAssembly.instantiate(le,oe)))).then((le=>{const{Rb:he,Qb:Ee,P:Se,T:Me,X:De,Ja:Ne,La:ft,Qa:je,Va:mt,Wa:It,eb:vt,jb:Et,f:Ot,e:ut,yb:St,zb:rt,Ab:Je,Bb:kt,Db:Dt,Gb:xi}=le.instance.exports;Z=ut;const ii=(()=>{let hi=0,Ut=0,yi=0,ji=0;return Zt=>{yi&&(he(ji),he(hi),Ut+=yi,yi=hi=0),hi||(Ut+=128,hi=Ee(Ut));const pi=Zt.length+7&-8;let Di=hi;pi>=Ut&&(yi=pi,Di=ji=Ee(pi));for(let $i=0;$i<Zt.length;$i++)V[Di+$i]=Zt[$i];return Di}})();return K(),Ot(),{memory:ut,_free:he,_malloc:Ee,Mesh:class{constructor(){this.ptr=Se()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=Ne()}destroy(){Et(this.ptr)}DecodeArrayToMesh(hi,Ut,yi){const ji=ii(hi),Zt=ft(this.ptr,ji,Ut,yi.ptr);return!!De(Zt)}GetAttributeByUniqueId(hi,Ut){return{ptr:je(this.ptr,hi.ptr,Ut)}}GetTrianglesUInt16Array(hi,Ut,yi){mt(this.ptr,hi.ptr,Ut,yi)}GetTrianglesUInt32Array(hi,Ut,yi){It(this.ptr,hi.ptr,Ut,yi)}GetAttributeDataArrayForAllPoints(hi,Ut,yi,ji,Zt){vt(this.ptr,hi.ptr,Ut.ptr,yi,ji,Zt)}},DT_INT8:St(),DT_UINT8:rt(),DT_INT16:Je(),DT_UINT16:kt(),DT_UINT32:Dt(),DT_FLOAT32:xi()}}))})(fetch(ai())),b.then((B=>{N=B,b=void 0})))})()),L&&M.push((function(){if(ne)return;const B=(function(V){let Z;const K=WebAssembly.instantiateStreaming(V,{}).then((le=>{Z=le.instance,Z.exports.__wasm_call_ctors()})),Q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(le,he,Ee,Se,Me,De){(function(Ne,ft,je,mt,It,vt,Et){const Ot=Ne.exports.sbrk,ut=mt+3&-4,St=Ot(ut*It),rt=Ot(vt.length),Je=new Uint8Array(Ne.exports.memory.buffer);Je.set(vt,rt);const kt=ft(St,mt,It,rt,vt.length);if(kt===0&&Et&&Et(St,ut,It),je.set(Je.subarray(St,St+mt*It)),Ot(St-Ot(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(Z,Z.exports[oe[Me]],le,he,Ee,Se,Z.exports[Q[De]])}}})(fetch(Vt()));return B.ready.then((()=>{ne=B}))})()),g)for(let B=0;B<g.length;B++)M.push(Xd(g[B],a,B,i));return(M.length?Promise.all(M):Promise.resolve()).then((()=>{if(P&&_)for(const{primitives:B}of _)for(const V of B)Ft(V,a);if(L&&_&&E)for(const B of E)Tn(B,a);return a}))}))}function O1(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function L1(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class z1{constructor(e,i,a,h){this.context=e,this.format=a,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:g}=this,{gl:_}=g,{x,y:E}=i&&i.position?i.position:{x:0,y:0},A=x+a,M=E+h;!this.size||this.size[0]===A&&this.size[1]===M||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;_.texStorage2D(_.TEXTURE_2D,L,this.format,A,M),this.size=[A,M]}this.size&&(P?_.texSubImage2D(_.TEXTURE_2D,0,x,E,O1(this.format),L1(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,x,E,a,h,O1(this.format),L1(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,a=!1){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,h,g){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,a),this.wrapS=a),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),g!==this.compareMode&&(g?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,g)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=g)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const QP=pn([{name:"a_pos_3f",components:3,type:"Float32"}]),JP=pn([{name:"a_color_3f",components:3,type:"Float32"}]),eD=pn([{name:"a_color_4f",components:4,type:"Float32"}]),tD=pn([{name:"a_uv_2f",components:2,type:"Float32"}]),iD=pn([{name:"a_normal_3f",components:3,type:"Float32"}]),nD=pn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),rD=pn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function qE(r,e){const i=f0(r.projection,r.zoom,r.width,r.height),a=(function(g,_,x,E,A){const M=new W(x.lng-180*sm,x.lat),P=new W(x.lng+180*sm,x.lat),L=g.project(M.lng,M.lat),B=g.project(P.lng,P.lat),V=-Math.atan2(B.y-L.y,B.x-L.x),Z=nt.fromLngLat(x);Z.y=Ie(Z.y,-1+sm,1-sm);const K=Z.toLngLat(),Q=g.project(K.lng,K.lat),oe=nt.fromLngLat(K);oe.x+=sm;const le=oe.toLngLat(),he=g.project(le.lng,le.lat),Ee=WE(he.x-Q.x,he.y-Q.y,V),Se=nt.fromLngLat(K);Se.y+=sm;const Me=Se.toLngLat(),De=g.project(Me.lng,Me.lat),Ne=WE(De.x-Q.x,De.y-Q.y,V),ft=Math.abs(Ee.x)/Math.abs(Ne.y),je=Ge([]);vi(je,je,-V*(1-(A?0:E)));const mt=Ge([]);return jt(mt,mt,[1,1-(1-ft)*E,1]),mt[4]=-Ne.x/Ne.y*E,vi(mt,mt,V),xt(mt,je,mt),mt})(r.projection,0,r.center,i,e),h=HE(r);return jt(a,a,[h,h,1]),a}function HE(r){const e=r.projection,i=f0(r.projection,r.zoom,r.width,r.height),a=k1(e,r.center),h=k1(e,W.convert(e.center));return Math.pow(2,a*i+(1-i)*h)}function f0(r,e,i,a,h=1/0){const g=r.range;if(!g)return 0;const _=Math.min(h,Math.max(i,a)),x=Math.log2(_/1024);return Ye(g[0]+x,g[1]+x,e)}const sm=1/4e4;function k1(r,e){const i=Ie(e.lat,-xe,xe),a=new W(e.lng-180*sm,i),h=new W(e.lng+180*sm,i),g=r.project(a.lng,i),_=r.project(h.lng,i),x=nt.fromLngLat(a),E=nt.fromLngLat(h),A=_.x-g.x,M=_.y-g.y,P=E.x-x.x,L=E.y-x.y,B=Math.sqrt((P*P+L*L)/(A*A+M*M));return Math.log2(B)}function WE(r,e,i){const a=Math.cos(i),h=Math.sin(i);return{x:r*a-e*h,y:r*h+e*a}}function $E(r,e,i){Ge(r),vi(r,r,Fe(e[2])),wi(r,r,Fe(e[0])),Ai(r,r,Fe(e[1])),jt(r,r,i),xt(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function p0(r,e,i,a,h,g,_,x){const E=[i[0]-e[0],i[1]-e[1],0],A=[a[0]-e[0],a[1]-e[1],0];if(Ue(E)<1e-12||Ue(A)<1e-12)return Qa(r);const M=cn([],E,A);Qt(M,M),Si(A,a,e),E[2]=(g-h)*x,A[2]=(_-h)*x;const P=E;return cn(P,E,A),Qt(P,P),jc(r,M,P)}function N1(r,e,i=!1){const a=ic(e.zoom),h=(function(g,_,x){const E=_.worldSize,A=[g[12],g[13],g[14]],M=ge(A[1]/E),P=ve(A[0]/E),L=Ge([]),B=ye(1,M)*E,V=ye(1,0)*E*Oe(M,_.zoom),Z=1/jy(E);let K=V*Z;if(x){const he=f0(_.projection,_.zoom,_.width,_.height,1024);K=Z*_.projection.pixelSpaceConversion(_.center.lat,E,he)}const Q=F(M,P);Pt(Q,Q,et([],Qt([],Q),B*K*A[2]));const oe=(function(he){const Ee=[he[0],he[1],he[2]];let Se=[0,1,0];const Me=cn([],Se,Ee);return cn(Se,Ee,Me),Hi(Se)===0&&(Se=[0,1,0],cn(Me,Ee,Se)),Qt(Me,Me),Qt(Se,Se),Qt(Ee,Ee),[Me[0],Me[1],Me[2],0,Se[0],Se[1],Se[2],0,Ee[0],Ee[1],Ee[2],0,he[0],he[1],he[2],1]})(Q);jt(L,L,[K,K,K*B]),wt(L,L,[-A[0],-A[1],-A[2]]);const le=xt([],_.globeMatrix,oe);return xt(le,le,L),xt(le,le,g),le})(r,e,i);if(a>0){const g=(function(_,x){const E=x.worldSize,A=ye(1,0)*E*Oe(x.center.lat,x.zoom)/jy(E),M=ye(1,x.center.lat)*E,P=Ge([]);Ai(P,P,Fe(x.center.lng)),wi(P,P,Fe(x.center.lat)),wt(P,P,[0,0,d]),jt(P,P,[A,A,A*M]);const L=x.point;return wt(P,P,[-L.x,-L.y,0]),xt(P,P,_),xt(P,x.globeMatrix,P)})(r,e);return(function(_,x,E){const A=(V,Z,K)=>{const Q=Ue(V),oe=Ue(Z),le=Zu(V,Z,K);return et(le,le,1/Ue(le)*Ii(Q,oe,K))},M=A([_[0],_[1],_[2]],[x[0],x[1],x[2]],E),P=A([_[4],_[5],_[6]],[x[4],x[5],x[6]],E),L=A([_[8],_[9],_[10]],[x[8],x[9],x[10]],E),B=Zu([_[12],_[13],_[14]],[x[12],x[13],x[14]],E);return[M[0],M[1],M[2],0,P[0],P[1],P[2],0,L[0],L[1],L[2],0,B[0],B[1],B[2],1]})(h,g,a)}return h}function ZE(r,e,i,a){const h=Ci.projectAabbCorners(a,i);let g=Number.MAX_VALUE,_=-1;for(let A=0;A<h.length;++A){const M=h[A];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<g&&(_=A,g=M[2])}const x=A=>new Ct(h[A][0],h[A][1]);let E;switch(_){case 0:case 6:E=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:E=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:E=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:E=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Wo(r,E))return g}const Og=64,$_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function XE(r,e,i,a,h,g,_,x,E,A=!1){const M=i.zoom,P=i.project(a),L=Oe(a.lat,M),B=1/L;Ge(r),wt(r,r,[P.x+_[0]*B,P.y+_[1]*B,_[2]]);let V=1,Z=1;const K=i.worldSize;if(A){if(i.projection.name==="mercator"){let he=0;i.elevation&&(he=i.elevation.getAtPointOrZero(new nt(P.x/K,P.y/K),0));const Ee=Fs([],[P.x,P.y,he,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=Ee,Z=Ee*Oe(i.center.lat,M)}else if(i.projection.name==="globe"){const he=N1(r,i),Ee=[0,0,0,1];Fs(Ee,Ee,xt([],i.projMatrix,he));const Se=Ee[3]/i.cameraToCenterDistance,Me=ic(M),De=i.projection.pixelsPerMeter(a.lat,K)*Oe(a.lat,M),Ne=i.projection.pixelsPerMeter(i.center.lat,K)*Oe(i.center.lat,M);V=Se/Ii(De,Ze(i.center.lat),Me),Z=Se*L/De,V*=Ne,Z*=Ne}}else V=B;jt(r,r,[V,V,Z]);const Q=[...r],oe=e.orientation,le=[];if($E(le,[oe[0]+h[0],oe[1]+h[1],oe[2]+h[2]],g),xt(r,Q,le),x&&i.elevation){let he=0;const Ee=[];if(E&&i.elevation){he=(function(Me,De,Ne,ft,je){const mt=De.elevation;if(!mt)return 0;const It=Ci.projectAabbCorners(Ne,ft),vt=ye(1,je.lat)*De.worldSize,Et=(function(Ut,yi){const ji=[0,0,1],Zt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const pi of Zt){const Di=Ut[pi.corners[0]],$i=Ut[pi.corners[1]],rn=Ut[pi.corners[2]],Yi=[$i[0]-Di[0],$i[1]-Di[1],yi*($i[2]-Di[2])],oi=cn(Yi,Yi,[rn[0]-Di[0],rn[1]-Di[1],yi*(rn[2]-Di[2])]);Qt(oi,oi),pi.dotProductWithUp=Li(oi,ji)}return Zt.sort(((pi,Di)=>pi.dotProductWithUp-Di.dotProductWithUp)),Zt[0].corners})(It,vt),Ot=It[Et[0]],ut=It[Et[1]],St=It[Et[2]],rt=It[Et[3]],Je=mt.getAtPointOrZero(new nt(Ot[0]/De.worldSize,Ot[1]/De.worldSize),0),kt=mt.getAtPointOrZero(new nt(ut[0]/De.worldSize,ut[1]/De.worldSize),0),Dt=mt.getAtPointOrZero(new nt(St[0]/De.worldSize,St[1]/De.worldSize),0),xi=mt.getAtPointOrZero(new nt(rt[0]/De.worldSize,rt[1]/De.worldSize),0),ii=(Je+xi)/2,hi=(kt+Dt)/2;return ii>hi?kt<Dt?p0(Me,ut,rt,Ot,kt,xi,Je,vt):p0(Me,St,Ot,rt,Dt,Je,xi,vt):Je<xi?p0(Me,Ot,ut,St,Je,kt,Dt,vt):p0(Me,rt,St,ut,xi,Dt,kt,vt),Math.max(ii,hi)})(Ee,i,e.aabb,r,a);const Se=xt([],We([],Ee),le);xt(r,Q,Se)}else he=i.elevation.getAtPointOrZero(new nt(P.x/K,P.y/K),0);he!==0&&(r[14]+=he)}}function mv(r,e,i=!1){r.uploaded||(r.gfxTexture=new z1(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function sD(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,QP.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,iD.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,tD.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?JP:eD).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,rD.members,!0)),r.segments=Er.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&mv(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&mv(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&mv(a.normalTexture,e),a.occlusionTexture&&mv(a.occlusionTexture,e,i),a.emissionTexture&&mv(a.emissionTexture,e)}function F1(r,e,i){if(r.meshes)for(const a of r.meshes)sD(a,e,i);if(r.children)for(const a of r.children)F1(a,e,i)}function m0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)m0(e)}function B1(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)B1(i)}function Lg(r,e){const i=r.json.bufferViews[e.bufferView],a=Ji[e.componentType];return new a(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Zr[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:Zr[e.type]))}function V1(r,e,i,a){const h=Ji[e.componentType],g=(function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),_=r.json.bufferViews[e.bufferView],x=_.byteStride?_.byteStride/h.BYTES_PER_ELEMENT:Zr[e.type],E=i.float32,A=E.length/i.capacity;for(let M=0,P=0;M<e.count*x;M+=x,P+=A)for(let L=0;L<A;L++)E[P+L]=a[M+L]*g;i._trim()}function oD(r,e,i){const a=r.indices,h=r.attributes,g={};g.indexArray=new gs;const _=e.json.accessors[a],x=_.count/3;g.indexArray.reserve(x);const E=Lg(e,_);for(let L=0;L<x;L++)g.indexArray.emplaceBack(E[3*L],E[3*L+1],E[3*L+2]);g.indexArray._trim(),g.vertexArray=new Po;const A=e.json.accessors[h.POSITION];g.vertexArray.reserve(A.count);const M=Lg(e,A);for(let L=0;L<A.count;L++)g.vertexArray.emplaceBack(M[3*L],M[3*L+1],M[3*L+2]);if(g.vertexArray._trim(),g.aabb=new Ci(A.min,A.max),g.centroid=(function(L,B){const V=[0,0,0],Z=L.length;if(Z>0){for(let K=0;K<Z;K++){const Q=3*L[K];V[0]+=B[Q],V[1]+=B[Q+1],V[2]+=B[Q+2]}V[0]/=Z,V[1]/=Z,V[2]/=Z}return V})(E,M),h.COLOR_0!==void 0){const L=e.json.accessors[h.COLOR_0],B=Zr[L.type],V=Lg(e,L);g.colorArray=B===3?new Po:new da,g.colorArray.resize(L.count),V1(e,L,g.colorArray,V)}if(h.NORMAL!==void 0){g.normalArray=new Po;const L=e.json.accessors[h.NORMAL];g.normalArray.resize(L.count);const B=Lg(e,L);V1(e,L,g.normalArray,B)}if(h.TEXCOORD_0!==void 0&&i.length>0){g.texcoordArray=new Mh;const L=e.json.accessors[h.TEXCOORD_0];g.texcoordArray.resize(L.count);const B=Lg(e,L);V1(e,L,g.texcoordArray,B)}if(h._FEATURE_ID_RGBA4444!==void 0){const L=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Lg(e,L))}h._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Lg(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=r.material;return g.material=(function(L,B){const{emissiveFactor:V=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:K=.5,normalTexture:Q,occlusionTexture:oe,emissiveTexture:le,doubleSided:he}=L,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Se=1,roughnessFactor:Me=1,baseColorTexture:De,metallicRoughnessTexture:Ne}=L.pbrMetallicRoughness||{},ft=oe?B[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&ft){const je=oe.extensions.KHR_texture_transform;ft.offsetScale=[je.offset[0],je.offset[1],je.scale[0],je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new In(...Ee),metallicFactor:Se,roughnessFactor:Me,baseColorTexture:De?B[De.index]:void 0,metallicRoughnessTexture:Ne?B[Ne.index]:void 0},doubleSided:he,emissiveFactor:new In(...V),alphaMode:Z,alphaCutoff:K,normalTexture:Q?B[Q.index]:void 0,occlusionTexture:ft,emissionTexture:le?B[le.index]:void 0,defined:L.defined===void 0}})(P!==void 0?e.json.materials[P]:{defined:!1},i),g}function YE(r,e,i){const{matrix:a,rotation:h,translation:g,scale:_,mesh:x,extras:E,children:A}=r,M={};if(M.matrix=a||(function(P,L,B,V){var Z=L[0],K=L[1],Q=L[2],oe=L[3],le=Z+Z,he=K+K,Ee=Q+Q,Se=Z*le,Me=Z*he,De=Z*Ee,Ne=K*he,ft=K*Ee,je=Q*Ee,mt=oe*le,It=oe*he,vt=oe*Ee,Et=V[0],Ot=V[1],ut=V[2];return P[0]=(1-(Ne+je))*Et,P[1]=(Me+vt)*Et,P[2]=(De-It)*Et,P[3]=0,P[4]=(Me-vt)*Ot,P[5]=(1-(Se+je))*Ot,P[6]=(ft+mt)*Ot,P[7]=0,P[8]=(De+It)*ut,P[9]=(ft-mt)*ut,P[10]=(1-(Se+Ne))*ut,P[11]=0,P[12]=B[0],P[13]=B[1],P[14]=B[2],P[15]=1,P})([],h||[0,0,0,1],g||[0,0,0],_||[1,1,1]),x!==void 0){M.meshes=i[x];const P=M.anchor=[0,0];for(const L of M.meshes){const{min:B,max:V}=L.aabb;P[0]+=B[0]+V[0],P[1]+=B[1]+V[1]}P[0]=Math.floor(P[0]/M.meshes.length/2),P[1]=Math.floor(P[1]/M.meshes.length/2)}if(E&&(E.id&&(M.id=E.id),E.lights&&(M.lights=(function(P){if(!P.length)return[];const L=(function(Q){const oe=atob(Q),le=new Uint8Array(oe.length);for(let he=0;he<oe.length;he++)le[he]=oe.codePointAt(he);return le})(P),B=[],V=L.length/24,Z=new Uint16Array(L.buffer),K=new Float32Array(L.buffer);for(let Q=0;Q<V;Q++){const oe=Z[2*Q*6]/30,le=Z[2*Q*6+1]/30,he=Z[2*Q*6+10]/100,Ee=K[6*Q+1],Se=K[6*Q+2],Me=K[6*Q+3],De=K[6*Q+4],Ne=Me-Ee,ft=De-Se,je=Math.hypot(Ne,ft);B.push({pos:[Ee+.5*Ne,Se+.5*ft,le],normal:[ft/je,-Ne/je,0],width:je,height:oe,depth:he,points:[Ee,Se,Me,De]})}return B})(E.lights))),A){const P=[];for(const L of A)P.push(YE(e.json.nodes[L],e,i));M.children=P}return M}function aD(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new D_(r.vertices,r.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:a}}function lD(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const x=_[0],E=_[1];typeof x=="number"&&typeof E=="number"&&a.push(new Ct(x,E))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let h=0;for(let _=0;_<a.length;_++){const x=a[_],E=a[(_+1)%a.length],A=a[(_+2)%a.length];h+=(x.x-E.x)*(A.y-E.y)-(A.x-E.x)*(x.y-E.y)}h>0&&a.reverse();const g=Hd(a.flatMap((_=>[_.x,_.y])),[]);return g.length===0?null:{vertices:a,indices:g}}function cD(r,e){const i=[],a=[];let h=0;const g=[];for(const _ of r){h=i.length;const x=_.vertexArray.float32,E=_.indexArray.uint16;for(let A=0;A<_.vertexArray.length;A++)g[0]=x[3*A+0],g[1]=x[3*A+1],g[2]=x[3*A+2],ur(g,g,e),i.push(new Ct(g[0],g[1]));for(let A=0;A<3*_.indexArray.length;A++)a.push(E[A]+h)}if(a.length%3!=0)return null;for(let _=0;_<a.length;_+=3){const x=i[a[_+0]],E=i[a[_+1]],A=i[a[_+2]];(x.x-E.x)*(A.y-E.y)-(A.x-E.x)*(x.y-E.y)>0&&([a[_+1],a[_+2]]=[a[_+2],a[_+1]])}return{vertices:i,indices:a}}function KE(r){const e=(function(E,A){const M=[],P=WebGL2RenderingContext;if(E.json.textures)for(const L of E.json.textures){const B={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};L.sampler!==void 0&&Object.assign(B,E.json.samplers[L.sampler]),M.push({image:A[L.source],sampler:B,uploaded:!1})}return M})(r,r.images),i=(function(E,A){const M=[];for(const P of E.json.meshes){const L=[];for(const B of P.primitives)L.push(oD(B,E,A));M.push(L)}return M})(r,e),{scenes:a,scene:h,nodes:g}=r.json,_=a?a[h||0].nodes:[...g.keys()],x=[];for(const E of _)x.push(YE(g[E],r,i));return(function(E,A,M){const P={},L=new Set;for(let B=0;B<E.length;B++){const V=M[A[B]];if(!V.extras)continue;const Z=V.extras["mapbox:footprint:version"],K=V.extras["mapbox:footprint:id"];(Z||K)&&L.add(B),Z==="1.0.0"&&K&&(P[K]=B)}for(let B=0;B<E.length;B++){if(L.has(B))continue;const V=E[B],Z=M[A[B]];if(!Z.extras)continue;let K=null;V.id in P&&(K=cD(E[P[V.id]].meshes,V.matrix)),K||(K=lD(Z)),K&&(V.footprint=aD(K))}if(L.size>0){const B=Array.from(L.values()).sort(((V,Z)=>V-Z));for(let V=B.length-1;V>=0;V--)E.splice(B[V],1)}})(x,_,r.json.nodes),x}function uD(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,a=r.aabb.min[1]-1,h=Og/(r.aabb.max[0]-i+2),g=Og/(r.aabb.max[1]-a+2);for(let _=0;_<e.length;_+=3){const x=e[_+2],E=(e[_+0]-i)*h|0,A=(e[_+1]-a)*g|0;x>r.heightmap[A*Og+E]&&(r.heightmap[A*Og+E]=x)}}function QE(r,e,i,a,h){i.reserve(i.length+4*r.length),a.reserve(a.length+10*r.length),h.reserve(h.length+10*r.length);let g=a.length;for(const _ of r){const x=Math.min(10,Math.max(4,1.3*_.height))*e,E=[-_.normal[1],_.normal[0],0],A=Math.min(.29,.1*_.width/_.depth),M=_.width-2*_.depth*e*(A+.01),P=Kt([],_.pos,E,M/2),L=Kt([],_.pos,E,-M/2),B=[P[0],P[1],P[2]+_.height],V=[L[0],L[1],L[2]+_.height],Z=Kt([],_.normal,E,A);et(Z,Z,x);const K=Kt([],_.normal,E,-A);et(K,K,x),Pt(Z,P,Z),Pt(K,L,K),P[2]+=.1,L[2]+=.1,a.emplaceBack(Z[0],Z[1],Z[2]),a.emplaceBack(K[0],K[1],K[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(L[0],L[1],L[2]),a.emplaceBack(B[0],B[1],B[2]),a.emplaceBack(V[0],V[1],V[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(L[0],L[1],L[2]),a.emplaceBack(Z[0],Z[1],Z[2]),a.emplaceBack(K[0],K[1],K[2]);const Q=M/x/2;h.emplaceBack(-Q-A,-1,Q,.8),h.emplaceBack(Q+A,-1,Q,.8),h.emplaceBack(-Q,0,Q,1.3),h.emplaceBack(Q,0,Q,1.3),h.emplaceBack(Q+A,-.8,Q,.7),h.emplaceBack(Q+A,-.8,Q,.7),h.emplaceBack(0,0,Q,1.3),h.emplaceBack(0,0,Q,1.3),h.emplaceBack(Q+A,-1.2,Q,.8),h.emplaceBack(Q+A,-1.2,Q,.8),i.emplaceBack(6+g,4+g,8+g),i.emplaceBack(7+g,9+g,5+g),i.emplaceBack(0+g,1+g,2+g),i.emplaceBack(1+g,3+g,2+g),g+=10}}function hD(r,e){const i={};i.indexArray=new gs,i.vertexArray=new Po,i.colorArray=new da,QE(r,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=In.black;const h={};return h.baseColorFactor=In.white,a.pbrMetallicRoughness=h,i.material=a,i.aabb=new Ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const JE=pn([{name:"a_pos_3f",components:3,type:"Float32"}]),dD=pn([{name:"a_normal_3",components:3,type:"Int16"}]),fD=pn([{name:"a_centroid_3",components:3,type:"Int16"}]),eS=pn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),pD=pn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),mD=pn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),gD=pn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),_D=pn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),tS=Tt.types,U1=32767;function yD(r,e){const i=Bt+e;for(const a of r)for(const h of a)if(h.x<-e||h.x>i||h.y<-e||h.y>i)return!1;return!0}class iS{constructor(){this.layoutVertexArray=new Po,this.layoutAttenuationArray=new da,this.layoutColorArray=new os,this.indexArray=new gs,this.indexArrayForConflation=new gs,this.segmentsBucket=new Er}}class j1{constructor(){this.layoutVertexArray=new Po,this.layoutNormalArray=new hu,this.layoutCentroidArray=new hu,this.layoutColorArray=new os,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new gs,this.indexArrayForConflation=new gs,this.segmentsBucket=new Er,this.entranceBloom=new iS}}class nS{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new j1,this.buildingWithFacade=new j1,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new os,this.buildingWithFacade.layoutFacadeDataArray=new Ah,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new os,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new Kp(e)}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}prepare(){return(function(){if(Jt!=null||Nt!=null)return null;if(tt!=null)return tt;const e=fetch(Kr.BUILDING_GEN_URL);return tt=(function(i){let a,h,g,_;function x(){a=new Uint8Array(_.buffer),h=new Int32Array(_.buffer),g=new Float32Array(_.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:E,f:function(P){const L=a.length,B=Math.max(P>>>0,Math.ceil(1.2*L)),V=Math.ceil((B-L)/65536);try{return _.grow(V),x(),!0}catch{return!1}},g:E,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then((P=>P.arrayBuffer())).then((P=>WebAssembly.instantiate(P,M)))).then((P=>{const L=P.instance.exports;return(0,L.g)(),_=L.f,x(),new p({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getOuterRingLength:L.s,getMeshCount:L.t,getPositionsPtr:L.u,getPositionsLength:L.v,getNormalsPtr:L.w,getNormalsLength:L.x,getColorsPtr:L.y,getColorsLength:L.z,getAOPtr:L.A,getAOLength:L.B,getUVPtr:L.C,getUVLength:L.D,getFauxFacadePtr:L.E,getFauxFacadeLength:L.F,getIndicesPtr:L.G,getIndicesLength:L.H,getBuildingPart:L.I,getRingCount:L.J,getRingPtr:L.K,getRingLength:L.L,free:L.M,malloc:L.N,heapU8:a,heap32:h,heapF32:g})}))})(e).then((i=>(tt=null,Jt=i,Jt))).catch((i=>{Ki("Could not load building-gen"),tt=null,Nt=i})),tt})()}populate(e,i,a,h){const g=qt();if(!g)return;const _=qe(a);this.tileToMeter=_,this.brightness=i.brightness,g.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const x=new Map;for(const{feature:E}of e){if(tS[E.type]!=="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,M=Mt(E,A);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),M,a))continue;const P=A?M.geometry:Yt(E,a,h),L=[];for(const K of P)for(const Q of K)L.push({x:Q.x,y:Q.y});const B={coordinates:L,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},V=E.properties.source_id;let Z=x.get(V);Z||(Z=[],x.set(V,Z)),Z.push(B)}this.maxHeight=0;for(const{feature:E,index:A}of e){if(tS[E.type]==="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,P=Mt(E,M);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),P,a))continue;const L=M?P.geometry:Yt(E,a,h),B=wg(L,500);if(!yD(L,163))continue;const V=this.layers[0],Z=V.layout.get("building-base").evaluate(E,{},a),K=V.layout.get("building-height").evaluate(E,{},a),Q=V.layout.get("building-roof-shape").evaluate(E,{},a),oe=V.paint.get("building-ambient-occlusion-intensity"),le=V.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(Q==="flat")continue;const he=V.layout.get("building-facade").evaluate(E,{},a);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(he,!1,1);const Ee=E.properties.source_id;let Se;Se=x.has(Ee)?x.get(Ee):[];let Me=0,De=0,Ne=0,ft=0,je=0,mt=0;if(he){let oi=Math.round(V.layout.get("building-facade-floors").evaluate(E,{},a));if(Z===0){oi=Math.max(1,oi-(Se.length>0?1:0));let An=4;if(K>100){const fe=[10,13,15];An=fe[E.id?E.id%fe.length:0],g.setFacadeOptions(An,!0)}je=1.6803*An/_}else je=Z/_;mt=K/_,je=Math.min(je,mt),Ne=V.layout.get("building-facade-unit-width").evaluate(E,{},a)/_,ft=(mt-je)/oi,g.setFauxFacadeOptions(!0,!0,Ne);const Zi=V.layout.get("building-facade-window").evaluate(E,{},a);Me=Zi[0],De=Zi[1]}const It=[],vt=new Ct(1/0,1/0),Et=new Ct(-1/0,-1/0),Ot=new Ct(0,0);let ut=0;for(const oi of B)if(oi.length>0){const Zi=[];for(const An of oi){const fe=[];for(let pe=An.length-1;pe>=0;pe--){const it=An[pe];fe.push({x:it.x,y:it.y}),vt.x=Math.min(vt.x,it.x),vt.y=Math.min(vt.y,it.y),Et.x=Math.max(Et.x,it.x),Et.y=Math.max(Et.y,it.y),Ot.x+=it.x,Ot.y+=it.y,ut++}Zi.push(fe)}It.push({id:E.id?E.id:0,height:K,minHeight:Z,sourceId:0,roofType:Q,coordinates:Zi})}Ot.x/=ut||1,Ot.y/=ut||1;const St=g.generateMesh(It,Se);if(typeof St=="string"){Ki(`Unable to generate building ${E.id}: ${St}`);continue}if(St.meshes.length===0||St.modifiedPolygonRings.length===0)continue;let rt=0;for(const oi of St.meshes)rt+=oi.positions.length/3;const Je=he?this.buildingWithFacade:this.buildingWithoutFacade,kt=Je.segmentsBucket.prepareSegment(rt,Je.layoutVertexArray,Je.indexArray),Dt=[];let xi=null,ii=0,hi=-1;const Ut=Je.indexArray.length;let yi=0;for(const oi of St.meshes){const Zi=Je.layoutVertexArray.length;if(oi.buildingPart==="entrance"){const dt=new Array;for(let Ti=0;Ti<oi.indices.length;Ti+=12){const sn=oi.positions[Ti+0],an=oi.positions[Ti+1],tn=oi.positions[Ti+3],Hn=oi.positions[Ti+4],Pr=oi.positions[Ti+2],en=oi.positions[Ti+8]-Pr,gr=1,Yn=tn-sn,kn=Hn-an,xr=Math.hypot(Yn,kn);dt.push({pos:[sn+.5*Yn,an+.5*kn,Pr],normal:[kn/xr,-Yn/xr,0],width:xr,height:en,depth:gr,points:[sn,an,tn,Hn]})}const Wt=Je.entranceBloom.segmentsBucket.prepareSegment(10*dt.length,Je.entranceBloom.layoutVertexArray,Je.entranceBloom.indexArray),Ht=Je.entranceBloom.layoutVertexArray.length;ii=Je.entranceBloom.indexArray.length,QE(dt,.5/this.tileToMeter,Je.entranceBloom.indexArray,Je.entranceBloom.layoutVertexArray,Je.entranceBloom.layoutAttenuationArray);const ri=Je.entranceBloom.layoutVertexArray.length-Ht;hi=Je.entranceBloom.indexArray.length-ii;for(let Ti=0;Ti<ri;Ti++)Je.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Wt.vertexLength+=ri,Wt.primitiveLength+=hi,xi={part:oi.buildingPart,vertexOffset:Ht,vertexLength:ri}}for(let dt=0;dt<oi.positions.length;dt+=3)yi=Math.max(yi,oi.positions[dt+2]),Je.layoutVertexArray.emplaceBack(oi.positions[dt],oi.positions[dt+1],oi.positions[dt+2]);const An=Math.floor(Ot.x),fe=Math.floor(Ot.y),pe=Math.floor(yi);for(let dt=0;dt<oi.positions.length;dt+=3)Je.layoutCentroidArray.emplaceBack(An,fe,pe);for(let dt=0;dt<oi.normals.length;dt+=3)Je.layoutNormalArray.emplaceBack(oi.normals[dt+0]*U1,oi.normals[dt+1]*U1,oi.normals[dt+2]*U1);for(let dt=0;dt<oi.ao.length;dt++)Je.layoutAOArray.push(oi.ao[dt]);for(let dt=0;dt<oi.colors.length;dt+=3){const Wt=1+(oi.ao[dt/3]-1)*oe;Je.layoutColorArray.emplaceBack(oi.colors[dt]*Wt<<8|oi.colors[dt+1]*Wt,oi.colors[dt+2]*Wt<<8)}if(he){for(let dt=0;dt<oi.positions.length;dt+=3)Je.layoutFacadePaintArray.emplaceBack(65535,255);for(let dt=0;dt<oi.isFauxFacade.length;dt++)if(oi.isFauxFacade[dt]){const Wt=1|Math.min(65535,Math.floor(oi.uv[2*dt]*St.outerRingLength)),Ht=Math.floor(255*Me)<<8|Math.floor(255*De),ri=Math.floor(65535*Math.min(1,Ne/Bt)),Ti=Math.floor(65535*Math.min(1,ft/Bt));Je.layoutFacadeDataArray.emplaceBack(Wt,Ht,ri,Ti);const sn=Math.floor(65535*Math.min(1,je/Bt)),an=Math.floor(65535*Math.min(1,mt/Bt));Je.layoutFacadeVerticalRangeArray.emplaceBack(sn,an)}else Je.layoutFacadeDataArray.emplaceBack(0,0,0,0),Je.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const it=kt.vertexLength;for(let dt=0;dt<oi.indices.length;dt+=3)Je.indexArray.emplaceBack(it+oi.indices[dt],it+oi.indices[dt+1],it+oi.indices[dt+2]);kt.vertexLength+=oi.positions.length/3,kt.primitiveLength+=oi.indices.length/3,(oi.buildingPart==="roof"||oi.buildingPart==="wall"||oi.buildingPart==="facade_glazing"||oi.buildingPart==="entrance")&&Dt.push({part:oi.buildingPart,vertexOffset:Zi,vertexLength:oi.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,yi),this.buildingFeatures.push({feature:P,hasFauxFacade:he,segment:kt,parts:Dt,buildingBloom:xi});const ji=Je.indexArray.length-Ut,Zt=[],pi=[],Di=new Ct(1/0,1/0),$i=new Ct(-1/0,-1/0),rn=this.groundEffect.vertexArray.length;for(const oi of St.modifiedPolygonRings){const Zi=[],An=new Ct(1/0,1/0),fe=new Ct(-1/0,-1/0);for(let pe=0;pe<oi.length;pe+=2){const it=oi.length-pe-2;An.x=Math.min(An.x,oi[it]),An.y=Math.min(An.y,oi[it+1]),fe.x=Math.max(fe.x,oi[it]),fe.y=Math.max(fe.y,oi[it+1]);const dt=new Ct(oi[it],oi[it+1]);Zi.push(dt),Zt.push(dt.x,dt.y),pi.push(dt.clone())}Di.x=Math.min(Di.x,An.x),Di.y=Math.min(Di.y,An.y),$i.x=Math.max($i.x,fe.x),$i.y=Math.max($i.y,fe.y),this.groundEffect.addData(Zi,[An,fe],le)}const Yi=this.groundEffect.vertexArray.length-rn;(vt.x<0||Et.x>Bt||vt.y<0||Et.y>Bt)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const oi=Hd(Zt,null,2),Zi=new D_(pi,oi,8,256);let An=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(An=E.properties.building_id),this.footprints.push({vertices:pi,indices:oi,grid:Zi,min:Di,max:$i,buildingId:An,hiddenFlags:0,indicesOffset:Ut,indicesLength:ji,bloomIndicesOffset:ii,bloomIndicesLength:hi,groundEffectVertexOffset:rn,groundEffectVertexLength:Yi,hasFauxFacade:he,segment:kt,height:yi})}this.programConfigurations.populatePaintArrays(Je.layoutVertexArray.length,E,A,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(E,A,{},i.availableImages,a,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,h,g,_,x){this.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x),this.groundEffect.update(e,i,g,a,h,_,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,JE.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,dD.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,fD.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,mD.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,gD.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,JE.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,_D.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let h=!1;const g=a?i:0,_=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const E=this.footprints[x],A=E.hiddenFlags&_|g;E.hiddenFlags!==A&&(E.hiddenFlags=A,h=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const h of this.footprints){const g=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let E=h.indicesOffset;E<_;E++)g.indexArrayForConflation.uint16[3*E+0]=0,g.indexArrayForConflation.uint16[3*E+1]=0,g.indexArrayForConflation.uint16[3*E+2]=0;const x=h.bloomIndicesOffset+h.bloomIndicesLength;for(let E=h.bloomIndicesOffset;E<x;E++)g.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const a=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=e.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=e.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,eS.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,pD.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,eS.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const g=i[h.feature.id],_=h.feature;_.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),L=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const B=e.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),Z=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Q of h.parts){let oe,le=x;Q.part==="roof"?(le=x,oe=E):Q.part==="wall"?(le=A,oe=M):Q.part==="facade_glazing"?(le=P,oe=L):Q.part==="entrance"&&(le=B,oe=V),oe=Ie(oe,0,1);for(let he=0;he<Q.vertexLength;he++){const Ee=Q.vertexOffset+he,Se=1+(Z.layoutAOArray[Ee]-1)*a;Z.layoutColorArray.emplace(Ee,le.r*Se*255<<8|le.g*Se*255,le.b*Se*255<<8|255*oe),h.hasFauxFacade&&Z.layoutFacadePaintArray.emplace(Ee,255*P.r<<8|255*P.g,255*P.b<<8|255*L)}}const K=h.buildingBloom;if(K)for(let Q=0;Q<K.vertexLength;Q++)Z.entranceBloom.layoutColorArray.emplace(K.vertexOffset+Q,255*B.r<<8|255*B.g,255*B.b<<8|51*V)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if($d(this.activeReplacements,h))return;this.activeReplacements=h;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<=Wf)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>_.max.x||E.max.x<_.min.x||E.min.y>_.max.y||E.max.y<_.min.y||(g.length=0,vD(E.vertices,0,E.vertices.length,_.footprintTileId.canonical,e.canonical,g),Sg(_.footprint,g,E.indices,0,E.indices.length,0,-x)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,h=!0;const g=4*(e+Bt)*Bt+(i+Bt);if(this.footprintLookup.hasOwnProperty(g)){const x=this.footprintLookup[g];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const _=new Ct(e,i);for(const x of this.footprints)e>x.max.x||x.min.x>e||i>x.max.y||x.min.y>i||x.height<=a||z_(_,x)&&(a=x.height,this.footprintLookup[g]=x,h=x.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:h};this.footprintLookup[g]=void 0}}function vD(r,e,i,a,h,g){const _=Math.pow(2,a.z-h.z);for(let x=0;x<i;x++){let E=r[x+e].x,A=r[x+e].y;E=(E+h.x*Bt)*_-a.x*Bt,A=(A+h.y*Bt)*_-a.y*Bt,g.push(new Ct(E,A))}}let rS,sS;Xt(nS,"BuildingBucket",{omit:["layers"]}),Xt(j1,"BuildingGeometry"),Xt(iS,"BuildingBloomGeometry");const xD=pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),bD=pn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:wD}=xD,TD=pn([{name:"a_packed",components:3,type:"Float32"}]),{members:ED}=TD,SD=pn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:AD}=SD;class oS{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Lc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=di(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const h=[];let g=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,x=!0;h.push({left:g,right:_,isDash:x,zeroLength:e[0]===0});let E=e[0];for(let A=1;A<e.length;A++){x=!x;const M=e[A];g=E*a,E+=M,_=E*a,h.push({left:g,right:_,isDash:x,zeroLength:M===0})}return h}addRoundDash(e,i,a){const h=i/2;for(let g=-a;g<=a;g++){const _=this.width*(this.nextRow+a+g);let x=0,E=e[x];for(let A=0;A<this.width;A++){A/E.right>1&&(E=e[++x]);const M=Math.abs(A-E.left),P=Math.abs(A-E.right),L=Math.min(M,P);let B;const V=g/a*(h+1);if(E.isDash){const Z=h-Math.abs(V);B=Math.sqrt(L*L+Z*Z)}else B=h-Math.sqrt(L*L+V*V);this.image.data[_+A]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const A=e[E],M=e[E+1];A.zeroLength?e.splice(E,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(E,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const g=this.width*this.nextRow;let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const A=Math.abs(E-x.left),M=Math.abs(E-x.right),P=Math.min(A,M);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const h=i==="round",g=h?7:0,_=2*g+1;if(this.nextRow+_>this.height)return Ki("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let M=0;M<e.length;M++)e[M]<0&&(Ki("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),x+=e[M];if(x!==0){const M=this.width/x,P=this.getDashRanges(e,this.width,M);h?this.addRoundDash(P,M,g):this.addRegularDash(P,i==="square"?.5*M:0)}const E=this.nextRow+g;this.nextRow+=_;const A={tl:[E,g],br:[x,0]};return this.positions[a]=A,A}}Xt(oS,"LineAtlas");const ID=Tt.types,CD=Math.cos(Math.PI/180*37.5),RD=Math.cos(Math.PI/180*5);class G1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Lf,this.layoutVertexArray2=new Po,this.patternVertexArray=new Po,this.indexArray=new gs,this.programConfigurations=new gl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Er,this.maxLineLength=0,this.zOffsetVertexArray=new Po,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Bt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,h){this.hasPattern=A_("line",this.layers,this.pixelRatio,i);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=qe(a);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),B=L.isConstant()&&!L.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&_==="none"&&Ki(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const E=[];for(const{feature:L,id:B,index:V,sourceLayerIndex:Z}of e){const K=this.layers[0]._featureFilter.needGeometry,Q=Mt(L,K);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),Q,a))continue;const oe=g?g.evaluate(Q,{},a):void 0,le={id:B,properties:L.properties,type:L.type,sourceLayerIndex:Z,index:V,geometry:K?Q.geometry:Yt(L,a,h),patterns:{},sortKey:oe};E.push(le)}g&&E.sort(((L,B)=>L.sortKey-B.sortKey));const{lineAtlas:A,featureIndex:M}=i,P=this.addConstantDashes(A);for(const L of E){const{geometry:B,index:V,sourceLayerIndex:Z}=L;if(P&&this.addFeatureDashes(L,A),this.hasPattern){const K=I_("line",this.layers,L,this.zoom,this.pixelRatio,i);this.patternFeatures.push(K)}else this.addFeature(L,B,V,a,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[V].feature,B,V,Z,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,g=a.layout.get("line-cap").value;if(h.kind!=="constant"||g.kind!=="constant")i=!0;else{const _=g.value,x=h.value;if(!x)continue;e.addDash(x,_)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let x,E;if(g.kind==="constant"){if(x=g.value,!x)continue}else x=g.evaluate({zoom:a},e);E=_.kind==="constant"?_.value:_.evaluate({zoom:a},e),i.addDash(x,E),e.patterns[h.id]=[i.getKey(x,E)]}}update(e,i,a,h,g,_,x,E){this.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,E)}addFeatures(e,i,a,h,g,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,h,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ED)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,AD)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,bD.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wD),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,h;if(i&&i>0?(a=`mapbox_clip_start_${i}`,h=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",h="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(h))return{start:+e.properties[a],end:+e.properties[h]}}addFeature(e,i,a,h,g,_,x,E){const A=this.layers[0].layout,M=A.get("line-join").evaluate(e,{}),P=A.get("line-cap").evaluate(e,{}),L=A.get("line-miter-limit"),B=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const V=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if(Z.kind!=="constant"&&Z.isLineProgressConstant===!1&&(this.variableWidthValue=Z),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,E,M,P,L,B)){const[Q,oe]=this.clipRuntimeLinesToTile(i,1);for(let le=0;le<Q.length;le++){const he=Q[le],Ee=oe[le],Se={progress:{min:Ee.progress.min,max:Ee.progress.max},nextDir:this.computeSegNextDir(Ee,he),prevDir:this.computeSegPrevDir(Ee,he)};this.addLine(he,e,h,M,P,L,B,Se,V&&Ee.parentIndex>0?Ee.parentIndex:null)}this.fillNonElevatedRoadSegment(K)}}else for(let K=0;K<i.length;K++)this.addLine(i[K],e,h,M,P,L,B,void 0,V&&K>0?K:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,_,h,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return H_(e,-i,-i,Bt+i,Bt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[H_(e,-i,-i,Bt+i,Bt+i,a),a]}addElevatedRoadFeature(e,i,a,h,g,_,x,E){const A=[],M=fr.getElevationFeature(e,h);if(M){const P=this.clipLinesToTile(i,1),L=this.prepareElevatedLines(P,M,a);for(const B of L)A.push({geometry:B,elevation:M,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const P of A){const L=this.layoutVertexArray.length;this.addLine(P.geometry,e,a,g,_,x,E);const B=new as(a,P.elevationTileID);if(P.elevation)for(let V=L;V<this.layoutVertexArray.length;V++){const Z=new Ct(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),K=B.pointElevation(Z,P.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const h=[],g=1/qe(a);for(const _ of e)c0(_,new yn(i,g),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,h,g,_,x,E,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const M=h==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=E&&E.progress.min>0,L=E&&E.progress.max<1;if(this.lineClips){let Ne={min:this.lineClips.start,max:this.lineClips.end},ft=1;if(E){const It=this.lineClips.end-this.lineClips.start;Ne=(function(vt,Et,Ot){return{min:ba(vt.min,Et,Ot),max:ba(vt.max,Et,Ot)}})(E.progress,{min:0,max:1},Ne),It>0&&(ft=(Ne.max-Ne.min)/It)}const je=+i.properties.mapbox_clip_feature_len,mt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(je)||Number.isNaN(mt)){for(let vt=0;vt<e.length-1;vt++)this.totalDistance+=e[vt].dist(e[vt+1]);const It=this.totalDistance/(Ne.max-Ne.min);this.totalFeatureLength=Number.isFinite(It)?It:0,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=je,this.distance=mt*ft,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=ID[i.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let Z=0;for(;Z<V-1&&e[Z].equals(e[Z+1]);)Z++;if(V<(B?3:2))return;h==="bevel"&&(_=1.05);const K=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let Q,oe,le,he,Ee,Se,Me,De;E&&E.prevDir&&(Se=E.prevDir.perp()),E&&E.nextDir&&(Me=E.nextDir.perp()),this.e1=this.e2=-1,B&&(Q=e[V-2],Ee=e[Z].sub(Q)._unit()._perp());for(let Ne=Z;Ne<V;Ne++){if(le=Ne===V-1?B?e[Z+1]:void 0:e[Ne+1],le&&e[Ne].equals(le))continue;Ee&&(he=Ee),Q&&(oe=Q),Q=e[Ne],De=this.evaluateLineProgressFeatures(oe?oe.dist(Q):0),Ee=le?le.sub(Q)._unit()._perp():he,he=he||Ee;const ft=oe&&le;let je=ft?h:B||M?"butt":g;const mt=he.x*Ee.x+he.y*Ee.y;if(M){const Je=function(kt){if(kt.patternJoinNone){const Dt=kt.segmentPoints.length/2,xi=kt.lineSoFar-kt.segmentStart;for(let ii=0;ii<Dt;++ii){const hi=kt.segmentPoints[2*ii+1],Ut=Math.round(kt.segmentPoints[2*ii])+.5+.25*hi;kt.patternVertexArray.emplaceBack(Ut,xi,kt.segmentStart),kt.patternVertexArray.emplaceBack(Ut,xi,kt.segmentStart)}kt.segmentPoints.length=0}kt.e1=kt.e2=-1};if(ft&&mt<RD){this.updateDistance(oe,Q),this.addCurrentVertex(Q,he,1,1,K,De),Je(this),this.addCurrentVertex(Q,Ee,-1,-1,K,De);continue}if(oe){if(!le){this.updateDistance(oe,Q),this.addCurrentVertex(Q,he,1,1,K,De),Je(this);continue}je="miter"}}let It=he.add(Ee);It.x===0&&It.y===0||It._unit();const vt=It.x*Ee.x+It.y*Ee.y,Et=vt!==0?1/vt:1/0,Ot=2*Math.sqrt(2-2*vt),ut=vt<CD&&oe&&le,St=he.x*Ee.y-he.y*Ee.x>0,rt=this.overscaling<=16?15*Bt/(512*this.overscaling):0;if(ft&&je==="round"){if(Et<x)je="miter";else if(Et<=2){const Je=q1(Q,-10,Bt+10);je=this.elevationType==="offset"&&(Je||this.hasCrossSlope)?"miter":"fakeround"}}if(je==="miter"&&Et>_&&(je="bevel"),je==="bevel"&&(Et>2&&(je="flipbevel"),Et<_&&(je="miter")),oe&&!(je==="miter"&&ut)&&this.updateDistance(oe,Q),je==="miter")if(ut){const Je=Q.dist(oe);if(Je>2*rt){const Dt=Q.sub(Q.sub(oe)._mult(rt/Je)._round());this.updateDistance(oe,Dt),this.addCurrentVertex(Dt,he,0,0,K,De),oe=Dt}this.updateDistance(oe,Q),It._mult(Et),this.addCurrentVertex(Q,It,0,0,K,De);const kt=Q.dist(le);if(kt>2*rt){const Dt=Q.add(le.sub(Q)._mult(rt/kt)._round());this.updateDistance(Q,Dt),this.addCurrentVertex(Dt,Ee,0,0,K,De),Q=Dt}}else It._mult(Et),this.addCurrentVertex(Q,It,0,0,K,De);else if(je==="flipbevel"){if(Et>100)It=Ee.mult(-1);else{const Je=Et*he.add(Ee).mag()/he.sub(Ee).mag();It._perp()._mult(Je*(St?-1:1))}this.addCurrentVertex(Q,It,0,0,K,De),this.addCurrentVertex(Q,It.mult(-1),0,0,K,De)}else if(je==="bevel"||je==="fakeround"){De!=null&&oe&&this.addCurrentVertex(Q,Me||he,-1,-1,K,De);const Je=Q.dist(oe)<=2*rt&&je!=="bevel",kt=It.mult(St?1:-1);kt._mult(Et);const Dt=Ee.mult(St?-1:1),xi=he.mult(St?-1:1),ii=this.evaluateLineProgressFeatures(this.distance);if(De==null&&(this.addHalfVertex(Q,kt.x,kt.y,!1,!St,0,K,ii),Je||this.addHalfVertex(Q,kt.x+2*xi.x,kt.y+2*xi.y,!1,St,0,K,ii)),je==="fakeround"){const hi=Math.round(180*Ot/Math.PI/20);this.addHalfVertex(Q,xi.x,xi.y,!1,St,0,K,ii);for(let Ut=0;Ut<hi;Ut++){let yi=Ut/hi;if(yi!==.5){const Zt=yi-.5;yi+=yi*Zt*(yi-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*Zt*Zt+(.848013+mt*(.215638*mt-1.06021)))}const ji=Dt.sub(xi)._mult(yi)._add(xi)._unit();this.addHalfVertex(Q,ji.x,ji.y,!1,St,0,K,ii)}this.addHalfVertex(Q,Dt.x,Dt.y,!1,St,0,K,ii)}Je||De!=null||this.addHalfVertex(Q,kt.x+2*Dt.x,kt.y+2*Dt.y,!1,St,0,K,ii),De!=null&&le&&this.addCurrentVertex(Q,Se||Ee,1,1,K,De)}else if(je==="butt")this.addCurrentVertex(Q,It,0,0,K,De);else if(je==="square"){if(!oe){const Je=P?0:-1;this.addCurrentVertex(Q,It,Je,Je,K,De)}if(this.addCurrentVertex(Q,It,0,0,K,De),oe){const Je=L?0:1;this.addCurrentVertex(Q,It,Je,Je,K,De)}}else if(je==="round"){if(oe){const Je=!ft&&Me?Me:he;this.addCurrentVertex(Q,Je,0,0,K,De),!ft&&L||this.addCurrentVertex(Q,Je,1,1,K,De,!0)}if(le){const Je=!ft&&Se?Se:Ee;!ft&&P||this.addCurrentVertex(Q,Je,-1,-1,K,De,!0),this.addCurrentVertex(Q,Je,0,0,K,De)}}}}addVerticesTo(e,i,a,h,g,_,x,E,A,M){const P=(i.w-e.w)/this.tessellationStep|0;let L=0;const B=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const Z=(i.x-e.x)/P,K=(i.y-e.y)/P,Q=(i.z-e.z)/P,oe=(i.w-e.w)/P;for(let le=1;le<P;++le){e.x+=Z,e.y+=K,e.z+=Q,this.lineSoFar+=oe,L+=oe;const he=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(e,a,h,M,!1,x,A,he),this.addHalfVertex(e,g,_,M,!0,-E,A,he)}}this.lineSoFar=i.w,this.scaledDistance=B;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,h,M,!1,x,A,V),this.addHalfVertex(i,g,_,M,!0,-E,A,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ki(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,h,g,_,x=!1){const E=i.x+i.y*a,A=i.y-i.x*a,M=i.y*h-i.x,P=-i.y-i.x*h;if(_!=null){const L=this.elevationType==="offset",B=-10,V=Bt+10,Z=_.zOffset,K=new l0(e.x,e.y,Z,this.lineSoFar),Q=!!L&&q1(e,B,V),oe=this.lineSoFar,le=this.distance;if(this.currentVertex)if(Q){const he=this.currentVertexIsOutside,Ee=this.currentVertex,Se=new l0(e.x,e.y,Z,this.lineSoFar);if(tm(Ee,Se,B,V),!q1(Se,B,V)){if(he){this.e1=this.e2=-1,this.distance-=Ee.dist(K),this.lineSoFar=Ee.w;const Me=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,E,A,x,!1,a,g,Me),this.addHalfVertex(Ee,M,P,x,!0,-h,g,Me),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(Se),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,Se,E,A,M,P,a,h,g,x),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){tm(he,K,B,V),this.e1=this.e2=-1,this.distance-=he.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const Ee=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,E,A,x,!1,a,g,Ee),this.addHalfVertex(he,M,P,x,!0,-h,g,Ee),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,K,E,A,M,P,a,h,g,x)}else Q||(this.addHalfVertex(e,E,A,x,!1,a,g,_),this.addHalfVertex(e,M,P,x,!0,-h,g,_));this.currentVertex=K,this.currentVertexIsOutside=Q,this.lineSoFar=oe}else this.addHalfVertex(e,E,A,x,!1,a,g,_),this.addHalfVertex(e,M,P,x,!0,-h,g,_)}addHalfVertex({x:e,y:i},a,h,g,_,x,E,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(i<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Ii(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),_?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function q1(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let aS,lS;function cS(r,e,i){return e*(Bt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Xt(G1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const uS=(r,e,i)=>(1-i)*r+i*e;function hS(r,e){return 1/cS(r,1,e.tileZoom)}function dS(r,e,i,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const fS=r=>{const e=[];pS(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=r.layout.get("line-join").constantOr("miter")==="none",h=!!r.paint.get("line-pattern").constantOr(1);return a&&h&&e.push("LINE_JOIN_NONE"),e};function pS(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let H1;const mS=()=>H1||(H1={layout:aS||(aS=new Or({"line-cap":new $t(Be.layout_line["line-cap"]),"line-join":new $t(Be.layout_line["line-join"]),"line-miter-limit":new Lt(Be.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Be.layout_line["line-round-limit"]),"line-sort-key":new $t(Be.layout_line["line-sort-key"]),"line-z-offset":new $t(Be.layout_line["line-z-offset"]),"line-elevation-reference":new Lt(Be.layout_line["line-elevation-reference"]),"line-cross-slope":new Lt(Be.layout_line["line-cross-slope"]),visibility:new Lt(Be.layout_line.visibility),"line-width-unit":new Lt(Be.layout_line["line-width-unit"])})),paint:lS||(lS=new Or({"line-opacity":new $t(Be.paint_line["line-opacity"]),"line-color":new $t(Be.paint_line["line-color"]),"line-translate":new Lt(Be.paint_line["line-translate"]),"line-translate-anchor":new Lt(Be.paint_line["line-translate-anchor"]),"line-width":new $t(Be.paint_line["line-width"]),"line-gap-width":new $t(Be.paint_line["line-gap-width"]),"line-offset":new $t(Be.paint_line["line-offset"]),"line-blur":new $t(Be.paint_line["line-blur"]),"line-dasharray":new $t(Be.paint_line["line-dasharray"]),"line-pattern":new $t(Be.paint_line["line-pattern"]),"line-pattern-cross-fade":new Lt(Be.paint_line["line-pattern-cross-fade"]),"line-gradient":new Eh(Be.paint_line["line-gradient"]),"line-trim-offset":new Lt(Be.paint_line["line-trim-offset"]),"line-trim-fade-range":new Lt(Be.paint_line["line-trim-fade-range"]),"line-trim-color":new Lt(Be.paint_line["line-trim-color"]),"line-emissive-strength":new Lt(Be.paint_line["line-emissive-strength"]),"line-border-width":new $t(Be.paint_line["line-border-width"]),"line-border-color":new $t(Be.paint_line["line-border-color"]),"line-occlusion-opacity":new Lt(Be.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},H1);class MD extends $t{possiblyEvaluate(e,i){return i=new Xn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,h){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,h)}}let gv;function gS(r,e){return e>0?e+2*r:r}const PD=pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),DD=pn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),OD=pn([{name:"a_projected_pos",components:4,type:"Float32"}],4);pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const LD=pn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),zD=pn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),kD=pn([{name:"a_texb",components:2,type:"Uint16"}]),ND=pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),FD=pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _S=pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),BD=pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);pn([{name:"triangle",components:3,type:"Uint16"}]),pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),pn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),pn([{type:"Float32",name:"offsetX"}]),pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var yo=24;function VD(r,e,i){return r.sections.forEach((a=>{a.text=(function(h,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Wr.applyArabicShaping&&(h=Wr.applyArabicShaping(h)),h})(a.text,e,i)})),r}const _v={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function UD(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function jD(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const W1=4294967296,yS=1/W1,vS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let g0=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,r(h,e,this),this.pos===g&&this.skip(a)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*W1;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*W1;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,(function(h,g,_){const x=_.buf;let E,A;if(A=x[_.pos++],E=(112&A)>>4,A<128||(A=x[_.pos++],E|=(127&A)<<3,A<128)||(A=x[_.pos++],E|=(127&A)<<10,A<128)||(A=x[_.pos++],E|=(127&A)<<17,A<128)||(A=x[_.pos++],E|=(127&A)<<24,A<128)||(A=x[_.pos++],E|=(1&A)<<31,A<128))return Z_(h,E,g);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&vS?vS.decode(this.buf.subarray(e,r)):(function(i,a,h){let g="",_=a;for(;_<h;){const x=i[_];let E,A,M,P=null,L=x>239?4:x>223?3:x>191?2:1;if(_+L>h)break;L===1?x<128&&(P=x):L===2?(E=i[_+1],(192&E)==128&&(P=(31&x)<<6|63&E,P<=127&&(P=null))):L===3?(E=i[_+1],A=i[_+2],(192&E)==128&&(192&A)==128&&(P=(15&x)<<12|(63&E)<<6|63&A,(P<=2047||P>=55296&&P<=57343)&&(P=null))):L===4&&(E=i[_+1],A=i[_+2],M=i[_+3],(192&E)==128&&(192&A)==128&&(192&M)==128&&(P=(15&x)<<18|(63&E)<<12|(63&A)<<6|63&M,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,L=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),_+=L}return g})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*yS),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*yS),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(a=~(-e%4294967296),h=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(g,_,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)})(a,0,i),(function(g,_){const x=(7&g)<<4;_.buf[_.pos++]|=x|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))})(h,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(a,h,g){for(let _,x,E=0;E<h.length;E++){if(_=h.charCodeAt(E),_>55295&&_<57344){if(!x){_>56319||E+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):x=_;continue}if(_<56320){a[g++]=239,a[g++]=191,a[g++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(a[g++]=239,a[g++]=191,a[g++]=189,x=null);_<128?a[g++]=_:(_<2048?a[g++]=_>>6|192:(_<65536?a[g++]=_>>12|224:(a[g++]=_>>18|240,a[g++]=_>>12&63|128),a[g++]=_>>6&63|128),a[g++]=63&_|128)}return g})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&xS(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const a=this.pos-i;a>=128&&xS(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,GD,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,qD,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,$D,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,HD,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,WD,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,ZD,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,XD,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,YD,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,KD,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function Z_(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function xS(r,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let h=i.pos-1;h>=r;h--)i.buf[h+a]=i.buf[h]}function GD(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function qD(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function HD(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function WD(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function $D(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function ZD(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function XD(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function YD(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function KD(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const $1=3;function QD(r,e,i){e.glyphs=[],r===1&&i.readMessage(JD,e)}function JD(r,e,i){if(r===3){const{id:a,bitmap:h,width:g,height:_,left:x,top:E,advance:A}=i.readMessage(eO,{});e.glyphs.push({id:a,bitmap:new Lc({width:g+2*$1,height:_+2*$1},h),metrics:{width:g,height:_,left:x,top:E,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function eO(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const bS=$1,nc={horizontal:1,vertical:2,horizontalOnly:3};class yv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new yv;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new yv;return i.image=e,i}}class X_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const h=new X_;for(let g=0;g<e.sections.length;g++){const _=e.sections[g];_.image?h.addImageSection(_,a):h.addTextSection(_,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,a){let h="";for(let g=0;g<i.length;g++){const _=i.charCodeAt(g+1)||null,x=i.charCodeAt(g-1)||null;h+=!a&&(_&&wh(_)&&!_v[i[g+1]]||x&&wh(x)&&!_v[i[g-1]])||!_v[i[g]]?i[g]:_v[i[g]]}return h})(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&_0[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&_0[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new X_;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(yv.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Ki("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(yv.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Z1(r,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z=1){const K=X_.fromFeature(r,h,Z);P===nc.vertical&&K.verticalizePunctuation(L);let Q=[];const oe=(function(Me,De,Ne,ft,je,mt){if(!Me)return[];const It=[],vt=(function(St,rt,Je,kt,Dt,xi){let ii=0;for(let hi=0;hi<St.length();hi++){const Ut=St.getSection(hi);ii+=wS(St.getCodePoint(hi),Ut,kt,Dt,rt,xi)}return ii/Math.max(1,Math.ceil(ii/Je))})(Me,De,Ne,ft,je,mt),Et=Me.text.indexOf("")>=0;let Ot=0;for(let St=0;St<Me.length();St++){const rt=Me.getSection(St),Je=Me.getCodePoint(St);if(_0[Je]||(Ot+=wS(Je,rt,ft,je,De,mt)),St<Me.length()-1){const kt=!((ut=Je)<11904||!(si["Bopomofo Extended"](ut)||si.Bopomofo(ut)||si["CJK Compatibility Forms"](ut)||si["CJK Compatibility Ideographs"](ut)||si["CJK Compatibility"](ut)||si["CJK Radicals Supplement"](ut)||si["CJK Strokes"](ut)||si["CJK Symbols and Punctuation"](ut)||si["CJK Unified Ideographs Extension A"](ut)||si["CJK Unified Ideographs"](ut)||si["Enclosed CJK Letters and Months"](ut)||si["Halfwidth and Fullwidth Forms"](ut)||si.Hiragana(ut)||si["Ideographic Description Characters"](ut)||si["Kangxi Radicals"](ut)||si["Katakana Phonetic Extensions"](ut)||si.Katakana(ut)||si["Vertical Forms"](ut)||si["Yi Radicals"](ut)||si["Yi Syllables"](ut)));(tO[Je]||kt||rt.image)&&It.push(ES(St+1,Ot,vt,It,iO(Je,Me.getCodePoint(St+1),kt&&Et),!1))}}var ut;return SS(ES(Me.length(),Ot,vt,It,0,!0))})(K,A,g,e,a,B),{processBidirectionalText:le,processStyledBidirectionalText:he}=Wr;if(le&&K.sections.length===1){const Me=le(K.toString(),oe);for(const De of Me){const Ne=new X_;Ne.text=De,Ne.sections=K.sections;for(let ft=0;ft<De.length;ft++)Ne.sectionIndex.push(0);Q.push(Ne)}}else if(he){const Me=he(K.text,K.sectionIndex,oe);for(const De of Me){const Ne=new X_;Ne.text=De[0],Ne.sectionIndex=De[1],Ne.sections=K.sections,Q.push(Ne)}}else Q=(function(Me,De){const Ne=[],ft=Me.text;let je=0;for(const mt of De)Ne.push(Me.substring(je,mt)),je=mt;return je<ft.length&&Ne.push(Me.substring(je,ft.length)),Ne})(K,oe);const Ee=[],Se={positionedLines:Ee,text:K.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Me,De,Ne,ft,je,mt,It,vt,Et,Ot,ut,St){let rt=0,Je=0,kt=0;const Dt=vt==="right"?1:vt==="left"?0:.5;let xi=!1;for(const Zt of je){const pi=Zt.getSections();for(const Di of pi){if(Di.image)continue;const $i=De[Di.fontStack];if($i&&(xi=$i.ascender!==void 0&&$i.descender!==void 0,!xi))break}if(!xi)break}let ii=0;for(const Zt of je){Zt.trim();const pi=Zt.getMaxScale(),Di=(pi-1)*yo,$i={positionedGlyphs:[],lineOffset:0};Me.positionedLines[ii]=$i;const rn=$i.positionedGlyphs;let Yi=0;if(!Zt.length()){Je+=mt,++ii;continue}let oi=0,Zi=0;for(let fe=0;fe<Zt.length();fe++){const pe=Zt.getSection(fe),it=Zt.getSectionIndex(fe),dt=Zt.getCodePoint(fe);let Wt=pe.scale,Ht=null,ri=null,Ti=null,sn=yo,an=0,tn=Et;tn===nc.vertical&&((hi=dt)===12312||hi===12313||hi===12316||hi===12540||hi===12448)&&(tn=nc.horizontal);const Hn=!(tn===nc.horizontal||!ut&&!Rc(dt)||ut&&(_0[dt]||Rf(dt)));if(pe.image){const Pr=ft.get(pe.image.toString());if(!Pr)continue;Ti=pe.image,Me.iconsInText=Me.iconsInText||!0,ri=Pr.paddedRect;const en=Pr.displaySize;Wt=Wt*yo/St,Ht={width:en[0],height:en[1],left:0,top:-bS,advance:Hn?en[1]:en[0],localGlyph:!1},an=xi?-Ht.height*Wt:pi*yo-17-en[1]*Wt,sn=Ht.advance;const gr=(Hn?en[0]:en[1])*Wt-yo*pi;gr>0&&gr>Yi&&(Yi=gr)}else{const Pr=Ne[pe.fontStack];if(!Pr)continue;Pr[dt]&&(ri=Pr[dt]);const en=De[pe.fontStack];if(!en)continue;const gr=en.glyphs[dt];if(!gr)continue;if(Ht=gr.metrics,sn=dt!==8203?yo:0,xi){const Yn=en.ascender!==void 0?Math.abs(en.ascender):0,kn=en.descender!==void 0?Math.abs(en.descender):0,xr=(Yn+kn)*Wt;oi<xr&&(oi=xr,Zi=(Yn-kn)/2*Wt),an=-Yn*Wt}else an=(pi-Wt)*yo-17}Hn?(Me.verticalizable=!0,rn.push({glyph:dt,image:Ti,x:rt,y:Je+an,vertical:Hn,scale:Wt,localGlyph:Ht.localGlyph,fontStack:pe.fontStack,sectionIndex:it,metrics:Ht,rect:ri}),rt+=sn*Wt+Ot):(rn.push({glyph:dt,image:Ti,x:rt,y:Je+an,vertical:Hn,scale:Wt,localGlyph:Ht.localGlyph,fontStack:pe.fontStack,sectionIndex:it,metrics:Ht,rect:ri}),rt+=Ht.advance*Wt+Ot)}rn.length!==0&&(kt=Math.max(rt-Ot,kt),xi?AS(rn,Dt,Yi,Zi,mt*pi/2):AS(rn,Dt,Yi,0,mt/2)),rt=0;const An=mt*pi+Yi;$i.lineOffset=Math.max(Yi,Di),Je+=An,++ii}var hi;const Ut=Je,{horizontalAlign:yi,verticalAlign:ji}=X1(It);(function(Zt,pi,Di,$i,rn,Yi){const oi=(pi-Di)*rn,Zi=-Yi*$i;for(const An of Zt)for(const fe of An.positionedGlyphs)fe.x+=oi,fe.y+=Zi})(Me.positionedLines,Dt,yi,ji,kt,Ut),Me.top+=-ji*Ut,Me.bottom=Me.top+Ut,Me.left+=-yi*kt,Me.right=Me.left+kt,Me.hasBaseline=xi})(Se,e,i,a,Q,_,x,E,P,A,L,V),!(function(Me){for(const De of Me)if(De.positionedGlyphs.length!==0)return!1;return!0})(Ee))return Se}const _0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wS(r,e,i,a,h,g){if(e.image){const _=a.get(e.image.toString());return _?_.displaySize[0]*e.scale*yo/g+h:0}{const _=i[e.fontStack],x=_&&_.glyphs[r];return x?x.metrics.advance*e.scale+h:0}}function TS(r,e,i,a){const h=Math.pow(r-e,2);return a?r<e?h/2:2*h:h+Math.abs(i)*i}function iO(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function ES(r,e,i,a,h,g){let _=null,x=TS(e,i,h,g);for(const E of a){const A=TS(e-E.x,i,h,g)+E.badness;A<=x&&(_=E,x=A)}return{index:r,x:e,priorBreak:_,badness:x}}function SS(r){return r?SS(r.priorBreak).concat(r.index):[]}function X1(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function AS(r,e,i,a,h){if(!(e||i||a||h))return;const g=r.length-1,_=r[g],x=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=g;E++)r[E].x-=x,r[E].y+=i+a+h}function IS(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function nO(r,e,i,a){const{horizontalAlign:h,verticalAlign:g}=X1(a),_=i[0]-r.displaySize[0]*h,x=i[1]-r.displaySize[1]*g;return{imagePrimary:r,imageSecondary:e,top:x,bottom:x+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function CS(r,e,i,a,h,g){const _=r.imagePrimary;let x;if(_.content){const K=_.content,Q=_.pixelRatio||1;x=[K[0]/Q,K[1]/Q,_.displaySize[0]-K[2]/Q,_.displaySize[1]-K[3]/Q]}const E=e.left*g,A=e.right*g;let M,P,L,B;i==="width"||i==="both"?(B=h[0]+E-a[3],P=h[0]+A+a[1]):(B=h[0]+(E+A-_.displaySize[0])/2,P=B+_.displaySize[0]);const V=e.top*g,Z=e.bottom*g;return i==="height"||i==="both"?(M=h[1]+V-a[0],L=h[1]+Z+a[2]):(M=h[1]+(V+Z-_.displaySize[1])/2,L=M+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:M,right:P,bottom:L,left:B,collisionPadding:x}}function RS(r){return!r.imagePrimary.stretchX}function MS(r){return!r.imagePrimary.stretchY}function PS(r){return{width:r.right-r.left,height:r.bottom-r.top}}const Yd=128;function DS(r,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Xn(r+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=a;let _=0;for(;_<h.length&&h[_]<=r;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<r+1;)x++;x=Math.min(h.length-1,x);const E=h[_],A=h[x];return a.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:A,minSize:a.evaluate(new Xn(E,{worldview:i})),maxSize:a.evaluate(new Xn(A,{worldview:i})),interpolationType:g}}}function Y1(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/Yd:r.kind==="composite"?Ii(a/Yd,h/Yd,i):e}function vv(r,e,i=1){let a=0,h=0;if(r.kind==="constant")h=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:x}=r,E=g?Ie(Ba.interpolationFactor(g,e,_,x),0,1):0;r.kind==="camera"?h=Ii(r.minSize,r.maxSize,E)*i:a=E*i}return{uSizeT:a,uSize:h}}class Xf extends Ct{constructor(e,i,a,h,g){super(e,i),this.angle=h,this.z=a,g!==void 0&&(this.segment=g)}clone(){return new Xf(this.x,this.y,this.z,this.angle,this.segment)}}function OS(r,e,i,a,h){if(e.segment===void 0)return!0;let g=e,_=e.segment+1,x=0;for(;x>-i/2;){if(_--,_<0)return!1;x-=r[_].dist(g),g=r[_]}x+=r[_].dist(r[_+1]),_++;const E=[];let A=0;for(;x<i/2;){const M=r[_],P=r[_+1];if(!P)return!1;let L=r[_-1].angleTo(M)-M.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:L}),A+=L;x-E[0].distance>a;)A-=E.shift().angleDelta;if(A>h)return!1;_++,x+=M.dist(P)}return!0}function LS(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function zS(r,e,i){return r?.6*e*i:0}function kS(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function rO(r,e,i,a,h,g){const _=zS(i,h,g),x=kS(i,a)*g;let E=0;const A=LS(r)/2;for(let M=0;M<r.length-1;M++){const P=r[M],L=r[M+1],B=P.dist(L);if(E+B>A){const V=(A-E)/B,Z=Ii(P.x,L.x,V),K=Ii(P.y,L.y,V),Q=new Xf(Z,K,0,L.angleTo(P),M);return!_||OS(r,Q,x,_,e)?Q:void 0}E+=B}}function sO(r,e,i,a,h,g,_,x,E){const A=zS(a,g,_),M=kS(a,h),P=M*_,L=r[0].x===0||r[0].x===E||r[0].y===0||r[0].y===E;return e-P<e/4&&(e=P+e/4),NS(r,L?e/2*x%e:(M/2+2*g)*_*x%e,e,A,i,P,L,!1,E)}function NS(r,e,i,a,h,g,_,x,E){const A=g/2,M=LS(r);let P=0,L=e-i,B=[];for(let V=0;V<r.length-1;V++){const Z=r[V],K=r[V+1],Q=Z.dist(K),oe=K.angleTo(Z);for(;L+i<P+Q;){L+=i;const le=(L-P)/Q,he=Ii(Z.x,K.x,le),Ee=Ii(Z.y,K.y,le);if(he>=0&&he<E&&Ee>=0&&Ee<E&&L-A>=0&&L+A<=M){const Se=new Xf(he,Ee,0,oe,V);a&&!OS(r,Se,g,a,h)||B.push(Se)}}P+=Q}return x||B.length||_||(B=NS(r,P/2,i,a,h,g,_,!0,E)),B}function FS(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort(((_,x)=>x.h-_.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,g=0;for(const _ of r)for(let x=a.length-1;x>=0;x--){const E=a[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===E.w&&_.h===E.h){const A=a.pop();A&&x<a.length&&(a[x]=A)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(a.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}Xt(Xf,"Anchor");const zg=1;class xv{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:a,y:a}}constructor(e,i,a,h){this.paddedRect=e;const{pixelRatio:g,version:_,stretchX:x,stretchY:E,content:A,sdf:M,usvg:P}=i;this.pixelRatio=g,this.stretchX=x,this.stretchY=E,this.content=A,this.version=_,this.padding=a,this.sdf=M,this.usvg=P,this.scale=xv.getImagePositionScale(h,P,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function K1(r,e,i){const a=Us.parse(r),h=(function(g,_,x=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*x[0])+2*_,h:(g.data?g.data.height:g.height*x[1])+2*_}})(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:h,imagePosition:new xv(h,e,i,a),imageVariant:a}}class BS{constructor(e,i,a){const h=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,h,zg,_),this.addImages(i,g,2,_);const{w:x,h:E}=FS(_),A=new _o({width:x||1,height:E||1});for(const[M,P]of e.entries()){const L=h.get(M).paddedRect;_o.copy(P.data,A,{x:0,y:0},{x:L.x+zg,y:L.y+zg},P.data,null,P.sdf)}for(const[M,P]of i.entries()){const L=g.get(M),B=L.paddedRect;let V=L.padding;const Z=B.x+V,K=B.y+V,Q=P.data.width,oe=P.data.height;V=V>1?V-1:V,_o.copy(P.data,A,{x:0,y:0},{x:Z,y:K},P.data,a),_o.copy(P.data,A,{x:0,y:oe-V},{x:Z,y:K-V},{width:Q,height:V},a),_o.copy(P.data,A,{x:0,y:0},{x:Z,y:K+oe},{width:Q,height:V},a),_o.copy(P.data,A,{x:Q-V,y:0},{x:Z-V,y:K},{width:V,height:oe},a),_o.copy(P.data,A,{x:0,y:0},{x:Z+Q,y:K},{width:V,height:oe},a),_o.copy(P.data,A,{x:Q-V,y:oe-V},{x:Z-V,y:K-V},{width:V,height:V},a),_o.copy(P.data,A,{x:0,y:oe-V},{x:Z+Q,y:K-V},{width:V,height:V},a),_o.copy(P.data,A,{x:0,y:0},{x:Z+Q,y:K+oe},{width:V,height:V},a),_o.copy(P.data,A,{x:Q-V,y:0},{x:Z-V,y:K+oe},{width:V,height:V},a)}this.lut=a,this.image=A,this.iconPositions=h,this.patternPositions=g}addImages(e,i,a,h){for(const[g,_]of e.entries()){const{bin:x,imagePosition:E,imageVariant:A}=K1(g,_,a);i.set(g,E),h.push(x),_.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>e.hasImage(h,a))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const h of e.getUpdatedImages(a)){for(const g of this.iconPositions.keys()){const _=Us.parse(g);if(So.isEqual(_.id,h)){const x=e.getImage(h,a);this.patchUpdatedImage(this.iconPositions.get(g),x,i,null)}}for(const g of this.patternPositions.keys()){const _=Us.parse(g);if(So.isEqual(_.id,h)){const x=e.getImage(h,a);this.patchUpdatedImage(this.patternPositions.get(g),x,i,this.lut)}}}}patchUpdatedImage(e,i,a,h=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[g,_]=e.tl,x=e.sdf;if(this.lut||x){const E={width:i.data.width,height:i.data.height},A=new _o(E);_o.copy(i.data,A,{x:0,y:0},{x:0,y:0},E,h,x),a.update(A,{position:{x:g,y:_}})}else a.update(i.data,{position:{x:g,y:_}})}}Xt(xv,"ImagePosition"),Xt(BS,"ImageAtlas");const bv=1e20;function VS(r,e,i,a,h,g,_,x,E){for(let A=e;A<e+a;A++)US(r,i*g+A,g,h,_,x,E);for(let A=i;A<i+h;A++)US(r,A*g+e,1,a,_,x,E)}function US(r,e,i,a,h,g,_){g[0]=0,_[0]=-bv,_[1]=bv,h[0]=r[e];for(let x=1,E=0,A=0;x<a;x++){h[x]=r[e+x*i];const M=x*x;do{const P=g[E];A=(h[x]-h[P]+M-P*P)/(x-P)/2}while(A<=_[E]&&--E>-1);E++,g[E]=x,_[E]=A,_[E+1]=bv}for(let x=0,E=0;x<a;x++){for(;_[E+1]<x;)E++;const A=g[E],M=x-A;r[e+x*i]=h[A]+M*M}}const Wh=2,Q1={none:0,ideographs:1,all:2};class Y_{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],h=this.url||Kr.GLYPHS_URL;for(const g in e)for(const _ of e[g])a.push({stack:g,id:_});Xe(a,(({stack:g,id:_},x)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=E.glyphs[_];if(A!==void 0)return void x(null,{stack:g,id:_,glyph:A});if(A=this._tinySDF(E,g,_),A)return E.glyphs[_]=A,void x(null,{stack:g,id:_,glyph:A});const M=Math.floor(_/256);if(256*M>65535)return Ki("glyphs > 65535 not supported"),void x(null,{stack:g,id:_,glyph:A});if(E.ranges[M])return void x(null,{stack:g,id:_,glyph:A});let P=E.requests[M];P||(P=E.requests[M]=[],Y_.loadGlyphRange(g,M,h,this.requestManager,((L,B)=>{if(B){E.ascender=B.ascender,E.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=B.glyphs[+V]);E.ranges[M]=!0}for(const V of P)V(L,B);delete E.requests[M]}))),P.push(((L,B)=>{L?x(L):B&&x(null,{stack:g,id:_,glyph:B.glyphs[_]||null})}))}),((g,_)=>{if(g)i(g);else if(_){const x={};for(const{stack:E,id:A,glyph:M}of _)x[E]===void 0&&(x[E]={}),x[E].glyphs===void 0&&(x[E].glyphs={}),x[E].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},x[E].ascender=this.entries[E].ascender,x[E].descender=this.entries[E].descender;i(null,x)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Q1.none&&(this.localGlyphMode===Q1.all?!!this.localFontFamily:!!this.localFontFamily&&(si["CJK Unified Ideographs"](e)||si["Hangul Syllables"](e)||si.Hiragana(e)||si.Katakana(e)||si["CJK Symbols and Punctuation"](e)||si["CJK Unified Ideographs Extension A"](e)||si["CJK Unified Ideographs Extension B"](e)||si.Osage(e)))}_tinySDF(e,i,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let g=e.tinySDF;if(!g){let Z="400";/bold/i.test(i)?Z="900":/medium/i.test(i)?Z="500":/light/i.test(i)&&(Z="200"),g=e.tinySDF=new Y_.TinySDF({fontFamily:h,fontWeight:Z,fontSize:24*Wh,buffer:3*Wh,radius:8*Wh}),g.fontWeight=Z}if(this.localGlyphs[g.fontWeight][a])return this.localGlyphs[g.fontWeight][a];const _=String.fromCodePoint(a),{data:x,width:E,height:A,glyphWidth:M,glyphHeight:P,glyphLeft:L,glyphTop:B,glyphAdvance:V}=g.draw(_);return this.localGlyphs[g.fontWeight][a]={id:a,bitmap:new Lc({width:E,height:A},x),metrics:{width:M/Wh,height:P/Wh,left:L/Wh,top:B/Wh-27,advance:V/Wh,localGlyph:!0}}}}Y_.loadGlyphRange=function(r,e,i,a,h){const g=256*e,_=g+255,x=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${g}-${_}`),hc.Glyphs);To(x,((E,A)=>{if(E)h(E);else if(A){const M={},P=(function(L){return new g0(L).readFields(QD,{})})(A);for(const L of P.glyphs)M[L.id]=L;h(null,{glyphs:M,ascender:P.ascender,descender:P.descender})}}))},Y_.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:x=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=x;const E=this.size=r+4*e,A=this._createCanvas(E),M=this.ctx=A.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${g} ${r}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(r),_=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),E=Math.min(this.size-this.buffer,_+Math.ceil(a)),A=x+2*this.buffer,M=E+2*this.buffer,P=Math.max(A*M,0),L=new Uint8ClampedArray(P),B={data:L,width:A,height:M,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(x===0||E===0)return B;const{ctx:V,buffer:Z,gridInner:K,gridOuter:Q}=this;this.lang&&(V.lang=this.lang),V.clearRect(Z,Z,x,E),V.fillText(r,Z,Z+_);const oe=V.getImageData(Z,Z,x,E);Q.fill(bv,0,P),K.fill(0,0,P);for(let le=0;le<E;le++)for(let he=0;he<x;he++){const Ee=oe.data[4*(le*x+he)+3]/255;if(Ee===0)continue;const Se=(le+Z)*A+he+Z;if(Ee===1)Q[Se]=0,K[Se]=bv;else{const Me=.5-Ee;Q[Se]=Me>0?Me*Me:0,K[Se]=Me<0?Me*Me:0}}VS(Q,0,0,A,M,A,this.f,this.v,this.z),VS(K,Z,Z,x,E,A,this.f,this.v,this.z);for(let le=0;le<P;le++){const he=Math.sqrt(Q[le])-Math.sqrt(K[le]);L[le]=Math.round(255-255*(he/this.radius+this.cutoff))}return B}};const om=zg;function jS(r,e){return r+e[1]-e[0]}function GS(r,e,i,a,h=1){const g=[],_=r.imagePrimary,x=_.pixelRatio,E=_.paddedRect.w-2*om,A=_.paddedRect.h-2*om,M=(r.right-r.left)*h,P=(r.bottom-r.top)*h,L=_.stretchX||[[0,E]],B=_.stretchY||[[0,A]],V=L.reduce(jS,0),Z=B.reduce(jS,0),K=E-V,Q=A-Z;let oe=0,le=V,he=0,Ee=Z,Se=0,Me=K,De=0,Ne=Q;if(_.content&&a){const je=_.content;oe=y0(L,0,je[0]),he=y0(B,0,je[1]),le=y0(L,je[0],je[2]),Ee=y0(B,je[1],je[3]),Se=je[0]-oe,De=je[1]-he,Me=je[2]-je[0]-le,Ne=je[3]-je[1]-Ee}const ft=(je,mt,It,vt)=>{const Et=v0(je.stretch-oe,le,M,r.left*h),Ot=x0(je.fixed-Se,Me,je.stretch,V),ut=v0(mt.stretch-he,Ee,P,r.top*h),St=x0(mt.fixed-De,Ne,mt.stretch,Z),rt=v0(It.stretch-oe,le,M,r.left*h),Je=x0(It.fixed-Se,Me,It.stretch,V),kt=v0(vt.stretch-he,Ee,P,r.top*h),Dt=x0(vt.fixed-De,Ne,vt.stretch,Z),xi=new Ct(Et,ut),ii=new Ct(rt,ut),hi=new Ct(rt,kt),Ut=new Ct(Et,kt),yi=new Ct(Ot/x,St/x),ji=new Ct(Je/x,Dt/x),Zt=e*Math.PI/180;if(Zt){const oi=Math.sin(Zt),Zi=Math.cos(Zt),An=[Zi,-oi,oi,Zi];xi._matMult(An),ii._matMult(An),Ut._matMult(An),hi._matMult(An)}const pi=je.stretch+je.fixed,Di=It.stretch+It.fixed,$i=mt.stretch+mt.fixed,rn=vt.stretch+vt.fixed,Yi=r.imageSecondary;return{tl:xi,tr:ii,bl:Ut,br:hi,texPrimary:{x:_.paddedRect.x+om+pi,y:_.paddedRect.y+om+$i,w:Di-pi,h:rn-$i},texSecondary:Yi?{x:Yi.paddedRect.x+om+pi,y:Yi.paddedRect.y+om+$i,w:Di-pi,h:rn-$i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:ji,minFontScaleX:Me/x/M,minFontScaleY:Ne/x/P,isSDF:i}};if(a&&(_.stretchX||_.stretchY)){const je=qS(L,K,V),mt=qS(B,Q,Z);for(let It=0;It<je.length-1;It++){const vt=je[It],Et=je[It+1];for(let Ot=0;Ot<mt.length-1;Ot++)g.push(ft(vt,mt[Ot],Et,mt[Ot+1]))}}else g.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:A+1}));return g}function y0(r,e,i){let a=0;for(const h of r)a+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return a}function qS(r,e,i){const a=[{fixed:-om,stretch:0}];for(const[h,g]of r){const _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return a.push({fixed:e+om,stretch:i}),a}function v0(r,e,i,a){return r/e*i+a}function x0(r,e,i,a){return r-e*i/a}function oO(r,e,i,a){const h=e+r.positionedLines[a].lineOffset;return a===0?i+h/2:i+(h+(e+r.positionedLines[a-1].lineOffset))/2}function aO(r,e=1,i=!1){let a=1/0,h=1/0,g=-1/0,_=-1/0;const x=r[0];for(let B=0;B<x.length;B++){const V=x[B];(!B||V.x<a)&&(a=V.x),(!B||V.y<h)&&(h=V.y),(!B||V.x>g)&&(g=V.x),(!B||V.y>_)&&(_=V.y)}const E=Math.min(g-a,_-h);let A=E/2;const M=new la([],lO);if(E===0)return new Ct(a,h);for(let B=a;B<g;B+=E)for(let V=h;V<_;V+=E)M.push(new K_(B+A,V+A,A,r));let P=(function(B){let V=0,Z=0,K=0;const Q=B[0];for(let oe=0,le=Q.length,he=le-1;oe<le;he=oe++){const Ee=Q[oe],Se=Q[he],Me=Ee.x*Se.y-Se.x*Ee.y;Z+=(Ee.x+Se.x)*Me,K+=(Ee.y+Se.y)*Me,V+=3*Me}return new K_(Z/V,K/V,0,B)})(r),L=M.length;for(;M.length;){const B=M.pop();(B.d>P.d||!P.d)&&(P=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-P.d<=e||(A=B.h/2,M.push(new K_(B.p.x-A,B.p.y-A,A,r)),M.push(new K_(B.p.x+A,B.p.y-A,A,r)),M.push(new K_(B.p.x-A,B.p.y+A,A,r)),M.push(new K_(B.p.x+A,B.p.y+A,A,r)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function lO(r,e){return e.max-r.max}class K_{constructor(e,i,a,h){this.p=new Ct(e,i),this.h=a,this.d=(function(g,_){let x=!1,E=1/0;for(let A=0;A<_.length;A++){const M=_[A];for(let P=0,L=M.length,B=L-1;P<L;B=P++){const V=M[P],Z=M[B];V.y>g.y!=Z.y>g.y&&g.x<(Z.x-V.x)*(g.y-V.y)/(Z.y-V.y)+V.x&&(x=!x),E=Math.min(E,cr(g,V,Z))}}return(x?1:-1)*Math.sqrt(E)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const cO=Object.keys,J1=Number.POSITIVE_INFINITY,uO=Math.sqrt(2);function HS(r,[e,i]){let a=0,h=0;if(i===J1){e<0&&(e=0);const g=e/uO;switch(r){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(r){case"top-right":case"bottom-right":a=-g;break;case"top-left":case"bottom-left":a=g;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,h]}function b0(r,e,i,a,h,g,_,x,E){if(!e||!e.usvg)return;const A=PS(a),M=PS(h),P=g!=="both"&&g!=="width"||!RS(a)?1:M.width/A.width,L=g!=="both"&&g!=="height"||!MS(a)?1:M.height/A.height;i.scaleSelf(P,L);const B=i.toString();_.set(B,i),x.set(B,e);const{imagePosition:V}=K1(B,e,zg);E.set(B,V)}function WS(r,e,i,a,h,g,_,x,E){if(!r)return;const A=(function(M,P,L,B,V,Z){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const K=P.possiblyEvaluate(new Xn(M.maxZoom,{worldview:Z}),L).evaluate(V,{},L),Q=P.possiblyEvaluate(new Xn(M.minZoom,{worldview:Z}),L).evaluate(V,{},L);return Math.max(K,Q)}return P.possiblyEvaluate(new Xn(B,{worldview:Z})).evaluate(V,{},L)})(e,i,a,h,g,E);return r.scaleSelf(A*x*_)}function $S(r,e,i,a,h,g,_,x,E){return{iconPrimary:WS(r.getPrimary(),e,i,a,h,g,_,x,E),iconSecondary:WS(r.getSecondary(),e,i,a,h,g,_,x,E)}}function hO(r,e,i){if(!e)return;const a=i.get(r.toString()),h=i.get(e.toString());a&&h&&(a.paddedRect.w===h.paddedRect.w&&a.paddedRect.h===h.paddedRect.h||Ki(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),a.usvg!==h.usvg&&Ki(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function ZS(r,e,i,a){if(!r)return;const h=e.get(i.toString());if(r.imagePrimary=h,a){const g=e.get(a.toString());r.imageSecondary=g}}function dO(r,e){for(const i in r.horizontal)XS(r.horizontal[i],e);XS(r.vertical,e)}function XS(r,e){if(r){for(const i of r.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const h=a.image.toString();a.rect=e.get(h).paddedRect}}}function ew(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fO(r,e,i,a,h,g,_,x,E){const A=tw(g.horizontal)||g.vertical,M=i.get("icon-text-fit-padding").evaluate(a,{},h);let P,L=e;return e&&E!=="none"&&(r.allowVerticalPlacement&&g.vertical&&(P=CS(e,g.vertical,E,M,x,_)),A&&(L=CS(e,A,E,M,x,_))),{defaultShapedIcon:L,verticallyShapedIcon:P}}function pO(r,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q,oe,le){let he=_.textMaxSize.evaluate(e,{},L);he===void 0?he=x*_.textScaleFactor:he*=_.textScaleFactor;const Ee=r.layers[0].layout,Se=tw(i.horizontal)||i.vertical,Me=B.name==="globe",De=yo,Ne=r.tilePixelRatio*he/De,ft=(Ot=r.overscaling,r.zoom>18&&Ot>2&&(Ot>>=1),Math.max(Bt/(512*Ot),1)*Ee.get("symbol-spacing")),je=Ee.get("text-padding")*r.tilePixelRatio,mt=Ee.get("icon-padding")*r.tilePixelRatio,It=Fe(Ee.get("text-max-angle")),vt=Ee.get("icon-rotation-alignment")==="map"&&le!=="point",Et=ft/2;var Ot;r.hasAnyIconTextFit===!1&&K!=="none"&&(r.hasAnyIconTextFit=!0);const ut=e.properties?+e.properties[Ei]:null,St=ut&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(ut):65535,rt=(Je,kt,Dt)=>{if(kt.x<0||kt.x>=Bt||kt.y<0||kt.y>=Bt)return;let xi=null;if(Me){const{x:ii,y:hi,z:Ut}=B.projectTilePoint(kt.x,kt.y,Dt);xi={anchor:new Xf(ii,hi,Ut,0,void 0),up:B.upVector(Dt,kt.x,kt.y)}}(function(ii,hi,Ut,yi,ji,Zt,pi,Di,$i,rn,Yi,oi,Zi,An,fe,pe,it,dt,Wt,Ht,ri,Ti,sn,an,tn,Hn,Pr,en,gr){const Yn=ii.addToLineVertexArray(hi,yi);let kn,xr,br,pr,_r,Kn,ln,tr=0,qr=0,zi=0,Pn=0,wr=-1,es=-1;const Ir={};let zs=Nl("");const lr=Ut?Ut.anchor:hi,Cs=en!=="none";let xl=0,$o=0;if($i._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ks=$i.layout.get("text-offset").evaluate(ri,{},tn);xl=ks[0]*yo,$o=ks[1]*yo}else xl=$i.layout.get("text-radial-offset").evaluate(ri,{},tn)*yo,$o=J1;if(ii.allowVerticalPlacement&&ji.vertical){const ks=ji.vertical;if(fe)Kn=iw(ks),Di&&(ln=iw(Di));else{const to=$i.layout.get("text-rotate").evaluate(ri,{},tn)+90;br=w0(rn,lr,hi,Yi,oi,Zi,ks,An,to,pe),Di&&(pr=w0(rn,lr,hi,Yi,oi,Zi,Di,dt,to))}}if(Zt){const ks=ii.iconSizeData,to=$i.layout.get("icon-rotate").evaluate(ri,{},tn),Zo=GS(Zt,to,sn,Cs,Ti.iconScaleFactor),Ia=Di?GS(Di,to,sn,Cs,Ti.iconScaleFactor):void 0;xr=w0(rn,lr,hi,Yi,oi,Zi,Zt,dt,to,null),tr=4*Zo.length;let pa=null;ks.kind==="source"?(pa=[Yd*$i.layout.get("icon-size").evaluate(ri,{},tn)*Ti.iconScaleFactor],pa[0]>am&&Ki(`${ii.layerIds[0]}: Value for "icon-size" is >= ${wv}. Reduce your "icon-size".`)):ks.kind==="composite"&&(pa=[Yd*Ti.compositeIconSizes[0].evaluate(ri,{},tn)*Ti.iconScaleFactor,Yd*Ti.compositeIconSizes[1].evaluate(ri,{},tn)*Ti.iconScaleFactor],(pa[0]>am||pa[1]>am)&&Ki(`${ii.layerIds[0]}: Value for "icon-size" is >= ${wv}. Reduce your "icon-size".`)),ii.addSymbols(ii.icon,Zo,pa,Ht,Wt,ri,void 0,Ut,hi,Yn.lineStartIndex,Yn.lineLength,-1,an,tn,Hn,Pr),wr=ii.icon.placedSymbolArray.length-1,Ia&&(qr=4*Ia.length,ii.addSymbols(ii.icon,Ia,pa,Ht,Wt,ri,nc.vertical,Ut,hi,Yn.lineStartIndex,Yn.lineLength,-1,an,tn,Hn,Pr),es=ii.icon.placedSymbolArray.length-1)}for(const ks in ji.horizontal){const to=ks,Zo=ji.horizontal[to];kn||(zs=Nl(Zo.text),fe?_r=iw(Zo):kn=w0(rn,lr,hi,Yi,oi,Zi,Zo,An,$i.layout.get("text-rotate").evaluate(ri,{},tn),pe));const Ia=Zo.positionedLines.length===1;if(zi+=YS(ii,Ut,hi,Zo,pi,$i,fe,ri,pe,Yn,ji.vertical?nc.horizontal:nc.horizontalOnly,Ia?cO(ji.horizontal):[to],Ir,wr,Ti,an,tn,Hn),Ia)break}ji.vertical&&(Pn+=YS(ii,Ut,hi,ji.vertical,pi,$i,fe,ri,pe,Yn,nc.vertical,["vertical"],Ir,es,Ti,an,tn,Hn));let Oo=-1;const bl=(ks,to)=>ks?Math.max(ks,to):to;Oo=bl(_r,Oo),Oo=bl(Kn,Oo),Oo=bl(ln,Oo);const Kd=Oo>-1?1:0;ii.glyphOffsetArray.length>=65535&&Ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&ii.addToSortKeyRanges(ii.symbolInstances.length,ri.sortKey),ii.symbolInstances.emplaceBack(hi.x,hi.y,lr.x,lr.y,lr.z,Ir.right>=0?Ir.right:-1,Ir.center>=0?Ir.center:-1,Ir.left>=0?Ir.left:-1,Ir.vertical>=0?Ir.vertical:-1,wr,es,zs,kn!==void 0?kn:ii.collisionBoxArray.length,kn!==void 0?kn+1:ii.collisionBoxArray.length,br!==void 0?br:ii.collisionBoxArray.length,br!==void 0?br+1:ii.collisionBoxArray.length,xr!==void 0?xr:ii.collisionBoxArray.length,xr!==void 0?xr+1:ii.collisionBoxArray.length,pr||ii.collisionBoxArray.length,pr?pr+1:ii.collisionBoxArray.length,Yi,zi,Pn,tr,qr,Kd,0,xl,$o,Oo,0,Cs?1:0,gr)})(r,kt,xi,Je,i,a,g,h,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,je,oe,A,0,mt,vt,Q,e,_,M,P,L,V,Z,K,St)};if(le==="line")for(const Je of H_(e.geometry,0,0,Bt,Bt)){const kt=sO(Je,ft,It,i.vertical||Se,a,De,Ne,r.overscaling,Bt);for(const Dt of kt)Se&&mO(r,Se.text,Et,Dt)||rt(Je,Dt,L)}else if(le==="line-center"){for(const Je of e.geometry)if(Je.length>1){const kt=rO(Je,It,i.vertical||Se,a,De,Ne);kt&&rt(Je,kt,L)}}else if(e.type==="Polygon")for(const Je of wg(e.geometry,0)){const kt=aO(Je,16);rt(Je[0],new Xf(kt.x,kt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const Je of e.geometry)rt(Je,new Xf(Je[0].x,Je[0].y,0,0,void 0),L);else if(e.type==="Point")for(const Je of e.geometry)for(const kt of Je)rt([kt],new Xf(kt.x,kt.y,0,0,void 0),L)}const wv=255,am=wv*Yd;function YS(r,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K,Q){const oe=(function(Ee,Se,Me,De,Ne,ft,je,mt){const It=[];if(Se.positionedLines.length===0)return It;const vt=De.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Et=(function(Je){const kt=Je[0],Dt=Je[1],xi=kt*Dt;return xi>0?[kt,-Dt]:xi<0?[-kt,Dt]:kt===0?[Dt,kt]:[Dt,-kt]})(Me);let Ot=Math.abs(Se.top-Se.bottom);for(const Je of Se.positionedLines)Ot-=Je.lineOffset;const ut=Se.positionedLines.length,St=Ot/ut;let rt=Se.top-Me[1];for(let Je=0;Je<ut;++Je){const kt=Se.positionedLines[Je];rt=oO(Se,St,rt,Je);for(const Dt of kt.positionedGlyphs){if(!Dt.rect)continue;const xi=Dt.rect||{};let ii=bS+1,hi=!0,Ut=1,yi=0;if(Dt.image){const ri=je.get(Dt.image.toString());if(!ri)continue;if(ri.sdf){Ki("SDF images are not supported in formatted text and will be ignored.");continue}hi=!1,Ut=ri.pixelRatio,ii=zg/Ut}const ji=(Ne||mt)&&Dt.vertical,Zt=Dt.metrics.advance*Dt.scale/2,pi=Dt.metrics,Di=Dt.rect;if(Di===null)continue;mt&&Se.verticalizable&&(yi=Dt.image?Zt-Dt.metrics.width*Dt.scale/2:0);const $i=Ne?[Dt.x+Zt,Dt.y]:[0,0];let rn=[0,0],Yi=[0,0],oi=!1;Ne||(ji?(Yi=[Dt.x+Zt+Et[0],Dt.y+Et[1]-yi],oi=!0):rn=[Dt.x+Zt+Me[0],Dt.y+Me[1]-yi]);const Zi=Di.w*Dt.scale/(Ut*(Dt.localGlyph?Wh:1)),An=Di.h*Dt.scale/(Ut*(Dt.localGlyph?Wh:1));let fe,pe,it,dt;if(ji){const ri=Dt.y-rt,Ti=new Ct(-Zt,Zt-ri),sn=-Math.PI/2,an=new Ct(...Yi);fe=new Ct(-Zt+rn[0],rn[1]),fe._rotateAround(sn,Ti)._add(an),fe.x+=-ri+Zt,fe.y-=(pi.left-ii)*Dt.scale;const tn=Dt.image?pi.advance*Dt.scale:yo*Dt.scale,Hn=String.fromCodePoint(Dt.glyph);UD(Hn)?fe.x+=(1-ii)*Dt.scale:jD(Hn)?fe.x+=tn-pi.height*Dt.scale+(-ii-1)*Dt.scale:fe.x+=Dt.image||pi.width+2*ii===Di.w&&pi.height+2*ii===Di.h?(tn-An)/2:(tn-(pi.height+2*ii)*Dt.scale)/2,pe=new Ct(fe.x,fe.y-Zi),it=new Ct(fe.x+An,fe.y),dt=new Ct(fe.x+An,fe.y-Zi)}else{const ri=(pi.left-ii)*Dt.scale-Zt+rn[0],Ti=(-pi.top-ii)*Dt.scale+rn[1],sn=ri+Zi,an=Ti+An;fe=new Ct(ri,Ti),pe=new Ct(sn,Ti),it=new Ct(ri,an),dt=new Ct(sn,an)}if(vt){let ri;ri=Ne?new Ct(0,0):oi?new Ct(Et[0],Et[1]):new Ct(Me[0],Me[1]),fe._rotateAround(vt,ri),pe._rotateAround(vt,ri),it._rotateAround(vt,ri),dt._rotateAround(vt,ri)}const Wt=new Ct(0,0),Ht=new Ct(0,0);It.push({tl:fe,tr:pe,bl:it,br:dt,texPrimary:xi,texSecondary:void 0,writingMode:Se.writingMode,glyphOffset:$i,sectionIndex:Dt.sectionIndex,isSDF:hi,pixelOffsetTL:Wt,pixelOffsetBR:Ht,minFontScaleX:0,minFontScaleY:0})}}return It})(0,a,E,g,_,x,h,r.allowVerticalPlacement),le=r.textSizeData;let he=null;le.kind==="source"?(he=[Yd*g.layout.get("text-size").evaluate(x,{},K)*V.textScaleFactor],he[0]>am&&Ki(`${r.layerIds[0]}: Value for "text-size" is >= ${wv}. Reduce your "text-size".`)):le.kind==="composite"&&(he=[Yd*V.compositeTextSizes[0].evaluate(x,{},K)*V.textScaleFactor,Yd*V.compositeTextSizes[1].evaluate(x,{},K)*V.textScaleFactor],(he[0]>am||he[1]>am)&&Ki(`${r.layerIds[0]}: Value for "text-size" is >= ${wv}. Reduce your "text-size".`)),r.addSymbols(r.text,oe,he,E,_,x,M,e,i,A.lineStartIndex,A.lineLength,B,Z,K,Q,!1);for(const Ee of P)L[Ee]=r.text.placedSymbolArray.length-1;return 4*oe.length}function tw(r){for(const e in r)return r[e];return null}function w0(r,e,i,a,h,g,_,x,E,A){let M=_.top,P=_.bottom,L=_.left,B=_.right;if(IS(_)&&_.collisionPadding){const V=_.collisionPadding;L-=V[0],M-=V[1],B+=V[2],P+=V[3]}if(E){const V=new Ct(L,M),Z=new Ct(B,M),K=new Ct(L,P),Q=new Ct(B,P),oe=Fe(E);let le=new Ct(0,0);A&&(le=new Ct(A[0],A[1])),V._rotateAround(oe,le),Z._rotateAround(oe,le),K._rotateAround(oe,le),Q._rotateAround(oe,le),L=Math.min(V.x,Z.x,K.x,Q.x),B=Math.max(V.x,Z.x,K.x,Q.x),M=Math.min(V.y,Z.y,K.y,Q.y),P=Math.max(V.y,Z.y,K.y,Q.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,M,B,P,x,a,h,g),r.length-1}function iw(r){IS(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function mO(r,e,i,a){const h=r.compareText;if(e in h){const g=h[e];for(let _=g.length-1;_>=0;_--)if(a.dist(g[_])<i)return!0}else h[e]=[];return h[e].push(a),!1}function KS(r,e){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,h=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),g=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*g+h;const x=h*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let E=Math.max(r.zoom-17,0);r.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,x)}function Tv(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),a=r.x*i,h=(r.x+1)*i,g=r.y*i,_=(r.y+1)*i,x=ve(a),E=ve(h),A=ge(g),M=ge(_),P=e.project(x,A),L=e.project(E,A),B=e.project(E,M),V=e.project(x,M);let Z=Math.min(P.x,L.x,B.x,V.x),K=Math.min(P.y,L.y,B.y,V.y),Q=Math.max(P.x,L.x,B.x,V.x),oe=Math.max(P.y,L.y,B.y,V.y);const le=i/16;function he(Se,Me,De,Ne,ft,je){const mt=(De+ft)/2,It=(Ne+je)/2,vt=e.project(ve(mt),ge(It)),Et=Math.max(0,Z-vt.x,K-vt.y,vt.x-Q,vt.y-oe);Z=Math.min(Z,vt.x),Q=Math.max(Q,vt.x),K=Math.min(K,vt.y),oe=Math.max(oe,vt.y),Et>le&&(he(Se,vt,De,Ne,mt,It),he(vt,Me,mt,It,ft,je))}he(P,L,a,g,h,g),he(L,B,h,g,h,_),he(B,V,h,_,a,_),he(V,P,a,_,a,g),Z-=le,K-=le,Q+=le,oe+=le;const Ee=1/Math.max(Q-Z,oe-K);return{scale:Ee,x:Z*Ee,y:K*Ee,x2:Q*Ee,y2:oe*Ee,projection:e}}function QS(r,{x:e,y:i},a=0){return new Ct(((e-a)*r.scale-r.x)*Bt,(i*r.scale-r.y)*Bt)}const gO=Ge(new Float32Array(16));class lm{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new W(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,h=!0){return e._coordinatePoint(e.locationCoordinate(i,a),h)}pixelsPerMeter(e,i){return ye(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return KS(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,h){const g=e.horizonLineFromTop(!1),_=new Ct(i,Math.max(g,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,i,a){const h=new Ct(i,a);if(e.elevation)return e.elevation.pointCoordinate(h);{const g=this.pointCoordinate(e,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return gO}createTileMatrix(e,i,a){let h,g,_;const x=a.canonical,E=Ge(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Tv(x,this);h=1,g=A.x+a.wrap*A.scale,_=A.y,jt(E,E,[h/A.scale,h/A.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*a.wrap)*h,_=x.y*h;return wt(E,E,[g,_,0]),jt(E,E,[h/Bt,h/Bt,1]),E}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class _O extends lm{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Fe(i));this.n=(h+Math.sin(Fe(a)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:h,r0:g}=this,_=Fe(e-this.center[0]),x=Fe(i),E=Math.sqrt(h-2*a*Math.sin(x))/a;return{x:E*Math.sin(_*a),y:E*Math.cos(_*a)-g,z:0}}unproject(e,i){const{n:a,c:h,r0:g}=this,_=g+i;let x=Math.atan2(e,Math.abs(_))*Math.sign(_);_*a<0&&(x-=Math.PI*Math.sign(e)*Math.sign(_));const E=Fe(this.center[0])*a;x=Le(x,-Math.PI-E,Math.PI-E);const A=Ie(J(x/a)+this.center[0],-180,180),M=Math.asin(Ie((h-(e*e+_*_)*a*a)/(2*a),-1,1)),P=Ie(J(M),-xe,xe);return new W(A,P)}}const Ev=1.340264,Sv=-.081106,Av=893e-6,Iv=.003796,T0=Math.sqrt(3)/2;class yO extends lm{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(T0*Math.sin(i)),h=a*a,g=h*h*h;return{x:.5*(e*Math.cos(a)/(T0*(Ev+3*Sv*h+g*(7*Av+9*Iv*h)))/Math.PI+.5),y:1-.5*(a*(Ev+Sv*h+g*(Av+Iv*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=a*a,g=h*h*h;for(let M,P,L,B=0;B<12&&(P=a*(Ev+Sv*h+g*(Av+Iv*h))-i,L=Ev+3*Sv*h+g*(7*Av+9*Iv*h),M=P/L,a=Ie(a-M,-Math.PI/3,Math.PI/3),h=a*a,g=h*h*h,!(Math.abs(M)<1e-12));++B);const _=T0*e*(Ev+3*Sv*h+g*(7*Av+9*Iv*h))/Math.cos(a),x=Math.asin(Math.sin(a)/T0),E=Ie(180*_/Math.PI,-180,180),A=Ie(180*x/Math.PI,-xe,xe);return new W(E,A)}}class vO extends lm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),h=Ie(360*(.5-i),-xe,xe);return new W(a,h)}}const Q_=Math.PI/2;function E0(r){return Math.tan((Q_+r)/2)}class xO extends lm{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let h=Fe(i),g=Fe(a);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const _=Math.cos(h),x=E0(h);this.n=h===g?Math.sin(h):Math.log(_/Math.cos(g))/Math.log(E0(g)/x),this.f=_*Math.pow(E0(h),this.n)/this.n}project(e,i){i=Fe(i),this.southernCenter&&(i=-i),e=Fe(e-this.center[0]);const a=1e-6,{n:h,f:g}=this;g>0?i<-Q_+a&&(i=-Q_+a):i>Q_-a&&(i=Q_-a);const _=g/Math.pow(E0(i),h);let x=_*Math.sin(h*e),E=g-_*Math.cos(h*e);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:h}=this,g=h-i,_=Math.sign(g),x=Math.sign(a)*Math.sqrt(e*e+g*g);let E=Math.atan2(e,Math.abs(g))*_;g*a<0&&(E-=Math.PI*Math.sign(e)*_);const A=Ie(J(E/a)+this.center[0],-180,180),M=Ie(J(2*Math.atan(Math.pow(h/x,1/a))-Q_),-xe,xe);return new W(A,this.southernCenter?-M:M)}}class JS extends lm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:de(e),y:be(i),z:0}}unproject(e,i){const a=ve(e),h=ge(i);return new W(a,h)}}const eA=Fe(xe);class bO extends lm{project(e,i){const a=(i=Fe(i))*i,h=a*a;return{x:.5*((e=Fe(e))*(.8707-.131979*a+h*(h*(.003971*a-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+h*(.028874*a-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=25,g=0,_=a*a;do{_=a*a;const A=_*_;g=(a*(1.007226+_*(.015085+A*(.028874*_-.044475-.005916*A)))-i)/(1.007226+_*(.045255+A*(.259866*_-.311325-.005916*11*A))),a=Ie(a-g,-eA,eA)}while(Math.abs(g)>1e-6&&--h>0);_=a*a;const x=Ie(J(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=J(a);return new W(x,E)}}const tA=Fe(xe);class wO extends lm{project(e,i){i=Fe(i),e=Fe(e);const a=Math.cos(i),h=2/Math.PI,g=Math.acos(a*Math.cos(e/2)),_=Math.sin(g)/g,x=.5*(e*h+2*a*Math.sin(e/2)/_)||0,E=.5*(i+Math.sin(i)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,g=25;const _=1e-6;let x=0,E=0;do{const A=Math.cos(h),M=Math.sin(h),P=2*M*A,L=M*M,B=A*A,V=Math.cos(a/2),Z=Math.sin(a/2),K=2*V*Z,Q=Z*Z,oe=1-B*V*V,le=oe?1/oe:0,he=oe?Math.acos(A*V)*Math.sqrt(1/oe):0,Ee=.5*(2*he*A*Z+2*a/Math.PI)-e,Se=.5*(he*M+h)-i,Me=.5*le*(B*Q+he*A*V*L)+1/Math.PI,De=le*(K*P/4-he*M*Z),Ne=.125*le*(P*Z-he*M*B*K),ft=.5*le*(L*V+he*Q*A)+.5,je=De*Ne-ft*Me;x=(Se*De-Ee*ft)/je,E=(Ee*Ne-Se*Me)/je,a=Ie(a-x,-Math.PI,Math.PI),h=Ie(h-E,-tA,tA)}while((Math.abs(x)>_||Math.abs(E)>_)&&--g>0);return new W(J(a),J(h))}}class iA extends lm{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:h}=this;return{x:Fe(e)*h*a+.5,y:-Math.sin(Fe(i))/h*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:h}=this,g=-(i-.5)/a,_=Ie(J((e-.5)/a)/h,-180,180),x=Math.asin(Ie(g*h,-1,1)),E=Ie(J(x),-xe,xe);return new W(_,E)}}class TO extends JS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const h=Ur(e,i,a);return ur(h,h,mg(_u(a))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,a){const h=F(i.lat,i.lng),g=Qt([],h),_=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Kt(h,h,g,ye(1,0)*Bt*_);const x=Ge(new Float64Array(16));return xt(x,e.pixelMatrix,e.globeMatrix),ur(h,h,x),new Ct(h[0],h[1])}pixelsPerMeter(e,i){return ye(1,0)*i}pixelSpaceConversion(e,i,a){const h=ye(1,e)*i,g=Ii(ye(1,45)*i,h,a);return this.pixelsPerMeter(e,i)/g}createTileMatrix(e,i,a){const h=Uy(_u(a.canonical));return xt(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:a}=e,h=mg(_u(i));return Ai(h,h,Fe(a.lng)),wi(h,h,Fe(a.lat)),jt(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,a,h){return By(e,i,a,!0)||new nt(0,0)}pointCoordinate3D(e,i,a){const h=this.pointCoordinate(e,i,a,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!By(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(h,g){const _=h.cameraToCenterDistance,x=h._centerAltitude*g,E=h._camera,A=h._camera.forward(),M=Pt([],et([],A,-_),[0,0,x]),P=h.worldSize/(2*Math.PI),L=[0,0,-P],B=h.width/h.height,V=Math.tan(h.fovAboveCenter),Z=et([],E.up(),V),K=et([],E.right(),V*B),Q=Qt([],Pt([],Pt([],A,Z),K)),oe=[];let le;if(new xn(M,Q).closestPointOnSphere(L,P,oe)){const he=Pt([],oe,L),Ee=Dr([],he,M);le=Math.cos(h.fovAboveCenter)*Ue(Ee)}else{const he=Dr([],M,L),Ee=Dr([],L,M);Qt(Ee,Ee);const Se=Ue(he)-P;le=Math.sqrt(Se*(Se+2*P));const Me=Math.acos(le/(P+Se))-Math.acos(Li(A,Ee));le*=Math.cos(Me)}return 1.01*le})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=ic(e.zoom);if(a>0){const h=KS(e,ye(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ii(i,h+g*(1-Math.cos(_)),Math.pow(a,10))}return i}upVector(e,i,a){return Ur(i,a,e,1)}upVectorScale(e){return{metersToTile:Bh(qp(_u(e)))}}}function nA(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new JS(r);case"equirectangular":return new vO(r);case"naturalEarth":return new bO(r);case"equalEarth":return new yO(r);case"winkelTripel":return new wO(r);case"albers":return i?new iA(r):new _O(r);case"lambertConformalConic":return i?new iA(r):new xO(r);case"globe":return new TO(r)}throw new Error(`Invalid projection name: ${r.name}`)}const EO=Tt.types,SO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function S0(r,e,i,a,h,g,_,x,E,A,M,P,L){const B=x?Math.min(am,Math.round(x[0])):0,V=x?Math.min(am,Math.round(x[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*h),g,_,(B<<1)+(E?1:0),V,16*A,16*M,256*P,256*L)}function A0(r,e,i){r.emplaceBack(e,i)}function I0(r,e,i,a,h,g,_){r.emplaceBack(e,i,a,h,g,_)}const C0=(r,e,i,a)=>{for(let h=0;h<e;h++)r.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function R0(r,e,i,a,h){r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h)}function AO(r){for(const e of r.sections)if(Ls(e.text))return!0;return!1}class nw{constructor(e){this.layoutVertexArray=new ig,this.indexArray=new gs,this.programConfigurations=e,this.segments=new Er,this.dynamicLayoutVertexArray=new da,this.opacityVertexArray=new Gu,this.placedSymbolArray=new Qs,this.iconTransitioningVertexArray=new os,this.globeExtVertexArray=new Fp,this.zOffsetVertexArray=new du,this.orientationVertexArray=new Rh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,h,g){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,OD.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,SO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,kD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,DD.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,LD.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,zD.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Xt(nw,"SymbolBuffers");class rw{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Er,this.collisionVertexArray=new Bp,this.collisionVertexArrayExt=new da}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ND.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,FD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(rw,"CollisionBuffers");class M0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ge([]),this.placementViewportMatrix=Ge([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=DS(this.zoom,i["text-size"],this.worldview),this.iconSizeData=DS(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map((_=>nc[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new nw(new gl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new nw(new gl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new sg,this.lineVertexArray=new og,this.symbolInstances=new rg}calculateGlyphDependencies(e,i,a,h,g){for(const _ of e){const x=_.codePointAt(0);if(x===void 0)break;if(i[x]=!0,h&&g&&x<=65535){const E=_v[_];E&&(i[E.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!$d(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,h){const g=this.layers[0],_=g.layout,x=this.projection.name==="globe",E=_.get("text-font"),A=_.get("text-field"),M=_.get("icon-image"),[P,L]=_.get("icon-size-scale-range"),B=Ie(i.scaleFactor||1,P,L),V=(A.value.kind!=="constant"||A.value.value instanceof ps&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),Z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,K=_.get("symbol-sort-key");if(this.features=[],!V&&!Z)return;const Q=i.iconDependencies,oe=i.glyphDependencies,le=i.availableImages,he=new Xn(this.zoom,{worldview:this.worldview});for(const{feature:Ee,id:Se,index:Me,sourceLayerIndex:De}of e){const Ne=g._featureFilter.needGeometry,ft=Mt(Ee,Ne);if(!g._featureFilter.filter(he,ft,a))continue;if(Ne||(ft.geometry=Yt(Ee,a,h)),x&&Ee.type!==1&&a.z<=5){const Et=ft.geometry,Ot=.98078528056,ut=(St,rt)=>Li(Ur(St.x,St.y,a,1),Ur(rt.x,rt.y,a,1))<Ot;for(let St=0;St<Et.length;St++)Et[St]=lt(Et[St],ut)}let je,mt;if(V){const Et=g.getValueAndResolveTokens("text-field",ft,a,le),Ot=ps.factory(Et);AO(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||Cd()==="unavailable"||this.hasRTLText&&Wr.isParsed())&&(je=VD(Ot,g,ft))}if(Z){const Et=g.getValueAndResolveTokens("icon-image",ft,a,le);mt=typeof Et=="string"?ms.build(Et):Et}if(!je&&!mt)continue;const It=this.sortFeaturesByKey?K.evaluate(ft,{},a):void 0,vt={id:Se,text:je,icon:mt,index:Me,sourceLayerIndex:De,geometry:ft.geometry,properties:Ee.properties,type:EO[Ee.type],sortKey:It};if(this.features.push(vt),mt){const Et=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ot,iconSecondary:ut}=$S(mt,this.iconSizeData,Et["icon-size"],a,this.zoom,vt,this.pixelRatio,B,this.worldview),St=Ot.id.toString();if(Q.has(St)?Q.get(St).push(Ot):Q.set(St,[Ot]),ut){this.hasAnySecondaryIcon=!0;const rt=ut.id.toString();Q.has(rt)?Q.get(rt).push(ut):Q.set(rt,[ut])}}if(je){const Et=E.evaluate(ft,{},a).join(","),Ot=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(nc.vertical)>=0;for(const ut of je.sections)if(ut.image){const St=ut.image.getPrimary().scaleSelf(this.pixelRatio),rt=St.id.toString(),Je=Q.get(rt)||[];Je.push(St),Q.set(rt,Je)}else{const St=Os(je.toString()),rt=ut.fontStack||Et,Je=oe[rt]=oe[rt]||{};this.calculateGlyphDependencies(ut.text,Je,Ot,this.allowVerticalPlacement,St)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ee){const Se={},Me={},De=[];let Ne=0;function ft(vt){De.push(Ee[vt]),Ne++}function je(vt,Et,Ot){const ut=Me[vt];return delete Me[vt],Me[Et]=ut,De[ut].geometry[0].pop(),De[ut].geometry[0]=De[ut].geometry[0].concat(Ot[0]),ut}function mt(vt,Et,Ot){const ut=Se[Et];return delete Se[Et],Se[vt]=ut,De[ut].geometry[0].shift(),De[ut].geometry[0]=Ot[0].concat(De[ut].geometry[0]),ut}function It(vt,Et,Ot){const ut=Ot?Et[0][Et[0].length-1]:Et[0][0];return`${vt}:${ut.x}:${ut.y}`}for(let vt=0;vt<Ee.length;vt++){const Et=Ee[vt],Ot=Et.geometry,ut=Et.text?Et.text.toString():null;if(!ut){ft(vt);continue}const St=It(ut,Ot),rt=It(ut,Ot,!0);if(St in Me&&rt in Se&&Me[St]!==Se[rt]){const Je=mt(St,rt,Ot),kt=je(St,rt,De[Je].geometry);delete Se[St],delete Me[rt],Me[It(ut,De[kt].geometry,!0)]=kt,De[Je].geometry=null}else St in Me?je(St,rt,Ot):rt in Se?mt(St,rt,Ot):(ft(vt),Se[St]=Ne-1,Me[rt]=Ne-1)}return De.filter((vt=>vt.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ee,Se)=>Ee.sortKey-Se.sortKey))}update(e,i,a,h,g,_,x){this.text.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,g,a,h,_,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=qe(e),h=1/a;let g=!1,_=!1;for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x),A=Cn(1,0,0),M=Cn(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:L,numIconVertices:B,numVerticalIconVertices:V}=E,Z=P>0||L>0,K=B>0,Q=this.elevationFeatures[E.elevationFeatureIndex];if(Q){const oe=new Ct(E.tileAnchorX,E.tileAnchorY),le=.075+Q.pointElevation(oe);E.zOffset!==le&&(i=!0,E.zOffset=le);const he=Q.computeSlopeNormal(oe,h),Ee=jc(Cl(),Cn(0,0,1),he);Jo(A,A,Ee),Jo(M,M,Ee),A[2]*=a,M[2]*=a,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(g=g||Z,_=_||K)}if(Z&&(C0(this.text.orientationVertexArray,P,A,M),C0(this.text.orientationVertexArray,L,A,M)),K){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:le}=E;oe>=0&&C0(this.icon.orientationVertexArray,B,A,M),le>=0&&C0(this.icon.orientationVertexArray,V,A,M)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(g,_,x)=>{a+=_,a>g.length&&g.resize(a);for(let E=-_;E<0;E++)g.emplace(E+a,x)},i=(g,_,x)=>{h+=_,h>g.length&&g.resize(h);for(let E=-_;E<0;E++)g.emplace(E+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,h=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:E,numIconVertices:A}=_,M=_.zOffset,P=A>0;if((x>0||E>0)&&(e(this.text.zOffsetVertexArray,x,M),e(this.text.zOffsetVertexArray,E,M)),P){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:B}=_;L>=0&&i(this.icon.zOffsetVertexArray,A,M),B>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=nA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:g}of i)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z,K){const Q=e.indexArray,oe=e.layoutVertexArray,le=e.globeExtVertexArray,he=e.segments.prepareSegment(4*i.length,oe,Q,this.canOverlap?_.sortKey:void 0),Ee=this.glyphOffsetArray.length,Se=he.vertexLength,Me=this.allowVerticalPlacement&&x===nc.vertical?Math.PI/2:0,De=_.text&&_.text.sections;for(let ft=0;ft<i.length;ft++){const{tl:je,tr:mt,bl:It,br:vt,texPrimary:Et,texSecondary:Ot,pixelOffsetTL:ut,pixelOffsetBR:St,minFontScaleX:rt,minFontScaleY:Je,glyphOffset:kt,isSDF:Dt,sectionIndex:xi}=i[ft],ii=he.vertexLength,hi=kt[1];if(S0(oe,A.x,A.y,je.x,hi+je.y,Et.x,Et.y,a,Dt,ut.x,ut.y,rt,Je),S0(oe,A.x,A.y,mt.x,hi+mt.y,Et.x+Et.w,Et.y,a,Dt,St.x,ut.y,rt,Je),S0(oe,A.x,A.y,It.x,hi+It.y,Et.x,Et.y+Et.h,a,Dt,ut.x,St.y,rt,Je),S0(oe,A.x,A.y,vt.x,hi+vt.y,Et.x+Et.w,Et.y+Et.h,a,Dt,St.x,St.y,rt,Je),E){const{x:Ut,y:yi,z:ji}=E.anchor,[Zt,pi,Di]=E.up;I0(le,Ut,yi,ji,Zt,pi,Di),I0(le,Ut,yi,ji,Zt,pi,Di),I0(le,Ut,yi,ji,Zt,pi,Di),I0(le,Ut,yi,ji,Zt,pi,Di),R0(e.dynamicLayoutVertexArray,Ut,yi,ji,Me)}else R0(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Me);if(K){const Ut=Ot||Et;A0(e.iconTransitioningVertexArray,Ut.x,Ut.y),A0(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y),A0(e.iconTransitioningVertexArray,Ut.x,Ut.y+Ut.h),A0(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y+Ut.h)}Q.emplaceBack(ii,ii+1,ii+2),Q.emplaceBack(ii+1,ii+2,ii+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),ft!==i.length-1&&xi===i[ft+1].sectionIndex||e.programConfigurations.populatePaintArrays(oe.length,_,_.index,{},B,V,Z,De&&De[xi],this.worldview)}const Ne=E?E.anchor:A;e.placedSymbolArray.emplaceBack(Ne.x,Ne.y,Ne.z,A.x,A.y,Ee,this.glyphOffsetArray.length-Ee,Se,M,P,A.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],x,0,0,0,L,0)}_commitLayoutVertex(e,i,a,h,g,_,x){e.emplaceBack(i,a,h,g,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,a,h,g,_,x){const E=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),A=E.vertexLength,M=x.tileAnchorX,P=x.tileAnchorY;for(let B=0;B<4;B++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(a.layoutVertexArray,h,g,_,M,P,new Ct(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,g,_,M,P,new Ct(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,g,_,M,P,new Ct(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,g,_,M,P,new Ct(e.x1,e.y2)),E.vertexLength+=4;const L=a.indexArray;L.emplaceBack(A,A+1),L.emplaceBack(A+1,A+2),L.emplaceBack(A+2,A+3),L.emplaceBack(A+3,A),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,h,g,_){for(let x=h;x<g;x++){const E=a.get(x),A=this.getSymbolInstanceTextSize(e,_,i,x);this._addCollisionDebugVertices(E,A,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,a,h,g,_){for(let x=h;x<g;x++){const E=a.get(x),A=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,A,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rw(zf,_S.members,os),this.iconCollisionBox=new rw(zf,_S.members,os);const h=vv(this.iconSizeData,e),g=vv(this.textSizeData,e,a);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(g,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,a,h){const g=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),_=Y1(this.textSizeData,e,g)/yo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,a){const h=this.icon.placedSymbolArray.get(a),g=Y1(this.iconSizeData,e,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,i,a,h){e.emplaceBack(i,-a,-a,h),e.emplaceBack(i,a,-a,h),e.emplaceBack(i,a,a,h),e.emplaceBack(i,-a,a,h)}_updateTextDebugCollisionBoxes(e,i,a,h,g,_,x){for(let E=h;E<g;E++){const A=a.get(E),M=this.getSymbolInstanceTextSize(e,_,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,h,g,_,x){for(let E=h;E<g;E++){const A=a.get(E),M=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,a,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=vv(this.iconSizeData,e,h),_=vv(this.textSizeData,e,a);for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(_,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,a),this._updateTextDebugCollisionBoxes(_,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,a),this._updateIconDebugCollisionBoxes(g,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(g,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,h,g,_,x,E,A){const M={};if(i<a){const{x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=e.get(i);M.textBox={x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he},M.textFeatureIndex=Ee}if(h<g){const{x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=e.get(h);M.verticalTextBox={x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he},M.verticalTextFeatureIndex=Ee}if(_<x){const{x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=e.get(_);M.iconBox={x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he},M.iconFeatureIndex=Ee}if(E<A){const{x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=e.get(E);M.verticalIconBox={x1:P,y1:L,x2:B,y2:V,padding:Z,projectedAnchorX:K,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:he},M.verticalIconFeatureIndex=Ee}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),h=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);h.push(0|Math.round(i*E.tileAnchorX+a*E.tileAnchorY)),g.push(E.featureIndex)}return _.sort(((x,E)=>h[x]-h[E]||g[E]-g[x])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:A}=a;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let rA,sA,sw;Xt(M0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),M0.addDynamicAttributes=R0;class oA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Da,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(oA,"FormatSectionOverride",{omit:["defaultValue"]});const ow=()=>sw||(sw={layout:rA||(rA=new Or({"symbol-placement":new Lt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Lt(Be.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Lt(Be.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Lt(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Lt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(Be.layout_symbol["icon-size"]),"icon-size-scale-range":new Lt(Be.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $t(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(Be.layout_symbol["icon-image"]),"icon-image-use-theme":new Lt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new $t(Be.layout_symbol["icon-rotate"]),"icon-padding":new Lt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(Be.layout_symbol["icon-offset"]),"icon-anchor":new $t(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new $t(Be.layout_symbol["text-field"]),"text-font":new $t(Be.layout_symbol["text-font"]),"text-size":new $t(Be.layout_symbol["text-size"]),"text-size-scale-range":new Lt(Be.layout_symbol["text-size-scale-range"]),"text-max-width":new $t(Be.layout_symbol["text-max-width"]),"text-line-height":new $t(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(Be.layout_symbol["text-letter-spacing"]),"text-justify":new $t(Be.layout_symbol["text-justify"]),"text-radial-offset":new $t(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new $t(Be.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new $t(Be.layout_symbol["text-rotate"]),"text-padding":new Lt(Be.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Be.layout_symbol["text-keep-upright"]),"text-transform":new $t(Be.layout_symbol["text-transform"]),"text-offset":new $t(Be.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Lt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Be.layout_symbol["text-optional"]),visibility:new Lt(Be.layout_symbol.visibility)})),paint:sA||(sA=new Or({"icon-opacity":new $t(Be.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $t(Be.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $t(Be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $t(Be.paint_symbol["text-emissive-strength"]),"icon-color":new $t(Be.paint_symbol["icon-color"]),"icon-halo-color":new $t(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Lt(Be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $t(Be.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $t(Be.paint_symbol["text-occlusion-opacity"]),"text-color":new $t(Be.paint_symbol["text-color"],{runtimeType:Ao,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new $t(Be.paint_symbol["text-halo-color"]),"text-halo-width":new $t(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(Be.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Lt(Be.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Lt(Be.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Lt(Be.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Lt(Be.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $t(Be.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},sw);class P0 extends mo{constructor(e,i,a,h){super(e,ow(),i,a,h,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Ge([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(g,_,x,E){g=zo(g),_=Ys(_);const A=at(),M=g/3,P=1-2*M,L=[P,M,M,0,M,P,M,0,M,M,P,0,0,0,0,1],B=.5-.5*_,V=E-x;return xt(A,[V,0,0,0,0,V,0,0,0,0,V,0,x,x,x,1],[_,0,0,0,0,_,0,0,0,0,_,0,B,B,B,1]),xt(A,A,L),A})(e,i,a,h),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,h){const g=this.layout.get(e).evaluate(i,{},a,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Pp(_.value)||!g?g:(function(x,E){return E.replace(/{([^{}]+)}/g,((A,M)=>M in x?String(x[M]):""))})(i.properties,g)}createBucket(e){return new M0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ow().paint.overridableProperties){if(!P0.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new oA(i),h=new Af(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=i.value.kind==="constant"||i.value.kind==="source"?new Nu("source",h):new iu("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new ou(i.property,g,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&P0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),h=ow().paint.properties[i];let g=!1;const _=x=>{for(const E of x)if(h.overrides&&h.overrides.hasOverride(E))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ps)_(a.value.value.sections);else if(a.value.kind==="source"){const x=A=>{g||(A instanceof Xi&&ns(A.value)===ee?_(A.value.sections):A instanceof Bl?_(A.sections):A.eachChild(x))},E=a.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new $u(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let aA,lA,cA,uA;var aw=pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function D0(r,e,i,a,h,g,_,x){const E=[r,e,1,i,a,1,h,g,1],A=[_,x,1],M=we([],E),[P,L,B]=Qo(A,A,M);return ze(E,E,[P,0,0,0,L,0,0,0,B])}function hA(r,e,i,a,h,g,_,x){const E=(function(A,M,P,L,B,V,Z,K){const Q=D0(0,0,1,0,1,1,0,1),oe=D0(A,M,P,L,B,V,Z,K);return ze(oe,oe,we([],Q))})(r,e,i,a,h,g,_,x);return[E[2]/E[8]/Bt,E[5]/E[8]/Bt]}function O0(r){return[r[0],Math.min(Math.max(r[1],-xe),xe)]}class dA extends al{constructor(e,i,a,h){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new sa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=sl(this.map._requestManager.transformRequest(this.url,hc.Image),((a,h)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new ol(a)):h&&(this.image=h instanceof HTMLImageElement?ia.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new sa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const g of e)g[1]>a&&(a=g[1]),g[1]<i&&(i=g[1]);const h=(a+i)/2;if(h>xe?this.onNorthPole=!0:h<-xe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=e.map(nt.fromLngLat);this.tileID=(function(_){let x=1/0,E=1/0,A=-1/0,M=-1/0;for(const Z of _)x=Math.min(x,Z.x),E=Math.min(E,Z.y),A=Math.max(A,Z.x),M=Math.max(M,Z.y);const P=Math.max(A-x,M-E),L=Math.max(0,Math.floor(-Math.log2(P))),B=Math.pow(2,L);let V=Math.floor((x+A)/2*B);return V>1&&(V-=1),new Oc(L,V,Math.floor((E+M)/2*B))})(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new sa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof pv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Q in this.tiles){const oe=this.tiles[Q];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Tv(new Oc(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(Q){const oe=Q[1].x-Q[0].x,le=Q[1].y-Q[0].y,he=Q[2].x-Q[1].x,Ee=Q[2].y-Q[1].y,Se=Q[3].x-Q[2].x,Me=Q[3].y-Q[2].y,De=Q[0].x-Q[3].x,Ne=Q[0].y-Q[3].y,ft=oe*Ee-he*le,je=he*Me-Se*Ee,mt=Se*Ne-De*Me,It=De*le-oe*Ne;return ft>0&&je>0&&mt>0&&It>0||ft<0&&je<0&&mt<0&&It<0})(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Tv(this.tileID,this.map.transform.projection),[g,_,x,E]=this.coordinates.map((Q=>{const oe=h.projection.project(Q[0],Q[1]);return QS(h,oe)._round()}));this.perspectiveTransform=hA(g.x,g.y,_.x,_.y,x.x,x.y,E.x,E.y);const A=this._boundsArray=new ju;A.emplaceBack(g.x,g.y,0,0),A.emplaceBack(_.x,_.y,Bt,0),A.emplaceBack(E.x,E.y,0,Bt),A.emplaceBack(x.x,x.y,Bt,Bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,aw.members),this.boundsSegments=Er.simpleSegment(0,0,4,2);const M=[],P=[O0((L=this.coordinates)[0]),O0(L[1]),O0(L[2]),O0(L[3])];var L;const[B,V,Z,K]=(function(Q){let oe=Q[0][0],le=oe,he=Q[0][1],Ee=he;for(let Se=1;Se<Q.length;Se++)Q[Se][0]<oe?oe=Q[Se][0]:Q[Se][0]>le&&(le=Q[Se][0]),Q[Se][1]<he?he=Q[Se][1]:Q[Se][1]>Ee&&(Ee=Q[Se][1]);return[oe,he,le-oe,Ee-he]})(P);{const Q=new ju,[oe,le,he,Ee]=(function(ut){let St=ut[0].x,rt=St,Je=ut[0].y,kt=Je;for(let Dt=1;Dt<ut.length;Dt++)ut[Dt].x<St?St=ut[Dt].x:ut[Dt].x>rt&&(rt=ut[Dt].x),ut[Dt].y<Je?Je=ut[Dt].y:ut[Dt].y>kt&&(kt=ut[Dt].y);return[St,Je,rt-St,kt-Je]})(a),Se=ut=>[(ut.x-oe)/he,(ut.y-le)/Ee],[Me,De,Ne,ft]=a.map(Se),je=(function(ut,St,rt,Je,kt,Dt,xi,ii){const hi=D0(0,0,1,0,1,1,0,1);return ze(hi,hi,we([],D0(ut,St,rt,Je,kt,Dt,xi,ii)))})(Me[0],Me[1],De[0],De[1],Ne[0],Ne[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=hA(Me[0],Me[1],De[0],De[1],Ne[0],Ne[1],ft[0],ft[1]);const mt=(ut,St)=>{M.push(ut.lng);const rt=Math.round((ut.lng-B)/Z*Bt),Je=Math.round((ut.lat-V)/K*Bt),kt=Se(St),Dt=Qo([],[kt[0],kt[1],1],je),xi=Math.round(Dt[0]/Dt[2]*Bt),ii=Math.round(Dt[1]/Dt[2]*Bt);Q.emplaceBack(rt,Je,xi,ii)},It=a[3].x-a[0].x,vt=a[3].y-a[0].y,Et=a[2].x-a[1].x,Ot=a[2].y-a[1].y;for(let ut=0;ut<65;ut++){const St=ut/64,rt=[a[0].x+St*It,a[0].y+St*vt],Je=[a[1].x+St*Et,a[1].y+St*Ot],kt=Je[0]-rt[0],Dt=Je[1]-rt[1];for(let xi=0;xi<65;xi++){const ii=xi/64,hi={x:rt[0]+kt*ii,y:rt[1]+Dt*ii};mt(i.projection.unproject(hi.x,hi.y),hi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Q,aw.members)}{this.maxLongitudeTriangleSize=0;let Q=[],oe=new gs;const le=(he,Ee,Se)=>{oe.emplaceBack(he,Ee,Se);const Me=M[he],De=M[Ee],Ne=M[Se],ft=Math.min(Math.min(Me,De),Ne),je=Math.max(Math.max(Me,De),Ne)-ft;je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=je),Q.push(ft+je/2)};for(let he=0;he<64;he++)for(let Ee=0;Ee<64;Ee++){const Se=65*he+Ee,Me=Se+1,De=Se+65,Ne=De+1;le(Se,De,Me),le(Me,De,Ne)}[Q,oe]=(function(he,Ee){const Se=Array.from({length:he.length},((Ne,ft)=>ft));Se.sort(((Ne,ft)=>he[Ne]-he[ft]));const Me=[],De=new gs;for(let Ne=0;Ne<Se.length;Ne++){const ft=Se[Ne];Me.push(he[ft]);const je=3*ft,mt=je+1;De.emplaceBack(Ee.uint16[je],Ee.uint16[mt],Ee.uint16[mt+1])}return[Me,De]})(Q,oe),this.elevatedGlobeTrianglesCenterLongitudes=Q,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(oe)}this.elevatedGlobeSegments=Er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/Bt,0,K/Bt,0,0,V,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof pv||(this.texture?this.texture.update(this.image):(this.texture=new z1(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let h=(g=e+180)+360*Math.round((a[0]-g)/360);var g;const _=new Er,x=(P,L)=>{_.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-h)<=E){const P=Es(a,0,a.length,h+E);return P===a.length||x(P,Jn(a,P+1,a.length,h+360-E)-P),_}h<a[0]&&(h+=360);const A=Jn(a,0,a.length,h-E);if(A===a.length)return x(0,a.length),_;x(0,A-0);const M=Es(a,A+1,a.length,h+E);return M!==a.length&&x(M,a.length-M),_}}const IO=(Math.pow(256,2)-1)/16907520;class fA extends mo{constructor(e,i,a,h){super(e,{layout:cA||(cA=new Or({visibility:new Lt(Be.layout_raster.visibility)})),paint:uA||(uA=new Or({"raster-opacity":new Lt(Be.paint_raster["raster-opacity"]),"raster-color":new Eh(Be.paint_raster["raster-color"]),"raster-color-mix":new Lt(Be.paint_raster["raster-color-mix"]),"raster-color-range":new Lt(Be.paint_raster["raster-color-range"]),"raster-hue-rotate":new Lt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Be.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Be.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Lt(Be.paint_raster["raster-emissive-strength"]),"raster-array-band":new Lt(Be.paint_raster["raster-array-band"]),"raster-elevation":new Lt(Be.paint_raster["raster-elevation"]),"raster-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof dA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(h)||a===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=ar({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,h])}}let pA,mA,gA,_A,yA;class vA extends mo{constructor(e,i,a,h){super(e,{layout:pA||(pA=new Or({visibility:new Lt(Be["layout_raster-particle"].visibility)})),paint:mA||(mA=new Or({"raster-particle-array-band":new Lt(Be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Lt(Be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Eh(Be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Lt(Be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Lt(Be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Lt(Be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Lt(Be["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Lt(Be["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp(),this.lastInvalidatedAt=ia.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ar({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ia.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class CO extends mo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function lw(r,e,i){const a=[0,0,1],h=Qa([]);return Ra(h,h,i?-Fe(r)+Math.PI:Fe(r)),Bs(h,h,-Fe(e)),Jo(a,a,h),Qt(a,a)}const xA={None:0,Model:1,Symbol:2,FillExtrusion:4};class L0{constructor(e,i,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function cw(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class bA{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class wA{constructor(){this.instancedDataArray=new Up,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class uw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,a,h){this.tileToMeter=qe(a);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:x,index:E,sourceLayerIndex:A}of e){const M=x??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),P=Mt(_,g);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom,{worldview:this.worldview}),P,a))continue;const L={id:M,sourceLayerIndex:A,index:E,geometry:g?P.geometry:Yt(_,a,h),properties:_.properties,type:_.type,patterns:{}},B=this.addFeature(L,L.geometry,P);B&&i.featureIndex.insert(_,L.geometry,E,A,this.index,this.instancesPerModel[B].instancedDataArray.length,Bt/32)}this.lookup=null}update(e,i,a,h){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const x in e)_.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(_.features[_.idToFeaturesIndex[x]],e[x],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const h of a.features){const g=this.layers[0],_=h.feature,x=this.canonical,E=g.paint.get("model-rotation").evaluate(_,{},x),A=g.paint.get("model-scale").evaluate(_,{},x),M=g.paint.get("model-translation").evaluate(_,{},x);ys(h.rotation,E)&&ys(h.scale,A)&&ys(h.translation,M)||(this.evaluate(h,h.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const g=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if($d(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const x in this.instancesPerModel){const E=this.instancesPerModel[x],A=E.instancedDataArray;for(const M of E.features){const P=M.instancedDataOffset,L=M.instancedDataCount;for(let B=0;B<L;B++){const V=16*(B+P);let Z=A.float32[V+0];const K=Z>Bt;Z=K?Z-Bt:Z;const Q=Math.floor(Z),oe=A.float32[V+1];let le=!1;for(const he of this.activeReplacements)if(!Xp(he,a,xA.Model,h)&&!(he.min.x>Q||Q>he.max.x||he.min.y>oe||oe>he.max.y)&&(le=z_(Ag(Q,oe,e.canonical,he.footprintTileId.canonical),he.footprint),le))break;A.float32[V]=le?Z+Bt:Z,_=_||le!==K}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,nD.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const h=this.layers[0],g=h.layout.get("model-id").evaluate(a,{},this.canonical);if(!g)return Ki(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),g;(cw(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new wA);const _=this.instancesPerModel[g],x=_.instancedDataArray,E=new bA(a,x.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=Bt||M.y<0||M.y>=Bt)continue;if(this.lookupDim!==0){const L=(this.lookupDim-1)/Bt,B=this.lookupDim*(M.y*L|0)+M.x*L|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}}this.instanceCount++;const P=x.length;x.resize(P+1),_.instancesEvaluatedElevation.push(0),x.float32[16*P]=M.x,x.float32[16*P+1]=M.y}return E.instancedDataCount=_.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(E),this.evaluate(E,{},_,!1)),g}getModelUris(){return this.modelUris}evaluate(e,i,a,h){const g=this.layers[0],_=e.feature,x=this.canonical,E=e.rotation=g.paint.get("model-rotation").evaluate(_,i,x),A=e.scale=g.paint.get("model-scale").evaluate(_,i,x),M=e.translation=g.paint.get("model-translation").evaluate(_,i,x),P=g.paint.get("model-color").evaluate(_,i,x);P.a=g.paint.get("model-color-mix-intensity").evaluate(_,i,x);const L=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),$E(L,E,A);const B=Math.round(100*P.a)+P.b/1.05;for(let V=0;V<e.instancedDataCount;++V){const Z=e.instancedDataOffset+V,K=16*Z,Q=a.instancedDataArray.float32;let oe=0;h&&(oe=Q[K+6]-a.instancesEvaluatedElevation[Z]);const le=0|Q[K+1];Q[K]=(0|Q[K])+P.r/1.05,Q[K+1]=le+P.g/1.05,Q[K+2]=B,Q[K+3]=1/(x.z>10?this.tileToMeter:qe(x,le)),Q[K+4]=M[0],Q[K+5]=M[1],Q[K+6]=M[2]+oe,Q[K+7]=L[0],Q[K+8]=L[1],Q[K+9]=L[2],Q[K+10]=L[4],Q[K+11]=L[5],Q[K+12]=L[6],Q[K+13]=L[8],Q[K+14]=L[9],Q[K+15]=L[10],a.instancesEvaluatedElevation[Z]=M[2]}}}let TA,EA;Xt(uw,"ModelBucket",{omit:["layers"]}),Xt(wA,"PerModelAttributes"),Xt(bA,"ModelFeature");class J_{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const h=a||e.findDEMTileFor(i);if(!h||!h.dem)return;const g=h.dem,_=h.tileID,x=1<<i.canonical.z-_.canonical.z;return new J_(h,g.dim/Bt/x,[(i.canonical.x/x-_.canonical.x)*g.dim,(i.canonical.y/x-_.canonical.y)*g.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new Ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,h){const g=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(_),A=this._dem;return h=!!h,a?Ii(Ii(A.get(x,E,h),A.get(x,E+1,h),_-E),Ii(A.get(x+1,E,h),A.get(x+1,E+1,h),_-E),g-x):A.get(x,E,h)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ye(1,e)*this._dem.stride}}const hw=new Float32Array(262144),kg=new Uint8Array(262144);function SA(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,SA(i));return e}function AA(r,e,i){if(r.meshes)for(const a of r.meshes){if(a.aabb.min[0]===1/0)continue;const h=Ci.applyTransform(a.aabb,r.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(r.children)for(const a of r.children)AA(a,e,i)}const IA=["","wall","door","roof","window","lamp","logo"];class CA{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:SA(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Ci.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class z0{constructor(e,i,a,h,g,_,x,E){this.id=a,this.layers=e,this.layerIds=this.layers.map((A=>A.fqid)),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.modelTraits|=$_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=$_.HasMapboxMeshFeatures),g&&(this.modelTraits|=$_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new CA(A)),AA(A,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const h=a.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!el(e,this.states))for(const h of a)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const h=a.node;this.uploaded?this.updatePbrBuffer(h):F1(h,e,!0)}for(const a of i)m0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const h=e.transform.projectionOptions,g=e.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Cv(a.paint.get("model-color").value,_)||Cv(a.paint.get("model-color-mix-intensity").value,_)||Cv(a.paint.get("model-roughness").value,_)||Cv(a.paint.get("model-emissive-strength").value,_)||Cv(a.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=h,this.brightness=g;const x=this.getNodesInfo();for(const E of x)E.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),h=this.id.canonical;for(const g of a){const _=g.feature;g.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},h),g.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},h)}}evaluate(e,i){const a=this.getNodesInfo();for(const h of a){if(!h.node.meshes)continue;const g=h.feature,_=i&&i[g.id];if(el(_,h.state))continue;h.state=structuredClone(_);const x=h.node.meshes&&h.node.meshes[0].featureData,E=h.evaluatedColor[2],A=h.evaluatedRMEA[2],M=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let P=0;P<IA.length;P++){const L=IA[P];L.length&&(g.properties.part=L);const B=e.paint.get("model-color").evaluate(g,_,M).toPremultipliedRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(g,_,M);h.evaluatedColor[P]=[B.r,B.g,B.b,V],h.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(g,_,M),h.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(g,_,M),h.evaluatedRMEA[P][3]=B.a,h.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,M),!h.hasTranslucentParts&&B.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,MO(h,E!==h.evaluatedColor[2]||A!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(g,_,M);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(g,_,M),h.evaluatedScale=e.paint.get("model-scale").evaluate(g,_,M),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,h){const g=e.findDEMTileFor(a);if(g&&(g.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=J_.create(e,a,g);if(!_)return;this.modelTraits&$_.HasMapboxMeshFeatures&&this.updateDEM(e,_,a,h);for(const x of this.getNodesInfo()){const E=x.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const A=E.footprint.vertices;let M=_.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)M=Math.min(M,_.getElevationAt(A[P].x,A[P].y,!0,!0));E.elevation=M}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,h){let g=i._dem._modifiedForSources[h];if(g===void 0&&(i._dem._modifiedForSources[h]=[],g=i._dem._modifiedForSources[h]),g.includes(a.canonical))return;const _=i._dem.dim;g.push(a.canonical);let x=!1;for(const E of this.getNodesInfo()){const A=E.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,P=i.tileCoordToPixel(M.min.x,M.min.y),L=i.tileCoordToPixel(M.max.x,M.max.y),B=Math.min(Math.min(_-L.y,P.x),Math.min(P.y,_-L.x));if(B<0)continue;const V=Ie(B,2,5);let Z=Math.max(0,P.x-V),K=Math.max(0,P.y-V),Q=Math.min(L.x+V,_-1),oe=Math.min(L.y+V,_-1);for(let Se=K;Se<=oe;++Se)for(let Me=Z;Me<=Q;++Me)kg[Se*_+Me]=255;let le=0,he=0;for(let Se=0;Se<M.cellsY;++Se)for(let Me=0;Me<M.cellsX;++Me){if(!M.cells[Se*M.cellsX+Me])continue;const De=i.tileCoordToPixel(M.min.x+Me/M.xScale,M.min.y+Se/M.yScale),Ne=i.tileCoordToPixel(M.min.x+(Me+1)/M.xScale,M.min.y+(Se+1)/M.yScale);for(let ft=De.y;ft<=Math.min(Ne.y+1,_-1);++ft)for(let je=De.x;je<=Math.min(Ne.x+1,_-1);++je)kg[ft*_+je]===255&&(kg[ft*_+je]=0,le+=i.getElevationAtPixel(je,ft),he++)}const Ee=le/he;Z=Math.max(1,P.x-V),K=Math.max(1,P.y-V),Q=Math.min(L.x+V,_-2),oe=Math.min(L.y+V,_-2),x=!0;for(let Se=K;Se<=oe;++Se)for(let Me=Z;Me<=Q;++Me)kg[Se*_+Me]===0&&(hw[Se*_+Me]=i._dem.set(Me,Se,Ee));for(let Se=1;Se<V;++Se){Z=Math.max(1,P.x-Se),K=Math.max(1,P.y-Se),Q=Math.min(L.x+Se,_-2),oe=Math.min(L.y+Se,_-2);for(let Me=K;Me<=oe;++Me)for(let De=Z;De<=Q;++De){const Ne=Me*_+De;if(kg[Ne]===255){let ft=0,je=0,mt=-1,It=-1;for(let vt=-1;vt<=1;++vt)for(let Et=-1;Et<=1;++Et){const Ot=(Me+vt)*_+De+Et;if(kg[Ot]>=Se)continue;const ut=hw[Ot],St=Math.abs(ut);St>je&&(ft=ut,je=St,mt=Et,It=vt)}if(je>.1){const vt=1-(Se+.5*Math.abs(mt*It))/V;let Et=i._dem.get(De,Me)+ft*vt;const Ot=i._dem.get(De+mt,Me+It),ut=i._dem.get(De-mt,Me-It,!0);(Et-Ot)*(Et-ut)>0&&(Et=(Ot+ut)/2),hw[Ne]=i._dem.set(De,Me,Et),kg[Ne]=Se}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ia.now())}setFilter(e){this.filter=e?Dd(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Xn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)m0(i.node),B1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const g=h.node.footprint;h.hiddenByReplacement=!!g&&!a.find((_=>_.footprint===g))}}getHeightAtTileCoord(e,i){const a=[],h=[0,0,0],g=Ge([]);for(const _ of this.getNodesInfo()){const x=_.node.meshes[0],E=x.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};Qe(g,_.node.matrix),h[0]=e,h[1]=i,ur(h,h,g);const A=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Og|0,M=Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Og|0)*Og+Math.min(63,A),P=x.heightmap[M];if(!(P<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:P,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ct(e,i),new Ct(e,i),a),a.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Cv(r,e){return r instanceof Nu&&!r.isLightConstant&&e}function RO(r,e,i,a,h,g,_,x){let E=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(E=Ii(E,255*i[0],i[3]),A=Ii(A,255*i[1],i[3]),M=Ii(M,255*i[2],i[3]));const P=E<<8|A,L=M<<8|Math.floor(255*a[3]),B=(function(Se){const Me=Ie(Se,0,2);return Math.min(Math.round(.5*Me*255),255)})(a[2])<<8|15*a[0]<<4|15*a[1],V=Ie(h[0],0,1),Z=Ie(h[1],0,1),K=Ie(h[2],0,1),Q=Ie(h[3],0,1);let oe,le,he,Ee;if(V!==Z&&_!==g&&Z!==V){const Se=_-g;le=1/(Se*(Z-V)),he=-(g+Se*V)/(Se*(Z-V));const Me=Ie(h[4],-1,1);Ee=Math.pow(10,Me),oe=255*K<<8|255*Q}else oe=65535,le=0,he=1,Ee=1;if(r.emplaceBack(P,L,B,oe,le,he,Ee),x){const Se=x.length;x.clear();for(let Me=0;Me<Se;Me++)x.emplaceBack(P,L,B,oe,le,he,Ee)}}function MO(r,e,i){const a=r.node;let h=0;const g=i&$_.HasMeshoptCompression;for(const _ of a.meshes){if(a.lights&&a.lightMeshIndex===h||!_.featureData)continue;_.featureArray=new Hu,_.featureArray.reserve(_.featureData.length);let x=e;for(const E of _.featureData){const A=g?65535&E:E>>16&65535,M=g?E>>16&65535:65535&E,P=(15&M)<8?15&M:0,L=r.evaluatedRMEA[P],B=r.evaluatedColor[P],V=r.emissionHeightBasedParams[P];let Z;if(x&&P===2&&a.lights&&(Z=new Hu,Z.resize(10*a.lights.length)),RO(_.featureArray,A,B,L,V,_.aabb.min[2],_.aabb.max[2],Z),Z&&x){x=!1;const K=a.meshes[a.lightMeshIndex];K.featureArray=Z,K.featureArray._trim()}}_.featureArray._trim(),h++}}function RA(r,e,i,a){const h=1<<r.z;e.lat=ge((a/Bt+r.y)/h),e.lng=ve((i/Bt+r.x)/h)}function PO(r,e,i,a){const h=r.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let g=Number.MAX_VALUE;const _=h.node,x=i.tile,E=a.calculatePosMatrix(x.tileID.toUnwrapped(),a.worldSize),A=h.evaluatedScale;let M=0;a.elevation&&_.elevation&&(M=_.elevation*a.elevation.exaggeration()),wt(E,E,[(_.anchor?_.anchor[0]:0)*(A[0]-1),(_.anchor?_.anchor[1]:0)*(A[1]-1),M]),jt(E,E,A);const P=i.queryGeometry,L=P.isPointQuery()?P.screenBounds:P.screenGeometry,B=function(Z){const K=xt([],E,Z.matrix);xt(K,a.expandedFarZProjMatrix,K);for(let Q=0;Q<Z.meshes.length;++Q){const oe=Z.meshes[Q];if(Q===Z.lightMeshIndex)continue;const le=ZE(L,a,K,oe.aabb);le!=null&&(g=Math.min(le,g))}if(Z.children)for(const Q of Z.children)B(Q)};if(B(_),g===Number.MAX_VALUE)return;const V=new W(0,0);return RA(x.tileID.canonical,V,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:g,position:V,feature:h.feature}}Xt(z0,"Tiled3dModelBucket",{omit:["layers"]}),Xt(CA,"Tiled3dModelFeature");const DO={circle:class extends mo{constructor(r,e,i,a){super(r,{layout:ec||(ec=new Or({"circle-sort-key":new $t(Be.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Lt(Be.layout_circle["circle-elevation-reference"]),visibility:new Lt(Be.layout_circle.visibility)})),paint:Dc||(Dc=new Or({"circle-radius":new $t(Be.paint_circle["circle-radius"]),"circle-color":new $t(Be.paint_circle["circle-color"]),"circle-blur":new $t(Be.paint_circle["circle-blur"]),"circle-opacity":new $t(Be.paint_circle["circle-opacity"]),"circle-translate":new Lt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(Be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Lt(Be.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(r){return new As(r)}queryRadius(r){const e=r;return Ql("circle-radius",this,e)+Ql("circle-stroke-width",this,e)+fa(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,h,g,_,x){const E=_l(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Gy(r,a,g,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const a=qx(this);return{config:new $u(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends mo{createBucket(r){return new b_(r)}constructor(r,e,i,a){super(r,{layout:Hy||(Hy=new Or({visibility:new Lt(Be.layout_heatmap.visibility)})),paint:Wy||(Wy=new Or({"heatmap-radius":new $t(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eh(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Be.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ar({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Ql("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,a,h,g,_,x){const E=this.paint.get("heatmap-radius").evaluate(e,i);return Gy(r,a,g,_,x,!0,!0,new Ct(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends mo{constructor(r,e,i,a){super(r,{layout:$x||($x=new Or({visibility:new Lt(Be.layout_hillshade.visibility)})),paint:w_||(w_=new Or({"hillshade-illumination-direction":new Lt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Lt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Lt(Be.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends mo{constructor(r,e,i,a){super(r,{layout:rv||(rv=new Or({"fill-sort-key":new $t(Be.layout_fill["fill-sort-key"]),visibility:new Lt(Be.layout_fill.visibility),"fill-elevation-reference":new Lt(Be.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $t(Be.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Tg||(Tg=new Or({"fill-antialias":new Lt(Be.paint_fill["fill-antialias"]),"fill-opacity":new $t(Be.paint_fill["fill-opacity"]),"fill-color":new $t(Be.paint_fill["fill-color"]),"fill-outline-color":new $t(Be.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t(Be.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Lt(Be.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Lt(Be.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $t(Be.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $t(Be.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $t(Be.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new yl(r)}queryRadius(){return fa(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,h,g){return!r.queryGeometry.isAboveHorizon&&Lr(Jl(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends mo{constructor(r,e,i,a){super(r,{layout:Jp||(Jp=new Or({visibility:new Lt(Be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Lt(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:em||(em=new Or({"fill-extrusion-opacity":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $t(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $t(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $t(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $t(Be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $t(Be["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Lt(Be["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new U_(r)}queryRadius(){return fa(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,a,h,g,_,x,E){const A=_l(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),L=[0,0],B=x&&g.elevation,V=g.elevation?g.elevation.exaggeration():1,Z=r.tile.getBucket(this);if(B&&Z instanceof U_){const he=Z.centroidVertexArray,Ee=E+1;Ee<he.length&&(L[0]=he.geta_centroid_pos0(Ee),L[1]=he.geta_centroid_pos1(Ee))}if(L[0]===0&&L[1]===1)return!1;g.projection.name==="globe"&&(a=Hh([a],[new Ct(0,0),new Ct(Bt,Bt)],r.tileID.canonical).map((he=>he.polygon)).flat());const K=B?x:null,[Q,oe]=(function(he,Ee,Se,Me,De,Ne,ft,je,mt,It,vt){return he.projection.name==="globe"?(function(Et,Ot,ut,St,rt,Je,kt,Dt,xi,ii,hi){const Ut=[],yi=[],ji=Et.projection.upVectorScale(hi,Et.center.lat,Et.worldSize).metersToTile,Zt=[0,0,0,1],pi=[0,0,0,1],Di=(rn,Yi,oi,Zi)=>{rn[0]=Yi,rn[1]=oi,rn[2]=Zi,rn[3]=1},$i=qh();ut>0&&(ut+=$i),St+=$i;for(const rn of Ot){const Yi=[],oi=[];for(const Zi of rn){const An=Zi.x+rt.x,fe=Zi.y+rt.y,pe=Et.projection.projectTilePoint(An,fe,hi),it=Et.projection.upVector(hi,Zi.x,Zi.y);let dt=ut,Wt=St;if(kt){const Ht=Mg(An,fe,ut,St,kt,Dt,xi,ii);dt+=Ht.base,Wt+=Ht.top}ut!==0?Di(Zt,pe.x+it[0]*ji*dt,pe.y+it[1]*ji*dt,pe.z+it[2]*ji*dt):Di(Zt,pe.x,pe.y,pe.z),Di(pi,pe.x+it[0]*ji*Wt,pe.y+it[1]*ji*Wt,pe.z+it[2]*ji*Wt),ur(Zt,Zt,Je),ur(pi,pi,Je),Yi.push(new vl(Zt[0],Zt[1],Zt[2])),oi.push(new vl(pi[0],pi[1],pi[2]))}Ut.push(Yi),yi.push(oi)}return[Ut,yi]})(he,Ee,Se,Me,De,Ne,ft,je,mt,It,vt):ft?(function(Et,Ot,ut,St,rt,Je,kt,Dt,xi){const ii=[],hi=[],Ut=[0,0,0,1];for(const yi of Et){const ji=[],Zt=[];for(const pi of yi){const Di=pi.x+St.x,$i=pi.y+St.y,rn=Mg(Di,$i,Ot,ut,Je,kt,Dt,xi);Ut[0]=Di,Ut[1]=$i,Ut[2]=rn.base,Ut[3]=1,Fs(Ut,Ut,rt),Ut[3]=Math.max(Ut[3],1e-5);const Yi=new vl(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Ut[0]=Di,Ut[1]=$i,Ut[2]=rn.top,Ut[3]=1,Fs(Ut,Ut,rt),Ut[3]=Math.max(Ut[3],1e-5);const oi=new vl(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);ji.push(Yi),Zt.push(oi)}ii.push(ji),hi.push(Zt)}return[ii,hi]})(Ee,Se,Me,De,Ne,ft,je,mt,It):(function(Et,Ot,ut,St,rt){const Je=[],kt=[],Dt=rt[8]*Ot,xi=rt[9]*Ot,ii=rt[10]*Ot,hi=rt[11]*Ot,Ut=rt[8]*ut,yi=rt[9]*ut,ji=rt[10]*ut,Zt=rt[11]*ut;for(const pi of Et){const Di=[],$i=[];for(const rn of pi){const Yi=rn.x+St.x,oi=rn.y+St.y,Zi=rt[0]*Yi+rt[4]*oi+rt[12],An=rt[1]*Yi+rt[5]*oi+rt[13],fe=rt[2]*Yi+rt[6]*oi+rt[14],pe=rt[3]*Yi+rt[7]*oi+rt[15],it=Zi+Dt,dt=An+xi,Wt=fe+ii,Ht=Math.max(pe+hi,1e-5),ri=Zi+Ut,Ti=An+yi,sn=fe+ji,an=Math.max(pe+Zt,1e-5);Di.push(new vl(it/Ht,dt/Ht,Wt/Ht)),$i.push(new vl(ri/an,Ti/an,sn/an))}Je.push(Di),kt.push($i)}return[Je,kt]})(Ee,Se,Me,De,Ne)})(g,a,P,M,A,_,K,L,V,g.center.lat,r.tileID.canonical),le=r.queryGeometry;return(function(he,Ee,Se){let Me=1/0;Lr(Se,Ee)&&(Me=u0(Se,Ee[0]));for(let De=0;De<Ee.length;De++){const Ne=Ee[De],ft=he[De];for(let je=0;je<Ne.length-1;je++){const mt=Ne[je],It=[mt,Ne[je+1],ft[je+1],ft[je],mt];Wo(Se,It)&&(Me=Math.min(Me,u0(Se,It)))}}return Me!==1/0&&Me})(Q,oe,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends mo{constructor(r,e,i,a){super(r,{layout:rS||(rS=new Or({visibility:new Lt(Be.layout_building.visibility),"building-facade":new $t(Be.layout_building["building-facade"]),"building-facade-floors":new $t(Be.layout_building["building-facade-floors"]),"building-facade-unit-width":new $t(Be.layout_building["building-facade-unit-width"]),"building-facade-window":new $t(Be.layout_building["building-facade-window"]),"building-roof-shape":new $t(Be.layout_building["building-roof-shape"]),"building-height":new $t(Be.layout_building["building-height"]),"building-base":new $t(Be.layout_building["building-base"]),"building-flood-light-wall-radius":new $t(Be.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new $t(Be.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new $t(Be.layout_building["building-flip-roof-orientation"])})),paint:sS||(sS=new Or({"building-opacity":new Lt(Be.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Lt(Be.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Lt(Be.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Lt(Be.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Lt(Be.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Lt(Be.paint_building["building-vertical-scale"]),"building-cast-shadows":new Lt(Be.paint_building["building-cast-shadows"]),"building-color":new $t(Be.paint_building["building-color"]),"building-emissive-strength":new $t(Be.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Lt(Be.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Lt(Be.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Lt(Be.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Lt(Be.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Lt(Be.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new nS(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}},line:class extends mo{constructor(r,e,i,a){const h=mS();super(r,h,e,i,a),h.layout&&(this.layout=new Bu(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof md,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(gv)return gv;const i=mS();return gv=new MD(i.paint.properties["line-width"].specification),gv.useIntegerZoom=!0,gv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new G1(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const a=fS(this);return{config:new $u(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(r){const e=r,i=gS(Ql("line-width",this,e),Ql("line-gap-width",this,e)),a=Ql("line-offset",this,e);return i/2+Math.abs(a)+fa(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,h,g){if(r.queryGeometry.isAboveHorizon)return!1;const _=Jl(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*gS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(a=(function(A,M){const P=[],L=new Ct(0,0);for(let B=0;B<A.length;B++){const V=A[B],Z=[];for(let K=0;K<V.length;K++){const Q=V[K],oe=V[K+1],le=K===0?L:Q.sub(V[K-1])._unit()._perp(),he=K===V.length-1?L:oe.sub(Q)._unit()._perp(),Ee=le._add(he)._unit();Ee._mult(1/(Ee.x*he.x+Ee.y*he.y)),Z.push(Ee._mult(M)._add(Q))}P.push(Z)}return P})(a,E*r.pixelToTileUnitsFactor)),(function(A,M,P){for(let L=0;L<M.length;L++){const B=M[L];if(A.length>=3){for(let V=0;V<B.length;V++)if(Sr(A,B[V]))return!0}if(qs(A,B,P))return!0}return!1})(_,a,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:P0,background:class extends mo{constructor(r,e,i,a){super(r,{layout:aA||(aA=new Or({visibility:new Lt(Be.layout_background.visibility)})),paint:lA||(lA=new Or({"background-pitch-alignment":new Lt(Be.paint_background["background-pitch-alignment"]),"background-color":new Lt(Be.paint_background["background-color"]),"background-pattern":new Lt(Be.paint_background["background-pattern"]),"background-opacity":new Lt(Be.paint_background["background-opacity"]),"background-emissive-strength":new Lt(Be.paint_background["background-emissive-strength"]),"background-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:fA,"raster-particle":vA,sky:class extends mo{constructor(r,e,i,a){super(r,{layout:gA||(gA=new Or({visibility:new Lt(Be.layout_sky.visibility)})),paint:_A||(_A=new Or({"sky-type":new Lt(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new Lt(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Lt(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Lt(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Lt(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eh(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Lt(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Lt(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Lt(Be.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ar({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),h=!a,g=r.style.light,_=g.properties.get("position");return h&&g.properties.get("anchor")==="viewport"&&Ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?lw(_.azimuthal,90-_.polar,e):lw(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return lw(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends mo{constructor(r,e,i,a){super(r,{paint:yA||(yA=new Or({}))},e,null)}},model:class extends mo{constructor(r,e,i,a){super(r,{layout:TA||(TA=new Or({visibility:new Lt(Be.layout_model.visibility),"model-id":new $t(Be.layout_model["model-id"])})),paint:EA||(EA=new Or({"model-opacity":new $t(Be.paint_model["model-opacity"]),"model-rotation":new $t(Be.paint_model["model-rotation"]),"model-scale":new $t(Be.paint_model["model-scale"]),"model-translation":new $t(Be.paint_model["model-translation"]),"model-color":new $t(Be.paint_model["model-color"]),"model-color-mix-intensity":new $t(Be.paint_model["model-color-mix-intensity"]),"model-type":new Lt(Be.paint_model["model-type"]),"model-cast-shadows":new Lt(Be.paint_model["model-cast-shadows"]),"model-receive-shadows":new Lt(Be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Lt(Be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $t(Be.paint_model["model-emissive-strength"]),"model-roughness":new $t(Be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $t(Be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Lt(Be.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Lt(Be.paint_model["model-front-cutoff"]),"model-elevation-reference":new Lt(Be.paint_model["model-elevation-reference"]),"model-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new uw(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof z0?Bt-1:0}queryIntersectsFeature(r,e,i,a,h,g){if(!this.modelManager)return!1;const _=this.modelManager,x=r.tile.getBucket(this);if(!(x&&x instanceof uw))return!1;for(const E in x.instancesPerModel){const A=x.instancesPerModel[E],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const P=A.features[A.idToFeaturesIndex[M]],L=_.getModel(E,this.scope);if(!L)return!1;let B=at();const V=new W(0,0),Z=x.canonical;let K=Number.MAX_VALUE;for(let Q=0;Q<P.instancedDataCount;++Q){const oe=16*(P.instancedDataOffset+Q),le=A.instancedDataArray.float32,he=[le[oe+4],le[oe+5],le[oe+6]];RA(Z,V,le[oe],0|le[oe+1]),XE(B,L,g,V,P.rotation,P.scale,he,!1,!1,!1),g.projection.name==="globe"&&(B=N1(B,g));const Ee=xt([],g.projMatrix,B),Se=r.queryGeometry,Me=ZE(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,g,Ee,L.aabb);Me!=null&&(K=Math.min(Me,K))}return K!==Number.MAX_VALUE&&K}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof iu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends mo{constructor(r,e,i,a){super(r,{layout:Ku||(Ku=new Or({"clip-layer-types":new Lt(Be.layout_clip["clip-layer-types"]),"clip-layer-scope":new Lt(Be.layout_clip["clip-layer-scope"])})),paint:i0||(i0=new Or({}))},e,i,a)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new sv(r)}is3D(r){return!0}}},dw=new In(0,0,0),fw={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},pw={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},k0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},OO={PAINT_ORDER_FILL_AND_STROKE:1},Rv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},MA={MASK_TYPE_LUMINANCE:1};function LO(r,e,i){r===1&&e.icons.push((function(a,h){return(function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:x}=_;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=g.usvg_tree.width),x.height==null&&(x.height=x.width)}if(_.text_placeholder){const{text_placeholder:x}=_;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return _.stretch_x&&_.stretch_x.length&&PA(_,"x"),_.stretch_y&&_.stretch_y.length&&PA(_,"y"),g})(a.readFields(zO,{name:void 0},h))})(i,i.readVarint()+i.pos))}function PA(r,e){const i=[],a=r[`stretch_${e}`];let h=null;for(let g=0;g<a.length;g++)h===null?h=i.length===0?a[0]:i[i.length-1][1]+a[g]:(i.push([h,h+a[g]]),h=null);r[`stretch_${e}_areas`]=i}function zO(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(a,h){return a.readFields(kO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(a,h){return a.readFields(BO,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function kO(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=DA(i,i.readVarint()+i.pos):r===4?e.variables.push((function(a,h){return a.readFields(FO,{name:void 0},h)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=DA(i,i.readVarint()+i.pos))}function DA(r,e){return r.readFields(NO,{},e)}function NO(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function FO(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=B0(i.readVarint()),e.value="rgb_color")}function BO(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(N0(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(a,h){return a.readFields(WO,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(a,h){return a.readFields(ZO,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(a,h){return a.readFields(XO,{children:[]},h)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(a,h){const g=a.readFields(YO,{left:0,width:20,mask_type:MA.MASK_TYPE_LUMINANCE,children:[]},h);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g})(i,i.readVarint()+i.pos))}function N0(r,e){return r.readFields(VO,{},e)}function VO(r,e,i){r===1?(e.group=(function(a,h){return a.readFields(UO,{opacity:255,children:[]},h)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(a,h){return a.readFields(GO,{paint_order:1,commands:[],step:1,diffs:[],rule:fw.PATH_RULE_NON_ZERO},h)})(i,i.readVarint()+i.pos),e.node="path")}function UO(r,e,i){r===1?e.transform=F0(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(N0(i,i.readVarint()+i.pos))}function F0(r,e){return r.readFields(jO,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function jO(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function GO(r,e,i){r===1?e.fill=(function(a,h){return a.readFields(qO,{rgb_color:dw,paint:"rgb_color",opacity:255},h)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(a,h){return a.readFields(HO,{rgb_color:dw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function qO(r,e,i){r===1?(e.rgb_color=B0(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function B0(r){return new In((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function HO(r,e,i){r===1?(e.rgb_color=B0(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function WO(r,e,i){r===1?e.transform=F0(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(OA(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function OA(r,e){return r.readFields($O,{offset:0,opacity:255,rgb_color:dw},e)}function $O(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=B0(i.readVarint()))}function ZO(r,e,i){r===1?e.transform=F0(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(OA(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function XO(r,e,i){r===1?e.transform=F0(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(N0(i,i.readVarint()+i.pos))}function YO(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(N0(i,i.readVarint()+i.pos))}class KO{static calculate(e={},i=[]){const a=new Map,h=new Map;if(Object.keys(e).length===0)return a;i.forEach((g=>{h.set(g.name,g.rgb_color||new In(0,0,0))}));for(const[g,_]of Object.entries(e))h.has(g)?a.set(h.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return a}}function ey(r,e=255,i){const a=e/255,h=r.toString(),g=i.has(h)?i.get(h).clone():r.clone();return g.a*=a,g.toString()}function Mv(r,e){if(!ko()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function QO(r,e){const i=KO.calculate(e.params,r.metadata?r.metadata.variables:[]),a=r.usvg_tree,h=a.width,g=a.height,_=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(h*_.a)),E=Math.max(1,Math.round(g*_.d)),A=new DOMMatrix([x/h,0,0,E/g,0,0]),M=Mv(x,E).getContext("2d");return mw(M,A,a,a,i),M.getImageData(0,0,x,E)}function mw(r,e,i,a,h){for(const g of a.children)LA(r,e,i,g,h)}function LA(r,e,i,a,h){a.group?(r.save(),(function(g,_,x,E,A){const M=E.mask_idx!=null?x.masks[E.mask_idx]:null,P=E.clip_path_idx!=null?x.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=ty(E.transform).preMultiplySelf(_)),!(function(V,Z,K){return V.opacity!==255||Z||K})(E,P!=null,M!=null))return void mw(g,_,x,E,A);const L=Mv(g.canvas.width,g.canvas.height),B=L.getContext("2d");mw(B,_,x,E,A),P&&UA(B,_,x,P),M&&jA(B,_,x,M,A),g.globalAlpha=E.opacity/255,g.drawImage(L,0,0)})(r,e,i,a.group,h),r.restore()):a.path&&(r.save(),(function(g,_,x,E,A){g.setTransform(_),E.paint_order===OO.PAINT_ORDER_FILL_AND_STROKE?(zA(g,x,E,A),NA(g,x,E,A)):(NA(g,x,E,A),zA(g,x,E,A))})(r,e,i,a.path,h),r.restore())}function zA(r,e,i,a){const h=i.fill;if(!h)return;const g=h.opacity/255;switch(r.save(),r.beginPath(),GA(i,r),h.paint){case"rgb_color":r.fillStyle=ey(h.rgb_color,h.opacity,a);break;case"linear_gradient_idx":{const _=e.linear_gradients[h.linear_gradient_idx];_.transform&&r.setTransform(ty(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=FA(r,_,g,a);break}case"radial_gradient_idx":{const _=e.radial_gradients[h.radial_gradient_idx];_.transform&&r.setTransform(ty(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=BA(r,_,g,a)}}r.fill(kA(i)),r.restore()}function kA(r){return r.rule===fw.PATH_RULE_NON_ZERO?"nonzero":r.rule===fw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function NA(r,e,i,a){const h=i.stroke;if(!h)return;const g=qA(i);r.lineWidth=h.width,r.miterLimit=h.miterlimit,r.setLineDash(h.dasharray),r.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":r.strokeStyle=ey(h.rgb_color,h.opacity,a);break;case"linear_gradient_idx":r.strokeStyle=FA(r,e.linear_gradients[h.linear_gradient_idx],_,a,!0);break;case"radial_gradient_idx":r.strokeStyle=BA(r,e.radial_gradients[h.radial_gradient_idx],_,a,!0)}switch(h.linejoin){case k0.LINE_JOIN_MITER_CLIP:case k0.LINE_JOIN_MITER:r.lineJoin="miter";break;case k0.LINE_JOIN_ROUND:r.lineJoin="round";break;case k0.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(h.linecap){case pw.LINE_CAP_BUTT:r.lineCap="butt";break;case pw.LINE_CAP_ROUND:r.lineCap="round";break;case pw.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(g)}function FA(r,e,i,a,h=!1){if(e.stops.length===1){const L=e.stops[0];return ey(L.rgb_color,L.opacity*i,a)}const{x1:g,y1:_,x2:x,y2:E}=e;let A=new DOMPoint(g,_),M=new DOMPoint(x,E);if(h){const L=ty(e.transform);A=L.transformPoint(A),M=L.transformPoint(M)}const P=r.createLinearGradient(A.x,A.y,M.x,M.y);for(const L of e.stops)P.addColorStop(L.offset,ey(L.rgb_color,L.opacity*i,a));return P}function BA(r,e,i,a,h=!1){if(e.stops.length===1){const Q=e.stops[0];return ey(Q.rgb_color,Q.opacity*i,a)}const g=ty(e.transform),{fx:_,fy:x,fr:E,cx:A,cy:M,r:P}=e;let L=new DOMPoint(_,x),B=new DOMPoint(A,M),V=E,Z=P;if(h){L=g.transformPoint(L),B=g.transformPoint(B);const Q=(g.a+g.d)/2;V=E*Q,Z=e.r*Q}const K=r.createRadialGradient(L.x,L.y,V,B.x,B.y,Z);for(const Q of e.stops)K.addColorStop(Q.offset,ey(Q.rgb_color,Q.opacity*i,a));return K}function VA(r,e,i,a){const h=a.transform?ty(a.transform).preMultiplySelf(e):e,g=Mv(r.canvas.width,r.canvas.height),_=g.getContext("2d");for(const E of a.children)if(E.group)VA(_,h,i,E.group);else if(E.path){const A=E.path,M=new Path2D;M.addPath(qA(A),h),_.fill(M,kA(A))}const x=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;x&&UA(_,h,i,x),r.globalCompositeOperation="source-over",r.drawImage(g,0,0)}function UA(r,e,i,a){const h=Mv(r.canvas.width,r.canvas.height);VA(h.getContext("2d"),e,i,a),r.globalCompositeOperation="destination-in",r.drawImage(h,0,0)}function jA(r,e,i,a,h){if(a.children.length===0)return;const g=a.mask_idx!=null?i.masks[a.mask_idx]:null;g&&jA(r,e,i,g,h);const _=r.canvas.width,x=r.canvas.height,E=Mv(_,x),A=E.getContext("2d"),M=a.width,P=a.height,L=a.left,B=a.top,V=new Path2D,Z=new Path2D;Z.rect(L,B,M,P),V.addPath(Z,e),A.clip(V);for(const oe of a.children)LA(A,e,i,oe,h);const K=A.getImageData(0,0,_,x),Q=K.data;if(a.mask_type===MA.MASK_TYPE_LUMINANCE)for(let oe=0;oe<Q.length;oe+=4)Q[oe+3]=Q[oe+3]/255*(.2126*Q[oe]+.7152*Q[oe+1]+.0722*Q[oe+2]);A.putImageData(K,0,0),r.globalCompositeOperation="destination-in",r.drawImage(E,0,0)}function ty(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function GA(r,e){const i=r.step;let a=r.diffs[0]*i,h=r.diffs[1]*i;e.moveTo(a,h);for(let g=0,_=2;g<r.commands.length;g++)switch(r.commands[g]){case Rv.PATH_COMMAND_MOVE:a+=r.diffs[_++]*i,h+=r.diffs[_++]*i,e.moveTo(a,h);break;case Rv.PATH_COMMAND_LINE:a+=r.diffs[_++]*i,h+=r.diffs[_++]*i,e.lineTo(a,h);break;case Rv.PATH_COMMAND_QUAD:{const x=a+r.diffs[_++]*i,E=h+r.diffs[_++]*i;a=x+r.diffs[_++]*i,h=E+r.diffs[_++]*i,e.quadraticCurveTo(x,E,a,h);break}case Rv.PATH_COMMAND_CUBIC:{const x=a+r.diffs[_++]*i,E=h+r.diffs[_++]*i,A=x+r.diffs[_++]*i,M=E+r.diffs[_++]*i;a=A+r.diffs[_++]*i,h=M+r.diffs[_++]*i,e.bezierCurveTo(x,E,A,M,a,h);break}case Rv.PATH_COMMAND_CLOSE:e.closePath()}return e}function qA(r){return GA(r,new Path2D)}class V0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Xt(V0,"LRUCache");class gw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new _o(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new V0(150)),this.cacheMap.get(a).get(lu(e.toString(),i))}setInCache(e,i,a,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new V0(150));const g=this.cacheDependenciesMap.get(h),_=lu(e.id.toString(),a);g.get(_)||g.set(_,new Set);const x=this.cacheMap.get(h),E=e.toString();g.get(_).add(E),x.put(lu(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const h=this.cacheMap.get(a),g=this.cacheDependenciesMap.get(a);for(const _ of e){const x=lu(_.toString(),i);if(g.has(x)){for(const E of g.get(x))h.delete(E);g.delete(x)}}}rasterize(e,i,a,h,g=QO){const _=this.getFromCache(e,a,h);if(_)return _.clone();const x=g(i.icon,e.options),E=gw._getImage(x);return this.setInCache(e,E,a,h),E.clone()}}class HA{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function WA(r,e,i,a){let h=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const x=1/a[_];let E=(r[_]-i[_])*x,A=(e[_]-i[_])*x;if(E>A){const M=E;E=A,A=M}if(E>h&&(h=E),A<g&&(g=A),h>g)return null}return h}function $A(r,e,i,a,h,g,_,x,E,A,M){const P=a-r,L=h-e,B=g-i,V=_-r,Z=x-e,K=E-i,Q=M[1]*K-M[2]*Z,oe=M[2]*V-M[0]*K,le=M[0]*Z-M[1]*V,he=P*Q+L*oe+B*le;if(Math.abs(he)<1e-15)return null;const Ee=1/he,Se=A[0]-r,Me=A[1]-e,De=A[2]-i,Ne=(Se*Q+Me*oe+De*le)*Ee;if(Ne<0||Ne>1)return null;const ft=Me*B-De*L,je=De*P-Se*B,mt=Se*L-Me*P,It=(M[0]*ft+M[1]*je+M[2]*mt)*Ee;return It<0||Ne+It>1?null:(V*ft+Z*je+K*mt)*Ee}function ZA(r,e,i){return(r-e)/(i-e)}function XA(r,e,i,a,h,g,_,x,E){const A=1<<i,M=g-a,P=_-h,L=(r+1)/A*M+a,B=(e+0)/A*P+h,V=(e+1)/A*P+h;x[0]=(r+0)/A*M+a,x[1]=B,E[0]=L,E[1]=V}class YA{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(g){const _=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const A=1/E,M=(B,V,Z,K,Q)=>{const oe=K?1:0,le=(B+1)*Z-oe,he=V*Z,Ee=(V+1)*Z-oe;Q[0]=B*Z,Q[1]=he,Q[2]=le,Q[3]=Ee};let P=new HA(E);const L=[];for(let B=0;B<E*E;B++){M(B%E,Math.floor(B/E),A,!1,L);const V=cm(L[0],L[1],g),Z=cm(L[2],L[1],g),K=cm(L[2],L[3],g),Q=cm(L[0],L[3],g);P.minimums.push(Math.min(V,Z,K,Q)),P.maximums.push(Math.max(V,Z,K,Q)),P.leaves.push(1)}for(x.push(P),E/=2;E>=1;E/=2){const B=x[x.length-1];P=new HA(E);for(let V=0;V<E*E;V++){M(V%E,Math.floor(V/E),2,!0,L);const Z=B.getElevation(L[0],L[1]),K=B.getElevation(L[2],L[1]),Q=B.getElevation(L[2],L[3]),oe=B.getElevation(L[0],L[3]),le=B.isLeaf(L[0],L[1]),he=B.isLeaf(L[2],L[1]),Ee=B.isLeaf(L[2],L[3]),Se=B.isLeaf(L[0],L[3]),Me=Math.min(Z.min,K.min,Q.min,oe.min),De=Math.max(Z.max,K.max,Q.max,oe.max),Ne=le&&he&&Ee&&Se;P.maximums.push(De),P.minimums.push(Me),P.leaves.push(De-Me<=5&&Ne?1:0)}x.push(P)}return x})(this.dem),a=i.length-1,h=i[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,h,g,_,x=1){return WA([e,i,-100],[a,h,this.maximums[0]*x],g,_)}raycast(e,i,a,h,g,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,a,h,g,_,x);if(E==null)return null;const A=[],M=[],P=[],L=[],B=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:Z,nodex:K,nodey:Q,depth:oe}=B.pop();if(this.leaves[V]){XA(K,Q,oe,e,i,a,h,P,L);const he=1<<oe,Ee=(K+0)/he,Se=(K+1)/he,Me=(Q+0)/he,De=(Q+1)/he,Ne=cm(Ee,Me,this.dem)*x,ft=cm(Se,Me,this.dem)*x,je=cm(Se,De,this.dem)*x,mt=cm(Ee,De,this.dem)*x,It=$A(P[0],P[1],Ne,L[0],P[1],ft,L[0],L[1],je,g,_),vt=$A(L[0],L[1],je,P[0],L[1],mt,P[0],P[1],Ne,g,_),Et=Math.min(It!==null?It:Number.MAX_VALUE,vt!==null?vt:Number.MAX_VALUE);if(Et!==Number.MAX_VALUE)return Et;{const Ot=Kt([],g,_,Z);if(KA(Ne,ft,mt,je,ZA(Ot[0],P[0],L[0]),ZA(Ot[1],P[1],L[1]))>=Ot[2])return Z}continue}let le=0;for(let he=0;he<this._siblingOffset.length;he++){XA((K<<1)+this._siblingOffset[he][0],(Q<<1)+this._siblingOffset[he][1],oe+1,e,i,a,h,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[V]+he]*x;const Ee=WA(P,L,g,_);if(Ee!=null){const Se=Ee;A[he]=Se;let Me=!1;for(let De=0;De<le&&!Me;De++)Se>=A[M[De]]&&(M.splice(De,0,he),Me=!0);Me||(M[le]=he),le++}}for(let he=0;he<le;he++){const Ee=M[he];B.push({idx:this.childOffsets[V]+Ee,t:A[Ee],nodex:(K<<1)+this._siblingOffset[Ee][0],nodey:(Q<<1)+this._siblingOffset[Ee][1],depth:oe+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,h,g){if(e[h].isLeaf(i,a)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=h-1,x=e[_];let E=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const P=2*i+this._siblingOffset[M][0],L=2*a+this._siblingOffset[M][1],B=x.getElevation(P,L),V=x.isLeaf(P,L),Z=this._addNode(B.min,B.max,V);V&&(E|=1<<M),A||(A=Z)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],_,A+M)}}function KA(r,e,i,a,h,g){return Ii(Ii(r,i,g),Ii(e,a,g),h)}function cm(r,e,i){const a=i.dim,h=Ie(r*a-.5,0,a-1),g=Ie(e*a-.5,0,a-1),_=Math.floor(h),x=Math.floor(g),E=Math.min(_+1,a-1),A=Math.min(x+1,a-1);return KA(i.get(_,x),i.get(E,x),i.get(_,A),i.get(E,A),h-_,g-x)}const JO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eL(r,e,i){return(256*r*256+256*e+i)/10-1e4}function tL(r,e,i){return 256*r+e+i/256-32768}class U0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Ki(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let E=0;E<g;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(g,E)]=_[this._idx(g-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,g)]=_[this._idx(E,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const x=a==="terrarium"?tL:eL;for(let E=0;E<_.length;++E){const A=4*E;this.floatView[E]=x(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=ia.now()}_buildQuadTree(){this._tree=new YA(this)}get(e,i,a=!1){a&&(e=Ie(e,-1,this.dim),i=Ie(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,a){const h=this._idx(e,i),g=this.floatView[h];return this.floatView[h]=a,a-g}static getUnpackVector(e){return JO[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],h=U0.getUnpackVector(i);let g=Math.floor((e+h[3])/h[2]);return a[2]=g%256,g=Math.floor(g/256),a[1]=g%256,g=Math.floor(g/256),a[0]=g,a}getPixels(){return new Zy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,g=i*this.dim+this.dim,_=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:_=x-1;break;case 1:x=_+1}const E=-i*this.dim,A=-a*this.dim;for(let M=_;M<x;M++)for(let P=h;P<g;P++){const L=4*this._idx(P,M),B=4*this._idx(P+E,M+A);this.pixels[L+0]=e.pixels[B+0],this.pixels[L+1]=e.pixels[B+1],this.pixels[L+2]=e.pixels[B+2],this.pixels[L+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function iL(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(a,h){return a.readFields(aL,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(i,i.readVarint()+i.pos))}function nL(r,e,i){r===1?(e.delta_filter=(function(a,h){return a.readFields(rL,{blockSize:0},h)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function rL(r,e,i){r===1&&(e.blockSize=i.readVarint())}function sL(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function oL(r,e,i){let a=0,h=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(g,_){return g.readFields(nL,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(g,_){return g.readFields(sL,{},_)})(i,i.readVarint()+i.pos):r===5?h=i.readFloat():r===6?a=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=a)}function aL(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(a,h){return a.readFields(oL,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(i,i.readVarint()+i.pos))}function lL(r,e,i){if(r===2)(function(a,h,g){a.readFields(cL,g,h)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function cL(r,e,i){if(r===1){let a=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[a++]=i.readVarint()}}function uL(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const h=a===1?1:0,g=a===2?1:0;for(let _=0;_<e[0];_++){const x=e[1]*_;for(let E=h;E<e[1];E++){const A=e[2]*(E+x);for(let M=g;M<e[2];M++){const P=e[3]*(M+A);for(let L=0;L<e[3];L++){const B=P+L;r[B]+=r[B-i]}}}}i*=e[a]}return r}function hL(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function dL(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const a=r[i],h=r[i+1];r[i]=(240&a)>>4|(61440&a)>>8|(240&h)<<4|61440&h,r[i+1]=15&a|(3840&a)>>4|(15&h)<<8|(3840&h)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const a=r[i],h=r[i+1],g=r[i+2],_=r[i+3];r[i+0]=(192&a)>>6|(192&h)>>4|(192&g)>>2|192&_,r[i+1]=(48&a)>>4|(48&h)>>2|48&g|(48&_)<<2,r[i+2]=(12&a)>>2|12&h|(12&g)<<2|(12&_)<<4,r[i+3]=3&a|(3&h)<<2|(3&g)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Xt(U0,"DEMData"),Xt(YA,"DemMinMaxQuadTree",{omit:["dem"]});var vu=Uint8Array,Pv=Uint16Array,fL=Int32Array,QA=new vu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),JA=new vu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pL=new vu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),e2=function(r,e){for(var i=new Pv(31),a=0;a<31;++a)i[a]=e+=1<<r[a-1];var h=new fL(i[30]);for(a=1;a<30;++a)for(var g=i[a];g<i[a+1];++g)h[g]=g-i[a]<<5|a;return{b:i,r:h}},t2=e2(QA,2),i2=t2.b,mL=t2.r;i2[28]=258,mL[258]=28;for(var gL=e2(JA,0).b,n2=new Pv(32768),Ws=0;Ws<32768;++Ws){var iy=(43690&Ws)>>1|(21845&Ws)<<1;n2[Ws]=((65280&(iy=(61680&(iy=(52428&iy)>>2|(13107&iy)<<2))>>4|(3855&iy)<<4))>>8|(255&iy)<<8)>>1}var Dv=function(r,e,i){for(var a=r.length,h=0,g=new Pv(e);h<a;++h)r[h]&&++g[r[h]-1];var _,x=new Pv(e);for(h=1;h<e;++h)x[h]=x[h-1]+g[h-1]<<1;_=new Pv(1<<e);var E=15-e;for(h=0;h<a;++h)if(r[h])for(var A=h<<4|r[h],M=e-r[h],P=x[r[h]-1]++<<M,L=P|(1<<M)-1;P<=L;++P)_[n2[P]>>E]=A;return _},Ov=new vu(288);for(Ws=0;Ws<144;++Ws)Ov[Ws]=8;for(Ws=144;Ws<256;++Ws)Ov[Ws]=9;for(Ws=256;Ws<280;++Ws)Ov[Ws]=7;for(Ws=280;Ws<288;++Ws)Ov[Ws]=8;var r2=new vu(32);for(Ws=0;Ws<32;++Ws)r2[Ws]=5;var _L=Dv(Ov,9),yL=Dv(r2,5),_w=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},$h=function(r,e,i){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(7&e)&i},yw=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},vL=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Zh=function(r,e,i){var a=new Error(e||vL[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,Zh),!i)throw a;return a},xL=new vu(0),bL=typeof TextDecoder<"u"&&new TextDecoder;try{bL.decode(xL,{stream:!0})}catch{}const wL={gzip_data:"gzip"};class Ju extends Error{constructor(e){super(e),this.name="MRTError"}}const TL={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},s2={uint32:1,uint16:2,uint8:4},EL={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let vw;class j0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Ju(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new Ju("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new Ju(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const h=new vw(i.subarray(0,a)).readFields(iL,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ju(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const g of h.layers)this.layers[g.name]=new o2(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let h of e.blockIndices){const g=a.dataIndex[h],_=g.firstByte-e.firstByte,x=g.lastByte-e.firstByte;if(a._blocksInProgress.has(h))continue;const E={layerName:a.name,firstByte:_,lastByte:x,pixelFormat:a.pixelFormat,blockIndex:h,blockShape:[g.bands.length].concat(a.bandShape),buffer:a.buffer,codec:g.codec.codec,filters:g.filters.map((A=>A.filter))};a._blocksInProgress.add(h),i.push(E)}return new a2(i,(()=>{i.forEach((h=>a._blocksInProgress.delete(h.blockIndex)))}),((h,g)=>{if(i.forEach((_=>a._blocksInProgress.delete(_.blockIndex))),h)throw h;g.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class o2{constructor({version:e,name:i,units:a,tileSize:h,pixelFormat:g,buffer:_,dataIndex:x},E){if(this.version=e,this.version!==1)throw new Ju(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=h,this.buffer=_,this.pixelFormat=TL[g],this.dataIndex=x,this.bandShape=[h+2*_,h+2*_,s2[this.pixelFormat]],this._decodedBlocks=new V0(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return s2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,h]of this.dataIndex.entries()){for(const[g,_]of h.bands.entries())if(_===e)return{bandIndex:i+g,blockIndex:a,blockBandIndex:g};i+=h.bands.length}break;case"number":for(const[a,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Ju(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const h=[],g=new Set;for(const _ of e){const{blockIndex:x}=this.getBlockForBand(_);if(x<0)throw new Ju(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[x];h.includes(x)||h.push(x),g.add(x),i=Math.min(i,E.firstByte),a=Math.max(a,E.lastByte)}if(g.size>this.cacheSize)throw new Ju(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new Ju(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new Ju(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[i],_=this.bandShape.reduce(((A,M)=>A*M),1),x=a*_,E=h.subarray(x,x+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}j0.setPbf=function(r){vw=r};class a2{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}j0.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map((a=>{const{layerName:h,firstByte:g,lastByte:_,pixelFormat:x,blockShape:E,blockIndex:A,filters:M,codec:P}=a,L=i.subarray(g,_+1),B=new Uint32Array(E[0]*E[1]*E[2]);let V;if(P!=="gzip_data")throw new Ju(`Unhandled codec: ${P}`);return V=(function(Z,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((he=(function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||Zh(6,"invalid gzip data");var De=Me[3],Ne=10;4&De&&(Ne+=2+(Me[10]|Me[11]<<8));for(var ft=(De>>3&1)+(De>>4&1);ft>0;ft-=!Me[Ne++]);return Ne+(2&De)})(le=Z))+8>le.length&&Zh(6,"invalid gzip data"),(function(Me,De,Ne,ft){var je=Me.length;if(!je||De.f&&!De.l)return Ne||new vu(0);var mt=!Ne,It=mt||De.i!=2,vt=De.i;mt&&(Ne=new vu(3*je));var Et,Ot,ut=function(xr){var br=Ne.length;if(xr>br){var pr=new vu(Math.max(2*br,xr));pr.set(Ne),Ne=pr}},St=De.f||0,rt=De.p||0,Je=De.b||0,kt=De.l,Dt=De.d,xi=De.m,ii=De.n,hi=8*je;do{if(!kt){St=$h(Me,rt,1);var Ut=$h(Me,rt+1,3);if(rt+=3,!Ut){var yi=Me[(fe=4+((rt+7)/8|0))-4]|Me[fe-3]<<8,ji=fe+yi;if(ji>je){vt&&Zh(0);break}It&&ut(Je+yi),Ne.set(Me.subarray(fe,ji),Je),De.b=Je+=yi,De.p=rt=8*ji,De.f=St;continue}if(Ut==1)kt=_L,Dt=yL,xi=9,ii=5;else if(Ut==2){var Zt=$h(Me,rt,31)+257,pi=$h(Me,rt+10,15)+4,Di=Zt+$h(Me,rt+5,31)+1;rt+=14;for(var $i=new vu(Di),rn=new vu(19),Yi=0;Yi<pi;++Yi)rn[pL[Yi]]=$h(Me,rt+3*Yi,7);rt+=3*pi;var oi=_w(rn),Zi=(1<<oi)-1,An=Dv(rn,oi);for(Yi=0;Yi<Di;){var fe,pe=An[$h(Me,rt,Zi)];if(rt+=15&pe,(fe=pe>>4)<16)$i[Yi++]=fe;else{var it=0,dt=0;for(fe==16?(dt=3+$h(Me,rt,3),rt+=2,it=$i[Yi-1]):fe==17?(dt=3+$h(Me,rt,7),rt+=3):fe==18&&(dt=11+$h(Me,rt,127),rt+=7);dt--;)$i[Yi++]=it}}var Wt=$i.subarray(0,Zt),Ht=$i.subarray(Zt);xi=_w(Wt),ii=_w(Ht),kt=Dv(Wt,xi),Dt=Dv(Ht,ii)}else Zh(1);if(rt>hi){vt&&Zh(0);break}}It&&ut(Je+131072);for(var ri=(1<<xi)-1,Ti=(1<<ii)-1,sn=rt;;sn=rt){var an=(it=kt[yw(Me,rt)&ri])>>4;if((rt+=15&it)>hi){vt&&Zh(0);break}if(it||Zh(2),an<256)Ne[Je++]=an;else{if(an==256){sn=rt,kt=null;break}var tn=an-254;an>264&&(tn=$h(Me,rt,(1<<(en=QA[Yi=an-257]))-1)+i2[Yi],rt+=en);var Hn=Dt[yw(Me,rt)&Ti],Pr=Hn>>4;if(Hn||Zh(3),rt+=15&Hn,Ht=gL[Pr],Pr>3){var en=JA[Pr];Ht+=yw(Me,rt)&(1<<en)-1,rt+=en}if(rt>hi){vt&&Zh(0);break}It&&ut(Je+131072);var gr=Je+tn;if(Je<Ht){var Yn=0-Ht,kn=Math.min(Ht,gr);for(Yn+Je<0&&Zh(3);Je<kn;++Je)Ne[Je]=(void 0)[Yn+Je]}for(;Je<gr;++Je)Ne[Je]=Ne[Je-Ht]}}De.l=kt,De.p=sn,De.b=Je,De.f=St,kt&&(St=1,De.m=xi,De.d=Dt,De.n=ii)}while(!St);return Je!=Ne.length&&mt?(Et=Ne,((Ot=Je)==null||Ot>Et.length)&&(Ot=Et.length),new vu(Et.subarray(0,Ot))):Ne.subarray(0,Je)})(le.subarray(he,-8),{i:2},new vu(((Q=le)[(oe=Q.length)-4]|Q[oe-3]<<8|Q[oe-2]<<16|Q[oe-1]<<24)>>>0))));var Q,oe,le,he;const Ee=wL[K];if(!Ee)throw new Error(`Unhandled codec: ${K}`);const Se=new globalThis.DecompressionStream(Ee);return new Response(new Blob([Z]).stream().pipeThrough(Se)).arrayBuffer().then((Me=>new Uint8Array(Me)))})(L,P).then((Z=>((function(K,Q){K.readFields(lL,Q)})(new vw(Z),B),new EL[x](B.buffer)))),V.then((Z=>{for(let K=M.length-1;K>=0;K--)switch(M[K]){case"delta_filter":uL(Z,E);break;case"zigzag_filter":hL(Z);break;case"bitshuffle_filter":dL(Z,x);break;default:throw new Ju(`Unhandled filter "${M[K]}"`)}return{layerName:h,blockIndex:A,data:Z}})).catch((Z=>{throw Z}))})))},Xt(a2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Xt(j0,"MapboxRasterTile"),Xt(o2,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class l2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const SL=["id","tile","layer","source","sourceLayer","state"];class ny{constructor(e,i,a,h,g){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=h,this.properties=e.properties,this.id=g}clone(){const e=new ny(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of SL)this[i]!==void 0&&(e[i]=this[i]);return e}}class c2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fu(Bt,16,0),this.featureIndexArray=new ag,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,h,g,_=0,x=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g,_);const A=this.grid;for(let M=0;M<i.length;M++){const P=i[M],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<P.length;B++){const V=P[B];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}x!==0&&(L[0]-=x,L[1]-=x,L[2]+=x,L[3]+=x),L[0]<Bt&&L[1]<Bt&&L[2]>=0&&L[3]>=0&&A.insert(E,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fi(new g0(this.rawTileData)).layers,this.sourceLayerCoder=new l2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:h,tileTransform:g,pixelPosMatrix:_,availableImages:x,worldview:E}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=a.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,((V,Z,K,Q)=>is(a.bufferedTilespaceGeometry,V,Z,K,Q)));M.sort(AL);let P=null;h.elevation&&M.length>0&&(P=J_.create(h.elevation,this.tileID));const L={};let B;for(let V=0;V<M.length;V++){const Z=M[V];if(Z===B)continue;B=Z;const K=this.featureIndexArray.get(Z);let Q=null;this.is3DTile?this.loadMatchingModelFeature(L,K,e,a,h,E):this.loadMatchingFeature(L,K,e,x,E,((oe,le,he,Ee=0)=>(Q||(Q=Yt(oe,this.tileID.canonical,g)),le.queryIntersectsFeature(a,oe,he,Q,this.z,h,_,P,Ee))))}return L}loadMatchingFeature(e,i,a,h,g,_){const{featureIndex:x,bucketIndex:E,sourceLayerIndex:A,layoutVertexArrayOffset:M}=i,P=this.bucketLayerIDs[E],L=a.layers,B=Object.keys(L);if(B.length&&!hn(B,P))return;const V=a.sourceCache,Z=this.sourceLayerCoder.decode(A),K=this.vtLayers[Z].feature(x),Q=this.getId(K,Z);for(let oe=0;oe<P.length;oe++){const le=P[oe];if(!L[le])continue;const{styleLayer:he,targets:Ee}=L[le];let Se={};Q!==void 0&&(Se=V.getFeatureState(he.sourceLayer,Q));const Me=!_||_(K,he,Se,M);if(!Me)continue;const De=new ny(K,this.z,this.x,this.y,Q);De.tile=this.tileID.canonical,De.state=Se;let Ne=this.serializedLayersCache.get(le);Ne||(Ne=he.serialize(),Ne.id=le,this.serializedLayersCache.set(le,Ne)),De.source=Ne.source,De.sourceLayer=Ne["source-layer"],De.layer=Object.assign({},Ne),De.layer.paint=u2(Ne.paint,he.paint,K,Se,h),De.layer.layout=u2(Ne.layout,he.layout,K,Se,h);let ft=!1;for(const je of Ee){this.updateFeatureProperties(De,je);const{filter:mt}=je;if(mt){if(K.properties=De.properties,mt.needGeometry){const It=Mt(K,!0);if(!mt.filter(new Xn(this.tileID.overscaledZ,{worldview:g}),It,this.tileID.canonical))continue}else if(!mt.filter(new Xn(this.tileID.overscaledZ,{worldview:g}),K))continue}ft=!0,je.targetId&&this.addFeatureVariant(De,je)}ft&&this.appendToResult(e,le,x,De,Me)}}loadMatchingModelFeature(e,i,a,h,g,_){const{featureIndex:x,bucketIndex:E}=i,A=this.bucketLayerIDs[E],M=a.layers,P=Object.keys(M);if(!P.length||hn(P,A))for(let L=0;L<A.length;L++){const B=A[L],{styleLayer:V,targets:Z}=M[B];if(V.type!=="model")continue;const K=h.tile,Q=K.getBucket(V);if(!(Q&&Q instanceof z0))continue;const oe=PO(Q,x,h,g);if(!oe)continue;const{z:le,x:he,y:Ee}=K.tileID.canonical,{feature:Se,intersectionZ:Me,position:De}=oe;let Ne={};Se.id!==void 0&&(Ne=a.sourceCache.getFeatureState(V.sourceLayer,Se.id));const ft=new ny({},le,he,Ee,Se.id);ft.tile=this.tileID.canonical,ft.state=Ne,ft.properties=Se.properties,ft.geometry={type:"Point",coordinates:[De.lng,De.lat]};let je=this.serializedLayersCache.get(B);je||(je=V.serialize(),je.id=B,this.serializedLayersCache.set(B,je)),ft.source=je.source,ft.sourceLayer=je["source-layer"],ft.layer=Object.assign({},je);let mt=!1;for(const It of Z){this.updateFeatureProperties(ft,It);const{filter:vt}=It;if(vt){if(Se.properties=ft.properties,vt.needGeometry){if(!vt.filter(new Xn(this.tileID.overscaledZ,{worldview:_}),Se,this.tileID.canonical))continue}else if(!vt.filter(new Xn(this.tileID.overscaledZ,{worldview:_}),Se))continue}mt=!0,It.targetId&&this.addFeatureVariant(ft,It)}mt&&this.appendToResult(e,B,x,ft,Me)}}updateFeatureProperties(e,i,a){if(i.properties){const h={};for(const g in i.properties){const _=i.properties[g].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);_!=null&&(h[g]=_)}e.properties=h}}addFeatureVariant(e,i,a){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,a,h,g){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:a,feature:h,intersectionZ:g})}lookupSymbolFeatures(e,i,a,h,g,_){const x={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:a,featureIndex:E,layoutVertexArrayOffset:0},h,g,_);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),g=this.vtFeatures[h];if(g[i])return g[i];const _=this.vtLayers[h].feature(i);return g[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const g=ha(h);if(g.result!=="success"){const _=g.value.map((x=>`${x.key}: ${x.message}`)).join(", ");return void Ki(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new gc),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[h];typeof a=="boolean"&&(a=Number(a))}return a}}function u2(r,e,i,a,h){return Bi(r,((g,_)=>{const x=e instanceof Bu?e.get(_):null;return x&&x.evaluate?x.evaluate(i,a,void 0,h):x}))}function AL(r,e){return e-r}Xt(c2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const h2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=h2[15&a];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new xw(x,_,g,e)}constructor(e,i=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=h2.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return bw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:x}=this,E=[0,g.length-1,0],A=[];for(;E.length;){const M=E.pop()||0,P=E.pop()||0,L=E.pop()||0;if(P-L<=x){for(let K=L;K<=P;K++){const Q=_[2*K],oe=_[2*K+1];Q>=e&&Q<=a&&oe>=i&&oe<=h&&A.push(g[K])}continue}const B=L+P>>1,V=_[2*B],Z=_[2*B+1];V>=e&&V<=a&&Z>=i&&Z<=h&&A.push(g[B]),(M===0?e<=V:i<=Z)&&(E.push(L),E.push(B-1),E.push(1-M)),(M===0?a>=V:h>=Z)&&(E.push(B+1),E.push(P),E.push(1-M))}return A}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,x=[0,h.length-1,0],E=[],A=a*a;for(;x.length;){const M=x.pop()||0,P=x.pop()||0,L=x.pop()||0;if(P-L<=_){for(let K=L;K<=P;K++)f2(g[2*K],g[2*K+1],e,i)<=A&&E.push(h[K]);continue}const B=L+P>>1,V=g[2*B],Z=g[2*B+1];f2(V,Z,e,i)<=A&&E.push(h[B]),(M===0?e-a<=V:i-a<=Z)&&(x.push(L),x.push(B-1),x.push(1-M)),(M===0?e+a>=V:i+a>=Z)&&(x.push(B+1),x.push(P),x.push(1-M))}return E}}function bw(r,e,i,a,h,g){if(h-a<=i)return;const _=a+h>>1;d2(r,e,_,a,h,g),bw(r,e,i,a,_-1,1-g),bw(r,e,i,_+1,h,1-g)}function d2(r,e,i,a,h,g){for(;h>a;){if(h-a>600){const A=h-a+1,M=i-a+1,P=Math.log(A),L=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*L*(A-L)/A)*(M-A/2<0?-1:1);d2(r,e,i,Math.max(a,Math.floor(i-M*L/A+B)),Math.min(h,Math.floor(i+(A-M)*L/A+B)),g)}const _=e[2*i+g];let x=a,E=h;for(Lv(r,e,a,i),e[2*h+g]>_&&Lv(r,e,a,h);x<E;){for(Lv(r,e,x,E),x++,E--;e[2*x+g]<_;)x++;for(;e[2*E+g]>_;)E--}e[2*a+g]===_?Lv(r,e,a,E):(E++,Lv(r,e,E,h)),E<=i&&(a=E+1),i<=E&&(h=E-1)}}function Lv(r,e,i,a){ww(r,i,a),ww(e,2*i,2*a),ww(e,2*i+1,2*a+1)}function ww(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function f2(r,e,i,a){const h=r-i,g=e-a;return h*h+g*g}s.$=yf,s.A=Us,s.B=lu,s.C=2,s.D=Zf,s.E=al,s.F=xv,s.G=FS,s.H=od,s.I=So,s.J=Pd,s.K=ki,s.L=ld,s.M=Ed,s.N=Ec,s.O=Sc,s.P=Ct,s.Q=Pp,s.R=hc,s.S=Vu,s.T=z1,s.U=ha,s.V=L0,s.W=If,s.X=yh,s.Y=_h,s.Z=dd,s._=Bo,s.a=function(r){return Kr.API_CDN_URL_REGEX.test(r)},s.a$=ge,s.a0=ad,s.a1=nd,s.a2=Lp,s.a3=class extends L0{},s.a4=Sd,s.a5=Mp,s.a6=Be,s.a7=function(r){const e=r.value;return e?ad(e)?cw(e,!0)?[]:[new L0(r.key,e,`invalid url "${e}"`)]:[new L0(r.key,e,`string expected, "${ki(e)}" found`)]:[]},s.a8=Op,s.a9=Or,s.aA=Ie,s.aB=xt,s.aC=Fs,s.aD=d,s.aE=Sr,s.aF=de,s.aG=He,s.aH=function(r,e){const i={};for(let a=0;a<e.length;a++){const h=e[a];h in r&&(i[h]=r[h])}return i},s.aI=ie,s.aJ=be,s.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,a){const h=this.entries[r]=this.entries[r]||{callbacks:[]};if(h.result){const[g,_]=h.result;return this.scheduler?this.scheduler.add((()=>{a(g,_)}),e):a(g,_),()=>{}}return h.callbacks.push(a),h.cancel||(h.cancel=i(((g,_)=>{h.result=[g,_];for(const x of h.callbacks)this.scheduler?this.scheduler.add((()=>{x(g,_)}),e):x(g,_);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((g=>g!==a)),h.callbacks.length||(h.cancel(),delete this.entries[r]))}}},s.aL=function(r,e,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(h=>{const g=To(r.request,((_,x,E,A)=>{_?h(_):x&&h(null,{vectorTile:i?void 0:new Fi(new g0(x)),rawData:x,cacheControl:E,expires:A})}));return()=>{g.cancel(),h()}}),e)},s.aM=function(r){Ol++,Ol>No&&(r.getActor().send("enforceCacheSizeLimit",wa),Ol=0)},s.aN=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},s.aO=ao,s.aP=fA,s.aQ=vA,s.aR=W,s.aS=dA,s.aT=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const h=document.createElement("source");Eu(r[a])||(i.crossOrigin="Anonymous"),h.src=r[a],i.appendChild(h)}return{cancel:()=>{}}},s.aU=pv,s.aV=function(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>d0(e,0,r)))},s.aW=KE,s.aX=class{constructor(r,e,i,a){this.id=r,this.position=e!=null?new W(e[0],e[1]):new W(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(xt(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const a=Ci.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(a)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=Ge([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,a,h,g,_=!1){XE(this.matrix,this,r.transform,this.position,e,i,a,h,g,_)}upload(r){if(!this.uploaded){for(const e of this.nodes)F1(e,r);for(const e of this.nodes)m0(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)B1(r)}},s.aY=Mi,s.aZ=Tv,s.a_=ve,s.aa=Lt,s.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Gn(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Ii(r.x,e.x,i),y:Ii(r.y,e.y,i),z:Ii(r.z,e.z,i),azimuthal:Ii(r.azimuthal,e.azimuthal,i),polar:Ii(r.polar,e.polar,i)}}},s.ac=Xn,s.ad=iu,s.ae=nt,s.af=ur,s.ag=Ue,s.ah=Ye,s.ai=Bu,s.aj=ic,s.ak=Ii,s.al=Bt,s.am=rd,s.an=Fe,s.ao=In,s.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,a]){const h=Gn([1,i,a]);return{x:h.x,y:h.y,z:h.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Ii(r.x,e.x,i),y:Ii(r.y,e.y,i),z:Ii(r.z,e.z,i)}}},s.aq=function(r,e,i=0,a=!0){const h=new Ct(i,i),g=r.sub(h),_=e.add(h),x=[g,new Ct(_.x,g.y),_,new Ct(g.x,_.y)];return a&&x.push(g.clone()),x},s.ar=function(r,e){const i=[];for(let a=0;a<r.length;a++){const h=Le(a-1,-1,r.length-1),g=Le(a+1,-1,r.length-1),_=r[a],x=r[g],E=r[h].sub(_).unit(),A=x.sub(_).unit(),M=A.angleWithSep(E.x,E.y),P=E.add(A).unit().mult(-1*e/Math.sin(M/2));i.push(_.add(P))}return i},s.as=QS,s.at=is,s.au=function(r,e,i=0){return Cn(((e.x-i)*r.scale-r.x)*Bt,(e.y*r.scale-r.y)*Bt,_e(e.z,e.y))},s.av=Dr,s.aw=Qt,s.ax=xn,s.ay=cS,s.az=function(r){let e=1/0,i=1/0,a=-1/0,h=-1/0;for(const g of r)e=Math.min(e,g.x),i=Math.min(i,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{min:new Ct(e,i),max:new Ct(a,h)}},s.b=function(r){return Kr.API_FONTS_REGEX.test(r)},s.b$=z_,s.b0=ju,s.b1=gs,s.b2=gt,s.b3=Bf,s.b4=M0,s.b5=function(){Wr.isLoading()||Wr.isLoaded()||Cd()!=="deferred"||js()},s.b6=Dd,s.b7=Mt,s.b8=ny,s.b9=Rn,s.bA=Ge,s.bB=vi,s.bC=at,s.bD=function(r,e){const{x:i,y:a}=r.point,h=gg(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return xt(h,h,Uy(_u(e)))},s.bE=te,s.bF=Ya,s.bG=function(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2];return Math.sqrt(i*i+a*a+h*h)},s.bH=Kt,s.bI=cn,s.bJ=Li,s.bK=vv,s.bL=nc,s.bM=Y1,s.bN=function(r,e,i,a,h){const g=5*e+2;r.float32[g+0]=i,r.float32[g+1]=a,r.float32[g+2]=h},s.bO=R0,s.bP=ga,s.bQ=Yr,s.bR=vs,s.bS=Hr,s.bT=Le,s.bU=function(r,e,i,a){var h=new q(4);return h[0]=r,h[1]=e,h[2]=i,h[3]=a,h},s.bV=H_,s.bW=Wo,s.bX=yo,s.bY=Xp,s.bZ=xA,s.b_=Ag,s.ba=G1,s.bb=yl,s.bc=Yt,s.bd=uu,s.be=Ph,s.bf=Fy,s.bg=Er,s.bh=Hd,s.bi=aw,s.bj=function(r,e){const i=ic(e.zoom);if(i===0)return _u(r);const a=pg(r),h=y_(a),g=de(a.getWest())*e.worldSize,_=de(a.getEast())*e.worldSize,x=be(a.getNorth())*e.worldSize,E=be(a.getSouth())*e.worldSize,A=[g,x,0],M=[_,x,0],P=[g,E,0],L=[_,E,0],B=Qe([],e.globeMatrix);return ur(A,A,B),ur(M,M,B),ur(P,P,B),ur(L,L,B),h[0]=Zu(h[0],P,i),h[1]=Zu(h[1],L,i),h[2]=Zu(h[2],M,i),h[3]=Zu(h[3],A,i),Ci.fromPoints(h)},s.bk=mg,s.bl=Qe,s.bm=Ur,s.bn=Zu,s.bo=hu,s.bp=Vx,s.bq=Ve,s.br=wt,s.bs=j0,s.bt=g0,s.bu=To,s.bv=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},s.bw=Xe,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=el,s.bz=function(r){var e=new q(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},s.c=ro,s.c$=function(r){return r*r*r*r*r},s.c0=X1,s.c1=HS,s.c2=ew,s.c3=xw,s.c4=et,s.c5=Ka,s.c6=Qa,s.c7=function(r,e,i){i*=.5;var a=e[0],h=e[1],g=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=a*E+h*x,r[1]=h*E-a*x,r[2]=g*E+_*x,r[3]=_*E-g*x,r},s.c8=Bs,s.c9=sr,s.cA=qi,s.cB=HE,s.cC=Oc,s.cD=fg,s.cE=function(r,e,i,a,h,g,_,x,E){if(E.name==="globe")return fg(r,e,new Oc(i,a,h),!1);const A=Tv({z:i,x:a,y:h},E);return new Ci([(g+A.x/A.scale)*e,e*(A.y/A.scale),_],[(g+A.x2/A.scale)*e,e*(A.y2/A.scale),x])},s.cF=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},s.cG=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},s.cH=function(r){const e=Math.round((r+45+360)%360/90)%4;return se[e]},s.cI=xe,s.cJ=Tr,s.cK=v,s.cL=function(r){const e=Ge(new Float64Array(16));xt(e,r.pixelMatrix,r.globeMatrix);const i=[0,O,0],a=[0,k,0];return ur(i,i,e),ur(a,a,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!Hp(r,new W(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!Hp(r,new W(r.center.lat,-90))]},s.cM=function(r,e){const{scale:i}=r.tileTransform,a=i*Bt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(h,g,_){var x=g[1],E=g[2],A=g[3],M=_[0],P=_[1];return h[0]=g[0]*M,h[1]=x*M,h[2]=E*P,h[3]=A*P,h})(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.cN=f0,s.cO=ht,s.cP=qE,s.cQ=function(r){const e=qE(r,!0);return te([],[e[0],e[1],e[4],e[5]])},s.cR=jt,s.cS=Qi,s.cT=wi,s.cU=function(r){const{x:e,y:i}=r.point,{lng:a,lat:h}=r._center;return gg(e,i,r.worldSize,a,h)},s.cV=fn,s.cW=J,s.cX=Gd,s.cY=Vr,s.cZ=y,s.c_=function(r,e,i){let a=0;for(let h=0;h<2;++h)r[h]>0&&(a+=(r[h]-0)*(r[h]-0)),e[h]<0&&(a+=(0-e[h])*(0-e[h]));return a},s.ca=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.cb=We,s.cc=function(r,e,i,a,h){var g=1/Math.tan(e/2);if(r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0){var _=1/(a-h);r[10]=(h+a)*_,r[14]=2*h*a*_}else r[10]=-1,r[14]=-2*a;return r},s.cd=function(r,e,i,a,h,g,_){var x=1/(e-i),E=1/(a-h),A=1/(g-_);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+i)*x,r[13]=(h+a)*E,r[14]=(_+g)*A,r[15]=1,r},s.ce=ye,s.cf=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.cg=zh,s.ch=kh,s.ci=ts,s.cj=go,s.ck=Nh,s.cl=nA,s.cm=function(){var r=new q(4);return q!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.cn=function(r,e,i){var a=e[0],h=e[1],g=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=a*E+g*x,r[1]=h*E+_*x,r[2]=a*-x+g*E,r[3]=h*-x+_*E,r},s.co=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cp=ys,s.cq=function(r){var e=r[0],i=r[1],a=r[2],h=r[3];return Math.sqrt(e*e+i*i+a*a+h*h)},s.cr=Rl,s.cs=Jo,s.ct=Gf,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=Nn,s.cz=$e,s.d=function(r){return Kr.API_TILEJSON_REGEX.test(r)},s.d$=fS,s.d0=ue,s.d1=45,s.d2=jf,s.d3=function(r,e,i){const a=Math.sqrt(r*r+e*e+i*i),h=a>0?Math.acos(i/a)*il:0;let g=r!==0||e!==0?Math.atan2(-e,-r)*il+90:0;return g<0&&(g+=360),[a,g,h]},s.d4=Cn,s.d5=Gn,s.d6=qe,s.d7=Pt,s.d8=Ci,s.d9=Si,s.dA=function(r,e,i){const a=ic(i.zoom),h=r.style.map._antialias,g=r.terrain&&r.terrain.exaggeration()>0;return a===0&&!h&&!g},s.dB=function(r){const e=r.pixelsPerMeter,i=e/ye(1,r.center.lat),a=Ge(new Float64Array(16));return wt(a,a,[r.point.x,r.point.y,0]),jt(a,a,[i,i,e]),Float32Array.from(a)},s.dC=pg,s.dD=function(r){const e=xe-5;r=Ie(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Fe(r))),3);return Math.round(i*(R.length-1))},s.dE=function(r,e,i,a){const h=e.getNorth(),g=e.getSouth(),_=e.getWest(),x=e.getEast(),E=1<<r.z,A=x-_,M=h-g,P=A/S,L=-M/R[i],B=[0,P,0,L,0,0,h,_,0];if(r.z>0){const V=180/a;ze(B,B,[V/A+1,0,0,0,V/M+1,0,-.5*V/P,.5*V/L,1])}return B[2]=E,B[5]=r.x,B[8]=r.y,B},s.dF=_u,s.dG=function(r,e,i){const a=Ge(new Float64Array(16)),h=(e/(1<<r)-.5)*Math.PI*2;return Ai(a,i.globeMatrix,h),Float32Array.from(a)},s.dH=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,h=Math.floor(r.x),g=Math.floor((r.x-h)*a),_=Math.floor(r.y*a),x=this.findDEMTileFor(new ao(i,h,i,g,_));return!(!x||!x.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const h=a.getSource().maxzoom,g=1<<h,_=Math.floor(r.x),x=r.x-_,E=new ao(h,_,h,Math.floor(x*g),Math.floor(r.y*g)),A=this.findDEMTileFor(E);if(!A||!A.dem)return e;const M=A.dem,P=1<<A.tileID.canonical.z,L=(x*P-A.tileID.canonical.x)*M.dim,B=(r.y*P-A.tileID.canonical.y)*M.dim,V=Math.floor(L),Z=Math.floor(B);return(i?this.exaggeration():1)*Ii(Ii(M.get(V,Z),M.get(V,Z+1),B-Z),Ii(M.get(V+1,Z),M.get(V+1,Z+1),B-Z),L-V)}getAtTileOffset(r,e,i){const a=1<<r.canonical.z;return this.getAtPointOrZero(new nt(r.wrap+(r.canonical.x+e/Bt)/a,(r.canonical.y+i/Bt)/a))}getAtTileOffsetFunc(r,e,i,a){return h=>{const g=this.getAtTileOffset(r,h.x,h.y),_=a.upVector(r.canonical,h.x,h.y);return et(_,_,g*a.upVectorScale(r.canonical,e,i).metersToTile),_}}getForTilePoints(r,e,i,a){if(this.isUsingMockSource())return!1;const h=J_.create(this,r,a);return!!h&&(e.forEach((g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],i)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,h=1<<r.canonical.z-a.canonical.z;let g=r.canonical.x/h-a.canonical.x,_=r.canonical.y/h-a.canonical.y,x=0;for(let E=0;E<r.canonical.z-a.canonical.z&&!i.leaves[x];E++){g*=2,_*=2;const A=2*Math.floor(_)+Math.floor(g);x=i.childOffsets[x]+A,g%=1,_%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const h of r){const g=this.getMinMaxForTile(h.tileID);g&&(i=Math.min(i,g.min),a=Math.max(a,g.max),e=!0)}return e?{min:i,max:a}:null}},s.dI=Zy,s.dJ=Bh,s.dK=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dL=ce,s.dM=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dN=Qo,s.dO=Gx,s.dP=Ys,s.dQ=zo,s.dR=256,s.dS=function(r,e){const i=[0,0,0];return ur(i,i,mg(_u(e.canonical))),ur(i,i,r),i},s.dT=r=>({u_matrix:new Nh(r),u_texsize:new go(r),u_pixels_to_tile_units:new Wu(r),u_device_pixel_ratio:new ts(r),u_width_scale:new ts(r),u_floor_width_scale:new ts(r),u_image:new zh(r),u_units_to_pixels:new go(r),u_tile_units_to_pixels:new ts(r),u_alpha_discard_threshold:new ts(r),u_trim_offset:new go(r),u_trim_fade_range:new go(r),u_trim_color:new jf(r),u_emissive_strength:new ts(r),u_zbias_factor:new ts(r),u_tile_to_meter:new ts(r),u_ground_shadow_factor:new kh(r),u_pattern_transition:new ts(r)}),s.dU=r=>({u_matrix:new Nh(r),u_pixels_to_tile_units:new Wu(r),u_device_pixel_ratio:new ts(r),u_width_scale:new ts(r),u_floor_width_scale:new ts(r),u_units_to_pixels:new go(r),u_dash_image:new zh(r),u_gradient_image:new zh(r),u_image_height:new ts(r),u_texsize:new go(r),u_tile_units_to_pixels:new ts(r),u_alpha_discard_threshold:new ts(r),u_trim_offset:new go(r),u_trim_fade_range:new go(r),u_trim_color:new jf(r),u_emissive_strength:new ts(r),u_zbias_factor:new ts(r),u_tile_to_meter:new ts(r),u_ground_shadow_factor:new kh(r)}),s.dV=r=>({u_camera_to_center_distance:new ts(r),u_extrude_scale:new Wu(r),u_device_pixel_ratio:new ts(r),u_matrix:new Nh(r),u_inv_rot_matrix:new Nh(r),u_merc_center:new go(r),u_tile_id:new kh(r),u_zoom_transition:new ts(r),u_up_dir:new kh(r),u_emissive_strength:new ts(r)}),s.dW=Ch,s.dX=BD,s.dY=class{constructor(r,e,i,a){this.context=r,this.format=a,this.size=i,this.texture=r.gl.createTexture();const[h,g,_]=this.size,{gl:x}=r;x.bindTexture(x.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,h,g,_,0,O1(this.format),L1(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),r!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.dZ=qx,s.d_=(r,e,i,a,h,g)=>{const _=r.transform,x=_.projection.name==="globe";let E;if(g.paint.get("circle-pitch-alignment")==="map")if(x){const M=Gx(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([M,0,0,M])}else E=_.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ia.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:_g,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(x){A.u_inv_rot_matrix=a,A.u_merc_center=h,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=ic(_.zoom);const M=h[0]*Bt,P=h[1]*Bt;A.u_up_dir=_.projection.upVector(new Oc(0,0,0),M,P)}return A},s.da=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.db=cw,s.dc=function(r,e){return r.readFields(LO,{icons:[]},e)},s.dd=c,s.de=Y_,s.df=Q1,s.dg=zl,s.dh=a_,s.di=wu,s.dj=Nl,s.dk=Wi,s.dl=function(r){const e=r.indexOf(Od);return e>=0?r.slice(0,e):r},s.dm=function(r){return r.indexOf(Od)>=0},s.dn=function(r){const e=r.lastIndexOf(Od);return e>=0?r.slice(e+1):""},s.dp=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dq=function(r,e,i,a){return r.type==="custom"?new CO(r,e):new DO[r.type](r,e,i,a)},s.dr=un,s.ds=function(r){const e=r.indexOf(Od);return e>=0?r.slice(e+1):""},s.dt=class extends ny{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.du=Df,s.dv=on,s.dw=function(r){return r({pluginStatus:Ro,pluginURL:ru}),Df.on("pluginStateChange",r),r},s.dx=dg,s.dy=class extends Yl{constructor(r){super(r),this.current=p_}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dz=me,s.e=Kr,s.e$=function(){const r=Dg;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Pg),Dg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e0=ms,s.e1=(r,e,i,a,h,g,_,x,E,A)=>{const M=r.transform,P=M.pitch<15?uS(.07,.7,Ie((14-M.zoom)/5,0,1)):.07,L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dS(r,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:hS(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:qe(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:A}},s.e2=(r,e,i,a,h,g,_,x,E,A)=>{const M=r.transform,P=M.calculatePixelsToTileUnitsMatrix(e),L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=M.pitch<15?uS(.07,.7,Ie((14-M.zoom)/5,0,1)):.07;return{u_matrix:dS(r,e,i,a),u_pixels_to_tile_units:P,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:x,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:pS(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hS(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:qe(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e3=di,s.e4=ar,s.e5=_e,s.e6=g1,s.e7=U_,s.e8=qh,s.e9=yu,s.eA=os,s.eB=Mh,s.eC=function(r,e,i,a,h,g,_,x,E,A,M,P,L,B,V,Z){var K=new q(16);return K[0]=r,K[1]=e,K[2]=i,K[3]=a,K[4]=h,K[5]=g,K[6]=_,K[7]=x,K[8]=E,K[9]=A,K[10]=M,K[11]=P,K[12]=L,K[13]=B,K[14]=V,K[15]=Z,K},s.eD=H,s.eE=Nd,s.eF=Mc,s.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ct(1/0,1/0),max:new Ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=ov(new Ct(0,0),new Ct(Bt,Bt),r),a=[];if(e&&!Wd(i,this._globalClipBounds))return a;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Wd(i,h))continue;const g=O_(h.min,h.max,r);a.push({min:g.min,max:g.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return a}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(a).buckets[e.layer];h&&h.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),a=r.getClipMask(),h=r.getClipScope();for(const g of e){if(!g.footprint)continue;const _=ov(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:i,clipMask:a,clipScope:h})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||Eg(e.min,i.min)||Eg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(a,h){const g=(_,x)=>_+x;return a.length-h.length||a.reduce(g,"").localeCompare(h.reduce(g,""))})(e.clipScope,i.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];r=i.priority!==a.priority||!n0(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!el(i.clipScope,a.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Zp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const h=a[i].priority;for(;i<a.length&&a[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let h=i;const g=i;for(;h!==a;){const _=this._activeRegions[h];_.hiddenByOverlap=!1;for(let x=0;x<g;x++){const E=this._activeRegions[x];if(!E.hiddenByOverlap&&_.order===Zp&&Wd(_,E)&&(_.hiddenByOverlap=L_(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++h}i=a,a=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eH=Zp,s.eI=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new uu,a=new gs,h=[],g=r+1+2,_=e[0]+1,x=e[0]+1+(1+e.length),E=(A,M,P)=>{let L=A===g-1?A-2:A===0?A:A-1;return L+=P?24575:0,[L,M]};for(let A=0;A<g;++A)i.emplaceBack(...E(A,0,!0));for(let A=0;A<_;++A)for(let M=0;M<g;++M)i.emplaceBack(...E(M,A,(M===0||M===g-1)&&!0));for(let A=0;A<e.length;++A){const M=e[A];for(let P=0;P<g;++P)i.emplaceBack(...E(P,M,!0))}for(let A=0;A<e.length;++A){const M=a.length,P=e[A]+1+2,L=new gs;for(let Z=0;Z<P-1;Z++){const K=Z===P-2,Q=K?g*(x-e.length+A-Z):g;for(let oe=0;oe<g-1;oe++){const le=Z*g+oe;Z===0||K||oe===0||oe===g-2?(L.emplaceBack(le+1,le,le+Q),L.emplaceBack(le+Q,le+Q+1,le+1)):(a.emplaceBack(le+1,le,le+Q),a.emplaceBack(le+Q,le+Q+1,le+1))}}const B=Er.simpleSegment(0,M,i.length,a.length-M);for(let Z=0;Z<L.uint16.length;Z+=3)a.emplaceBack(L.uint16[Z],L.uint16[Z+1],L.uint16[Z+2]);const V=Er.simpleSegment(0,M,i.length,a.length-M);h.push({withoutSkirts:B,withSkirts:V})}return{vertices:i,indices:a,segments:h}}_createGrid(r){const e=this._fillGridMeshWithLods(S,R);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Fy.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new gs;for(let _=0;_<=S;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new qu,a=new qu,h=new qu,g=new qu;this._poleSegments=[];for(let _=0,x=0;_<y;_++){const E=360/(1<<_);i.emplaceBack(0,-d,0,.5,0),a.emplaceBack(0,-d,0,.5,1),h.emplaceBack(0,-d,0,.5,.5),g.emplaceBack(0,-d,0,.5,.5);for(let A=0;A<=S;A++){let M=A/S,P=0;const L=Ii(0,E,M),[B,V,Z]=U(qd,Xu,L,d);i.emplaceBack(B,V,Z,M,P),a.emplaceBack(B,V,Z,M,1-P);const K=Fe(L);M=.5+.5*Math.sin(K),P=.5+.5*Math.cos(K),h.emplaceBack(B,V,Z,M,P),g.emplaceBack(B,V,Z,M,1-P)}this._poleSegments.push(Er.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,m_,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,m_,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,m_,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(g,m_,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eJ=Wf,s.eK=Re,s.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eM=Ae,s.eN=ot,s.eO=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},s.eP=Il,s.eQ=F,s.eR=Hi,s.eS=mn,s.eT=function([r,e,i]){const a=Math.hypot(r,e,i),h=Math.atan2(r,i),g=.5*Math.PI-Math.acos(-e/a);return new W(J(h),J(g))},s.eU=ls,s.eV=k1,s.eW=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(rr==null){const a=i.navigator?i.navigator.userAgent:null;rr=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return rr})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eX=function(r,e){wa=r,No=e},s.eY=Hp,s.eZ=v_,s.e_=function(r){const e=[0,0,0],i=Ge(new Float64Array(16));return xt(i,r.pixelMatrix,r.globeMatrix),ur(e,e,i),new Ct(e[0],e[1])},s.ea=450,s.eb=7,s.ec=Oe,s.ed=function(r,e){if(r===e){var i=e[1],a=e[2],h=e[3],g=e[6],_=e[7],x=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=a,r[9]=g,r[11]=e[14],r[12]=h,r[13]=_,r[14]=x}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.ee=IO,s.ef=pn,s.eg=Dh,s.eh=256,s.ei=Uy,s.ej=Po,s.ek=Ai,s.el=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.em=qu,s.en=Vp,s.eo=tu,s.ep=function(r,e,i,a,h){return Ie((r-e)/(i-e)*(h-a)+a,a,h)},s.eq=Ra,s.er=function(r,e){var i=e[0],a=e[1],h=e[2],g=e[3],_=e[4],x=e[5],E=e[6],A=e[7],M=e[8],P=M*_-x*A,L=-M*g+x*E,B=A*g-_*E,V=i*P+a*L+h*B;return V?(r[0]=P*(V=1/V),r[1]=(-M*a+h*A)*V,r[2]=(x*a-h*_)*V,r[3]=L*V,r[4]=(M*i-h*E)*V,r[5]=(-x*i+h*g)*V,r[6]=B*V,r[7]=(-A*i+a*E)*V,r[8]=(_*i-a*g)*V,r):null},s.es=2,s.et=bn,s.eu=N1,s.ev=[1,1,1],s.ew=J_,s.ex=Uc,s.ey=function(r,e,i,a){var h=e[0],g=e[1],_=e[2],x=e[3];return r[0]=h+a*(i[0]-h),r[1]=g+a*(i[1]-g),r[2]=_+a*(i[2]-_),r[3]=x+a*(i[3]-x),r},s.ez=$_,s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},s.f0=function(){c().acquire(Pg)},s.f1=Cd,s.f2=function(r,e,i=!1){if(Ro===qo.deferred||Ro===qo.loading||Ro===qo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ru=ia.resolveURL(r),Ro=qo.deferred,Mf=e,Pf(),i||js()},s.f3=function(r){j=ia.resolveURL(r),Te||(Te=new Zf(c(),new al)),Te.broadcast("setMeshoptUrl",j)},s.f4=Vt,s.f5=function(r){I=ia.resolveURL(r),Te||(Te=new Zf(c(),new al)),Te.broadcast("setDracoUrl",I)},s.f6=ai,s.f7=nm,s.f8=function(r){const e=sh();if(!e)return;const i=e.delete(Ks);r&&i.then((()=>r())).catch(r)},s.f9=Qu,s.fA=function(r){cc(),so?.then((e=>{e.keys().then((i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a]).catch((h=>Ki(h.message)))})).catch((i=>Ki(i.message)))})).catch((e=>Ki(e.message)))},s.fa=Xt,s.fb=Lc,s.fc=Wh,s.fd=l2,s.fe=c2,s.ff=oS,s.fg=Ei,s.fh="hd_road_elevation",s.fi=fr,s.fj=Bi,s.fk=jh,s.fl=K1,s.fm=zg,s.fn=function(r,e,i,a,h,g,_,x=1,E,A,M){r.createArrays(),r.tilePixelRatio=Bt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const P=r.layers[0].layout,L=r.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=x,B.textSizeScaleRange=P.get("text-size-scale-range"),B.iconSizeScaleRange=P.get("icon-size-scale-range");const[V,Z]=B.textSizeScaleRange,[K,Q]=B.iconSizeScaleRange;B.textScaleFactor=Ie(B.scaleFactor,V,Z),B.iconScaleFactor=Ie(B.scaleFactor,K,Q);const oe=L["text-size"],le=L["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Ne,maxZoom:ft}=r.textSizeData;B.compositeTextSizes=[oe.possiblyEvaluate(new Xn(Ne,{worldview:M}),g),oe.possiblyEvaluate(new Xn(ft,{worldview:M}),g)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Ne,maxZoom:ft}=r.iconSizeData;B.compositeIconSizes=[le.possiblyEvaluate(new Xn(Ne,{worldview:M}),g),le.possiblyEvaluate(new Xn(ft,{worldview:M}),g)]}B.layoutTextSize=oe.possiblyEvaluate(new Xn(_+1,{worldview:M}),g),B.layoutIconSize=le.possiblyEvaluate(new Xn(_+1,{worldview:M}),g),B.textMaxSize=oe.possiblyEvaluate(new Xn(18,{worldview:M}),g);const he=P.get("symbol-placement"),Ee=P.get("text-rotation-alignment")==="map"&&he!=="point",Se=P.get("text-size");let Me=!1;const De=[];for(const Ne of r.features){const ft=P.get("text-font").evaluate(Ne,{},g).join(","),je=Se.evaluate(Ne,{},g)*B.textScaleFactor,mt=B.layoutTextSize.evaluate(Ne,{},g)*B.textScaleFactor,It=B.layoutIconSize.evaluate(Ne,{},g)*B.iconScaleFactor,vt={horizontal:{},vertical:void 0},Et=Ne.text;let Ot,ut=[0,0];if(Et){const pi=Et.toString(),Di=P.get("text-letter-spacing").evaluate(Ne,{},g)*yo,$i=P.get("text-line-height").evaluate(Ne,{},g)*yo,rn=Cf(pi)?Di:0,Yi=P.get("text-anchor").evaluate(Ne,{},g),oi=P.get("text-variable-anchor");if(!oi){const it=P.get("text-radial-offset").evaluate(Ne,{},g);if(it)ut=HS(Yi,[it*yo,J1]);else{const dt=P.get("text-offset").evaluate(Ne,{},g);ut=[dt[0]*yo,dt[1]*yo]}}let Zi=Ee?"center":P.get("text-justify").evaluate(Ne,{},g);const An=he==="point",fe=An?P.get("text-max-width").evaluate(Ne,{},g)*yo:1/0,pe=it=>{r.allowVerticalPlacement&&Os(pi)&&(vt.vertical=Z1(Et,e,i,h,ft,fe,$i,Yi,it,rn,ut,nc.vertical,!0,mt,je,E))};if(!Ee&&oi){const it=Zi==="auto"?oi.map((Wt=>ew(Wt))):[Zi];let dt=!1;for(let Wt=0;Wt<it.length;Wt++){const Ht=it[Wt];if(!vt.horizontal[Ht])if(dt)vt.horizontal[Ht]=vt.horizontal[0];else{const ri=Z1(Et,e,i,h,ft,fe,$i,"center",Ht,rn,ut,nc.horizontal,!1,mt,je,E);ri&&(vt.horizontal[Ht]=ri,dt=ri.positionedLines.length===1)}}pe("left")}else{if(Zi==="auto"&&(Zi=ew(Yi)),An||P.get("text-writing-mode").indexOf("horizontal")>=0||!Os(pi)){const it=Z1(Et,e,i,h,ft,fe,$i,Yi,Zi,rn,ut,nc.horizontal,!1,mt,je,E);it&&(vt.horizontal[Zi]=it)}pe(An?"left":Zi)}}let St,rt,Je,kt,Dt,xi,ii=!1;const hi=P.get("icon-text-fit").evaluate(Ne,{},g);if(Ne.icon&&Ne.icon.hasPrimary()){const pi=$S(Ne.icon,r.iconSizeData,L["icon-size"],g,r.zoom,Ne,E,B.iconScaleFactor,M);St=pi.iconPrimary,Je=pi.iconSecondary;const Di=St.toString();if(rt=a.get(Di),rt&&(Dt=P.get("icon-offset").evaluate(Ne,{},g),xi=P.get("icon-anchor").evaluate(Ne,{},g),Ot=nO(h.get(Di),Je?h.get(Je.toString()):void 0,Dt,xi),ii=rt.sdf,r.sdfIcons===void 0?r.sdfIcons=rt.sdf:r.sdfIcons!==rt.sdf&&Ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rt.pixelRatio!==r.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Je){const $i=Je.toString();kt=a.get($i)}}Me=Me||!(!Ne.icon||!Ne.icon.hasSecondary());const Ut=tw(vt.horizontal)||vt.vertical;r.iconsInText||(r.iconsInText=!!Ut&&Ut.iconsInText);const yi=mt*B.textScaleFactor/yo,{defaultShapedIcon:ji,verticallyShapedIcon:Zt}=fO(r,Ot,P,Ne,g,vt,yi,Dt,hi);hi!=="none"&&Ot&&(RS(Ot)||MS(Ot))&&(b0(0,rt,St,Ot,ji,hi,A,a,h),b0(0,kt,Je,Ot,ji,hi,A,a,h),Zt&&(b0(0,rt,St,Ot,Zt,hi,A,a,h),b0(0,kt,Je,Ot,Zt,hi,A,a,h))),Ot=ji,De.push({feature:Ne,shapedTextOrientations:vt,shapedText:Ut,shapedIcon:Ot,iconPrimary:St,iconSecondary:Je,iconOffset:Dt,iconAnchor:xi,verticallyShapedIcon:Zt,layoutTextSize:mt,layoutIconSize:It,textOffset:ut,isSDFIcon:ii,iconTextFit:hi})}return{featureData:De,sizes:B,hasAnySecondaryIcon:Me,textAlongLine:Ee,symbolPlacement:he}},s.fo=BS,s.fp=function(r,e,i,a,h,g,_,x,E,A){const{featureData:M,hasAnySecondaryIcon:P,sizes:L,textAlongLine:B,symbolPlacement:V}=e;for(const Z of M){const{shapedIcon:K,verticallyShapedIcon:Q,feature:oe,shapedTextOrientations:le,shapedText:he,layoutTextSize:Ee,textOffset:Se,isSDFIcon:Me,iconPrimary:De,iconSecondary:Ne,iconTextFit:ft,iconOffset:je}=Z;ZS(K,A.iconPositions,De,Ne),ZS(Q,A.iconPositions,De,Ne),dO(le,A.iconPositions),hO(De,Ne,A.iconPositions),(he||K)&&pO(r,oe,le,K,Q,E,L,Ee,0,Se,Me,a,h,_,x,P,ft,je,B,V)}i&&r.generateCollisionDebugBuffers(g,r.collisionBoxArray,L.textScaleFactor)},s.fq=Fi,s.fr=U0,s.fs=Tt,s.ft=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==jr){const i=new Uint32Array(r,0,7),[,,a,h,g,_]=i;e=i.byteLength+h+g+_+g,(a!==r.byteLength||e>=r.byteLength)&&Ki("Invalid b3dm header information.")}return d0(r,e)},s.fu=function(r,e){const i=KE(r);for(const a of i){for(const h of a.meshes)uD(h);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(hD(a.lights,e)))}return i},s.fv=z0,s.fw=Vn,s.fx=$f,s.fy=Wr,s.fz=qo,s.g=function(r,e){return on(Object.assign(r,{method:"GET"}),e)},s.h=function(r){return r.indexOf("mapbox:")===0},s.i=function(r){return Kr.API_STYLE_REGEX.test(r)&&!ro(r)},s.j=ds,s.k=nl,s.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},s.m=function(r,e){return on(Object.assign(r,{type:"json"}),e)},s.n=sl,s.o=ia,s.p=function(r,e){return on(Object.assign(r,{method:"POST"}),e)},s.q=_o,s.r=ko,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return rm||(rm=new Qu),rm},s.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=Ki,s.x=gw,s.y=ol,s.z=sa})),C(["./shared"],(function(s){function G(Fe){const J=Fe?Fe.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function q(Fe){if(typeof Fe=="number"||typeof Fe=="boolean"||typeof Fe=="string"||Fe==null)return JSON.stringify(Fe);if(Array.isArray(Fe)){let se="[";for(const me of Fe)se+=`${q(me)},`;return`${se}]`}let J="{";for(const se of Object.keys(Fe).sort())J+=`${se}:${q(Fe[se])},`;return`${J}}`}function te(Fe){let J="";for(const se of s.bx)J+=`/${q(Fe[se])}`;return J}class ce{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,se){this._layerConfigs={},this._layers={},this.update(J,[],se)}update(J,se,me){this._options=me;for(const Ae of J)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=s.dq(Ae,this.scope,null,this._options)).compileFilter(me),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of se)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const Re=(function(Ae,Ie){const Ye={};for(let Xe=0;Xe<Ae.length;Xe++){const At=Ae[Xe];let gt=Ie&&Ie[At.id];gt||(At.type==="symbol"?gt=At.id:(gt=te(At),At.type==="line"&&At.paint&&(function Mi(Bi){return typeof Bi=="string"&&Bi==="line-progress"||(Array.isArray(Bi)?Bi.some(Mi):!(!Bi||typeof Bi!="object")&&Object.values(Bi).some(Mi))})(At.paint["line-width"])&&(gt+=`/${q(At.paint["line-width"])}`))),Ie&&(Ie[At.id]=gt);let di=Ye[gt];di||(di=Ye[gt]=[]),di.push(At)}const Le=[];for(const Xe in Ye)Le.push(Ye[Xe]);return Le})(Object.values(this._layerConfigs),this.keyCache);for(const Ae of Re){const Ie=Ae.map((di=>this._layers[di.id])),Ye=Ie[0];if(Ye.visibility==="none")continue;const Le=Ye.source||"";let Xe=this.familiesBySource[Le];Xe||(Xe=this.familiesBySource[Le]={});const At=Ye.sourceLayer||"_geojsonTileLayer";let gt=Xe[At];gt||(gt=Xe[At]=[]),gt.push(Ie)}}}const we=1*s.fc;class ze{constructor(J){const se={},me=[];for(const Ye in J){const Le=J[Ye],Xe=se[Ye]={};for(const At in Le.glyphs){const gt=Le.glyphs[+At];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const di=gt.metrics.localGlyph?we:1,Mi={x:0,y:0,w:gt.bitmap.width+2*di,h:gt.bitmap.height+2*di};me.push(Mi),Xe[At]=Mi}}const{w:Re,h:Ae}=s.G(me),Ie=new s.fb({width:Re||1,height:Ae||1});for(const Ye in J){const Le=J[Ye];for(const Xe in Le.glyphs){const At=Le.glyphs[+Xe];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const gt=se[Ye][Xe],di=At.metrics.localGlyph?we:1;s.fb.copy(At.bitmap,Ie,{x:0,y:0},{x:gt.x+di,y:gt.y+di},At.bitmap)}}this.image=Ie,this.positions=se}}s.fa(ze,"GlyphAtlas");class at{constructor(J){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=s.aZ(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor,this.worldview=J.worldview}parse(J,se,me,Re,Ae,Ie){this.status="parsing",this.data=J,this.collisionBoxArray=new s.b3;const Ye=new s.fd(Object.keys(J.layers).sort()),Le=new s.fe(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const Xe={},At=new s.ff(256,256),gt={featureIndex:Le,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:At,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},di=[],Mi=se.familiesBySource[this.source];for(const un in Mi){const Wi=J.layers[un];if(!Wi)continue;let hn=!1,Ln=!1,Ki=!1;for(const Vn of Mi[un])Vn[0].type==="symbol"?hn=!0:Ln=!0,Vn[0].is3D()&&Vn[0].type!=="model"&&(Ki=!0);if(this.extraShadowCaster&&!Ki||this.isSymbolTile===!0&&!hn||this.isSymbolTile===!1&&!Ln)continue;Wi.version===1&&s.w(`Vector tile source "${this.source}" layer "${un}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zn=Ye.encode(un),Cr=[];let Gn=!1;for(let Vn=0,Rn=0;Vn<Wi.length;Vn++){const rr=Wi.feature(Vn),sr=Le.getId(rr,un);if(this.localizableLayerIds&&this.localizableLayerIds.has(un)){const Jn=rr.properties?rr.properties.worldview:null;if(this.worldview&&typeof Jn=="string")if(Jn==="all")rr.properties.$localized=!0;else{if(!Jn.split(",").includes(this.worldview))continue;rr.properties.$localized=!0,rr.properties.worldview=this.worldview}}!Gn&&rr.properties&&rr.properties.hasOwnProperty(s.fg)&&(Gn=!0),Cr.push({feature:rr,id:sr,index:Rn,sourceLayerIndex:Zn}),Rn++}Gn&&!gt.elevationFeatures&&J.layers.hasOwnProperty(s.fh)&&(gt.elevationFeatures=s.fi.parseFrom(J.layers[s.fh],this.canonical));for(const Vn of Mi[un]){const Rn=Vn[0];if(this.extraShadowCaster&&(!Rn.is3D()||Rn.type==="model")||this.isSymbolTile!==void 0&&Rn.type==="symbol"!==this.isSymbolTile||Rn.minzoom&&this.zoom<Math.floor(Rn.minzoom)||Rn.maxzoom&&this.zoom>=Rn.maxzoom||Rn.visibility==="none")continue;Ge(Vn,this.zoom,gt.brightness,me,this.worldview);const rr=Xe[Rn.id]=Rn.createBucket({index:Le.bucketLayerIDs.length,layers:Vn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Re,worldview:this.worldview});Le.bucketLayerIDs.push(Vn.map((Jn=>s.B(Jn.id,Jn.scope))));let sr=rr.prepare?rr.prepare():null;sr!=null?(sr=sr.then((()=>rr.populate(Cr,gt,this.tileID.canonical,this.tileTransform))),di.push(sr)):rr.populate(Cr,gt,this.tileID.canonical,this.tileTransform)}}const Bi=()=>{let un,Wi,hn,Ln,Ki,Zn;At.trim();const Cr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Gn=()=>{if(un)return this.status="done",Ie(un);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Xe).filter((Rn=>!Rn.isEmpty())),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Wi&&hn&&Ln){const Rn=new ze(Wi),rr=new Map;for(const[Es,Ys]of hn.entries()){const{imagePosition:zo}=s.fl(Es,Ys,s.fm);rr.set(Es,zo)}const sr={};for(const Es in Xe){const Ys=Xe[Es];Ys instanceof s.b4&&(Ge(Ys.layers,this.zoom,gt.brightness,me,this.worldview),sr[Es]=s.fn(Ys,Wi,Rn.positions,hn,rr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ki,this.worldview))}const Jn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ae,hn,Ki,(()=>{Jn.iconsPending=!1,Vn(sr,Rn,Jn)})),this.rasterizeIfNeeded(Ae,Ln,Zn,(()=>{Jn.patternsPending=!1,Vn(sr,Rn,Jn)}))}},Vn=(Rn,rr,sr,Jn)=>{if(sr.iconsPending||sr.patternsPending)return;const Es=new s.fo(hn,Ln,this.lut);for(const Ys in Xe){const zo=Xe[Ys];if(Ys in Rn)s.fp(zo,Rn[Ys],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,hn,Es);else if(zo.hasPattern&&(zo instanceof s.ba||zo instanceof s.bb||zo instanceof s.e7)){Ge(zo.layers,this.zoom,gt.brightness,me,this.worldview);const ba=Object.fromEntries(Es.patternPositions);zo.addFeatures(gt,this.tileID.canonical,ba,me,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Xe).filter((Ys=>!Ys.isEmpty())),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rr.image,lineAtlas:At,imageAtlas:Es,brightness:gt.brightness})};if(!this.extraShadowCaster){const Rn=s.fj(gt.glyphDependencies,(Jn=>Object.keys(Jn).map(Number)));Object.keys(Rn).length?Ae.send("getGlyphs",{uid:this.uid,stacks:Rn},((Jn,Es)=>{un||(un=Jn,Wi=Es,Gn())}),void 0,!1,Cr):Wi={};const rr=Array.from(gt.iconDependencies.keys()).map((Jn=>s.I.parse(Jn)));rr.length?Ae.send("getImages",{images:rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Jn,Es)=>{un||(un=Jn,hn=new Map,Ki=this.updateImageMapAndGetImageTaskQueue(hn,Es,gt.iconDependencies),Gn())}),void 0,!1,Cr):(hn=new Map,Ki=new Map);const sr=Array.from(gt.patternDependencies.keys()).map((Jn=>s.I.parse(Jn)));sr.length?Ae.send("getImages",{images:sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Jn,Es)=>{un||(un=Jn,Ln=new Map,Zn=this.updateImageMapAndGetImageTaskQueue(Ln,Es,gt.patternDependencies),Gn())}),void 0,!1,Cr):(Ln=new Map,Zn=new Map)}if(gt.elevationFeatures&&gt.elevationFeatures.length>0){const Rn=[];for(const sr of Object.values(Xe))if(sr instanceof s.bb){const Jn=sr.getUnevaluatedPortalGraph();Jn&&Rn.push(Jn)}const rr=s.fk.evaluate(Rn);for(const sr of Object.values(Xe))if(sr instanceof s.bb){const Jn=J.layers[Ye.decode(sr.sourceLayerIndex)];sr.setEvaluatedPortalGraph(rr,Jn,this.tileID.canonical,gt.availableImages,gt.brightness)}}Gn()};di.length>0?Promise.allSettled(di).then(Bi).catch(Ie):Bi()}rasterizeIfNeeded(J,se,me,Re){Array.from(se.values()).some((Ae=>Ae.usvg))?this.rasterize(J,se,me,Re):Re()}updateImageMapAndGetImageTaskQueue(J,se,me){const Re=new Map;for(const Ae of se.keys()){const Ie=me.get(Ae)||[];for(const Ye of Ie){const Le=Ye.toString(),Xe=se.get(Ye.id.toString());Xe.usvg?Re.has(Le)||(Re.set(Le,Ye),J.set(Le,Object.assign({},Xe))):J.set(Le,Xe)}}return Re}rasterize(J,se,me,Re){this.rasterizeTask=J.send("rasterizeImages",{scope:this.scope,tasks:me},((Ae,Ie)=>{if(!Ae)for(const[Ye,Le]of Ie.entries()){const Xe=Object.assign(se.get(Ye),{data:Le});se.set(Ye,Xe)}Re()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ge(Fe,J,se,me,Re){const Ae=new s.ac(J,{brightness:se,worldview:Re});for(const Ie of Fe)Ie.recalculate(Ae,me)}class Qe extends s.E{constructor(J,se,me,Re,Ae,Ie,Ye){super(),this.actor=J,this.layerIndex=se,this.availableImages=me,this.availableModels=Re,this.loadVectorData=Ie||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(J.scheduler),this.isSpriteLoaded=Ae,this.scheduler=J.scheduler,this.brightness=Ye}loadTile(J,se){const me=J.uid,Re=J&&J.request,Ae=Re&&Re.collectResourceTiming,Ie=this.loading[me]=new at(J);Ie.abort=this.loadVectorData(J,((Ye,Le)=>{const Xe=!this.loading[me];if(delete this.loading[me],Ie.cancelRasterize(),Xe||Ye||!Le)return Ie.status="done",Xe||(this.loaded[me]=Ie),se(Ye);const At=Le.rawData,gt={};Le.expires&&(gt.expires=Le.expires),Le.cacheControl&&(gt.cacheControl=Le.cacheControl),Ie.vectorTile=Le.vectorTile||new s.fq(new s.bt(At));const di=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Mi,Bi)=>{if(Mi||!Bi)return se(Mi);const un={};if(Ae){const Wi=G(Re);Wi.length>0&&(un.resourceTiming=JSON.parse(JSON.stringify(Wi)))}se(null,Object.assign({rawTileData:At.slice(0)},Bi,gt,un))}))};this.isSpriteLoaded?di():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(di,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):di()})),this.loaded=this.loaded||{},this.loaded[me]=Ie}))}reloadTile(J,se){const me=this.loaded,Re=J.uid;if(me&&me[Re]){const Ae=me[Re];Ae.scaleFactor=J.scaleFactor,Ae.showCollisionBoxes=J.showCollisionBoxes,Ae.projection=J.projection,Ae.brightness=J.brightness,Ae.tileTransform=s.aZ(J.tileID.canonical,J.projection),Ae.extraShadowCaster=J.extraShadowCaster,Ae.lut=J.lut,Ae.worldview=J.worldview;const Ie=(Ye,Le)=>{const Xe=Ae.reloadCallback;Xe&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),se(Ye,Le)};Ae.status==="parsing"?Ae.reloadCallback=Ie:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else se(null,void 0)}abortTile(J,se){const me=J.uid,Re=this.loading[me];Re&&(Re.abort&&Re.abort(),delete this.loading[me]),se()}removeTile(J,se){const me=this.loaded,Re=J.uid;me&&me[Re]&&delete me[Re],se()}}class xt{loadTile(J,se){const{uid:me,encoding:Re,rawImageData:Ae,padding:Ie}=J,Ye=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,Ie):Ae;se(null,new s.fr(me,Ye,Re,Ie<1))}reloadTile(J,se){se(null,null)}abortTile(J,se){se()}removeTile(J,se){se()}getImageData(J,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const me=this.offscreenCanvasContext.getImageData(-se,-se,J.width+2*se,J.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}s.bs.setPbf(s.bt);class wt{constructor(J){this._mrt=new s.bs(J.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=J.uid,this.tileID=J.tileID,this.source=J.source}parse(J,se){const me=this._mrt;this.status="parsing",this._entireBuffer=J;try{me.parseHeader(J),this._isHeaderLoaded=!0;const Re=[];for(const Ae in me.layers){const Ie=me.getLayer(Ae),Ye=Ie.getDataRange(Ie.getBandList()),Le=me.createDecodingTask(Ye),Xe=J.slice(Ye.firstByte,Ye.lastByte+1),At=s.bs.performDecoding(Xe,Le).then((gt=>Le.complete(null,gt))).catch((gt=>Le.complete(gt,null)));Re.push(At)}Promise.allSettled(Re).then((()=>se(null,me))).catch((Ae=>se(Ae)))}catch(Re){se(Re)}}}class jt{constructor(J){this.actor=J,this.loading={},this.loaded={}}loadTile(J,se){const me=J.uid,Re=J.request,Ae=this.loading[me]=new wt(J),{cancel:Ie}=s.bu(Re,((Ye,Le,Xe,At)=>{const gt=!this.loading[me];if(delete this.loading[me],gt||Ye||!Le)return Ae.status="done",gt||(this.loaded[me]=Ae),se(Ye);Ae.parse(Le,((di,Mi)=>{if(di||!Mi)return se(di);se(null,Mi,Xe,At)})),this.loaded[me]=Ae}));Ae.abort=Ie}reloadTile(J,se){se(null,void 0)}abortTile(J,se){const me=J.uid,Re=this.loading[me];Re&&(Re.abort&&Re.abort(),delete this.loading[me]),se()}removeTile(J,se){const me=J.uid;this.loaded[me]&&delete this.loaded[me],se()}decodeRasterArray(J,se){s.bs.performDecoding(J.buffer,J.task).then((me=>se(null,me))).catch((me=>se(me)))}}const wi=s.fs.prototype.toGeoJSON;class Ai{constructor(J){this._feature=J,this.extent=s.al,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const se of this._feature.geometry)J.push([new s.P(se[0],se[1])]);return J}{const J=[];for(const se of this._feature.geometry){const me=[];for(const Re of se)me.push(new s.P(Re[0],Re[1]));J.push(me)}return J}}toGeoJSON(J,se,me){return wi.call(this,J,se,me)}}class vi{constructor(J,se){this.name=J,this.extent=s.al,this.length=se.length,this._jsonFeatures=se}feature(J){return new Ai(this._jsonFeatures[J])}}class Ve{constructor(J){this.layers={},this.extent=s.al;for(const se of Object.keys(J))this.layers[se]=new vi(se,J[se])}}const ke=64/4096,We=128;class ht{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],se){for(const me of J){const Re=me.id;if(Re==null)continue;let Ae=this.features.get(Re);Ae&&this.updateCache(Ae,se),me.geometry?(Ae=_t(me),this.updateCache(Ae,se),this.features.set(Re,Ae)):this.features.delete(Re),this.updateCache(Ae,se)}}updateCache(J,se){for(const{canonical:me,uid:Re}of Object.values(se)){const{z:Ae,x:Ie,y:Ye}=me;$e(J,Math.pow(2,Ae),Ie,Ye)&&delete se[Re]}}getTile(J,se,me){const Re=Math.pow(2,J),Ae=[];for(const Ie of this.features.values())$e(Ie,Re,se,me)&&Ae.push(Pt(Ie,Re,se,me));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function $e({minX:Fe,minY:J,maxX:se,maxY:me},Re,Ae,Ie){return Fe<(Ae+1+ke)/Re&&J<(Ie+1+ke)/Re&&se>(Ae-ke)/Re&&me>(Ie-ke)/Re}function _t(Fe){const{id:J,geometry:se,properties:me}=Fe;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Ae}=se,Ie={id:J,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Ie.geometry;if(Re==="Point")Ue(Ae,Ye,Ie);else if(Re==="MultiPoint")for(const Le of Ae)Ue(Le,Ye,Ie);else if(Re==="LineString")Ie.type=2,Cn(Ae,Ye,Ie);else if(Re==="MultiLineString")Ie.type=2,mn(Ae,Ye,Ie);else if(Re==="Polygon")Ie.type=3,mn(Ae,Ye,Ie,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Le of Ae)mn(Le,Ye,Ie,!0)}return Ie}function Ue([Fe,J],se,me){const Re=s.aF(Fe);let Ae=s.aJ(J);Ae=Ae<0?0:Ae>1?1:Ae,se.push(Re,Ae),me.minX=Math.min(me.minX,Re),me.minY=Math.min(me.minY,Ae),me.maxX=Math.max(me.maxX,Re),me.maxY=Math.max(me.maxY,Ae)}function Cn(Fe,J,se,me=!1,Re=!1){const Ae=[];for(const Ie of Fe)Ue(Ie,Ae,se);J.push(Ae),me&&(function(Ie,Ye){let Le=0;for(let Xe=0,At=Ie.length,gt=At-2;Xe<At;gt=Xe,Xe+=2)Le+=(Ie[Xe]-Ie[gt])*(Ie[Xe+1]+Ie[gt+1]);if(Le>0===Ye)for(let Xe=0,At=Ie.length;Xe<At/2;Xe+=2){const gt=Ie[Xe],di=Ie[Xe+1];Ie[Xe]=Ie[At-2-Xe],Ie[Xe+1]=Ie[At-1-Xe],Ie[At-2-Xe]=gt,Ie[At-1-Xe]=di}})(Ae,Re)}function mn(Fe,J,se,me=!1){for(let Re=0;Re<Fe.length;Re++)Cn(Fe[Re],J,se,me,Re===0)}function Pt(Fe,J,se,me){const{id:Re,type:Ae,geometry:Ie,tags:Ye}=Fe,Le=[];if(Ae===1)(function(Xe,At,gt,di,Mi){for(let Bi=0;Bi<Xe.length;Bi+=2){const un=Math.round(s.al*(Xe[Bi+0]*At-gt)),Wi=Math.round(s.al*(Xe[Bi+1]*At-di));Mi.push([un,Wi])}})(Ie,J,se,me,Le);else for(const Xe of Ie)Si(Xe,J,se,me,Le);return{id:Re,type:Ae,geometry:Le,tags:Ye}}function Si(Fe,J,se,me,Re){const Ae=-We,Ie=s.al+We;let Ye;for(let Le=0;Le<Fe.length-2;Le+=2){let Xe=Math.round(s.al*(Fe[Le+0]*J-se)),At=Math.round(s.al*(Fe[Le+1]*J-me)),gt=Math.round(s.al*(Fe[Le+2]*J-se)),di=Math.round(s.al*(Fe[Le+3]*J-me));const Mi=gt-Xe,Bi=di-At;Xe<Ae&&gt<Ae||(Xe<Ae?(At+=Math.round(Bi*((Ae-Xe)/Mi)),Xe=Ae):gt<Ae&&(di=At+Math.round(Bi*((Ae-Xe)/Mi)),gt=Ae),At<Ae&&di<Ae||(At<Ae?(Xe+=Math.round(Mi*((Ae-At)/Bi)),At=Ae):di<Ae&&(gt=Xe+Math.round(Mi*((Ae-At)/Bi)),di=Ae),Xe>=Ie&&gt>=Ie||(Xe>=Ie?(At+=Math.round(Bi*((Ie-Xe)/Mi)),Xe=Ie):gt>=Ie&&(di=At+Math.round(Bi*((Ie-Xe)/Mi)),gt=Ie),At>=Ie&&di>=Ie||(At>=Ie?(Xe+=Math.round(Mi*((Ie-At)/Bi)),At=Ie):di>=Ie&&(gt=Xe+Math.round(Mi*((Ie-At)/Bi)),di=Ie),Ye&&Xe===Ye[Ye.length-1][0]&&At===Ye[Ye.length-1][1]||(Ye=[[Xe,At]],Re.push(Ye)),Ye.push([gt,di])))))}}function fn({name:Fe,features:J},se){se.writeStringField(1,Fe),se.writeVarintField(5,s.al);const me=new Map,Re=new Map,Ae={keys:me,values:Re,feature:null};for(const Ie of J)Ae.feature=Ie,se.writeMessage(2,jn,Ae);for(const Ie of me.keys())se.writeStringField(3,Ie);for(const Ie of Re.keys())se.writeMessage(4,Hi,Ie)}function jn(Fe,J){const se=Fe.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&J.writeVarintField(1,+se.id),se.tags&&J.writeMessage(2,Wn,Fe),J.writeVarintField(3,se.type),J.writeMessage(4,Oi,se)}function Wn({keys:Fe,values:J,feature:se},me){for(const Re of Object.keys(se.tags)){let Ae=se.tags[Re];if(Ae===null)continue;let Ie=Fe.get(Re);Ie===void 0&&(Ie=Fe.size,Fe.set(Re,Ie)),me.writeVarint(Ie);const Ye=typeof Ae;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Ae=JSON.stringify(Ae));let Le=J.get(Ae);Le===void 0&&(Le=J.size,J.set(Ae,Le)),me.writeVarint(Le)}}function et(Fe,J){return(J<<3)+(7&Fe)}function Kt(Fe){return Fe<<1^Fe>>31}function Oi(Fe,J){const{geometry:se,type:me}=Fe;let Re=0,Ae=0;if(me===1){J.writeVarint(et(1,se.length));for(const Ie of se){const Ye=Ie[0]-Re,Le=Ie[1]-Ae;J.writeVarint(Kt(Ye)),J.writeVarint(Kt(Le)),Re+=Ye,Ae+=Le}}else for(const Ie of se){J.writeVarint(et(1,1));const Ye=Ie.length-(me===3?1:0);for(let Le=0;Le<Ye;Le++){Le===1&&J.writeVarint(et(2,Ye-1));const Xe=Ie[Le][0]-Re,At=Ie[Le][1]-Ae;J.writeVarint(Kt(Xe)),J.writeVarint(Kt(At)),Re+=Xe,Ae+=At}me===3&&J.writeVarint(et(7,1))}}function Hi(Fe,J){const se=typeof Fe;se==="string"?J.writeStringField(1,Fe):se==="boolean"?J.writeBooleanField(7,Fe):se==="number"&&(Fe%1!=0?J.writeDoubleField(3,Fe):Fe<0?J.writeSVarintField(6,Fe):J.writeVarintField(5,Fe))}const bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Fe=>Fe},Qt=Math.fround||(Li=new Float32Array(1),Fe=>(Li[0]=+Fe,Li[0]));var Li;const cn=3,Nn=5,ur=6;class Qo{constructor(J){this.options=Object.assign(Object.create(bn),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:se,minZoom:me,maxZoom:Re}=this.options;se&&console.time("total time");const Ae=`prepare ${J.length} points`;se&&console.time(Ae),this.points=J;const Ie=[];for(let Le=0;Le<J.length;Le++){const Xe=J[Le];if(!Xe.geometry)continue;const[At,gt]=Xe.geometry.coordinates,di=Qt(ys(At)),Mi=Qt(Dr(gt));Ie.push(di,Mi,1/0,Le,-1,1),this.options.reduce&&Ie.push(0)}let Ye=this.trees[Re+1]=this._createTree(Ie);se&&console.timeEnd(Ae);for(let Le=Re;Le>=me;Le--){const Xe=+Date.now();Ye=this.trees[Le]=this._createTree(this._cluster(Ye,Le)),se&&console.log("z%d: %d clusters in %dms",Le,Ye.numItems,+Date.now()-Xe)}return se&&console.timeEnd("total time"),this}getClusters(J,se){let me=((J[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,J[1]));let Ae=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)me=-180,Ae=180;else if(me>Ae){const gt=this.getClusters([me,Re,180,Ie],se),di=this.getClusters([-180,Re,Ae,Ie],se);return gt.concat(di)}const Ye=this.trees[this._limitZoom(se)],Le=Ye.range(ys(me),Dr(Ie),ys(Ae),Dr(Re)),Xe=Ye.data,At=[];for(const gt of Le){const di=this.stride*gt;At.push(Xe[di+Nn]>1?Jo(Xe,di,this.clusterProps):this.points[Xe[di+cn]])}return At}getChildren(J){const se=this._getOriginId(J),me=this._getOriginZoom(J),Re="No cluster with the specified id.",Ae=this.trees[me];if(!Ae)throw new Error(Re);const Ie=Ae.data;if(se*this.stride>=Ie.length)throw new Error(Re);const Ye=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Le=Ae.within(Ie[se*this.stride],Ie[se*this.stride+1],Ye),Xe=[];for(const At of Le){const gt=At*this.stride;Ie[gt+4]===J&&Xe.push(Ie[gt+Nn]>1?Jo(Ie,gt,this.clusterProps):this.points[Ie[gt+cn]])}if(Xe.length===0)throw new Error(Re);return Xe}getLeaves(J,se,me){const Re=[];return this._appendLeaves(Re,J,se=se||10,me=me||0,0),Re}getTile(J,se,me){const Re=this.trees[this._limitZoom(J)],Ae=Math.pow(2,J),{extent:Ie,radius:Ye}=this.options,Le=Ye/Ie,Xe=(me-Le)/Ae,At=(me+1+Le)/Ae,gt={features:[]};return this._addTileFeatures(Re.range((se-Le)/Ae,Xe,(se+1+Le)/Ae,At),Re.data,se,me,Ae,gt),se===0&&this._addTileFeatures(Re.range(1-Le/Ae,Xe,1,At),Re.data,Ae,me,Ae,gt),se===Ae-1&&this._addTileFeatures(Re.range(0,Xe,Le/Ae,At),Re.data,-1,me,Ae,gt),gt.features.length?gt:null}getClusterExpansionZoom(J){let se=this._getOriginZoom(J)-1;for(;se<=this.options.maxZoom;){const me=this.getChildren(J);if(se++,me.length!==1)break;J=me[0].properties.cluster_id}return se}_appendLeaves(J,se,me,Re,Ae){const Ie=this.getChildren(se);for(const Ye of Ie){const Le=Ye.properties;if(Le&&Le.cluster?Ae+Le.point_count<=Re?Ae+=Le.point_count:Ae=this._appendLeaves(J,Le.cluster_id,me,Re,Ae):Ae<Re?Ae++:J.push(Ye),J.length===me)break}return Ae}_createTree(J){const se=new s.c3(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<J.length;me+=this.stride)se.add(J[me],J[me+1]);return se.finish(),se.data=J,se}_addTileFeatures(J,se,me,Re,Ae,Ie){for(const Ye of J){const Le=Ye*this.stride,Xe=se[Le+Nn]>1;let At,gt,di;if(Xe)At=Ya(se,Le,this.clusterProps),gt=se[Le],di=se[Le+1];else{const un=this.points[se[Le+cn]];At=un.properties;const[Wi,hn]=un.geometry.coordinates;gt=ys(Wi),di=Dr(hn)}const Mi={type:1,geometry:[[Math.round(this.options.extent*(gt*Ae-me)),Math.round(this.options.extent*(di*Ae-Re))]],tags:At};let Bi;Bi=Xe||this.options.generateId?se[Le+cn]:this.points[se[Le+cn]].id,Bi!==void 0&&(Mi.id=Bi),Ie.features.push(Mi)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,se){const{radius:me,extent:Re,reduce:Ae,minPoints:Ie}=this.options,Ye=me/(Re*Math.pow(2,se)),Le=J.data,Xe=[],At=this.stride;for(let gt=0;gt<Le.length;gt+=At){if(Le[gt+2]<=se)continue;Le[gt+2]=se;const di=Le[gt],Mi=Le[gt+1],Bi=J.within(Le[gt],Le[gt+1],Ye),un=Le[gt+Nn];let Wi=un;for(const hn of Bi){const Ln=hn*At;Le[Ln+2]>se&&(Wi+=Le[Ln+Nn])}if(Wi>un&&Wi>=Ie){let hn,Ln=di*un,Ki=Mi*un,Zn=-1;const Cr=(gt/At<<5)+(se+1)+this.points.length;for(const Gn of Bi){const Vn=Gn*At;if(Le[Vn+2]<=se)continue;Le[Vn+2]=se;const Rn=Le[Vn+Nn];Ln+=Le[Vn]*Rn,Ki+=Le[Vn+1]*Rn,Le[Vn+4]=Cr,Ae&&(hn||(hn=this._map(Le,gt,!0),Zn=this.clusterProps.length,this.clusterProps.push(hn)),Ae(hn,this._map(Le,Vn)))}Le[gt+4]=Cr,Xe.push(Ln/Wi,Ki/Wi,1/0,Cr,-1,Wi),Ae&&Xe.push(Zn)}else{for(let hn=0;hn<At;hn++)Xe.push(Le[gt+hn]);if(Wi>1)for(const hn of Bi){const Ln=hn*At;if(!(Le[Ln+2]<=se)){Le[Ln+2]=se;for(let Ki=0;Ki<At;Ki++)Xe.push(Le[Ln+Ki])}}}}return Xe}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,se,me){if(J[se+Nn]>1){const Ie=this.clusterProps[J[se+ur]];return me?Object.assign({},Ie):Ie}const Re=this.points[J[se+cn]].properties,Ae=this.options.map(Re);return me&&Ae===Re?Object.assign({},Ae):Ae}}function Jo(Fe,J,se){return{type:"Feature",id:Fe[J+cn],properties:Ya(Fe,J,se),geometry:{type:"Point",coordinates:[(me=Fe[J],360*(me-.5)),Il(Fe[J+1])]}};var me}function Ya(Fe,J,se){const me=Fe[J+Nn],Re=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ae=Fe[J+ur],Ie=Ae===-1?{}:Object.assign({},se[Ae]);return Object.assign(Ie,{cluster:!0,cluster_id:Fe[J+cn],point_count:me,point_count_abbreviated:Re})}function ys(Fe){return Fe/360+.5}function Dr(Fe){const J=Math.sin(Fe*Math.PI/180),se=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return se<0?0:se>1?1:se}function Il(Fe){const J=(180-360*Fe)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Ka(Fe,J,se,me){let Re=me;const Ae=J+(se-J>>1);let Ie,Ye=se-J;const Le=Fe[J],Xe=Fe[J+1],At=Fe[se],gt=Fe[se+1];for(let di=J+3;di<se;di+=3){const Mi=Uc(Fe[di],Fe[di+1],Le,Xe,At,gt);if(Mi>Re)Ie=di,Re=Mi;else if(Mi===Re){const Bi=Math.abs(di-Ae);Bi<Ye&&(Ie=di,Ye=Bi)}}Re>me&&(Ie-J>3&&Ka(Fe,J,Ie,me),Fe[Ie+2]=Re,se-Ie>3&&Ka(Fe,Ie,se,me))}function Uc(Fe,J,se,me,Re,Ae){let Ie=Re-se,Ye=Ae-me;if(Ie!==0||Ye!==0){const Le=((Fe-se)*Ie+(J-me)*Ye)/(Ie*Ie+Ye*Ye);Le>1?(se=Re,me=Ae):Le>0&&(se+=Ie*Le,me+=Ye*Le)}return Ie=Fe-se,Ye=J-me,Ie*Ie+Ye*Ye}function Tr(Fe,J,se,me){const Re={id:Fe??null,type:J,geometry:se,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")ls(Re,se);else if(J==="Polygon")ls(Re,se[0]);else if(J==="MultiLineString")for(const Ae of se)ls(Re,Ae);else if(J==="MultiPolygon")for(const Ae of se)ls(Re,Ae[0]);return Re}function ls(Fe,J){for(let se=0;se<J.length;se+=3)Fe.minX=Math.min(Fe.minX,J[se]),Fe.minY=Math.min(Fe.minY,J[se+1]),Fe.maxX=Math.max(Fe.maxX,J[se]),Fe.maxY=Math.max(Fe.maxY,J[se+1])}function Fs(Fe,J,se,me){if(!J.geometry)return;const Re=J.geometry.coordinates;if(Re&&Re.length===0)return;const Ae=J.geometry.type,Ie=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let Ye=[],Le=J.id;if(se.promoteId?Le=J.properties[se.promoteId]:se.generateId&&(Le=me||0),Ae==="Point")Cl(Re,Ye);else if(Ae==="MultiPoint")for(const Xe of Re)Cl(Xe,Ye);else if(Ae==="LineString")Qa(Re,Ye,Ie,!1);else if(Ae==="MultiLineString"){if(se.lineMetrics){for(const Xe of Re)Ye=[],Qa(Xe,Ye,Ie,!1),Fe.push(Tr(Le,"LineString",Ye,J.properties));return}Bs(Re,Ye,Ie,!1)}else if(Ae==="Polygon")Bs(Re,Ye,Ie,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const Xe of J.geometry.geometries)Fs(Fe,{id:Le,geometry:Xe,properties:J.properties},se,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Re){const At=[];Bs(Xe,At,Ie,!0),Ye.push(At)}}Fe.push(Tr(Le,Ae,Ye,J.properties))}function Cl(Fe,J){J.push(Ra(Fe[0]),no(Fe[1]),0)}function Qa(Fe,J,se,me){let Re,Ae,Ie=0;for(let Le=0;Le<Fe.length;Le++){const Xe=Ra(Fe[Le][0]),At=no(Fe[Le][1]);J.push(Xe,At,0),Le>0&&(Ie+=me?(Re*At-Xe*Ae)/2:Math.sqrt(Math.pow(Xe-Re,2)+Math.pow(At-Ae,2))),Re=Xe,Ae=At}const Ye=J.length-3;J[2]=1,Ka(J,0,Ye,se),J[Ye+2]=1,J.size=Math.abs(Ie),J.start=0,J.end=J.size}function Bs(Fe,J,se,me){for(let Re=0;Re<Fe.length;Re++){const Ae=[];Qa(Fe[Re],Ae,se,me),J.push(Ae)}}function Ra(Fe){return Fe/360+.5}function no(Fe){const J=Math.sin(Fe*Math.PI/180),se=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return se<0?0:se>1?1:se}function xo(Fe,J,se,me,Re,Ae,Ie,Ye){if(me/=J,Ae>=(se/=J)&&Ie<me)return Fe;if(Ie<se||Ae>=me)return null;const Le=[];for(const Xe of Fe){const At=Xe.geometry;let gt=Xe.type;const di=Re===0?Xe.minX:Xe.minY,Mi=Re===0?Xe.maxX:Xe.maxY;if(di>=se&&Mi<me){Le.push(Xe);continue}if(Mi<se||di>=me)continue;let Bi=[];if(gt==="Point"||gt==="MultiPoint")Ja(At,Bi,se,me,Re);else if(gt==="LineString")Rl(At,Bi,se,me,Re,!1,Ye.lineMetrics);else if(gt==="MultiLineString")Ms(At,Bi,se,me,Re,!1);else if(gt==="Polygon")Ms(At,Bi,se,me,Re,!0);else if(gt==="MultiPolygon")for(const un of At){const Wi=[];Ms(un,Wi,se,me,Re,!0),Wi.length&&Bi.push(Wi)}if(Bi.length){if(Ye.lineMetrics&&gt==="LineString"){for(const un of Bi)Le.push(Tr(Xe.id,gt,un,Xe.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(Bi.length===1?(gt="LineString",Bi=Bi[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=Bi.length===3?"Point":"MultiPoint"),Le.push(Tr(Xe.id,gt,Bi,Xe.tags))}}return Le.length?Le:null}function Ja(Fe,J,se,me,Re){for(let Ae=0;Ae<Fe.length;Ae+=3){const Ie=Fe[Ae+Re];Ie>=se&&Ie<=me&&ga(J,Fe[Ae],Fe[Ae+1],Fe[Ae+2])}}function Rl(Fe,J,se,me,Re,Ae,Ie){let Ye=jc(Fe);const Le=Re===0?ea:vs;let Xe,At,gt=Fe.start;for(let Wi=0;Wi<Fe.length-3;Wi+=3){const hn=Fe[Wi],Ln=Fe[Wi+1],Ki=Fe[Wi+2],Zn=Fe[Wi+3],Cr=Fe[Wi+4],Gn=Re===0?hn:Ln,Vn=Re===0?Zn:Cr;let Rn=!1;Ie&&(Xe=Math.sqrt(Math.pow(hn-Zn,2)+Math.pow(Ln-Cr,2))),Gn<se?Vn>se&&(At=Le(Ye,hn,Ln,Zn,Cr,se),Ie&&(Ye.start=gt+Xe*At)):Gn>me?Vn<me&&(At=Le(Ye,hn,Ln,Zn,Cr,me),Ie&&(Ye.start=gt+Xe*At)):ga(Ye,hn,Ln,Ki),Vn<se&&Gn>=se&&(At=Le(Ye,hn,Ln,Zn,Cr,se),Rn=!0),Vn>me&&Gn<=me&&(At=Le(Ye,hn,Ln,Zn,Cr,me),Rn=!0),!Ae&&Rn&&(Ie&&(Ye.end=gt+Xe*At),J.push(Ye),Ye=jc(Fe)),Ie&&(gt+=Xe)}let di=Fe.length-3;const Mi=Fe[di],Bi=Fe[di+1],un=Re===0?Mi:Bi;un>=se&&un<=me&&ga(Ye,Mi,Bi,Fe[di+2]),di=Ye.length-3,Ae&&di>=3&&(Ye[di]!==Ye[0]||Ye[di+1]!==Ye[1])&&ga(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&J.push(Ye)}function jc(Fe){const J=[];return J.size=Fe.size,J.start=Fe.start,J.end=Fe.end,J}function Ms(Fe,J,se,me,Re,Ae){for(const Ie of Fe)Rl(Ie,J,se,me,Re,Ae,!1)}function ga(Fe,J,se,me){Fe.push(J,se,me)}function ea(Fe,J,se,me,Re,Ae){const Ie=(Ae-J)/(me-J);return ga(Fe,Ae,se+(Re-se)*Ie,1),Ie}function vs(Fe,J,se,me,Re,Ae){const Ie=(Ae-se)/(Re-se);return ga(Fe,J+(me-J)*Ie,Ae,1),Ie}function Vs(Fe,J){const se=[];for(let me=0;me<Fe.length;me++){const Re=Fe[me],Ae=Re.type;let Ie;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Ie=Yr(Re.geometry,J);else if(Ae==="MultiLineString"||Ae==="Polygon"){Ie=[];for(const Ye of Re.geometry)Ie.push(Yr(Ye,J))}else if(Ae==="MultiPolygon"){Ie=[];for(const Ye of Re.geometry){const Le=[];for(const Xe of Ye)Le.push(Yr(Xe,J));Ie.push(Le)}}se.push(Tr(Re.id,Ae,Ie,Re.tags))}return se}function Yr(Fe,J){const se=[];se.size=Fe.size,Fe.start!==void 0&&(se.start=Fe.start,se.end=Fe.end);for(let me=0;me<Fe.length;me+=3)se.push(Fe[me]+J,Fe[me+1],Fe[me+2]);return se}function ac(Fe,J){if(Fe.transformed)return Fe;const se=1<<Fe.z,me=Fe.x,Re=Fe.y;for(const Ae of Fe.features){const Ie=Ae.geometry,Ye=Ae.type;if(Ae.geometry=[],Ye===1)for(let Le=0;Le<Ie.length;Le+=2)Ae.geometry.push(hr(Ie[Le],Ie[Le+1],J,se,me,Re));else for(let Le=0;Le<Ie.length;Le++){const Xe=[];for(let At=0;At<Ie[Le].length;At+=2)Xe.push(hr(Ie[Le][At],Ie[Le][At+1],J,se,me,Re));Ae.geometry.push(Xe)}}return Fe.transformed=!0,Fe}function hr(Fe,J,se,me,Re,Ae){return[Math.round(se*(Fe*me-Re)),Math.round(se*(J*me-Ae))]}function Ts(Fe,J,se,me,Re){const Ae=J===Re.maxZoom?0:Re.tolerance/((1<<J)*Re.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Fe.length,source:null,x:se,y:me,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Fe)_a(Ie,Ye,Ae,Re);return Ie}function _a(Fe,J,se,me){const Re=J.geometry,Ae=J.type,Ie=[];if(Fe.minX=Math.min(Fe.minX,J.minX),Fe.minY=Math.min(Fe.minY,J.minY),Fe.maxX=Math.max(Fe.maxX,J.maxX),Fe.maxY=Math.max(Fe.maxY,J.maxY),Ae==="Point"||Ae==="MultiPoint")for(let Ye=0;Ye<Re.length;Ye+=3)Ie.push(Re[Ye],Re[Ye+1]),Fe.numPoints++,Fe.numSimplified++;else if(Ae==="LineString")Ma(Ie,Re,Fe,se,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let Ye=0;Ye<Re.length;Ye++)Ma(Ie,Re[Ye],Fe,se,Ae==="Polygon",Ye===0);else if(Ae==="MultiPolygon")for(let Ye=0;Ye<Re.length;Ye++){const Le=Re[Ye];for(let Xe=0;Xe<Le.length;Xe++)Ma(Ie,Le[Xe],Fe,se,!0,Xe===0)}if(Ie.length){let Ye=J.tags||null;if(Ae==="LineString"&&me.lineMetrics){Ye={};for(const Xe in J.tags)Ye[Xe]=J.tags[Xe];Ye.mapbox_clip_start=Re.start/Re.size,Ye.mapbox_clip_end=Re.end/Re.size}const Le={geometry:Ie,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Ye};J.id!==null&&(Le.id=J.id),Fe.features.push(Le)}}function Ma(Fe,J,se,me,Re,Ae){const Ie=me*me;if(me>0&&J.size<(Re?Ie:me))return void(se.numPoints+=J.length/3);const Ye=[];for(let Le=0;Le<J.length;Le+=3)(me===0||J[Le+2]>Ie)&&(se.numSimplified++,Ye.push(J[Le],J[Le+1])),se.numPoints++;Re&&(function(Le,Xe){let At=0;for(let gt=0,di=Le.length,Mi=di-2;gt<di;Mi=gt,gt+=2)At+=(Le[gt]-Le[Mi])*(Le[gt+1]+Le[Mi+1]);if(At>0===Xe)for(let gt=0,di=Le.length;gt<di/2;gt+=2){const Mi=Le[gt],Bi=Le[gt+1];Le[gt]=Le[di-2-gt],Le[gt+1]=Le[di-1-gt],Le[di-2-gt]=Mi,Le[di-1-gt]=Bi}})(Ye,Ae),Fe.push(Ye)}const Hr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ya{constructor(J,se){const me=(se=this.options=(function(Ae,Ie){for(const Ye in Ie)Ae[Ye]=Ie[Ye];return Ae})(Object.create(Hr),se)).debug;if(me&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=(function(Ae,Ie){const Ye=[];if(Ae.type==="FeatureCollection")for(let Le=0;Le<Ae.features.length;Le++)Fs(Ye,Ae.features[Le],Ie,Le);else Fs(Ye,Ae.type==="Feature"?Ae:{geometry:Ae},Ie);return Ye})(J,se);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=(function(Ae,Ie){const Ye=Ie.buffer/Ie.extent;let Le=Ae;const Xe=xo(Ae,1,-1-Ye,Ye,0,-1,2,Ie),At=xo(Ae,1,1-Ye,2+Ye,0,-1,2,Ie);return(Xe||At)&&(Le=xo(Ae,1,-Ye,1+Ye,0,-1,2,Ie)||[],Xe&&(Le=Vs(Xe,1).concat(Le)),At&&(Le=Le.concat(Vs(At,-1)))),Le})(Re,se),Re.length&&this.splitTile(Re,0,0,0),me&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,se,me,Re,Ae,Ie,Ye){const Le=[J,se,me,Re],Xe=this.options,At=Xe.debug;for(;Le.length;){Re=Le.pop(),me=Le.pop(),se=Le.pop(),J=Le.pop();const gt=1<<se,di=va(se,me,Re);let Mi=this.tiles[di];if(!Mi&&(At>1&&console.time("creation"),Mi=this.tiles[di]=Ts(J,se,me,Re,Xe),this.tileCoords.push({z:se,x:me,y:Re}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,me,Re,Mi.numFeatures,Mi.numPoints,Mi.numSimplified),console.timeEnd("creation"));const Rn=`z${se}`;this.stats[Rn]=(this.stats[Rn]||0)+1,this.total++}if(Mi.source=J,Ae==null){if(se===Xe.indexMaxZoom||Mi.numPoints<=Xe.indexMaxPoints)continue}else{if(se===Xe.maxZoom||se===Ae)continue;if(Ae!=null){const Rn=Ae-se;if(me!==Ie>>Rn||Re!==Ye>>Rn)continue}}if(Mi.source=null,J.length===0)continue;At>1&&console.time("clipping");const Bi=.5*Xe.buffer/Xe.extent,un=.5-Bi,Wi=.5+Bi,hn=1+Bi;let Ln=null,Ki=null,Zn=null,Cr=null,Gn=xo(J,gt,me-Bi,me+Wi,0,Mi.minX,Mi.maxX,Xe),Vn=xo(J,gt,me+un,me+hn,0,Mi.minX,Mi.maxX,Xe);J=null,Gn&&(Ln=xo(Gn,gt,Re-Bi,Re+Wi,1,Mi.minY,Mi.maxY,Xe),Ki=xo(Gn,gt,Re+un,Re+hn,1,Mi.minY,Mi.maxY,Xe),Gn=null),Vn&&(Zn=xo(Vn,gt,Re-Bi,Re+Wi,1,Mi.minY,Mi.maxY,Xe),Cr=xo(Vn,gt,Re+un,Re+hn,1,Mi.minY,Mi.maxY,Xe),Vn=null),At>1&&console.timeEnd("clipping"),Le.push(Ln||[],se+1,2*me,2*Re),Le.push(Ki||[],se+1,2*me,2*Re+1),Le.push(Zn||[],se+1,2*me+1,2*Re),Le.push(Cr||[],se+1,2*me+1,2*Re+1)}}getTile(J,se,me){J=+J,se=+se,me=+me;const Re=this.options,{extent:Ae,debug:Ie}=Re;if(J<0||J>24)return null;const Ye=1<<J,Le=va(J,se=se+Ye&Ye-1,me);if(this.tiles[Le])return ac(this.tiles[Le],Ae);Ie>1&&console.log("drilling down to z%d-%d-%d",J,se,me);let Xe,At=J,gt=se,di=me;for(;!Xe&&At>0;)At--,gt>>=1,di>>=1,Xe=this.tiles[va(At,gt,di)];return Xe&&Xe.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",At,gt,di),console.time("drilling down")),this.splitTile(Xe.source,At,gt,di,J,se,me),Ie>1&&console.timeEnd("drilling down"),this.tiles[Le]?ac(this.tiles[Le],Ae):null):null}}function va(Fe,J,se){return 32*((1<<Fe)*se+J)+Fe}function xa(Fe,J){const se=Fe.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const me=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!me)return void J(null,null);const Re=Xe=>Xe.tags&&"3d_elevation_id"in Xe.tags&&"source"in Xe.tags&&Xe.tags.source==="elevation",Ae=me.features.filter((Xe=>Re(Xe)));let Ie={_geojsonTileLayer:me.features};Ae.length>0&&(Ie={_geojsonTileLayer:me.features.filter((Xe=>!Re(Xe))),hd_road_elevation:Ae});const Ye=new Ve(Ie),Le=(function(Xe){const At=new s.bt;for(const gt of Object.keys(Xe))At.writeMessage(3,fn,{name:gt,features:Xe[gt]});return At.finish()})(Ie).buffer;J(null,{vectorTile:Ye,rawData:Le})}class Ct extends Qe{constructor(J,se,me,Re,Ae,Ie,Ye){super(J,se,me,Re,Ae,xa,Ye),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new ht}loadData(J,se){const me=J&&J.request,Re=me&&me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(J,((Ae,Ie)=>{if(Ae||!Ie)return se(Ae);if(typeof Ie!="object")return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const Le=s.U(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map((Xe=>`${Xe.key}: ${Xe.message}`)).join(", "));Ie.features=Ie.features.filter((Xe=>Le.value.evaluate({zoom:0},Xe)))}J.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),J.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new Qo((function({superclusterOptions:Le,clusterProperties:Xe}){if(!Xe||!Le)return Le;const At={},gt={},di={accumulated:null,zoom:0},Mi={properties:null},Bi=Object.keys(Xe);for(const un of Bi){const[Wi,hn]=Xe[un],Ln=s.U(hn),Ki=s.U(typeof Wi=="string"?[Wi,["accumulated"],["get",un]]:Wi);At[un]=Ln.value,gt[un]=Ki.value}return Le.map=un=>{Mi.properties=un;const Wi={};for(const hn of Bi)Wi[hn]=At[hn].evaluate(di,Mi);return Wi},Le.reduce=(un,Wi)=>{Mi.properties=Wi;for(const hn of Bi)di.accumulated=un[hn],un[hn]=gt[hn].evaluate(di,Mi)},Le})(J)).load(Ie.features):J.dynamic?this._dynamicIndex:(function(Le,Xe){return new ya(Le,Xe)})(Ie,J.geojsonVtOptions)}catch(Le){return se(Le)}const Ye={};if(Re){const Le=G(me);Le&&(Ye.resourceTiming={},Ye.resourceTiming[J.source]=JSON.parse(JSON.stringify(Le)))}se(null,Ye)}}))}reloadTile(J,se){const me=this.loaded;return me&&me[J.uid]?J.partial?se(null,void 0):super.reloadTile(J,se):this.loadTile(J,se)}loadGeoJSON(J,se){if(J.request)s.m(J.request,se);else{if(typeof J.data!="string")return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return se(null,JSON.parse(J.data))}catch{return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(J,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(me){se(me)}}getClusterChildren(J,se){try{se(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(me){se(me)}}getClusterLeaves(J,se){try{se(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(me){se(me)}}}class el{constructor(J,se,me){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=se,this.worldview=me}parse(J,se,me,Re){this.status="parsing";const Ae=new s.aO(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Ie=[],Ye=se.familiesBySource[me.source],Le=new s.fe(Ae,me.promoteId);Le.bucketLayerIDs=[],Le.is3DTile=!0,s.ft(J).then((Xe=>{if(!Xe)return Re(new Error("Could not parse tile"));const At=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,gt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),di=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Mi in Ye)for(const Bi of Ye[Mi]){const un=Bi[0];Le.bucketLayerIDs.push(Bi.map((Ln=>s.B(Ln.id,Ln.scope)))),un.recalculate(di,[]);const Wi=s.fu(Xe,1/s.d6(me.tileID.canonical)),hn=new s.fv(Bi,Wi,Ae,At,gt,this.brightness,Le,this.worldview);At||(hn.needsUpload=!0),Ie.push(hn),hn.evaluate(un)}this.status="done",Re(null,{buckets:Ie,featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Xe=>Re(new Error(Xe.message))))}}class tl{constructor(J,se,me,Re,Ae,Ie,Ye,Le){this.actor=J,this.layerIndex=se,this.availableImages=me,this.availableModels=Re,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=Le}loadTile(J,se){const me=J.uid,Re=this.loading[me]=new el(J,this.brightness,this.worldview);s.bu(J.request,((Ae,Ie)=>{const Ye=!this.loading[me];return delete this.loading[me],Ye||Ae?(Re.status="done",Ye||(this.loaded[me]=Re),se(Ae)):Ie&&Ie.byteLength!==0?void Re.parse(Ie,this.layerIndex,J,((Le,Xe)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[me]=Re,Le||!Xe?se(Le):se(null,Xe)})):(Re.status="done",this.loaded[me]=Re,se())}))}reloadTile(J,se){const me=this.loaded,Re=J.uid;if(me&&me[Re]){const Ae=me[Re];Ae.projection=J.projection,Ae.brightness=J.brightness;const Ie=(Ye,Le)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(J,se)),se(Ye,Le)};Ae.status==="parsing"?Ae.reloadCallback=Ie:Ae.status==="done"&&this.loadTile(J,se)}}abortTile(J,se){const me=J.uid;this.loading[me]&&delete this.loading[me],se()}removeTile(J,se){const me=this.loaded,Re=J.uid;me&&me[Re]&&delete me[Re],se()}}class il{constructor(J){this.self=J,this.actor=new s.fx(J,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:Qe,geojson:Ct,"raster-dem":xt,"raster-array":jt,"batched-model":tl},this.workerSources={},this.self.registerWorkerSource=(se,me)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=me},this.self.registerRTLTextPlugin=se=>{if(s.fy.isParsed())throw new Error("RTL text plugin already registered.");s.fy.setState({pluginStatus:s.fz.parsed,pluginURL:s.fy.getPluginURL()}),s.fy.applyArabicShaping=se.applyArabicShaping,s.fy.processBidirectionalText=se.processBidirectionalText,s.fy.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(J,se,me){delete this.layerIndexes[J],delete this.availableImages[J],delete this.availableModels[J],delete this.workerSources[J],me()}checkIfReady(J,se,me){me()}setReferrer(J,se){this.referrer=se}spriteLoaded(J,se){this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={});const{scope:me,isLoaded:Re}=se;if(this.isSpriteLoaded[J][me]=Re,this.workerSources[J]&&this.workerSources[J][me])for(const Ae in this.workerSources[J][me]){const Ie=this.workerSources[J][me][Ae];for(const Ye in Ie){const Le=Ie[Ye];Le instanceof Qe&&(Le.isSpriteLoaded=Re,Le.fire(new s.z("isSpriteLoaded")))}}}setImages(J,se,me){this.availableImages[J]||(this.availableImages[J]={});const{scope:Re,images:Ae}=se;if(this.availableImages[J][Re]=Ae,this.workerSources[J]&&this.workerSources[J][Re]){for(const Ie in this.workerSources[J][Re]){const Ye=this.workerSources[J][Re][Ie];for(const Le in Ye)Ye[Le].availableImages=Ae}me()}else me()}setModels(J,{scope:se,models:me},Re){if(this.availableModels[J]||(this.availableModels[J]={}),this.availableModels[J][se]=me,this.workerSources[J]&&this.workerSources[J][se]){for(const Ae in this.workerSources[J][se]){const Ie=this.workerSources[J][se][Ae];for(const Ye in Ie)Ie[Ye].availableModels=me}Re()}else Re()}setProjection(J,se){this.projections[J]=s.cl(se)}setBrightness(J,se,me){this.brightness=se,me()}setWorldview(J,se,me){this.worldview=se,me()}setLayers(J,se,me){this.getLayerIndex(J,se.scope).replace(se.layers,se.options),me()}updateLayers(J,se,me){this.getLayerIndex(J,se.scope).update(se.layers,se.removedIds,se.options),me()}loadTile(J,se,me){se.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,se.type,se.source,se.scope).loadTile(se,me)}decodeRasterArray(J,se,me){this.getWorkerSource(J,se.type,se.source,se.scope).decodeRasterArray(se,me)}reloadTile(J,se,me){se.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,se.type,se.source,se.scope).reloadTile(se,me)}abortTile(J,se,me){this.getWorkerSource(J,se.type,se.source,se.scope).abortTile(se,me)}removeTile(J,se,me){this.getWorkerSource(J,se.type,se.source,se.scope).removeTile(se,me)}removeSource(J,se,me){if(!(this.workerSources[J]&&this.workerSources[J][se.scope]&&this.workerSources[J][se.scope][se.type]&&this.workerSources[J][se.scope][se.type][se.source]))return;const Re=this.workerSources[J][se.scope][se.type][se.source];delete this.workerSources[J][se.scope][se.type][se.source],Re.removeSource!==void 0?Re.removeSource(se,me):me()}loadWorkerSource(J,se,me){try{this.self.importScripts(se.url),me()}catch(Re){me(Re.toString())}}syncRTLPluginState(J,se,me){if(s.fy.isParsed())me(null,!0);else if(s.fy.isParsing())this.rtlPluginParsingListeners.push(me);else try{s.fy.setState(se);const Re=s.fy.getPluginURL();!s.fy.isLoaded()||s.fy.isParsed()||s.fy.isParsing()||Re==null||(s.fy.setState({pluginStatus:s.fz.parsing,pluginURL:s.fy.getPluginURL()}),this.self.importScripts(Re),s.fy.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(Re){me(Re.toString())}}setDracoUrl(J,se){this.dracoUrl=se}getAvailableImages(J,se){this.availableImages[J]||(this.availableImages[J]={});let me=this.availableImages[J][se];return me||(me=[]),me}getAvailableModels(J,se){this.availableModels[J]||(this.availableModels[J]={});let me=this.availableModels[J][se];return me||(me={}),me}getLayerIndex(J,se){this.layerIndexes[J]||(this.layerIndexes[J]={});let me=this.layerIndexes[J][se];return me||(me=this.layerIndexes[J][se]=new ce,me.scope=se),me}getWorkerSource(J,se,me,Re){const Ae=this.workerSources;return Ae[J]||(Ae[J]={}),Ae[J][Re]||(Ae[J][Re]={}),Ae[J][Re][se]||(Ae[J][Re][se]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),Ae[J][Re][se][me]||(Ae[J][Re][se][me]=new this.workerSourceTypes[se]({send:(Ie,Ye,Le,Xe,At,gt)=>this.actor.send(Ie,Ye,Le,J,At,gt),scheduler:this.actor.scheduler},this.getLayerIndex(J,Re),this.getAvailableImages(J,Re),this.getAvailableModels(J,Re),this.isSpriteLoaded[J][Re],void 0,this.brightness,this.worldview)),Ae[J][Re][se][me]}rasterizeImagesWorker(J,se,me){const Re=new Map;for(const[Ae,{image:Ie,imageVariant:Ye}]of se.tasks.entries()){const Le=this.imageRasterizer.rasterize(Ye,Ie,se.scope,J);Re.set(Ae,Le)}me(void 0,Re)}removeRasterizedImages(J,se,me){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,J),me()}enforceCacheSizeLimit(J,se){s.fA(se)}getWorkerPerformanceMetrics(J,se,me){me(void 0,void 0)}}return s.fw(self)&&(self.worker=new il(self)),il})),C(["./shared"],(function(s){var G="3.15.0";const q={create:"create",load:"load",fullLoad:"fullLoad"},te={mark(f){performance.mark(f)},measure(f,t,o){performance.measure(f,t,o)}};function ce(f){const t=f.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var we,ze={},at=(function(){if(we)return ze;function f(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,T,S=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(S);try{T=new Worker(R),v=!0}catch{v=!1}return T&&T.terminate(),URL.revokeObjectURL(R),v})()?(function(){var v=document.createElement("canvas");v.width=v.height=1;var T=v.getContext("2d");if(!T)return!1;var S=T.getImageData(0,0,1,1);return S&&S.width===v.width})()?(o[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(o[y]=(function(v){var T,S=(function(R){var O=document.createElement("canvas"),k=Object.create(f.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=R,O.getContext("webgl2",k)})(v);if(!S)return!1;try{T=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!T||S.isContextLost())&&(S.shaderSource(T,"void main() {}"),S.compileShader(T),S.getShaderParameter(T,S.COMPILE_STATUS)===!0)})(y)),o[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}we=1,ze.supported=f,ze.notSupportedReason=t;var o={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ze})();function Ge(f,t,o){const d=document.createElement(f);return t!=null&&(d.className=t),o&&o.appendChild(d),d}function Qe(f,t,o){const d=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(t))d.setAttributeNS(null,y,String(t[y]));return o&&o.appendChild(d),d}const xt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,wt=xt&&xt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let jt;function wi(){xt&&wt&&(jt=xt[wt],xt[wt]="none")}function Ai(){xt&&wt&&(xt[wt]=jt)}function vi(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",vi,!0)}function Ve(){window.addEventListener("click",vi,!0),window.setTimeout((()=>{window.removeEventListener("click",vi,!0)}),0)}function ke(f,t){const o=f.getBoundingClientRect();return $e(f,o,t)}function We(f,t){const o=f.getBoundingClientRect(),d=[];for(let y=0;y<t.length;y++)d.push($e(f,o,t[y]));return d}function ht(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function $e(f,t,o){const d=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new s.P((o.clientX-t.left)*d,(o.clientY-t.top)*d)}const _t="01",Ue="NO_ACCESS_TOKEN";class Cn{constructor(t,o,d){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=(function(){let o="";for(let d=0;d<10;d++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_t,o].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!s.h(t))return t;const d=Pt(t);return d.params.push(`sdk=js-${G}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!s.h(t))return t;const d=Pt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeModelURL(t,o){if(!s.h(t))return t;const d=Pt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeSourceURL(t,o,d,y){if(!s.h(t))return t;const v=Pt(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),d&&v.params.push(`language=${d}`),y&&v.params.push(`worldview=${y}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeIconsetURL(t,o){const d=Pt(t);return s.h(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||o)):Si(d)}normalizeSpriteURL(t,o,d,y){const v=Pt(t);return s.h(t)?(v.path=`/styles/v1${v.path}/sprite${o}${d}`,this._makeAPIURL(v,this._customAccessToken||y)):(v.path+=`${o}${d}`,Si(v))}normalizeTileURL(t,o,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const y=Pt(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||d&&y.authority!=="raster"&&d===512?"@2x":""}${s.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${s.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${s.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${s.e.TILE_URL_VERSION}${y.path}`);const v=this._customAccessToken||(function(T){for(const S of T){const R=S.match(/^access_token=(.*)$/);if(R)return R[1]}return null})(y.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,v)}canonicalizeTileURL(t,o){const d=Pt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let v=d.params;return o&&(v=v.filter((T=>!T.match(/^access_token=/)))),v.length&&(y+=`?${v.join("&")}`),y}canonicalizeTileset(t,o){const d=!!o&&s.h(o),y=[];for(const v of t.tiles||[])s.j(v)?y.push(this.canonicalizeTileURL(v,d)):y.push(v);return y}_makeAPIURL(t,o){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Pt(s.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Si(t);if(o=o||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter((v=>v.indexOf("access_token")===-1)),t.params.push(`access_token=${o||""}`),Si(t)}}const mn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pt(f){const t=f.match(mn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Si(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const fn="mapbox.eventData";function jn(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class Wn{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=jn(s.e.ACCESS_TOKEN);let d="";return d=o&&o.u?s.f(o.u):s.e.ACCESS_TOKEN||"",t?`${fn}.${t}:${d}`:`${fn}:${d}`}fetchEventData(){const t=s.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const y=localStorage.getItem(o);y&&(this.eventData=JSON.parse(y));const v=localStorage.getItem(d);v&&(this.anonId=v)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.anonId;if(t&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,d,y){if(!s.e.EVENTS_URL)return;const v=Pt(s.e.EVENTS_URL);v.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},S=o?Object.assign(T,o):T,R={url:Si(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=s.p(R,(O=>{this.pendingRequest=null,d(O),this.saveEventData(),this.processRequests(y)}))}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const et=new class extends Wn{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some((o=>s.h(o)||s.j(o)))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=jn(s.e.ACCESS_TOKEN),o=t?t.u:s.e.ACCESS_TOKEN;let d=o!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),T=new Date(y),S=(y-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||v.getDate()!==T.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:_t,"enabled.telemetry":!1,userId:this.anonId},(v=>{v||(this.eventData.lastSuccess=y,this.eventData.tokenU=o)}),f):this.processRequests()}},Kt=et.postTurnstileEvent.bind(et),Oi=new class extends Wn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,o,d){this.skuToken=t,this.errorCb=d,s.e.EVENTS_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Ue)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:_t,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),f))}remove(){this.errorCb=null}},Hi=Oi.postMapLoadEvent.bind(Oi),bn=new class extends Wn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=s.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:o,style:d,importedStyles:y}=t;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(o),T={mapInstanceId:v,eventId:this.getEventId(v),style:d};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),f)}},Qt=bn.postStyleLoadEvent.bind(bn),Li=new class extends Wn{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),d=(function(y){const v=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),S=(function(H){const $={};if(H){for(const W in H)if(W!=="other")for(const ie of H[W]){const X=`${W}ResolveRangeMin`,re=`${W}ResolveRangeMax`,ue=`${W}RequestCount`,de=`${W}RequestCachedCount`;$[X]=Math.min($[X]||1/0,ie.startTime),$[re]=Math.max($[re]||-1/0,ie.responseEnd);const be=ye=>{$[ye]===void 0&&($[ye]=0),++$[ye]};ie.transferSize!==void 0&&ie.transferSize===0&&be(de),be(ue)}}return $})((function(H,$){const W={};if(H)for(const ie of H){const X=$(ie);W[X]===void 0&&(W[X]=[]),W[X].push(ie)}return W})(v,ce)),R=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=O?O.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},F=(H,$,W)=>{W!=null&&H.push({name:$,value:W.toString()})};for(const H in S)F(U.counters,H,S[H]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(F(U.counters,"interactionRangeMin",y.interactionRange[0]),F(U.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const H of Object.keys(q)){const $=q[H],W=T.find((ie=>ie.name===$));W&&F(U.counters,$,W.startTime)}return F(U.counters,"visibilityHidden",y.visibilityHidden),F(U.attributes,"style",(function(H){if(H)for(const $ of H){const W=$.name.split("?")[0];if(s.i(W)){const ie=W.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}})(v)),F(U.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),F(U.attributes,"fogEnabled",y.fogEnabled?"true":"false"),F(U.attributes,"projection",y.projection),F(U.attributes,"zoom",y.zoom),F(U.metadata,"devicePixelRatio",R),F(U.metadata,"connectionEffectiveType",k),F(U.metadata,"navigatorUserAgent",navigator.userAgent),F(U.metadata,"screenWidth",window.screen.width),F(U.metadata,"screenHeight",window.screen.height),F(U.metadata,"windowWidth",window.innerWidth),F(U.metadata,"windowHeight",window.innerHeight),F(U.metadata,"mapWidth",y.width/R),F(U.metadata,"mapHeight",y.height/R),F(U.metadata,"webglRenderer",y.renderer),F(U.metadata,"webglVendor",y.vendor),F(U.metadata,"sdkVersion",G),F(U.metadata,"sdkIdentifier","mapbox-gl-js"),U})(o);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(t,d,(()=>{}),f)}},cn=Li.postPerformanceEvent.bind(Li),Nn=new class extends Wn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,o,d){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const y=Pt(s.e.API_URL+s.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${d||s.e.ACCESS_TOKEN||""}`);const v={url:Si(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(v,(T=>{this.pendingRequest=null,o(T),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(f,t,o,d){this.skuToken=t,this.errorCb=d,s.e.SESSION_PATH&&s.e.API_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Ue)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),f)}remove(){this.errorCb=null}},ur=Nn.getSessionAPI.bind(Nn),Qo=new Set;function Jo(f,t){t?Qo.add(f):Qo.delete(f)}class Ya{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ys(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class Dr extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const d of o.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,o,y);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,d){this._validate(t,d)&&this.images.get(o).set(t.toString(),d)}_validate(t,o){let d=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,o){if(!t)return!0;let d=0;for(const y of t){if(y[0]<d||y[1]<y[0]||o<y[1])return!1;d=y[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,d){const y=this.images.get(o).get(t.toString());d.version=y.version+1,this.images.get(o).set(t.toString(),d),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const d=this.images.get(o),y=d.get(t.toString());d.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((o=>s.I.from(o)))}getImages(t,o,d){const y=[],v=[],T=this.imageProviders.get(o);for(const k of t){if(!k.iconsetId){y.push(k);continue}const U=T.get(k.iconsetId);U&&(this.getImage(k,o)?v.push(k):U.addPendingRequest(k))}if(y.length===0)return void this._notify(v,o,d);let S=!0;const R=!!this.loaded.get(o),O=this.images.get(o);if(!R)for(const k of y)O.has(k.toString())||(S=!1);R||S?this._notify(y,o,d):this.requestors.push({ids:y,scope:o,callback:d})}rasterizeImages(t,o){const d=new Map,{tasks:y,scope:v}=t;for(const[T,S]of y.entries()){const R=this.getImage(S.id,v);R&&d.set(T,{image:R,imageVariant:S})}this._rasterizeImages(v,d,o)}_rasterizeImages(t,o,d){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},d);else{const y=new Map;for(const[v,{image:T,imageVariant:S}]of o.entries())y.set(v,this.imageRasterizer.rasterize(S,T,t,0));d(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,d){const y=this.images.get(o),v=new Map;for(const T of t){if(!y.get(T.toString())){if(T.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:T.name}))}const S=y.get(T.toString());if(!S){s.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(R,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),v.set(s.I.toString(T),R)}d(null,v)}getPixelSize(t){const{width:o,height:d}=this.atlasImage.get(t);return{width:o,height:d}}getPattern(t,o,d){const y=t.toString(),v=this.patterns.get(o),T=v.get(y),S=this.getImage(t,o);if(!S)return null;if(T){if(T.position.version===S.version)return T.position;T.position.version=S.version}else{if(S.usvg&&!S.data){const R=this.getPatternInFlightId(y,o);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const O=new s.A(t).scaleSelf(s.o.devicePixelRatio),k=new Map([[O.toString(),{image:S,imageVariant:O}]]);return this._rasterizeImages(o,k,((U,F)=>this.storePatternImage(O,o,S,d,F))),null}this.storePattern(t,o,S)}return this._updatePatternAtlas(o,d),v.get(y).position}getPatternInFlightId(t,o){return s.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,d,y,v){const T=t.toString(),S=v?v.get(T):void 0;S&&(d.data=S,this.storePattern(t.id,o,d),this._updatePatternAtlas(o,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,d){const y={w:d.data.width+2*s.C,h:d.data.height+2*s.C,x:0,y:0},v=new s.F(y,d,s.C);this.patterns.get(o).set(t.toString(),{bin:y,position:v})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){const d=t.gl;let y=this.atlasTexture.get(o);y?this.dirty&&(y.update(this.atlasImage.get(o)),this.dirty=!1):(y=new s.T(t,this.atlasImage.get(o),d.RGBA8),this.atlasTexture.set(o,y)),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const d=this.patterns.get(t),y=Array.from(d.values()).map((({bin:O})=>O)),{w:v,h:T}=s.G(y),S=this.atlasImage.get(t);S.resize({width:v||1,height:T||1});const R=this.images.get(t);for(const[O,{bin:k,position:U}]of d.entries()){let F=U.padding;const H=k.x+F,$=k.y+F,W=R.get(O).data,ie=W.width,X=W.height;F=F>1?F-1:F,s.q.copy(W,S,{x:0,y:0},{x:H,y:$},{width:ie,height:X},o),s.q.copy(W,S,{x:0,y:X-F},{x:H,y:$-F},{width:ie,height:F},o),s.q.copy(W,S,{x:0,y:0},{x:H,y:$+X},{width:ie,height:F},o),s.q.copy(W,S,{x:ie-F,y:0},{x:H-F,y:$},{width:F,height:X},o),s.q.copy(W,S,{x:0,y:0},{x:H+ie,y:$},{width:F,height:X},o),s.q.copy(W,S,{x:ie-F,y:X-F},{x:H-F,y:$-F},{width:F,height:F},o),s.q.copy(W,S,{x:0,y:X-F},{x:H+ie,y:$-F},{width:F,height:F},o),s.q.copy(W,S,{x:0,y:0},{x:H+ie,y:$+X},{width:F,height:F},o),s.q.copy(W,S,{x:ie-F,y:0},{x:H-F,y:$+X},{width:F,height:F},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const d=this.images.get(o);for(const y of t){if(this.callbackDispatchedThisFrame.get(o).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(y.toString());const v=d.get(y.toString());ys(v)&&this.updateImage(y,o,v)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Il(f){const t=f.value,o=f.valueSpec,d=f.style,y=f.styleSpec,v=f.key,T=f.arrayElementValidator||hr;if(!Array.isArray(t))return[new s.V(v,t,`array expected, ${s.K(t)} found`)];if(o.length&&t.length!==o.length)return[new s.V(v,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new s.V(v,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let S={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};y.$version<7&&(S.function=o.function),s.H(o.value)&&(S=o.value);let R=[];for(let O=0;O<t.length;O++)R=R.concat(T({array:t,arrayIndex:O,value:t[O],valueSpec:S,style:d,styleSpec:y,key:`${v}[${O}]`},!0));return R}function Ka(f){const t=f.key,o=f.value,d=f.valueSpec;if(!s.L(o))return[new s.V(t,o,`number expected, ${s.K(o)} found`)];if(o!=o)return[new s.V(t,o,"number expected, NaN found")];if("minimum"in d){let y=d.minimum;if(Array.isArray(d.minimum)&&(y=d.minimum[f.arrayIndex]),o<y)return[new s.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(Array.isArray(d.maximum)&&(y=d.maximum[f.arrayIndex]),o>y)return[new s.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Uc(f){const t=f.key,o=f.value;if(!s.H(o))return[new s.V(t,o,`object expected, ${s.K(o)} found`)];const d=f.valueSpec,y=s.J(o.type);let v,T,S,R={};const O=y!=="categorical"&&o.property===void 0,k=!O,U=(function(W){const ie=W.stops;return Array.isArray(ie)&&Array.isArray(ie[0])&&s.H(ie[0][0])})(o),F=Ts({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(W){if(y==="identity")return[new s.V(W.key,W.value,'identity function may not have a "stops" property')];let ie=[];const X=W.value;return ie=ie.concat(Il({key:W.key,value:X,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:H})),Array.isArray(X)&&X.length===0&&ie.push(new s.V(W.key,X,"array must have at least one stop")),ie},default:function(W){return hr({key:W.key,value:W.value,valueSpec:d,style:W.style,styleSpec:W.styleSpec})}}});return y==="identity"&&O&&F.push(new s.V(f.key,f.value,'missing required property "property"')),y==="identity"||o.stops||F.push(new s.V(f.key,f.value,'missing required property "stops"')),y==="exponential"&&d.expression&&!s.M(d)&&F.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(k&&!s.N(d)?F.push(new s.V(f.key,f.value,"property functions not supported")):O&&!s.O(d)&&F.push(new s.V(f.key,f.value,"zoom functions not supported"))),y!=="categorical"&&!U||o.property!==void 0||F.push(new s.V(f.key,f.value,'"property" property is required')),F;function H(W){let ie=[];const X=W.value,re=W.key;if(!Array.isArray(X))return[new s.V(re,X,`array expected, ${s.K(X)} found`)];if(X.length!==2)return[new s.V(re,X,`array length 2 expected, length ${X.length} found`)];if(U){if(!s.H(X[0]))return[new s.V(re,X,`object expected, ${s.K(X[0])} found`)];const ue=X[0];if(ue.zoom===void 0)return[new s.V(re,X,"object stop key must have zoom")];if(ue.value===void 0)return[new s.V(re,X,"object stop key must have value")];const de=s.J(ue.zoom);if(typeof de!="number")return[new s.V(re,ue.zoom,"stop zoom values must be numbers")];if(S&&S>de)return[new s.V(re,ue.zoom,"stop zoom values must appear in ascending order")];de!==S&&(S=de,T=void 0,R={}),ie=ie.concat(Ts({key:`${re}[0]`,value:X[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Ka,value:$}}))}else ie=ie.concat($({key:`${re}[0]`,value:X[0],style:W.style,styleSpec:W.styleSpec},X));return s.Q(s.S(X[1]))?ie.concat([new s.V(`${re}[1]`,X[1],"expressions are not allowed in function stops.")]):ie.concat(hr({key:`${re}[1]`,value:X[1],valueSpec:d,style:W.style,styleSpec:W.styleSpec}))}function $(W,ie){const X=s.K(W.value),re=s.J(W.value),ue=W.value!==null?W.value:ie;if(v){if(X!==v)return[new s.V(W.key,ue,`${X} stop domain type must match previous stop domain type ${v}`)]}else v=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new s.V(W.key,ue,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&y!=="categorical"){let de=`number expected, ${X} found`;return s.N(d)&&y===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(W.key,ue,de)]}return y!=="categorical"||X!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?y!=="categorical"&&X==="number"&&typeof re=="number"&&typeof T=="number"&&T!==void 0&&re<T?[new s.V(W.key,ue,"stop domain values must appear in ascending order")]:(T=re,y==="categorical"&&re in R?[new s.V(W.key,ue,"stop domain values must be unique")]:(R[re]=!0,[])):[new s.V(W.key,ue,`integer expected, found ${String(re)}`)]}}function Tr(f){const t=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(t.result==="error")return t.value.map((d=>new s.V(`${f.key}${d.key}`,f.value,d.message)));const o=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!o.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(o))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return ls(o,f);if(f.expressionContext==="appearance")return Fs(o,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(o,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(o))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ls(f,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.delete(y);if(o.size===0)return[];const d=[];return f instanceof s._&&o.has(f.name)?[new s.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild((y=>{d.push(...ls(y,t))})),d)}function Fs(f,t){const o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.add(y);if(o.size===0)return[];const d=[];return f instanceof s._&&!o.has(f.name)?[new s.V(t.key,t.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild((y=>{d.push(...Fs(y,t))})),d)}function Cl(f){const t=f.key,o=f.value,d=f.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(s.J(o))===-1&&y.push(new s.V(t,o,`expected one of [${d.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(d.values).indexOf(s.J(o))===-1&&y.push(new s.V(t,o,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(o)} found`)),y}function Qa(f){return s.a2(s.S(f.value))?Tr(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Bs(f)}function Bs(f){const t=f.value,o=f.key;if(!Array.isArray(t))return[new s.V(o,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(o,t,"filter array must have at least 1 element")];const d=f.styleSpec;let y=Cl({key:`${o}[0]`,value:t[0],valueSpec:d.filter_operator});switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&y.push(new s.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new s.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(s.a0(t[1])||y.push(new s.V(`${o}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let v=2;v<t.length;v++)s.J(t[1])==="$type"?y=y.concat(Cl({key:`${o}[${v}]`,value:t[v],valueSpec:d.geometry_type})):s.a0(t[v])||s.L(t[v])||s.$(t[v])||y.push(new s.V(`${o}[${v}]`,t[v],`string, number, or boolean expected, ${s.K(t[v])} found.`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Bs({key:`${o}[${v}]`,value:t[v],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new s.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||y.push(new s.V(`${o}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return y}function Ra(f,t){const o=f.key,d=f.style,y=f.layer,v=f.styleSpec,T=f.value,S=f.objectKey,R=v[`${t}_${f.layerType}`];if(!R)return[];const O=S.match(/^(.*)-use-theme$/);if(O&&R[O[1]])return s.Q(T)?[].concat(hr({key:f.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:S})):hr({key:o,value:T,valueSpec:{type:"string"},style:d,styleSpec:v});const k=S.match(/^(.*)-transition$/);if(t==="paint"&&k&&R[k[1]]&&R[k[1]].transition)return hr({key:o,value:T,valueSpec:v.transition,style:d,styleSpec:v});const U=f.valueSpec||R[S];if(!U)return[new s.a3(o,T,`unknown property "${S}"`)];let F;if(s.a0(T)&&s.N(U)&&!U.tokens&&(F=/^{([^}]+)}$/.exec(T))){const $=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new s.V(o,T,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const H=[];if(f.layerType==="symbol")S!=="text-field"||!d||d.glyphs||d.imports||H.push(new s.V(o,T,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&s.a4(s.S(T))&&s.J(T.type)==="identity"&&H.push(new s.V(o,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&s.N(U)&&(s.a5(U)||s.O(U))){const $=s.W(s.S(T),U),W=$.value.expression||$.value._styleExpression.expression;W&&!s.X(W,["measure-light"])&&(S==="model-emissive-strength"&&s.Y(W)&&s.Z(W)||H.push(new s.V(o,T,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(hr({key:f.key,value:T,valueSpec:U,style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:S}))}function no(f){return Ra(f,"paint")}function xo(f){return Ra(f,"layout")}function Ja(f){let t=[];const o=f.value,d=f.key,y=f.style,v=f.styleSpec;if(!s.H(o))return[new s.V(d,o,"object expected")];o.type||o.ref||t.push(new s.V(d,o,'either "type" or "ref" is required'));let T=s.J(o.type);const S=s.J(o.ref);if(o.id){const R=s.J(o.id);for(let O=0;O<f.arrayIndex;O++){const k=y.layers[O];s.J(k.id)===R&&t.push(new s.V(d,o.id,`duplicate layer id "${R}", previously used at line ${k.id.__line__}`))}}if("ref"in o){let R;["type","source","source-layer","filter","layout"].forEach((O=>{O in o&&t.push(new s.V(d,o[O],`"${O}" is prohibited for ref layers`))})),y.layers.forEach((O=>{s.J(O.id)===S&&(R=O)})),R?R.ref?t.push(new s.V(d,o.ref,"ref cannot reference another ref layer")):T=s.J(R.type):typeof S=="string"&&t.push(new s.V(d,o.ref,`ref layer "${S}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(o.source)if(s.a0(o.source)){const R=y.sources&&y.sources[o.source],O=R&&s.J(R.type);R?O==="vector"&&T==="raster"?t.push(new s.V(d,o.source,`layer "${o.id}" requires a raster source`)):O==="raster"&&T!=="raster"?t.push(new s.V(d,o.source,`layer "${o.id}" requires a vector source`)):O!=="vector"||o["source-layer"]?O==="raster-dem"&&T!=="hillshade"?t.push(new s.V(d,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&O==="geojson"&&!R.lineMetrics?t.push(new s.V(d,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&O!=="raster-array"&&t.push(new s.V(d,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new s.V(d,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(d,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new s.V(d,o.source,`source "${o.source}" not found`))}else t.push(new s.V(`${d}.source`,o.source,'"source" must be a string'));else t.push(new s.V(d,o,'missing required property "source"'));return t=t.concat(Ts({key:d,value:o,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hr({key:`${d}.type`,value:o.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:o,objectKey:"type"}),filter:R=>Qa(Object.assign({layerType:T},R)),layout:R=>Ts({layer:o,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":O=>xo(Object.assign({layerType:T},O))}}),paint:R=>Ts({layer:o,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":O=>no(Object.assign({layerType:T,layer:o},O))}}),appearances(R){const O=Il({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:F=>(function(H){const{key:$,layer:W,layerType:ie}=H,X=s.J(H.value),re=s.J(X.name),ue=s.J(X.condition),de=Ts({key:$,value:X,valueSpec:H.styleSpec.appearance,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{condition:be=>(function(ye){const ve=[];return ve.push(...Tr({key:ye.key,value:ye.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),ve})(Object.assign({layer:W,layerType:ie},be)),properties:be=>(function(ye){const ve=[],{styleSpec:ge,layer:_e,layerType:xe}=ye,Ze=ge[`paint_${xe}`],Oe=ge[`layout_${xe}`],ot=ye.object[ye.objectKey];for(const qe in ot){const nt=qe in Ze?"paint":qe in Oe?"layout":void 0;if(!nt){ve.push(new s.V(ye.key,qe,`unknown property "${qe}" for layer type "${xe}"`));continue}const zt=Object.assign({},ye,{key:`${ye.key}.${qe}`,object:ot,objectKey:qe,layer:_e,layerType:xe,value:ot[qe],valueSpec:nt==="paint"?Ze[qe]:Oe[qe]});ve.push(...Ra(zt,nt))}return ve})(Object.assign({layer:W,layerType:ie},be))}});return re==="hidden"||ue||de.push(new s.V(H.key,"name",'Appearance with name different than "hidden" must have a condition')),de})(Object.assign({layerType:T,layer:o},F))}),k=Array.isArray(R.value)?R.value:[],U=new Set;return k.forEach(((F,H)=>{const $=s.J(F.name);if($)if(U.has($)){const W=s.J(o.id);O.push(new s.V(R.key,$,`Duplicated appearance name "${$}" for layer "${W}"`))}else U.add($)})),O}}})),t}function Rl({key:f,value:t}){return s.a0(t)?[]:[new s.V(f,t,`string expected, ${s.K(t)} found`)]}const jc={promoteId:function f({key:t,value:o}){if(s.a0(o))return Rl({key:t,value:o});if(Array.isArray(o)){const y=[],v=s.S(o),T=s.U(v);return T.result==="error"&&T.value.forEach((S=>{y.push(new s.V(`${t}${S.key}`,null,`${S.message}`))})),s.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!s.H(o))return[new s.V(t,o,`string, expression or object expected, "${s.K(o)}" found`)];const d=[];for(const y in o)d.push(...f({key:`${t}.${y}`,value:o[y]}));return d}};function Ms(f){const t=f.value,o=f.key,d=f.styleSpec,y=f.style;if(!s.H(t))return[new s.V(o,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(o,t,'"type" is required')];const v=s.J(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&("url"in t||"tiles"in t||T.push(new s.a3(o,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Ts({key:o,value:t,valueSpec:d[`source_${v.replace("-","_")}`],style:f.style,styleSpec:d,objectElementValidators:jc})),T;case"geojson":if(T=Ts({key:o,value:t,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:jc}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${o}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const S in t.clusterProperties){const R=t.clusterProperties[S];if(!Array.isArray(R))return[new s.V(`${o}.clusterProperties.${S}`,R,"array expected")];const[O,k]=R,U=typeof O=="string"?[O,["accumulated"],["get",S]]:O;T.push(...Tr({key:`${o}.${S}.map`,value:k,expressionContext:"cluster-map"})),T.push(...Tr({key:`${o}.${S}.reduce`,value:U,expressionContext:"cluster-reduce"}))}}return T;case"video":return Ts({key:o,value:t,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return Ts({key:o,value:t,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new s.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cl({key:`${o}.type`,value:t.type,valueSpec:{values:ga(d)}})}}function ga(f){return f.source.reduce(((t,o)=>{const d=f[o];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t}),[])}function ea(f){const t=f.value,o=f.styleSpec,d=o.light,y=f.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let v=[];for(const T in t){const S=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);v=v.concat(R&&d[R[1]]?hr({key:T,value:t[T],valueSpec:{type:"string"},style:y,styleSpec:o}):S&&d[S[1]]&&d[S[1]].transition?hr({key:T,value:t[T],valueSpec:o.transition,style:y,styleSpec:o}):d[T]?hr({key:T,value:t[T],valueSpec:d[T],style:y,styleSpec:o}):[new s.V(T,t[T],`unknown property "${T}"`)])}return v}function vs(f){const t=f.value;if(!t)return[];const o=f.key;if(!s.H(t))return[new s.V(o,t,`object expected, ${s.K(t)} found`)];let d=[];const y=f.styleSpec,v=y["light-3d"],T=f.style,S=f.style.lights;for(const k of["type","id"])if(!(k in t))return d=d.concat([new s.V(o,t,`missing property "${k}"`)]),d;if(!s.a0(t.type))return d=d.concat([new s.V(`${o}.type`,t.type,"string expected")]),d;if(S)for(let k=0;k<f.arrayIndex;k++){const U=s.J(t.type),F=S[k];s.J(F.type)===U&&d.push(new s.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in y))return d=d.concat([new s.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),d;const O=y[R];for(const k in t)if(k==="properties"){const U=t[k];if(!s.H(U))return d=d.concat([new s.V("properties",U,`object expected, ${s.K(U)} found`)]),d;for(const F in U){const H=F.match(/^(.*)-transition$/),$=F.match(/^(.*)-use-theme$/);d=d.concat($&&O[$[1]]?hr({key:k,value:U[F],valueSpec:{type:"string"},style:T,styleSpec:y}):H&&O[H[1]]&&O[H[1]].transition?hr({key:k,value:t[k],valueSpec:y.transition,style:T,styleSpec:y}):O[F]?hr({key:F,value:U[F],valueSpec:O[F],style:T,styleSpec:y}):[new s.a3(f.key,U[F],`unknown property "${F}"`)])}}else d=d.concat(v[k]?hr({key:k,value:t[k],valueSpec:v[k],style:T,styleSpec:y}):[new s.a3(k,t[k],`unknown property "${k}"`)]);return d}function Vs(f){const t=f.value,o=f.key,d=f.style,y=f.styleSpec,v=y.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let T=[];for(const S in t){const R=S.match(/^(.*)-transition$/),O=S.match(/^(.*)-use-theme$/);T=T.concat(O&&v[O[1]]?hr({key:S,value:t[S],valueSpec:{type:"string"},style:d,styleSpec:y}):R&&v[R[1]]&&v[R[1]].transition?hr({key:S,value:t[S],valueSpec:y.transition,style:d,styleSpec:y}):v[S]?hr({key:S,value:t[S],valueSpec:v[S],style:d,styleSpec:y}):[new s.a3(S,t[S],`unknown property "${S}"`)])}if(t.source)if(s.a0(t.source)){const S=d.sources&&d.sources[t.source],R=S&&s.J(S.type);S?R!=="raster-dem"&&T.push(new s.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):T.push(new s.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else T.push(new s.V(`${o}.source`,t.source,"source must be a string"));else T.push(new s.V(o,t,'terrain is missing required property "source"'));return T}function Yr(f){const t=f.value,o=f.style,d=f.styleSpec,y=d.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let v=[];for(const T in t){const S=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);v=v.concat(R&&y[R[1]]?hr({key:T,value:t[T],valueSpec:{type:"string"},style:o,styleSpec:d}):S&&y[S[1]]&&y[S[1]].transition?hr({key:T,value:t[T],valueSpec:d.transition,style:o,styleSpec:d}):y[T]?hr({key:T,value:t[T],valueSpec:y[T],style:o,styleSpec:d}):[new s.a3(T,t[T],`unknown property "${T}"`)])}return v}const ac={"*":()=>[],array:Il,boolean:function(f){const t=f.value,o=f.key;return s.$(t)?[]:[new s.V(o,t,`boolean expected, ${s.K(t)} found`)]},number:Ka,color:function({key:f,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(f,t,`color expected, "${t}" found`)]:[]:[new s.V(f,t,`color expected, ${s.K(t)} found`)]},enum:Cl,filter:Qa,function:Uc,layer:Ja,object:Ts,source:Ms,model:s.a7,light:ea,"light-3d":vs,terrain:Vs,fog:Yr,string:Rl,formatted:function(f){return Rl(f).length===0?[]:Tr(f)},resolvedImage:function(f){return Rl(f).length===0?[]:Tr(f)},projection:function(f){const t=f.value,o=f.styleSpec,d=o.projection,y=f.style;if(s.H(t)){let v=[];for(const T in t)v=v.concat(hr({key:T,value:t[T],valueSpec:d[T],style:y,styleSpec:o}));return v}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(f){const t=f.key,{value:o,styleSpec:d}=f;if(!s.H(o))return[new s.V(t,o,"import must be an object")];const{data:y,...v}=o;Object.defineProperty(v,"__line__",{value:o.__line__,enumerable:!1});let T=Ts(Object.assign({},f,{value:v,valueSpec:d.import}));return s.J(v.id)===""&&T.push(new s.V(`${f.key}.id`,v,"import id can't be an empty string")),y&&(T=T.concat(Ma(y,d,{key:`${f.key}.data`}))),T},iconset:function(f){const t=f.value,o=f.key,d=f.styleSpec,y=f.style;if(!s.H(t))return[new s.V(o,t,"object expected")];if(!t.type)return[new s.V(o,t,'"type" is required')];const v=s.J(t.type);let T=[];if(T=T.concat(Ts({key:o,value:t,valueSpec:d[`iconset_${v}`],style:y,styleSpec:d})),(function(S,R){return!(S!=="source"||!R.source)})(v,t)){const S=y.sources&&y.sources[t.source],R=S&&s.J(S.type);S?R!=="raster-array"&&T.push(new s.V(o,t.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):T.push(new s.V(o,t.source,`source "${t.source}" not found`))}return T}};function hr(f,t=!1){const o=f.value,d=f.valueSpec,y=f.styleSpec;if(d.expression){if(s.a4(s.J(o)))return Uc(f);if(s.Q(s.S(o)))return Tr(f)}if(d.type&&ac[d.type]){const v=ac[d.type](f);return t===!0&&v.length>0&&Array.isArray(f.value)?Tr(f):v}return Ts(Object.assign({},f,{valueSpec:d.type?y[d.type]:d}))}function Ts(f){const t=f.key,o=f.value,d=f.valueSpec||{},y=f.objectElementValidators||{},v=f.style,T=f.styleSpec;if(!s.H(o))return[new s.V(t,o,`object expected, ${s.K(o)} found`)];let S=[];for(const R in o){const O=R.split(".")[0];let k;y[O]?k=y[O]:d[O]?k=hr:y["*"]?k=y["*"]:d["*"]&&(k=hr),k?S=S.concat(k({key:(t&&`${t}.`)+R,value:o[R],valueSpec:d[O]||d["*"],style:v,styleSpec:T,object:o,objectKey:R},o)):S.push(new s.a3(t,o[R],`unknown property "${R}"`))}for(const R in d)y[R]||d[R].required&&d[R].default===void 0&&o[R]===void 0&&S.push(new s.V(t,o,`missing required property "${R}"`));return S}function _a({key:f,value:t}){const o=Rl({key:f,value:t});if(o.length)return o;const d=t;return d.indexOf("{fontstack}")===-1&&o.push(new s.V(f,t,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&o.push(new s.V(f,t,'"glyphs" url must include a "{range}" token')),o}function Ma(f,t=s.a6,o={}){return Ts({key:o.key||"",value:f,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:f,objectElementValidators:{glyphs:_a}})}function Hr(f,t=s.a6){return Ae(Ma(f,t))}const ya=f=>Ae(Ms(f)),va=f=>Ae(ea(f)),xa=f=>Ae(vs(f)),Ct=f=>Ae(Vs(f)),el=f=>Ae(Yr(f)),tl=f=>Ae((function(t){const o=t.value,d=t.style,y=t.styleSpec,v=y.snow;if(o===void 0)return[];if(!s.H(o))return[new s.V("snow",o,`object expected, ${s.K(o)} found`)];let T=[];for(const S in o){const R=S.match(/^(.*)-transition$/);T=T.concat(R&&v[R[1]]&&v[R[1]].transition?hr({key:S,value:o[S],valueSpec:y.transition,style:d,styleSpec:y}):v[S]?hr({key:S,value:o[S],valueSpec:v[S],style:d,styleSpec:y}):[new s.a3(S,o[S],`unknown property "${S}"`)])}return T})(f)),il=f=>Ae((function(t){const o=t.value,d=t.style,y=t.styleSpec,v=y.rain;if(o===void 0)return[];if(!s.H(o))return[new s.V("rain",o,`object expected, ${s.K(o)} found`)];let T=[];for(const S in o){const R=S.match(/^(.*)-transition$/);T=T.concat(R&&v[R[1]]&&v[R[1]].transition?hr({key:S,value:o[S],valueSpec:y.transition,style:d,styleSpec:y}):v[S]?hr({key:S,value:o[S],valueSpec:v[S],style:d,styleSpec:y}):[new s.a3(S,o[S],`unknown property "${S}"`)])}return T})(f)),Fe=f=>Ae(Ja(f)),J=f=>Ae(Qa(f)),se=f=>Ae(no(f)),me=f=>Ae(xo(f)),Re=f=>Ae(s.a7(f));function Ae(f){return f.slice().sort(((t,o)=>t.line&&o.line?t.line-o.line:0))}function Ie(f,t){let o=!1;if(t&&t.length)for(const d of t)d instanceof s.a3?s.w(d.message):(f.fire(new s.y(new Error(d.message))),o=!0);return o}let Ye;class Le extends s.E{constructor(t,o="flat"){super(),this._transitionable=new s.a8(Ye||(Ye=new s.a9({anchor:new s.aa(s.a6.light.anchor),position:new s.ab(s.a6.light.position),color:new s.aa(s.a6.light.color),intensity:new s.aa(s.a6.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,d={}){this._validate(va,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&Ie(this,t.call(Hr,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Xe=class extends s.E{constructor(f,t,o,d,y){super(),this.scope=o,this._transitionable=new s.a8(new s.a9({source:new s.aa(s.a6.terrain.source),exaggeration:new s.aa(s.a6.terrain.exaggeration)}),o,d),this._transitionable.setTransitionOrValue(f,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let o=-1,d=-1,y=1;for(const v of t.zoomStops)y=t.evaluate(new s.ac(v,{worldview:this.worldview})),y>.01?(o=v,d=-1):d=v;return y<.01&&o>0&&d>o?[o,d]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const At=45,gt=65,di=.05;function Mi(f,t,o,d){const y=s.ah(At,gt,o),[v,T]=Bi(f,d);let S=1-Math.min(1,Math.exp((t-v)/(T-v)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*y*f.alpha}function Bi(f,t){const o=.5/Math.tan(.5*t);return[f.range[0]+o,f.range[1]+o]}function un(f,t,o,d,y){const v=s.af([],[t,o,d],y.mercatorFogMatrix);return Mi(f,s.ag(v),y.pitch,y._fov)}function Wi(f,t,o,d,y,v,T){const S=[[o,d,0],[y,d,0],[y,v,0],[o,v,0]];let R=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const k of S){const U=s.af([],k,t),F=s.ag(U);R=Math.min(R,F),O=Math.max(O,F)}return[Mi(f,R,T.pitch,T._fov),Mi(f,O,T.pitch,T._fov)]}class hn extends s.E{constructor(t,o,d,y){super();const v=new s.a9({range:new s.aa(s.a6.fog.range),color:new s.aa(s.a6.fog.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(s.a6.fog["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(s.a6.fog["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(s.a6.fog["horizon-blend"]),"star-intensity":new s.aa(s.a6.fog["star-intensity"]),"vertical-range":new s.aa(s.a6.fog["vertical-range"])});this._transitionable=new s.a8(v,d,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.ai(v),this.scope=d}get state(){const t=this._transform,o=t.projection.name==="globe",d=s.aj(t.zoom),y=this.properties.get("range"),v=[.5,3];return{range:o?[s.ak(v[0],y[0],d),s.ak(v[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,d={}){if(this._validate(el,t,d))return;const y=Object.assign({},t);for(const v of Object.keys(s.a6.fog))y[v]===void 0&&(y[v]=s.a6.fog[v].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(At,gt,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?(function(d,y,v){const T=s.ae.fromLngLat(y),S=v.elevation?v.elevation.getAtPointOrZero(T):0;return un(d,T.x,T.y,S,v)})(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Wi(this.state,o,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,o,d,y,v){return this._transform.projection.supportsFog?Wi(this.state,t,o,d,y,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Bi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const d of o){const y=t.points[d];let v;if(y[2]>=0)v=y;else{const T=t.points[d-4];v=s.am(T,y,T[2]/(T[2]-y[2]))}if(un(this.state,v[0],v[1],0,this._transform)>=di)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&Ie(this,t.call(Hr,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Ln,Ki,Zn,Cr,Gn=class extends s.E{constructor(f,t,o,d){super();const y=Ln||(Ln=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(y,o,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=o}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),d=s.an(o[0]),y=-Math.max(s.an(o[1]),.01),v=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,t,o={}){if(this._validate(tl,f,o))return;const d=Object.assign({},f);for(const y of Object.keys(s.a6.snow))d[y]===void 0&&(d[y]=s.a6.snow[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,o){return(!o||o.validate!==!1)&&Ie(this,f.call(Hr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Vn=class extends s.E{constructor(f,t,o,d){super();const y=Ki||(Ki=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(y,o,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=o}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),d=s.an(o[0]),y=-Math.max(s.an(o[1]),.01),v=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,t,o={}){if(this._validate(il,f,o))return;const d=Object.assign({},f);for(const y of Object.keys(s.a6.rain))d[y]===void 0&&(d[y]=s.a6.rain[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,o){return(!o||o.validate!==!1)&&Ie(this,f.call(Hr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class Rn extends s.E{constructor(t,o,d,y){super(),this.scope=d,this._options=t,this.properties=new s.ai(o),this._transitionable=new s.a8(o,d,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class rr{constructor(t,o,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,o){let d,y;if(t instanceof s.P||typeof t[0]=="number"){const v=s.P.convert(t);d=[v],y=o.isPointAboveHorizon(v)}else{const v=s.P.convert(t[0]),T=s.P.convert(t[1]),S=v.add(T)._div(2);d=[v,T],y=s.aq(v,T).every((R=>o.isPointAboveHorizon(R)))&&o.isPointAboveHorizon(S)}return new rr(d,y,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(o,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(y[3]=this.cameraPoint)),s.ar(y,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(o,d,t),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>d.y))+((v.x>o.x)+(v.x>d.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(t,o,d,y=0){const v=t.queryPadding/o._pixelsPerMercatorPixel+1,T=d?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let S=t.tileID.wrap+(T.unwrapped?y:0);const R=T.polygon.map((ie=>s.as(t.tileTransform,ie,S)));if(!s.at(R,0,0,s.al,s.al))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const O=this.screenGeometryMercator.polygon.map((ie=>s.au(t.tileTransform,ie,S))),k=O.map((ie=>new s.P(ie[0],ie[1]))),U=o.getFreeCameraOptions().position||new s.ae(0,0,0),F=s.au(t.tileTransform,U,S),H=O.map((ie=>{const X=s.av(ie,ie,F);return s.aw(X,X),new s.ax(F,X)})),$=s.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:H,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(W=s.az(R),W.min.x=s.aA(W.min.x,0,s.al),W.min.y=s.aA(W.min.y,0,s.al),W.max.x=s.aA(W.max.x,0,s.al),W.max.y=s.aA(W.max.y,0,s.al),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:$};var W}_bufferedScreenMercator(t,o){const d=Es(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map((v=>o.pointCoordinate3D(v))),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(t,o){const d=Es(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map((v=>o.pointCoordinate3D(v))),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(t,o){const d=(function(v,T){const S=s.aB([],T.pixelMatrix,T.globeMatrix),R=[0,-s.aD,0,1],O=[0,s.aD,0,1],k=[0,0,0,1];s.aC(R,R,S),s.aC(O,O,S),s.aC(k,k,S);const U=new s.P(R[0]/R[3],R[1]/R[3]),F=new s.P(O[0]/O[3],O[1]/O[3]),H=s.aE(v,U)&&R[3]<k[3],$=s.aE(v,F)&&O[3]<k[3];if(!H&&!$)return null;const W=(function(ve,ge,_e){for(let xe=1;xe<ve.length;xe++){const Ze=Jn(ge.pointCoordinate3D(ve[xe-1]).x),Oe=Jn(ge.pointCoordinate3D(ve[xe]).x);if(_e<0){if(Ze<Oe)return{idx:xe,t:-Ze/(Oe-1-Ze)}}else if(Oe<Ze)return{idx:xe,t:(1-Ze)/(Oe+1-Ze)}}return null})(v,T,H?-1:1);if(!W)return null;const{idx:ie,t:X}=W;let re=ie>1?sr(v.slice(0,ie),T):[],ue=ie<v.length?sr(v.slice(ie),T):[];re=re.map((ve=>new s.P(Jn(ve.x),ve.y))),ue=ue.map((ve=>new s.P(Jn(ve.x),ve.y)));const de=[...re];de.length===0&&de.push(ue[ue.length-1]);const be=s.ak(de[de.length-1].y,(ue.length===0?re[0]:ue[0]).y,X);let ye;return ye=H?[new s.P(0,be),new s.P(0,0),new s.P(1,0),new s.P(1,be)]:[new s.P(1,be),new s.P(1,1),new s.P(0,1),new s.P(0,be)],de.push(...ye),ue.length===0?de.push(re[0]):de.push(...ue),{polygon:de.map((ve=>new s.ae(ve.x,ve.y))),unwrapped:!1}})(t,o);if(d)return d;const y=(function(v,T){let S=!1,R=-1/0,O=0;for(let U=0;U<v.length-1;U++)v[U].x>R&&(R=v[U].x,O=U);for(let U=0;U<v.length-1;U++){const F=(O+U)%(v.length-1),H=v[F],$=v[F+1];Math.abs(H.x-$.x)>.5&&(H.x<$.x?(H.x+=1,F===0&&(v[v.length-1].x+=1)):($.x+=1,F+1===v.length-1&&(v[0].x+=1)),S=!0)}const k=s.aF(T.center.lng);return S&&k<Math.abs(k-1)&&v.forEach((U=>{U.x-=1})),{polygon:v,unwrapped:S}})(sr(t,o).map((v=>new s.P(Jn(v.x),v.y))),o);return{polygon:y.polygon.map((v=>new s.ae(v.x,v.y))),unwrapped:y.unwrapped}}}function sr(f,t){return s.aG(f,(o=>{const d=t.pointCoordinate3D(o);o.x=d.x,o.y=d.y}),1/256)}function Jn(f){return f<0?1+f%1:f%1}function Es(f){return 100*f|0}function Ys(f,t,o,d,y){const v=function(S,R){if(S)return y(S);if(R){if(f.url&&R.tiles&&f.tiles&&delete f.tiles,R.variants){if(!Array.isArray(R.variants))return y(new Error("variants must be an array"));for(const k of R.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return y(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){R=Object.assign(R,k);break}}}const O=s.aH(Object.assign({},R,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,f.url),y(null,O)}},T=(function(S,R,O){if(!S)return null;if(!R&&!O)return S;O=O||S.worldview_default;const k=Object.values(S.language||{});if(k.length===0)return null;const U=Object.values(S.worldview||{});if(U.length===0)return null;const F=k.every(($=>$===R)),H=U.every(($=>$===O));return F&&H?S:R in(S.language_options||{})||O in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null})(f.data,o,d);return T?s.o.frame((()=>v(null,T))):f.url?s.m(t.transformRequest(t.normalizeSourceURL(f.url,null,o,d),s.R.Source),v):s.o.frame((()=>{const{data:S,...R}=f;v(null,R)}))}function zo(f,t){const o=Math.pow(2,t.z),d=Math.floor(s.aF(f.getWest())*o),y=Math.floor(s.aJ(f.getNorth())*o),v=Math.ceil(s.aF(f.getEast())*o),T=Math.ceil(s.aJ(f.getSouth())*o);return t.x>=d&&t.x<v&&t.y>=y&&t.y<T}class ba{constructor(t,o,d){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(s.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!zo(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(zo(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new ba(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class Kr extends s.E{constructor(t,o,d,y){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Ys(this._options,this.map._requestManager,o,d,((y,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new s.y(y));else if(v){if(Object.assign(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of v.vector_layers)this.vectorLayerIds.push(T.id),v.worldview&&v.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=ba.fromTileJSON(v),Kt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){const d=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),v=this.map._requestManager.transformRequest(y,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,S=T?{image:T.image.clone()}:null,R={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.h(d)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",R,O.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",R,O.bind(this),void 0,!0);else{const k=s.aL.call({deduped:this._deduped},R,((U,F)=>{U||!F?O.call(this,U):(R.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},t.actor&&t.actor.send("loadTile",R,O.bind(this),void 0,!0))}),!0);t.request={cancel:k}}function O(k,U){return delete t.request,t.aborted?o(null):k&&k.status!==404?o(k):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),s.aM(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ds extends s.E{constructor(t,o,d,y){super(),this.id=t,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,s.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=Ys(this._options,this.map._requestManager,null,o,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new s.y(d)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((v=>v.id))),this.tileBounds=ba.fromTileJSON(y),Kt(y.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const d=s.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(y,s.R.Tile),((v,T,S,R)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):v?(t.state="errored",o(v)):T?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:R}),t.setTexture(T,this.map.painter),t.state="loaded",s.aM(this.dispatcher),void o(null)):o(null))))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ro([f,t],o,d,{scaled:y=!0}={}){const{tileSize:v,buffer:T}=d,{x:S,y:R,z:O}=o;if(!isFinite(S)||!isFinite(R)||!isFinite(O))throw new Error("Invalid MRT header");const k=2**O,U=k*s.aF(f),F=k*s.aJ(t);return(function([H,$],W,{scaled:ie=!0}={}){if(!W)throw new Error("bandView is undefined");const{data:X,tileSize:re,buffer:ue,offset:de,scale:be,dimension:ye}=W;if(H<-ue||H>re+ue||$<-ue||$>re+ue)throw new Error(`Point (${H}, ${$}) out of bounds for tileSize=${re}, buffer=${ue}`);const ve=($+ue)*(re+2*ue)+(H+ue);if(new Uint32Array(X.buffer)[ve]===4294967295)return null;let ge=[];ge=ie?[]:new W.data.constructor(ye);for(let _e=0;_e<ye;_e++)ge[_e]=Math.round(1e12*(X[ye*ve+_e]*be+de))/1e12;return ge})([Math.min(Math.max(-T,Math.floor((U-S)*v)),v-1+T),Math.min(Math.max(-T,Math.floor((F-R)*v)),v-1+T)],d,{scaled:y})}class ta extends ds{constructor(t,o,d,y){super(t,o,d,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);o&&o.enabled&&d&&o._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,s.R.Tile),v={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const T=(S,R,O,k)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(S)return S.name==="AbortError"?void 0:(t.state="errored",o(S));if(this.map._refreshExpiredTiles&&R&&t.setExpiryData({cacheControl:O,expires:k}),this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!R)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=R}o(null)};t.request=this.partial?t.fetchHeader(void 0,T.bind(this)):t.actor.send("loadTile",v,T.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!0);for(const y of d.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,o,d,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,d,y,((v,T)=>{if(v)return t.state="errored",this.fire(new s.y(v)),void this.triggerRepaint(t);T&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,T,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find((({id:v})=>v===t)),d=o&&o.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(t,o,d){if(!t)return;const y=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let v=null;o instanceof s.aP?v=o.paint.get("raster-array-band"):o instanceof s.aQ&&(v=o.paint.get("raster-particle-array-band"));const T=v||this.getInitialBand(y);if(T==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,y,o.id,T);if(t.updateNeeded(o.id,T)&&!d)return;const S=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},S,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){const d=new Map;for(const y of t)for(const v of o){const[T,S]=v.split("/"),R=y.getLayer(T);if(!R||!R.hasBand(S)||!R.hasDataForBand(S))continue;const{bytes:O,tileSize:k,buffer:U}=R.getBandView(S),F=k+2*U,H={data:new s.q({width:F,height:F},O),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(v,H)}return d}queryRasterArrayValueByBandId(t,o,d){const y=o._mrt;return new Promise((v=>{const T={},S=new Set;for(const[R,O]of Object.entries(y.layers)){if(d.layerName&&R!==d.layerName)continue;const k={};T[R]=k;for(const{bands:U}of O.dataIndex)for(const F of U)d.bands&&!d.bands.includes(F)||(S.add(s.B(R,F)),o.fetchBand(R,null,F,(H=>{s.o.frame((()=>{k[F]=H?null:ro([t.lng,t.lat],y,O.getBandView(F)),S.delete(s.B(R,F)),S.size===0&&v(T)}))}),!1))}S.size===0&&v(T)}))}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,s.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((v,T,S,R)=>v?(this._loadTilePending[t.uid].forEach((O=>O(v,null))),void delete this._loadTilePending[t.uid]):T?(this.map._refreshExpiredTiles&&T&&t.setExpiryData({cacheControl:S,expires:R}),t._mrt=T,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((O=>O(null,T))),this._loadTileLoaded[t.uid]=!0,void delete this._loadTilePending[t.uid]):(this._loadTilePending[t.uid].forEach((O=>O(null,null))),void delete this._loadTilePending[t.uid])),void 0,!0)}queryRasterArrayValueByAllBands(t,o,d){return new Promise(((y,v)=>{this._loadTileForQuery(o,((T,S)=>{T?v(T):y(S?this.queryRasterArrayValueByBandId(t,o,d):null)}))}))}queryRasterArrayValue(t,o){const d=s.aR.convert(t),y=this.findLoadedParent(d);return y&&y._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(d,y,o):this.queryRasterArrayValueByAllBands(d,y,o):Promise.resolve(null)}findLoadedParent(t){const o=s.ae.fromLngLat(t,this.map.transform.tileSize),d=this.maxzoom+1,y=1<<d,v=Math.floor(o.x),T=Math.floor((o.x-v)*y),S=Math.floor(o.y*y),R=this.map.style.getSourceCache(this.id),O=new s.aO(d,v,d,T,S);return R.findLoadedParent(O,this.minzoom)}}const lc={vector:Kr,raster:ds,"raster-dem":class extends ds{constructor(f,t,o,d){super(f,t,o,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,v){y&&(f.state="errored",t(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=s.n(this.map._requestManager.transformRequest(o,s.R.Tile),(function(y,v,T,S){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(y)f.state="errored",t(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:S});const R=ImageBitmap&&v instanceof ImageBitmap&&s.r(),O=1-(v.width-s.aN(v.width))/2;O<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const k=R?v:s.o.getImageData(v,O),U={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:O};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",U,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const t=f.canonical,o=Math.pow(2,t.z),d=(t.x-1+o)%o,y=t.x===0?f.wrap-1:f.wrap,v=(t.x+1+o)%o,T=t.x+1===o?f.wrap+1:f.wrap,S={};return S[new s.aO(f.overscaledZ,y,t.z,d,t.y).key]={backfilled:!1},S[new s.aO(f.overscaledZ,T,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(S[new s.aO(f.overscaledZ,y,t.z,d,t.y-1).key]={backfilled:!1},S[new s.aO(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new s.aO(f.overscaledZ,T,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<o&&(S[new s.aO(f.overscaledZ,y,t.z,d,t.y+1).key]={backfilled:!1},S[new s.aO(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new s.aO(f.overscaledZ,T,t.z,v,t.y+1).key]={backfilled:!1}),S}},"raster-array":ta,geojson:class extends s.E{constructor(f,t,o,d){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(d),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of f.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,o,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:o},d),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:f},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(o),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new s.y(d));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(v.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const o=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,v=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:v,worldview:this.map.getWorldview()};f.request=this.actor.send(o,T,((S,R)=>v&&!R?(f.state="loaded",t(null)):(delete f.request,f.destroy(),f.aborted?t(null):S?t(S):(f.loadVectorData(R,this.map.painter,o==="reloadTile"),t(null)))),void 0,o==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aS{constructor(f,t,o,d){super(f,t,o,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aT(this.urls,((t,o)=>{this._loaded=!0,t?this.fire(new s.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aS,model:class extends s.E{constructor(f,t,o,d){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const f=[];for(const t in this._options.models){const o=this._options.models[t],d=s.aV(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then((y=>{if(!y)return;const v=s.aW(y),T=new s.aX(t,o.position,o.orientation,v);T.computeBoundsAndApplyParent(),this.models.push(T)})).catch((y=>{this.fire(new s.y(new Error(`Could not load model ${t} from ${o.uri}: ${y.message}`)))}));f.push(d)}Promise.allSettled(f).then((()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this._loaded=!0,this.fire(new s.y(new Error(`Could not load models: ${t.message}`)))}))}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(f,t,o,d){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(f)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Ys(this._options,this.map._requestManager,t,o,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.y(d))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new ba(y.bounds,this.minzoom,this.maxzoom)),Kt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(d)}))}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const v=Object.values(f.buckets);for(const T of v)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",d,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(v,T){return f.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aS{constructor(f,t,o,d){super(f,t,o,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((v=>typeof v!="number"))))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,t,o,d){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ba(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:o,z:d}=f.canonical;return this._implementation.hasTile({x:t,y:o,z:d})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:o,y:d,z:y}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:o,y:d,z:y},{signal:v.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",t(null)):T===void 0?(f.state="errored",t(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):(function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement})(T)?(this.loadTileData(f,T),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((T=>{T.name!=="AbortError"&&(f.state="errored",t(T))})),f.request.cancel=()=>v.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof s.T?(f.destroy(!0),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:o,y:d,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:o,y:d,z:y})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z})))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Rr=function(f,t,o,d){const y=new lc[t.type](f,t,o,d);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return s.aY(["load","abort","unload","serialize","prepare"],y),y};function Ml(f,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:v}=d;return`featureset:${y}${v?`:import:${v}`:""}`}})(f.target)}`}function bo(f,t,o,d=""){if(f.uniqueFeatureID){const y=Ml(f,t,d);if(o.has(y))return!0;o.add(y)}return!1}function Pl(f,t,o,d,y=!1){const v=t.sourceCache.transform,T=t.sourceCache.tilesIn(f,t.has3DLayers,y);T.sort(id);const S=[];for(const R of T){const O=R.tile.queryRenderedFeatures(t,R,o,d,v,y);Object.keys(O).length&&S.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:O})}return S.length===0?{}:(function(R){const O={},k={};for(const U of R){const F=U.queryResults,H=U.wrappedTileID,$=k[H]=k[H]||{};for(const W in F){const ie=F[W],X=$[W]=$[W]||{},re=O[W]=O[W]||[];for(const ue of ie)X[ue.featureIndex]||(X[ue.featureIndex]=!0,re.push(ue))}}return O})(S)}function ko(f,t,o,d,y,v){const T={},S=d.queryRenderedSymbols(f),R=[];for(const O of Object.keys(S).map(Number))R.push(y[O]);R.sort(id);for(const O of R){const k=O.featureIndex.lookupSymbolFeatures(S[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,t,o,v);for(const U in k){const F=T[U]=T[U]||[],H=k[U];H.sort((($,W)=>{const ie=O.featureSortOrder;if(ie){const X=ie.indexOf($.featureIndex);return ie.indexOf(W.featureIndex)-X}return W.featureIndex-$.featureIndex}));for(const $ of H)F.push($)}}return T}function ia(f,t){const o=f.getRenderableIds().map((v=>f.getTileByID(v))),d=[],y={};for(let v=0;v<o.length;v++){const T=o[v],S=T.tileID.canonical.key;y[S]||(y[S]=!0,T.querySourceFeatures(d,t))}return d}function id(f,t){const o=f.tileID,d=t.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function wu(f,t){const o={};if(!t)return o;for(const d of f){const y=d.layerIds.map((v=>t.getLayer(v))).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((v=>y.filter((T=>T.id===v))[0])));for(const v of y)o[v.fqid]=d}}return o}const Ks=32,wa=33,No=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,o=0,d=0,y=0,v=0,T=0,S=0;for(1&t?y=v=T=Ks:o=d=S=Ks;(t>>=1)>1;){const O=o+y>>1,k=d+v>>1;1&t?(y=o,v=d,o=T,d=S):(o=y,d=v,y=T,v=S),T=O,S=k}const R=4*f;No[R+0]=o,No[R+1]=d,No[R+2]=y,No[R+3]=v}const xs=new Uint16Array(2178),so=new Uint8Array(1089),Dl=new Uint16Array(1089);function sh(f){return f===0?-.03125:f===32?.03125:0}const cc={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Ol{constructor(t,o,d,y,v,T){this.tileID=t,this.uid=s.b2(),this.uses=0,this.tileSize=o,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=T}registerFadeDuration(t){const o=t+this.timeAdded;o<s.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=wu(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const v=this.buckets[y];if(v instanceof s.b4){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const v=this.buckets[y];if(v instanceof s.b4&&v.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const y in this.buckets){const v=this.buckets[y],T=o.style.getOwnLayer(y);if(!T)continue;const S=T.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,wu(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(t)}const o=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new s.T(t,d.image,o.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=o.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(t,o,d,y,v,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=(function(R,O){const k=s.bq([],[.5*R.width,.5*-R.height,1]);return s.br(k,k,[1,-1,0]),s.aB(k,k,R.calculateProjMatrix(O.toUnwrapped())),Float32Array.from(k)})(v,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:S,transform:y,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),v=o?o.sourceLayer:"",T=y._geojsonTileLayer||y[v];if(!T)return;const S=s.b6(o&&o.filter),{z:R,x:O,y:k}=this.tileID.canonical,U={z:R,x:O,y:k};for(let F=0;F<T.length;F++){const H=T.feature(F);if(S.needGeometry){const ie=s.b7(H,!0);if(!S.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ie,this.tileID.canonical))continue}else if(!S.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H))continue;const $=d.getId(H,v),W=new s.b8(H,R,O,k,$);W.tile=U,t.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const d=s.b9(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{const v=this.expirationTime-o;v?this.expirationTime=d+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),v=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const S=this.buckets[T],R=S.layers[0],O=R.sourceLayer||"_geojsonTileLayer",k=d[O],U=t.style.getLayerSourceCache(R);let F={};U&&(F=U._state.getState(O,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},$=Object.keys(F).length>0&&!o;($&&S.stateDependentLayers.length!==0||o)&&S.update(F,k,y,H,$?S.stateDependentLayers:S.layers,o,v),(S instanceof s.ba||S instanceof s.bb)&&t._terrain&&t._terrain.enabled&&U&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const W=t&&t.style&&t.style.getOwnLayer(T);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,o){const d=o.context,y=d.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(d,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,o){const d={};for(const y of o)d[y]=!0;this.dependencies[t]=d}hasDependency(t,o){for(const d of t){const y=this.dependencies[d];if(y){for(const v of o)if(y[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const d=s.bc(cc,this.tileID.canonical,this.tileTransform)[0],y=new s.bd,v=new s.be;for(let T=0;T<d.length;T++){const{x:S,y:R}=d[T];y.emplaceBack(S,R),v.emplaceBack(T)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(y,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,y.length,v.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const d=s.bc(cc,this.tileID.canonical,this.tileTransform)[0];let y,v;if(this.isRaster){const T=(function(S,R){const O=s.aZ(S,R),k=Math.pow(2,S.z);for(let ie=0;ie<wa;ie++)for(let X=0;X<wa;X++){const re=s.a_((S.x+(X+sh(X))/Ks)/k),ue=s.a$((S.y+(ie+sh(ie))/Ks)/k),de=R.project(re,ue),be=ie*wa+X;xs[2*be+0]=Math.round((de.x*O.scale-O.x)*s.al),xs[2*be+1]=Math.round((de.y*O.scale-O.y)*s.al)}so.fill(0),Dl.fill(0);for(let ie=2045;ie>=0;ie--){const X=4*ie,re=No[X+0],ue=No[X+1],de=No[X+2],be=No[X+3],ye=re+de>>1,ve=ue+be>>1,ge=ye+ve-ue,_e=ve+re-ye,xe=ue*wa+re,Ze=be*wa+de,Oe=ve*wa+ye,ot=Math.hypot((xs[2*xe+0]+xs[2*Ze+0])/2-xs[2*Oe+0],(xs[2*xe+1]+xs[2*Ze+1])/2-xs[2*Oe+1])>=16;so[Oe]=so[Oe]||(ot?1:0),ie<1022&&(so[Oe]=so[Oe]||so[(ue+_e>>1)*wa+(re+ge>>1)]||so[(be+_e>>1)*wa+(de+ge>>1)])}const U=new s.b0,F=new s.b1;let H=0;function $(ie,X){const re=X*wa+ie;return Dl[re]===0&&(U.emplaceBack(xs[2*re+0],xs[2*re+1],ie*s.al/Ks,X*s.al/Ks),Dl[re]=++H),Dl[re]-1}function W(ie,X,re,ue,de,be){const ye=ie+re>>1,ve=X+ue>>1;if(Math.abs(ie-de)+Math.abs(X-be)>1&&so[ve*wa+ye])W(de,be,ie,X,ye,ve),W(re,ue,de,be,ye,ve);else{const ge=$(ie,X),_e=$(re,ue),xe=$(de,be);F.emplaceBack(ge,_e,xe)}}return W(0,0,Ks,Ks,Ks,0),W(Ks,Ks,0,0,0,Ks),{vertices:U,indices:F}})(this.tileID.canonical,o);y=T.vertices,v=T.indices}else{y=new s.b0,v=new s.b1;for(const{x:S,y:R}of d)y.emplaceBack(S,R,0,0);const T=s.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let S=0;S<T.length;S+=3)v.emplaceBack(T[S],T[S+1],T[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,s.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=s.bg.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugBuffers(t,o){const d=o.projection;if(!d||d.name!=="globe"||o.freezeTileCoverage)return;const y=this.tileID.canonical,v=s.bj(y,o),T=s.bk(v),S=s.aj(o.zoom);let R;S>0&&(R=s.bl(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,o,T,R,S),this._makeGlobeTileDebugTextBuffer(t,y,o,T,R,S)}_globePoint(t,o,d,y,v,T,S){let R=s.bm(t,o,d);if(T){const O=1<<d.z,k=s.aF(y.center.lng),U=s.aJ(y.center.lat),F=(d.x+.5)/O-k;let H=0;F>.5?H=-1:F<-.5&&(H=1);let $=(t/s.al+d.x)/O+H,W=(o/s.al+d.y)/O;$=($-k)*y._pixelsPerMercatorPixel+k,W=(W-U)*y._pixelsPerMercatorPixel+U;const ie=[$*y.worldSize,W*y.worldSize,0];s.af(ie,ie,T),R=s.bn(R,ie,S)}return s.af(R,R,v)}_makeGlobeTileDebugBorderBuffer(t,o,d,y,v,T){const S=new s.bd,R=new s.be,O=new s.bo,k=(F,H,$,W,ie)=>{const X=($-F)/(ie-1),re=(W-H)/(ie-1),ue=S.length;for(let de=0;de<ie;de++){const be=F+de*X,ye=H+de*re;S.emplaceBack(be,ye);const ve=this._globePoint(be,ye,o,d,y,v,T);O.emplaceBack(ve[0],ve[1],ve[2]),R.emplaceBack(ue+de)}},U=s.al;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(R),this._tileDebugBuffer=t.createVertexBuffer(S,s.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,S.length,R.length)}_makeGlobeTileDebugTextBuffer(t,o,d,y,v,T){const S=s.al/4,R=new s.bd,O=new s.b1,k=new s.bo,U=25;O.reserve(32),R.reserve(U),k.reserve(U);const F=(H,$)=>U*H+$;for(let H=0;H<U;H++){const $=H*S;for(let W=0;W<U;W++){const ie=W*S;R.emplaceBack(ie,$);const X=this._globePoint(ie,$,o,d,y,v,T);k.emplaceBack(X[0],X[1],X[2])}}for(let H=0;H<4;H++)for(let $=0;$<4;$++){const W=F(H,$),ie=F(H,$+1),X=F(H+1,$),re=F(H+1,$+1);O.emplaceBack(W,ie,X),O.emplaceBack(X,ie,re)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(R,s.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,U,32)}destroy(t=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class nl extends Ol{constructor(t,o,d,y,v){super(t,o,d,y,v),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,d){const y=d.context,v=y.gl;let T=this.texturePerLayer.get(t)||d.getTileTexture(o.width);T&&T instanceof s.T?T.update(o,{premultiply:!1}):T=new s.T(y,o,v.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,T)}flushQueues(t){const o=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){const d=this._mrt=new s.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bu(y,((v,T,S,R)=>{if(v)o(v);else try{const O=d.getHeaderLength(T);if(O>t)return void(this.request=this.fetchHeader(O,o));d.parseHeader(T),this._isHeaderLoaded=!0;let k=0;for(const U of Object.values(d.layers))k=Math.max(k,U.dataIndex[U.dataIndex.length-1].lastByte);T.byteLength>=k&&(this.entireBuffer=T),o(null,this.entireBuffer||T,S,R)}catch(O){o(O)}})),this.request}fetchBandForRender(t,o,d,y){this.fetchBand(t,o,d,(v=>{if(v)return void y(v);this.updateTextureDescriptor(t,o,d);const T=this.textureDescriptorPerLayer.get(o);y(null,T?T.img:null)}))}fetchBand(t,o,d,y,v=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void y(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void y(new Error("Can't fetch tile band without an actor"));let R;const O=s.B(String(d),s.B(this.tileID.key,t));let k=this._taskQueue.get(O);k?k.add(y):(k=new Set,k.add(y),this._taskQueue.set(O,k));const U=(W,ie)=>{R.complete(W,ie),W?y(W):(k.values().forEach((X=>X(null,ie))),this._taskQueue.delete(O))},F=(W,ie)=>{if(W)return y(W);const X=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ie,task:R},U,void 0,!0);if(o!==null){const re=this._workQueuePerLayer.get(o)||[];re.push((()=>{X&&X.cancel(),R.cancel()})),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,re)}};let H;try{H=T.getLayer(t)}catch(W){if(this.state==="reloading")return;throw W}if(!H)return void y(new Error(`Unknown sourceLayer "${t}"`));if(H.hasDataForBand(d))return k.values().forEach((W=>W(null,null))),void this._taskQueue.delete(O);const $=H.getDataRange([d]);if(R=T.createDecodingTask($),!R||R.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)F(null,this.entireBuffer.slice($.firstByte,$.lastByte+1));else{const W=Object.assign({},this.requestParams,{headers:{Range:`bytes=${$.firstByte}-${$.lastByte}`}}),ie=s.bu(W,F);if(o!==null){const X=this._fetchQueuePerLayer.get(o)||[];X.push((()=>{ie.cancel(),R.cancel()})),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,X)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,d){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(d)||!y.hasDataForBand(d))return;const{bytes:v,tileSize:T,buffer:S,offset:R,scale:O}=y.getBandView(d),k=T+2*S,U=new s.q({width:k,height:k},v),F=this.texturePerLayer.get(o);F&&F instanceof s.T&&F.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:d,img:U,buffer:S,offset:R,tileSize:T,format:y.pixelFormat,mix:[O,256*O,65536*O,16777216*O]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const o of this.texturePerLayer.values())o&&o instanceof s.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class uc{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,d){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const v={value:o,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout((()=>{this.remove(t,v)}),d)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const d=t.wrapped().key,y=o===void 0?0:this.data[d].indexOf(o),v=this.data[d][y];return this.data[d].splice(y,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const d in this.data)for(const y of this.data[d])t(y.value)||o.push(y);for(const d of o)this.remove(d.value.tileID,d)}}class Fo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,d){const y=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==y&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const v in this.state[t][y])d[v]||(this.deletedStates[t][y][v]=null)}else for(const v in d)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][v]===null&&delete this.deletedStates[t][y][v]}removeFeatureState(t,o,d){if(this.deletedStates[t]===null)return;const y=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&o!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][d]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(d in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][d]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,o){const d=this.state[t]||{},y=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(o!==void 0){const S=String(o),R=Object.assign({},d[S],y[S]);if(v){const O=v[o];if(O===null)return{};for(const k in O)delete R[k]}return R}const T=Object.assign({},d,y);if(v)for(const S in v)delete T[S];return T}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const v={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),Object.assign(this.state[y][T],this.stateChanges[y][T]),v[T]=this.state[y][T];d[y]=v}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const v={};if(this.deletedStates[y]===null)for(const T in this.state[y])v[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const S of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][S];v[T]=this.state[y][T]}d[y]=d[y]||{},Object.assign(d[y],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in t)t[y].refreshFeatureState(o)}}class wo extends s.E{constructor(t,o,d){super(),this.id=t,this._onlySymbols=d,o.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),o.on("error",(()=>{this._sourceErrored=!0})),this._source=o,this._tiles={},this._cache=new uc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Fo,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Ta).map((t=>t.key))}getRenderableIds(t,o){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,t,o)&&d.push(this._tiles[y]);return t?d.sort(((y,v)=>{const T=y.tileID,S=v.tileID,R=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),O=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-S.overscaledZ||O.y-R.y||O.x-R.x})).map((y=>y.tileID.key)):d.map((y=>y.tileID)).sort(Ta).map((y=>y.key))}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=o),this._loadTile(d,this._tileLoaded.bind(this,d,t,o)))}_tileLoaded(t,o,d,y){if(y)if(t.state="errored",y.status!==404)this._source.fire(new s.y(y,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.o.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const o=this.getRenderableIds();for(let y=0;y<o.length;y++){const v=o[y];if(t.neighboringTiles&&t.neighboringTiles[v]){const T=this.getTileByID(v);d(t,T),d(T,t)}}function d(y,v){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=v.tileID.canonical.x-y.tileID.canonical.x;const S=v.tileID.canonical.y-y.tileID.canonical.y,R=Math.pow(2,y.tileID.canonical.z),O=v.tileID.key;T===0&&S===0||Math.abs(S)>1||(Math.abs(T)>1&&(Math.abs(T+R)===1?T+=R:Math.abs(T-R)===1&&(T-=R)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,T,S),y.neighboringTiles&&y.neighboringTiles[O]&&(y.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,d,y){for(const v in this._tiles){let T=this._tiles[v];if(y[v]||!T.hasData()||T.tileID.overscaledZ<=o||T.tileID.overscaledZ>d)continue;let S=T.tileID;for(;T&&T.tileID.overscaledZ>o+1;){const O=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[O.key],T&&T.hasData()&&(S=O)}let R=S;for(;R.overscaledZ>o;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){y[S.key]=S;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=t.overscaledZ-1;d>=o;d--){const y=t.scaledTo(d),v=this._getLoadedTile(y);if(v)return v}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const d=Math.ceil(t.width/o)+1,y=Math.ceil(t.height/o)+1,v=Math.floor(d*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(S)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const d={};for(const y in this._tiles){const v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),d[v.tileID.key]=v}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,o,d,y,v){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let S,R=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const F=O.attenuationRange()[0],H=Math.floor(F)-Math.log2(O.getDemUpscale());R>H&&(R=H)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((F=>new s.aO(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,S=F.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new s.aO(1,0,1,0,0)),S.push(new s.aO(1,0,1,1,0)),S.push(new s.aO(1,0,1,0,1)),S.push(new s.aO(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);S=S.filter((H=>F(H)))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ll(this._source.type)){const F=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),H=Math.min(F,this._source.maxzoom);if(T){const $=t.extendTileCover(S,H);for(const W of $)S.push(W)}else if(v){const $=t.extendTileCoverToNearPlane(S,this.transform.getFrustum(H),H);for(const W of $)S.push(W)}else if(this.castsShadows&&y){const $=t.extendTileCover(S,H,y);for(const W of $)this._shadowCasterTiles[W.key]=!0,S.push(W)}}const k=this._updateRetainedTiles(S);if(Ll(this._source.type)&&S.length!==0){const F={},H={},$=Object.keys(k);for(const ie of $){const X=k[ie],re=this._tiles[ie];if(!re||re.fadeEndTime&&re.fadeEndTime<=s.o.now())continue;const ue=this.findLoadedParent(X,Math.max(X.overscaledZ-wo.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),F[ue.tileID.key]=ue.tileID),H[ie]=X}const W=S[S.length-1].overscaledZ;for(const ie in this._tiles){const X=this._tiles[ie];if(k[ie]||!X.hasData())continue;let re=X.tileID;for(;re.overscaledZ>W;){re=re.scaledTo(re.overscaledZ-1);const ue=this._tiles[re.key];if(ue&&ue.hasData()&&H[re.key]){k[ie]=X.tileID;break}}}for(const ie in F)k[ie]||(this._coveredTiles[ie]=!0,k[ie]=F[ie])}for(const F in k)this._tiles[F].clearFadeHold();const U=s.bv(this._tiles,k);for(const F of U){const H=this._tiles[F];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const d={},y=t.reduce(((O,k)=>Math.min(O,k.overscaledZ)),1/0),v=t[0].overscaledZ,T=Math.max(v-wo.maxOverzooming,this._source.minzoom),S=Math.max(v+wo.maxUnderzooming,this._source.minzoom),R={};for(const O of t){const k=this._addTile(O);o[O.key]=O,k.hasData()||y<this._source.maxzoom&&(R[O.key]=O)}this._retainLoadedChildren(R,y,S,o);for(const O of t){let k=this._tiles[O.key];if(k.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const F=O.children(this._source.maxzoom)[0],H=this.getTile(F);if(H&&H.hasData()){o[F.key]=F;continue}}else{const F=O.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let U=k.wasRequested();for(let F=O.overscaledZ-1;F>=T;--F){const H=O.scaledTo(F);if(d[H.key]||(d[H.key]=!0,k=this.getTile(H),!k&&U&&(k=this._addTile(H)),k&&(o[H.key]=H,U=k.wasRequested(),k.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let d,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}o.push(y.key);const v=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;y=v}for(const v of o)this._loadedParentTiles[v]=d}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const d=!!o;if(!d){const y=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new nl(t,v,this.transform.tileZoom,y,this._isRaster):new Ol(t,v,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,d||this._source.fire(new s.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=o.getExpiryTimeout();d&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),d))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,d){const y=[],v=this.transform;if(!v)return y;const T=v.projection.name==="globe",S=s.aF(v.center.lng);for(const R in this._tiles){const O=this._tiles[R];if(d&&O.clearQueryDebugViz(),O.holdingForFade())continue;let k;if(T){const U=O.tileID.canonical;if(U.z===0){const F=[Math.abs(s.aA(S,...na(U,-1))-S),Math.abs(s.aA(S,...na(U,1))-S)];k=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(s.aA(S,...na(U,-1))-S),Math.abs(s.aA(S,...na(U,0))-S),Math.abs(s.aA(S,...na(U,1))-S)];k=[F.indexOf(Math.min(...F))-1]}}else k=[0];for(const U of k){const F=t.containsTile(O,v,o,U);F&&y.push(F)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const d=this.getRenderableIds(t,o).map((v=>this._tiles[v].tileID)),y=this.transform.projection.name==="globe";for(const v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=y?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(t){const o=t.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),v={};for(const T of o){const S=1/(1<<T.canonical.z);v[T.key]=((T.canonical.x+.5)*S+T.wrap-d[0])*y[0]+((T.canonical.y+.5)*S-d[1])*y[1]-d[2]*y[2]}return o.sort(((T,S)=>v[T.key]-v[S.key])),o}hasTransition(){if(this._source.hasTransition())return!0;if(Ll(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,o,d){this._state.updateState(t=t||"_geojsonTileLayer",o,d)}removeFeatureState(t,o,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,d)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,d){const y=this._tiles[t];y&&y.setDependencies(o,d)}reloadTilesForDependencies(t,o){for(const d in this._tiles)this._tiles[d].hasDependency(t,o)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(t,o)))}_preloadTiles(t,o){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(t,o))};return void this._source.on("data",R)}const d=new Map,y=Array.isArray(t)?t:[t],v=this.map.painter.terrain,T=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const R of y){const O=R.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of O)d.set(k.key,k);this.usedForTerrain&&R.updateElevation(!1)}const S=Array.from(d.values());s.bw(S,((R,O)=>{const k=new Ol(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,(U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),O(U,k)}))}),o)}}function Ta(f,t){const o=Math.abs(2*f.wrap)-+(f.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||d-o||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function Ll(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function na(f,t){const o=1<<f.z;return[f.x/o+t,(f.x+1)/o+t]}wo.maxOverzooming=10,wo.maxUnderzooming=3;class hc{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:o});else if(y.type==="model"){const v=this.style.getLayerSource(y);v&&v.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const d=o.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?y=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(y=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&o.visible,o.visible=y}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const y of this.layers){const v=y.layer,T=this.style.getLayerSourceCache(v);let S=1;v.type==="fill-extrusion"?S=y.visible?v.paint.get("fill-extrusion-vertical-scale"):0:v.type==="building"&&(S=y.visible?v.paint.get("building-vertical-scale"):0);let R=T?T.getTile(o):null;if(!R&&T)for(const O in T._tiles){const k=T._tiles[O];if(o.canonical.isChildOf(k.tileID.canonical)){R=k;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(v):null,tileID:R?R.tileID:o,verticalScale:S})}t.hasAnyZOffset=!1;let d=!1;for(let y=0;y<t.symbolInstances.length;y++){const v=t.symbolInstances.get(y),T=v.zOffset,S=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=S!==Number.NEGATIVE_INFINITY?S:T,d||T===v.zOffset||(d=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,d,y){let v=o,T=d;if(t.canonical.z!==y.canonical.z){const S=y.canonical,R=1/(1<<t.canonical.z-S.z);v=(o+t.canonical.x*s.al)*R-S.x*s.al|0,T=(d+t.canonical.y*s.al)*R-S.y*s.al|0}return{tileX:v,tileY:T}}_getHeightAtTileOffset(t,o,d){let y,v;for(let T=0;T<this.layers.length;++T){const S=this.layers[T].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:R,tileID:O,verticalScale:k}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:U,tileY:F}=this._mapCoordToOverlappingTile(t,o,d,O),H=R.getHeightAtTileCoord(U,F);H&&H.height!==void 0&&(H.hidden?y=H.height:v=Math.max(H.height*k,v||0))}if(v!==void 0)return v;for(let T=0;T<this.layers.length;++T){const S=this.layers[T];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:R,tileID:O}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,o,d,O),F=R.getHeightAtTileCoord(k,U);if(F&&!F.hidden)return F.height===void 0&&y!==void 0?Math.min(F.maxHeight,y)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Tu(f,t){const o={};for(const d in f)d!=="ref"&&(o[d]=f[d]);return s.bx.forEach((d=>{d in t&&(o[d]=t[d])})),o}function zl(f){f=f.slice();const t=Object.create(null);for(let o=0;o<f.length;o++)t[f[o].id]=f[o];for(let o=0;o<f.length;o++)"ref"in f[o]&&(f[o]=Tu(f[o],t[f[o].ref]));return f}const on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function To(f,t,o){o.push({command:on.addSource,args:[f,t[f]]})}function Eu(f,t,o){t.push({command:on.removeSource,args:[f]}),o[f]=!0}function Qr(f,t,o,d){Eu(f,o,d),To(f,t,o)}function Pa(f,t,o){let d;for(d in f[o])if(f[o].hasOwnProperty(d)&&d!=="data"&&!s.by(f[o][d],t[o][d]))return!1;for(d in t[o])if(t[o].hasOwnProperty(d)&&d!=="data"&&!s.by(f[o][d],t[o][d]))return!1;return!0}function rl(f,t,o,d,y,v){let T;for(T in t=t||{},f=f||{})f.hasOwnProperty(T)&&(s.by(f[T],t[T])||o.push({command:v,args:[d,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(s.by(f[T],t[T])||o.push({command:v,args:[d,T,t[T],y]}))}function sl(f){return f.id}function Gc(f,t){return f[t.id]=t,f}function dc(f,t,o){const d=t.createTileMatrix(f,f.worldSize,o.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,d)}function fc(f,t,o){if(t.projection.name===o.projection.name)return f.projMatrix;const d=o.clone();return d.setProjection(t.projection),dc(d,t.getProjection(),f)}function Eo(f,t,o){return t.name===o.projection.name?f.projMatrix:dc(o,t,f)}class ho{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let o=1,d=this._distances[o];const y=t*this.paddedLength+this.padding;for(;d<y&&o<this._distances.length;)d=this._distances[++o];const v=o-1,T=this._distances[v],S=d-T,R=S>0?(y-T)/S:0;return this.points[v].mult(1-R).add(this.points[o].mult(R))}}class kl{constructor(t,o,d){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(o/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,d,y,v){this._forEachCell(o,d,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(t,o,d,y){this._forEachCell(o-y,d-y,o+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(d),this.circles.push(y)}_insertBoxCell(t,o,d,y,v,T){this.boxCells[v].push(T)}_insertCircleCell(t,o,d,y,v,T){this.circleCells[v].push(T)}_query(t,o,d,y,v,T){if(d<0||t>this.width||y<0||o>this.height)return!v&&[];const S=[];if(t<=0&&o<=0&&this.width<=d&&this.height<=y){if(v)return!0;for(let R=0;R<this.boxKeys.length;R++)S.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],k=this.circles[3*R+1],U=this.circles[3*R+2];S.push({key:this.circleKeys[R],x1:O-U,y1:k-U,x2:O+U,y2:k+U})}return T?S.filter(T):S}return this._forEachCell(t,o,d,y,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},T),v?S.length>0:S}_queryCircle(t,o,d,y,v){const T=t-d,S=t+d,R=o-d,O=o+d;if(S<0||T>this.width||O<0||R>this.height)return!y&&[];const k=[];return this._forEachCell(T,R,S,O,this._queryCellCircle,k,{hitTest:y,circle:{x:t,y:o,radius:d},seenUids:{box:{},circle:{}}},v),y?k.length>0:k}query(t,o,d,y,v){return this._query(t,o,d,y,!1,v)}hitTest(t,o,d,y,v){return this._query(t,o,d,y,!0,v)}hitTestCircle(t,o,d,y){return this._queryCircle(t,o,d,!0,y)}_queryCell(t,o,d,y,v,T,S,R){const O=S.seenUids,k=this.boxCells[v];if(k!==null){const F=this.bboxes;for(const H of k)if(!O.box[H]){O.box[H]=!0;const $=4*H;if(t<=F[$+2]&&o<=F[$+3]&&d>=F[$+0]&&y>=F[$+1]&&(!R||R(this.boxKeys[H]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[H],x1:F[$],y1:F[$+1],x2:F[$+2],y2:F[$+3]})}}}const U=this.circleCells[v];if(U!==null){const F=this.circles;for(const H of U)if(!O.circle[H]){O.circle[H]=!0;const $=3*H;if(this._circleAndRectCollide(F[$],F[$+1],F[$+2],t,o,d,y)&&(!R||R(this.circleKeys[H]))){if(S.hitTest)return T.push(!0),!0;{const W=F[$],ie=F[$+1],X=F[$+2];T.push({key:this.circleKeys[H],x1:W-X,y1:ie-X,x2:W+X,y2:ie+X})}}}}}_queryCellCircle(t,o,d,y,v,T,S,R){const O=S.circle,k=S.seenUids,U=this.boxCells[v];if(U!==null){const H=this.bboxes;for(const $ of U)if(!k.box[$]){k.box[$]=!0;const W=4*$;if(this._circleAndRectCollide(O.x,O.y,O.radius,H[W+0],H[W+1],H[W+2],H[W+3])&&(!R||R(this.boxKeys[$])))return T.push(!0),!0}}const F=this.circleCells[v];if(F!==null){const H=this.circles;for(const $ of F)if(!k.circle[$]){k.circle[$]=!0;const W=3*$;if(this._circlesCollide(H[W],H[W+1],H[W+2],O.x,O.y,O.radius)&&(!R||R(this.circleKeys[$])))return T.push(!0),!0}}}_forEachCell(t,o,d,y,v,T,S,R){const O=this._convertToXCellCoord(t),k=this._convertToYCellCoord(o),U=this._convertToXCellCoord(d),F=this._convertToYCellCoord(y);for(let H=O;H<=U;H++)for(let $=k;$<=F;$++)if(v.call(this,t,o,d,y,this.xCellCount*$+H,T,S,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,d,y,v,T){const S=y-t,R=v-o,O=d+T;return O*O>S*S+R*R}_circleAndRectCollide(t,o,d,y,v,T,S){const R=(T-y)/2,O=Math.abs(t-(y+R));if(O>R+d)return!1;const k=(S-v)/2,U=Math.abs(o-(v+k));if(U>k+d)return!1;if(O<=R||U<=k)return!0;const F=O-R,H=U-k;return F*F+H*H<=d*d}}const ra={unknown:0,flipRequired:1,flipNotRequired:2},Nl=Math.tan(85*Math.PI/180);function sa(f,t,o,d,y,v,T){const S=s.bC();if(o)if(v.name==="globe"){const R=s.bD(y,t);s.aB(S,S,R)}else{const R=s.bE([],T);S[0]=R[0],S[1]=R[1],S[4]=R[2],S[5]=R[3],d||s.bB(S,S,y.angle)}else s.aB(S,y.labelPlaneMatrix,f);return S}function ol(f,t,o,d,y,v,T){const S=sa(f,t,o,d,y,v,T);return v.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function qc(f,t,o,d,y,v,T){if(o){if(v.name==="globe"){const S=sa(f,t,o,d,y,v,T);return s.bl(S,S),s.aB(S,f,S),S}{const S=s.bz(f),R=s.bA([]);return R[0]=T[0],R[1]=T[1],R[4]=T[2],R[5]=T[3],s.aB(S,S,R),d||s.bB(S,S,-y.angle),S}}return y.glCoordMatrix}function Ps(f,t,o,d){const y=[f,t,o,1];o?s.aC(y,y,d):rd(y,y,d);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function al(f,t){return Math.min(.5+f/t*.5,1.5)}function So(f,t){const o=f[0]/f[3],d=f[1]/f[3];return o>=-t[0]&&o<=t[0]&&d>=-t[1]&&d<=t[1]}function Hc(f,t,o,d,y,v,T,S,R,O){const k=o.transform,U=d?f.textSizeData:f.iconSizeData,F=s.bK(U,o.transform.zoom),H=k.projection.name==="globe",$=[256/o.width*2+1,256/o.height*2+1],W=d?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;W.clear();let ie=null;H&&(ie=d?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const X=f.lineVertexArray,re=d?f.text.placedSymbolArray:f.icon.placedSymbolArray,ue=o.transform.width/o.transform.height;let de,be=!1;for(let ye=0;ye<re.length;ye++){const ve=re.get(ye),{numGlyphs:ge,writingMode:_e}=ve;if(_e!==s.bL.vertical||be||de===s.bL.horizontal||(be=!0),de=_e,(ve.hidden||_e===s.bL.vertical)&&!be){Ii(ge,W);continue}be=!1;const xe=new s.P(ve.tileAnchorX,ve.tileAnchorY);let{x:Ze,y:Oe,z:ot}=k.projection.projectTilePoint(xe.x,xe.y,O.canonical);if(R){const[Tt,_i,li]=R(xe);Ze+=Tt,Oe+=_i,ot+=li}const qe=[Ze,Oe,ot,1];if(s.aC(qe,qe,t),!So(qe,$)){Ii(ge,W);continue}const nt=qe[3],zt=al(o.transform.getCameraToCenterDistance(k.projection),nt),He=s.bM(U,F,ve),Pe=T?He/zt:He*zt,lt=Ps(Ze,Oe,ot,y);if(lt[3]<=0){Ii(ge,W);continue}let Ke={};const yt=s.an(f.layers[0].layout.get("text-max-angle")),Rt=Math.cos(yt),Yt=T?null:R,Mt=In(ve,Pe,!1,S,t,y,v,f.glyphOffsetArray,X,W,ie,lt,xe,Ke,ue,Yt,k.projection,O,T,Rt);be=Mt.useVertical,Yt&&Mt.needsFlipping&&(Ke={}),(Mt.notEnoughRoom||be||Mt.needsFlipping&&In(ve,Pe,!0,S,t,y,v,f.glyphOffsetArray,X,W,ie,lt,xe,Ke,ue,Yt,k.projection,O,T,Rt).notEnoughRoom)&&Ii(ge,W)}d?(f.text.dynamicLayoutVertexBuffer.updateData(W),ie&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ie)):(f.icon.dynamicLayoutVertexBuffer.updateData(W),ie&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ie))}function oh(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie){const{lineStartIndex:X,glyphStartIndex:re,segment:ue}=S,de=re+S.numGlyphs,be=X+S.lineLength,ye=t.getoffsetX(re),ve=t.getoffsetX(de-1),ge=Wc(f*ye,o,d,y,v,T,ue,X,be,R,O,k,U,F,!0,H,$,W,ie);if(!ge)return null;const _e=Wc(f*ve,o,d,y,v,T,ue,X,be,R,O,k,U,F,!0,H,$,W,ie);return _e?{first:ge,last:_e}:null}function nd(f,t,o,d){return f===s.bL.horizontal&&Math.abs(d)>Math.abs(o)?{useVertical:!0}:f===s.bL.vertical?d>0?{needsFlipping:!0}:null:t!==ra.unknown&&(function(y,v){return y===0||Math.abs(v/y)>Nl})(o,d)?t===ra.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function In(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re,ue){const de=t/24,be=f.lineOffsetX*de,ye=f.lineOffsetY*de,{lineStartIndex:ve,glyphStartIndex:ge,numGlyphs:_e,segment:xe,writingMode:Ze,flipState:Oe}=f,ot=ve+f.lineLength,qe=nt=>{if(k){const[lt,Ke,yt]=nt.up,Rt=O.length;s.bN(k,Rt+0,lt,Ke,yt),s.bN(k,Rt+1,lt,Ke,yt),s.bN(k,Rt+2,lt,Ke,yt),s.bN(k,Rt+3,lt,Ke,yt)}const[zt,He,Pe]=nt.point;s.bO(O,zt,He,Pe,nt.angle)};if(_e>1){const nt=oh(de,S,be,ye,o,U,F,f,R,v,H,W,!1,ie,X,re,ue);if(!nt)return{notEnoughRoom:!0};if(d&&!o){let[zt,He,Pe]=nt.first.point,[lt,Ke,yt]=nt.last.point;[zt,He]=Ps(zt,He,Pe,T),[lt,Ke]=Ps(lt,Ke,yt,T);const Rt=nd(Ze,Oe,(lt-zt)*$,Ke-He);if(f.flipState=Rt&&Rt.needsFlipping?ra.flipRequired:ra.flipNotRequired,Rt)return Rt}qe(nt.first);for(let zt=ge+1;zt<ge+_e-1;zt++){const He=Wc(de*S.getoffsetX(zt),be,ye,o,U,F,xe,ve,ot,R,v,H,W,!1,!1,ie,X,re,ue);if(!He)return O.length-=4*(zt-ge),{notEnoughRoom:!0};qe(He)}qe(nt.last)}else{if(d&&!o){const zt=Ps(F.x,F.y,0,y),He=ve+xe+1,Pe=new s.P(R.getx(He),R.gety(He)),lt=Ps(Pe.x,Pe.y,0,y),Ke=lt[3]>0?lt:_f(F,Pe,zt,1,y,void 0,ie,X.canonical),yt=nd(Ze,Oe,(Ke[0]-zt[0])*$,Ke[1]-zt[1]);if(f.flipState=yt&&yt.needsFlipping?ra.flipRequired:ra.flipNotRequired,yt)return yt}const nt=Wc(de*S.getoffsetX(ge),be,ye,o,U,F,xe,ve,ot,R,v,H,W,!1,!1,ie,X,re,ue);if(!nt)return{notEnoughRoom:!0};qe(nt)}return{}}function ah(f,t,o,d,y){const{x:v,y:T,z:S}=d.projectTilePoint(f.x,f.y,t);if(!y)return Ps(v,T,S,o);const[R,O,k]=y(f);return Ps(v+R,T+O,S+k,o)}function _f(f,t,o,d,y,v,T,S){const R=ah(f.sub(t)._unit()._add(f),S,y,T,v);return s.av(R,o,R),s.aw(R,R),s.bH(R,o,R,d)}function Wc(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re){const ue=d?f-t:f+t;let de=ue>0?1:-1,be=0;d&&(de*=-1,be=Math.PI),de<0&&(be+=Math.PI);let ye=S+T+(de>0?0:1)|0,ve=y,ge=y,_e=0,xe=0;const Ze=Math.abs(ue),Oe=[],ot=[];let qe=v,nt=qe,zt=s.bF([]);const He=()=>_f(nt,qe,ge,Ze-_e+1,k,F,W,ie.canonical);for(;_e+xe<=Ze;){if(ye+=de,ye<S||ye>=R)return null;if(ge=ve,nt=qe,Oe.push(ge),H&&ot.push(nt),qe=new s.P(O.getx(ye),O.gety(ye)),ve=U[ye],!ve){const li=ah(qe,ie.canonical,k,W,F);ve=li[3]>0?U[ye]=li:He()}_e+=xe;const Tt=s.av([],ve,ge),_i=s.bG(ge,ve);if(o&&_i>0&&xe>0&&s.bJ(zt,Tt)/(xe*_i)<re)return null;xe=_i,zt=Tt}$&&F&&(U[ye]&&(ve=He(),xe=s.bG(ge,ve),zt=s.av([],ve,ge)),U[ye]=ve);const Pe=(Ze-_e)/xe,lt=qe.sub(nt)._mult(Pe)._add(nt),Ke=s.bH([],ge,zt,Pe);let yt=[0,0,1],Rt=zt[0],Yt=zt[1];if(X&&(yt=W.upVector(ie.canonical,lt.x,lt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const Tt=[yt[2],0,-yt[0]],_i=s.bI([],yt,Tt);s.aw(Tt,Tt),s.aw(_i,_i),Rt=s.bJ(zt,Tt),Yt=s.bJ(zt,_i)}if(o){const Tt=s.bI([],yt,zt);s.aw(Tt,Tt),s.bH(Ke,Ke,Tt,o*de)}const Mt=be+Math.atan2(Yt,Rt);return Oe.push(Ke),H&&ot.push(lt),{point:Ke,angle:Mt,path:Oe,tilePath:ot,up:yt}}function Ii(f,t){const o=t.length,d=o+4*f;t.resize(d),t.float32.fill(-1/0,4*o,4*d)}function rd(f,t,o){const d=t[0],y=t[1];return f[0]=o[0]*d+o[4]*y+o[12],f[1]=o[1]*d+o[5]*y+o[13],f[3]=o[3]*d+o[7]*y+o[15],f}const Ds=100;class Ea{constructor(t,o,d=new kl(t.width+200,t.height+200,25),y=new kl(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ds,this.screenBottomBoundary=t.height+Ds,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,d,y,v,T,S,R,O,k,U){let F=d.projectedAnchorX,H=d.projectedAnchorY,$=d.projectedAnchorZ;const W=d.tileAnchorX,ie=d.tileAnchorY,X=d.elevation,re=d.tileID,ue=t.getProjection();if(X&&re){const[ot,qe,nt]=ue.upVector(re.canonical,d.tileAnchorX,d.tileAnchorY),zt=ue.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ot*X*zt,H+=qe*X*zt,$+=nt*X*zt}const de=t.projection.name==="globe",be=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(re&&de&&be<1&&!T){const ot=1<<re.canonical.z,qe=s.bP(W,ie);s.bQ(qe,qe,1/s.al),s.bR(qe,qe,s.bP(re.canonical.x,re.canonical.y)),s.bQ(qe,qe,1/ot),s.bS(qe,qe,s.bP(y[0],y[1])),qe[0]=s.bT(qe[0],-.5,.5),s.bQ(qe,qe,s.al);const nt=s.bU(qe[0],qe[1],s.al/(2*Math.PI),1);s.aC(nt,nt,v),F=s.ak(F,nt[0],be),H=s.ak(H,nt[1],be),$=s.ak($,nt[2],be)}const ye=this.projectAndGetPerspectiveRatio(k,F,H,$,d.tileID,ue.name==="globe"||!!X||this.transform.pitch>0,ue),ve=O*ye.perspectiveRatio,ge=(d.x1*o+S.x-d.padding)*ve+ye.point.x,_e=(d.y1*o+S.y-d.padding)*ve+ye.point.y,xe=(d.x2*o+S.x+d.padding)*ve+ye.point.x,Ze=(d.y2*o+S.y+d.padding)*ve+ye.point.y,Oe=ye.perspectiveRatio<=.55||ye.occluded;return!this.isInsideGrid(ge,_e,xe,Ze)||!R&&this.grid.hitTest(ge,_e,xe,Ze,U)||Oe?{box:[],offscreen:!1,occluded:ye.occluded}:{box:[ge,_e,xe,Ze],offscreen:this.isOffscreen(ge,_e,xe,Ze),occluded:!1}}placeCollisionCircles(t,o,d,y,v,T,S,R,O,k,U,F,H,$,W){const ie=[],X=this.transform.elevation,re=t.getProjection(),ue=X?X.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,re):null,de=new s.P(d.tileAnchorX,d.tileAnchorY);let{x:be,y:ye,z:ve}=re.projectTilePoint(de.x,de.y,W.canonical);if(ue){const[yt,Rt,Yt]=ue(de);be+=yt,ye+=Rt,ve+=Yt}const ge=re.name==="globe",_e=this.projectAndGetPerspectiveRatio(S,be,ye,ve,W,ge||!!X||this.transform.pitch>0,re),{perspectiveRatio:xe}=_e,Ze=(U?T/xe:T*xe)/s.bX,Oe=Ps(be,ye,ve,R),ot=d.lineOffsetX*Ze,qe=d.lineOffsetY*Ze,nt=s.an(t.layers[0].layout.get("text-max-angle")),zt=Math.cos(nt),He=_e.signedDistanceFromCamera>0?oh(Ze,v,ot,qe,!1,Oe,de,d,y,R,{},X&&!U?ue:null,U&&!!X,re,W,U,zt):null;let Pe=!1,lt=!1,Ke=!0;if(He&&!_e.occluded){const yt=.5*H*xe+$,Rt=new s.P(-100,-100),Yt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Mt=new ho,{first:Tt,last:_i}=He,li=Tt.path.length;let fi=[];for(let bi=li-1;bi>=1;bi--)fi.push(Tt.path[bi]);for(let bi=1;bi<_i.path.length;bi++)fi.push(_i.path[bi]);const ci=2.5*yt;O&&(fi=fi.map((([bi,Ei,Ni],ui)=>(ue&&!ge&&(Ni=ue(ui<li-1?Tt.tilePath[li-1-ui]:_i.tilePath[ui-li+2])[2]),Ps(bi,Ei,Ni,O)))),fi.some((bi=>bi[3]<=0))&&(fi=[]));let Fi=[];if(fi.length>0){let bi=1/0,Ei=-1/0,Ni=1/0,ui=-1/0;for(const Vi of fi)bi=Math.min(bi,Vi[0]),Ni=Math.min(Ni,Vi[1]),Ei=Math.max(Ei,Vi[0]),ui=Math.max(ui,Vi[1]);Ei>=Rt.x&&bi<=Yt.x&&ui>=Rt.y&&Ni<=Yt.y&&(Fi=[fi.map((Vi=>new s.P(Vi[0],Vi[1])))],(bi<Rt.x||Ei>Yt.x||Ni<Rt.y||ui>Yt.y)&&(Fi=s.bV(Fi,Rt.x,Rt.y,Yt.x,Yt.y)))}for(const bi of Fi){Mt.reset(bi,.25*yt);let Ei=0;Ei=Mt.length<=.5*yt?1:Math.ceil(Mt.paddedLength/ci)+1;for(let Ni=0;Ni<Ei;Ni++){const ui=Ni/Math.max(Ei-1,1),Vi=Mt.lerp(ui),_n=Vi.x+Ds,qn=Vi.y+Ds;ie.push(_n,qn,yt,0);const Gi=_n-yt,Mn=qn-yt,xn=_n+yt,Qi=qn+yt;if(Ke=Ke&&this.isOffscreen(Gi,Mn,xn,Qi),lt=lt||this.isInsideGrid(Gi,Mn,xn,Qi),!o&&this.grid.hitTestCircle(_n,qn,yt,F)&&(Pe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!k&&Pe||!lt?[]:ie,offscreen:Ke,collisionDetected:Pe,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let d=1/0,y=1/0,v=-1/0,T=-1/0;for(const k of t){const U=new s.P(k.x+Ds,k.y+Ds);d=Math.min(d,U.x),y=Math.min(y,U.y),v=Math.max(v,U.x),T=Math.max(T,U.y),o.push(U)}const S=this.grid.query(d,y,v,T).concat(this.ignoredGrid.query(d,y,v,T)),R={},O={};for(const k of S){const U=k.key;if(R[U.bucketInstanceId]===void 0&&(R[U.bucketInstanceId]={}),R[U.bucketInstanceId][U.featureIndex])continue;const F=[new s.P(k.x1,k.y1),new s.P(k.x2,k.y1),new s.P(k.x2,k.y2),new s.P(k.x1,k.y2)];s.bW(o,F)&&(R[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(t,o,d,y,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,d,y,v){const T=o?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:y,collisionGroupID:v};for(let R=0;R<t.length;R+=4)T.insertCircle(S,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,o,d,y,v,T,S){const R=[o,d,y,1];let O=!1;y||this.transform.pitch>0?(s.aC(R,R,t),this.fogState&&v&&S.name!=="globe"&&(O=(function(F,H,$,W,ie,X){const re=X.calculateFogTileMatrix(ie),ue=[H,$,W];return s.af(ue,ue,re),Mi(F,s.ag(ue),X.pitch,X._fov)})(this.fogState,o,d,y,v.toUnwrapped(),this.transform)>.9)):rd(R,R,t);const k=R[3];return{point:new s.P((R[0]/k+1)/2*this.transform.width+Ds,(-R[1]/k+1)/2*this.transform.height+Ds),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/k*.5,1.5),signedDistanceFromCamera:k,occluded:T&&R[2]>k||O}}isOffscreen(t,o,d,y){return d<Ds||t>=this.screenRightBoundary||y<Ds||o>this.screenBottomBoundary}isInsideGrid(t,o,d,y){return d>=0&&t<this.gridRightBoundary&&y>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=s.bA([]);return s.br(t,t,[-100,-100,0]),t}}class lh{constructor(t,o,d,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Da{constructor(t,o,d,y,v,T=!1){this.text=new lh(t?t.text:null,o,d,v),this.icon=new lh(t?t.icon:null,o,y,v),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gi{constructor(t,o,d,y=!1){this.text=t,this.icon=o,this.skipFade=d,this.clipped=y}}class Sn{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class gn{constructor(t,o,d,y,v){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=v}}class Ao{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[t]}}function pc(f,t,o,d,y){const{horizontalAlign:v,verticalAlign:T}=s.c0(f),S=-(v-.5)*t,R=-(T-.5)*o,O=s.c1(f,d);return new s.P(S+O[0]*y,R+O[1]*y)}function wn(f,t,o,d,y){const v=new s.P(f,t);return o&&v._rotate(d?y:-y),v}class z{constructor(t,o,d,y,v,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Ea(this.transform,v),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ao(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,d,y,v=1){const T=d.getBucket(o),S=d.latestFeatureIndex;if(!T||!S||o.fqid!==T.layerIds[0])return;const R=T.layers[0].layout,O=T.layers[0].paint,k=d.collisionBoxArray,U=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),F=d.tileSize/s.al,H=d.tileID.toUnwrapped();this.transform.setProjection(T.projection);const $=(W=d.tileID,ie=T.getProjection(),X=this.transform,ie.name===this.projection?X.calculateProjMatrix(W.toUnwrapped()):dc(X,ie,W));var W,ie,X;const re=R.get("text-pitch-alignment")==="map",ue=R.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const de=o.dynamicFilter(),be=o.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(d),ve=ol($,d.tileID.canonical,re,ue,this.transform,T.getProjection(),ye);let ge=null;const _e=T.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(re){const Pe=qc($,d.tileID.canonical,re,ue,this.transform,T.getProjection(),ye);ge=s.aB([],this.transform.labelPlaneMatrix,Pe)}let xe=null;de&&d.latestFeatureIndex&&(xe={unwrappedTileID:H,dynamicFilter:de,dynamicFilterNeedsFeature:be}),this.retainedQueryData[T.bucketInstanceId]=new gn(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,d.tileID);const[Ze,Oe]=T.layers[0].layout.get("text-size-scale-range"),ot=s.aA(v,Ze,Oe),[qe,nt]=R.get("icon-size-scale-range"),zt=s.aA(v,qe,nt),He={bucket:T,layout:R,paint:O,posMatrix:$,invMatrix:_e,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:ge,clippingData:xe,scale:U,textPixelRatio:F,holdingForFade:d.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:s.bK(T.textSizeData,this.transform.zoom,ot),partiallyEvaluatedIconSize:s.bK(T.iconSizeData,this.transform.zoom,zt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const Pe of T.sortKeyRanges){const{sortKey:lt,symbolInstanceStart:Ke,symbolInstanceEnd:yt}=Pe;t.push({sortKey:lt,symbolInstanceStart:Ke,symbolInstanceEnd:yt,parameters:He})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:He})}attemptAnchorPlacement(t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re,ue,de,be){const{textOffset0:ye,textOffset1:ve,crossTileID:ge}=W,_e=[ye,ve],xe=pc(t,T,S,_e,R),Ze=this.collisionIndex.placeCollisionBox(X,R,o,d,y,v,wn(xe.x,xe.y,O,k,this.transform.angle),$,U,F,H.predicate);if(ue){const Oe=X.getSymbolInstanceIconSize(be,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,Oe,ue,d,y,v,wn(xe.x,xe.y,O,k,this.transform.angle),$,U,F,H.predicate).box.length===0)return}if(Ze.box.length>0){let Oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(Oe=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:_e,width:T,height:S,anchor:t,textScale:R,prevAnchor:Oe},this.markUsedJustification(X,t,W,re),X.allowVerticalPlacement&&(this.markUsedOrientation(X,re,W),this.placedOrientations[ge]=re),{shift:xe,placedGlyphBoxes:Ze}}}placeLayerBucketPart(t,o,d,y,v=1){const{bucket:T,layout:S,paint:R,posMatrix:O,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:F,textPixelRatio:H,mercatorCenter:$,invMatrix:W,holdingForFade:ie,collisionBoxArray:X,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ue,collisionGroup:de,latestFeatureIndex:be}=t.parameters,ye=S.get("text-optional"),ve=S.get("icon-optional"),ge=S.get("text-allow-overlap"),_e=S.get("icon-allow-overlap"),xe=S.get("text-rotation-alignment")==="map",Ze=S.get("icon-rotation-alignment")==="map",Oe=S.get("text-pitch-alignment")==="map",ot=R.get("symbol-z-offset"),qe=S.get("symbol-elevation-reference")==="sea",nt=S.get("symbol-placement"),[zt,He]=S.get("text-size-scale-range"),[Pe,lt]=S.get("icon-size-scale-range"),Ke=s.aA(v,zt,He),yt=s.aA(v,Pe,lt),Rt=S.get("text-variable-anchor"),Yt=xe&&nt!=="point",Mt=Ze&&nt!=="point",Tt=Rt&&T.hasTextData(),_i=T.hasIconTextFit()&&Tt&&T.hasIconData();this.transform.setProjection(T.projection);const li=Tt||Yt,fi=Mt||_i;let ci=ge&&(_e||!T.hasIconData()||ve),Fi=_e&&(ge||!T.hasTextData()||ye);const bi=!ot.isConstant();!T.collisionArrays&&X&&T.deserializeCollisionBoxes(X),d&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,X,Ke,yt);const Ei=(ui,Vi,_n)=>{const{crossTileID:qn,numVerticalGlyphVertices:Gi}=ui;let Mn=null;if(F&&F.dynamicFilterNeedsFeature||bi){const zr=this.retainedQueryData[T.bucketInstanceId];Mn=be.loadFeature({featureIndex:ui.featureIndex,bucketIndex:zr.bucketIndex,sourceLayerIndex:zr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Mn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(ui.tileAnchorX,ui.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[qn]=new gi(!1,!1,!1,!0),void o.add(qn);const xn=ot.evaluate(Mn,{});if(o.has(qn))return;if(ie)return void(this.placements[qn]=new gi(!1,!1,!1));let Qi=!1,$n=!1,vr=!0,ws=!1,zn=!1,qi=null,Ci={box:null,offscreen:null,occluded:null},yn={box:null},Mr=null,fr=null,as=null,As=0,Wo=0,Js=0;_n.textFeatureIndex?As=_n.textFeatureIndex:ui.useRuntimeCollisionCircles&&(As=ui.featureIndex),_n.verticalTextFeatureIndex&&(Wo=_n.verticalTextFeatureIndex);const Lr=zr=>{zr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const $r=this.transform.elevation;zr.elevation=qe?xn:xn+($r?$r.getAtTileOffset(zr.tileID,zr.tileAnchorX,zr.tileAnchorY):0),zr.elevation+=ui.zOffset},qs=_n.textBox;if(qs){Lr(qs);const zr=cr=>{let cs=s.bL.horizontal;if(T.allowVerticalPlacement&&!cr&&this.prevPlacement){const Sr=this.prevPlacement.placedOrientations[qn];Sr&&(this.placedOrientations[qn]=Sr,cs=Sr,this.markUsedOrientation(T,cs,ui))}return cs},$r=(cr,cs)=>{if(T.allowVerticalPlacement&&Gi>0&&_n.verticalTextBox){for(const Sr of T.writingModes)if(Sr===s.bL.vertical?(Ci=cs(),yn=Ci):Ci=cr(),Ci&&Ci.box&&Ci.box.length)break}else Ci=cr()};if(Rt){let cr=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[qn]){const is=this.prevPlacement.variableOffsets[qn];cr.indexOf(is.anchor)>0&&(cr=cr.filter((Vr=>Vr!==is.anchor)),cr.unshift(is.anchor))}const cs=(is,Vr,Kl)=>{const Pc=T.getSymbolInstanceTextSize(re,ui,this.transform.zoom,Vi),Ql=(is.x2-is.x1)*Pc+2*is.padding,fa=(is.y2-is.y1)*Pc+2*is.padding,Jl=ui.hasIconTextFit&&!_e?Vr:null;Jl&&Lr(Jl);let _l={box:[],offscreen:!1,occluded:!1};const ec=ge?2*cr.length:cr.length;for(let Dc=0;Dc<ec;++Dc){const tc=this.attemptAnchorPlacement(cr[Dc%cr.length],is,$,W,li,Ql,fa,Pc,xe,Oe,H,O,de,Dc>=cr.length,ui,Vi,T,Kl,Jl,re,ue);if(tc&&(_l=tc.placedGlyphBoxes,_l&&_l.box&&_l.box.length)){Qi=!0,qi=tc.shift;break}}return _l};$r((()=>cs(qs,_n.iconBox,s.bL.horizontal)),(()=>{const is=_n.verticalTextBox;return is&&Lr(is),T.allowVerticalPlacement&&!(Ci&&Ci.box&&Ci.box.length)&&Gi>0&&is?cs(is,_n.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}})),Ci&&(Qi=Ci.box,vr=Ci.offscreen,ws=Ci.occluded);const Sr=zr(!(!Ci||!Ci.box));if(!Qi&&this.prevPlacement){const is=this.prevPlacement.variableOffsets[qn];is&&(this.variableOffsets[qn]=is,this.markUsedJustification(T,is.anchor,ui,Sr))}}else{const cr=(cs,Sr)=>{const is=T.getSymbolInstanceTextSize(re,ui,this.transform.zoom,Vi),Vr=this.collisionIndex.placeCollisionBox(T,is,cs,$,W,li,new s.P(0,0),ge,H,O,de.predicate);return Vr&&Vr.box&&Vr.box.length&&(this.markUsedOrientation(T,Sr,ui),this.placedOrientations[qn]=Sr),Vr};$r((()=>cr(qs,s.bL.horizontal)),(()=>{const cs=_n.verticalTextBox;return T.allowVerticalPlacement&&Gi>0&&cs?(Lr(cs),cr(cs,s.bL.vertical)):{box:null,offscreen:null,occluded:null}})),zr(!!(Ci&&Ci.box&&Ci.box.length))}}if(Mr=Ci,Qi=Mr&&Mr.box&&Mr.box.length>0,vr=Mr&&Mr.offscreen,ws=Mr&&Mr.occluded,ui.useRuntimeCollisionCircles){const zr=T.text.placedSymbolArray.get(ui.centerJustifiedTextSymbolIndex>=0?ui.centerJustifiedTextSymbolIndex:ui.verticalPlacedTextSymbolIndex),$r=s.bM(T.textSizeData,re,zr),cr=S.get("text-padding");fr=this.collisionIndex.placeCollisionCircles(T,ge,zr,T.lineVertexArray,T.glyphOffsetArray,$r,O,k,U,d,Oe,de.predicate,ui.collisionCircleDiameter*$r/s.bX,cr,this.retainedQueryData[T.bucketInstanceId].tileID),Qi=ge||fr.circles.length>0&&!fr.collisionDetected,vr=vr&&fr.offscreen,ws=fr.occluded}if(_n.iconFeatureIndex&&(Js=_n.iconFeatureIndex),_n.iconBox){const zr=$r=>{Lr($r);const cr=ui.hasIconTextFit&&qi?wn(qi.x,qi.y,xe,Oe,this.transform.angle):new s.P(0,0),cs=T.getSymbolInstanceIconSize(ue,this.transform.zoom,ui.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,cs,$r,$,W,fi,cr,_e,H,O,de.predicate)};yn&&yn.box&&yn.box.length&&_n.verticalIconBox?(as=zr(_n.verticalIconBox),$n=as.box.length>0):(as=zr(_n.iconBox),$n=as.box.length>0),vr=vr&&as.offscreen,zn=as.occluded}const Hs=ye||ui.numHorizontalGlyphVertices===0&&Gi===0,eo=ve||ui.numIconVertices===0;if(Hs||eo?eo?Hs||($n=$n&&Qi):Qi=$n&&Qi:$n=Qi=$n&&Qi,Qi&&Mr&&Mr.box&&this.collisionIndex.insertCollisionBox(Mr.box,S.get("text-ignore-placement"),T.bucketInstanceId,yn&&yn.box&&Wo?Wo:As,de.ID),$n&&as&&this.collisionIndex.insertCollisionBox(as.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Js,de.ID),fr&&(Qi&&this.collisionIndex.insertCollisionCircles(fr.circles,S.get("text-ignore-placement"),T.bucketInstanceId,As,de.ID),d)){const zr=T.bucketInstanceId;let $r=this.collisionCircleArrays[zr];$r===void 0&&($r=this.collisionCircleArrays[zr]=new Sn);for(let cr=0;cr<fr.circles.length;cr+=4)$r.circles.push(fr.circles[cr+0]),$r.circles.push(fr.circles[cr+1]),$r.circles.push(fr.circles[cr+2]),$r.circles.push(fr.collisionDetected?1:0)}const Ga=T.projection.name!=="globe";ci=ci&&(Ga||!ws),Fi=Fi&&(Ga||!zn),this.placements[qn]=new gi(Qi||ci,$n||Fi,vr||T.justReloaded),o.add(qn)},Ni=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Ni),T.elevationType==="road"&&T.updateRoadElevation(Ni.canonical),T.updateZOffset(),T.sortFeaturesByY){const ui=T.getSortedSymbolIndexes(this.transform.angle);for(let Vi=ui.length-1;Vi>=0;--Vi){const _n=ui[Vi];Ei(T.symbolInstances.get(_n),_n,T.collisionArrays[_n])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const ui=T.getSortedIndexesByZOffset();for(let Vi=0;Vi<ui.length;++Vi){const _n=ui[Vi];Ei(T.symbolInstances.get(_n),_n,T.collisionArrays[_n])}}else for(let ui=t.symbolInstanceStart;ui<t.symbolInstanceEnd;ui++)Ei(T.symbolInstances.get(ui),ui,T.collisionArrays[ui]);if(d&&T.bucketInstanceId in this.collisionCircleArrays){const ui=this.collisionCircleArrays[T.bucketInstanceId];s.bl(ui.invProjMatrix,O),ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,o,d,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:R,crossTileID:O}=d,k=s.c2(o),U=y===s.bL.vertical?R:k==="left"?v:k==="center"?T:k==="right"?S:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=U>=0&&v!==U?0:O),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:O),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:O),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=U>=0&&R!==U?0:O)}markUsedOrientation(t,o,d){const y=o===s.bL.horizontal||o===s.bL.horizontalOnly?o:0,v=o===s.bL.vertical?o:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:O}=d,k=t.text.placedSymbolArray;T>=0&&(k.get(T).placedOrientation=y),S>=0&&(k.get(S).placedOrientation=y),R>=0&&(k.get(R).placedOrientation=y),O>=0&&(k.get(O).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const y=o?o.symbolFadeChange(t):1,v=o?o.opacities:{},T=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const R in this.placements){const O=this.placements[R],k=v[R];k?(this.opacities[R]=new Da(k,y,O.text,O.icon,null,O.clipped),d=d||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[R]=new Da(null,y,O.text,O.icon,O.skipFade,O.clipped),d=d||O.text||O.icon)}for(const R in v){const O=v[R];if(!this.opacities[R]){const k=new Da(O,y,!1,!1);k.isHidden()||(this.opacities[R]=k,d=d||O.text.placed||O.icon.placed)}}for(const R in T)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=T[R]);for(const R in S)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=S[R]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,d,y){const v=new Set;for(const T of o){const S=T.getBucket(t);S&&T.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,v,T,T.collisionBoxArray,d,y,T.tileID,t.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,T.tileID),S.elevationType==="road"&&S.updateRoadElevation(T.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(t,o,d,y,v,T,S,R){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const O=t.layers[0].layout,k=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),F=new Da(null,0,!1,!1,!0),H=O.get("text-allow-overlap"),$=O.get("icon-allow-overlap"),W=O.get("text-variable-anchor"),ie=O.get("text-rotation-alignment")==="map",X=O.get("text-pitch-alignment")==="map",re=k.get("symbol-z-offset"),ue=O.get("symbol-elevation-reference")==="sea",de=!re.isConstant(),be=new Da(null,0,H&&($||!t.hasIconData()||O.get("icon-optional")),$&&(H||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const ye=(ge,_e,xe)=>{for(let Ze=0;Ze<_e/4;Ze++)ge.opacityVertexArray.emplaceBack(xe)};let ve=0;T&&t.updateReplacement(S,T);for(let ge=0;ge<t.symbolInstances.length;ge++){const _e=t.symbolInstances.get(ge),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Ze,crossTileID:Oe,numIconVertices:ot,tileAnchorX:qe,tileAnchorY:nt}=_e;let zt=null;const He=this.retainedQueryData[t.bucketInstanceId];de&&_e&&He&&(zt=d.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:He.bucketIndex,sourceLayerIndex:He.sourceLayerIndex,layoutVertexArrayOffset:0}));const Pe=re.evaluate(zt,{}),lt=o.has(Oe);let Ke=this.opacities[Oe];lt?Ke=F:Ke||(Ke=be,this.opacities[Oe]=Ke),o.add(Oe);const yt=xe>0||Ze>0,Rt=ot>0,Yt=this.placedOrientations[Oe],Mt=Yt===s.bL.vertical,Tt=Yt===s.bL.horizontal||Yt===s.bL.horizontalOnly;!yt&&!Rt||Ke.isHidden()||ve++;let _i=!1;if((yt||Rt)&&T)for(const li of t.activeReplacements){if(s.bY(li,v,s.bZ.Symbol,R)||li.min.x>qe||qe>li.max.x||li.min.y>nt||nt>li.max.y)continue;const fi=s.b_(qe,nt,S.canonical,li.footprintTileId.canonical);if(_i=s.b$(fi,li.footprint),_i)break}if(yt){const li=_i?Br:yr(Ke.text);ye(t.text,xe,Mt?Br:li),ye(t.text,Ze,Tt?Br:li);const fi=Ke.text.isHidden(),{leftJustifiedTextSymbolIndex:ci,centerJustifiedTextSymbolIndex:Fi,rightJustifiedTextSymbolIndex:bi,verticalPlacedTextSymbolIndex:Ei}=_e,Ni=t.text.placedSymbolArray,ui=fi||Mt?1:0;ci>=0&&(Ni.get(ci).hidden=ui),Fi>=0&&(Ni.get(Fi).hidden=ui),bi>=0&&(Ni.get(bi).hidden=ui),Ei>=0&&(Ni.get(Ei).hidden=fi||Tt?1:0);const Vi=this.variableOffsets[Oe];Vi&&this.markUsedJustification(t,Vi.anchor,_e,Yt);const _n=this.placedOrientations[Oe];_n&&(this.markUsedJustification(t,"left",_e,_n),this.markUsedOrientation(t,_n,_e))}if(Rt){const li=_i?Br:yr(Ke.icon),{placedIconSymbolIndex:fi,verticalPlacedIconSymbolIndex:ci}=_e,Fi=t.icon.placedSymbolArray,bi=Ke.icon.isHidden()?1:0;fi>=0&&(ye(t.icon,ot,Mt?Br:li),Fi.get(fi).hidden=bi),ci>=0&&(ye(t.icon,_e.numVerticalIconVertices,Tt?Br:li),Fi.get(ci).hidden=bi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const li=t.collisionArrays[ge];if(li){let fi=new s.P(0,0),ci=!0;if(li.textBox||li.verticalTextBox){if(W){const bi=this.variableOffsets[Oe];bi?(fi=pc(bi.anchor,bi.width,bi.height,bi.textOffset,bi.textScale),ie&&fi._rotate(X?this.transform.angle:-this.transform.angle)):ci=!1}U&&(ci=!Ke.clipped),li.textBox&&ee(t.textCollisionBox.collisionVertexArray,Ke.text.placed,!ci||Mt,Pe,ue,fi.x,fi.y),li.verticalTextBox&&ee(t.textCollisionBox.collisionVertexArray,Ke.text.placed,!ci||Tt,Pe,ue,fi.x,fi.y)}const Fi=ci&&!!(!Tt&&li.verticalIconBox);li.iconBox&&ee(t.iconCollisionBox.collisionVertexArray,Ke.icon.placed,Fi,Pe,ue,_e.hasIconTextFit?fi.x:0,_e.hasIconTextFit?fi.y:0),li.verticalIconBox&&ee(t.iconCollisionBox.collisionVertexArray,Ke.icon.placed,!Fi,Pe,ue,_e.hasIconTextFit?fi.x:0,_e.hasIconTextFit?fi.y:0)}}}if(t.fullyClipped=ve===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ge.invProjMatrix,t.placementViewportMatrix=ge.viewportMatrix,t.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function ee(f,t,o,d,y,v,T){f.emplaceBack(t?1:0,o?1:0,v||0,T||0,d,y?1:0),f.emplaceBack(t?1:0,o?1:0,v||0,T||0,d,y?1:0),f.emplaceBack(t?1:0,o?1:0,v||0,T||0,d,y?1:0),f.emplaceBack(t?1:0,o?1:0,v||0,T||0,d,y?1:0)}const ae=Math.pow(2,25),Ce=Math.pow(2,24),pt=Math.pow(2,17),Gt=Math.pow(2,16),Ri=Math.pow(2,9),Un=Math.pow(2,8),fs=Math.pow(2,1);function yr(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,o=Math.floor(127*f.opacity);return o*ae+t*Ce+o*pt+t*Gt+o*Ri+t*Un+o*fs+t}const Br=0;class oa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,d,y,v,T){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(S,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((R,O)=>R.sortKey-O.sortKey)));this._currentPartIndex<S.length;){const R=S[this._currentPartIndex];if(o.placeLayerBucketPart(R,this._seenCrossTileIDs,d,R.symbolInstanceStart===0,T),this._currentPartIndex++,v())return!0}return!1}}class ps{constructor(t,o,d,y,v,T,S,R,O){this.placement=new z(t,v,T,S,R,O),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,o,d,y,v){const T=s.o.now(),S=()=>{const R=s.o.now()-T;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=o[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=O)&&(!R.maxzoom||R.maxzoom>O)){const k=R,U=k.layout.get("symbol-z-elevate"),F=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=k.layout.get("symbol-z-order"),$=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&F),W=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),ie=$&&W,X=this._inProgressLayer=this._inProgressLayer||new oa(k),re=s.B(R.source,R.scope);if(X.continuePlacement(U||ie?y[re]:d[re],this.placement,this._showCollisionBoxes,R,S,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Us=512/s.al/2;class ms{constructor(t,o,d){this.tileID=t,this.bucketInstanceId=d,this.index=new s.c3(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*s.al,v=t.canonical.y*s.al;for(let T=0;T<o.length;T++){const{key:S,crossTileID:R,tileAnchorX:O,tileAnchorY:k}=o.get(T),U=Math.floor((y+O)*Us),F=Math.floor((v+k)*Us);this.index.add(U,F),this.keys.push(S),this.crossTileIDs.push(R)}this.index.finish()}findMatches(t,o,d){const y=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=Us/Math.pow(2,o.canonical.z-this.tileID.canonical.z),T=o.canonical.x*s.al,S=o.canonical.y*s.al;for(let R=0;R<t.length;R++){const O=t.get(R);if(O.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:F}=O,H=Math.floor((T+U)*v),$=Math.floor((S+F)*v),W=this.index.range(H-y,$-y,H+y,$+y).sort(((ie,X)=>ie-X));for(const ie of W){const X=this.crossTileIDs[ie];if(this.keys[ie]===k&&!d.has(X)){d.add(X),O.crossTileID=X;break}}}}}class Su{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const d in this.indexes){const y=this.indexes[d],v={};for(const T in y){const S=y[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),v[S.tileID.key]=S}this.indexes[d]=v}this.lng=t}addBucket(t,o,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>t.overscaledZ)for(const S in T){const R=T[S];R.tileID.isChildOf(t)&&R.findMatches(o.symbolInstances,t,y)}else{const S=T[t.scaledTo(Number(v)).key];S&&S.findMatches(o.symbolInstances,t,y)}}for(let v=0;v<o.symbolInstances.length;v++){const T=o.symbolInstances.get(v);T.crossTileID||(T.crossTileID=d.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ms(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const d of o.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let o=!1;for(const d in this.indexes){const y=this.indexes[d];for(const v in y)t[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[v]),delete y[v],o=!0)}return o}}class ns{constructor(){this.layerIndexes={},this.crossTileIDs=new Su,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,d,y){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new Fl);let T=!1;const S={};y.name!=="globe"&&v.handleWrapJump(d);for(const R of o){const O=R.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(R.tileID,O,this.crossTileIDs)&&(T=!0),S[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(t){const o={};t.forEach((d=>{o[d]=!0}));for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}const aa=771;class Xi{constructor(t,o,d,y){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=y}}Xi.Replace=[1,0,1,0],Xi.disabled=new Xi(Xi.Replace,s.ao.transparent,[!1,!1,!1,!1]),Xi.unblended=new Xi(Xi.Replace,s.ao.transparent,[!0,!0,!0,!0]),Xi.alphaBlended=new Xi([1,aa,1,aa],s.ao.transparent,[!0,!0,!0,!0]),Xi.alphaBlendedNonPremultiplied=new Xi([770,aa,770,aa],s.ao.transparent,[!0,!0,!0,!0]),Xi.multiply=new Xi([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]);class ei{constructor(t,o,d){this.func=t,this.mask=o,this.range=d}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const sd=7680;class Pi{constructor(t,o,d,y,v,T){this.test=t,this.ref=o,this.mask=d,this.fail=y,this.depthFail=v,this.pass=T}}Pi.disabled=new Pi({func:519,mask:0},0,0,sd,sd,sd);const Bl=1029,mc=2305;class ki{constructor(t,o,d){this.enable=t,this.mode=o,this.frontFace=d}}function od(f,t){const o=s.c9(f,3);s.cb(f,t),s.cf(f,3,o)}function ad(f,t){const o=s.c6([]);return s.c7(o,o,-t),s.c8(o,o,-f),o}function ld(f,t){const o=[f[0],f[1],0],d=[t[0],t[1],0];if(s.ag(o)>=1e-15){const T=s.aw([],o);s.c4(d,T,s.bJ(d,T)),t[0]=d[0],t[1]=d[1]}const y=s.bI([],t,f);if(s.c5(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return ad(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}ki.disabled=new ki(!1,Bl,mc),ki.backCCW=new ki(!0,Bl,mc),ki.backCW=new ki(!0,Bl,2304),ki.frontCW=new ki(!0,1028,2304),ki.frontCCW=new ki(!0,1028,mc);class yf{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=s.bT(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const d=this.position,y=this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0,v=s.ae.fromLngLat(t,y),T=[v.x-d.x,v.y-d.y,v.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=ld(T,o)}setPitchBearing(t,o){this.orientation=ad(s.an(t),s.an(-o))}}class cd{constructor(t,o){this._transform=s.bA([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&s.cf(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c6([]),t&&od(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=ad(t,o),od(this._transform,this._orientation)}forward(){const t=s.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const d=new Float64Array(16);return s.bl(d,this.getWorldToCamera(t,o)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,d){const y=this.position;s.c4(y,y,-t);const v=new Float64Array(16);return s.bq(v,[d,d,d]),s.br(v,v,y),v[10]*=o,v}getWorldToCamera(t,o){const d=new Float64Array(16),y=new Float64Array(4),v=this.position;return s.ca(y,this._orientation),s.c4(v,v,-t),s.cb(d,y),s.br(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=o,d[9]*=o,d[10]*=o,d[11]*=o,d}getCameraToClipPerspective(t,o,d,y){const v=new Float64Array(16);return s.cc(v,t,o,d,y),v}getCameraToClipOrthographic(t,o,d,y,v,T){const S=new Float64Array(16);return s.cd(S,t,o,d,y,v,T),S}getDistanceToElevation(t,o=!1){const d=t===0?0:s.ce(t,o?s.a$(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new cd([...this.position],[...this.orientation])}}const rs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class fp{constructor(t=0,o=0,d=0,y=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=d,this.right=y}interpolate(t,o,d){return o.top!=null&&t.top!=null&&(this.top=s.ak(t.top,o.top,d)),o.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,o.bottom,d)),o.left!=null&&t.left!=null&&(this.left=s.ak(t.left,o.left,d)),o.right!=null&&t.right!=null&&(this.right=s.ak(t.right,o.right,d)),this}getCenter(t,o){const d=s.aA((this.left+t-this.right)/2,0,t),y=s.aA((this.top+o-this.bottom)/2,0,o);return new s.P(d,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new fp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const gc=15;class Bo{constructor(t,o,d,y,v,T,S){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new fp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Bo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<gc}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const d=this.getProjection(),y=!s.by(o,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,v=0;for(let T=0;T<o.length;T++){const S=new s.P(o[T][0]*this.width,d+o[T][1]*(this.height-d)),R=t.pointCoordinate(S);if(!R)continue;const O=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);y+=R[3]*O,v+=O}return v===0?NaN:y/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*o,y=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-d,v);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const y=s.ag(s.av([],this._camera.position,d));return s.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!s.co(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];s.cp(d,this._camera.position)||(this._setCameraPosition(d),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new yf;return o.position=new s.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!s.cq(t))return!1;s.cr(t,t);const o=s.cs([],[0,0,-1],t),d=s.cs([],[0,-1,0],t);if(d[2]<0)return!1;const y=ld(o,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=s.aA(t[2],y/d,y/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,d){this._unmodified=!1,this._edgeInsets.interpolate(t,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new s.ct(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.P(0,0)),y=this.pointCoordinate(new s.P(this.width,0)),v=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),S=Math.floor(Math.min(d.x,y.x,v.x,T.x)),R=Math.floor(Math.max(d.x,y.x,v.x,T.x)),O=1;for(let k=S-O;k<=R+O;k++)k!==0&&o.push(new s.ct(k,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,d){let y=[];const v=d!=null,T=!v;if(T&&this.zoom<o||v&&d[0]===0&&d[1]===0)return y;const S=new Set,R=(k,U,F,H,$)=>{const W=s.cX(U,k,F,H,$);S.has(W)||(y.push(new s.aO(k,U,F,H,$)),S.add(W))};for(let k=0;k<t.length;k++){const U=t[k];if(T&&U.canonical.z!==o)continue;const F=U.canonical,H=U.overscaledZ,$=U.wrap,W=1<<F.z,ie=F.x+1<W,X=F.x>0,re=F.y+1<W,ue=F.y>0,de=U.wrap-(X?0:1),be=U.wrap+(ie?0:1),ye=X?F.x-1:W-1,ve=ie?F.x+1:0;if(v)d[0]<0?(R(H,be,F.z,ve,F.y),d[1]<0&&re&&(R(H,$,F.z,F.x,F.y+1),R(H,be,F.z,ve,F.y+1)),d[1]>0&&ue&&(R(H,$,F.z,F.x,F.y-1),R(H,be,F.z,ve,F.y-1))):d[0]>0?(R(H,de,F.z,ye,F.y),d[1]<0&&re&&(R(H,$,F.z,F.x,F.y+1),R(H,de,F.z,ye,F.y+1)),d[1]>0&&ue&&(R(H,$,F.z,F.x,F.y-1),R(H,de,F.z,ye,F.y-1))):d[1]<0&&re?R(H,$,F.z,F.x,F.y+1):ue&&R(H,$,F.z,F.x,F.y-1);else{const ge=U.visibleQuadrants;1&ge&&(R(H,de,F.z,ye,F.y),ue&&(R(H,$,F.z,F.x,F.y-1),R(H,de,F.z,ye,F.y-1))),2&ge&&(R(H,be,F.z,ve,F.y),ue&&(R(H,$,F.z,F.x,F.y-1),R(H,be,F.z,ve,F.y-1))),4&ge&&(R(H,de,F.z,ye,F.y),re&&(R(H,$,F.z,F.x,F.y+1),R(H,de,F.z,ye,F.y+1))),8&ge&&(R(H,be,F.z,ve,F.y),re&&(R(H,$,F.z,F.x,F.y+1),R(H,be,F.z,ve,F.y+1)))}}const O=[];for(const k of y)y.some((U=>k.isChildOf(U)))||O.push(k);if(y=O.filter((k=>!t.some((U=>!!(k.overscaledZ<o&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))))),T){const k=1<<o,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[k*U.x,k*U.y],H=4,$=H*H;y=y.filter((W=>{const ie=W.canonical.x+.5-F[0],X=W.canonical.y+.5-F[1];return ie*ie+X*X<$}))}return y}extendTileCoverToNearPlane(t,o,d){const y=[],v=new Set;for(const re of t)v.add(re.key);const T=(re,ue,de,be,ye)=>{const ve=s.cX(ue,re,de,be,ye);v.has(ve)||(y.push(new s.aO(re,ue,de,be,ye)),v.add(ve))},S=t.reduce(((re,ue)=>Math.max(re,ue.overscaledZ)),d),R=1<<d,O=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],k=new s.P(0,0),U=new s.P(0,0),F=(re,ue)=>{const de=Math.floor(re[0]),be=Math.floor(re[1]),ye=(re[0]-de)*s.al,ve=(re[1]-be)*s.al,ge=Math.floor(ue[0]),_e=Math.floor(ue[1]),xe=(ue[0]-ge)*s.al,Ze=(ue[1]-_e)*s.al;for(let Oe=-1;Oe<=1;Oe++){const ot=de+Oe;if(!(ot<0||ot>=R)){k.x=ye-Oe*s.al,U.x=xe-(ot-ge)*s.al;for(let qe=-1;qe<=1;qe++){const nt=be+qe;k.y=ve-qe*s.al,U.y=Ze-(nt-_e)*s.al,s.cY(k,U,O)&&T(S,0,d,ot,nt)}}}},H=o.points,$=H[s.cu],W=H[s.cv],ie=this._projectToGround($,H[s.cw]),X=this._projectToGround(W,H[s.cx]);return F($,ie),F(W,X),y}_projectToGround(t,o){return s.cy(s.cz(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t);const d=o,y=this.elevation&&this.elevation.exaggeration(),v=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const S=this.locationCoordinate(this.center),R=this.center.lat,O=1<<o,k=[O*S.x,O*S.y,0],U=this.projection.name==="globe",F=!U,H=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,F),$=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=O*s.ce(1,this.center.lat),ie=this._camera.position[2]/s.ce(1,this.center.lat),X=[O*$.x,O*$.y,ie*(F?1:W)],re=U||y,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),de=this.isLODDisabled(!0)?o:0;let be;if(this._elevation&&t.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const Pe=this._elevation.getMinMaxForVisibleTiles();be=Pe?Pe.max:this._centerAltitude}else be=this._centerAltitude;const ye=t.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.cB(this):1,ge=Pe=>{const Ke=new s.ae(Pe.x+25e-6,Pe.y,Pe.z),yt=new s.ae(Pe.x,Pe.y+25e-6,Pe.z),Rt=Pe.toLngLat(),Yt=Ke.toLngLat(),Mt=yt.toLngLat(),Tt=this.locationCoordinate(Rt),_i=this.locationCoordinate(Yt),li=this.locationCoordinate(Mt),fi=Math.hypot(_i.x-Tt.x,_i.y-Tt.y),ci=Math.hypot(li.x-Tt.x,li.y-Tt.y);return Math.sqrt(fi*ci)*ve/25e-6},_e=Pe=>{const lt=be,Ke=ye;return{aabb:s.cE(this,O,0,0,0,Pe,Ke,lt,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:lt,wrap:Pe,fullyVisible:!1}},xe=[];let Ze=[];const Oe=o,ot=t.reparseOverscaled?d:o,qe=(ie-this._centerAltitude)*W,nt=Pe=>{if(!this._elevation||!Pe.tileID||!T)return;const lt=this._elevation.getMinMaxForTile(Pe.tileID),Ke=Pe.aabb;lt?(Ke.min[2]=lt.min,Ke.max[2]=lt.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(Pe.shouldSplit=He(Pe),Pe.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},zt=(Pe,lt)=>{if(.707*lt<Pe)return 1;const Ke=lt/Pe;return Ke/(1.4144271570014144+(Math.pow(1.1,Ke-1.4144271570014144+1)-1)/(1.1-1)-1)},He=Pe=>{if(Pe.zoom<de)return!0;if(Pe.zoom===Oe)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const lt=Pe.aabb.distanceX(X),Ke=Pe.aabb.distanceY(X);let yt=qe,Rt=1;if(U){yt=Pe.aabb.distanceZ(X);const ci=Math.pow(2,Pe.zoom),Fi=s.a$((Pe.y+1)/ci),bi=s.a$(Pe.y/ci),Ei=Math.min(Math.max(R,Fi),bi),Ni=s.d0(Ei)/s.d0(R);if(Rt=Ei===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ni/this._mercatorScaleRatio),this.zoom<=s.cZ&&Pe.zoom===Oe-1&&Ni>=.9)return!0}else if(v&&(yt=Pe.aabb.distanceZ(X)*W),this.projection.isReprojectedInTileSpace&&d<=5){const ci=Math.pow(2,Pe.zoom),Fi=ge(new s.ae((Pe.x+.5)/ci,(Pe.y+.5)/ci));Rt=Fi>.85?1:Fi}if(!T){const ci=Math.sqrt(lt*lt+Ke*Ke+yt*yt);let Fi=(1<<Oe-Pe.zoom)*ue*Rt;return Fi*=zt(Math.max(yt,qe),ci),ci<Fi}let Yt=Number.MAX_VALUE,Mt=0;const Tt=Pe.aabb.getCorners(),_i=[];for(const ci of Tt){s.av(_i,ci,X),U||(v?_i[2]*=W:_i[2]=qe);const Fi=s.bJ(_i,this._camera.forward());Fi<Yt&&(Yt=Fi,Mt=Math.abs(_i[2]))}let li=(1<<Oe-Pe.zoom)*ue*Rt;if(li*=zt(Math.max(Mt,qe),Yt),Yt<li)return!0;const fi=Pe.aabb.closestPoint(k);return fi[0]===k[0]&&fi[1]===k[1]};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)xe.push(_e(-Pe)),xe.push(_e(Pe));for(xe.push(_e(0));xe.length>0;){const Pe=xe.pop(),lt=Pe.x,Ke=Pe.y;let yt=Pe.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(Pe.y===0||Pe.y===(1<<Pe.zoom)-1);if(!yt){let Yt=re?Pe.aabb.intersects(H):Pe.aabb.intersectsFlat(H);if(Yt===0&&Rt()){const Mt=new s.cC(Pe.zoom,lt,Ke);Yt=s.cD(this,O,Mt,!0).intersects(H)}if(Yt===0)continue;yt=Yt===2}if(Pe.zoom!==Oe&&He(Pe))for(let Yt=0;Yt<4;Yt++){const Mt=(lt<<1)+Yt%2,Tt=(Ke<<1)+(Yt>>1),_i={aabb:T?Pe.aabb.quadrant(Yt):s.cE(this,O,Pe.zoom+1,Mt,Tt,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:Mt,y:Tt,wrap:Pe.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};v&&!U&&(_i.tileID=new s.aO(Pe.zoom+1===Oe?ot:Pe.zoom+1,Pe.wrap,Pe.zoom+1,Mt,Tt),nt(_i)),xe.push(_i)}else{const Yt=Pe.zoom===Oe?ot:Pe.zoom;if(t.minzoom&&t.minzoom>Yt)continue;let Mt=0;if(!yt){let fi=re?Pe.aabb.intersectsPrecise(H):Pe.aabb.intersectsPreciseFlat(H);if(fi===0&&Rt()){const ci=new s.cC(Pe.zoom,lt,Ke);fi=s.cD(this,O,ci,!0).intersectsPrecise(H)}if(fi===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Pe.aabb.center))Mt=15;else for(let ci=0;ci<4;ci++)Pe.aabb.quadrant(ci).intersects(H)!==0&&(Mt|=1<<ci)}const Tt=k[0]-(.5+lt+(Pe.wrap<<Pe.zoom))*(1<<o-Pe.zoom),_i=k[1]-.5-Ke,li=Pe.tileID?Pe.tileID:new s.aO(Yt,Pe.wrap,Pe.zoom,lt,Ke);t.calculateQuadrantVisibility&&(li.visibleQuadrants=Mt),Ze.push({tileID:li,distanceSq:Tt*Tt+_i*_i})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,lt=this.horizonLineFromTop();Ze=Ze.filter((Ke=>{const yt=[0,0,0,1],Rt=[s.al,s.al,0,1],Yt=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());s.aC(yt,yt,Yt),s.aC(Rt,Rt,Yt);const Mt=s.cF([],yt,Rt),Tt=s.cG([],yt,Rt),_i=s.c_(Mt,Tt);if(_i===0)return!0;let li=!1;const fi=this._elevation;if(fi&&_i>Pe&&lt!==0){const ci=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let Fi;t.isTerrainDEM||(Fi=fi.getMinMaxForTile(Ke.tileID)),Fi||(Fi={min:ye,max:be});const bi=s.cH(this.rotation),Ei=[bi[0]*s.al,bi[1]*s.al,Fi.max];s.af(Ei,Ei,ci),li=(1-Ei[1])*this.height*.5<lt}return _i<Pe||li}))}return Ze.sort(((Pe,lt)=>Pe.distanceSq-lt.distanceSq)).map((Pe=>Pe.tileID))}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const o=s.aA(t.lat,-s.cI,s.cI),d=this.projection.project(t.lng,o);return new s.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let d,y;const v=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;d=(o.x-v.x)/S,y=(o.y-v.y)/S}else{const S=this.pointCoordinate(o),R=this.pointCoordinate(v);d=S.x-R.x,y=S.y-R.y}const T=this.locationCoordinate(t);this.setLocation(new s.ae(T.x-d,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const d=o?s.ce(o,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new s.ae(y.x,y.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const d=o??this._centerAltitude,y=[t.x,t.y,0,1],v=[t.x,t.y,1,1];s.aC(y,y,this.pixelMatrixInverse),s.aC(v,v,this.pixelMatrixInverse);const T=v[3];s.cJ(y,y,1/y[3]),s.cJ(v,v,1/T);const S=y[2],R=v[2];return{p0:y,p1:v,t:S===R?0:(d-S)/(R-S)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return s.aC(o,o,this.pixelMatrixInverse),s.aC(d,d,this.pixelMatrixInverse),s.cJ(o,o,1/o[3]),s.cJ(d,d,1/d[3]),o[2]=s.ce(o[2],this._center.lat)*this.worldSize,d[2]=s.ce(d[2],this._center.lat)*this.worldSize,s.cJ(o,o,1/this.worldSize),s.cJ(d,d,1/this.worldSize),new s.ax([o[0],o[1],o[2]],s.aw([],s.av([],d,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:d,t:y}=t,v=s.ce(o[2],this._center.lat),T=s.ce(d[2],this._center.lat);return new s.ae(s.ak(o[0],d[0],y)/this.worldSize,s.ak(o[1],d[1],y)/this.worldSize,s.ak(v,T,y))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new s.ae(d[0],d[1],d[2]);let y=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t,o);const T=.02*v,S=t.clone();for(let R=0;R<10&&v-y>T;R++){S.y=s.ak(y,v,.66);const O=this.projection.pointCoordinate3D(this,S.x,S.y);O?(v=S.y,d=O):y=S.y}return d?new s.ae(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const d=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return s.aC(y,y,this.pixelMatrix),y[3]>0?new s.P(y[0]/y[3],y[1]/y[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new s.P(o,t)),T=this.pointLocation3D(new s.P(y,t)),S=this.pointLocation3D(new s.P(y,d)),R=this.pointLocation3D(new s.P(o,d));let O=Math.min(v.lng,T.lng,S.lng,R.lng),k=Math.max(v.lng,T.lng,S.lng,R.lng),U=Math.min(v.lat,T.lat,S.lat,R.lat),F=Math.max(v.lat,T.lat,S.lat,R.lat);const H=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,W=(ie,X,re,ue,de)=>{const be=(ie+re)/2,ye=(X+ue)/2,ve=new s.P(be,ye),{lng:ge,lat:_e}=this.pointLocation3D(ve),xe=Math.max(0,O-ge,U-_e,ge-k,_e-F);O=Math.min(O,ge),k=Math.max(k,ge),U=Math.min(U,_e),F=Math.max(F,_e),(de<$||xe>H)&&(W(ie,X,be,ye,de+1),W(be,ye,re,ue,de+1))};if(W(o,t,y,t,1),W(y,t,y,d,1),W(y,d,o,d,1),W(o,d,o,t,1),this.projection.name==="globe"){const[ie,X]=s.cL(this);ie?(F=90,k=180,O=-180):X&&(U=-90,k=180,O=-180)}return new s.aI(new s.aR(O,U),new s.aR(k,F))}_getBoundsRectangular(t,o){const{top:d,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,S=new s.P(y,d),R=new s.P(T,d),O=new s.P(T,v),k=new s.P(y,v);let U=this.pointCoordinate(S,t),F=this.pointCoordinate(R,t);const H=this.pointCoordinate(O,o),$=this.pointCoordinate(k,o),W=(ie,X)=>(X.y-ie.y)/(X.x-ie.x);return U.y>1&&F.y>=0?U=new s.ae((1-$.y)/W($,U)+$.x,1):U.y<0&&F.y<=1&&(U=new s.ae(-$.y/W($,U)+$.x,0)),F.y>1&&U.y>=0?F=new s.ae((1-H.y)/W(H,F)+H.x,1):F.y<0&&U.y<=1&&(F=new s.ae(-H.y/W(H,F)+H.x,0)),new s.aI().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce(((d,y)=>{if(y.dem){const v=y.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,d=this._distanceTileDataCache;if(d[o])return d[o];const y=t.canonical,v=1/this.height,T=this.cameraWorldSize,S=T/this.zoomScale(y.z),R=(y.x+Math.pow(2,y.z)*t.wrap)*S,O=y.y*S,k=this.point;k.x*=T/this.worldSize,k.y*=T/this.worldSize;const U=this.angle,F=Math.sin(-U),H=-Math.cos(-U);return d[o]={bearing:[F,H],center:[(k.x-R)*v,(k.y-O)*v],scale:S/s.al*v},d[o]}calculateFogTileMatrix(t){const o=t.key,d=this._fogTileMatrixCache;if(d[o])return d[o];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(y,this.worldToFogMatrix,y),d[o]=new Float32Array(y),d[o]}calculateProjMatrix(t,o=!1,d=!1){const y=t.key;let v;if(v=d?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[y])return v[y];const T=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.aB(T,S,T),v[y]=new Float32Array(T),v[y]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[o])return d[o];const y=s.cM(t,this);return d[o]=y,d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=s.bq([],[t,t,t]);return s.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=s.ce(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(o),y=this._camera.forward(),v=s.ce(1,this._center.lat);d[2]/=v,y[2]/=v,s.aw(y,y);const T=t.raycast(d,y,t.exaggeration());if(T){const S=s.bH([],d,y,T),R=new s.ae(S[0],S[1],s.ce(S[2],s.a$(S[1]))),O=(R.z+s.ag([R.x-d[0],R.y-d[1],R.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,d=s.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),v=o.getAtPointOrZero(new s.ae(...y)),T=this.pixelsPerMeter/this.worldSize*v,S=this._minimumHeightOverTerrain(),R=y[2]-T;if(R<=S)if(R<0||t){const O=this.locationCoordinate(this._center,this._centerAltitude),k=[y[0],y[1],O.z-y[2]],U=s.ag(k);k[2]-=(S-R)/this._pixelsPerMercatorPixel;const F=s.ag(k);if(F===0)return;s.c4(k,k,U/F*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],O.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const F=this.center;return F.lat=s.aA(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(F.lng=s.aA(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const o=this._unmodified,{x:d,y}=this.point;let v=0,T=d,S=y;const R=this.width/2,O=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(y-O<k&&(S=k+O),y+O>U&&(S=U-O),U-k<this.height&&(v=Math.max(v,this.height/(U-k)),S=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,$=this.worldSize/2-(F+H)/2;T=(d+$+this.worldSize)%this.worldSize-$,T-R<F&&(T=F+R),T+R>H&&(T=H-R),H-F<this.width&&(v=Math.max(v,this.width/(H-F)),T=(H+F)/2)}T===d&&S===y||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,S))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const y=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?d:1,T=this._camera.getWorldToCamera(this.worldSize,v);let S;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-t.x/this.width,R[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=_e*this.aspect,Ze=-xe,Oe=-_e;xe-=t.x,Ze-=t.x,_e+=t.y,Oe+=t.y,S=this._camera.getCameraToClipOrthographic(Ze,xe,Oe,_e,this._nearZ,this._farZ),((ot,qe,nt,zt)=>{for(let He=0;He<16;He++)ot[He]=s.ak(qe[He],nt[He],zt)})(S,S,R,s.c$(this.pitch>=gc?1:this.pitch/gc))}else S=R;const O=s.cO([],R,T);let k=s.cO([],S,T);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),xe=s.bA([]);s.br(xe,xe,[_e.x*this.worldSize,_e.y*this.worldSize,0]),s.aB(xe,xe,s.cP(this)),s.br(xe,xe,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),s.aB(k,k,xe),s.aB(O,O,xe),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],k,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=k,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),o){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cO([],_e,T)}else this.expandedFarZProjMatrix=this.projMatrix;const U=s.bl([],S);this.frustumCorners=s.cS.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const F=new Float32Array(16);s.bA(F),s.cR(F,F,[1,-1,1]),s.cT(F,F,this._pitch),s.bB(F,F,this.angle);const H=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(H);const $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+$)/this.height,this.skyboxMatrix=s.aB(F,H,F);const W=this.point,ie=W.x,X=W.y,re=this.width%2/2,ue=this.height%2/2,de=Math.cos(this.angle),be=Math.sin(this.angle),ye=ie-Math.round(ie)+de*re+be*ue,ve=X-Math.round(X)+de*ue+be*re,ge=new Float64Array(k);if(s.br(ge,ge,[ye>.5?ye-1:ye,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=ge,k=s.bC(),s.cR(k,k,[this.width/2,-this.height/2,1]),s.br(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.bC(),s.cR(k,k,[1,-1,1]),s.br(k,k,[-1,-1,0]),s.cR(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},k=s.bl(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(_e,_e,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,o];s.c4(v,v,y),s.c4(d,d,-1),s.cV(d,d,v);const T=s.bC();s.br(T,T,d),s.cR(T,T,v),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,y)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*v,y.y/this.worldSize-d[1]*v,t/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((o-d)/y,1)),this._camera.position=s.bH([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),v=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),S=Math.max((t[2]-v)/Math.cos(d),T),R=this._zoomFromMercatorZ(S);s.bH(t,t,o,S),this._pitch=s.aA(d,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(y,-Math.PI,Math.PI),this._setZoom(s.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,d=s.cK,y=0,v=1/0;for(;d-o>1e-6&&d>o;){const T=o+.5*(d-o),S=this.tileSize*Math.pow(2,T),R=this.getCameraToCenterDistance(this.projection,T,S),O=this.scaleZoom(R/(Math.max(0,t)*this.tileSize)),k=Math.abs(T-O);k<v&&(v=k,y=T),T<O?o=T:d=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const d=Math.min(t.x,o.x),y=Math.max(t.x,o.x),v=Math.min(t.y,o.y),T=Math.max(t.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.P(d,v),new s.P(y,T),new s.P(d,T),new s.P(y,v)],R=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const k of S){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const F=this.rayIntersectionCoordinate(U);if(F.x<R||F.y<0||F.x>O||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,o){const d=s.ag(s.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(d)+o;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([o,d,y],v){const T=[o,d,y,1];s.aC(T,T,v);const S=T[3]=Math.max(T[3],1e-6);return T[0]/=S,T[1]/=S,T[2]/=S,T})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,d=this.worldSize){const y=s.cN(t,o,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,d,y);let T=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(T=s.ak(1,T,s.c$(this.pitch>=gc?1:this.pitch/gc))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Au=(f,t)=>{if(t>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=f.transform,d=Math.max(Math.abs(o._zoom-(f.minCutoffZoom-1)),1),y=o.isLODDisabled(!1)?s.ah(60,45,o.pitch):s.ah(30,15,o.pitch),v=o._farZ-o._nearZ,T=t*o.height,S=((1-(R=y))*o.cameraToCenterDistance+R*(o._farZ+T))*d;var R;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(S-o._nearZ)/v,(S-T-o._nearZ)/v]}}},oo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class t_{constructor(t,o){this.aabb=t,this.lastCascade=o}}class vf{add(t,o){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],o.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],o.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],o.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],o.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],o.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],o.max[2])):this.receivers[t.key]=new t_(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,d){const y=s.d8.fromPoints(t.points);let v=0;for(const T in this.receivers){const S=this.receivers[T];if(!S||!y.intersectsAabb(S.aabb))continue;S.aabb.min=y.closestPoint(S.aabb.min),S.aabb.max=y.closestPoint(S.aabb.max);const R=S.aabb.getCorners();for(let O=0;O<d.length;O++){let k=!0;for(const U of R){const F=[U[0]*o,U[1]*o,U[2]];if(s.af(F,F,d[O].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){k=!1;break}}if(S.lastCascade=O,v=Math.max(v,O),k)break}}return v+1}}class Oa{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vf,this._depthMode=new ei(t.context.gl.LEQUAL,ei.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(oo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(oo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(oo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const y=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce((($,W)=>{const ie=d.style._mergedLayers[W];return $+(ie.hasShadowPass()&&!ie.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=d.context,T=oo.shadowMapResolution,S=oo.shadowMapResolution;if(this._cascades.length===0||oo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<oo.cascadeCount;++$){const W=d._shadowMapDebug,ie=v.gl,X=v.createFramebuffer(T,S,W,"texture"),re=new s.T(v,{width:T,height:S,data:null},ie.DEPTH_COMPONENT16);if(X.depthAttachment.set(re.texture),W){const ue=new s.T(v,{width:T,height:S,data:null},ie.RGBA8);X.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:X,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=ch(o);let R=0;if(t.elevation){const $=t.elevation,W=[1e4,-1e4];$.visibleDemTiles.filter((ie=>ie.dem)).forEach((ie=>{const X=ie.dem.tree;W[0]=Math.min(W[0],X.minimums[0]),W[1]=Math.max(W[1],X.maximums[0])})),W[0]!==1e4&&(R=(W[1]-W[0])*$.exaggeration())}const O=1.5*t.cameraToCenterDistance,k=3*O,U=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){const W=this._cascades[$];let ie=t.height/50,X=1;oo.cascadeCount===1?X=k:$===0?X=O:(ie=O,X=k);const[re,ue]=i_(t,this.shadowDirection,ie,X,oo.shadowMapResolution,R);W.scale=t.scale,W.matrix=re,W.boundingSphereRadius=ue,s.bl(U,W.matrix),W.frustum=s.cA.fromInvProjectionMatrix(U,1,0,!0),W.far=X}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/oo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=oo.shadowMapResolution,this._uniformValues.u_shadowmap_0=rs.ShadowMap0,this._uniformValues.u_shadowmap_1=rs.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=d.transform.elevation;for(const $ of this._groundShadowTiles){let W={min:0,max:0};if(H){const ie=H.getMinMaxForTile($);ie&&(W=ie)}this.addShadowReceiver($.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,oo.shadowMapResolution,oo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,y.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),y.clear({color:s.ao.white,depth:1});for(const T of t.order){const S=t._mergedLayers[T];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;const R=t.getLayerSourceCache(S),O=R?o[R.id]:void 0;(S.type==="model"||O&&O.length)&&d.renderLayer(d,R,S,O)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,d=t.context,y=d.gl,v=o.directionalLight,T=o.ambientLight;if(!v||!T)return;const S=[],R=Au(t,t.longestCutoffRange);R.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const O=ll(o,v,T),k=new ei(y.LEQUAL,ei.ReadOnly,t.depthRangeFor3D),U=new Pi({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const F of this._groundShadowTiles){const H=F.toUnwrapped(),$=t.isTileAffectedByFog(F),W=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:$});this.setupShadows(H,W),t.uploadCommonUniforms(d,W,H,null,R);const ie={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:O};W.draw(t,y.TRIANGLES,k,U,Xi.multiply,ki.disabled,ie,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xi.unblended:Xi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,d=o.calculatePosMatrix(t,o.worldSize);return s.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return s.aB(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,d){if(!this.enabled)return;const y=this.painter.transform,v=this.painter.context,T=v.gl,S=this._uniformValues,R=new Float64Array(16),O=y.calculatePosMatrix(t,y.worldSize);for(let k=0;k<this._cascades.length;k++)s.aB(R,this._cascades[k].matrix,O),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),v.activeTexture.set(T.TEXTURE0+rs.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const k=s.d6(t.canonical),U=2/y.tileSize*s.al/oo.shadowMapResolution,F=U*this._cascades[0].boundingSphereRadius,H=U*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(d==="vector-tile"?1:3)*(function(W,ie,X,re,ue){const de=s.aA((W-22)/-22,0,1);return .125*(1-de)+4*de})(y.zoom);S.u_shadow_normal_offset=[k,F*$,H*$],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(v,S)}setupShadowsFromMatrix(t,o,d=!1){if(!this.enabled)return;const y=this.painter.context,v=y.gl,T=this._uniformValues,S=new Float64Array(16);for(let R=0;R<oo.cascadeCount;R++)s.aB(S,this._cascades[R].matrix,t),T[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),y.activeTexture.set(v.TEXTURE0+rs.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);if(this.useNormalOffset=d,d){const R=oo.normalOffset;T.u_shadow_normal_offset=[1,R,R],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,d,y){if(y[2]>=0)return{};const v=(function(R,O,k){const U=k/(1<<R.canonical.z);return new s.d8([R.canonical.x*U+R.wrap*k,R.canonical.y*U+R.wrap*k,0],[(R.canonical.x+1)*U+R.wrap*k,(R.canonical.y+1)*U+R.wrap*k,O])})(t,o,d).getCorners(),T=o/-y[2];y[0]<0?(s.d7(v[0],v[0],[y[0]*T,0,0]),s.d7(v[3],v[3],[y[0]*T,0,0])):y[0]>0&&(s.d7(v[1],v[1],[y[0]*T,0,0]),s.d7(v[2],v[2],[y[0]*T,0,0])),y[1]<0?(s.d7(v[0],v[0],[0,y[1]*T,0]),s.d7(v[1],v[1],[0,y[1]*T,0])):y[1]>0&&(s.d7(v[2],v[2],[0,y[1]*T,0]),s.d7(v[3],v[3],[0,y[1]*T,0]));const S={};return S.vertices=v,S.planes=[Iu(v[1],v[0],v[4]),Iu(v[2],v[1],v[5]),Iu(v[3],v[2],v[6]),Iu(v[0],v[3],v[7])],S}addShadowReceiver(t,o,d){this._receivers.add(t,s.d8.fromTileIdAndHeight(t,o,d))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Iu(f,t,o){const d=s.av([],o,t),y=s.av([],f,t),v=s.bI([],d,y),T=s.ag(v);return T===0?[0,0,1,0]:(s.c4(v,v,1/T),[v[0],v[1],v[2],-s.bJ(v,t)])}function ch(f){const t=f.properties.get("direction"),o=s.d3(t.x,t.y,t.z);o[2]=s.aA(o[2],0,75);const d=s.d5([o[0],o[1],o[2]]);return s.d4(d.x,d.y,d.z)}function ll(f,t,o){const d=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),v=t.properties.get("intensity"),T=t.properties.get("direction"),S=[T.x,T.y,T.z],R=o.properties.get("color-use-theme")==="none",O=o.properties.get("color"),k=o.properties.get("intensity"),U=Math.max(s.bJ([0,0,1],S),0),F=[0,0,0];s.c4(F,O.toPremultipliedRenderColor(R?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),k);const H=[0,0,0];return s.c4(H,y.toPremultipliedRenderColor(d?null:f.getLut(o.scope)).toArray01Linear().slice(0,3),U*v),s.da([F[0]>0?F[0]/(F[0]+H[0]):0,F[1]>0?F[1]/(F[1]+H[1]):0,F[2]>0?F[2]/(F[2]+H[2]):0])}function i_(f,t,o,d,y,v){const T=f.zoom,S=f.scale,R=f.worldSize,O=1/R,k=f.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*f.fovX),F=U*U,H=d-o,$=d+o;let W,ie;F>H/$?(W=d,ie=d*U):(W=.5*$*(1+F),ie=.5*Math.sqrt(H*H+2*(d*d+o*o)*F+$*$*F*F));const X=f.projection.pixelsPerMeter(f.center.lat,R),re=f._camera.getCameraToWorldMercator(),ue=[0,0,-W*O];s.af(ue,ue,re);let de=ie*O;const be=f._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const yt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?X:1),Rt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,o,d);Rt[8]=2*-f.centerOffset.x/f.width,Rt[9]=2*f.centerOffset.y/f.height;const Yt=new Float64Array(16);s.cO(Yt,Rt,yt);const Mt=new Float64Array(16);s.bl(Mt,Yt);const Tt=s.cA.fromInvProjectionMatrix(Mt,R,T,!0);for(const _i of Tt.points){const li=((ye=_i)[0]/=S,ye[1]/=S,ye[2]=s.ce(ye[2],f._center.lat),ye);de=Math.max(de,s.c5(s.d9([],ue,li)))}}var ye;de*=y/(y-1);const ve=Math.acos(t[2]),ge=Math.atan2(-t[0],-t[1]),_e=new cd;_e.position=ue,_e.setPitchBearing(ve,ge);const xe=_e.getWorldToCamera(R,X),Ze=de*R,Oe=Math.min(f._mercatorZfromZoom(17)*R*-2,-2*Ze),ot=_e.getCameraToClipOrthographic(-Ze,Ze,-Ze,Ze,Oe,(Ze+v*X)/t[2]),qe=new Float64Array(16);s.aB(qe,ot,xe);const nt=s.d4(Math.floor(1e6*ue[0])/1e6*R,Math.floor(1e6*ue[1])/1e6*R,0),zt=.5*y,He=[0,0,0];s.af(He,nt,qe),s.c4(He,He,zt);const Pe=[Math.floor(He[0]),Math.floor(He[1]),Math.floor(He[2])],lt=[0,0,0];s.av(lt,He,Pe),s.c4(lt,lt,-1/zt);const Ke=new Float64Array(16);return s.bA(Ke),s.br(Ke,Ke,lt),s.aB(qe,Ke,qe),[qe,Ze]}class uh extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return s.aV(this.requestManager.transformRequest(o,s.R.Model).url).then((d=>{if(!d)return;const y=s.aW(d),v=new s.aX(t,void 0,void 0,y);return v.computeBoundsAndApplyParent(),v})).catch((d=>{if(d&&d.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${o}: ${d.message}`)))}))}load(t,o,d={forceReload:!1}){this.models[o]||(this.models[o]={});const y=Object.keys(t),v=[],T=[];for(const S of y){const R=t[S];this.hasURLBeenRequested(R)&&!d.forceReload||(this.modelByURL[R]={modelId:S,scope:o},v.push(this.loadModel(S,R)),T.push(S)),this.models[o][S]||(this.models[o][S]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+T.length,Promise.allSettled(v).then((S=>{for(let R=0;R<S.length;R++){const{status:O}=S[R];if(O==="rejected")continue;const{value:k}=S[R];this.models[o][T[R]]||(this.models[o][T[R]]={model:null,numReferences:1}),this.models[o][T[R]].model=k}this.numModelsLoading[o]-=T.length,this.fire(new s.z("data",{dataType:"style"}))})).catch((S=>{this.fire(new s.y(new Error(`Could not load models: ${S.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===y)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:v,modelId:T}=this.modelByURL[y];this.models[v][T].numReferences++}else this.modelUris[d][t]=y,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d=this.modelUris[o];for(const y in t)d[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d={};for(const y of t)this.hasModel(y,o,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[o][y].numReferences++:this.modelUris[o][y]&&!this.hasURLBeenRequested(y)?d[y]=this.modelUris[o][y]:!this.hasURLBeenRequested(y)&&s.db(y,!1)&&(this.modelUris[o][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[o][y]);this.load(d,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,d=!1,y=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||y)){const v=this.modelUris[o][t];d||delete this.modelUris[o][t],delete this.modelByURL[v];const T=this.models[o][t].model;if(!T)return;delete this.models[o][t],T.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const d=this.models[t][o].model;delete this.models[t][o],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const d in this.models[o])this.models[o][d].model&&this.models[o][d].model.upload(t.context)}}const pp=new s.a9({data:new s.aa(s.a6.colorTheme.data)});function mp(f){if(!f.metadata||!f.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:o,top:d,width:y,height:v}=f.metadata.content_area,T=o*t,S=d*t;return[T,S,T+y*t,S+v*t]}function $c(f){if(f)return f.map((([t,o])=>[t*s.o.devicePixelRatio,o*s.o.devicePixelRatio]))}class _c{constructor(t,o,d){this.id=t,this.scope=o,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof ta))return t;const y=o.map((T=>this.sourceCache.getTile(T))),v=d.getImages(y,Array.from(this.pendingRequests));for(const[T,S]of v)t.set(s.I.from({name:T,iconsetId:this.id}),S),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),t}}const Vl=(f,t)=>Ie(f,t&&t.filter((o=>o.identifier!=="source.canvas"))),zm=s.aH(on,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),n_=s.aH(on,["setCenter","setZoom","setBearing","setPitch"]),yc=new Set(["background","sky","slot","custom"]),hh={version:8,layers:[],sources:{}},ud={duration:300,delay:0};class La extends s.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},ud),this._buildingIndex=new hc(this),this.crossTileSymbolIndex=new ns,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ya,this.dispatcher=o.dispatcher?o.dispatcher:new s.D(s.dd(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Dr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.de(t._requestManager,o.localFontFamily?s.df.all:o.localIdeographFontFamily?s.df.ideographs:s.df.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new uh(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",s.dg());const d=this;this._rtlTextPluginCallback=La.registerForPluginStateChange((y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((v,T)=>{if(s.dh(v),T&&T.every((S=>S)))for(const S in d._sourceCaches){const R=d._sourceCaches[S],O=R.getSource().type;O!=="vector"&&O!=="geojson"||R.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getOwnSource(y.sourceId);if(v&&v.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===v.id&&this._validateLayer(S)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const o=s.di(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${s.dj(JSON.stringify(t))}`}_diffStyle(t,o,d){this.globalId=this._getGlobalId(t);const y=(v,T)=>{try{T(null,this.setState(v,d))}catch(S){T(S,!1)}};if(typeof t=="string"){const v=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(v,s.R.Style);s.m(T,((S,R)=>{S?this.fire(new s.y(S)):R&&y(R,o)}))}else typeof t=="object"&&y(t,o)}loadURL(t,o={}){this.fire(new s.z("dataloading",{dataType:"style"}));const d=typeof o.validate=="boolean"?o.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,d);const v=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(v,((T,S)=>{if(this._request=null,T)this.fire(new s.y(T));else if(S)return this.importsCache.set(t,S),this._load(S,d)}))}loadJSON(t,o={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame((()=>{this._request=null,this._load(t,o.validate!==!1)}))}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(hh,!1)}_loadImports(t,o,d){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const v of t){const T=this._createFragmentStyle(v),S=new Promise((k=>{T.once("style.import.load",k),T.once("error",k)})).then((()=>this.mergeAll()));if(y.push(S),this.resolvedImports.has(v.url)){T.loadEmpty();continue}const R=v.data||this.importsCache.get(v.url);R?(T.loadJSON(R,{validate:o}),this._isInternalStyle(R)&&(T.globalId=null)):v.url?T.loadURL(v.url,{validate:o}):T.loadEmpty();const O={style:T,id:v.id,config:v.config};if(d){const k=this.fragments.findIndex((({id:U})=>U===d));this.fragments=this.fragments.slice(0,k).concat(O).concat(this.fragments.slice(k))}else this.fragments.push(O)}return Promise.allSettled(y)}getImportGlobalIds(t=this,o=new Set){for(const d of t.fragments)d.style.globalId&&o.add(d.style.globalId),this.getImportGlobalIds(d.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?s.B(t.id,this.scope):t.id;let d;const y=this._initialConfig&&this._initialConfig[o];(t.config||y)&&(d=Object.assign({},t.config,y));const v=new La(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){const v=Object.assign({},hh,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,o)}if(this.updateConfig(this._config,t.schema),o&&Vl(this,Hr(t)))return;this._loaded=!0,this.stylesheet=s.dk(t);const d=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const v=zl(this.stylesheet.layers);if(this._order=v.map((R=>R.id)),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Le(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Le(this.stylesheet.light)),this._layers={};for(const R of v){const O=s.dq(R,this.scope,this._styleColorTheme.lut,this.options);O.configDependencies.size!==0&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const k=this.getOwnLayerSourceCache(O),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&O.canCastShadows()&&U&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const S=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then((()=>{this._reloadImports(),this.fire(new s.z(S?"style.load":"style.import.load"))})).catch((R=>{this.fire(new s.y(new Error("Failed to load imports",R))),this.fire(new s.z(S?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new s.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const v=this._evaluateColorThemeData(y);this._loadColorTheme(v).then((()=>{d()})).catch((T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),d()}))}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,d,y,v,T,S,R,O,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((F=>{if(F.stylesheet){if(F.light!=null&&(t=F.light),F.stylesheet.lights)for(const H of F.stylesheet.lights)H.type==="ambient"&&F.ambientLight!=null&&(o=F.ambientLight),H.type==="directional"&&F.directionalLight!=null&&(d=F.directionalLight);y=this._prioritizeTerrain(y,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(v=F.fog),F.stylesheet.snow&&F.snow!=null&&(T=F.snow),F.stylesheet.rain&&F.rain!=null&&(S=F.rain),F.stylesheet.camera!=null&&(k=F.stylesheet.camera),F.stylesheet.projection!=null&&(R=F.stylesheet.projection),F.stylesheet.transition!=null&&(O=F.stylesheet.transition),U[F.scope]=F._styleColorTheme}})),this.light=t,this.ambientLight=o,this.directionalLight=d,this.fog=v,this.snow=T,this.rain=S,this._styleColorThemeForScope=U,y===null?delete this.terrain:this.terrain=y,this.camera=k||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},ud,O),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const o=d=>{for(const y of d.fragments)o(y.style);t(d)};o(this)}_prioritizeTerrain(t,o,d){const y=t&&t.drapeRenderMode===0;return d===null?o&&o.drapeRenderMode===0?o:y?t:null:o!=null&&(!t||y||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},d={};this.forEachFragmentStyle((y=>{for(const v in y._sourceCaches){const T=s.B(v,y.scope);t[T]=y._sourceCaches[v]}for(const v in y._otherSourceCaches){const T=s.B(v,y.scope);o[T]=y._otherSourceCaches[v]}for(const v in y._symbolSourceCaches){const T=s.B(v,y.scope);d[T]=y._symbolSourceCaches[v]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},o=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((T=>{for(const S of T._order){const R=T._layers[S];if(R.type==="slot"){const O=s.dl(S);if(t[O])continue;t[O]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):o.push(R)}})),this._mergedOrder=[];let y=-1;const v=(T=[])=>{for(const S of T)if(S.type==="slot"){const R=s.dl(S.id);t[R]&&v(t[R]),this._mergedSlots.push(R)}else{const R=s.B(S.id,S.scope);this._mergedOrder.push(R),d[R]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(v(o),this._has3DLayers){const T={};for(let S=0;S<this._mergedOrder.length;++S){const R=this._mergedOrder[S];T[R]=S===y?1:S<y?d[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((S,R)=>T[S]-T[R]))}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(o,d,y,v){const T=Object.assign({},d);for(const R of Object.keys(s.a6.colorTheme))T[R]===void 0&&(T[R]=s.a6.colorTheme[R].default);const S=new s.a8(pp,o,new Map(y));return S.setTransitionOrValue(T,y),S.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,y)=>{const v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let T=t;T.startsWith(v)||(T=v+T);const S=s.I.from("mapbox-reserved-lut"),R=new Image;R.src=T,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void d();this._styleColorTheme.lutLoading=!1;const{width:O,height:k,data:U}=s.o.getImageData(R);if(k>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==k*k)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new s.q({width:O,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const F=this.imageManager.getImage(S,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:t},d()):y(new Error("Missing LUT image."))}}))}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(o,d,y){let v,T,S;const R=s.o.devicePixelRatio>1?"@2x":"";let O=s.m(d.transformRequest(d.normalizeSpriteURL(o,R,".json"),s.R.SpriteJSON),((F,H)=>{O=null,S||(S=F,v=H,U())})),k=s.n(d.transformRequest(d.normalizeSpriteURL(o,R,".png"),s.R.SpriteImage),((F,H)=>{k=null,S||(S=F,T=H,U())}));function U(){if(S)y(S);else if(v&&T){const F=s.o.getImageData(T),H={};for(const $ in v){const{width:W,height:ie,x:X,y:re,sdf:ue,pixelRatio:de,stretchX:be,stretchY:ye,content:ve}=v[$],ge=new s.q({width:W,height:ie});s.q.copy(F,ge,{x:X,y:re},{x:0,y:0},{width:W,height:ie},null),H[$]={data:ge,pixelRatio:de!==void 0?de:1,sdf:ue!==void 0&&ue,stretchX:be,stretchY:ye,content:ve,usvg:!1,version:0}}y(null,H)}}return{cancel(){O&&(O.cancel(),O=null),k&&(k.cancel(),k=null)}}})(t,this.map._requestManager,((o,d)=>{if(this._spriteRequest=null,o)this.fire(new s.y(o));else if(d){const y=new Map;for(const v in d)y.set(s.I.from(v),d[v]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))}))}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const d=this.getOwnSourceCache(o.source);if(!d)return void this.fire(new s.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=d.getSource();if(y.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const v=new _c(t,this.scope,d);this.imageManager.addImageProvider(v,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(v,T)=>{if(this._spriteRequest=null,v)o?this._loadSprite(t):this.fire(new s.y(v));else if(T){const S=new Map;for(const R in T)S.set(s.I.from(R),T[R]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),s.R.Iconset),((v,T)=>{if(v)return void y(v);const S={},R=s.dc(new s.bt(T));for(const O of R.icons){const k={version:1,pixelRatio:s.o.devicePixelRatio,content:mp(O),stretchX:O.metadata?$c(O.metadata.stretch_x_areas):void 0,stretchY:O.metadata?$c(O.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:O};S[O.name]=k}y(null,S)})))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const d=t.sourceLayer;d&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.y(new Error(`Source layer "${d}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,o)=>{const d=this.fragments[o];return d&&d.style&&(t.data=d.style.serialize()),t}))}_serializeSources(){const t={};for(const o in this._sourceCaches){const d=this._sourceCaches[o].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const o=[];for(const d of t){const y=this._layers[d];y&&y.type!=="custom"&&o.push(y.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const d=this.map.painter;if(d)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const v=t.getProgramIds();if(v)for(const T of v){const S=t.getDefaultProgramParams(T,o.zoom,this._styleColorTheme.lut);S&&(d.style=this,this.fog&&(d._fogVisible=!0,S.overrideFog=!0,d.getOrCreateProgram(T,S)),d._fogVisible=!1,S.overrideFog=!1,d.getOrCreateProgram(T,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,d.getOrCreateProgram(T,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const R in S){const{updatedIds:O,removedIds:k}=S[R];(O||k)&&(this._updateWorkerLayers(R,O,k),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const v={};for(const S in this._mergedSourceCaches){const R=this._mergedSourceCaches[S];v[S]=R.used,R.used=!1,R.tileCoverLift=0}for(const S of this._mergedOrder){const R=this._mergedLayers[S];if(R.recalculate(t,this._availableImages),!R.isHidden(t.zoom)){const O=this.getLayerSourceCache(R);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(R,t)})):this.precompilePrograms(R,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const S of T)S.sourceCache.used=!0;for(const S in v){const R=this._mergedSourceCaches[S];v[S]!==R.used&&R.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const d=o.resolvePendingRequests(),y=this.getFragmentStyle(o.scope);y&&y.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const d=this._mergedSourceCaches[o].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,d){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:o?y._serializeLayers(o):[],scope:t,removedIds:d||[],options:y.options})}setState(t,o){if(this._checkLoaded(),Vl(this,Hr(t)))return!1;(t=s.dk(t)).layers=zl(t.layers);const d=(function(T,S){if(!T)return[{command:on.setStyle,args:[S]}];let R=[];try{if(!s.by(T.version,S.version))return[{command:on.setStyle,args:[S]}];if(s.by(T.center,S.center)||R.push({command:on.setCenter,args:[S.center]}),s.by(T.zoom,S.zoom)||R.push({command:on.setZoom,args:[S.zoom]}),s.by(T.bearing,S.bearing)||R.push({command:on.setBearing,args:[S.bearing]}),s.by(T.pitch,S.pitch)||R.push({command:on.setPitch,args:[S.pitch]}),s.by(T.sprite,S.sprite)||R.push({command:on.setSprite,args:[S.sprite]}),s.by(T.glyphs,S.glyphs)||R.push({command:on.setGlyphs,args:[S.glyphs]}),s.by(T.imports,S.imports)||(function(H=[],$=[],W){$=$||[];const ie=(H=H||[]).map(sl),X=$.map(sl),re=H.reduce(Gc,{}),ue=$.reduce(Gc,{}),de=ie.slice();let be,ye,ve,ge;for(be=0,ye=0;be<ie.length;be++)ve=ie[be],ue.hasOwnProperty(ve)?ye++:(W.push({command:on.removeImport,args:[ve]}),de.splice(de.indexOf(ve,ye),1));for(be=0,ye=0;be<X.length;be++)ve=X[X.length-1-be],de[de.length-1-be]!==ve&&(re.hasOwnProperty(ve)?(W.push({command:on.removeImport,args:[ve]}),de.splice(de.lastIndexOf(ve,de.length-ye),1)):ye++,ge=de[de.length-be],W.push({command:on.addImport,args:[ue[ve],ge]}),de.splice(de.length-be,0,ve));for(const _e of $){const xe=re[_e.id];xe&&(delete xe.data,s.by(xe,_e)||W.push({command:on.updateImport,args:[_e.id,_e]}))}})(T.imports,S.imports,R),s.by(T.transition,S.transition)||R.push({command:on.setTransition,args:[S.transition]}),s.by(T.light,S.light)||R.push({command:on.setLight,args:[S.light]}),s.by(T.fog,S.fog)||R.push({command:on.setFog,args:[S.fog]}),s.by(T.snow,S.snow)||R.push({command:on.setSnow,args:[S.snow]}),s.by(T.rain,S.rain)||R.push({command:on.setRain,args:[S.rain]}),s.by(T.projection,S.projection)||R.push({command:on.setProjection,args:[S.projection]}),s.by(T.lights,S.lights)||R.push({command:on.setLights,args:[S.lights]}),s.by(T.camera,S.camera)||R.push({command:on.setCamera,args:[S.camera]}),s.by(T.iconsets,S.iconsets)||(function(H,$,W){let ie;for(ie in $=$||{},H=H||{})H.hasOwnProperty(ie)&&($.hasOwnProperty(ie)||W.push({command:on.removeIconset,args:[ie]}));for(ie in $){if(!$.hasOwnProperty(ie))continue;const X=$[ie];H.hasOwnProperty(ie)?s.by(H[ie],X)||(W.push({command:on.removeIconset,args:[ie]}),W.push({command:on.addIconset,args:[ie,X]})):W.push({command:on.addIconset,args:[ie,X]})}})(T.iconsets,S.iconsets,R),!s.by(T["color-theme"],S["color-theme"]))return[{command:on.setStyle,args:[S]}];const O={},k=[];(function(H,$,W,ie){let X;for(X in $=$||{},H=H||{})H.hasOwnProperty(X)&&($.hasOwnProperty(X)||Eu(X,W,ie));for(X in $){if(!$.hasOwnProperty(X))continue;const re=$[X];H.hasOwnProperty(X)?s.by(H[X],re)||(H[X].type==="geojson"&&re.type==="geojson"&&Pa(H,$,X)?W.push({command:on.setGeoJSONSourceData,args:[X,re.data]}):Qr(X,$,W,ie)):To(X,$,W)}})(T.sources,S.sources,k,O);const U=[];T.layers&&T.layers.forEach((H=>{H.source&&O[H.source]?R.push({command:on.removeLayer,args:[H.id]}):U.push(H)}));let F=T.terrain;F&&O[F.source]&&(R.push({command:on.setTerrain,args:[void 0]}),F=void 0),R=R.concat(k),s.by(F,S.terrain)||R.push({command:on.setTerrain,args:[S.terrain]}),(function(H,$,W){$=$||[];const ie=(H=H||[]).map(sl),X=$.map(sl),re=H.reduce(Gc,{}),ue=$.reduce(Gc,{}),de=ie.slice(),be=Object.create(null);let ye,ve,ge,_e,xe,Ze,Oe;for(ye=0,ve=0;ye<ie.length;ye++)ge=ie[ye],ue.hasOwnProperty(ge)?ve++:(W.push({command:on.removeLayer,args:[ge]}),de.splice(de.indexOf(ge,ve),1));for(ye=0,ve=0;ye<X.length;ye++)ge=X[X.length-1-ye],de[de.length-1-ye]!==ge&&(re.hasOwnProperty(ge)?(W.push({command:on.removeLayer,args:[ge]}),de.splice(de.lastIndexOf(ge,de.length-ve),1)):ve++,Ze=de[de.length-ye],W.push({command:on.addLayer,args:[ue[ge],Ze]}),de.splice(de.length-ye,0,ge),be[ge]=!0);for(ye=0;ye<X.length;ye++)if(ge=X[ye],_e=re[ge],xe=ue[ge],!be[ge]&&!s.by(_e,xe))if(s.by(_e.source,xe.source)&&s.by(_e["source-layer"],xe["source-layer"])&&s.by(_e.type,xe.type)){for(Oe in rl(_e.layout,xe.layout,W,ge,null,on.setLayoutProperty),rl(_e.paint,xe.paint,W,ge,null,on.setPaintProperty),s.by(_e.slot,xe.slot)||W.push({command:on.setSlot,args:[ge,xe.slot]}),s.by(_e.filter,xe.filter)||W.push({command:on.setFilter,args:[ge,xe.filter]}),s.by(_e.minzoom,xe.minzoom)&&s.by(_e.maxzoom,xe.maxzoom)||W.push({command:on.setLayerZoomRange,args:[ge,xe.minzoom,xe.maxzoom]}),_e)_e.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?rl(_e[Oe],xe[Oe],W,ge,Oe.slice(6),on.setPaintProperty):s.by(_e[Oe],xe[Oe])||W.push({command:on.setLayerProperty,args:[ge,Oe,xe[Oe]]}));for(Oe in xe)xe.hasOwnProperty(Oe)&&!_e.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?rl(_e[Oe],xe[Oe],W,ge,Oe.slice(6),on.setPaintProperty):s.by(_e[Oe],xe[Oe])||W.push({command:on.setLayerProperty,args:[ge,Oe,xe[Oe]]}))}else W.push({command:on.removeLayer,args:[ge]}),Ze=de[de.lastIndexOf(ge)+1],W.push({command:on.addLayer,args:[xe,Ze]})})(U,S.layers,R)}catch(O){console.warn("Unable to compute style diff:",O),R=[{command:on.setStyle,args:[S]}]}return R})(this.serialize(),t).filter((T=>!(T.command in n_)));if(d.length===0)return!1;const y=d.filter((T=>!(T.command in zm)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((T=>T.command)).join(", ")}.`);const v=[];return d.forEach((T=>{v.push(this[T.command](...T.args))})),o&&Promise.all(v).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[o,d]of t.entries()){if(this.getImage(o))return this.fire(new s.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,o,d=!1){this.imageManager.updateImage(t,this.scope,o),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,o,d={}){return this._checkLoaded(),this._validate(Re,`models.${t}`,o,null,d)||(this.modelManager.addModel(t,o,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(ya,`sources.${t}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const y=Rr(t,o,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const v=T=>{const S=(T?"symbol:":"other:")+y.id,R=s.B(S,this.scope),O=this._sourceCaches[S]=new wo(R,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=O,O.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([v,T])=>T.type==="source"&&T.source===t));if(y)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const y of d){const v=s.dl(y.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(y.id),y.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const d=this.getOwnSourceCache(o);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const d=t[o]._tiles;for(const y in d){const v=d[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const v of t){if(this._validate(xa,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(v),T.updateTransitions(o)}else this.ambientLight=new Rn(v,Zn||(Zn=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(v),T.updateTransitions(o)}else this.directionalLight=new Rn(v,Cr||(Cr=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(o,{worldview:this.map.getWorldview()}),y=new s.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const d=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),v=t.properties.get("intensity"),T=t.properties.get("direction"),S=1-s.d3(T.x,T.y,T.z)[2]/90,R=d(y)*v*S,O=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=o.properties.get("intensity"),U=d(O)*k;return Number(((R+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dm(t)){const o=s.dn(t),d=this.fragments.find((({id:v})=>v===o));if(!d)return;const y=s.dl(t);return d.style.getFragmentStyle(y)}{const o=this.fragments.find((({id:d})=>d===t));return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},d=(y,v="")=>`${y}::${v}`;this._featuresetSelectors={};for(const y in t){const v=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const R=this.getOwnLayer(T.layer);if(!R){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const O=d(R.source,R.sourceLayer);if(O in o&&o[O]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}o[O]=T.featureNamespace}let S;if(T.properties)for(const R in T.properties){const O=s.U(T.properties[R]);O.result==="success"&&(S=S||{},S[R]=O.value)}v.push({layerId:T.layer,namespace:T.featureNamespace,properties:S,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const d=[];for(const y in o.stylesheet.featuresets)d.push({featuresetId:y,importId:o.scope?o.scope:void 0});return d}getFeaturesetLayers(t,o){const d=this.getFragmentStyle(o),y=d.stylesheet.featuresets;if(!y||!y[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const T of y[t].selectors){const S=d.getOwnLayer(T.layer);S&&v.push(S)}return v}getConfigProperty(t,o){const d=this.getFragmentStyle(t);if(!d)return null;const y=s.B(o,d.scope),v=d.options.get(y),T=v?v.value||v.default:null;return T?T.serialize():null}setConfigProperty(t,o,d){const y=this.getFragmentStyle(t);if(!y)return;const v=y.stylesheet.schema;if(!v||!v[o])return;const T=s.U(d);if(T.result!=="success")return void Vl(this,T.value);const S=T.value.expression,R=s.B(o,y.scope),O=y.options.get(R);if(!O)return;let k;const{minValue:U,maxValue:F,stepValue:H,type:$,values:W}=v[o],ie=s.U(v[o].default);ie.result==="success"&&(k=ie.value.expression),k?(this.options.set(R,Object.assign({},O,{value:S,default:k,minValue:U,maxValue:F,stepValue:H,type:$,values:W})),this.updateConfigDependencies(o)):this.fire(new s.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const d=o.stylesheet.schema;if(!d)return null;const y={};for(const v in d){const T=s.B(v,o.scope),S=o.options.get(T),R=S?S.value||S.default:null;y[v]=R?R.serialize():null}return y}setConfig(t,o){const d=this.getFragmentStyle(t);d&&(d.updateConfig(o,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=o,d.updateConfig(d._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const d in o){let y,v;const T=s.U(o[d].default);if(T.result==="success"&&(y=T.value.expression),t&&t[d]!==void 0){const F=s.U(t[d]);F.result==="success"&&(v=F.value.expression)}const{minValue:S,maxValue:R,stepValue:O,type:k,values:U}=o[d];if(y){const F=s.B(d,this.scope);this.options.set(F,{default:y,value:v,minValue:S,maxValue:R,stepValue:O,type:k,values:U})}else this.fire(new s.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const o of this._configDependentLayers){const d=this.getLayer(o);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((o=>{const d=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(d){const y=o._evaluateColorThemeData(d);(!o._styleColorTheme.lut&&y!==""||o._styleColorTheme.lut&&y!==o._styleColorTheme.lut.data)&&o.setColorTheme(d)}})),this._changes.setDirty()}addLayer(t,o,d={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new s.y(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(t.type==="custom"){if(Vl(this,s.dp(t)))return;v=s.dq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=s.dk(t),t=Object.assign(t,{source:y})),this._validate(Fe,`layers.${y}`,t,{arrayIndex:-1},d))return;v=s.dq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let T=this._order.length;if(o){const k=this._order.indexOf(o);if(k===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?T=k:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const S=this.getOwnLayerSourceCache(v),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&v.canCastShadows()&&R&&(S.castsShadows=!0);const O=this._changes.getRemovedLayer(v);if(O&&v.source&&S&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const k=s.B(v.source,v.scope);O.type!==v.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===o)return;const y=this._order.indexOf(t);this._order.splice(y,1);let v=this._order.length;if(o){const T=this._order.indexOf(o);if(T===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));d.slot===this._layers[o].slot?v=T:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const y=this.getOwnLayerSourceCache(o);if(y&&y.castsShadows){let v=!1;for(const T in this._layers)if(this._layers[T].source===o.source&&this._layers[T].canCastShadows()){v=!0;break}y.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,d){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===o&&y.maxzoom===d||(o!=null&&(y.minzoom=o),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==o&&(d.slot=o,this._updateLayer(d))}setFilter(t,o,d={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!s.by(y.filter,o))return o==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(J,`layers.${y.id}.filter`,o,{layerType:y.type},d)||(y.filter=s.dk(o),this._updateLayer(y)))}getFilter(t){const o=this._checkLayer(t);if(o)return s.dk(o.filter)}setLayoutProperty(t,o,d,y={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!s.by(v.getLayoutProperty(o),d)){if(d!=null&&(!y||y.validate!==!1)&&Vl(v,me.call(Hr,{key:`layers.${t}.layout.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,d),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,o){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(o)}setPaintProperty(t,o,d,y={}){this._checkLoaded();const v=this._checkLayer(t);if(!v||s.by(v.getPaintProperty(o),d)||d!=null&&(!y||y.validate!==!1)&&Vl(v,se.call(Hr,{key:`layers.${t}.paint.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:s.a6})))return;const T=v.setPaintProperty(o,d);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),T&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,o){const d=this._checkLayer(t);if(d)return d.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(R);for(const{source:F,sourceLayer:H}of U)k.setFeatureState({id:t.id,source:F,sourceLayer:H},o)}else if("layerId"in t.target){const{layerId:R}=t.target,O=this.getLayer(R);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}const d=t.source,y=t.sourceLayer,v=this._checkSource(d);if(!v)return;const T=v.type;if(T==="geojson"&&y)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(d);for(const R of S)R.setFeatureState(y,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(R);for(const{source:F,sourceLayer:H}of U)k.removeFeatureState({id:t.id,source:F,sourceLayer:H},o)}else if("layerId"in t.target){const{layerId:R}=t.target,O=this.getLayer(R);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}const d=t.source,y=this._checkSource(d);if(!y)return;const v=y.type,T=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!T)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(d);for(const R of S)R.removeFeatureState(T,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let v;if("featuresetId"in t.target){const{featuresetId:T,importId:S}=t.target,R=this.getFragmentStyle(S),O=R.getFeaturesetLayers(T);for(const{source:k,sourceLayer:U}of O){const F=R.getFeatureState({id:t.id,source:k,sourceLayer:U});if(F&&!v)v=F;else if(!s.by(v,F))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,S=this.getLayer(T);v=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return v}const o=t.source,d=t.sourceLayer,y=this._checkSource(o);if(y){if(y.type!=="vector"||d)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(d,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),d=s.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[d]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=S=>this._mergedLayers[S].is3D(!!this.terrain),d=this.order,y={},v=[];for(let S=d.length-1;S>=0;S--){const R=d[S];if(o(R)){y[R]=S;for(const O of t){const k=O[R];if(k)for(const U of k)v.push(U)}}}v.sort(((S,R)=>R.intersectionZ-S.intersectionZ));const T=[];for(let S=d.length-1;S>=0;S--){const R=d[S];if(o(R))for(let O=v.length-1;O>=0;O--){const k=v[O].feature;if(k.layer&&y[k.layer.id]<S)break;T.push(k),v.pop()}else for(const O of t){const k=O[R];if(k)for(const U of k)T.push(U.feature)}}return T}queryRasterValue(t,o,d){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(o,d):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,d){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(J,"queryRenderedFeatures.filter",o.filter,null,o),y=s.b6(o.filter));const v={},T=k=>{if(yc.has(k.type))return;const U=this.getOwnLayerSourceCache(k),F=v[U.id]=v[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[k.fqid]=F.layers[k.fqid]||{styleLayer:k,targets:[]},F.layers[k.fqid].targets.push({filter:y})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const k of o.layers){const U=this._layers[k];if(!U)return this.fire(new s.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];T(U)}}else for(const k in this._layers)T(this._layers[k]);const S=this._queryRenderedFeatures(t,v,d),R=this._flattenAndSortRenderedFeatures(S),O=[];for(const k of R)s.ds(k.layer.id)===this.scope&&O.push(k);return O}queryRenderedFeatureset(t,o,d){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(J,"queryRenderedFeatures.filter",o.filter,null,o),y=s.b6(o.filter));const v="mock",T=[];if(o&&o.target)T.push(Object.assign({},o,{targetId:v,filter:y}));else{const k=this.getFeaturesetDescriptors();for(const U of k)T.push({targetId:v,filter:y,target:U});for(const{style:U}of this.fragments){const F=U.getFeaturesetDescriptors();for(const H of F)T.push({targetId:v,filter:y,target:H})}}const S=this.queryRenderedTargets(t,T,d),R=[],O=new Set;for(const k of S)for(const U of k.variants[v])bo(U,k,O)||R.push(new s.dt(k,U));return R}queryRenderedTargets(t,o,d){const y={},v=(S,R,O,k)=>{const U=y[R.id]=y[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(U.layers[S.fqid]=U.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(U.has3DLayers=!0),!k)return O.uniqueFeatureID=!1,void U.layers[S.fqid].targets.push(O);U.layers[S.fqid].targets.push(Object.assign({},O,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const S of o)if("featuresetId"in S.target){const{featuresetId:R,importId:O}=S.target,k=this.getFragmentStyle(O);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[R];if(!U){this.fire(new s.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const F of U){const H=k.getOwnLayer(F.layerId);H&&!yc.has(H.type)&&v(H,k.getOwnLayerSourceCache(H),S,F)}}else if("layerId"in S.target){const{layerId:R}=S.target,O=this.getLayer(R);if(!O||yc.has(O.type))continue;v(O,this.getLayerSourceCache(O),S)}const T=this._queryRenderedFeatures(t,y,d);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,o,d){const y=[],v=!!this.map._showQueryGeometry,T=rr.createFromScreenPoints(t,d);for(const S in o){const R=Pl(T,o[S],this._availableImages,d,v);Object.keys(R).length&&y.push(R)}if(this.placement)for(const S in o){if(!o[S].sourceCache._onlySymbols)continue;const R=ko(T.screenGeometry,o[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&y.push(R)}return y}querySourceFeatures(t,o){const d=o&&o.filter;d&&this._validate(J,"querySourceFeatures.filter",d,null,o);let y=[];const v=this.getOwnSourceCaches(t);for(const T of v)y=y.concat(ia(T,o));return y}addSourceType(t,o,d){return La.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(La.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,d={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const S in t)if(!s.by(t[S],y[S])){v=!0;break}if(!v)return;const T=this._getTransitionParameters();this.light.setLight(t,o,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const y=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const S="terrain-dem-src";this.addSource(S,d.source),d=s.dk(d),d=Object.assign(d,{source:S})}const v=Object.assign({},d),T={};if(this.terrain&&y){v.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(T.style=S.serialize())}if(this._validate(Ct,"terrain",v,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&o!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,o),this.fire(new s.z("data",{dataType:"style"}))}else{const v=this.terrain,T=v.get();for(const S of Object.keys(s.a6.terrain))!d.hasOwnProperty(S)&&s.a6.terrain[S].default&&(d[S]=s.a6.terrain[S].default);for(const S in t)if(!s.by(t[S],T[S])){v.set(t,this.options),this.stylesheet.terrain=t;const R=this._getTransitionParameters({duration:0});v.updateTransitions(R),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new hn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createSnow(t){const o=this.snow=new Gn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createRain(t){const o=this.rain=new Vn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!s.by(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!s.by(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!s.by(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(o);this._loadColorTheme(d).then((()=>{this.fire(new s.z("colorthemeset")),t()})).catch((y=>{s.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=o,d._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):o.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const d=this.terrain=new Xe(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,d,y,v={}){if(v&&v.validate===!1)return!1;const T=Object.assign({},this.serialize());return Vl(this,t.call(Hr,Object.assign({key:o,style:T,value:d,styleSpec:s.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const d of o)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){const o=this.getSourceCaches(t);for(const d of o)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let o;this.directionalLight&&(o=ch(this.directionalLight));const d=new Set;for(const y in this._mergedLayers){const v=this._mergedLayers[y];v.hasElevation()&&!d.has(v.source)&&d.add(v.source)}for(const y in this._mergedSourceCaches){const v=this._mergedSourceCaches[y],T=d.has(v._source.id);v.update(t,void 0,void 0,o,T)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,d,y,v,T,S=!1){let R=!1,O=!1;const k={},U={};for(const F of this._mergedOrder){const H=this._mergedLayers[F];if(H.type!=="symbol")continue;const $=s.B(H.source,H.scope);let W=k[$];if(!W){const X=this.getLayerSourceCache(H);if(!X)continue;const re=X.getRenderableIds(!0).map((ue=>X.getTileByID(ue)));U[$]=re.slice(),W=k[$]=re.sort(((ue,de)=>de.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(de.tileID)?-1:1)))}const ie=this.crossTileSymbolIndex.addLayer(H,W,o.center.lng,o.projection);R=R||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),o.zoom))&&(this.pauseablePlacement=new ps(o,this._mergedOrder,S,d,y,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),O=!0),R&&this.pauseablePlacement.placement.setStale()),O||R){this._buildingIndex.onNewFrame(o.zoom);for(let F=0;F<this._mergedOrder.length;F++){const H=this._mergedLayers[this._mergedOrder[F]];if(H.type!=="symbol")continue;const $=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,k[s.B(H.source,H.scope)],F,$?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:v})=>v===t.id))!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return d.push(t),this._loadImports([t],!0);const y=d.findIndex((({id:v})=>v===o));return y===-1&&this.fire(new s.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(t).concat(d.slice(y)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==d[y].url&&this.setImportUrl(t,o.url),s.by(o.config,d[y].config)||this.setImportConfig(t,o.config,o.data.schema),s.by(o.data,d[y].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const v=this.getImportIndex(o);if(v===-1)return this;const T=d[y],S=this.fragments[y];return d=d.filter((({id:R})=>R!==t)),this.fragments=this.fragments.filter((({id:R})=>R!==t)),this.stylesheet.imports=d.slice(0,v).concat(T).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(S).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;d[y].url=o;const v=this.fragments[y];return v.style=this._createFragmentStyle(d[y]),v.style.on("style.import.load",(()=>this.mergeAll())),v.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const d=this.getImportIndex(t),y=this.stylesheet.imports||[];return d===-1?this:o?(this.fragments[d].style.setState(o),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(t,y[d].url))}setImportConfig(t,o,d){this._checkLoaded();const y=this.getImportIndex(t),v=this.stylesheet.imports||[];if(y===-1)return this;o?v[y].config=o:delete v[y].config;const T=this.fragments[y];d&&T.style.stylesheet&&(T.style.stylesheet.schema=d);const S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=o,T.style.updateConfig(o,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(o.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex((d=>d.id===t));return o===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[o];d&&t.push(d.getSource())}return t}getSource(t,o){const d=this.getSourceCache(t,o);return d&&d.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const d=s.B(t,o);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const o=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const d=t[o];d==="reload"?this.reloadSource(o):d==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const d of o){const y=this.getLayer(d);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,d){this.imageManager.getImages(o.images,o.scope,d),this._updateTilesForChangedImages();const y=T=>{if(T){const S=o.images.map((R=>s.I.toString(R)));T.setDependencies(o.tileID.key,o.type,S)}},v=s.B(o.source,o.scope);y(this._mergedOtherSourceCaches[v]),y(this._mergedSymbolSourceCaches[v]),o.images.some((T=>T.iconsetId))&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,o,d){this.imageManager.rasterizeImages(o,d)}getGlyphs(t,o,d){this.glyphManager.getGlyphs(o.stacks,d)}getResource(t,o,d){return s.dv(o,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):o.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(d||y||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}La.getSourceType=function(f){return lc[f]},La.setSourceType=function(f,t){lc[f]=t},La.registerForPluginStateChange=s.dw;class Cu{execute(t){const o=this._makeBuildingsQueryArea(t),d=this._makeFloorsQueryArea(t),y=t.queryRenderedFeatures(o).reduce(((O,k)=>{const U=k.properties.id;return k.properties.type!=="building"||O.some((F=>F.properties.id===U))||O.push(k),O}),[]),v=t.queryRenderedFeatures(d).reduce(((O,k)=>{const U=k.properties.id;return k.properties.type!=="floor"||O.some((F=>F.properties.id===U))||O.push(k),O}),[]),T=[t.getCenter().lng,t.getCenter().lat],S=this._findBuildingAtCenter(T,y),R=y.length>0?y[0]:null;return{floors:v.map((O=>({id:O.properties.id,name:O.properties.name,isDefault:O.properties.is_default,zIndex:O.properties.z_index,connectedFloorIds:O.properties.connected_floor_ids,conflictedFloorIds:O.properties.conflicted_floor_ids,buildingIds:O.properties.building_ids}))),building:S?{id:S.properties.id,name:S.properties.name}:{id:R.properties.id,name:R.properties.name}}}_makeBuildingsQueryArea(t){const o=t.transform.width,d=t.transform.height,y=Math.min(o,d)*(1/8),v=.5*(o-y),T=.5*(d-y);return[new s.P(v,T),new s.P(v+y,T+y)]}_makeFloorsQueryArea(t){const o=t.transform.width,d=t.transform.height;return[new s.P(0,0),new s.P(o,d)]}_findBuildingAtCenter(t,o){for(const d of o)if(d.geometry.type==="Polygon"&&this._pointInPolygon(t,d.geometry.coordinates[0]))return d;return null}_pointInPolygon(t,o){let d=!1;for(let y=0,v=o.length-1;y<o.length;v=y++){const T=o[y][0],S=o[y][1],R=o[v][1];S>t[1]!=R>t[1]&&t[0]<(o[v][0]-T)*(t[1]-S)/(R-S)+T&&(d=!d)}return d}}class km{constructor(){this._floors=new Map,this._buildings=new Map}append(t){const o=t.building;let d=!1;if(o){const y=o.id;y&&(this._buildings.set(y,o),d||this._buildings.has(y)||(d=!0))}return t.floors.forEach((y=>{const v=y.id;d||this._floors.has(v)||(d=!0),this._floors.set(v,y)})),d}clear(){this._floors.clear(),this._buildings.clear()}getFloors(t=null){const o=Array.from(this._floors.values());return t?o.filter((d=>{const y=d.buildingIds;return!!y&&y.split(";").includes(t)})):o}}class Nm{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new km}setIndoorData(t){const o=this._featuresStorage.append(t);return this._selectedBuildingId=t.building?t.building.id:null,o}setFloorId(t){const o=this._selectedFloorId!==t;return o&&(this._selectedFloorId=t),o}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const t=this._featuresStorage.getFloors(this._selectedBuildingId),o=this.getActiveFloors().find((d=>{const y=d.buildingIds;if(!y)return!1;const v=y.split(";");return!!this._selectedBuildingId&&v.includes(this._selectedBuildingId)}));return{selectedFloorId:o?o.id:null,floors:t}}getActiveFloors(t=!1){const o=this._featuresStorage.getFloors(),d=o.find((R=>R.id===this._selectedFloorId)),y=o.filter((R=>R.isDefault===!0));let v=[];if(d)return v=this._calculateCurrentActiveFloors(o,d,y,t),v;if(y.length===0){const R=this._featuresStorage.getFloors(this._selectedBuildingId);v=R.length>0?[R[0]]:[]}else v=y;const T=this._getNonConflictingLastActiveFloors(v),S=[...v,...T];return this._lastActiveFloors=S,S}hasBuildingChanged(t){return this._selectedBuildingId!==(t.building?t.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(t,o,d,y){if(!o)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,d);const v=this._getConnectedFloors(o,t);return y?this._buildExplicitSelectionFloors(o,v,d):this._buildImplicitSelectionFloors(v,d)}_getConnectedFloors(t,o){const d=t.connectedFloorIds;if(!d)return[];const y=new Set(d.split(";"));return o.filter((v=>y.has(v.id)))}_buildExplicitSelectionFloors(t,o,d){const y=[t,...o],v=this._getNonConflictingLastActiveFloors(y),T=[...y,...v],S=this._deduplicateFloors(T),R=this._getConflictingFloorIdsFrom(S),O=d.filter((U=>!R.has(U.id))),k=[...S,...O];return this._lastActiveFloors=k,k}_buildImplicitSelectionFloors(t,o){const d=this._getConflictingFloorIdsFrom(this._lastActiveFloors),y=o.filter((T=>!d.has(T.id))),v=this._deduplicateFloors([...this._lastActiveFloors,...y]);return this._lastActiveFloors=v,v}_getNonConflictingDefaultFloors(t,o){const d=this._getConflictingFloorIdsFrom(t),y=o.filter((T=>!d.has(T.id))),v=this._deduplicateFloors([...t,...y]);return this._lastActiveFloors=v,v}_deduplicateFloors(t){const o=new Set;return t.filter((d=>{const y=d.id;return!o.has(y)&&(o.add(y),!0)}))}_getConflictingFloorIdsFrom(t){const o=new Set;return t.forEach((d=>{const y=d.conflictedFloorIds;y&&y.split(";").forEach((v=>o.add(v)))})),o}_getNonConflictingLastActiveFloors(t){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const o=new Set(t.map((y=>y.id))),d=this._getConflictingFloorIdsFrom(t);return this._lastActiveFloors.filter((y=>{const v=y.id;return!o.has(v)&&!d.has(v)}))}_isFloorConflicted(t,o){const d=t.id;return o.some((y=>{const v=y.conflictedFloorIds;return!!v&&v.split(";").includes(d)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class Ru extends s.E{constructor(t){super(),s.aY(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new Nm,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(t){this._floorSelectionState.setFloorId(t)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new Cu))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);if(!t||t.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(t)){if(!t.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(t),t.building&&this._updateIndoorSelector()}else this._setIndoorData(t)}_setIndoorData(t){this._floorSelectionState.setIndoorData(t)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const t=this._floorSelectionState.getCurrentBuildingSelection(),o=t.floors.map((d=>({id:d.id,name:d.name,shortName:d.zIndex.toString(),levelOrder:d.zIndex})));this.fire(new s.z("indoorupdate",{selectedFloorId:t.selectedFloorId,floors:o}))}_updateIndoorConfig(t=!1){const o=this._floorSelectionState.getActiveFloors(t).map((d=>d.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",o])}}var xf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Fm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Bm=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,dh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,bf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Sa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Vo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,la=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Bt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Zc=[];Io(xf,Zc),Io(Bm,Zc),Io(Fm,Zc);const Xc={"_prelude_fog.vertex.glsl":bf,"_prelude_terrain.vertex.glsl":fh,"_prelude_shadow.vertex.glsl":Bt,"_prelude_fog.fragment.glsl":Sa,"_prelude_shadow.fragment.glsl":wf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Vo,"_prelude_raster_particle.glsl":la},ph={};vn("",fh),vn(Sa,bf),vn(wf,Bt),vn(Vo,""),vn(la,"");const Ul=vn(Fm,Bm),jl=xf;var mh={background:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:vn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:vn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:vn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:vn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:vn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:vn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:vn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:vn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:vn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:vn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:vn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:vn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,dh),skyboxGradient:vn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,dh),skyboxCapture:vn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:vn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:vn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:vn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:vn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:vn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:vn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Io(f,t){const o=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of o)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=d.split(" ");for(const v of y)t.includes(v)||t.push(v)}}function vn(f,t){const o=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},v=[],T=[];if(f=f.replace(o,((R,O)=>(T.push(O),""))),(t=t.replace(o,((R,O)=>(v.push(O),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Zc];Io(f,S),Io(t,S);for(const R of[...v,...T])Xc[R]||console.error(`Undefined include: ${R}`),ph[R]||(ph[R]=[],Io(Xc[R],ph[R])),S=[...S,...ph[R]];return{fragmentSource:f=f.replace(d,((R,O,k,U,F)=>(y[F]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${k} ${U} ${F};
#else
uniform ${k} ${U} u_${F};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${k} ${U} ${F} = u_${F};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${k} ${U} ${F};
#endif
`:O==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(d,((R,O,k,U,F)=>{const H=U==="float"?"vec2":U,$=F.match(/color/)?"color":H;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${k} ${U} a_${F};
#endif
`:y[F]?O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${H} a_${F};
out ${k} ${U} ${F};
#else
uniform ${k} ${U} u_${F};
#endif
`:O==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${k} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${k} ${U} ${F} = u_${F};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${k} ${U} a_${F};
    out ${k} ${U} ${F};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${H} a_${F};
#else
uniform ${k} ${U} u_${F};
#endif
`:O==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${k} ${U} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${H} a_${F};
#else
uniform ${k} ${U} u_${F};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${k} ${U} ${F} = a_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${U} ${F} = a_${F};
#else
    ${k} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${U} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${k} ${U} ${F} = u_${F};
#endif
`})),usedDefines:S,vertexIncludes:v,fragmentIncludes:T}}class fo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,d,y,v,T,S,R){this.context=t;let O=this.boundPaintVertexBuffers.length!==y.length;for(let U=0;!O&&U<y.length;U++)this.boundPaintVertexBuffers[U]!==y[U]&&(O=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let U=0;!k&&U<S.length;U++)this.boundDynamicVertexBuffers[U]!==S[U]&&(k=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||O||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==T)this.freshBind(o,d,y,v,T,S,R);else{t.bindVertexArrayOES.set(this.vao);for(const U of S)U&&(U.bind(),R&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,o,R));v&&v.dynamicDraw&&v.bind()}}freshBind(t,o,d,y,v,T,S){const R=this.context,O=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=T,o.enableAttributes(O,t),o.bind(),o.setVertexAttribPointers(O,t,v);for(const k of d)k.enableAttributes(O,t),k.bind(),k.setVertexAttribPointers(O,t,v);for(const k of T)k&&(k.enableAttributes(O,t),k.bind(),k.setVertexAttribPointers(O,t,v),S&&k.instanceCount&&k.setVertexAttribDivisor(O,t,S));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Vm(f,t){const o=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new s.ae(0,d/o).toLngLat().lat,new s.ae(0,(d+1)/o).toLngLat().lat]}function Yc(f,t,o,d,y,v,T){const S=f.context,R=S.gl,O=o.hillshadeFBO;if(!O)return;f.prepareDrawTile();const k=f.isTileAffectedByFog(t),U=f.getOrCreateProgram("hillshade",{overrideFog:k});S.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get());const F=((ie,X,re,ue)=>{const de=re.paint.get("hillshade-shadow-color"),be=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ye=re.paint.get("hillshade-highlight-color"),ve=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=re.paint.get("hillshade-accent-color"),_e=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xe=re.paint.get("hillshade-emissive-strength");let Ze=s.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Ze-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const ot=ie.style.directionalLight.properties.get("direction"),qe=s.d3(ot.x,ot.y,ot.z);Ze=s.an(qe[1])}const Oe=!ie.options.moving;return{u_matrix:ue||ie.transform.calculateProjMatrix(X.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Vm(0,X.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Ze],u_shadow:de.toPremultipliedRenderColor(be?null:re.lut),u_highlight:ye.toPremultipliedRenderColor(ve?null:re.lut),u_emissive_strength:xe,u_accent:ge.toPremultipliedRenderColor(_e?null:re.lut)}})(f,o,d,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(S,U,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:$,tileBoundsSegments:W}=f.getTileBoundsBuffers(o);U.draw(f,R.TRIANGLES,y,v,T,ki.disabled,F,d.id,H,$,W)}function Tf(f,t,o){if(!t.needsDEMTextureUpload)return;const d=f.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(o.stride);const v=o.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new s.T(d,v,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function gp(f,t,o){const d=f.context,y=d.gl;if(!t.dem)return;const v=t.dem;if(d.activeTexture.set(y.TEXTURE1),Tf(f,t,v),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=v.dim;d.activeTexture.set(y.TEXTURE0);let S=t.hillshadeFBO;if(!S){const F=new s.T(d,{width:T,height:T,data:null},y.RGBA8);F.bind(y.LINEAR,y.CLAMP_TO_EDGE),S=t.hillshadeFBO=d.createFramebuffer(T,T,!0,"renderbuffer"),S.colorAttachment.set(F.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,T,T]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:O,tileBoundsSegments:k}=f.getMercatorTileBoundsBuffers(),U=[];f.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(f,y.TRIANGLES,ei.disabled,Pi.disabled,Xi.unblended,ki.disabled,((F,H)=>{const $=H.stride,W=s.bC();return s.cd(W,0,s.al,-s.al,0,0,1),s.br(W,W,[0,-s.al,0]),{u_matrix:W,u_image:1,u_dimension:[$,$],u_zoom:F.overscaledZ}})(t.tileID,v),o.id,R,O,k),t.needsHillshadePrepare=!1}class or{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _p extends or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class yp extends or{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Um extends or{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class r_ extends or{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cl extends or{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hd extends or{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gh extends or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class vp extends or{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Mu extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class ul extends or{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class za extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class vc extends or{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ka extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class hl extends or{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ca extends or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _h extends or{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class dd extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class fd extends or{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class yh extends or{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let po=class extends or{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ss extends or{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class mr extends or{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Na extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ua extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class pd extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class xc extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ef extends or{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class md extends or{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class vh extends or{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Pu extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xp extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class dl extends or{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class bp extends dl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Du extends dl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Kc extends dl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ou extends Du{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Gl=(f,t,o)=>({u_matrix:f,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),gd=(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:o,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:R,u_frustum_bl:O,u_globe_pos:k,u_globe_radius:U,u_viewport:F,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:$});function _d(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const Fa=new class{constructor(){this.operations={}}newMorphing(f,t,o,d,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[f]={startTime:d,phase:0,duration:y,from:t,to:o,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const o=this.operations[t];for(o.phase=(f-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},yd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Qc(f,t,o){if(t===0)return 0;const d=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*d}function Co(f,t){const o=1<<f.z;return!t&&(f.x===0||f.x===o-1)||f.y===0||f.y===o-1}const bc=f=>({u_matrix:f});function Lu(f,t,o,d,y){if(y>0){const v=s.o.now(),T=(v-f.timeAdded)/y,S=t?(v-t.timeAdded)/y:-1,R=o.getSource(),O=d.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(f.tileID.overscaledZ-O),U=k&&f.refreshedUponExpiration?1:s.aA(k?T:1-S,0,1);return t?{opacity:1,mix:1-U,isFading:T<1}:{opacity:U,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class s_ extends wo{constructor(t){const o=Rr("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Ba extends wo{constructor(t){const o=Rr("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,d){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((v,T)=>{if(v[T.key]="",!this._tiles[T.key]){const S=new Ol(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[T.key]=S}return v}),{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const d=Object.values(o);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wp extends s.aO{constructor(t,o,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=d}}class bs extends s.dH{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,v]=(function(R){const O=new s.bd,k=new s.b1,U=131;O.reserve(17161),k.reserve(33800);const F=s.al/128,H=s.al+F/2,$=H+F;for(let ie=-F;ie<$;ie+=F)for(let X=-F;X<$;X+=F){const re=X<0||X>H||ie<0||ie>H?24575:0,ue=s.aA(Math.round(X),0,s.al),de=s.aA(Math.round(ie),0,s.al);O.emplaceBack(ue+re,de)}const W=(ie,X)=>{const re=X*U+ie;k.emplaceBack(re+1,re,re+U),k.emplaceBack(re+U,re+U+1,re+1)};for(let ie=1;ie<129;ie++)for(let X=1;X<129;X++)W(X,ie);return[0,129].forEach((ie=>{for(let X=0;X<130;X++)W(X,ie),W(ie,X)})),[O,k,32768]})(),T=t.context;this.gridBuffer=T.createVertexBuffer(d,s.bf.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=s.bg.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ba(o.map),this.orthoMatrix=s.bC(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const S=T.gl;this._overlapStencilMode=new Pi({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new s_(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,o,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,v=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const S=t.terrain&&t.terrain.scope,R=y.get("source"),O=v?this._mockSourceCache:t.getSourceCache(R,S);if(!O)return void s.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(o):y.get("exaggeration"),!o.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(o,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),o.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const y=o!=null?d-o:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const v=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(v);let S=v-this._previousZoom;const R=this._previousUpdateTimestamp;let O=v;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(v-O)>.5&&(S=.5*(v-O+S)),S*y<0&&(O+=S)),this._evaluationZoom=O;const k=T.getExaggeration(O),U=k===T.getExaggeration(Math.max(0,O-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let F=Math.min(.1,.00375*(this._updateTimestamp-R));return(U||k<.1||Math.abs(S)<1e-4)&&(F=Math.min(.2,4*F)),s.ak(this._exaggeration,k,F)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=o.getIds().map((R=>{const O=o.getTileByID(R).tileID;return O.projMatrix=d.calculateProjMatrix(O.toUnwrapped()),O}));(function(R,O){const k=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new s.P(k.x,k.y);R.sort(((F,H)=>{if(H.overscaledZ-F.overscaledZ)return H.overscaledZ-F.overscaledZ;const $=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),W=new s.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ie=U.mult(1<<F.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr($)-ie.distSqr(W)}))})(y,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},y.forEach((R=>{this.proxyToSource[R.key]={}})),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const R in T){const O=T[R];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[R],v),O.usedForTerrain))continue;const k=t[R];O.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[o.id]=y.map((R=>new wp(R,R.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const O=this.terrainTileForTile[R.key];if(!O)continue;const k=O.tileID.key;k in S||(this._visibleDemTiles.push(O),S[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach((o=>{if(this.terrainTileForTile[o.key])return;const d=this._findTileCoveringTileID(o,this.sourceCache);d&&(this.terrainTileForTile[o.key]=d)}))}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Tf(this.painter,y,v))}}_prepareDemTileUniforms(t,o,d,y){if(!o||o.demTexture==null)return!1;const v=t.tileID.canonical,T=Math.pow(2,o.tileID.canonical.z-v.z),S=y||"";return d[`u_dem_tl${S}`]=[v.x*T%1,v.y*T%1],d[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce(((d,y)=>{if(!y.dem)return d;const v=y.dem.tree.minimums[0];return v>0&&t++,d+v}),0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new s.dI({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new s.T(t,y,o.R32F,{premultiply:!1}),v}setupElevationDraw(t,o,d){const y=this.painter.context,v=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let S=null,R=null,O=1;if(d&&d.morphing&&this._useVertexMorphing){const H=d.morphing.srcDemTile,$=d.morphing.dstDemTile;O=d.morphing.phase,H&&$&&(this._prepareDemTileUniforms(t,H,T,"_prev")&&(R=H),this._prepareDemTileUniforms(t,$,T)&&(S=$))}const k=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let U=null;var F;if(this.enabled?R&&S?(U=S.demTexture,y.activeTexture.set(v.TEXTURE4),R.demTexture.bind(k(R),v.CLAMP_TO_EDGE),T.u_dem_lerp=O):(S=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,S,T)?S.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,y.activeTexture.set(v.TEXTURE2),U&&(T.u_dem_size=(F=U).size[0]===1?1:F.size[0]-2,U.bind(k(S),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,o,T),d&&d.useMeterToDem&&S){const H=(1<<S.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=H}if(d&&d.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),o.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);o.setGlobeUniformValues(y,H)}}globeUniformValues(t,o,d){const y=t.projection;return{u_tile_tl_up:y.upVector(o,0,0),u_tile_tr_up:y.upVector(o,s.al,0),u_tile_br_up:y.upVector(o,s.al,s.al),u_tile_bl_up:y.upVector(o,0,s.al),u_tile_up_scale:d?s.dJ(1):y.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,v,T,S,R){if(y.transform.projection.name==="globe")(function(O,k,U,F,H){const $=O.context,W=$.gl;let ie,X;const re=O.transform,ue=s.dA(O,$,re),de=(ot,qe)=>{if(X===qe)return;const nt=[yd[qe],"PROJECTION_GLOBE_VIEW"];ue&&nt.push("CUSTOM_ANTIALIASING");const zt=O.isTileAffectedByFog(ot);ie=O.getOrCreateProgram("globeRaster",{defines:nt,overrideFog:zt}),X=qe},be=O.colorModeForRenderPass(),ye=new ei(W.LEQUAL,ei.ReadWrite,O.depthRangeFor3D);Fa.update(H);const ve=s.dB(re),ge=[s.aF(re.center.lng),s.aJ(re.center.lat)],_e=O.globeSharedBuffers,xe=[re.width*s.o.devicePixelRatio,re.height*s.o.devicePixelRatio],Ze=Float32Array.from(re.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};{const ot=O.transform,qe=Qc(ot.zoom,k.exaggeration(),k.sourceCache._source.tileSize);X=-1;const nt=W.TRIANGLES;for(const zt of F){const He=U.getTile(zt),Pe=Pi.disabled,lt=k.prevTerrainTileForTile[zt.key],Ke=k.terrainTileForTile[zt.key];_d(lt,Ke)&&Fa.newMorphing(zt.key,lt,Ke,H,250),$.activeTexture.set(W.TEXTURE0),He.texture&&He.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const yt=Fa.getMorphValuesForProxy(zt.key),Rt=yt?1:0;yt&&Object.assign(Oe,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:s.dz(yt.phase)}});const Yt=s.dC(zt.canonical),Mt=s.dD(Yt.getCenter().lat),Tt=s.dE(zt.canonical,Yt,Mt,ot.worldSize/ot._pixelsPerMercatorPixel),_i=s.bk(s.dF(zt.canonical)),li=gd(ot.expandedFarZProjMatrix,Ze,ve,_i,s.aj(ot.zoom),ge,ot.frustumCorners.TL,ot.frustumCorners.TR,ot.frustumCorners.BR,ot.frustumCorners.BL,ot.globeCenterInViewSpace,ot.globeRadius,xe,qe,ot._farZ,Tt);if(de(zt,Rt),ie&&(k.setupElevationDraw(He,ie,Oe),O.uploadCommonUniforms($,ie,zt.toUnwrapped()),_e)){const[fi,ci,Fi]=_e.getGridBuffers(Mt,qe!==0);ie.draw(O,nt,ye,Pe,be,ki.backCCW,li,"globe_raster",fi,ci,Fi)}}}if(_e&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const ot=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&ot.push("CUSTOM_ANTIALIASING"),ie=O.getOrCreateProgram("globeRaster",{defines:ot});for(const qe of F){const{x:nt,y:zt,z:He}=qe.canonical,Pe=zt===0,lt=zt===(1<<He)-1,[Ke,yt,Rt,Yt]=_e.getPoleBuffers(He,!1);if(Yt&&(Pe||lt)){const Mt=U.getTile(qe);$.activeTexture.set(W.TEXTURE0),Mt.texture&&Mt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Tt=s.dG(He,nt,re);const _i=s.bk(s.dF(qe.canonical)),li=(fi,ci)=>fi.draw(O,W.TRIANGLES,ye,Pi.disabled,be,ki.disabled,gd(re.expandedFarZProjMatrix,Tt,Tt,_i,0,ge,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,xe,0,re._farZ),"globe_pole_raster",ci,Rt,Yt);k.setupElevationDraw(Mt,ie,Oe),O.uploadCommonUniforms($,ie,qe.toUnwrapped()),Pe&&O.renderDefaultNorthPole&&li(ie,Ke),lt&&O.renderDefaultSouthPole&&(Tt=s.cR(s.bC(),Tt,[1,-1,1]),li(ie,yt))}}}})(y,v,T,S,R);else{const O=y.context,k=O.gl;let U,F;const H=y.shadowRenderer,$=Au(y,y.longestCutoffRange),W=be=>{if(F===be)return;const ye=[];ye.push(yd[be]),$.shouldRenderCutoff&&ye.push("RENDER_CUTOFF"),H&&(ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&ye.push("NORMAL_OFFSET")),U=y.getOrCreateProgram("terrainRaster",{defines:ye}),F=be},ie=y.colorModeForRenderPass(),X=new ei(k.LEQUAL,ei.ReadWrite,y.depthRangeFor3D);Fa.update(R);const re=y.transform,ue=Qc(re.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let de=[0,0,0];if(H){const be=y.style.directionalLight,ye=y.style.ambientLight;be&&ye&&(de=ll(y.style,be,ye))}{F=-1;const be=k.TRIANGLES,[ye,ve]=[v.gridIndexBuffer,v.gridSegments];for(const ge of S){const _e=T.getTile(ge),xe=Pi.disabled,Ze=v.prevTerrainTileForTile[ge.key],Oe=v.terrainTileForTile[ge.key];_d(Ze,Oe)&&Fa.newMorphing(ge.key,Ze,Oe,R,250),O.activeTexture.set(k.TEXTURE0),_e.texture&&_e.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const ot=Fa.getMorphValuesForProxy(ge.key),qe=ot?1:0;let nt;ot&&(nt={morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:s.dz(ot.phase)}});const zt=Gl(ge.projMatrix,Co(ge.canonical,re.renderWorldCopies)?ue/10:ue,de);if(W(qe),!U)continue;v.setupElevationDraw(_e,U,nt);const He=ge.toUnwrapped();H&&H.setupShadows(He,U),y.uploadCommonUniforms(O,U,He,null,$),U.draw(y,be,X,xe,ie,ki.backCCW,zt,"terrain_raster",v.gridBuffer,ye,ve)}}}})(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,d=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),S=o.style.order,R=[];let O=0;for(const k of v){const U=y.getTileByID(k.proxyTileKey),F=y.proxyCachedFBO[k.key]?y.proxyCachedFBO[k.key][t]:void 0,H=F!==void 0?y.renderCache[F]:this.pool[O++],$=F!==void 0;if(U.texture=H.tex,$&&!H.dirty){R.push(U.tileID);continue}let W;d.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(d.clear({color:s.ao.transparent,stencil:0}),H.dirty=!1);for(let ie=T.start;ie<=T.end;++ie){const X=o.style._mergedLayers[S[ie]];if(X.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(X),ue=re?this.proxyToSource[k.key][re.id]:[k];if(!ue)continue;const de=ue;d.viewport.set([0,0,H.fb.width,H.fb.height]),W!==(re?re.id:null)&&(this._setupStencil(H,ue,X,re),W=re?re.id:null),o.renderLayer(o,re,X,de)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const X=o.style._mergedLayers[S[ie]];if(X.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(X),ue=re?this.proxyToSource[k.key][re.id]:[k];if(!ue)continue;const de=ue;d.viewport.set([0,0,H.fb.width,H.fb.height]),W!==(re?re.id:null)&&(this._setupStencil(H,ue,X,re),W=re?re.id:null),o.renderLayer(o,re,X,de)}this.renderedToTile?(H.dirty=!0,R.push(U.tileID)):$||--O,O===5&&(O=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let d=-1,y=o;for(let v=0;v<o;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?d=Math.max(d,v):y=Math.min(y,v);return y>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((o=>o.dem)).forEach((o=>{t=Math.min(t,o.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,o,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((v=>v.dem)).map((v=>{const T=v.tileID,S=1<<T.overscaledZ,{x:R,y:O}=T.canonical,k=R/S,U=(R+1)/S,F=O/S,H=(O+1)/S;return{minx:k,miny:F,maxx:U,maxy:H,t:v.dem.tree.raycastRoot(k,F,U,H,t,o,d),tile:v}}));y.sort(((v,T)=>(v.t!==null?v.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE)));for(const v of y){if(v.t==null)return null;const T=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,o,d);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,o=t.gl,d=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const y=new s.T(t,{width:d[0],height:d[1],data:null},o.RGBA8);y.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=t.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(y.texture),v.depthAttachment=new Ou(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const o=this._style._mergedLayers[t],d=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!d&&o.shouldRedrape():!d&&o.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Kr){t=!0;break}if(!t)return;const o={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(y);if(v&&!o[v.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof s.ad){o[v.id]=!0;for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][v.id];if(S)for(const R of S)this._clearRenderCacheForTile(v.id,R)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof ds){t=!0;break}if(!t)return;const o={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(y);if(!v||o[v.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const R=this.proxyToSource[S.key][v.id];if(R)for(const O of R){const k=Lu(v.getTile(O),v.findLoadedParent(O,0),v,this.painter.transform,T);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(v.id,O)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,v=0,T=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++v<o;)T=this._style._mergedLayers[t[v]];for(;v<o;++v){const S=this._style._mergedLayers[t[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?y===void 0&&(y=v):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),y!==void 0&&(d.push({start:y,end:v-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:v-1}),d.length!==0){const S=d[d.length-1];this._pendingGroundEffectLayers.every((R=>R>S.end))||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const T=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<T.length;++S){const R=Object.values(T[S]);o.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let T=d.length-1;T>=0;T--){const S=d[T];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const R=t[S.key],O=this.proxyToSource[S.key];let k=0;for(const U in O){const F=O[U],H=R[U];if(!H||H.length!==F.length||F.some((($,W)=>$!==H[W]||y[U]&&y[U].hasOwnProperty($.key)))){k=-1;break}++k}for(const U in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][U]].dirty=k<0||k!==Object.values(R).length}}const v=[...this._drapedRenderBatches];v.sort(((T,S)=>S.end-S.start-(T.end-T.start)));for(const T of v)for(const S of d){if(o.proxyCachedFBO[S.key])continue;let R=o.renderCachePool.pop();R===void 0&&o.renderCache.length<50&&(R=o.renderCache.length,o.renderCache.push(this._createFBO())),R!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][T.start]=R,o.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,T=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=o.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Pi.disabled}_renderTileClippingMasks(t,o){const d=this.painter,y=this.painter.context,v=y.gl;d._tileClippingMaskIDs={},y.setColorMode(Xi.disabled),y.setDepthMode(ei.disabled);const T=d.getOrCreateProgram("clippingMask");for(const S of t){const R=d._tileClippingMaskIDs[S.key]=--o;T.draw(d,v.TRIANGLES,ei.disabled,new Pi({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),Xi.disabled,ki.disabled,bc(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const d=[t.x,t.y,1,1];s.aC(d,d,o.pixelMatrixInverse),s.cJ(d,d,1/d[3]),d[0]/=o.worldSize,d[1]/=o.worldSize;const y=o._camera.position,v=s.ce(1,o.center.lat),T=[y[0],y[1],y[2]/v,0],S=s.d9([],d.slice(0,3),T);s.aw(S,S);const R=this.raycast(T,S,this._exaggeration);return R!==null&&R?(s.bH(T,T,S,R),T[3]=T[2],T[2]*=v,T):null}_setupProxiedCoordsForOrtho(t,o,d){if(t.getSource()instanceof s.aS)return this._setupProxiedCoordsForImageSource(t,o,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let R=0;R<v.length;R++){const O=v[R],k=this._findTileCoveringTileID(O,t);if(k){const U=this._createProxiedId(O,k,d[O.key]&&d[O.key][t.id]);y.push(U),this.proxyToSource[O.key][t.id]=[U]}}let T=!1;const S=new Set;for(let R=0;R<o.length;R++){const O=t.getTile(o[R]);if(!O||!O.hasData())continue;const k=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==O.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][t.id],F=this._createProxiedId(k.tileID,O,d[k.tileID.key]&&d[k.tileID.key][t.id]);U?U.splice(U.length-1,0,F):this.proxyToSource[k.tileID.key][t.id]=[F];const H=this.proxyToSource[k.tileID.key][t.id];S.has(H)||S.add(H),y.push(F),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const R of S)R.sort(((O,k)=>k.overscaledZ-O.overscaledZ))}_setupProxiedCoordsForImageSource(t,o,d){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],v=this.proxyCoords,T=t.getSource(),S=T.tileID;if(!S)return;const R=new s.P(S.x,S.y)._div(1<<S.z),O=T.coordinates.map(s.ae.fromLngLat).reduce(((U,F)=>(U.min.x=Math.min(U.min.x,F.x-R.x),U.min.y=Math.min(U.min.y,F.y-R.y),U.max.x=Math.max(U.max.x,F.x-R.x),U.max.y=Math.max(U.max.y,F.y-R.y),U)),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,F)=>{const H=U.wrap+U.canonical.x/(1<<U.canonical.z),$=U.canonical.y/(1<<U.canonical.z),W=s.al/(1<<U.canonical.z),ie=F.wrap+F.canonical.x/(1<<F.canonical.z),X=F.canonical.y/(1<<F.canonical.z);return H+W<ie+O.min.x||H>ie+O.max.x||$+W<X+O.min.y||$>X+O.max.y};for(let U=0;U<v.length;U++){const F=v[U];for(let H=0;H<o.length;H++){const $=t.getTile(o[H]);if(!$||!$.hasData()||k(F,$.tileID))continue;const W=this._createProxiedId(F,$,d[F.key]&&d[F.key][t.id]),ie=this.proxyToSource[F.key][t.id];ie?ie.push(W):this.proxyToSource[F.key][t.id]=[W],y.push(W)}}}_createProxiedId(t,o,d){let y=this.orthoMatrix;if(d){const v=d.find((T=>T.key===o.tileID.key));if(v)return v}if(o.tileID.key!==t.key){const v=t.canonical.z-o.tileID.canonical.z;let T,S,R;y=s.bC();const O=o.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(T=s.al>>v,S=T*((o.tileID.canonical.x<<v)-t.canonical.x+O),R=T*((o.tileID.canonical.y<<v)-t.canonical.y)):(T=s.al<<-v,S=s.al*(o.tileID.canonical.x-(t.canonical.x+O<<-v)),R=s.al*(o.tileID.canonical.y-(t.canonical.y<<-v))),s.cd(y,0,T,0,T,0,1),s.br(y,y,[S,R,0])}return new wp(o.tileID,t.key,y)}_findTileCoveringTileID(t,o){let d=o.getTile(t);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[o.id],v=y[t.key];if(d=v?o.getTileByID(v):null,d&&d.hasData()||v===null)return d;let T=d?d.tileID:t,S=T.overscaledZ;const R=o.getSource().minzoom,O=[];if(!v){const U=o.getSource().maxzoom;if(t.canonical.z>=U){const F=t.canonical.z-U;o.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,o.transform.tileZoom),T=new s.aO(S,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(S=U,T=new s.aO(S,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F))}T.key!==t.key&&(O.push(T.key),d=o.getTile(T))}const k=U=>{O.forEach((F=>{y[F]=U})),O.length=0};for(S-=1;S>=R&&(!d||!d.hasData());S--){d&&k(d.tileID.key);const U=T.calculateScaledKey(S);if(d=o.getTileByID(U),d&&d.hasData())break;const F=y[U];if(F===null)break;F===void 0?O.push(U):d=o.getTileByID(F)}return k(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[o.key]=!0}}function vd(f,t,o){const d=(function(S,R,O){const k=s.bJ(R,S),U=s.bJ(O,[.2126,.7152,.0722]),F=($,W,ie)=>(1-ie)*$+ie*W,H=F(1-.3*Math.min(U,1),1,Math.min(k+1,1));return F(.92,1,Math.asin(s.aA(R[2],-1,1))/Math.PI+.5)*H})(f,[0,0,1],t),y=[0,0,0];s.c4(y,o.slice(0,3),d);const v=[0,0,0];s.c4(v,t.slice(0,3),f[2]);const T=[0,0,0];return s.d7(T,y,v),s.da(T)}const xh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],bh=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class xd{static cacheKey(t,o,d,y){let v=`${o}${y?y.cacheKey:""}`;for(const T of d)t.usedDefines.includes(T)&&(v+=`/${T}`);return v}constructor(t,o,d,y,v,T){const S=t.gl;this.program=S.createProgram(),this.configuration=y,this.name=o,this.fixedDefines=[...T];let R=y?y.defines():[];R=R.concat(T.map(($=>`#define ${$}`)));const O=`#version 300 es
`;let k=O+R.concat("precision mediump float;",jl,Ul.fragmentSource).join(`
`);for(const $ of d.fragmentIncludes)k+=`
${Xc[$]}`;k+=`
${d.fragmentSource}`;let U=O+R.concat("precision highp float;",jl,Ul.vertexSource).join(`
`);for(const $ of d.vertexIncludes)U+=`
${Xc[$]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const F=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(F,k),S.compileShader(F),S.attachShader(this.program,F);const H=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(H,U),S.compileShader(H),S.attachShader(this.program,H),this.attributes={},S.linkProgram(this.program),S.deleteShader(H),S.deleteShader(F),this.fixedUniforms=v(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=($=>({u_instanceID:new s.cg($)}))(t)),(T.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=($=>({u_dem:new s.cg($),u_dem_prev:new s.cg($),u_dem_tl:new s.cj($),u_dem_scale:new s.ci($),u_dem_tl_prev:new s.cj($),u_dem_scale_prev:new s.ci($),u_dem_size:new s.ci($),u_dem_lerp:new s.ci($),u_exaggeration:new s.ci($),u_depth:new s.cg($),u_depth_size_inv:new s.cj($),u_depth_range_unpack:new s.cj($),u_occluder_half_size:new s.ci($),u_occlusion_depth_offset:new s.ci($),u_meter_to_dem:new s.ci($),u_label_plane_matrix_inv:new s.ck($)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new s.ch($),u_tile_tr_up:new s.ch($),u_tile_br_up:new s.ch($),u_tile_bl_up:new s.ch($),u_tile_up_scale:new s.ci($)}))(t)),T.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new s.ck($),u_fog_range:new s.cj($),u_fog_color:new s.d2($),u_fog_horizon_blend:new s.ci($),u_fog_vertical_limit:new s.cj($),u_fog_temporal_offset:new s.ci($),u_frustum_tl:new s.ch($),u_frustum_tr:new s.ch($),u_frustum_br:new s.ch($),u_frustum_bl:new s.ch($),u_globe_pos:new s.ch($),u_globe_radius:new s.ci($),u_globe_transition:new s.ci($),u_is_globe:new s.cg($),u_viewport:new s.cj($)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new s.d2($)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new s.ch($),u_lighting_directional_dir:new s.ch($),u_lighting_directional_color:new s.ch($),u_ground_radiance:new s.ch($)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new s.ck($),u_light_matrix_1:new s.ck($),u_fade_range:new s.cj($),u_shadow_normal_offset:new s.ch($),u_shadow_intensity:new s.ci($),u_shadow_texel_size:new s.ci($),u_shadow_map_resolution:new s.ci($),u_shadow_direction:new s.ch($),u_shadow_bias:new s.ch($),u_shadowmap_0:new s.cg($),u_shadowmap_1:new s.cg($)}))(t)))}getAttributeLocation(t,o){let d=this.attributes[o];return d===void 0&&(d=this.attributes[o]=t.getAttribLocation(this.program,o)),d}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)d[y]&&d[y].set(this.program,y,o[y])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)d[y]&&d[y].set(this.program,y,o[y])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)d[y].set(this.program,y,o[y])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)d[y].set(this.program,y,o[y])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)d[y].set(this.program,y,o[y])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const y in o)d[y].set(this.program,y,o[y])}_drawDebugWireframe(t,o,d,y,v,T,S,R,O,k){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const F=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!xh.includes(this.name))||!(!U.layers3D||!bh.includes(this.name))))return;const H=F.gl,$=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,F);if(!$)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const ie=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});F.program.set(ie.program);const X=(de,be,ye)=>{if(be[de]&&ye[de])for(const ve in be[de])ye[de][ve]&&ye[de][ve].set(ye.program,ve,be[de][ve].current)};O&&O.setUniforms(ie.program,F,ie.binderUniforms,S,{zoom:R}),X("fixedUniforms",this,ie),X("terrainUniforms",this,ie),X("globeUniforms",this,ie),X("fogUniforms",this,ie),X("lightsUniforms",this,ie),X("shadowUniforms",this,ie),$.bind(),F.setColorMode(new Xi([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],s.ao.transparent,[!0,!0,!0,!1])),F.setDepthMode(new ei(o.func===H.LESS?H.LEQUAL:o.func,ei.ReadOnly,o.range)),F.setStencilMode(Pi.disabled);const re=3*T.primitiveLength*2,ue=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=k||1;for(let be=0;be<de;++be)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,ue)}else k&&k>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,ue,k):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,ue);v.bind(),F.program.set(this.program),F.setDepthMode(o),F.setStencilMode(d),F.setColorMode(y)}checkUniforms(t,o,d){if(this.fixedDefines.includes(o)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${o} being defined`)}}draw(t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie){const X=t.context,re=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(d),X.setStencilMode(y),X.setColorMode(v),X.setCullFace(T);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,S[be]);$&&$.setUniforms(this.program,X,this.binderUniforms,F,{zoom:H});const ue={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[o];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const de=ie&&ie>0?1:void 0;for(const be of U.get()){const ye=be.vaos||(be.vaos={});if((ye[R]||(ye[R]=new fo)).bind(X,this,O,$?$.getPaintVertexBuffers():[],k,be.vertexOffset,W||[],de),this.forceManualRenderingForInstanceIDShaders){const ve=ie||1;for(let ge=0;ge<ve;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),k?re.drawElements(o,be.primitiveLength*ue,re.UNSIGNED_SHORT,be.primitiveOffset*ue*2):re.drawArrays(o,be.vertexOffset,be.vertexLength)}else ie&&ie>1?re.drawElementsInstanced(o,be.primitiveLength*ue,re.UNSIGNED_SHORT,be.primitiveOffset*ue*2,ie):k?re.drawElements(o,be.primitiveLength*ue,re.UNSIGNED_SHORT,be.primitiveOffset*ue*2):re.drawArrays(o,be.vertexOffset,be.vertexLength);o===re.TRIANGLES&&k&&this._drawDebugWireframe(t,d,y,v,k,be,F,H,$,ie)}}}function wc(f,t,o=0){const d=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,f.transform.tileZoom)/d,v=y*(t.tileID.canonical.x+t.tileID.wrap*d),T=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T],u_pattern_transition:o}}const ql={terrain:0,flat:1},jm=s.bC(),bd=(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X)=>{const re=t.style.light,ue=re.properties.get("position"),de=[ue.x,ue.y,ue.z],be=s.dL();re.properties.get("anchor")==="viewport"&&(s.dM(be,-t.transform.angle),s.dN(de,de,be));const ye=re.properties.get("color").toPremultipliedRenderColor(null),ve=t.transform,ge={u_matrix:f,u_lightpos:de,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+o,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ql[O],u_base_type:ql[k],u_ao:y,u_edge_radius:v,u_width_scale:T,u_flood_light_color:$,u_vertical_scale:W,u_flood_light_intensity:ie,u_ground_shadow_factor:X};return ve.projection.name==="globe"&&(ge.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ge.u_zoom_transition=U,ge.u_inv_rot_matrix=H,ge.u_merc_center=F,ge.u_up_dir=ve.projection.upVector(new s.cC(0,0,0),F[0]*s.al,F[1]*s.al),ge.u_height_lift=R),ge},Gm=(f,t,o,d,y,v)=>({u_matrix:f,u_edge_radius:t,u_width_scale:o,u_vertical_scale:d,u_height_type:ql[y],u_base_type:ql[v]}),qm=(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X)=>{const re=bd(f,t,o,d,y,v,T,S,O,k,U,F,H,$,W,ie,1,[0,0,0]),ue={u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8};return Object.assign(re,wc(t,R,X),ue)},Jc=(f,t,o)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:o}),eu=(f,t,o,d,y,v=0)=>Object.assign(Jc(f,t,y),wc(o,d,v)),Tp=(f,t,o,d)=>({u_matrix:f,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:d}),o_=(f,t,o,d,y,v,T=0)=>Object.assign(eu(f,t,o,d,v,T),{u_world:y}),wd=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),Td=(f,t,o,d,y)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:d,u_reset_depth:y}),Ep=(f,t,o,d,y,v,T)=>({u_matrix:f,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:d,u_camera_pos:y,u_tile_to_meter:v,u_facade_emissive_chance:T}),Sp=f=>({u_matrix:f}),Ap=f=>({u_matrix:f}),Ip=(f,t,o,d,y,v,T,S)=>{const R=s.al/v.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(S),u_extrude_scale:[o.pixelsToGLUnits[0]/R,o.pixelsToGLUnits[1]/R],u_zoom_transition:d,u_tile_id:T,u_merc_center:y}},tu=(f,t,o=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:o}),fl=s.bC(),Hm=(f,t,o,d,y,v,T)=>{const S=f.transform,R=S.projection.name==="globe",O=R?s.dO(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:s.ay(o,1,v),k={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:T,u_inv_rot_matrix:fl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){k.u_inv_rot_matrix=d,k.u_merc_center=y,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=s.aj(S.zoom);const U=y[0]*s.al,F=y[1]*s.al;k.u_up_dir=S.projection.upVector(new s.cC(0,0,0),U,F)}return k};function Cp(f,[t,o,d,y],[v,T]){if(v===T)return[0,0,0,0];const S=255*(f-1)/(f*(T-v));return[t*S,o*S,d*S,y*S]}function zu(f,t,[o,d]){return o===d?0:.5/f+(t-o)*(f-1)/(f*(d-o))}const ku=(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re,ue,de)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:s.dQ(U.paint.get("raster-saturation")),u_contrast_factor:s.dP(U.paint.get("raster-contrast")),u_spin_weights:Tc(U.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:H,u_zoom_transition:T,u_merc_center:S,u_cutoff_params:R,u_colorization_mix:Cp(s.dR,W,X),u_colorization_offset:zu(s.dR,ie,X),u_color_ramp:$,u_texture_offset:[ue/(re+2*ue),re/(re+2*ue)],u_texture_res:[re+2*ue,re+2*ue],u_emissive_strength:de});function Tc(f){f*=Math.PI/180;const t=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Hl=.05,Wl=(f,t,o,d,y,v,T,S,R,O,k,U)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:T,u_merc_center:S,u_cutoff_params:R}),Rp=(f,t,o,d,y,v,T,S,R,O)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:d,u_color_ramp:v,u_velocity_res:y,u_max_speed:T,u_uv_offset:S,u_data_scale:[255*R[0],255*R[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hl,Hl]}),Ec=(f,t,o,d,y,v,T,S,R,O)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:d,u_max_speed:y,u_speed_factor:v,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*R[0],255*R[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hl,Hl]}),Mp=s.bC(),Sc=(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re,ue,de,be,ye,ve)=>{const ge=y.transform,_e={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ge.getCameraToCenterDistance(re),u_rotate_symbol:+o,u_aspect_ratio:ge.width/ge.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+O,u_elevation_from_sea:R?1:0,u_pitch_with_map:+d,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mp,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:ye||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(re)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:ue,u_inv_matrix:s.bl(s.bC(),T),u_normal_scale:de,u_lutTexture:rs.LUT};return re.name==="globe"&&(_e.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],_e.u_zoom_transition=$,_e.u_inv_rot_matrix=ie,_e.u_merc_center=W,_e.u_camera_forward=ge._camera.forward(),_e.u_ecef_origin=s.dS(ge.globeMatrix,H.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(ge.globeMatrix),_e.u_up_vector=X),_e},Ed=(f,t,o,d)=>({u_matrix:f,u_emissive_strength:t,u_opacity:o,u_color:d}),Sd=(f,t,o,d,y,v,T,S,R)=>Object.assign((function(O,k,U,F,H,$){const{width:W,height:ie}=F.imageManager.getPixelSize(k),X=Math.pow(2,$.tileID.overscaledZ),re=$.tileSize*Math.pow(2,F.transform.tileZoom)/X,ue=re*($.tileID.canonical.x+$.tileID.wrap*X),de=re*$.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[W,ie],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:H?[F.transform.width,-1*F.transform.height]:[1/s.ay($,1,F.transform.tileZoom),1/s.ay($,1,F.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,de>>16],u_pixel_coord_lower:[65535&ue,65535&de]}})(0,v,T,d,S,R),{u_matrix:f,u_emissive_strength:t,u_opacity:o}),Ac=new Float32Array(s.bA([])),$l=(f,t,o,d,y,v,T,S,R,O,k,U,F,H=[0,0,0],$)=>{const W=y.style.light,ie=W.properties.get("position"),X=[-ie.x,-ie.y,ie.z],re=s.dL();W.properties.get("anchor")==="viewport"&&(s.dM(re,-y.transform.angle),s.dN(X,X,re));const ue=k.alphaMode==="MASK",de=W.properties.get("color").toNonPremultipliedRenderColor(null),be=F.paint.get("model-ambient-occlusion-intensity"),ye=F.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return ye.a=F.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:d||Ac,u_lightpos:X,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:H,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:O,u_baseColorTexture:rs.BaseColor,u_metallicRoughnessTexture:rs.MetallicRoughness,u_normalTexture:rs.Normal,u_occlusionTexture:rs.Occlusion,u_emissionTexture:rs.Emission,u_lutTexture:rs.LUT,u_color_mix:ye.toArray01(),u_aoIntensity:be,u_emissive_strength:U,u_occlusionTextureTransform:$||[0,0,0,0]}},Ic=(f,t=Ac,o=Ac)=>({u_matrix:f,u_instance:t,u_node_matrix:o}),Wm={fillExtrusion:f=>({u_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_vertical_gradient:new s.ci(f),u_opacity:new s.ci(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_ao:new s.cj(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_up_dir:new s.ch(f),u_height_lift:new s.ci(f),u_flood_light_color:new s.ch(f),u_vertical_scale:new s.ci(f),u_flood_light_intensity:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new s.ck(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_vertical_scale:new s.ci(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_vertical_gradient:new s.ci(f),u_height_factor:new s.ci(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_ao:new s.cj(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_up_dir:new s.ch(f),u_height_lift:new s.ci(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_opacity:new s.ci(f),u_pattern_transition:new s.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.ck(f),u_opacity:new s.ci(f),u_ao_pass:new s.ci(f),u_meter_to_tile:new s.ci(f),u_ao:new s.cj(f),u_flood_light_intensity:new s.ci(f),u_flood_light_color:new s.ch(f),u_attenuation:new s.ci(f),u_edge_radius:new s.ci(f),u_fb:new s.cg(f),u_fb_size:new s.ci(f),u_dynamic_offset:new s.ci(f)}),fill:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),fillPattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_pattern_transition:new s.ci(f)}),fillOutline:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_world:new s.cj(f),u_ground_shadow_factor:new s.ch(f)}),fillOutlinePattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_world:new s.cj(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_pattern_transition:new s.ci(f)}),building:f=>({u_matrix:new s.ck(f),u_normal_matrix:new s.ck(f),u_opacity:new s.ci(f),u_faux_facade_ao_intensity:new s.ci(f),u_camera_pos:new s.ch(f),u_tile_to_meter:new s.ci(f),u_facade_emissive_chance:new s.ci(f)}),buildingBloom:f=>({u_matrix:new s.ck(f)}),buildingDepth:f=>({u_matrix:new s.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.ck(f),u_depth_bias:new s.ci(f)}),elevatedStructures:f=>({u_matrix:new s.ck(f),u_ground_shadow_factor:new s.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.ck(f),u_camera_pos:new s.ch(f),u_depth_bias:new s.ci(f),u_height_scale:new s.ci(f),u_reset_depth:new s.ci(f)}),circle:s.dV,collisionBox:f=>({u_matrix:new s.ck(f),u_inv_rot_matrix:new s.ck(f),u_camera_to_center_distance:new s.ci(f),u_extrude_scale:new s.cj(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_tile_id:new s.ch(f)}),collisionCircle:f=>({u_matrix:new s.ck(f),u_inv_matrix:new s.ck(f),u_camera_to_center_distance:new s.ci(f),u_viewport_size:new s.cj(f)}),debug:f=>({u_color:new s.dx(f),u_matrix:new s.ck(f),u_overlay:new s.cg(f),u_overlay_scale:new s.ci(f)}),clippingMask:f=>({u_matrix:new s.ck(f)}),heatmap:f=>({u_extrude_scale:new s.ci(f),u_intensity:new s.ci(f),u_matrix:new s.ck(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_up_dir:new s.ch(f)}),heatmapTexture:f=>({u_image:new s.cg(f),u_color_ramp:new s.cg(f),u_opacity:new s.ci(f)}),hillshade:f=>({u_matrix:new s.ck(f),u_image:new s.cg(f),u_latrange:new s.cj(f),u_light:new s.cj(f),u_shadow:new s.dx(f),u_highlight:new s.dx(f),u_emissive_strength:new s.ci(f),u_accent:new s.dx(f)}),hillshadePrepare:f=>({u_matrix:new s.ck(f),u_image:new s.cg(f),u_dimension:new s.cj(f),u_zoom:new s.ci(f)}),line:s.dU,linePattern:s.dT,raster:f=>({u_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_grid_matrix:new s.dy(f),u_tl_parent:new s.cj(f),u_scale_parent:new s.ci(f),u_fade_t:new s.ci(f),u_opacity:new s.ci(f),u_image0:new s.cg(f),u_image1:new s.cg(f),u_brightness_low:new s.ci(f),u_brightness_high:new s.ci(f),u_saturation_factor:new s.ci(f),u_contrast_factor:new s.ci(f),u_spin_weights:new s.ch(f),u_perspective_transform:new s.cj(f),u_raster_elevation:new s.ci(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_cutoff_params:new s.d2(f),u_colorization_mix:new s.d2(f),u_colorization_offset:new s.ci(f),u_color_ramp:new s.cg(f),u_texture_offset:new s.cj(f),u_texture_res:new s.cj(f),u_emissive_strength:new s.ci(f)}),rasterParticle:f=>({u_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_grid_matrix:new s.dy(f),u_tl_parent:new s.cj(f),u_scale_parent:new s.ci(f),u_fade_t:new s.ci(f),u_opacity:new s.ci(f),u_image0:new s.cg(f),u_image1:new s.cg(f),u_raster_elevation:new s.ci(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_cutoff_params:new s.d2(f)}),rasterParticleTexture:f=>({u_texture:new s.cg(f),u_opacity:new s.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.cg(f),u_particle_texture_side_len:new s.ci(f),u_tile_offset:new s.cj(f),u_velocity:new s.cg(f),u_color_ramp:new s.cg(f),u_velocity_res:new s.cj(f),u_max_speed:new s.ci(f),u_uv_offset:new s.cj(f),u_data_scale:new s.cj(f),u_data_offset:new s.ci(f),u_particle_pos_scale:new s.ci(f),u_particle_pos_offset:new s.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.cg(f),u_particle_texture_side_len:new s.ci(f),u_velocity:new s.cg(f),u_velocity_res:new s.cj(f),u_max_speed:new s.ci(f),u_speed_factor:new s.ci(f),u_reset_rate:new s.ci(f),u_rand_seed:new s.ci(f),u_uv_offset:new s.cj(f),u_data_scale:new s.cj(f),u_data_offset:new s.ci(f),u_particle_pos_scale:new s.ci(f),u_particle_pos_offset:new s.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new s.cg(f),u_is_size_feature_constant:new s.cg(f),u_size_t:new s.ci(f),u_size:new s.ci(f),u_camera_to_center_distance:new s.ci(f),u_rotate_symbol:new s.cg(f),u_aspect_ratio:new s.ci(f),u_fade_change:new s.ci(f),u_matrix:new s.ck(f),u_label_plane_matrix:new s.ck(f),u_coord_matrix:new s.ck(f),u_is_text:new s.cg(f),u_elevation_from_sea:new s.cg(f),u_pitch_with_map:new s.cg(f),u_texsize:new s.cj(f),u_texsize_icon:new s.cj(f),u_texture:new s.cg(f),u_texture_icon:new s.cg(f),u_gamma_scale:new s.ci(f),u_device_pixel_ratio:new s.ci(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_camera_forward:new s.ch(f),u_tile_matrix:new s.ck(f),u_up_vector:new s.ch(f),u_ecef_origin:new s.ch(f),u_is_halo:new s.cg(f),u_icon_transition:new s.ci(f),u_color_adj_mat:new s.ck(f),u_scale_factor:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_inv_matrix:new s.ck(f),u_normal_scale:new s.ci(f),u_lutTexture:new s.cg(f)}),background:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_opacity:new s.ci(f),u_color:new s.dx(f)}),backgroundPattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_opacity:new s.ci(f),u_image:new s.cg(f),u_pattern_tl:new s.cj(f),u_pattern_br:new s.cj(f),u_texsize:new s.cj(f),u_pattern_size:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_pattern_units_to_pixels:new s.cj(f)}),terrainRaster:f=>({u_matrix:new s.ck(f),u_image0:new s.cg(f),u_skirt_height:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),skybox:f=>({u_matrix:new s.ck(f),u_sun_direction:new s.ch(f),u_cubemap:new s.cg(f),u_opacity:new s.ci(f),u_temporal_offset:new s.ci(f)}),skyboxGradient:f=>({u_matrix:new s.ck(f),u_color_ramp:new s.cg(f),u_center_direction:new s.ch(f),u_radius:new s.ci(f),u_opacity:new s.ci(f),u_temporal_offset:new s.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dy(f),u_sun_direction:new s.ch(f),u_sun_intensity:new s.ci(f),u_color_tint_r:new s.d2(f),u_color_tint_m:new s.d2(f),u_luminance:new s.ci(f)}),globeRaster:f=>({u_proj_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_image0:new s.cg(f),u_grid_matrix:new s.dy(f),u_skirt_height:new s.ci(f),u_far_z_cutoff:new s.ci(f),u_frustum_tl:new s.ch(f),u_frustum_tr:new s.ch(f),u_frustum_br:new s.ch(f),u_frustum_bl:new s.ch(f),u_globe_pos:new s.ch(f),u_globe_radius:new s.ci(f),u_viewport:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ch(f),u_frustum_tr:new s.ch(f),u_frustum_br:new s.ch(f),u_frustum_bl:new s.ch(f),u_horizon:new s.ci(f),u_transition:new s.ci(f),u_fadeout_range:new s.ci(f),u_atmosphere_fog_color:new s.d2(f),u_high_color:new s.d2(f),u_space_color:new s.d2(f),u_temporal_offset:new s.ci(f),u_horizon_angle:new s.ci(f)}),model:f=>({u_matrix:new s.ck(f),u_lighting_matrix:new s.ck(f),u_normal_matrix:new s.ck(f),u_node_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_camera_pos:new s.ch(f),u_opacity:new s.ci(f),u_baseColorFactor:new s.d2(f),u_emissiveFactor:new s.d2(f),u_metallicFactor:new s.ci(f),u_roughnessFactor:new s.ci(f),u_baseTextureIsAlpha:new s.cg(f),u_alphaMask:new s.cg(f),u_alphaCutoff:new s.ci(f),u_baseColorTexture:new s.cg(f),u_metallicRoughnessTexture:new s.cg(f),u_normalTexture:new s.cg(f),u_occlusionTexture:new s.cg(f),u_emissionTexture:new s.cg(f),u_lutTexture:new s.cg(f),u_color_mix:new s.d2(f),u_aoIntensity:new s.ci(f),u_emissive_strength:new s.ci(f),u_occlusionTextureTransform:new s.d2(f)}),modelDepth:f=>({u_matrix:new s.ck(f),u_instance:new s.ck(f),u_node_matrix:new s.ck(f)}),groundShadow:f=>({u_matrix:new s.ck(f),u_ground_shadow_factor:new s.ch(f)}),stars:f=>({u_matrix:new s.ck(f),u_up:new s.ch(f),u_right:new s.ch(f),u_intensity_multiplier:new s.ci(f)}),snowParticle:f=>({u_modelview:new s.ck(f),u_projection:new s.ck(f),u_time:new s.ci(f),u_cam_pos:new s.ch(f),u_velocityConeAperture:new s.ci(f),u_velocity:new s.ci(f),u_horizontalOscillationRadius:new s.ci(f),u_horizontalOscillationRate:new s.ci(f),u_boxSize:new s.ci(f),u_billboardSize:new s.ci(f),u_simpleShapeParameters:new s.cj(f),u_screenSize:new s.cj(f),u_thinningCenterPos:new s.cj(f),u_thinningShape:new s.ch(f),u_thinningAffectedRatio:new s.ci(f),u_thinningParticleOffset:new s.ci(f),u_particleColor:new s.d2(f),u_direction:new s.ch(f)}),rainParticle:f=>({u_modelview:new s.ck(f),u_projection:new s.ck(f),u_time:new s.ci(f),u_cam_pos:new s.ch(f),u_texScreen:new s.cg(f),u_velocityConeAperture:new s.ci(f),u_velocity:new s.ci(f),u_boxSize:new s.ci(f),u_rainDropletSize:new s.cj(f),u_distortionStrength:new s.ci(f),u_rainDirection:new s.ch(f),u_color:new s.d2(f),u_screenSize:new s.cj(f),u_thinningCenterPos:new s.cj(f),u_thinningShape:new s.ch(f),u_thinningAffectedRatio:new s.ci(f),u_thinningParticleOffset:new s.ci(f),u_shapeDirectionalPower:new s.ci(f),u_shapeNormalPower:new s.ci(f),u_mode:new s.ci(f)}),vignette:f=>({u_vignetteShape:new s.ch(f),u_vignetteColor:new s.d2(f)}),occlusion:f=>({u_matrix:new s.ck(f),u_anchorPos:new s.ch(f),u_screenSizePx:new s.cj(f),u_occluderSizePx:new s.cj(f),u_color:new s.d2(f)})};class Cc{constructor(t,o,d,y){this.id=Cc.uniqueIdxCounter,Cc.uniqueIdxCounter++,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Cc.uniqueIdxCounter,Cc.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Cc.uniqueIdxCounter=0;const Ad={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sf{constructor(t,o,d,y,v,T){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let d=0;d<this.attributes.length;d++){const y=o.getAttributeLocation(t,this.attributes[d].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,o,d){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],T=o.getAttributeLocation(t,v.name);T!==-1&&t.vertexAttribPointer(T,v.components,t[Ad[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,o,d){for(let y=0;y<this.attributes.length;y++){const v=o.getAttributeLocation(t,this.attributes[y].name);v!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Af{constructor(t,o,d,y,v){this.context=t,this.width=o,this.height=d;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new bp(t,T)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Du(t,T):new Kc(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Pp{constructor(t,o){this.gl=t,this.clearColor=new _p(this),this.clearDepth=new yp(this),this.clearStencil=new Um(this),this.colorMask=new r_(this),this.depthMask=new cl(this),this.stencilMask=new hd(this),this.stencilFunc=new gh(this),this.stencilOp=new vp(this),this.stencilTest=new Mu(this),this.depthRange=new ul(this),this.depthTest=new za(this),this.depthFunc=new vc(this),this.blend=new ka(this),this.blendFunc=new hl(this),this.blendColor=new ca(this),this.blendEquation=new _h(this),this.cullFace=new dd(this),this.cullFaceSide=new fd(this),this.frontFace=new yh(this),this.program=new po(this),this.activeTexture=new ss(this),this.viewport=new mr(this),this.bindFramebuffer=new Na(this),this.bindRenderbuffer=new ua(this),this.bindTexture=new pd(this),this.bindVertexBuffer=new xc(this),this.bindElementBuffer=new Ef(this),this.bindVertexArrayOES=new md(this),this.pixelStoreUnpack=new vh(this),this.pixelStoreUnpackPremultiplyAlpha=new Pu(this),this.pixelStoreUnpackFlipY=new xp(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,d){return new Cc(this,t,o,d)}createVertexBuffer(t,o,d,y,v){return new Sf(this,t,o,d,y,v)}createRenderbuffer(t,o,d){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,t,o,d),this.bindRenderbuffer.set(null),v}createFramebuffer(t,o,d,y){return new Af(this,t,o,d,y)}clear({color:t,depth:o,stencil:d,colorMask:y}){const v=this.gl;let T=0;t&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),o!==void 0&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.by(t.blendFunction,Xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ha;function Nu(f,t,o,d,y,v,T){const S=f.context,R=S.gl,O=f.transform,k=[s.aF(O.center.lng),s.aJ(O.center.lat)],U=o.layout.get("symbol-placement"),F=o.layout.get("text-variable-anchor"),H=o.layout.get("icon-rotation-alignment")==="map",$=o.layout.get("text-rotation-alignment")==="map",W=U!=="point",ie=[];let X=0,re=0;for(let _e=0;_e<d.length;_e++){const xe=d[_e],Ze=t.getTile(xe),Oe=Ze.getBucket(o);if(!Oe)continue;const ot=Oe.getProjection().createInversionMatrix(O,xe.canonical),qe=[],nt=fc(xe,Oe,O),zt=!T&&H&&W,He=T&&$&&W,Pe=F&&Oe.hasTextData(),lt=Oe.hasIconTextFit()&&Pe&&Oe.hasIconData(),Ke=zt||He||T&&Pe||lt,yt=Oe.projection.name==="globe",Rt=yt?s.aj(O.zoom):0;yt&&(qe.push("PROJECTION_GLOBE_VIEW"),Ke&&qe.push("PROJECTED_POS_ON_VIEWPORT"));const Yt=f.getOrCreateProgram("collisionBox",{defines:qe});let Mt=nt;y[0]===0&&y[1]===0||(Mt=f.translatePosMatrix(nt,Ze,y,v));const Tt=T?Oe.textCollisionBox:Oe.iconCollisionBox,_i=Oe.collisionCircleArray;if(_i.length>0){const fi=s.bC(),ci=Mt;s.cO(fi,Oe.placementInvProjMatrix,O.glCoordMatrix),s.cO(fi,fi,Oe.placementViewportMatrix),ie.push({circleArray:_i,circleOffset:re,transform:ci,invTransform:fi,projection:Oe.getProjection()}),X+=_i.length/4,re=X}if(!Tt)continue;f.terrain&&f.terrain.setupElevationDraw(Ze,Yt);const li=yt?[xe.canonical.x,xe.canonical.y,1<<xe.canonical.z]:[0,0,0];Yt.draw(f,R.LINES,ei.disabled,Pi.disabled,f.colorModeForRenderPass(),ki.disabled,Ip(Mt,ot,O,Rt,k,Ze,li,Oe.getProjection()),o.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,null,O.zoom,null,[Tt.collisionVertexBuffer,Tt.collisionVertexBufferExt])}if(!T||!ie.length)return;const ue=f.getOrCreateProgram("collisionCircle"),de=new s.dW;de.resize(4*X),de._trim();let be=0;for(const _e of ie)for(let xe=0;xe<_e.circleArray.length/4;xe++){const Ze=4*xe,Oe=_e.circleArray[Ze+0],ot=_e.circleArray[Ze+1],qe=_e.circleArray[Ze+2],nt=_e.circleArray[Ze+3];de.emplace(be++,Oe,ot,qe,nt,0),de.emplace(be++,Oe,ot,qe,nt,1),de.emplace(be++,Oe,ot,qe,nt,2),de.emplace(be++,Oe,ot,qe,nt,3)}(!ha||ha.length<2*X)&&(ha=(function(_e){const xe=2*_e,Ze=new s.b1;Ze.resize(xe),Ze._trim();for(let Oe=0;Oe<xe;Oe++){const ot=6*Oe;Ze.uint16[ot+0]=4*Oe+0,Ze.uint16[ot+1]=4*Oe+1,Ze.uint16[ot+2]=4*Oe+2,Ze.uint16[ot+3]=4*Oe+2,Ze.uint16[ot+4]=4*Oe+3,Ze.uint16[ot+5]=4*Oe+0}return Ze})(X));const ye=S.createIndexBuffer(ha,!0),ve=S.createVertexBuffer(de,s.dX.members,!0);for(const _e of ie){const xe={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ge=O).getCameraToCenterDistance(_e.projection),u_viewport_size:[ge.width,ge.height]};ue.draw(f,R.TRIANGLES,ei.disabled,Pi.disabled,f.colorModeForRenderPass(),ki.disabled,xe,o.id,ve,ye,s.bg.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,O.zoom)}var ge;ve.destroy(),ye.destroy()}const iu=s.bC();function If(f){const t=f._camera.getWorldToCamera(f.worldSize,1),o=s.aB([],t,f.globeMatrix);s.bl(o,o);const d=[0,0,0],y=[0,1,0,0];return s.aC(y,y,o),d[0]=y[0],d[1]=y[1],d[2]=y[2],s.aw(d,d),d}function Id({width:f,height:t,anchor:o,textOffset:d,textScale:y},v){const{horizontalAlign:T,verticalAlign:S}=s.c0(o),R=-(T-.5)*f,O=-(S-.5)*t,k=s.c1(o,d);return new s.P((R/y+k[0])*v,(O/y+k[1])*v)}function Uo(f,t,o,d,y,v,T,S,R,O){const k=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,F=f.icon.dynamicLayoutVertexArray,H={},$=f.getProjection(),W=Eo(T,$,y),ie=y.elevation,X=$.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;U.clear();for(let re=0;re<k.length;re++){const ue=k.get(re),{tileAnchorX:de,tileAnchorY:be,numGlyphs:ye}=ue,ve=ue.hidden||!ue.crossTileID||f.allowVerticalPlacement&&!ue.placedOrientation?null:d[ue.crossTileID];if(ve){let ge=0,_e=0,xe=0;if(ie){const lt=ie?ie.getAtTileOffset(T,de,be):0,[Ke,yt,Rt]=$.upVector(T.canonical,de,be);ge=lt*Ke*X,_e=lt*yt*X,xe=lt*Rt*X}let[Ze,Oe,ot,qe]=Ps(ue.projectedAnchorX+ge,ue.projectedAnchorY+_e,ue.projectedAnchorZ+xe,o?W:v);const nt=al(y.getCameraToCenterDistance($),qe);let zt=s.bM(f.textSizeData,R,ue)*nt/s.bX;o&&(zt*=f.tilePixelRatio/S);const He=Id(ve,zt);o?({x:Ze,y:Oe,z:ot}=$.projectTilePoint(de+He.x,be+He.y,T.canonical),[Ze,Oe,ot]=Ps(Ze+ge,Oe+_e,ot+xe,v)):(t&&He._rotate(-y.angle),Ze+=He.x,Oe+=He.y,ot=0);const Pe=f.allowVerticalPlacement&&ue.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let lt=0;lt<ye;lt++)s.bO(U,Ze,Oe,ot,Pe);O&&ue.associatedIconIndex>=0&&(H[ue.associatedIconIndex]={x:Ze,y:Oe,z:ot,angle:Pe})}else Ii(ye,U)}if(O){F.clear();const re=f.icon.placedSymbolArray;for(let ue=0;ue<re.length;ue++){const de=re.get(ue),{numGlyphs:be}=de,ye=H[ue];if(de.hidden||!ye)Ii(be,F);else{const{x:ve,y:ge,z:_e,angle:xe}=ye;for(let Ze=0;Ze<be;Ze++)s.bO(F,ve,ge,_e,xe)}}f.icon.dynamicLayoutVertexBuffer.updateData(F)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function jo(f,t,o,d,y,v,T={}){const S=o.paint.get("icon-translate"),R=o.paint.get("text-translate"),O=o.paint.get("icon-translate-anchor"),k=o.paint.get("text-translate-anchor"),U=o.layout.get("icon-rotation-alignment"),F=o.layout.get("text-rotation-alignment"),H=o.layout.get("icon-pitch-alignment"),$=o.layout.get("text-pitch-alignment"),W=o.layout.get("icon-keep-upright"),ie=o.layout.get("text-keep-upright"),X=o.paint.get("icon-color-saturation"),re=o.paint.get("icon-color-contrast"),ue=o.paint.get("icon-color-brightness-min"),de=o.paint.get("icon-color-brightness-max"),be=o.layout.get("symbol-elevation-reference")==="sea",ye=o.layout.get("icon-image-use-theme")==="none",ve=f.context,ge=ve.gl,_e=f.transform,xe=U==="map",Ze=F==="map",Oe=H==="map",ot=$==="map",qe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let nt=!1;const zt=f.depthModeForSublayer(0,ei.ReadOnly),He=new ei(f.context.gl.LEQUAL,ei.ReadOnly,f.depthRangeFor3D),Pe=[s.aF(_e.center.lng),s.aJ(_e.center.lat)],lt=o.layout.get("text-variable-anchor"),Ke=_e.projection.name==="globe",yt=[],Rt=[0,-1,0];for(const Yt of d){const Mt=t.getTile(Yt),Tt=Mt.getBucket(o);if(!Tt||Tt.projection.name==="mercator"&&Ke||Tt.fullyClipped)continue;const _i=Tt.projection.name==="globe",li=_i?s.aj(_e.zoom):0,fi=Eo(Yt,Tt.getProjection(),_e),ci=_e.calculatePixelsToTileUnitsMatrix(Mt),Fi=lt&&Tt.hasTextData(),bi=Tt.hasIconTextFit()&&Fi&&Tt.hasIconData(),Ei=Tt.getProjection().createInversionMatrix(_e,Yt.canonical),Ni=(1<<Mt.tileID.canonical.z)*s.al/f.transform.worldSize,ui=zn=>{let qi=[0,0,0];if(zn){const Ci=f.style.directionalLight,yn=f.style.ambientLight;Ci&&yn&&(qi=ll(f.style,Ci,yn))}return qi},Vi=zn=>{_e.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||f.terrain)&&(zn.push("DEPTH_D24"),zn.push("DEPTH_OCCLUSION"))},_n=zn=>{o.lut&&!ye&&(o.lut.texture||(o.lut.texture=new s.dY(f.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+rs.LUT),o.lut.texture&&o.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),zn.push("APPLY_LUT_ON_GPU"))},qn=()=>{const zn=xe&&o.layout.get("symbol-placement")!=="point",qi=[];Vi(qi),_n(qi);const Ci=zn||bi,yn=Tt.elevationType==="road",Mr=f.shadowRenderer,fr=yn&&Oe&&!!Mr&&Mr.enabled,as=ui(fr),As=yn&&Oe&&!f.terrain?He:zt,Wo=o.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Oe&&qi.push("PITCH_WITH_MAP_TERRAIN"),_i&&(qi.push("PROJECTION_GLOBE_VIEW"),Ci&&qi.push("PROJECTED_POS_ON_VIEWPORT")),Wo>0&&Tt.hasAnySecondaryIcon&&qi.push("ICON_TRANSITION"),!Tt.icon.zOffsetVertexBuffer||yn&&f.terrain||qi.push("Z_OFFSET"),X===0&&re===0&&ue===0&&de===1||qi.push("COLOR_ADJUSTMENT"),Tt.sdfIcons&&qi.push("RENDER_SDF"),fr&&qi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yn&&Oe&&!f.terrain&&Tt.icon.orientationVertexBuffer&&qi.push("ELEVATED_ROADS");const Js=Tt.icon.programConfigurations.get(o.id),Lr=f.getOrCreateProgram("symbol",{config:Js,defines:qi}),qs=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],Hs=Tt.iconSizeData,eo=s.bK(Hs,_e.zoom),Ga=Oe||!_e.isOrthographic,zr=sa(fi,Mt.tileID.canonical,Oe,xe,_e,Tt.getProjection(),ci),$r=qc(fi,Mt.tileID.canonical,Oe,xe,_e,Tt.getProjection(),ci),cr=f.translatePosMatrix($r,Mt,S,O,!0),cs=f.translatePosMatrix(fi,Mt,S,O),Sr=Ci?iu:zr,is=xe&&!Oe&&!zn;let Vr=Rt;!Ke&&!_e.mercatorFromTransition||xe||(Vr=If(_e));const Kl=_i?Vr:Rt,Pc=o.getColorAdjustmentMatrix(X,re,ue,de),Ql=Sc(Hs.kind,eo,is,Oe,f,cs,Sr,cr,be,!1,qs,[0,0],0,Yt,li,Pe,Ei,Kl,Tt.getProjection(),as,Ni,Pc,Wo,null),fa=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,Jl=o.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear,_l=Tt.sdfIcons||f.options.rotating||f.options.zooming||Jl||Ga?ge.LINEAR:ge.NEAREST,ec=Tt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Dc=f.terrain&&Oe&&zn?s.bl(s.bC(),zr):iu;if(zn&&Tt.icon){const tc=_e.elevation,Oc=tc?tc.getAtTileOffsetFunc(Yt,_e.center.lat,_e.worldSize,Tt.getProjection()):null,Gf=ol(fi,Mt.tileID.canonical,Oe,xe,_e,Tt.getProjection(),ci);Hc(Tt,fi,f,!1,Gf,$r,Oe,W,Oc,Yt)}return{program:Lr,buffers:Tt.icon,uniformValues:Ql,atlasTexture:fa,atlasTextureIcon:null,atlasInterpolation:_l,atlasInterpolationIcon:null,isSDF:Tt.sdfIcons,hasHalo:ec,depthMode:As,tile:Mt,renderWithShadows:fr,labelPlaneMatrixInv:Dc}},Gi=()=>{const zn=Ze&&o.layout.get("symbol-placement")!=="point",qi=[],Ci=zn||lt||bi,yn=Tt.elevationType==="road",Mr=f.shadowRenderer,fr=yn&&ot&&!!Mr&&Mr.enabled,as=ui(fr),As=yn&&ot&&!f.terrain?He:zt;f.terrainRenderModeElevated()&&ot&&qi.push("PITCH_WITH_MAP_TERRAIN"),_i&&(qi.push("PROJECTION_GLOBE_VIEW"),Ci&&qi.push("PROJECTED_POS_ON_VIEWPORT")),!Tt.text.zOffsetVertexBuffer||yn&&f.terrain||qi.push("Z_OFFSET"),Tt.iconsInText&&qi.push("RENDER_TEXT_AND_SYMBOL"),qi.push("RENDER_SDF"),fr&&qi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yn&&ot&&!f.terrain&&Tt.text.orientationVertexBuffer&&qi.push("ELEVATED_ROADS"),Vi(qi);const Wo=Tt.text.programConfigurations.get(o.id),Js=f.getOrCreateProgram("symbol",{config:Wo,defines:qi});let Lr,qs=[0,0],Hs=null;const eo=Tt.textSizeData;Tt.iconsInText&&(qs=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],Hs=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,Lr=ot||!_e.isOrthographic||f.options.rotating||f.options.zooming||eo.kind==="composite"||eo.kind==="camera"?ge.LINEAR:ge.NEAREST);const Ga=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture.size:[0,0],zr=o.layout.get("text-size-scale-range"),$r=s.aA(f.scaleFactor,zr[0],zr[1]),cr=s.bK(eo,_e.zoom,$r),cs=sa(fi,Mt.tileID.canonical,ot,Ze,_e,Tt.getProjection(),ci),Sr=qc(fi,Mt.tileID.canonical,ot,Ze,_e,Tt.getProjection(),ci),is=f.translatePosMatrix(Sr,Mt,R,k,!0),Vr=f.translatePosMatrix(fi,Mt,R,k),Kl=Ci?iu:cs,Pc=Ze&&!ot&&!zn;let Ql=Rt;!Ke&&!_e.mercatorFromTransition||Ze||(Ql=If(_e));const fa=Sc(eo.kind,cr,Pc,ot,f,Vr,Kl,is,be,!0,Ga,qs,0,Yt,li,Pe,Ei,_i?Ql:Rt,Tt.getProjection(),as,Ni,null,null,$r),Jl=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture:null,_l=ge.LINEAR,ec=o.paint.get("text-halo-width").constantOr(1)!==0,Dc=f.terrain&&ot&&zn?s.bl(s.bC(),cs):iu;if(zn&&Tt.text){const tc=_e.elevation,Oc=tc?tc.getAtTileOffsetFunc(Yt,_e.center.lat,_e.worldSize,Tt.getProjection()):null,Gf=ol(fi,Mt.tileID.canonical,ot,Ze,_e,Tt.getProjection(),ci);Hc(Tt,fi,f,!0,Gf,Sr,ot,ie,Oc,Yt)}return{program:Js,buffers:Tt.text,uniformValues:fa,atlasTexture:Jl,atlasTextureIcon:Hs,atlasInterpolation:_l,atlasInterpolationIcon:Lr,isSDF:!0,hasHalo:ec,depthMode:As,tile:Mt,renderWithShadows:fr,labelPlaneMatrixInv:Dc}},Mn=Tt.icon.segments.get().length,xn=Tt.text.segments.get().length,Qi=Mn&&!T.onlyText?qn():null,$n=xn&&!T.onlyIcons?Gi():null,vr=o.paint.get("icon-opacity").constantOr(1),ws=o.paint.get("text-opacity").constantOr(1);if(qe&&Tt.canOverlap){nt=!0;const zn=vr&&!T.onlyText?Tt.icon.segments.get():[],qi=ws&&!T.onlyIcons?Tt.text.segments.get():[];for(const Ci of zn)yt.push({segments:new s.bg([Ci]),sortKey:Ci.sortKey,state:Qi});for(const Ci of qi)yt.push({segments:new s.bg([Ci]),sortKey:Ci.sortKey,state:$n})}else T.onlyText||yt.push({segments:vr?Tt.icon.segments:new s.bg([]),sortKey:0,state:Qi}),T.onlyIcons||yt.push({segments:ws?Tt.text.segments:new s.bg([]),sortKey:0,state:$n})}nt&&yt.sort(((Yt,Mt)=>Yt.sortKey-Mt.sortKey));for(const Yt of yt){const Mt=Yt.state;if(Mt)if(f.terrain?f.terrain.setupElevationDraw(Mt.tile,Mt.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Mt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,Mt.program),ve.activeTexture.set(ge.TEXTURE0),Mt.atlasTexture&&Mt.atlasTexture.bind(Mt.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),Mt.atlasTextureIcon&&(ve.activeTexture.set(ge.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),Mt.renderWithShadows&&f.shadowRenderer.setupShadows(Mt.tile.tileID.toUnwrapped(),Mt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Mt.program),Mt.hasHalo){const Tt=Mt.uniformValues;Tt.u_is_halo=1,Zl(Mt.buffers,Yt.segments,o,f,Mt.program,Mt.depthMode,y,v,Tt,2),Tt.u_is_halo=0}else{if(Mt.isSDF){const Tt=Mt.uniformValues;Mt.hasHalo&&(Tt.u_is_halo=1,Zl(Mt.buffers,Yt.segments,o,f,Mt.program,Mt.depthMode,y,v,Tt,1)),Tt.u_is_halo=0}Zl(Mt.buffers,Yt.segments,o,f,Mt.program,Mt.depthMode,y,v,Mt.uniformValues,1)}}}function Zl(f,t,o,d,y,v,T,S,R,O){const k=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,v,T,S,ki.disabled,R,o.id,f.layoutVertexBuffer,f.indexBuffer,t,o.paint,d.transform.zoom,f.programConfigurations.get(o.id),k,O)}function Dp(f,t){const o=1<<f.canonical.z,d=(t.x*o-f.canonical.x-f.wrap*o)*s.al,y=(t.y*o-f.canonical.y)*s.al,v=s.e5(t.z,t.y);return s.d4(d,y,v)}function Fu(f,t,o,d,y){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const v=f.context.gl,T=new ei(f.context.gl.LEQUAL,ei.ReadWrite,f.depthRangeFor3D),S=new ei(f.context.gl.GREATER,ei.ReadWrite,f.depthRangeFor3D),R=(function(H){let $=.01;return H.isOrthographic&&($=s.ak(1e-4,$,s.c$(H.pitch>=gc?1:H.pitch/gc))),2*$})(f.transform),O=f.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",U=f.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),F=f.getOrCreateProgram(k);for(const H of d){const $=t.getTile(H),W=$.getBucket(o);if(!W)continue;const ie=W.elevatedStructures;if(!ie)continue;const X=W.elevationBufferData.heightRange,re=Dp(H.toUnwrapped(),O),ue=f.translatePosMatrix(H.projMatrix,$,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let de,be,ye,ve;if(y==="initialize"){if(!X||X.min>=1||ie.depthSegments.segments[0].primitiveLength===0)continue;de=Td(ue,re,R,1,0),be=T,ye=ie.depthSegments,ve=U}else if(y==="reset"){if(!X||X.min>=0||ie.maskSegments.segments[0].primitiveLength===0)continue;de=Td(ue,re,0,0,1),be=S,ye=ie.maskSegments,ve=U}else if(y==="geometry"){if(ie.depthSegments.segments[0].primitiveLength===0)continue;de=Td(ue,re,R,1,0),be=T,ye=ie.depthSegments,ve=F}ve.draw(f,v.TRIANGLES,be,Pi.disabled,Xi.disabled,ki.disabled,de,o.id,ie.vertexBuffer,ie.indexBuffer,ye,o.paint,f.transform.zoom)}}function Va(f,t,o){const{painter:d,sourceCache:y,layer:v,coords:T,colorMode:S,elevationType:R,terrainEnabled:O,pass:k}=f,U=d.context.gl,F=v.paint.get("fill-pattern"),H=v.paint.get("fill-pattern-cross-fade"),$=F.constantOr(null);let W=R;R!=="road"||t&&!O||(W="none");const ie=W==="road",X=f.painter.shadowRenderer,re=ie&&!!X&&X.enabled,ue=new ei(d.context.gl.LEQUAL,ei.ReadOnly,d.depthRangeFor3D);let de=[0,0,0];if(re){const ve=d.style.directionalLight,ge=d.style.ambientLight;ve&&ge&&(de=ll(d.style,ve,ge))}const be=F&&F.constantOr(1),ye=(ve,ge)=>{let _e,xe,Ze,Oe,ot;ge?(_e=be&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ze=U.LINES):(_e=be?"fillPattern":"fill",Ze=U.TRIANGLES);for(const qe of T){const nt=y.getTile(qe);if(be&&!nt.patternsLoaded())continue;const zt=nt.getBucket(v);if(!zt)continue;const He=t?zt.elevationBufferData:zt.bufferData;if(He.isEmpty())continue;d.prepareDrawTile();const Pe=He.programConfigurations.get(v.id),lt=d.isTileAffectedByFog(qe),Ke=[],yt=[];ie&&(Ke.push("ELEVATED_ROADS"),yt.push(He.elevatedLayoutVertexBuffer)),re&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),be&&(d.context.activeTexture.set(U.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Pe.updatePaintBuffers());let Rt=!1;if($&&nt.imageAtlas){const li=nt.imageAtlas,fi=s.e0.from($),ci=fi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Fi=fi.getSecondary(),bi=li.patternPositions.get(ci),Ei=Fi?li.patternPositions.get(Fi.scaleSelf(s.o.devicePixelRatio).toString()):null;Rt=!!bi&&!!Ei,bi&&Pe.setConstantPatternPositions(bi,Ei)}H>0&&(Rt||Pe.getPatternTransitionVertexBuffer("fill-pattern"))&&Ke.push("FILL_PATTERN_TRANSITION");const Yt=d.getOrCreateProgram(_e,{config:Pe,overrideFog:lt,defines:Ke}),Mt=d.translatePosMatrix(qe.projMatrix,nt,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));re&&X.setupShadows(nt.tileID.toUnwrapped(),Yt,"vector-tile");const Tt=v.paint.get("fill-emissive-strength");if(ge){Oe=He.lineIndexBuffer,ot=He.lineSegments;const li=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];xe=_e==="fillOutlinePattern"&&be?o_(Mt,Tt,d,nt,li,de,H):Tp(Mt,Tt,li,de)}else Oe=He.indexBuffer,ot=He.triangleSegments,xe=be?eu(Mt,Tt,d,nt,de,H):Jc(Mt,Tt,de);d.uploadCommonUniforms(d.context,Yt,qe.toUnwrapped());let _i=ve;(R==="road"&&!O||R==="offset")&&(_i=ue),Yt.draw(d,Ze,_i,o||d.stencilModeForClipping(qe),S,ki.disabled,xe,v.id,He.layoutVertexBuffer,Oe,ot,v.paint,d.transform.zoom,Pe,yt)}};d.renderPass===k&&ye(d.depthModeForSublayer(1,d.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly),!1),W==="none"&&d.renderPass==="translucent"&&v.paint.get("fill-antialias")&&ye(d.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly),!0)}function Xt(f,t,o,d,y,v,T,S){o.resetLayerRenderingStats(f);const R=f.context,O=R.gl,k=f.transform,U=o.paint.get("fill-extrusion-pattern"),F=o.paint.get("fill-extrusion-pattern-cross-fade"),H=U.constantOr(null),$=U.constantOr(1),W=o.paint.get("fill-extrusion-opacity"),ie=f.style.enable3dLights(),X=o.paint.get(ie&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],ue=o.layout.get("fill-extrusion-edge-radius"),de=ue>0&&!o.paint.get("fill-extrusion-rounded-roof"),be=de?0:ue,ye=k.projection.name==="globe"?s.e8():0,ve=k.projection.name==="globe",ge=ve?s.aj(k.zoom):0,_e=[s.aF(k.center.lng),s.aJ(k.center.lat)],xe=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ze=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:o.lut).toArray01().slice(0,3),Oe=o.paint.get("fill-extrusion-flood-light-intensity"),ot=o.paint.get("fill-extrusion-vertical-scale"),qe=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,nt=o.paint.get("fill-extrusion-height-alignment"),zt=o.paint.get("fill-extrusion-base-alignment"),He=Au(f,o.paint.get("fill-extrusion-cutoff-fade-range")),Pe=[];let lt;ve&&Pe.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Pe.push("FAUX_AO"),de&&Pe.push("ZERO_ROOF_RADIUS"),S&&Pe.push("HAS_CENTROID"),Oe>0&&Pe.push("FLOOD_LIGHT"),He.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),qe&&Pe.push("RENDER_WALL_MODE");const Ke=f.renderPass==="shadow",yt=f.shadowRenderer,Rt=Ke&&!!yt,Yt=Ke?ki.disabled:ki.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Mt=[0,0,0];if(yt){const li=f.style.directionalLight,fi=f.style.ambientLight;li&&fi&&(Mt=ll(f.style,li,fi)),Ke||(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&Pe.push("NORMAL_OFFSET")),lt=Pe.concat(["SHADOWS_SINGLE_CASCADE"])}const Tt=Rt?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",_i=o.getLayerRenderingStats();for(const li of d){const fi=t.getTile(li),ci=fi.getBucket(o);if(!ci||ci.projection.name!==k.projection.name)continue;let Fi=!1;yt&&(Fi=yt.getMaxCascadeForTile(li.toUnwrapped())===0);const bi=f.isTileAffectedByFog(li),Ei=ci.programConfigurations.get(o.id);let Ni=!1;if(H&&fi.imageAtlas){const xn=fi.imageAtlas,Qi=s.e0.from(H),$n=Qi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),vr=Qi.getSecondary(),ws=xn.patternPositions.get($n),zn=vr?xn.patternPositions.get(vr.scaleSelf(s.o.devicePixelRatio).toString()):null;Ni=!!ws&&!!zn,ws&&Ei.setConstantPatternPositions(ws,zn)}F>0&&(Ni||Ei.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Pe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const ui=f.getOrCreateProgram(Tt,{config:Ei,defines:Fi?lt:Pe,overrideFog:bi});if(f.terrain&&f.terrain.setupElevationDraw(fi,ui,{useMeterToDem:!0}),!ci.centroidVertexBuffer){const xn=ui.getAttributeLocation(O,"a_centroid_pos");xn!==-1&&O.vertexAttrib2f(xn,0,0)}!Ke&&yt&&yt.setupShadows(fi.tileID.toUnwrapped(),ui,"vector-tile"),$&&(f.context.activeTexture.set(O.TEXTURE0),fi.imageAtlasTexture&&fi.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ei.updatePaintBuffers());const Vi=o.paint.get("fill-extrusion-vertical-gradient"),_n=1/ci.tileToMeter;let qn;if(Ke&&yt){if(Cf(fi.tileID,ci.maxHeight,f))continue;const xn=yt.calculateShadowPassMatrixFromTile(fi.tileID.toUnwrapped());qn=Gm(xn,be,_n,ot,nt,zt)}else{const xn=f.translatePosMatrix(li.expandedProjMatrix,fi,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qi=k.projection.createInversionMatrix(k,li.canonical);qn=$?qm(xn,f,Vi,W,re,be,_n,li,fi,ye,nt,zt,ge,_e,Qi,Ze,ot,F):bd(xn,f,Vi,W,re,be,_n,li,ye,nt,zt,ge,_e,Qi,Ze,ot,Oe,Mt)}f.uploadCommonUniforms(R,ui,li.toUnwrapped(),null,He);let Gi=ci.segments;if(k.projection.name==="mercator"&&!Ke&&(Gi=ci.getVisibleSegments(fi.tileID,f.terrain,f.transform.getFrustum(0)),!Gi.get().length))continue;if(_i)if(Ke)for(const xn of Gi.get())_i.numRenderedVerticesInShadowPass+=xn.primitiveLength;else for(const xn of Gi.get())_i.numRenderedVerticesInTransparentPass+=xn.primitiveLength;const Mn=[];(f.terrain||S)&&Mn.push(ci.centroidVertexBuffer),ve&&Mn.push(ci.layoutVertexExtBuffer),qe&&Mn.push(ci.wallVertexBuffer),ui.draw(f,R.gl.TRIANGLES,y,v,T,Yt,qn,o.id,ci.layoutVertexBuffer,ci.indexBuffer,Gi,o.paint,f.transform.zoom,Ei,Mn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Ss{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function pl(f,t,o,d,y,v,T,S,R,O,k,U,F,H,$,W,ie,X,re,ue){const de=t.context,be=de.gl,ye=t.transform,ve=t.transform.zoom,ge=[],_e=f.translate,xe=f.translateAnchor,Ze=f.edgeRadius,Oe=Au(t,f.cutoffFadeRange);k==="clear"?(ge.push("CLEAR_SUBPASS"),ue&&(ge.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(be.TEXTURE0),ue.bind(be.LINEAR,be.CLAMP_TO_EDGE))):k==="sdf"&&ge.push("SDF_SUBPASS"),X&&ge.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&ge.push("RENDER_CUTOFF");const ot=(qe,nt,zt,He,Pe)=>{const lt=nt.programConfigurations.get(d.id),Ke=t.isTileAffectedByFog(qe),yt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:lt,defines:ge,overrideFog:Ke}),Rt=((Mt,Tt,_i,li,fi,ci,Fi,bi,Ei,Ni,ui)=>({u_matrix:Tt,u_opacity:_i,u_ao_pass:li?1:0,u_meter_to_tile:fi,u_ao:ci,u_flood_light_intensity:Fi,u_flood_light_color:bi,u_attenuation:Ei,u_edge_radius:Ni,u_fb:0,u_fb_size:ui,u_dynamic_offset:1}))(0,He,U,O,Pe,[F,H*Pe],$,W,ie,ve>=17?0:Ze*Pe,ue?ue.size[0]:0),Yt=[];X&&Yt.push(nt.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(de,yt,qe.toUnwrapped(),null,Oe),yt.draw(t,de.gl.TRIANGLES,v,T,S,R,Rt,d.id,nt.vertexBuffer,nt.indexBuffer,zt,d.paint,ve,lt,Yt)};for(const qe of y){const nt=o.getTile(qe),zt=nt.getBucket(d);if(!zt||zt.projection.name!==ye.projection.name||!zt.groundEffect||zt.groundEffect&&!zt.groundEffect.hasData())continue;const He=zt.groundEffect,Pe=1/zt.tileToMeter;{const lt=t.translatePosMatrix(qe.projMatrix,nt,_e,xe),Ke=He.getDefaultSegment();ot(qe,He,Ke,lt,Pe)}if(re)for(let lt=0;lt<4;lt++){const Ke=s.e6[lt](qe),yt=o.getTile(Ke);if(!yt)continue;const Rt=yt.getBucket(d);if(!Rt||Rt.projection.name!==ye.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const Yt=Rt.groundEffect;let Mt,Tt;lt===0?(Mt=[-s.al,0,0],Tt=1):lt===1?(Mt=[s.al,0,0],Tt=0):lt===2?(Mt=[0,-s.al,0],Tt=3):(Mt=[0,s.al,0],Tt=2);const _i=Yt.regionSegments[Tt];if(!_i)continue;const li=new Float32Array(16);s.br(li,qe.projMatrix,Mt),ot(qe,Yt,_i,t.translatePosMatrix(li,nt,_e,xe),Pe)}}}function Go(f,t,o,d,y,v,T){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const S=v?v.findDEMTileFor(o):null;if(!(S&&S.dem||T))return;v&&S&&S.dem&&d.selfDEMTileTimestamp!==S.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=S.dem._timestamp);const R=X=>new s.P(Math.ceil((X+s.ea)*s.eb),0),O=X=>{const re=t.getSource().minzoom,ue=be=>{const ye=t.getTileByID(be);if(ye&&ye.hasData())return ye.getBucket(y)},de=[0,-1,1];for(const be of de){if(X.overscaledZ+be<re)continue;const ye=ue(X.calculateScaledKey(X.overscaledZ+be));if(ye)return ye}},k=[0,0,0],U=(X,re)=>(k[0]=Math.min(X.min.y,re.min.y),k[1]=Math.max(X.max.y,re.max.y),k[2]=s.al-re.min.x>X.max.x?re.min.x-s.al:X.max.x,k),F=(X,re)=>(k[0]=Math.min(X.min.x,re.min.x),k[1]=Math.max(X.max.x,re.max.x),k[2]=s.al-re.min.y>X.max.y?re.min.y-s.al:X.max.y,k),H=[(X,re)=>U(X,re),(X,re)=>U(re,X),(X,re)=>F(X,re),(X,re)=>F(re,X)],$=(X,re,ue,de,be,ye,ve)=>{if(!v)return 0;const ge=[[ye?ue:X,ye?X:ue,0],[ye?ue:re,ye?re:ue,0]],_e=ve<0?s.al+ve:ve,xe=[ye?_e:(X+re)/2,ye?(X+re)/2:_e,0];return ue===0&&ve<0||ue!==0&&ve>0?v.getForTilePoints(be,[xe],!0,de):ge.push(xe),v.getForTilePoints(o,ge,!0,S),Math.max(ge[0][2],ge[1][2],xe[2])/v.exaggeration()};for(let X=0;X<4;X++){const re=d.borderFeatureIndices[X];if(re.length===0)continue;const ue=s.e6[X](o),de=O(ue);if(!(de&&de instanceof s.e7))continue;const be=v?v.findDEMTileFor(ue):null;if(!(be&&be.dem||T)||(v&&be&&be.dem&&d.borderDEMTileTimestamp[X]!==be.dem._timestamp&&(d.borderDoneWithNeighborZ[X]=-1,d.borderDEMTileTimestamp[X]=be.dem._timestamp),d.borderDoneWithNeighborZ[X]===de.canonical.z))continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const ye=(X<2?1:5)-X,ve=de.borderDoneWithNeighborZ[ye]!==d.canonical.z,ge=de.borderFeatureIndices[ye];let _e=0;if(d.canonical.z!==de.canonical.z){for(const xe of re)d.showCentroid(d.featuresOnBorder[xe]);if(ve)for(const xe of ge)de.showCentroid(de.featuresOnBorder[xe]);d.borderDoneWithNeighborZ[X]=de.canonical.z,de.borderDoneWithNeighborZ[ye]=d.canonical.z}for(const xe of re){const Ze=d.featuresOnBorder[xe],Oe=d.centroidData[Ze.centroidDataIndex],ot=Ze.borders[X];let qe;for(;_e<ge.length;){qe=de.featuresOnBorder[ge[_e]];const nt=qe.borders[ye];if(nt[1]>ot[0]+3||nt[0]>ot[0]-3)break;de.showCentroid(qe),_e++}if(qe&&_e<ge.length){const nt=_e;let zt=0;for(;!(qe.borders[ye][0]>ot[1]-3)&&(zt++,++_e!==ge.length);)qe=de.featuresOnBorder[ge[_e]];qe=de.featuresOnBorder[ge[nt]];let He=!1;if(zt>=1){const Ke=qe.borders[ye];Math.abs(ot[0]-Ke[0])<3&&Math.abs(ot[1]-Ke[1])<3&&(zt=1,He=!0,_e=nt+1)}else if(zt===0){d.showCentroid(Ze);continue}const Pe=de.centroidData[qe.centroidDataIndex];T&&He&&(((W=Oe).flags|(ie=Pe).flags)&s.e9?(W.flags|=s.e9,ie.flags|=s.e9):(W.flags&=~s.e9,ie.flags&=~s.e9));const lt=Ze.intersectsCount()>1||qe.intersectsCount()>1;if(zt>1)_e=nt,Oe.centroidXY=Pe.centroidXY=new s.P(0,0);else if(be&&be.dem&&!lt){const Ke=H[X](Oe,Pe),yt=X%2?s.al-1:0,Rt=$(Ke[0],Math.min(s.al-1,Ke[1]),yt,be,ue,X<2,Ke[2]);Oe.centroidXY=Pe.centroidXY=R(Rt)}else lt?Oe.centroidXY=Pe.centroidXY=new s.P(0,0):(Oe.centroidXY=d.encodeBorderCentroid(Ze),Pe.centroidXY=de.encodeBorderCentroid(qe));d.writeCentroidToBuffer(Oe),de.writeCentroidToBuffer(Pe)}else d.showCentroid(Ze)}d.borderDoneWithNeighborZ[X]=de.canonical.z,de.borderDoneWithNeighborZ[ye]=d.canonical.z}var W,ie;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(f)}const Dn=[1,0,0],si=[0,1,0],Os=[0,0,1];function Cf(f,t,o){const d=o.transform,y=o.shadowRenderer;if(!y)return!0;const v=f.toUnwrapped(),T=d.tileSize*y._cascades[o.currentShadowCascade].scale;let S=t;if(d.elevation){const W=d.elevation.getMinMaxForTile(f);W&&(S+=W.max)}const R=[...y.shadowDirection];R[2]=-R[2];const O=y.computeSimplifiedTileShadowVolume(v,S,T,R);if(!O)return!1;const k=[Dn,si,Os,R,[R[0],0,R[2]],[0,R[1],R[2]]],U=d.projection.name==="globe",F=d.scaleZoom(T),H=s.cA.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,F,!U),$=y.getCurrentCascadeFrustum();return H.intersectsPrecise(O.vertices,O.planes,k)===0||$.intersectsPrecise(O.vertices,O.planes,k)===0}function nu(f){const{painter:t,source:o,layer:d,coords:y}=f;let v=f.defines;const T=t.context,S=t.renderPass==="shadow",R=t.renderPass==="light-beam",O=t.shadowRenderer,k=s.ec(t.transform.center.lat,t.transform.zoom),U=Au(t,d.paint.get("building-cutoff-fade-range"));U.shouldRenderCutoff&&(v=v.concat("RENDER_CUTOFF"));for(const F of y){const H=o.getTile(F),$=H.getBucket(d);if(!$)continue;O&&O.getMaxCascadeForTile(F.toUnwrapped())===0&&(v=v.concat("SHADOWS_SINGLE_CASCADE"));const W=$.programConfigurations.get(d.id);let ie,X,re,ue=t.translatePosMatrix(F.expandedProjMatrix,H,[0,0],"map");if(ue=s.cR(s.bC(),ue,[1,1,f.verticalScale]),S&&O){if(Cf(H.tileID,$.maxHeight*k,t))continue;let be=O.calculateShadowPassMatrixFromTile(H.tileID.toUnwrapped());be=s.cR(s.bC(),be,[1,1,f.verticalScale]),re=Ap(be),ie=X=t.getOrCreateProgram("buildingDepth",{config:W,defines:v,overrideFog:!1})}else if(R)ie=X=t.getOrCreateProgram("buildingBloom",{config:W,defines:v,overrideFog:!1}),re=Sp(ue);else{const be=t.transform.calculatePosMatrix(F.toUnwrapped(),t.transform.worldSize);s.cR(be,be,[1,1,f.verticalScale]);const ye=s.bC();s.cR(ye,be,[1,-1,1/k]),s.bl(ye,ye),s.ed(ye,ye);const ve=t.transform.getFreeCameraOptions().position,ge=1<<F.canonical.z;re=Ep(ue,ye,f.opacity,f.facadeAOIntensity,[((ve.x-F.wrap)*ge-F.canonical.x)*s.al,(ve.y*ge-F.canonical.y)*s.al,ve.z*ge*s.al],$.tileToMeter,f.facadeEmissiveChance),X=t.getOrCreateProgram("building",{config:W,defines:v,overrideFog:!1});const _e=v.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ie=t.getOrCreateProgram("building",{config:W,defines:_e,overrideFog:!1}),O&&(O.setupShadowsFromMatrix(be,X,!0),O.setupShadowsFromMatrix(be,ie,!0))}const de=(be,ye)=>{if(R){const ve=be.entranceBloom;ye.draw(t,T.gl.TRIANGLES,f.depthMode,Pi.disabled,f.blendMode,ki.disabled,re,d.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,d.paint,t.transform.zoom,W,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=be.segmentsBucket;let ge=[be.layoutNormalBuffer,be.layoutCentroidBuffer,be.layoutColorBuffer];be.layoutFacadePaintBuffer&&(ge=ge.concat([be.layoutFacadeDataBuffer,be.layoutFacadeVerticalRangeBuffer,be.layoutFacadePaintBuffer])),ye.draw(t,T.gl.TRIANGLES,f.depthMode,Pi.disabled,f.blendMode,S?ki.disabled:ki.backCW,re,d.id,be.layoutVertexBuffer,be.indexBuffer,ve,d.paint,t.transform.zoom,W,ge)}};t.uploadCommonUniforms(T,X,F.toUnwrapped(),null,U),$.buildingWithoutFacade&&de($.buildingWithoutFacade,X),ie!==X&&t.uploadCommonUniforms(T,ie,F.toUnwrapped(),null,U),$.buildingWithFacade&&de($.buildingWithFacade,ie)}}function Rc(f){return[f[0]*s.ee,f[1]*s.ee,f[2]*s.ee,0]}function wh(f,t,o,d,y,v,T,S,R){const O=d.getSource(),k=o.globeSharedBuffers;if(!k)return;let U,F,H;if(t&&(U=d.getTile(t)),O instanceof s.aS?(F=O.texture,H=s.dG(0,0,o.transform)):U&&t&&(F=U.texture,H=s.dG(t.canonical.z,t.canonical.x,o.transform)),!F||!H)return;f||(H=s.cR(s.bC(),H,[1,-1,1]));const $=o.context,W=$.gl,ie=y.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,X=o.colorModeForDrapableLayerRenderPass(v),re=T.defines;re.push("GLOBE_POLES");const ue=new ei(W.LEQUAL,ei.ReadWrite,o.depthRangeFor3D),de=Float32Array.from(o.transform.expandedFarZProjMatrix),be=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),$.activeTexture.set(W.TEXTURE0),F.bind(ie,W.CLAMP_TO_EDGE),$.activeTexture.set(W.TEXTURE1),F.bind(ie,W.CLAMP_TO_EDGE),"useMipmap"in F&&$.extTextureFilterAnisotropic&&o.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const[ye,ve,ge,_e]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),xe=y.paint.get("raster-elevation");let Ze;f?(Ze=ye,o.renderDefaultNorthPole=xe!==0):(Ze=ve,o.renderDefaultSouthPole=xe!==0);const Oe=Rc(T.mix),ot=((nt,zt,He,Pe,lt,Ke,yt,Rt,Yt,Mt,Tt,_i,li)=>ku(nt,zt,He,new Float32Array(16),new Float32Array(9),[0,0],Pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],Rt,2,Mt,Tt,_i,1,0,li))(de,be,H,s.aj(o.transform.zoom),0,y,0,xe,0,Oe,T.offset,T.range,v),qe=o.getOrCreateProgram("raster",{defines:re});o.uploadCommonUniforms($,qe,null),qe.draw(o,W.TRIANGLES,ue,R,X,S,ot,y.id,Ze,ge,_e)}function Rf(f){const t=f._nearZ,o=f.projection.farthestPixelDistance(f),d=o-t,y=.2*f.height,v=t+y;return[t,o,(v-y-t)/d,(v-t)/d]}function Th(f,t,o,d){if(f)return t instanceof ta&&f instanceof nl?t.getTextureDescriptor(f,o,!0):{texture:f.texture,mix:Rc(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Ny=s.ef([{name:"a_index",type:"Int16",components:1}]);class Ls{constructor(t,o,d,y){const v={width:d[0],height:d[1],data:null},T=t.gl;this.targetColorTexture=new s.T(t,v,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,v,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,y),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=o.width*o.height;this.particleTexture0=new s.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1});const v=new s.eg;v.reserve(y);for(let T=0;T<y;T++)v.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(v,Ny.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function qo(f,t,o){if(!f)return null;const d=t.getTextureDescriptor(f,o,!0);if(!d)return null;let{texture:y,mix:v,offset:T,tileSize:S,buffer:R,format:O}=d;if(!y||!O)return null;let k=!1;return O==="uint32"&&(k=!0,v[3]=0,v=Cp(s.eh,v,[0,o.paint.get("raster-particle-max-speed")]),T=zu(s.eh,T,[0,o.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[R/(S+2*R),S/(S+2*R)],tileSize:S,scalarData:k,scale:v,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Mf(f){const t=f._nearZ,o=f.projection.farthestPixelDistance(f),d=o-t,y=.2*f.height,v=t+y;return[t,o,(v-y-t)/d,(v-t)/d]}const Ro=new s.ao(1,0,0,1),ru=new s.ao(0,1,0,1),a_=new s.ao(0,0,1,1),Pf=new s.ao(1,0,1,1),Df=new s.ao(0,1,1,1);function Cd(f,t,o,d,y,v){for(let T=0;T<o.length;T++)if(y){const O=new s.ao(d.r*.8,d.g*.8,d.b*.8,1);js(f,t,o[T],d,-1,-1,v),js(f,t,o[T],d,-1,1,v),js(f,t,o[T],d,1,1,v),js(f,t,o[T],d,1,-1,v),js(f,t,o[T],O,0,0,v)}else js(f,t,o[T],d,0,0,v)}function js(f,t,o,d,y,v,T){const S=f.context,R=f.transform,O=S.gl,k=R.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let F=s.bz(o.projMatrix);if(k&&s.aj(R.zoom)>0){const Oe=s.bj(o.canonical,R),ot=s.ei(Oe);F=s.aB(new Float32Array(16),R.globeMatrix,ot),s.aB(F,R.projMatrix,F)}const H=s.bC();H[12]+=2*y/(s.o.devicePixelRatio*R.width),H[13]+=2*v/(s.o.devicePixelRatio*R.height),s.aB(F,H,F);const $=f.getOrCreateProgram("debug",{defines:U}),W=t.getTileByID(o.key);f.terrain&&f.terrain.setupElevationDraw(W,$);const ie=ei.disabled,X=Pi.disabled,re=f.colorModeForRenderPass(),ue="$debug";S.activeTexture.set(O.TEXTURE0),f.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k?W._makeGlobeTileDebugBuffers(f.context,R):W._makeDebugTileBoundsBuffers(f.context,R.projection);const de=W._tileDebugBuffer||f.debugBuffer,be=W._tileDebugIndexBuffer||f.debugIndexBuffer,ye=W._tileDebugSegments||f.debugSegments;if($.draw(f,O.LINE_STRIP,ie,X,re,ki.disabled,tu(F,d.toPremultipliedRenderColor(null)),ue,de,be,ye,null,null,null,[W._globeTileDebugBorderBuffer]),T){const Oe=W.latestRawTileData,ot=Math.floor((Oe&&Oe.byteLength||0)/1024);let qe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(qe+=` => ${o.overscaledZ}`),qe+=` ${W.state}`,qe+=` ${ot}kb`,(function(nt,zt){nt.initDebugOverlayCanvas();const He=nt.debugOverlayCanvas,Pe=nt.context.gl,lt=nt.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,He.width,He.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(zt,5,5),lt.strokeText(zt,5,5),nt.debugOverlayTexture.update(He),nt.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)})(f,qe)}const ve=t.getTile(o).tileSize,ge=512/Math.min(ve,512)*(o.overscaledZ/R.zoom)*.5,_e=W._tileDebugTextBuffer||f.debugBuffer,xe=W._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ze=W._tileDebugTextSegments||f.debugSegments;$.draw(f,O.TRIANGLES,ie,X,Xi.alphaBlended,ki.disabled,tu(F,s.ao.transparent.toPremultipliedRenderColor(null),ge),ue,_e,xe,Ze,null,null,null,[W._globeTileDebugTextBuffer])}function Wr(f,t,o,d){Xl(f,0,t+o/2,f.transform.width,o,d)}function Xn(f,t,o,d){Xl(f,t-o/2,0,o,f.transform.height,d)}function Xl(f,t,o,d,y,v){const T=f.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*s.o.devicePixelRatio,o*s.o.devicePixelRatio,d*s.o.devicePixelRatio,y*s.o.devicePixelRatio),T.clear({color:v}),S.disable(S.SCISSOR_TEST)}const Rd=s.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Op}=Rd;function Mo(f,t,o,d){f.emplaceBack(t,o,d)}class Md{constructor(t){this.vertexArray=new s.ej,this.indices=new s.b1,Mo(this.vertexArray,-1,-1,1),Mo(this.vertexArray,1,-1,1),Mo(this.vertexArray,-1,1,1),Mo(this.vertexArray,1,1,1),Mo(this.vertexArray,-1,-1,-1),Mo(this.vertexArray,1,-1,-1),Mo(this.vertexArray,-1,1,-1),Mo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Op),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function su(f,t,o,d,y,v){const T=f.context.gl,S=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),k=((U,F,H,$,W)=>({u_matrix_3f:U,u_sun_direction:F,u_sun_intensity:H,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(s.el(s.dL(),d),y,O,S.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),o.draw(f,T.TRIANGLES,ei.disabled,Pi.disabled,Xi.unblended,ki.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ou=s.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Bu{constructor(t){const o=new s.em;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const d=new s.b1;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,ou.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Lt=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class $t{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Eh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Xi([1,aa,1,aa],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xi([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new $t,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Bu(o);const d=this.params.sizeRange,y=this.params.intensityRange,v=(function(k){const U=s.eo(30),F=[];for(let H=0;H<k;++H){const $=2*Math.PI*U(),W=Math.acos(1-2*U())-.5*Math.PI;F.push(s.d4(Math.cos(W)*Math.cos($),Math.cos(W)*Math.sin($),Math.sin(W)))}return F})(this.params.starsCount),T=s.eo(300),S=new s.en,R=new s.b1;let O=0;for(let k=0;k<v.length;++k){const U=s.c4([],v[k],200),F=Math.max(0,1+.01*d*(1*T()-.5)),H=Math.max(0,1+.01*y*(1*T()-.5));S.emplaceBack(U[0],U[1],U[2],-1,-1,F,H),S.emplaceBack(U[0],U[1],U[2],1,-1,F,H),S.emplaceBack(U[0],U[1],U[2],1,1,F,H),S.emplaceBack(U[0],U[1],U[2],-1,1,F,H),R.emplaceBack(O+0,O+1,O+2),R.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=o.createVertexBuffer(S,Lt.members),this.starsIdx=o.createIndexBuffer(R),this.starsSegments=s.bg.simpleSegment(0,0,S.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const d=t.context,y=d.gl,v=t.transform,T=new ei(y.LEQUAL,ei.ReadOnly,[0,1]),S=s.aj(v.zoom),R=t.style.getLut(o.scope),O=o.properties.get("color-use-theme")==="none",k=o.properties.get("color").toNonPremultipliedRenderColor(O?null:R),U=o.properties.get("high-color-use-theme")==="none",F=o.properties.get("high-color").toNonPremultipliedRenderColor(U?null:R),H=o.properties.get("space-color-use-theme")==="none",$=o.properties.get("space-color").toNonPremultipliedRenderColor(H?null:R),W=5e-4,ie=s.ep(o.properties.get("horizon-blend"),0,1,W,.25),X=s.dA(t,d,v)&&ie===W?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,re=t.frameCounter/1e3%1,ue=s.ag(v.globeCenterInViewSpace),de=Math.sqrt(Math.pow(ue,2)-Math.pow(X,2)),be=Math.acos(de/ue),ye=ve=>{const ge=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&ge.push("ALPHA_PASS");const _e=t.getOrCreateProgram("globeAtmosphere",{defines:ge}),xe=((Oe,ot,qe,nt,zt,He,Pe,lt,Ke,yt,Rt,Yt)=>({u_frustum_tl:Oe,u_frustum_tr:ot,u_frustum_br:qe,u_frustum_bl:nt,u_horizon:zt,u_transition:He,u_fadeout_range:Pe,u_atmosphere_fog_color:lt.toArray01(),u_high_color:Ke.toArray01(),u_space_color:yt.toArray01(),u_temporal_offset:Rt,u_horizon_angle:Yt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,S,ie,k,F,$,re,be);t.uploadCommonUniforms(d,_e);const Ze=this.atmosphereBuffer;Ze&&_e.draw(t,y.TRIANGLES,T,Pi.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ki.backCW,xe,ve?"atmosphere_glow_alpha":"atmosphere_glow",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)};ye(!1),ye(!0)}drawStars(t,o){const d=s.aA(o.properties.get("star-intensity"),0,1);if(d===0)return;const y=t.context,v=y.gl,T=t.transform,S=t.getOrCreateProgram("stars"),R=s.c6([]);s.c8(R,R,-T._pitch),s.c7(R,R,-T.angle),s.c8(R,R,s.an(T._center.lat)),s.eq(R,R,-s.an(T._center.lng));const O=s.cb(new Float32Array(16),R),k=s.aB([],T.starsProjMatrix,O),U=s.el([],O),F=s.er([],U),H=[0,1,0];s.dN(H,H,F),s.c4(H,H,this.params.sizeMultiplier);const $=[1,0,0];s.dN($,$,F),s.c4($,$,this.params.sizeMultiplier);const W=(ie=H,X=$,re=d,{u_matrix:Float32Array.from(k),u_up:ie,u_right:X,u_intensity_multiplier:re});var ie,X,re;t.uploadCommonUniforms(y,S),this.starsVx&&this.starsIdx&&S.draw(t,v.TRIANGLES,ei.disabled,Pi.disabled,this.colorModeAlphaBlendedWriteRGB,ki.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Or{constructor(){this.visibleTiles=[]}updateBorders(t,o){const d=[],y=[],v=t._getRenderableCoordinates(!1,!0);for(const R of v){const O=t.getTile(R);if(!O.hasData())continue;const k=O.getBucket(o);k&&(k.isEmpty()||(d.push(R.key),y.push({bucket:k,tileID:R.canonical})))}let T=d.length!==this.visibleTiles.length;if(!T){d.sort();for(let R=0;R<d.length;R++)if(d[R]!==this.visibleTiles[R]){T=!0;break}}if(!T)return;const S=new Set;this.visibleTiles=d,y.sort(((R,O)=>R.tileID.z-O.tileID.z||R.tileID.x-O.tileID.x||R.tileID.y-O.tileID.y));for(const R of y){const O=new Array,k=new Array,U=R.bucket;for(const F of U.featuresOnBorder)S.has(F.featureId)?k.push(F.footprintIndex):(S.add(F.featureId),O.push(F.footprintIndex));U.updateFootprintHiddenFlags(O,s.es,!1),U.updateFootprintHiddenFlags(k,s.es,!0)}}}function Be(f,t){const o=[...f],d=t.cameraWorldSizeForFog/t.worldSize,y=s.bA([]);return s.cR(y,y,[d,d,1]),s.aB(o,y,o),s.aB(o,t.worldToFogMatrix,o),o}function Pd(f,t,o,d,y){const v=o.material,T=d.context,{baseColorTexture:S,metallicRoughnessTexture:R}=v.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:k,emissionTexture:U}=v;function F($,W,ie){if($&&(f.push(W),T.activeTexture.set(T.gl.TEXTURE0+ie),$.gfxTexture)){const{minFilter:X,magFilter:re,wrapS:ue,wrapT:de}=$.sampler;$.gfxTexture.bindExtraParam(X,re,ue,de)}}F(S,"HAS_TEXTURE_u_baseColorTexture",rs.BaseColor),F(R,"HAS_TEXTURE_u_metallicRoughnessTexture",rs.MetallicRoughness),F(O,"HAS_TEXTURE_u_normalTexture",rs.Normal),F(k,"HAS_TEXTURE_u_occlusionTexture",rs.Occlusion),F(U,"HAS_TEXTURE_u_emissionTexture",rs.Emission),y&&(y.texture||(y.texture=new s.dY(d.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+rs.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(f.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED");const H=d.shadowRenderer;H&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Vu(f,t,o,d,y,v){const T=o.paint.get("model-opacity").constantOr(1),S=t.context,R=new ei(t.context.gl.LEQUAL,ei.ReadWrite,t.depthRangeFor3D),O=t.transform,k=f.mesh,U=k.material,F=U.pbrMetallicRoughness,H=t.style.fog;let $;$=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],d.zScaleMatrix,f.nodeModelMatrix),s.aB($,d.negCameraPosMatrix,$);const W=s.bl([],$);s.ed(W,W);const ie=o.paint.get("model-color-use-theme").constantOr("default")==="none",X=o.paint.get("model-emissive-strength").constantOr(0),re=$l(new Float32Array(f.worldViewProjection),new Float32Array($),new Float32Array(W),null,t,T,F.baseColorFactor,U.emissiveFactor,F.metallicFactor,F.roughnessFactor,U,X,o),ue={defines:[]},de=[],be=t.shadowRenderer;be&&(be.useNormalOffset=!1),Pd(ue.defines,de,k,t,ie?null:o.lut);let ye=null;if(H){const _e=Be(f.nodeModelMatrix,t.transform);if(ye=new Float32Array(_e),O.projection.name!=="globe"){const xe=k.aabb.min,Ze=k.aabb.max,[Oe,ot]=H.getOpacityForBounds(_e,xe[0],xe[1],Ze[0],Ze[1]);ue.overrideFog=Oe>=di||ot>=di}}const ve=Au(t,o.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const ge=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(S,ge,null,ye,ve),t.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(f.nodeModelMatrix,ge),ge.draw(t,S.gl.TRIANGLES,R,y,v,k.material.doubleSided?ki.disabled:ki.backCCW,re,o.id,k.vertexBuffer,k.indexBuffer,k.segments,o.paint,t.transform.zoom,void 0,de)}function Lp(f,t,o,d,y,v,T){let S;S=f.projection.name==="globe"?s.eu(o,f):[...o],s.aB(S,S,t.matrix);const R=s.aB([],d,S);if(t.meshes)for(const O of t.meshes){if(O.material.alphaMode!=="BLEND"){T.push({mesh:O,depth:0,modelIndex:y,worldViewProjection:R,nodeModelMatrix:S});continue}const k=s.af([],O.centroid,R);!f.isOrthographic&&k[2]<=0||v.push({mesh:O,depth:k[2],modelIndex:y,worldViewProjection:R,nodeModelMatrix:S})}if(t.children)for(const O of t.children)Lp(f,O,o,d,y,v,T)}function Dd(f,t,o,d){const y=o.shadowRenderer;if(!y)return;const v=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),S=y.calculateShadowPassMatrixFromMatrix(t),R=Ic(S);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,Pi.disabled,T,ki.backCCW,R,d.id,f.vertexBuffer,f.indexBuffer,f.segments,d.paint,o.transform.zoom,void 0,void 0)}function $m(f,t,o){const d=t.updateZoomBasedPaintProperties(),y=(function(v,T,S){let R,O,k,U=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&U>0){const F=v.terrain,H=F.findDEMTileFor(S);H&&H.dem?R=s.ew.create(F,S,H):U=0}if(U===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),U===T.validForExaggeration&&(U===0||R&&R._demTile&&R._demTile.tileID===T.validForDEMTile.id&&R._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const F in T.instancesPerModel){const H=T.instancesPerModel[F];for(let $=0;$<H.instancedDataArray.length;++$){const W=(R?U*R.getElevationAt(0|H.instancedDataArray.float32[16*$],0|H.instancedDataArray.float32[16*$+1],!0,!0):0)+H.instancesEvaluatedElevation[$];H.instancedDataArray.float32[16*$+6]=W,O=O?Math.min(T.terrainElevationMin,W):W,k=k?Math.max(T.terrainElevationMax,W):W}}return T.terrainElevationMin=O||0,T.terrainElevationMax=k||0,T.validForExaggeration=U,T.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,t,o);(d||y)&&(t.uploaded=!1,t.upload(f.context))}const ml={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function Uu(f,t){const o=1<<f.canonical.z,d=t.getFreeCameraOptions().position,y=t.elevation,v=f.canonical.x/o,T=(f.canonical.x+1)/o,S=f.canonical.y/o,R=(f.canonical.y+1)/o;let O=t._centerAltitude;if(y){const H=y.getMinMaxForTile(f);H&&H.max>O&&(O=H.max)}const k=s.aA(d.x,v,T)-d.x,U=s.aA(d.y,S,R)-d.y,F=s.ce(O,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+U*U+F*F))}function Zm(f,t,o,d,y,v,T){const S=f.context,R=f.renderPass==="shadow",O=f.shadowRenderer,k=R&&O?O.getShadowPassDepthMode():new ei(S.gl.LEQUAL,ei.ReadWrite,f.depthRangeFor3D),U=f.isTileAffectedByFog(v);if(o.meshes)for(const F of o.meshes){const H=["MODEL_POSITION_ON_GPU"],$=[];let W,ie,X;d.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const re=Au(f,t.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),R&&O)W=f.getOrCreateProgram("modelDepth",{defines:H}),ie=Ic(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(o.matrix)),X=O.getShadowPassColorMode();else{Pd(H,$,F,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),W=f.getOrCreateProgram("model",{defines:H,overrideFog:U});const de=F.material,be=de.pbrMetallicRoughness,ye=t.paint.get("model-opacity").constantOr(1),ve=t.paint.get("model-emissive-strength").constantOr(0);ie=$l(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,f,ye,be.baseColorFactor,de.emissiveFactor,be.metallicFactor,be.roughnessFactor,de,ve,t,y),O&&(T.shadowUniformsInitialized?W.setShadowUniformValues(S,O.getShadowUniformValues()):(O.setupShadows(v.toUnwrapped(),W,"model-tile"),T.shadowUniformsInitialized=!0)),X=re.shouldRenderCutoff||ye<1||de.alphaMode!=="OPAQUE"?Xi.alphaBlended:Xi.unblended}f.uploadCommonUniforms(S,W,v.toUnwrapped(),null,re);const ue=F.material.doubleSided?ki.disabled:ki.backCCW;if(d.instancedDataArray.length>20)$.push(d.instancedDataBuffer),W.draw(f,S.gl.TRIANGLES,k,Pi.disabled,X,ue,ie,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,f.transform.zoom,void 0,$,d.instancedDataArray.length);else{const de=R?"u_instance":"u_normal_matrix";for(let be=0;be<d.instancedDataArray.length;++be)ie[de]=new Float32Array(d.instancedDataArray.arrayBuffer,64*be,16),W.draw(f,S.gl.TRIANGLES,k,Pi.disabled,X,ue,ie,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,f.transform.zoom,void 0,$)}}if(o.children)for(const F of o.children)Zm(f,t,F,d,y,v,T)}const l_=[1,-1,1];function Xm(f,t,o,d){if(!o.modelManager)return!0;const y=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,T=t.aabb;let S=!0,R=f.maxHeight;if(R===0){let k=0;for(const U in f.instancesPerModel){const F=y.getModel(U,d);F?k=Math.max(k,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):S=!1}R=f.maxScale*k*1.41+f.maxVerticalOffset,S&&(f.maxHeight=R)}T.max[2]=R,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,s.af(T.min,T.min,t.tileMatrix),s.af(T.max,T.max,t.tileMatrix);const O=T.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=O===2),O===0}function Of(f,t){const o=f.uniformValues.u_cutoff_params[0],d=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return d===o||v===y?1:s.aA(((t-o)/(d-o)-y)/(v-y),0,1)}function zp(f,t,o,d){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();s.aB(y,y,f);const v=s.bU(o.min[0],o.min[1],o.min[2],1);let T=s.aC(s.ex(),v,y),S=T,R=T;v[1]=o.max[1],T=s.aC(s.ex(),v,y),S=T[1]<S[1]?T:S,R=T[1]>R[1]?T:R,v[0]=o.max[0],T=s.aC(s.ex(),v,y),S=T[1]<S[1]?T:S,R=T[1]>R[1]?T:R,v[1]=o.min[1],T=s.aC(s.ex(),v,y),S=T[1]<S[1]?T:S,R=T[1]>R[1]?T:R;const O=s.aA(d[0],0,1),k=100*t.pixelsPerMeter*s.aA(d[1],0,1),U=s.aA(d[2],0,1),F=s.ey(s.ex(),S,R,O),H=Math.tan(.5*t.fovX),$=-F[2]*H;if(k===0)return F[1]<-Math.abs($)?U:1;const W=(-Math.abs($)-F[1])/k,ie=(re,ue,de)=>(1-de)*re+de*ue,X=s.aA(ie(1,U,W),U,1);return ie(1,X,s.aA((t.pitch-20)/20,0,1))}class c_{}class Ym{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,d){{const U=this._storage.get(o.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const y=d.gl,v=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(v),S=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const R=new s.eA;for(let U=0;U<v/2;U+=3){const F=S[U],H=S[U+1],$=S[U+2];R.emplaceBack(F,H),R.emplaceBack(H,$),R.emplaceBack($,F)}const O=d.bindVertexArrayOES.current,k=new c_;return k.buf=new Cc(d,R),k.lastUsedFrameIdx=t,this._storage.set(o.id,k),d.bindVertexArrayOES.set(O),k.buf}update(t){for(const[o,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class au{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Od=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class lu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ld{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Km=s.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class Qm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.eB,S=new s.b1;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,Km.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const y=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const T={u_vignetteShape:(v={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,ei.disabled,Pi.disabled,Xi.alphaBlended,ki.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y)}var v}}class u_{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const d=t.getFreeCameraOptions().position,y=d.toAltitude(),v=d.toLngLat(),T=s.an(v.lng),S=s.an(v.lat),R=t.pixelsPerMeter/o,O=T*s.eD,k=s.eD*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,F=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+O)*R,this._accumulatedOffsetY+=U*R,this._accumulatedElevation+=F*R,this._offsetXPrev=O,this._offsetYPrev=k,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Jm(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function mo(f){const t=s.eo(1323123451230),o=[];for(let d=0;d<f;++d){const y=2*t()-1,v=2*t()-1,T=2*t()-1;o.push(s.d4(y,v,T))}return o}function cu(f,t,o,d,y){const v=s.aA((y-o)/(d-o),0,1);return(1-v)*f+v*t}class Sh{constructor(t){this._movement=new u_,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Qm,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,v=s.c6([]);s.c8(v,v,s.an(90)-d._pitch),s.c7(v,v,-d.angle);const T=s.cb(new Float32Array(16),v),S=s.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=s.ed([],S),O=s.aB([],R,T),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*o,this._prevTime=k,{projectionMatrix:y,modelviewMatrix:O}}}class dr extends Sh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ld(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const d=mo(this.particlesCount),y=new s.eE,v=new s.b1;let T=0;const S=s.eo(1323123451230);for(let R=0;R<d.length;++R){const O=d[R],k=[2*S()-1,S(),S(),S()];y.emplaceBack(O[0],O[1],O[2],-1,-1,...k),y.emplaceBack(O[0],O[1],O[2],1,-1,...k),y.emplaceBack(O[0],O[1],O[2],1,1,...k),y.emplaceBack(O[0],O[1],O[2],-1,1,...k),v.emplaceBack(T+0,T+1,T+2),v.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,Od.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(o.revealStart>d)return;const y=cu(0,1,o.revealStart,o.revealStart+o.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let T=[-v.direction.x,v.direction.y,-100];s.aw(T,T);const S=structuredClone(this._vignetteParams);S.strength*=y,v.overrideStyleParameters||(v.intensity=t.style.rain.state.density,v.timeFactor=t.style.rain.state.intensity,v.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),v.screenThinning.intensity=t.style.rain.state.centerThinning,v.dropletSizeX=t.style.rain.state.dropletSize[0],v.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],v.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const R=this.updateOnRender(t,v.timeFactor),O=t.context,k=O.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(O,{width:t.width,height:t.height,data:null},k.RGBA8)),v.distortionStrength>0&&(O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const F=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(O,F),O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const H=[v.color.r,v.color.g,v.color.b,v.color.a],$=(W,ie)=>{const X=Jm(this._movement.getPosition(),W),re=v.dropletSizeX,ue=v.dropletSizeX*v.dropletSizeYScale,de=t.width/2,be=t.height/2,ye=cu(0,v.screenThinning.start,0,1,v.screenThinning.intensity),ve=cu(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),ge=cu(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),_e=(xe={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:W,rainDropletSize:[re,ue],distortionStrength:v.distortionStrength,rainDirection:T,color:H,screenSize:[U.width,U.height],thinningCenterPos:[de,be],thinningShape:[ye,ve,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;const Ze=Math.round(v.intensity*this.particlesCount),Oe=s.bg.simpleSegment(0,0,4*Ze,2*Ze);F.draw(t,k.TRIANGLES,ei.disabled,Pi.disabled,Xi.alphaBlended,ki.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,Oe)};v.distortionStrength>0&&$(v.boxSize,!0),$(v.boxSize,!1),this._vignette.draw(t,S)}}const pn=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class eg extends Sh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ld(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const d=mo(this.particlesCount),y=new s.eF,v=new s.b1;let T=0;const S=s.eo(1323123451230);for(let R=0;R<d.length;++R){const O=d[R],k=S(),U=S(),F=S(),H=[R/d.length,k,U,F],$=[S(),S()];y.emplaceBack(O[0],O[1],O[2],-1,-1,...H,...$),y.emplaceBack(O[0],O[1],O[2],1,-1,...H,...$),y.emplaceBack(O[0],O[1],O[2],1,1,...H,...$),y.emplaceBack(O[0],O[1],O[2],-1,1,...H,...$),v.emplaceBack(T+0,T+1,T+2),v.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,pn.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let d=[-o.direction.x,o.direction.y,-100];s.aw(d,d);const y=structuredClone(this._vignetteParams),v=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(v.revealStart>T)return;const S=cu(0,1,v.revealStart,v.revealStart+v.revealRange,T);y.strength*=S,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const R=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const O=t.context,k=O.gl,U=t.transform,F=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(O,F),((H,$,W)=>{const ie=Jm(this._movement.getPosition(),H),X=U.width/2,re=U.height/2,ue=cu(0,W.screenThinning.start,0,1,W.screenThinning.intensity),de=cu(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),be=cu(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),ye=(ve={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:H,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[X,re],thinningShape:[ue,de,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:be,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:d},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const ge=Math.round(W.intensity*this.particlesCount),_e=s.bg.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&F.draw(t,k.TRIANGLES,ei.disabled,Pi.disabled,Xi.alphaBlended,ki.disabled,ye,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(o.boxSize,0,o),this._vignette.draw(t,y)}}const uu={symbol:function(f,t,o,d,y){if(f.renderPass!=="translucent")return;const v=Pi.disabled,T=f.colorModeForRenderPass(),S=o.layout.get("text-variable-anchor"),R=o.layout.get("text-size-scale-range"),O=s.aA(f.scaleFactor,R[0],R[1]);S&&(function(F,H,$,W,ie,X,re,ue){const de=H.transform,be=ie==="map",ye=X==="map";for(const ve of F){const ge=W.getTile(ve),_e=ge.getBucket($);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const xe=s.bK(_e.textSizeData,de.zoom,ue),Ze=Eo(ve,_e.getProjection(),de),Oe=de.calculatePixelsToTileUnitsMatrix(ge),ot=sa(Ze,ge.tileID.canonical,ye,be,de,_e.getProjection(),Oe),qe=_e.hasIconTextFit()&&_e.hasIconData();xe&&Uo(_e,be,ye,re,de,ot,ve,Math.pow(2,de.zoom-ge.tileID.overscaledZ),xe,qe)}})(d,f,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y,O);const k=o.paint.get("icon-opacity").constantOr(1)!==0,U=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?jo(f,t,o,d,v,T):(k&&jo(f,t,o,d,v,T,{onlyIcons:!0}),U&&jo(f,t,o,d,v,T,{onlyText:!0})),t.map.showCollisionBoxes&&(Nu(f,t,o,d,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Nu(f,t,o,d,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,o,d){if(f.renderPass!=="translucent")return;const y=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0,R=o.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;const O=f.context,k=O.gl,U=f.transform,F=!(!f.terrain||!f.terrain.enabled),H=o.layout.get("circle-elevation-reference"),$=f.depthModeForSublayer(0,ei.ReadOnly),W=new ei(f.context.gl.LEQUAL,ei.ReadOnly,f.depthRangeFor3D),ie=H==="none"||F?$:W,X=Pi.disabled,re=f.colorModeForDrapableLayerRenderPass(R),ue=U.projection.name==="globe",de=[s.aF(U.center.lng),s.aJ(U.center.lat)],be=[];for(let ve=0;ve<d.length;ve++){const ge=d[ve],_e=t.getTile(ge),xe=_e.getBucket(o);if(!xe||xe.projection.name!==U.projection.name)continue;const Ze=xe.programConfigurations.get(o.id),Oe=xe.layoutVertexBuffer,ot=xe.globeExtVertexBuffer,qe=xe.indexBuffer,nt=s.dZ(o),zt=[ot],He=f.isTileAffectedByFog(ge);ue&&nt.push("PROJECTION_GLOBE_VIEW"),nt.push("DEPTH_D24"),f.terrain&&U.depthOcclusionForSymbolsAndCircles&&nt.push("DEPTH_OCCLUSION"),xe.hasElevation&&!f.terrain&&(nt.push("ELEVATED_ROADS"),zt.push(xe.elevatedLayoutVertexBuffer));const Pe=f.getOrCreateProgram("circle",{config:Ze,defines:nt,overrideFog:He}),lt=U.projection.createInversionMatrix(U,ge.canonical),Ke={programConfiguration:Ze,program:Pe,layoutVertexBuffer:Oe,dynamicBuffers:zt,indexBuffer:qe,uniformValues:s.d_(f,ge,_e,lt,de,o),tile:_e};if(S){const yt=xe.segments.get();for(const Rt of yt)be.push({segments:new s.bg([Rt]),sortKey:Rt.sortKey,state:Ke})}else be.push({segments:xe.segments,sortKey:0,state:Ke})}S&&be.sort(((ve,ge)=>ve.sortKey-ge.sortKey));const ye={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const ve of be){const{programConfiguration:ge,program:_e,layoutVertexBuffer:xe,dynamicBuffers:Ze,indexBuffer:Oe,uniformValues:ot,tile:qe}=ve.state,nt=ve.segments;f.terrain&&f.terrain.setupElevationDraw(qe,_e,ye),f.uploadCommonUniforms(O,_e,qe.tileID.toUnwrapped()),_e.draw(f,k.TRIANGLES,ie,X,re,ki.disabled,ot,o.id,xe,Oe,nt,o.paint,U.zoom,ge,Ze)}},heatmap:function(f,t,o,d){if(o.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,v=y.gl,T=Pi.disabled,S=new Xi([v.ONE,v.ONE,v.ONE,v.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(H,$,W,ie){const X=H.gl,re=$.width*ie,ue=$.height*ie;H.activeTexture.set(X.TEXTURE1),H.viewport.set([0,0,re,ue]);let de=W.heatmapFbo;if(!de||de&&(de.width!==re||de.height!==ue)){de&&de.destroy();const be=X.createTexture();X.bindTexture(X.TEXTURE_2D,be),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),de=W.heatmapFbo=H.createFramebuffer(re,ue,!0,null),(function(ye,ve,ge,_e,xe,Ze){const Oe=ye.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,ye.extRenderToTextureHalfFloat?Oe.RGBA16F:Oe.RGBA,xe,Ze,0,Oe.RGBA,ye.extRenderToTextureHalfFloat?Oe.HALF_FLOAT:Oe.UNSIGNED_BYTE,null),_e.colorAttachment.set(ge)})(H,0,be,de,re,ue)}else X.bindTexture(X.TEXTURE_2D,de.colorAttachment.get()),H.bindFramebuffer.set(de.framebuffer)})(y,f,o,f.transform.projection.name==="globe"?.5:.25),y.clear({color:s.ao.transparent});const R=f.transform,O=R.projection.name==="globe",k=O?["PROJECTION_GLOBE_VIEW"]:[],U=O?ki.frontCCW:ki.disabled,F=[s.aF(R.center.lng),s.aJ(R.center.lat)];for(let H=0;H<d.length;H++){const $=d[H];if(t.hasRenderableParent($))continue;const W=t.getTile($),ie=W.getBucket(o);if(!ie||ie.projection.name!==R.projection.name)continue;const X=f.isTileAffectedByFog($),re=ie.programConfigurations.get(o.id),ue=f.getOrCreateProgram("heatmap",{config:re,defines:k,overrideFog:X}),{zoom:de}=f.transform;f.terrain&&f.terrain.setupElevationDraw(W,ue),f.uploadCommonUniforms(y,ue,$.toUnwrapped());const be=R.projection.createInversionMatrix(R,$.canonical);ue.draw(f,v.TRIANGLES,ei.disabled,T,S,U,Hm(f,$,W,be,F,de,o.paint.get("heatmap-intensity")),o.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,o.paint,f.transform.zoom,re,O?[ie.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(y,v){const T=y.context,S=T.gl,R=v.heatmapFbo;if(!R)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let O=v.colorRampTexture;O||(O=v.colorRampTexture=new s.T(T,v.colorRamp,S.RGBA8)),O.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,S.TRIANGLES,ei.disabled,Pi.disabled,y.colorModeForRenderPass(),ki.disabled,((k,U,F,H)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)})(f,o))},line:function(f,t,o,d){if(f.renderPass!=="translucent")return;const y=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const T=o.paint.get("line-emissive-strength"),S=o.paint.get("line-occlusion-opacity"),R=o.layout.get("line-elevation-reference"),O=o.layout.get("line-width-unit")==="meters",k=R==="sea",U=!(!f.terrain||!f.terrain.enabled),F=f.context,H=F.gl;if(o.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const $=o.layout.get("line-cross-slope"),W=$!==void 0,ie=$<1,X=f.colorModeForDrapableLayerRenderPass(T),re=f.terrain&&f.terrain.renderingToTexture,ue=re?1:s.o.devicePixelRatio,de=o.paint.get("line-dasharray"),be=de.constantOr(1),ye=o.layout.get("line-cap"),ve=de.constantOr(null),ge=ye.constantOr(null),_e=o.paint.get("line-pattern"),xe=_e.constantOr(1),Ze=o.paint.get("line-pattern-cross-fade"),Oe=_e.constantOr(null),ot=o.paint.get("line-opacity").constantOr(1);let qe=!xe&&ot!==1||f.depthOcclusion&&S>0&&S<1;const nt=o.paint.get("line-gradient"),zt=xe?"linePattern":"line",He=s.d$(o);let Pe;if(re&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(qe=!1),S!==0&&f.depthOcclusion){const Rt=o.paint._values["line-opacity"];Rt&&Rt.value&&Rt.value.kind==="constant"?Pe=Rt.value:s.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&He.push("VARIABLE_LINE_WIDTH");const lt=(Rt,Yt,Mt,Tt,_i,li)=>{for(const fi of Rt){const ci=t.getTile(fi);if(xe&&!ci.patternsLoaded())continue;const Fi=ci.getBucket(o);if(!Fi||Fi.elevationType!=="none"&&!_i||Fi.elevationType==="none"&&_i)continue;f.prepareDrawTile();const bi=[...Yt],Ei=f.shadowRenderer,Ni=Fi.elevationType==="road"&&!!Ei&&Ei.enabled;let ui=[0,0,0];if(Ni){const qi=f.style.directionalLight,Ci=f.style.ambientLight;qi&&Ci&&(ui=ll(f.style,qi,Ci)),bi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Vi=Fi.programConfigurations.get(o.id);let _n=!1;if(Oe&&ci.imageAtlas){const qi=s.e0.from(Oe),Ci=qi.getPrimary().scaleSelf(ue).toString(),yn=ci.imageAtlas.patternPositions.get(Ci),Mr=qi.getSecondary(),fr=Mr?ci.imageAtlas.patternPositions.get(Mr.scaleSelf(ue).toString()):null;_n=!!yn&&!!fr,yn&&Vi.setConstantPatternPositions(yn,fr)}Ze>0&&(_n||Vi.getPatternTransitionVertexBuffer("line-pattern"))&&bi.push("LINE_PATTERN_TRANSITION");const qn=f.isTileAffectedByFog(fi),Gi=f.getOrCreateProgram(zt,{config:Vi,defines:bi,overrideFog:qn});if(!xe&&ve&&ge&&ci.lineAtlas){const qi=ci.lineAtlas.getDash(ve,ge);qi&&Vi.setConstantPatternPositions(qi)}Ni&&Ei.setupShadows(ci.tileID.toUnwrapped(),Gi,"vector-tile");let[Mn,xn]=o.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&Mn!==xn&&(Mn===0&&(Mn-=1),xn===1&&(xn+=1));const Qi=re?fi.projMatrix:null,$n=O?1/Fi.tileToMeter/s.ay(ci,1,f.transform.zoom):1,vr=O?1/Fi.tileToMeter/s.ay(ci,1,Math.floor(f.transform.zoom)):1,ws=xe?s.e1(f,ci,o,Qi,ue,$n,vr,[Mn,xn],ui,Ze):s.e2(f,ci,o,Qi,Fi.lineClipsArray.length,ue,$n,vr,[Mn,xn],ui);if(nt){const qi=Fi.gradients[o.id];let Ci=qi.texture;if(o.gradientVersion!==qi.version){let yn=256;if(o.stepInterpolant){const Mr=t.getSource().maxzoom,fr=fi.canonical.z===Mr?Math.ceil(1<<f.transform.maxZoom-fi.canonical.z):1;yn=s.aA(s.e3(Fi.maxLineLength/s.al*1024*fr),256,F.maxTextureSize)}qi.gradient=s.e4({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:yn,image:qi.gradient||void 0,clips:Fi.lineClipsArray}),qi.texture?qi.texture.update(qi.gradient):qi.texture=new s.T(F,qi.gradient,H.RGBA8),qi.version=o.gradientVersion,Ci=qi.texture}F.activeTexture.set(H.TEXTURE1),Ci.bind(o.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}be&&(F.activeTexture.set(H.TEXTURE0),ci.lineAtlasTexture&&ci.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),Vi.updatePaintBuffers()),xe&&(F.activeTexture.set(H.TEXTURE0),ci.imageAtlasTexture&&ci.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Vi.updatePaintBuffers()),_i&&!k&&f.terrain.setupElevationDraw(ci,Gi),f.uploadCommonUniforms(F,Gi,fi.toUnwrapped());const zn=qi=>{Pe!=null&&(Pe.value=ot*S),Gi.draw(f,H.TRIANGLES,Mt,qi,X,ki.disabled,ws,o.id,Fi.layoutVertexBuffer,Fi.indexBuffer,Fi.segments,o.paint,f.transform.zoom,Vi,[Fi.layoutVertexBuffer2,Fi.patternVertexBuffer,Fi.zOffsetVertexBuffer]),Pe!=null&&(Pe.value=ot)};if(qe&&!_i){const qi=f.stencilModeForClipping(fi).ref;qi===0&&re&&F.clear({stencil:0});const Ci={func:H.EQUAL,mask:255};ws.u_alpha_discard_threshold=.8,zn(new Pi(Ci,qi,255,H.KEEP,H.KEEP,H.INVERT)),ws.u_alpha_discard_threshold=0,zn(new Pi(Ci,qi,255,H.KEEP,H.KEEP,H.KEEP))}else ws.u_alpha_discard_threshold=qe&&_i&&li?.8:0,zn(_i?Tt:f.stencilModeForClipping(fi))}};let Ke=f.depthModeForSublayer(0,ei.ReadOnly);const yt=new ei(f.depthOcclusion?H.GREATER:H.LEQUAL,ei.ReadOnly,f.depthRangeFor3D);if(o.hasNonElevatedBuckets){const Rt=!re&&f.terrain;S!==0&&Rt?s.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):Rt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):lt(d,He,Ke,Pi.disabled,!1,!0)}if(o.hasElevatedBuckets){R==="hd-road-markup"?U||(Ke=yt,He.push("ELEVATED_ROADS")):(He.push("ELEVATED"),Ke=yt,W&&He.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&He.push("ELEVATION_REFERENCE_SEA"));const Rt=qe?f.stencilModeFor3D():Pi.disabled;f.forceTerrainMode=!0,lt(d,He,Ke,Rt,!0,!0),qe&&lt(d,He,Ke,Rt,!0,!1),f.forceTerrainMode=!1}qe&&(f.resetStencilClippingMasks(),re&&F.clear({stencil:0})),S===0||f.depthOcclusion||re||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,o,d){const y=o.paint.get("fill-color"),v=o.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const T=o.paint.get("fill-emissive-strength"),S=f.colorModeForDrapableLayerRenderPass(T),R=o.paint.get("fill-pattern"),O=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&y.constantOr(s.ao.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let k="none";o.layout.get("fill-elevation-reference")!=="none"?k="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const U=!(!f.terrain||!f.terrain.enabled),F={painter:f,sourceCache:t,layer:o,coords:d,colorMode:S,elevationType:k,terrainEnabled:U,pass:O};if(f.renderPass!=="shadow")if(k!=="offset"){if(Va(F,!1),k==="road"){const H=!U&&f.renderPass==="translucent";H&&Fu(f,t,o,d,"geometry"),Va(F,!0,Pi.disabled),H&&(function($){const{painter:W,sourceCache:ie,layer:X,coords:re,colorMode:ue}=$,de=W.context.gl,be=$.painter.shadowRenderer,ye=!!be&&be.enabled,ve=new ei(W.context.gl.LEQUAL,ei.ReadOnly,W.depthRangeFor3D);let ge=[0,0,0];if(ye){const xe=W.style.directionalLight,Ze=W.style.ambientLight;xe&&Ze&&(ge=ll(W.style,xe,Ze))}const _e=xe=>{for(const Ze of re){const Oe=ie.getTile(Ze),ot=Oe.getBucket(X);if(!ot)continue;const qe=ot.elevatedStructures;if(!qe)continue;let nt,zt;if(xe?(nt=qe.renderableBridgeSegments,zt=qe.bridgeProgramConfigurations.get(X.id)):(nt=qe.renderableTunnelSegments,zt=qe.tunnelProgramConfigurations.get(X.id)),!nt||nt.segments[0].primitiveLength===0)continue;zt.updatePaintBuffers(),W.prepareDrawTile();const He=W.isTileAffectedByFog(Ze),Pe=[];ye&&Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const lt=W.getOrCreateProgram("elevatedStructures",{config:zt,overrideFog:He,defines:Pe}),Ke=W.translatePosMatrix(Ze.projMatrix,Oe,X.paint.get("fill-translate"),X.paint.get("fill-translate-anchor"));ye&&be.setupShadows(Oe.tileID.toUnwrapped(),lt,"vector-tile");const yt=wd(Ke,ge);W.uploadCommonUniforms(W.context,lt,Ze.toUnwrapped()),lt.draw(W,de.TRIANGLES,ve,Pi.disabled,ue,ki.backCCW,yt,X.id,qe.vertexBuffer,qe.indexBuffer,nt,X.paint,W.transform.zoom,zt,[qe.vertexBufferNormal])}};_e(!0),_e(!1)})(F)}}else Va(F,!1,f.stencilModeFor3D());else f.shadowRenderer&&k==="road"&&!U&&(function(H){const{painter:$,sourceCache:W,layer:ie,coords:X}=H,re=$.context.gl,ue=H.painter.shadowRenderer;for(const de of X){const be=W.getTile(de),ye=be.getBucket(ie);if(!ye)continue;const ve=ye.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;$.prepareDrawTile();const ge=ye.bufferData.programConfigurations.get(ie.id),_e=$.isTileAffectedByFog(de),xe=$.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:_e}),Ze=ue.calculateShadowPassMatrixFromTile(be.tileID.toUnwrapped());$.uploadCommonUniforms($.context,xe,de.toUnwrapped());const Oe={u_matrix:Ze,u_depth_bias:0};xe.draw($,re.TRIANGLES,ue.getShadowPassDepthMode(),Pi.disabled,ue.getShadowPassColorMode(),ki.disabled,Oe,ie.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,ie.paint,$.transform.zoom,ge)}})(F)},"fill-extrusion":function(f,t,o,d){const y=o.paint.get("fill-extrusion-opacity"),v=f.context,T=v.gl,S=f.terrain,R=S&&S.renderingToTexture;if(y===0)return;const O=f.conflationActive&&f.style.isLayerClipped(o,t.getSource()),k=f.style.order.indexOf(o.fqid);if(O&&(function(U,F,H,$,W){for(const ie of $){const X=F.getTile(ie).getBucket(H);X&&(X.updateReplacement(ie,U.replacementSource,W),X.uploadCentroid(U.context))}})(f,t,o,d,k),S||O)for(const U of d){const F=t.getTile(U).getBucket(o);F&&Go(f.context,t,U,F,o,S,O)}if(f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer;if(S&&y<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const F=U.getShadowPassDepthMode(),H=U.getShadowPassColorMode();Xt(f,t,o,d,F,Pi.disabled,H,O)}else if(f.renderPass==="translucent"){const U=!o.paint.get("fill-extrusion-pattern").constantOr(1),F=o.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!R&&F.a!==0){const H=new ei(f.context.gl.LEQUAL,ei.ReadWrite,f.depthRangeFor3D);y===1&&U?Xt(f,t,o,d,H,Pi.disabled,Xi.unblended,O):(Xt(f,t,o,d,H,Pi.disabled,Xi.disabled,O),Xt(f,t,o,d,H,f.stencilModeFor3D(),f.colorModeForRenderPass(),O),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&U&&(!S&&f.transform.projection.name!=="globe"||R)){const H=o.paint.get("fill-extrusion-opacity"),$=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=o.paint.get("fill-extrusion-flood-light-intensity"),X=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(X?null:o.lut).toArray01().slice(0,3),ue=$>0&&W>0,de=ie>0,be=(ge,_e,xe)=>(1-xe)*ge+xe*_e,ye=new Ss;ye.translate=o.paint.get("fill-extrusion-translate"),ye.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),ye.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),ye.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const ve=ge=>{const _e=f.depthModeForSublayer(1,ei.ReadOnly,T.LEQUAL,!0),xe=o.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=be(.1,3,xe),Oe=f._showOverdrawInspector;if(!Oe){const ot=new Pi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),qe=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);pl(ye,f,t,o,d,_e,ot,qe,ki.disabled,ge,"sdf",H,$,W,ie,re,Ze,O,!1)}{const ot=Oe?Pi.disabled:new Pi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),qe=Oe?f.colorModeForRenderPass():new Xi([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.ao.transparent,[!0,!0,!0,!0]);pl(ye,f,t,o,d,_e,ot,qe,ki.disabled,ge,"color",H,$,W,ie,re,Ze,O,!1)}};if(R){const ge=(_e,xe,Ze)=>{const Oe=f.depthModeForSublayer(1,ei.ReadOnly,T.LEQUAL,!1),ot=o.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=be(.1,3,ot);{const nt=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0]);pl(ye,f,t,o,d,Oe,Pi.disabled,nt,ki.disabled,_e,"clear",H,$,W,ie,re,qe,O,xe)}{const nt=new Pi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),zt=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);pl(ye,f,t,o,d,Oe,nt,zt,ki.disabled,_e,"sdf",H,$,W,ie,re,qe,O,xe)}{const nt=_e?T.ZERO:T.ONE_MINUS_DST_ALPHA,zt=new Pi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),He=new Xi([nt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.ao.transparent,[!0,!0,!0,!0]);pl(ye,f,t,o,d,Oe,zt,He,ki.disabled,_e,"color",H,$,W,ie,re,qe,O,xe)}{const nt=new Xi([T.ONE,T.ONE,T.ONE,_e?T.ZERO:T.ONE],s.ao.transparent,[!1,!1,!1,!0],_e?T.FUNC_ADD:T.MAX);pl(ye,f,t,o,d,Oe,Pi.disabled,nt,ki.disabled,_e,"clear",H,$,W,ie,re,qe,O,xe,Ze)}};if(ue||de){let _e;if(f.prepareDrawTile(),S){const xe=S.drapeBufferSize[0],Ze=S.drapeBufferSize[1];_e=S.framebufferCopyTexture,_e&&(!_e||_e.size[0]===xe&&_e.size[1]===Ze)||(_e&&_e.destroy(),_e=S.framebufferCopyTexture=new s.T(v,new s.q({width:xe,height:Ze}),T.RGBA8)),_e.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,xe,Ze)}ue&&ge(!0,!1,_e),de&&ge(!1,!0,_e)}}else ue&&ve(!0),de&&ve(!1),(ue||de)&&f.resetStencilClippingMasks()}}},building:function(f,t,o,d){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=o.paint.get("building-ambient-occlusion-ground-intensity"),v=o.paint.get("building-ambient-occlusion-ground-radius"),T=o.paint.get("building-ambient-occlusion-ground-attenuation"),S=o.paint.get("building-opacity");if(S<=0)return;let R=y>0&&v>0,O=!0;const k=o.paint.get("building-vertical-scale");(!f.shadowRenderer||k<1)&&(O=!1);const U=f.conflationActive&&f.style.isLayerClipped(o,t.getSource()),F=f.style.order.indexOf(o.fqid);if((function(H,$,W,ie,X,re){for(const ue of re){const de=$.getTile(ue).getBucket(W);de&&(X&&de.updateReplacement(ue,H.replacementSource,ie),de.uploadUpdatedIndexBuffer(H.context))}})(f,t,o,F,U,d),(function(H,$,W,ie){for(const X of ie){const re=$.getTile(X).getBucket(W);re&&re.needsEvaluation()&&re.uploadUpdatedColorBuffer(H.context)}})(f,t,o,d),o.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const H=f.shadowRenderer,$=[],W=H.getShadowPassDepthMode();nu({painter:f,source:t,layer:o,coords:d,defines:$,blendMode:H.getShadowPassColorMode(),depthMode:W,opacity:S,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(f.renderPass==="translucent"){let H=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];O&&(H=H.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(H=H.concat("NORMAL_OFFSET"));const $=o.paint.get("building-facade-emissive-chance"),W=o.paint.get("building-ambient-occlusion-intensity"),ie=new ei(f.context.gl.LEQUAL,ei.ReadWrite,f.depthRangeFor3D);S<1&&nu({painter:f,source:t,layer:o,coords:d,defines:H,blendMode:Xi.disabled,depthMode:ie,opacity:S,verticalScale:k,facadeEmissiveChance:$,facadeAOIntensity:W});const X=f.colorModeForRenderPass();nu({painter:f,source:t,layer:o,coords:d,defines:H,blendMode:X,depthMode:ie,opacity:S,verticalScale:k,facadeEmissiveChance:$,facadeAOIntensity:W}),R&&(function(re,ue,de,be,ye,ve,ge,_e,xe,Ze,Oe,ot,qe){const nt=re.context.gl,zt=re.depthModeForSublayer(1,ei.ReadOnly,nt.LEQUAL,!0),He=.1*(1-(Pe=Oe))+3*Pe;var Pe;const lt=re._showOverdrawInspector,Ke=ot,yt=new Ss;lt||pl(yt,re,ue,de,be,zt,new Pi({func:nt.ALWAYS,mask:255},255,255,nt.KEEP,nt.KEEP,nt.REPLACE),new Xi([nt.ONE,nt.ONE,nt.ONE,nt.ONE],s.ao.transparent,[!1,!1,!1,!0],nt.MIN),ki.disabled,ye,"sdf",ve,ge,_e,0,Ze,He,Ke,!1);{const Rt=lt?Pi.disabled:new Pi({func:nt.EQUAL,mask:255},255,255,nt.KEEP,nt.DECR,nt.DECR),Yt=lt?re.colorModeForRenderPass():new Xi([nt.ONE_MINUS_DST_ALPHA,nt.DST_ALPHA,nt.ONE,nt.ONE],s.ao.transparent,[!0,!0,!0,!0]);pl(yt,re,ue,de,be,zt,Rt,Yt,ki.disabled,ye,"color",ve,ge,_e,0,Ze,He,Ke,!1)}})(f,t,o,d,!0,S,y,v,0,[0,0,0],T,U)}else if(f.renderPass==="light-beam"){const H=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],$=new ei(f.context.gl.LEQUAL,ei.ReadOnly,f.depthRangeFor3D);nu({painter:f,source:t,layer:o,coords:d,defines:H,blendMode:Xi.alphaBlended,depthMode:$,opacity:S,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,o,d){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,v=f.terrain&&f.terrain.renderingToTexture,[T,S]=f.renderPass!=="translucent"||v?[{},d]:f.stencilConfigForOverlap(d);for(const R of S){const O=t.getTile(R);if(O.needsHillshadePrepare&&f.renderPass==="offscreen")gp(f,O,o);else if(f.renderPass==="translucent"){const k=f.depthModeForSublayer(0,ei.ReadOnly),U=o.paint.get("hillshade-emissive-strength"),F=f.colorModeForDrapableLayerRenderPass(U),H=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):T[R.overscaledZ];Yc(f,R,O,o,k,H,F)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,o,d,y,v){if(f.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",S=o.paint.get("raster-elevation")!==0,R=S&&T;if(f.renderElevatedRasterBackface&&!R)return;const O=f.context,k=O.gl,U=t.getSource(),F=(function(ye,ve,ge,_e){const xe=ve.paint.get("raster-color"),Ze=ye.type==="raster-array",Oe=[],ot=ve.paint.get("raster-resampling"),qe=ve.paint.get("raster-color-mix");let nt=ve.paint.get("raster-color-range");const zt=[qe[0],qe[1],qe[2],0],He=qe[3];let Pe=ot==="nearest"?_e.NEAREST:_e.LINEAR;if(Ze&&(Oe.push("RASTER_ARRAY"),xe||Oe.push("RASTER_COLOR"),ot==="linear"&&Oe.push("RASTER_ARRAY_LINEAR"),Pe=_e.NEAREST,!nt&&ye.rasterLayers)){const lt=ye.rasterLayers.find((({id:Ke})=>Ke===ve.sourceLayer));lt&&lt.fields&&lt.fields.range&&(nt=lt.fields.range)}if(nt=nt||[0,1],xe){Oe.push("RASTER_COLOR"),ge.activeTexture.set(_e.TEXTURE2),ve.updateColorRamp(nt);let lt=ve.colorRampTexture;lt||(lt=ve.colorRampTexture=new s.T(ge,ve.colorRamp,_e.RGBA8)),lt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:zt,range:nt,offset:He,defines:Oe,resampling:Pe}})(U,o,O,k);if(U instanceof s.aS&&!d.length&&!T)return;const H=o.paint.get("raster-emissive-strength"),$=f.colorModeForDrapableLayerRenderPass(H),W=f.terrain&&f.terrain.renderingToTexture,ie=!f.options.moving,X=o.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof s.aS&&!d.length&&(U.onNorthPole||U.onSouthPole)){const ye=S?f.stencilModeFor3D():Pi.disabled;return void wh(!!U.onNorthPole,null,f,t,o,H,F,ki.disabled,ye)}if(!d.length)return;const[re,ue]=U instanceof s.aS||W?[{},d]:f.stencilConfigForOverlap(d),de=ue[ue.length-1].overscaledZ;R&&F.defines.push("PROJECTION_GLOBE_VIEW"),S&&F.defines.push("RENDER_CUTOFF");const be=(ye,ve,ge)=>{for(const _e of ye){const xe=_e.toUnwrapped(),Ze=t.getTile(_e);if(W&&(!Ze||!Ze.hasData()))continue;O.activeTexture.set(k.TEXTURE0);const Oe=Th(Ze,U,o,F);if(!Oe||!Oe.texture)continue;const{texture:ot,mix:qe,offset:nt,tileSize:zt,buffer:He}=Oe;let Pe,lt;W?(Pe=ei.disabled,lt=_e.projMatrix):S?(Pe=new ei(k.LEQUAL,ei.ReadWrite,f.depthRangeFor3D),lt=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(xe,ie)):(Pe=f.depthModeForSublayer(_e.overscaledZ-de,o.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,k.LESS),lt=f.transform.calculateProjMatrix(xe,ie));const Ke=f.terrain&&W?f.terrain.stencilModeForRTTOverlap(_e):re[_e.overscaledZ],yt=v?0:o.paint.get("raster-fade-duration");Ze.registerFadeDuration(yt);const Rt=t.findLoadedParent(_e,0),Yt=Lu(Ze,Rt,t,f.transform,yt);let Mt,Tt;!Yt.isFading&&Ze.refreshedUponExpiration&&(Ze.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),O.activeTexture.set(k.TEXTURE0),ot.bind(X,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(X,k.CLAMP_TO_EDGE),Mt=Math.pow(2,Rt.tileID.overscaledZ-Ze.tileID.overscaledZ),Tt=[Ze.tileID.canonical.x*Mt%1,Ze.tileID.canonical.y*Mt%1]):ot.bind(X,k.CLAMP_TO_EDGE),"useMipmap"in ot&&O.extTextureFilterAnisotropic&&f.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const _i=f.transform;let li;const fi=S?Rf(_i):[0,0,0,0];let ci,Fi,bi,Ei,Ni,ui=0;if(R&&U instanceof s.aS&&U.coordinates.length>3)ci=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0)))),Fi=Float32Array.from(_i.globeMatrix),bi=Float32Array.from(s.dB(_i)),Ei=[s.aF(_i.center.lng),s.aJ(_i.center.lat)],li=U.elevatedGlobePerspectiveTransform,Ni=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Gi=s.dC(_e.canonical);ui=s.dD(Gi.getCenter().lat),ci=Float32Array.from(s.bk(s.dF(_e.canonical))),Fi=Float32Array.from(_i.globeMatrix),bi=Float32Array.from(s.dB(_i)),Ei=[s.aF(_i.center.lng),s.aJ(_i.center.lat)],li=[0,0],Ni=Float32Array.from(s.dE(_e.canonical,Gi,ui,_i.worldSize/_i._pixelsPerMercatorPixel))}else li=U instanceof s.aS?U.perspectiveTransform:[0,0],ci=new Float32Array(16),Fi=new Float32Array(9),bi=new Float32Array(16),Ei=[0,0],Ni=new Float32Array(9);const Vi=ku(lt,ci,Fi,bi,Ni,Tt||[0,0],s.aj(f.transform.zoom),Ei,fi,Mt||1,Yt,o,li,S?o.paint.get("raster-elevation"):0,2,qe,nt,F.range,zt,He,H),_n=f.isTileAffectedByFog(_e),qn=f.getOrCreateProgram("raster",{defines:F.defines,overrideFog:_n});if(f.uploadCommonUniforms(O,qn,xe),U instanceof s.aS){const Gi=U.elevatedGlobeVertexBuffer,Mn=U.elevatedGlobeIndexBuffer;if(W||!T)U.boundsBuffer&&U.boundsSegments&&qn.draw(f,k.TRIANGLES,Pe,Pi.disabled,$,ki.disabled,Vi,o.id,U.boundsBuffer,f.quadTriangleIndexBuffer,U.boundsSegments);else if(Gi&&Mn){const xn=_i.zoom<=s.cZ?U.elevatedGlobeSegments:U.getSegmentsForLongitude(_i.center.lng);xn&&qn.draw(f,k.TRIANGLES,Pe,Pi.disabled,$,ve,Vi,o.id,Gi,Mn,xn)}}else if(R){Pe=new ei(k.LEQUAL,ei.ReadOnly,f.depthRangeFor3D);const Gi=f.globeSharedBuffers;if(Gi){const[Mn,xn,Qi]=Gi.getGridBuffers(ui,!1);qn.draw(f,k.TRIANGLES,Pe,ge||Ke,f.colorModeForRenderPass(),ve,Vi,o.id,Mn,xn,Qi)}}else{const{tileBoundsBuffer:Gi,tileBoundsIndexBuffer:Mn,tileBoundsSegments:xn}=f.getTileBoundsBuffers(Ze);qn.draw(f,k.TRIANGLES,Pe,Ke,$,ki.disabled,Vi,o.id,Gi,Mn,xn)}}if(!(U instanceof s.aS)&&R)for(const _e of ye){const xe=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&wh(!0,_e,f,t,o,H,F,ve,ge||Pi.disabled),xe&&wh(!1,_e,f,t,o,H,F,ve===ki.frontCW?ki.backCW:ki.frontCW,ge||Pi.disabled)}};R?be(ue,f.renderElevatedRasterBackface?ki.backCW:ki.frontCW,f.stencilModeFor3D()):be(ue,ki.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,o,d,y,v){f.renderPass==="offscreen"&&(function(T,S,R,O){if(!O.length)return;const k=T.context,U=k.gl,F=S.getSource();if(!(F instanceof ta))return;const H=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let $=R.particlePositionRGBAImage;if(!$||$.width!==H){const ue=(function(de){const be=de*de,ye=new Uint8Array(4*be),ve=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let _e=0;_e<be;_e++){const xe=ge*(ve(2*_e+0)+Hl),Ze=ge*(ve(2*_e+1)+Hl),Oe=255*xe%1,ot=255*Ze%1,qe=Oe,nt=Ze-ot/255,zt=ot;ye[4*_e+0]=255*(xe-Oe/255),ye[4*_e+1]=255*qe,ye[4*_e+2]=255*nt,ye[4*_e+3]=255*zt}return ye})(H);$=R.particlePositionRGBAImage=new s.q({width:H,height:H},ue)}let W=R.particleFramebuffer;W?W.width!==H&&(W.destroy(),W=R.particleFramebuffer=k.createFramebuffer(H,H,!0,null)):W=R.particleFramebuffer=k.createFramebuffer(H,H,!0,null);const ie=[];for(const ue of O){const de=S.getTile(ue);if(!(de instanceof nl))continue;const be=qo(de,F,R);if(!be)continue;const ye=[de.tileSize,de.tileSize];let ve=R.tileFramebuffer;ve||(ve=R.tileFramebuffer=k.createFramebuffer(ye[0],ye[1],!0,null));let ge=de.rasterParticleState;ge||(ge=de.rasterParticleState=new Ls(k,ue,ye,$));const _e=ge.update(R.lastInvalidatedAt);ge.particleTextureDimension!==H&&ge.updateParticleTexture(ue,$);const xe=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=xe;const Ze=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Ze,ie.push([ue,be,ge,_e])}if(ie.length===0)return;const X=s.o.now(),re=R.previousDrawTimestamp?.001*(X-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=X,R.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let ue=R.colorRampTexture;ue||(ue=R.colorRampTexture=new s.T(k,R.colorRamp,U.RGBA8)),ue.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(R.tileFramebuffer.framebuffer),(function(ue,de,be){const ye=ue.context,ve=ye.gl,ge=de.tileFramebuffer;ye.activeTexture.set(ve.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(Ze=de.paint.get("raster-particle-fade-opacity-factor"))/(Ze+.05)},xe=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ze;for(const Oe of be){const[,,ot,qe]=Oe;ge.colorAttachment.set(ot.targetColorTexture.texture),ye.viewport.set([0,0,ge.width,ge.height]),ye.clear({color:s.ao.transparent}),qe&&(ot.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),xe.draw(ue,ve.TRIANGLES,ei.disabled,Pi.disabled,Xi.alphaBlended,ki.disabled,_e,de.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}})(T,R,ie),(function(ue,de,be,ye){const ve=ue.context,ge=ve.gl,_e=be.tileFramebuffer,xe=ue.transform.projection.name==="globe",Ze=be.paint.get("raster-particle-max-speed");for(const Oe of ye){const[ot,qe,nt]=Oe;ve.activeTexture.set(ge.TEXTURE0+0),qe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),_e.colorAttachment.set(nt.targetColorTexture.texture);const zt=ue.getOrCreateProgram("rasterParticleDraw",{defines:qe.defines,overrideFog:!1});ve.activeTexture.set(ge.TEXTURE0+1);const He=qe.scalarData?[]:[0,1,2,3].map((Ke=>s.e6[Ke](ot)));He.push(ot);const Pe=ot.canonical.x,lt=ot.canonical.y;for(const Ke of He){const yt=de.getTile(xe?Ke.wrapped():Ke);if(!yt)continue;const Rt=yt.rasterParticleState;if(!Rt)continue;const Yt=Ke.canonical.x+(1<<Ke.canonical.z)*(Ke.wrap-ot.wrap),Mt=Ke.canonical.y;Rt.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const Tt=Rp(1,Rt.particleTexture0.size[0],[Yt-Pe,Mt-lt],0,qe.texture.size,2,Ze,qe.textureOffset,qe.scale,qe.offset);zt.draw(ue,ge.POINTS,ei.disabled,Pi.disabled,Xi.alphaBlended,ki.disabled,Tt,be.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}})(T,S,R,ie),k.bindFramebuffer.set(R.particleFramebuffer.framebuffer),(function(ue,de,be,ye){const ve=ue.context,ge=ve.gl,_e=de.paint.get("raster-particle-max-speed"),xe=ye*de.paint.get("raster-particle-speed-factor")*.15,Ze=(function(ot){return Math.pow(ot,6)})(.01+1*de.paint.get("raster-particle-reset-rate-factor")),Oe=de.particleFramebuffer;ve.viewport.set([0,0,Oe.width,Oe.height]);for(const ot of be){const[,qe,nt]=ot;ve.activeTexture.set(ge.TEXTURE0+0),qe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),ve.activeTexture.set(ge.TEXTURE0+1);const zt=nt.particleTexture0;zt.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const He=Ec(1,zt.size[0],0,qe.texture.size,_e,xe,Ze,qe.textureOffset,qe.scale,qe.offset);Oe.colorAttachment.set(nt.particleTexture1.texture),ve.clear({color:s.ao.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:qe.defines}).draw(ue,ge.TRIANGLES,ei.disabled,Pi.disabled,Xi.unblended,ki.disabled,He,de.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}})(T,R,ie,re)})(f,t,o,d),f.renderPass==="translucent"&&((function(T,S,R,O,k){const U=T.context,F=U.gl,H=S.getSource().tileSize,$=5*(1-s.ah(s.cK,s.cK+1,T.transform.zoom))*H+R.paint.get("raster-particle-elevation"),W=!T.options.moving,ie=T.transform.projection.name==="globe";if(!O.length)return;const[X,re]=T.stencilConfigForOverlap(O),ue=[];ie&&ue.push("PROJECTION_GLOBE_VIEW");const de=T.stencilModeFor3D();for(const be of re){const ye=be.toUnwrapped(),ve=S.getTile(be);if(!ve.rasterParticleState)continue;const ge=ve.rasterParticleState,_e=100;ve.registerFadeDuration(_e);const xe=S.findLoadedParent(be,0),Ze=Lu(ve,xe,S,T.transform,_e);let Oe,ot;T.terrain&&T.terrain.prepareDrawTile(),U.activeTexture.set(F.TEXTURE0),ge.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),U.activeTexture.set(F.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Oe=Math.pow(2,xe.tileID.overscaledZ-ve.tileID.overscaledZ),ot=[ve.tileID.canonical.x*Oe%1,ve.tileID.canonical.y*Oe%1]):ge.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const qe=ie?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(ye,W),nt=T.transform,zt=Mf(nt),He=s.dC(be.canonical),Pe=s.dD(He.getCenter().lat);let lt,Ke,yt,Rt,Yt;ie?(lt=Float32Array.from(s.bk(s.dF(be.canonical))),Ke=Float32Array.from(nt.globeMatrix),yt=Float32Array.from(s.dB(nt)),Rt=[s.aF(nt.center.lng),s.aJ(nt.center.lat)],Yt=Float32Array.from(s.dE(be.canonical,He,Pe,nt.worldSize/nt._pixelsPerMercatorPixel))):(lt=new Float32Array(16),Ke=new Float32Array(9),yt=new Float32Array(16),Rt=[0,0],Yt=new Float32Array(9));const Mt=Wl(qe,lt,Ke,yt,Yt,ot||[0,0],s.aj(T.transform.zoom),Rt,zt,Oe||1,Ze,$),Tt=T.isTileAffectedByFog(be),_i=T.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Tt});if(T.uploadCommonUniforms(U,_i,ye),ie){const li=new ei(F.LEQUAL,ei.ReadOnly,T.depthRangeFor3D),fi=0,ci=T.globeSharedBuffers;if(ci){const[Fi,bi,Ei]=ci.getGridBuffers(Pe,fi!==0);_i.draw(T,F.TRIANGLES,li,de,Xi.alphaBlended,T.renderElevatedRasterBackface?ki.frontCCW:ki.backCCW,Mt,R.id,Fi,bi,Ei)}}else{const li=T.depthModeForSublayer(0,ei.ReadOnly),fi=X[be.overscaledZ],{tileBoundsBuffer:ci,tileBoundsIndexBuffer:Fi,tileBoundsSegments:bi}=T.getTileBoundsBuffers(ve);_i.draw(T,F.TRIANGLES,li,fi,Xi.alphaBlended,ki.disabled,Mt,R.id,ci,Fi,bi)}}T.resetStencilClippingMasks()})(f,t,o,d),f.style.map.triggerRepaint())},background:function(f,t,o,d){const y=o.paint.get("background-color"),v=o.paint.get("background-color-use-theme").constantOr("default")==="none",T=o.paint.get("background-opacity"),S=o.paint.get("background-emissive-strength"),R=o.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const O=f.context,k=O.gl,U=f.transform,F=U.tileSize,H=o.paint.get("background-pattern");let $;if(H!==void 0&&(H===null||($=f.imageManager.getPattern(s.I.from(H.toString()),o.scope,f.style.getLut(o.scope)),!$)))return;const W=!H&&y.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==W)return;const ie=Pi.disabled,X=f.depthModeForSublayer(0,W==="opaque"?ei.ReadWrite:ei.ReadOnly),re=f.colorModeForDrapableLayerRenderPass(S),ue=H?"backgroundPattern":"background";let de,be=d;if(be||(de=f.getBackgroundTiles(),be=Object.values(de).map((ye=>ye.tileID))),H&&(O.activeTexture.set(k.TEXTURE0),f.imageManager.bind(f.context,o.scope)),R){const ye=f.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(s.bA([])),ge=new s.aO(0,0,0,0,0),_e=H?Sd(ve,S,T,f,0,o.scope,$,R,{tileID:ge,tileSize:F}):Ed(ve,S,T,y.toPremultipliedRenderColor(v?null:o.lut));ye.draw(f,k.TRIANGLES,X,ie,re,ki.disabled,_e,o.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const ye of be){const ve=f.isTileAffectedByFog(ye),ge=f.getOrCreateProgram(ue,{overrideFog:ve}),_e=ye.toUnwrapped(),xe=d?ye.projMatrix:f.transform.calculateProjMatrix(_e);f.prepareDrawTile();const Ze=t?t.getTile(ye):de?de[ye.key]:new Ol(ye,F,U.zoom,f),Oe=H?Sd(xe,S,T,f,0,o.scope,$,R,{tileID:ye,tileSize:F}):Ed(xe,S,T,y.toPremultipliedRenderColor(v?null:o.lut));f.uploadCommonUniforms(O,ge,_e);const{tileBoundsBuffer:ot,tileBoundsIndexBuffer:qe,tileBoundsSegments:nt}=f.getTileBoundsBuffers(Ze);ge.draw(f,k.TRIANGLES,X,ie,re,ki.disabled,Oe,o.id,ot,qe,nt)}},sky:function(f,t,o){const d=f._atmosphere?s.aj(f.transform.zoom):1,y=o.paint.get("sky-opacity")*d;if(y===0)return;const v=f.context,T=o.paint.get("sky-type"),S=new ei(v.gl.LEQUAL,ei.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?o.needsSkyboxCapture(f)&&((function(O,k,U,F){const H=O.context,$=H.gl;let W=k.skyboxFbo;if(!W){W=k.skyboxFbo=H.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Md(H),k.skyboxTexture=H.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,k.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ue=0;ue<6;++ue)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(W.framebuffer),H.viewport.set([0,0,32,32]);const ie=k.getCenter(O,!0),X=O.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);s.bA(re),s.ek(re,re,.5*-Math.PI),su(O,k,X,re,ie,0),s.bA(re),s.ek(re,re,.5*Math.PI),su(O,k,X,re,ie,1),s.bA(re),s.cT(re,re,.5*-Math.PI),su(O,k,X,re,ie,2),s.bA(re),s.cT(re,re,.5*Math.PI),su(O,k,X,re,ie,3),s.bA(re),su(O,k,X,re,ie,4),s.bA(re),s.ek(re,re,Math.PI),su(O,k,X,re,ie,5),H.viewport.set([0,0,O.width,O.height])})(f,o),o.markSkyboxValid(f)):f.renderPass==="sky"&&(function(O,k,U,F,H){const $=O.context,W=$.gl,ie=O.transform,X=O.getOrCreateProgram("skybox");$.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,k.skyboxTexture);const re=((ue,de,be,ye,ve)=>({u_matrix:ue,u_sun_direction:de,u_cubemap:0,u_opacity:ye,u_temporal_offset:ve}))(ie.skyboxMatrix,k.getCenter(O,!1),0,F,H);O.uploadCommonUniforms($,X),X.draw(O,W.TRIANGLES,U,Pi.disabled,O.colorModeForRenderPass(),ki.backCW,re,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(f,o,S,y,R):T==="gradient"&&f.renderPass==="sky"&&(function(O,k,U,F,H){const $=O.context,W=$.gl,ie=O.transform,X=O.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Md($)),$.activeTexture.set(W.TEXTURE0);let re=k.colorRampTexture;re||(re=k.colorRampTexture=new s.T($,k.colorRamp,W.RGBA8)),re.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ue=((de,be,ye,ve,ge)=>({u_matrix:de,u_color_ramp:0,u_center_direction:be,u_radius:s.an(ye),u_opacity:ve,u_temporal_offset:ge}))(ie.skyboxMatrix,k.getCenter(O,!1),k.paint.get("sky-gradient-radius"),F,H);O.uploadCommonUniforms($,X),X.draw(O,W.TRIANGLES,U,Pi.disabled,O.colorModeForRenderPass(),ki.backCW,ue,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(f,o,S,y,R)},custom:function(f,t,o,d){const y=f.context,v=o.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&o.isDraped(t)){if(f.renderPass==="offscreen"){const T=v.prerender;if(T){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;T.call(v,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else T.call(v,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const S=v.renderToTile;if(S){const R=d[0].canonical,O={x:R.x+d[0].wrap*(v.wrapTileId?0:1<<R.z),y:R.y,z:R.z};y.setDepthMode(ei.disabled),y.setStencilMode(Pi.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),S.call(v,y.gl,O),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Pi.disabled);const T=v.renderingMode==="3d"?new ei(f.context.gl.LEQUAL,ei.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,ei.ReadOnly);if(y.setDepthMode(T),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;v.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else v.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,o,d){if(f.renderPass==="opaque")return;const y=o.paint.get("model-opacity").constantOr(1);if(y===0)return;const v=o.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&y<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const T=f.shadowRenderer,S=o.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,S||(T.enabled=!1));const R=()=>{T&&(T.useNormalOffset=!0,S||(T.enabled=!0))},O=t.getSource();if(f.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return(function(X,re,ue,de,be){const ye=X.transform;if(ye.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ye.projection.name} projection is not yet implemented`);const ve=ye.getFreeCameraOptions().position;if(!X.modelManager)return;const ge=X.modelManager;ue.modelManager=ge;const _e=X.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xe=ue._unevaluatedLayout._values["model-id"],Ze=Object.assign({},ue.layout.get("model-id").parameters),Oe=X.style.order.indexOf(ue.fqid);for(const ot of de){const qe=re.getTile(ot).getBucket(ue);if(!qe||qe.projection.name!==ye.projection.name)continue;const nt=qe.getModelUris();nt&&!qe.modelsRequested&&(ge.addModelsFromBucket(nt,be),qe.modelsRequested=!0);const zt=Uu(ot,ye);Ze.zoom=zt;const He=xe.possiblyEvaluate(Ze);if($m(X,qe,ot),ml.shadowUniformsInitialized=!1,ml.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(ot.toUnwrapped())===0,X.renderPass==="shadow"&&_e){if(X.currentShadowCascade===1&&qe.isInsideFirstShadowMapFrustum)continue;const Ke=ye.calculatePosMatrix(ot.toUnwrapped(),ye.worldSize);if(ml.tileMatrix.set(Ke),ml.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Ke)),ml.aabb.min=[0,0,0],ml.aabb.max[0]=ml.aabb.max[1]=s.al,ml.aabb.max[2]=0,Xm(qe,ml,X,ue.scope))continue}const Pe=1<<ot.canonical.z,lt=[((ve.x-ot.wrap)*Pe-ot.canonical.x)*s.al,(ve.y*Pe-ot.canonical.y)*s.al,ve.z*Pe*s.al];X.conflationActive&&Object.keys(qe.instancesPerModel).length>0&&X.style.isLayerClipped(ue,re.getSource())&&qe.updateReplacement(ot,X.replacementSource,Oe,be)&&(qe.uploaded=!1,qe.upload(X.context));for(let Ke in qe.instancesPerModel){const yt=qe.instancesPerModel[Ke];yt.features.length>0&&(Ke=He.evaluate(yt.features[0].feature,{}));const Rt=ge.getModel(Ke,be);if(Rt||ge.hasURLBeenRequested(Ke)||qe.modelUris.includes(Ke)||(qe.modelUris.push(Ke),qe.modelsRequested=!1),Rt&&Rt.uploaded)for(const Yt of Rt.nodes)Zm(X,ue,Yt,yt,lt,ot,ml)}}})(f,t,o,d,O.type==="vector"?o.scope:""),void R();if(!O.loaded())return;if(O.type==="batched-model")return(function(X,re,ue,de){ue.resetLayerRenderingStats(X);const be=X.context,ye=X.transform,ve=X.style.fog,ge=X.shadowRenderer;if(ye.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const _e=X.transform.getFreeCameraOptions().position,xe=s.c4([],[_e.x,_e.y,_e.z],X.transform.worldSize),Ze=s.et([],xe),Oe=s.bA([]),ot=s.ec(ye.center.lat,ye.zoom),qe=s.bq([],[1,1,1/ot]);s.br(Oe,Oe,Ze);const nt=ue.paint.get("model-opacity").constantOr(1),zt=new ei(be.gl.LEQUAL,ei.ReadWrite,X.depthRangeFor3D),He=new ei(be.gl.LEQUAL,ei.ReadOnly,X.depthRangeFor3D),Pe=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),lt=X.renderPass==="shadow",Ke=lt&&ge?ge.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),yt=ue.paint.get("model-front-cutoff"),Rt=yt[2]<1,Yt=Au(X,ue.paint.get("model-cutoff-fade-range")),Mt=ue.getLayerRenderingStats();(function(Tt,_i,li,fi){const ci=Tt.terrain?Tt.terrain.exaggeration():0,Fi=Tt.transform.zoom;for(const bi of fi){const Ei=_i.getTile(bi).getBucket(li);Ei&&(Ei.setFilter(li.filter),Tt.conflationActive&&Ei.updateReplacement(bi,Tt.replacementSource),Ei.evaluateTransform(Tt,li),Tt.terrain&&ci>0&&Ei.elevationUpdate(Tt.terrain,ci,bi,li.source),Ei.needsReEvaluation(Tt,Fi,li)&&Ei.evaluate(li))}})(X,re,ue,de),(function(){let Tt,_i,li;Rt?(Tt=de.length-1,_i=-1,li=-1):(Tt=0,_i=de.length,li=1);const fi=new Float64Array(16),ci=s.cz(),Fi=new s.P(0,0);for(let bi=Tt;bi!==_i;bi+=li){const Ei=de[bi],Ni=re.getTile(Ei).getBucket(ue);if(!Ni||!Ni.uploaded)continue;let ui=!1;ge&&(ui=ge.getMaxCascadeForTile(Ei.toUnwrapped())===0);const Vi=ye.calculatePosMatrix(Ei.toUnwrapped(),ye.worldSize),_n=Ni.modelTraits;!lt&&Rt&&(s.bl(fi,Vi),s.af(ci,xe,fi),Fi.x=ci[0],Fi.y=ci[1]);const qn=[];Ni.setFilter(ue.filter);for(const Gi of Ni.getNodesInfo()){if(Gi.hiddenByReplacement||!Gi.node.meshes)continue;const Mn=Gi.node;let xn=0;X.terrain&&Mn.elevation&&(xn=Mn.elevation*X.terrain.exaggeration());const Qi=(()=>{const As=Gi.aabb;return Pe.min=[...As.min],Pe.max=[...As.max],Pe.min[2]+=xn,Pe.max[2]+=xn,s.af(Pe.min,Pe.min,Vi),s.af(Pe.max,Pe.max,Vi),Pe})(),$n=Gi.evaluatedScale;if($n[0]<=1&&$n[1]<=1&&$n[2]<=1&&Qi.intersects(Ke)===0)continue;if(!lt&&Rt){const As=.16666666666666666;Gi.cameraCollisionOpacity=xe[0]>Qi.min[0]&&xe[0]<Qi.max[0]&&xe[1]>Qi.min[1]&&xe[1]<Qi.max[1]&&xe[2]*ot<Qi.max[2]&&Mn.footprint&&s.b$(Fi,Mn.footprint)?Math.max(Gi.cameraCollisionOpacity-As,0):Math.min(1,Gi.cameraCollisionOpacity+As)}const vr=[...Vi],ws=1/s.d6(Ei.canonical),zn=Mn.anchor?Mn.anchor[0]:0,qi=Mn.anchor?Mn.anchor[1]:0;s.br(vr,vr,[zn*($n[0]-1)+Gi.evaluatedTranslation[0]*ws,qi*($n[1]-1)+Gi.evaluatedTranslation[1]*ws,xn+Gi.evaluatedTranslation[2]]),s.cp($n,s.ev)||s.cR(vr,vr,$n);const Ci=s.aB([],vr,Mn.matrix),yn=s.aB([],ye.expandedFarZProjMatrix,Ci),Mr=s.aB([],ye.expandedFarZProjMatrix,vr),fr=s.aC([],[zn,qi,xn,1],yn)[2];Mn.hidden=!1;let as=nt;lt||(Rt&&(as*=Gi.cameraCollisionOpacity,as*=zp(vr,ye,Gi.aabb,yt)),as*=Of(Yt,fr)),as!==0?qn.push({nodeInfo:Gi,depth:fr,opacity:as,wvpForNode:yn,wvpForTile:Mr,nodeModelMatrix:Ci,tileModelMatrix:vr}):Mn.hidden=!0}lt||qn.sort(((Gi,Mn)=>!Rt||Gi.opacity===1&&Mn.opacity===1?Gi.depth<Mn.depth?-1:1:Gi.opacity===1?-1:Mn.opacity===1?1:Gi.depth>Mn.depth?-1:1));for(const Gi of qn){const Mn=Gi.nodeInfo,xn=Mn.node;let Qi=s.aB([],qe,Gi.tileModelMatrix);s.aB(Qi,Oe,Qi);const $n=s.bl([],Qi);s.ed($n,$n),s.cR($n,$n,l_),Qi=s.aB(Qi,Qi,xn.matrix);const vr=X.renderPass==="light-beam",ws=ue.paint.get("model-color-use-theme").constantOr("default")==="none",zn=_n&s.ez.HasMapboxMeshFeatures,qi=zn?0:Mn.evaluatedRMEA[0][2];for(let Ci=0;Ci<xn.meshes.length;++Ci){const yn=xn.meshes[Ci],Mr=Ci===xn.lightMeshIndex;let fr=Gi.wvpForNode;if(Mr){if(!vr&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}fr=Gi.wvpForTile}else if(vr)continue;const as={defines:[]},As=[];if(!lt&&ge&&(ge.useNormalOffset=!!yn.normalBuffer),Pd(as.defines,As,yn,X,ws?null:ue.lut),zn||as.defines.push("DIFFUSE_SHADED"),ui&&as.defines.push("SHADOWS_SINGLE_CASCADE"),Mt&&(lt?Mt.numRenderedVerticesInShadowPass+=yn.vertexArray.length:Mt.numRenderedVerticesInTransparentPass+=yn.vertexArray.length),lt){Dd(yn,Gi.nodeModelMatrix,X,ue);continue}let Wo=null;if(ve){const Ga=Be(Gi.nodeModelMatrix,X.transform);if(Wo=new Float32Array(Ga),ye.projection.name!=="globe"){const zr=yn.aabb.min,$r=yn.aabb.max,[cr,cs]=ve.getOpacityForBounds(Ga,zr[0],zr[1],$r[0],$r[1]);as.overrideFog=cr>=di||cs>=di}}const Js=yn.material;let Lr;Js.occlusionTexture&&Js.occlusionTexture.offsetScale&&(Lr=Js.occlusionTexture.offsetScale,as.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const qs=X.getOrCreateProgram("model",as);!lt&&ge&&ge.setupShadowsFromMatrix(Gi.tileModelMatrix,qs,ge.useNormalOffset),X.uploadCommonUniforms(be,qs,null,Wo);const Hs=Js.pbrMetallicRoughness;Hs.metallicFactor=.9,Hs.roughnessFactor=.5;const eo=$l(new Float32Array(fr),new Float32Array(Qi),new Float32Array($n),new Float32Array(xn.matrix),X,Gi.opacity,Hs.baseColorFactor,Js.emissiveFactor,Hs.metallicFactor,Hs.roughnessFactor,Js,qi,ue,[0,0,0],Lr);!Mr&&(Mn.hasTranslucentParts||Gi.opacity<1)&&qs.draw(X,be.gl.TRIANGLES,zt,Pi.disabled,Xi.disabled,ki.backCCW,eo,ue.id,yn.vertexBuffer,yn.indexBuffer,yn.segments,ue.paint,X.transform.zoom,void 0,As),qs.draw(X,be.gl.TRIANGLES,Mr?He:zt,Pi.disabled,Mr||Gi.opacity<1||Mn.hasTranslucentParts?Xi.alphaBlended:Xi.unblended,ki.backCCW,eo,ue.id,yn.vertexBuffer,yn.indexBuffer,yn.segments,ue.paint,X.transform.zoom,void 0,As)}}}})()})(f,t,o,d),void R();if(O.type!=="model")return;const k=O.getModels(),U=[],F=f.transform.getFreeCameraOptions().position,H=s.c4([],[F.x,F.y,F.z],f.transform.worldSize);s.et(H,H);const $=[],W=[];let ie=0;for(const X of k){const re=o.paint.get("model-rotation").constantOr(null),ue=o.paint.get("model-scale").constantOr(null),de=o.paint.get("model-translation").constantOr(null);X.computeModelMatrix(f,re,ue,de,!0,!0,!1);const be=s.bA([]),ye=s.ec(X.position.lat,f.transform.zoom),ve=s.bq([],[1,1,1/ye]);s.br(be,be,H),U.push({zScaleMatrix:ve,negCameraPosMatrix:be});for(const ge of X.nodes)Lp(f.transform,ge,X.matrix,f.transform.expandedFarZProjMatrix,ie,$,W);ie++}if($.sort(((X,re)=>re.depth-X.depth)),f.renderPass!=="shadow"){if(y===1)for(const X of W)Vu(X,f,o,U[X.modelIndex],Pi.disabled,f.colorModeForRenderPass());else{for(const X of W)Vu(X,f,o,U[X.modelIndex],Pi.disabled,Xi.disabled);for(const X of W)Vu(X,f,o,U[X.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const X of $)Vu(X,f,o,U[X.modelIndex],Pi.disabled,f.colorModeForRenderPass());R()}else{for(const X of W)Dd(X.mesh,X.nodeModelMatrix,f,o);for(const X of $)Dd(X.mesh,X.nodeModelMatrix,f,o);R()}}},hu={line:function(f,t,o){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const y of d){const v=t.getTile(y).getBucket(f);if(v&&(v.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,o){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,d.type==="vector"?f.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const v of y)v.upload(o.context)},raster:function(f,t,o){const d=t.getSource();if(!(d instanceof ta&&d.loaded()))return;const y=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-array-band")||d.getInitialBand(y);if(v==null)return;const T=t.getIds().map((S=>t.getTileByID(S)));for(const S of T)S.updateNeeded(f.id,v)&&d.prepareTile(S,y,f.id,v)},"raster-particle":function(f,t,o){const d=t.getSource();if(!(d instanceof ta&&d.loaded()))return;const y=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(v==null)return;const T=t.getIds().map((S=>t.getTileByID(S)));for(const S of T)S.updateNeeded(f.id,v)&&d.prepareTile(S,y,f.id,v)}},ju={fill:Fu},du={fill:function(f,t,o,d){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const y=f.context.gl,v=new ei(y.LEQUAL,ei.ReadOnly,f.depthRangeFor3D),T=new Pi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),S=f.transform.getFreeCameraOptions().position,R=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const O of d){const k=t.getTile(O),U=k.getBucket(o);if(!U)continue;const F=U.elevatedStructures;if(!F||F.depthSegments.segments[0].primitiveLength===0)continue;const H=Dp(O.toUnwrapped(),S),$=f.translatePosMatrix(O.projMatrix,k,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),W=Td($,H,0,1,0);R.draw(f,y.TRIANGLES,v,T,Xi.disabled,ki.disabled,W,o.id,F.vertexBuffer,F.indexBuffer,F.depthSegments,o.paint,f.transform.zoom)}}};class tg{constructor(t,o,d,y,v,T){this.context=new Pp(t,o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of S)this._debugParams.enabledLayers[O]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of S)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new au(v),this.setup(),this.numSublayers=wo.maxUnderzooming+wo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Oa(this),this._wireframeDebugCache=new Ym,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,R,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=T}updateTerrain(t,o){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bs(this,t));const y=this._terrain;this.transform.elevation=d?y:null,y.update(t,this.transform,o),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=o.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const v=d+.78*(y-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new bs(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*s.o.devicePixelRatio,this.height=o*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,o=new s.bd;o.emplaceBack(0,0),o.emplaceBack(s.al,0),o.emplaceBack(0,s.al),o.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(o,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const d=new s.bd;d.emplaceBack(0,0),d.emplaceBack(s.al,0),d.emplaceBack(0,s.al),d.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(d,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const y=new s.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const v=new s.b0;v.emplaceBack(0,0,0,0),v.emplaceBack(s.al,0,s.al,0),v.emplaceBack(0,s.al,0,s.al),v.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(v,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const T=new s.b1;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const S=new s.be;for(const O of[0,1,3,2,0])S.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bC();const R=this.context.gl;this.stencilClearMode=new Pi({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ei.disabled,this.stencilClearMode,Xi.disabled,ki.disabled,bc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,d){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const R of d)if(this._tileClippingMaskIDs[R.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const y=this.context,v=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(Xi.disabled),y.setDepthMode(ei.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const R=o.getTile(S),O=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:F}=this.getTileBoundsBuffers(R);T.draw(this,v.TRIANGLES,ei.disabled,new Pi({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),Xi.disabled,ki.disabled,bc(S.projMatrix),"$clipping",k,U,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Pi({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new Pi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,d=t.sort(((T,S)=>S.overscaledZ-T.overscaledZ)),y=d[d.length-1].overscaledZ,v=d[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let S=0;S<v;S++)T[S+y]=new Pi({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[T,d]}return[{[y]:Pi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Xi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xi.unblended:Xi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,d,y=!1){if(this.depthOcclusion)return new ei(this.context.gl.GREATER,ei.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return ei.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ei(d||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&d!==0&&(this.depthFBO=new Af(this.context,o,d,!1,"texture"),this.depthTexture=new s.T(this.context,{width:o,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,d,0,0,o,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,o)=>t+o/this._fpsHistory.length),0))}render(t,o){const d=s.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const y=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(v).filter((He=>{const Pe=y[He];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]}));let S=T(),R=!1,O=!1,k=null;for(const He of S){const Pe=y[He];Pe.type==="circle"?R=!0:Pe.type==="building"?k=Pe:Pe.type==="symbol"&&(Pe.hasOcclusionOpacityProperties?O=!0:R=!0)}let U=S.map((He=>y[He]));const F=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let H=0,$=!1;for(const He in F){const Pe=F[He];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++H)}let W=!1;for(const He of U)He.isHidden(this.transform.zoom)||(He.type==="clip"&&(W=!0),this.prepareLayer(He));const ie={},X={},re={},ue={},de={};for(const He in F){const Pe=F[He];ie[He]=Pe.getVisibleCoordinates(),X[He]=ie[He].slice().reverse(),re[He]=Pe.getVisibleCoordinates(!0).reverse(),ue[He]=Pe.getShadowCasterCoordinates(),de[He]=Pe.sortCoordinatesByDistance(ie[He])}const be=He=>{const Pe=this.style.getLayerSourceCache(He);return Pe&&Pe.used?Pe.getSource():null};if(H||W||this._clippingActiveLastFrame){const He=[],Pe=[];let lt=0;for(const Ke of U)this.isSourceForClippingOrConflation(Ke,be(Ke))&&(He.push(Ke),Pe.push(lt)),lt++;if(He&&(W||He.length>1)||this._clippingActiveLastFrame){W=!1;const Ke=[];for(let yt=0;yt<He.length;yt++){const Rt=He[yt],Yt=Pe[yt],Mt=this.style.getLayerSourceCache(Rt);if(!Mt||!Mt.used||!Mt.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let Tt=s.eH,_i=s.bZ.None;const li=[];let fi=!0;if(Rt.type==="building")Tt=s.eJ;else if(Rt.type==="clip"){Tt=Yt;for(const ci of Rt.layout.get("clip-layer-types"))_i|=ci==="model"?s.bZ.Model:ci==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const ci of Rt.layout.get("clip-layer-scope"))li.push(ci);Rt.isHidden(this.transform.zoom)?fi=!1:W=!0}fi&&Ke.push({layer:Rt.fqid,cache:Mt,order:Tt,clipMask:_i,clipScope:li})}this.replacementSource.setSources(Ke),$=!0}}this._clippingActiveLastFrame=W,$||this.replacementSource.clear(),this.conflationActive=$,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let He=0;He<U.length;He++){const Pe=U[He],lt=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(lt,this.longestCutoffRange),lt>0){const Ke=be(Pe);Ke&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=He),this._lastOcclusionLayer=He)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0,S=T(),U=S.map((He=>y[He])));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const He in F)for(const Pe of ie[He]){let lt={min:0,max:0};this.terrain&&(lt=this.terrain.getMinMaxForTile(Pe)||lt),ve.addShadowReceiver(Pe.toUnwrapped(),lt.min,lt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Eh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ge&&!this._snow&&(this._snow=new eg(this)),!ge&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new dr(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),k){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Or);const He=this.style.getLayerSourceCache(k);this.buildingTileBorderManager.updateBorders(He,k)}if(!Qo.has(this.context.gl))return;this.renderPass="offscreen";for(const He of U){const Pe=t.getLayerSourceCache(He);if(!He.hasOffscreenPass()||He.isHidden(this.transform.zoom))continue;const lt=Pe?X[Pe.id]:void 0;(He.type==="custom"||He.type==="raster"||He.type==="raster-particle"||He.isSky()||lt&&lt.length)&&this.renderLayer(this,Pe,He,lt)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ue)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ze=(()=>{if(o.showOverdrawInspector)return s.ao.black;const He=this.style.fog;if(He&&this.transform.projection.supportsFog){const Pe=this.style.getLut(He.scope);if(!xe){const lt=He.properties.get("color-use-theme")==="none",Ke=He.properties.get("color").toNonPremultipliedRenderColor(lt?null:Pe).toArray01();return new s.ao(...Ke)}if(xe){const lt=He.properties.get("space-color-use-theme")==="none",Ke=He.properties.get("space-color").toNonPremultipliedRenderColor(lt?null:Pe).toArray01();return new s.ao(...Ke)}}return s.ao.transparent})();if(this.context.clear({color:Ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const He=U[this.currentLayer],Pe=t.getLayerSourceCache(He);if(He.isSky())continue;const lt=Pe?(He.is3D(v)?de:X)[Pe.id]:void 0;this._renderTileClippingMasks(He,Pe,lt),this.renderLayer(this,Pe,He,lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const He=U[this.currentLayer],Pe=t.getLayerSourceCache(He);He.isSky()&&this.renderLayer(this,Pe,He,Pe?X[Pe.id]:void 0)}function Oe(He,Pe){let lt;return Pe&&(lt=(He.type==="symbol"?re:He.is3D(v)?de:X)[Pe.id]),lt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const He=U[this.currentLayer];if(He.type==="raster"||He.type==="raster-particle"){const Pe=t.getLayerSourceCache(He);this.renderLayer(this,Pe,He,Oe(He,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ot=0;ve&&(ot=ve.getShadowCastingLayerCount());let qe=!1,nt=-1;for(let He=0;He<S.length;++He){const Pe=U[He];Pe.isHidden(this.transform.zoom)||Pe.is3D(v)&&(nt=He)}O&&nt===-1&&(R=!0);let zt=!1;for(;this.currentLayer<S.length;){const He=U[this.currentLayer],Pe=t.getLayerSourceCache(He);if(He.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(He)){if(He.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!zt&&He.is3D(v)&&!v){const lt=this.currentLayer,Ke=yt=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Rt=U[this.currentLayer];if(ju[Rt.type]){const Yt=this.style.getLayerSourceCache(Rt);ju[Rt.type](this,Yt,Rt,Oe(Rt,Yt),yt)}}};Ke("initialize"),Ke("reset"),this.currentLayer=lt,zt=!0}if(R&&!qe&&this.terrain&&!this.transform.isOrthographic&&(qe=!0,this.blitDepth()),O&&nt!==-1&&this.currentLayer===nt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(He,Pe,Pe?ie[Pe.id]:void 0),this.renderLayer(this,Pe,He,Oe(He,Pe)),!this.terrain&&ve&&ot>0&&He.hasShadowPass()&&--ot==0){{this.clearStencil(),this.resetStencilClippingMasks();const lt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Ke=U[this.currentLayer];if(du[Ke.type]){const yt=this.style.getLayerSourceCache(Ke);du[Ke.type](this,yt,Ke,Oe(Ke,yt))}}this.currentLayer=lt}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const lt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=lt;this.currentLayer++){const Ke=U[this.currentLayer];if(!Ke.hasLightBeamPass())continue;const yt=t.getLayerSourceCache(Ke);this.renderLayer(this,yt,Ke,yt?X[yt.id]:void 0)}this.currentLayer=lt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const lt=this.currentLayer;this.depthOcclusion=!0;for(const Ke of this.layersWithOcclusionOpacity){this.currentLayer=Ke;const yt=U[this.currentLayer],Rt=t.getLayerSourceCache(yt),Yt=Rt?X[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,Rt,Rt?ie[Rt.id]:void 0),this.renderLayer(this,Rt,yt,Yt)}this.depthOcclusion=!1,this.currentLayer=lt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let He=null;U.forEach((Pe=>{const lt=t.getLayerSourceCache(Pe);lt&&!Pe.isHidden(this.transform.zoom)&&lt.getVisibleCoordinates().length&&(!He||He.getSource().maxzoom<lt.getSource().maxzoom)&&(He=lt)})),He&&this.options.showTileBoundaries&&Cd(this,He,He.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Cd(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(He){const Pe=He.transform.padding;Wr(He,He.transform.height-(Pe.top||0),3,Ro),Wr(He,Pe.bottom||0,3,ru),Xn(He,Pe.left||0,3,a_),Xn(He,He.transform.width-(Pe.right||0),3,Pf);const lt=He.transform.centerPoint;(function(Ke,yt,Rt,Yt){Xl(Ke,yt-1,Rt-10,2,20,Yt),Xl(Ke,yt-10,Rt-1,20,2,Yt)})(He,lt.x,He.transform.height-lt.y,Df)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,d=!o||!o.includes(t.type);if(hu[t.type]&&(d||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);hu[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,o,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||uu[d.type](t,o,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(o.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,d=o.createQuery();this.deferredRenderGpuTimeQueries.push(d),o.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const d in t){const y=t[d],v=this.context.extTimerQuery,T=v.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(y.query),o[d]=T}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let d=0;for(const y of t)d+=o.getQueryParameter(y,o.QUERY_RESULT)/1e6,o.deleteQuery(y);return d}translatePosMatrix(t,o,d,y,v){if(!d[0]&&!d[1])return t;const T=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const O=Math.sin(T),k=Math.cos(T);d=[d[0]*k-d[1]*O,d[0]*O+d[1]*k]}const S=[v?d[0]:s.ay(o,d[0],this.transform.zoom),v?d[1]:s.ay(o,d[1],this.transform.zoom),0],R=new Float32Array(16);return s.br(R,t,S),R}saveTileTexture(t){if(t.context!==this.context)return;const o=t.size[0],d=this._tileTextures[o];d?d.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||y||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),y&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,o){this.cache=this.cache||{};const d=o&&o.defines||[],y=o&&o.config,v=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(d),T=xd.cacheKey(mh[t],t,v,y);return this.cache[T]||(this.cache[T]=new xd(this.context,t,mh[t],y,Wm[t],v)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const v=((T,S,R)=>{const O=T.properties.get("direction"),k=T.properties.get("color-use-theme")==="none",U=T.properties.get("color").toNonPremultipliedRenderColor(k?null:R.getLut(T.scope)).toArray01(),F=T.properties.get("intensity"),H=S.properties.get("color-use-theme")==="none",$=S.properties.get("color").toNonPremultipliedRenderColor(H?null:R.getLut(S.scope)).toArray01(),W=S.properties.get("intensity"),ie=[O.x,O.y,O.z],X=s.dK($,W),re=s.dK(U,F);return{u_lighting_ambient_color:X,u_lighting_directional_dir:ie,u_lighting_directional_color:re,u_ground_radiance:vd(ie,re,X)}})(d,y,this.style);o.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,o,d,y,v){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const S=T.getOpacity(this.transform.pitch),R=((O,k,U,F,H,$,W,ie,X,re,ue,de)=>{const be=O.transform,ye=k.properties.get("color-use-theme")==="none",ve=k.properties.get("color").toNonPremultipliedRenderColor(ye?null:O.style.getLut(k.scope)).toArray01();ve[3]=F;const ge=O.frameCounter/1e3%1,[_e,xe]=k.properties.get("vertical-range");return{u_fog_matrix:U?be.calculateFogTileMatrix(U):de||O.identityMat,u_fog_range:k.getFovAdjustedRange(be._fov),u_fog_color:ve,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,xe),xe],u_fog_temporal_offset:ge,u_frustum_tl:H,u_frustum_tr:$,u_frustum_br:W,u_frustum_bl:ie,u_globe_pos:X,u_globe_radius:re,u_viewport:ue,u_globe_transition:s.aj(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,T,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],y);o.setFogUniformValues(t,R)}v&&o.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)o[y.key]=t[y.key]||new Ol(y,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=di||o[1]>=di}setupDepthForOcclusion(t,o,d){const y=this.context,v=y.gl,T=!!d;var S;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),y.activeTexture.set(v.TEXTURE0),T||o.setTerrainUniformValues(y,d)}}function zd(f,t){let o=!1,d=null;const y=()=>{d=null,o&&(f(),d=setTimeout(y,t),o=!1)};return()=>(o=!0,d||y(),d)}class kp{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=zd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=Lf(t);if(this._hashName){const d=this._hashName;let y=!1;const v=location.hash.slice(1).split("&").map((T=>{const S=T.split("=")[0];return S===d?(y=!0,`${S}=${o}`):T})).filter((T=>T));return y||v.push(`${d}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(o=d)})),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some((d=>isNaN(Number(d))))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lf(f,t){const o=f.getCenter(),d=Math.round(100*f.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),T=Math.round(o.lng*v)/v,S=Math.round(o.lat*v)/v,R=f.getBearing(),O=f.getPitch();let k=t?`/${T}/${S}/${d}`:`${d}/${S}/${T}`;return(R||O)&&(k+="/"+Math.round(10*R)/10),O&&(k+=`/${Math.round(O)}`),k}const Po={linearity:.3,easing:s.eK(0,0,.3,1)},fu=Object.assign({deceleration:2500,maxSpeed:1400},Po),Ah=Object.assign({deceleration:20,maxSpeed:1400},Po),Np=Object.assign({deceleration:1e3,maxSpeed:360},Po),ig=Object.assign({deceleration:1e3,maxSpeed:90},Po);class Fp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=s.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(o.pan.mag()){const v=Gu(o.pan.mag(),d,Object.assign({},fu,t||{}));y.offset=o.pan.mult(v.amount/o.pan.mag()),y.center=this._map.transform.center,da(y,v)}if(o.zoom){const v=Gu(o.zoom,d,Ah);y.zoom=this._map.transform.zoom+v.amount,da(y,v)}if(o.bearing){const v=Gu(o.bearing,d,Np);y.bearing=this._map.transform.bearing+s.aA(v.amount,-179,179),da(y,v)}if(o.pitch){const v=Gu(o.pitch,d,ig);y.pitch=this._map.transform.pitch+v.amount,da(y,v)}if(y.zoom||y.bearing){const v=o.pinchAround===void 0?o.around:o.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function da(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Gu(f,t,o){const{maxSpeed:d,linearity:y,deceleration:v}=o,T=s.aA(f*y/(t/1e3),-d,d),S=Math.abs(T)/(v*y);return{easing:o.easing,duration:1e3*S,amount:T*(S/2)}}class os extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d,y={}){const v=ke(o.getCanvasContainer(),d),T=o.unproject(v);super(t,Object.assign({point:v,lngLat:T,originalEvent:d},y)),this._defaultPrevented=!1,this.target=o}}class Ih extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d){const y=t==="touchend"?d.changedTouches:d.touches,v=We(o.getCanvasContainer(),y),T=v.map((R=>o.unproject(R))),S=v.reduce(((R,O,k,U)=>R.add(O.div(U.length))),new s.P(0,0));super(t,{points:v,point:S,lngLats:T,lngLat:o.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class zf extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Ch{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new zf(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new os(t.type,this._map,t))}mouseup(t){this._map.fire(new os(t.type,this._map,t))}preclick(t){const o=new MouseEvent("preclick",t);this._map.fire(new os(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new os(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new os(t.type,this._map,t))}mouseover(t){this._map.fire(new os(t.type,this._map,t))}mouseout(t){this._map.fire(new os(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ih(t.type,this._map,t))}touchmove(t){this._map.fire(new Ih(t.type,this._map,t))}touchend(t){this._map.fire(new Ih(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ih(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new os(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new os("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new os(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gs{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(wi(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const d=o,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Ge("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,d.x),S=Math.max(y.x,d.x),R=Math.min(y.y,d.y),O=Math.max(y.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${T}px,${R}px)`,this._box.style.width=S-T+"px",this._box.style.height=O-R+"px")}))}mouseupWindow(t,o){if(!this._active)return;const d=this._startPos,y=o;if(d&&t.button===0){if(this.reset(),Ve(),d.x!==y.x||d.y!==y.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ai(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new s.z(t,{originalEvent:o}))}}function kd(f,t){const o={};for(let d=0;d<f.length;d++)o[f[d].identifier]=t[d];return o}class kf{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=(function(y){const v=new s.P(0,0);for(const T of y)v._add(T);return v.div(y.length)})(o),this.touches=kd(d,o)))}touchmove(t,o,d){if(this.aborted||!this.centroid)return;const y=kd(d,o);for(const v in this.touches){const T=y[v];(!T||T.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,o,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Rh{constructor(t){this.singleTap=new kf(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,d){this.singleTap.touchstart(t,o,d)}touchmove(t,o,d){this.singleTap.touchmove(t,o,d)}touchend(t,o,d){const y=this.singleTap.touchend(t,o,d);if(y){const v=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(v&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class qu{constructor(){this._zoomIn=new Rh({numTouches:1,numTaps:2}),this._zoomOut=new Rh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,d){this._zoomIn.touchstart(t,o,d),this._zoomOut.touchstart(t,o,d)}touchmove(t,o,d){this._zoomIn.touchmove(t,o,d),this._zoomOut.touchmove(t,o,d)}touchend(t,o,d){const y=this._zoomIn.touchend(t,o,d),v=this._zoomOut.touchend(t,o,d);return y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vp={0:1,2:2},Mc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Nd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const d=ht(t);this._correctButton(t,d)&&(this._lastPoint=o,this._eventButton=d)}mousemoveWindow(t,o){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&(function(y,v){const T=Vp[v];return y.buttons===void 0||(y.buttons&T)!==T})(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(d,o)}}mouseupWindow(t){this._lastPoint&&ht(t)===this._eventButton&&(this._moved&&Ve(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mh extends Nd{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Nf extends Nd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Mc[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const d=.8*(o.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Ph extends Nd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Mc[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const d=-.5*(o.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Up{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,o,d){return this._calculateTransform(t,o,d)}touchmove(t,o,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!s.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,d)}}touchend(t,o,d){this._calculateTransform(t,o,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,d){d.length>0&&(this._active=!0);const y=kd(d,o),v=new s.P(0,0),T=new s.P(0,0);let S=0;for(const O in y){const k=y[O],U=this._touches[O];U&&(v._add(k),T._add(k.sub(U)),S++,y[O]=k)}if(this._touches=y,S<this._minTouches||!T.mag())return;const R=T.div(S);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Hu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,d){return{}}touchstart(t,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,d){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[v,T]=y,S=Dh(d,o,v),R=Dh(d,o,T);if(!S||!R)return;const O=this._aroundCenter?null:S.add(R).div(2);return this._move([S,R],O,t)}touchend(t,o,d){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,T=Dh(d,o,y),S=Dh(d,o,v);T&&S||(this._active&&Ve(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dh(f,t,o){for(let d=0;d<f.length;d++)if(f[d].identifier===o)return t[d]}function Ff(f,t){return Math.log2(f/t)}class h_ extends Hu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ff(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ff(this._distance,d),pinchAround:o}}}function Bf(f,t){return 180*f.angleWith(t)/Math.PI}class Gs extends Hu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bf(this._vector,d),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=Bf(t,d);return Math.abs(y)<o}}function Qs(f){return Math.abs(f.y)>Math.abs(f.x)}class ng extends Hu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Qs(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,d){const y=this._lastPoints;if(!y)return;const v=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!s.eL()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,T,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5})}gestureBeginsVertically(t,o,d){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,v=o.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=t.y>0==o.y>0;return Qs(t)&&Qs(o)&&T}}const rg={panStep:100,bearingStep:15,pitchStep:10};class sg{constructor(){const t=rg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,d=0,y=0,v=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:S=>{const R=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:og,zoom:o?Math.round(R)+o*(t.shiftKey?2:1):R,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function og(f){return f*(2-f)}const Oh=4.000244140625,ag=1/450;class Vf{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ag,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=s.o.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%Oh==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=ke(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>Oh?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&k!==0&&(k=1/k);const U=o(),F=Math.pow(2,U),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o(),y=this._startZoom,v=this._easing;let T,S=!1;if(this._type==="wheel"&&y&&v){const O=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),k=v(O);T=s.ak(y,d,k),O<1?this._frameId||(this._frameId=!0):S=!0}else T=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let R=T-o();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=s.eM;if(this._prevEase){const d=this._prevEase,y=(s.o.now()-d.start)/d.duration,v=d.easing(y+.01)-d.easing(y),T=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-T*T);o=s.eK(T,S,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class lg{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class d_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jp{constructor(){this._tap=new Rh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=o[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,o,d))}touchmove(t,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=o[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,o,d)}touchend(t,o,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,o,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cg{constructor(t,o,d){this._el=t,this._mousePan=o,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class f_{constructor(t,o,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Er{constructor(t,o,d,y){this._el=t,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fd=f=>f.zoom||f.drag||f.pitch||f.rotate;class ug extends s.z{}class hg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const d=s.av([],o,t);this.radius=s.ag(d[2]<0?s.eO([],d,this.constants):[d[0],d[1],0])}projectRay(t){s.eO(t,t,this.constants),s.aw(t,t),s.eP(t,t,this.constants);const o=s.c4([],t,this.radius);if(o[2]>0){const d=s.c4([],[0,0,1],s.bJ(o,[0,0,1])),y=s.c4([],s.aw([],[o[0],o[1],0]),this.radius),v=s.d7([],o,s.c4([],s.av([],s.d7([],y,d),o),2));o[0]=v[0],o[1]=v[1]}return o}}function Bd(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Vd{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fp(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,v,T]of this._listeners){const S=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(v,S,T)}}destroy(){for(const[t,o,d]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,y,d)}}_addDefaultHandlers(t){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new Ch(o,t));const y=o.boxZoom=new gs(o,t);this._add("boxZoom",y);const v=new qu,T=new d_;o.doubleClickZoom=new lg(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const S=new jp;this._add("tapDragZoom",S);const R=o.touchPitch=new ng(o);this._add("touchPitch",R);const O=new Nf(t),k=new Ph(t);o.dragRotate=new f_(t,O,k),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new Mh(t),F=new Up(o,t);o.dragPan=new cg(d,U,F),this._add("mousePan",U),this._add("touchPan",F,["touchZoom","touchRotate"]);const H=new Gs,$=new h_;o.touchZoomRotate=new Er(d,$,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bp(o));const W=o.scrollZoom=new Vf(o,this);this._add("scrollZoom",W,["mousePan"]);const ie=o.keyboard=new sg;this._add("keyboard",ie);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&o[X].enable(t[X])}_add(t,o,d){this._handlers.push({handlerName:t,handler:o,allowed:d}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,d){for(const y in t)if(y!==d&&(!o||o.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const d of t)this._el.contains(d.target)&&o.push(d);return o}handleEvent(t,o){this._updatingCamera=!0;const d=t.type==="renderFrame",y=d?void 0:t,v={needsRenderFrame:!1},T={},S={},R=t.touches?this._getMapTouches(t.touches):void 0,O=R?We(this._el,R):d?void 0:ke(this._el,t);for(const{handlerName:F,handler:H,allowed:$}of this._handlers){if(!H.isEnabled())continue;let W;this._blockedByActive(S,$,F)?H.reset():H[o||t.type]&&(W=H[o||t.type](t,O,R),this.mergeHandlerResult(v,T,W,F,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||H.isActive())&&(S[F]=H)}const k={};for(const F in this._previousActiveHandlers)S[F]||(k[F]=y);this._previousActiveHandlers=S,(Object.keys(k).length||Bd(v))&&(this._changes.push([v,T,k]),this._triggerRenderFrame()),(Object.keys(S).length||Bd(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,o,d,y,v){if(!d)return;Object.assign(t,d);const T={handlerName:y,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(o.zoom=T),d.panDelta!==void 0&&(o.drag=T),d.pitchDelta!==void 0&&(o.pitch=T),d.bearingDelta!==void 0&&(o.rotate=T)}_applyChanges(){const t={},o={},d={};for(const[y,v,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(o,v),Object.assign(d,T);this._updateMapTransform(t,o,d),this._changes=[]}_updateMapTransform(t,o,d){const y=this._map,v=y.transform,T=re=>[re.x,re.y,re.z];if((re=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Bd(t)){const re=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),re!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!Bd(t))return void this._fireEvents(o,d,!0);let{panDelta:S,zoomDelta:R,bearingDelta:O,pitchDelta:k,around:U,aroundCoord:F,pinchAround:H}=t;v._isCameraConstrained&&(R>0&&(R=0),v._isCameraConstrained=!1),H!==void 0&&(U=H),(R||(re=>o[re]&&!this._eventsInProgress[re])("drag"))&&U&&(this._dragOrigin=T(v.pointCoordinate3D(U)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),U=U||y.transform.centerPoint,O&&(v.bearing+=O),k&&(v.pitch+=k),v._updateCameraState();const $=[0,0,0];if(S)if(v.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),ue=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(S)).dir);$[0]=ue[0]-re[0],$[1]=ue[1]-re[1]}else{const re=v.pointCoordinate(U);if(v.projection.name==="globe"){S=S.rotate(-v.angle);const ue=v._pixelsPerMercatorPixel/v.worldSize;$[0]=-S.x*s.eN(s.a$(re.y))*ue,$[1]=-S.y*s.eN(v.center.lat)*ue}else{const ue=v.pointCoordinate(U.sub(S));re&&ue&&($[0]=ue.x-re.x,$[1]=ue.y-re.y)}}const W=v.zoom,ie=[0,0,0];if(R){const re=T(F||v.pointCoordinate3D(U)),ue={dir:s.aw([],s.av([],re,v._camera.position))};if(ue.dir[2]<0){const de=v.zoomDeltaToMovement(re,R);s.c4(ie,ue.dir,de)}}const X=s.d7($,$,ie);v._translateCameraConstrained(X),R&&Math.abs(v.zoom-W)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,d,!0)}_fireEvents(t,o,d){const y=Fd(this._eventsInProgress),v=Fd(t),T={};for(const k in t){const{originalEvent:U}=t[k];this._eventsInProgress[k]||(T[`${k}start`]=U),this._eventsInProgress[k]=t[k]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const k in T)this._fireEvent(k,T[k]);v&&this._fireEvent("move",v.originalEvent);for(const k in t){const{originalEvent:U}=t[k];this._fireEvent(k,U)}const S={};let R;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:F}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],R=o[U]||F,S[`${k}end`]=R)}for(const k in S)this._fireEvent(k,S[k]);const O=Fd(this._eventsInProgress);if(d&&(y||v)&&!O){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:R})):(this._map.fire(new s.z("moveend",{originalEvent:R})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new s.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new ug("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Uf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ud extends s.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,d){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),d)}panTo(t,o,d){return this.easeTo(Object.assign({center:t},o),d)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,d){return this.easeTo(Object.assign({zoom:t},o),d)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,d){return this.easeTo(Object.assign({bearing:t},o),d)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=s.aI.convert(t);const d=o&&o.bearing||0,y=o&&o.pitch||0,v=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,v,T,d,y,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const d=o.max[0]-o.min[0],y=o.max[1]-o.min[1];return d/y>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,d,y,v,T){const S=t.clone(),R=this._extendCameraOptions(T);S.bearing=y,S.pitch=v;const O=s.aR.convert(o),k=s.aR.convert(d),U=.5*(O.lat+k.lat),F=.5*(O.lng+k.lng),H=s.eQ(U,F),$=s.aw([],H),W=s.aw([],s.bI([],$,[0,1,0])),ie=s.bI([],W,$),X=[W[0],W[1],W[2],0,ie[0],ie[1],ie[2],0,$[0],$[1],$[2],0,0,0,0,1],re=[H,s.eQ(O.lat,O.lng),s.eQ(k.lat,O.lng),s.eQ(k.lat,k.lng),s.eQ(O.lat,k.lng),s.eQ(U,O.lng),s.eQ(U,k.lng),s.eQ(O.lat,F),s.eQ(k.lat,F)];let ue=s.d8.fromPoints(re.map((Ke=>[s.bJ(W,Ke),s.bJ(ie,Ke),s.bJ($,Ke)])));const de=s.af([],ue.center,X);s.eR(de)===0&&s.eS(de,0,0,1),s.aw(de,de),s.c4(de,de,s.aD),S.center=s.eT(de);const be=S.getWorldToCameraMatrix(),ye=s.bl(new Float64Array(16),be);ue=s.d8.applyTransform(ue,s.aB([],be,X));const ve=this._extendAABB(ue,S,R,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=ve,s.af(de,de,be);const ge=.5*(ue.max[2]-ue.min[2]),_e=this._minimumAABBFrustumDistance(S,ue),xe=s.c4([],[0,0,1],ge),Ze=s.d7(xe,de,xe),Oe=_e+(S.pitch===0?0:s.bG(de,Ze)),ot=S.globeCenterInViewSpace,qe=s.av([],de,[ot[0],ot[1],ot[2]]);s.aw(qe,qe),s.c4(qe,qe,Oe);const nt=s.d7([],de,qe);s.af(nt,nt,ye);const zt=s.eD/s.aD,He=s.ag(nt),Pe=s.ce(Math.max(He*zt-s.eD,Number.EPSILON),0),lt=Math.min(S.zoomFromMercatorZAdjusted(Pe),R.maxZoom);return lt>.5*(s.cZ+s.cK)?(S.setProjection({name:"mercator"}),S.zoom=lt,this._cameraForBounds(S,o,d,y,v,T)):{center:S.center,zoom:lt,bearing:y,pitch:v}}_extendAABB(t,o,d,y){const v=.5*((d.padding.left||0)+(d.padding.right||0)),T=.5*((d.padding.top||0)+(d.padding.bottom||0)),S=T,R=v,O=v,k=T,U=o.width-(R+O),F=o.height-(S+k),H=s.av([],t.max,t.min),$=Math.min(U/H[0],F/H[1]),W=Math.min(o.scaleZoom(o.scale*$),d.maxZoom);if(isNaN(W))return null;const ie=o.scale/o.zoomScale(W),X=new s.d8([t.min[0]-R*ie,t.min[1]-k*ie,t.min[2]],[t.max[0]+O*ie,t.max[1]+S*ie,t.max[2]]),re=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new s.P(d.offset.x,d.offset.y):s.P.convert(d.offset)).rotate(-s.an(y));return X.center[0]-=re.x*ie,X.center[1]+=re.y*ie,X}queryTerrainElevation(t,o){const d=this.transform.elevation;return d?(o=Object.assign({},{exaggerated:!0},o),d.getAtPoint(s.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,d,y,v,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,d,y,v,T);const S=t.clone(),R=this._extendCameraOptions(T);S.bearing=y,S.pitch=v;const O=s.aR.convert(o),k=s.aR.convert(d),U=new s.aR(O.lng,k.lat),F=new s.aR(k.lng,O.lat),H=S.project(O),$=S.project(k),W=this.queryTerrainElevation(O),ie=this.queryTerrainElevation(k),X=this.queryTerrainElevation(U),re=this.queryTerrainElevation(F),ue=[[H.x,H.y,Math.min(W||0,ie||0,X||0,re||0)],[$.x,$.y,Math.max(W||0,ie||0,X||0,re||0)]];let de=s.d8.fromPoints(ue);const be=S.getWorldToCameraMatrix(),ye=s.bl(new Float64Array(16),be);de=s.d8.applyTransform(de,be);const ve=this._extendAABB(de,S,R,y);if(!ve)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=ve;const ge=.5*s.av([],de.max,de.min)[2],_e=this._minimumAABBFrustumDistance(S,de),xe=[0,0,1,0];s.aC(xe,xe,be),s.eU(xe,xe);const Ze=s.c4([],xe,_e+ge),Oe=s.d7([],de.center,Ze);s.af(de.center,de.center,ye),s.af(Oe,Oe,ye);const ot=S.unproject(new s.P(de.center[0],de.center[1])),qe=s.eV(S.projection,ot),nt=Math.pow(2,qe),zt=Math.min(S._zoomFromMercatorZ(Oe[2]*S.pixelsPerMeter*nt/S.worldSize),R.maxZoom);return S.mercatorFromTransition&&zt<.5*(s.cZ+s.cK)?(S.setProjection({name:"globe"}),S.zoom=zt,this._cameraForBounds(S,o,d,y,v,T)):{center:ot,zoom:zt,bearing:y,pitch:v}}fitBounds(t,o,d){const y=this.cameraForBounds(t,o);return this._fitInternal(y,o,d)}fitScreenCoordinates(t,o,d,y,v){const T=s.P.convert(t),S=s.P.convert(o),R=new s.P(Math.min(T.x,S.x),Math.min(T.y,S.y)),O=new s.P(Math.max(T.x,S.x),Math.max(T.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,S))return this;const k=this.transform.pointLocation3D(R),U=this.transform.pointLocation3D(O),F=this.transform.pointLocation3D(new s.P(R.x,O.y)),H=this.transform.pointLocation3D(new s.P(O.x,R.y)),$=[Math.min(k.lng,U.lng,F.lng,H.lng),Math.min(k.lat,U.lat,F.lat,H.lat)],W=[Math.max(k.lng,U.lng,F.lng,H.lng),Math.max(k.lat,U.lat,F.lat,H.lat)],ie=y&&y.pitch?y.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,$,W,d,ie,y);return this._fitInternal(X,y,v)}_fitInternal(t,o,d){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,d):this.flyTo(o,d):this}jumpTo(t,o){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,T=!1;"zoom"in t&&d.zoom!==+t.zoom&&(y=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=s.aR.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(v=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(T=!0,d.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(S))if(t.retainPadding===!1){const R=d.clone();R.padding=S,d.setLocationAtPoint(d.center,R.centerPoint)}else d.padding=S;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),y&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),v&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),T&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Uf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.w(Uf),this;this.stop();const y=d.zoom,v=d.pitch,T=d.bearing;d.setFreeCameraOptions(t);const S=y!==d.zoom,R=v!==d.pitch,O=T!==d.bearing;return this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),S&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),O&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),R&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eM},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),R="zoom"in t?+t.zoom:y,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,k="pitch"in t?+t.pitch:T,U=this._extendPadding(t.padding),F=s.P.convert(t.offset);let H,$,W;if(d.projection.name==="globe"){const xe=s.ae.fromLngLat(d.center),Ze=F.rotate(-d.angle);xe.x+=Ze.x/d.worldSize,xe.y+=Ze.y/d.worldSize;const Oe=xe.toLngLat(),ot=s.aR.convert(t.center||Oe);this._normalizeCenter(ot),H=d.centerPoint.add(Ze),$=new s.P(xe.x,xe.y).mult(d.worldSize),W=new s.P(s.aF(ot.lng),s.aJ(ot.lat)).mult(d.worldSize).sub($)}else{H=d.centerPoint.add(F);const xe=d.pointLocation(H),Ze=s.aR.convert(t.center||xe);this._normalizeCenter(Ze),$=d.project(xe),W=d.project(Ze).sub($)}const ie=d.zoomScale(R-y);let X,re;t.around&&(X=s.aR.convert(t.around),re=d.locationPoint(X));const ue=this._zooming||R!==y,de=this._rotating||v!==O,be=this._pitching||k!==T,ye=!d.isPaddingEqual(U),ve=t.retainPadding===!1?d.clone():d,ge=xe=>Ze=>{if(ue&&(xe.zoom=s.ak(y,R,Ze)),de&&(xe.bearing=s.ak(v,O,Ze)),be&&(xe.pitch=s.ak(T,k,Ze)),ye&&(ve.interpolatePadding(S,U,Ze),H=ve.centerPoint.add(F)),X)xe.setLocationAtPoint(X,re);else{const Oe=xe.zoomScale(xe.zoom-y),ot=R>y?Math.min(2,ie):Math.max(.5,ie),qe=Math.pow(ot,1-Ze),nt=xe.unproject($.add(W.mult(Ze*qe)).mult(Oe));xe.setLocationAtPoint(xe.renderWorldCopies?nt.wrap():nt,H)}return t.preloadOnly||this._fireMoveEvents(o),xe};if(t.preloadOnly){const xe=this._emulate(ge,t.duration,d);return this._preloadTiles(xe),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=de,this._pitching=be,this._padding=ye,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,_e),this._ease(ge(d),(xe=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(o,xe)}),t),this}_prepareEase(t,o,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||d.moving||this.fire(new s.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.z("zoomend",t)),y&&this.fire(new s.z("rotateend",t)),v&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const Ke=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ke,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eM},t);const d=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),R="zoom"in t?s.aA(+t.zoom,d.minZoom,d.maxZoom):y,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,k="pitch"in t?+t.pitch:T,U=this._extendPadding(t.padding),F=d.zoomScale(R-y),H=s.P.convert(t.offset);let $=d.centerPoint.add(H);const W=d.pointLocation($),ie=s.aR.convert(t.center||W);this._normalizeCenter(ie);const X=d.project(W),re=d.project(ie).sub(X);let ue=t.curve;const de=Math.max(d.width,d.height),be=de/F,ye=re.mag();if("minZoom"in t){const Ke=s.aA(Math.min(t.minZoom,y,R),d.minZoom,d.maxZoom),yt=de/d.zoomScale(Ke-y);ue=Math.sqrt(yt/ye*2)}const ve=ue*ue;function ge(Ke){const yt=(be*be-de*de+(Ke?-1:1)*ve*ve*ye*ye)/(2*(Ke?be:de)*ve*ye);return Math.log(Math.sqrt(yt*yt+1)-yt)}function _e(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function xe(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Ze=ge(0);let Oe=function(Ke){return xe(Ze)/xe(Ze+ue*Ke)},ot=function(Ke){return de*((xe(Ze)*(_e(yt=Ze+ue*Ke)/xe(yt))-_e(Ze))/ve)/ye;var yt},qe=(ge(1)-Ze)/ue;if(Math.abs(ye)<1e-6||!isFinite(qe)){if(Math.abs(de-be)<1e-6)return this.easeTo(t,o);const Ke=be<de?-1:1;qe=Math.abs(Math.log(be/de))/ue,ot=function(){return 0},Oe=function(yt){return Math.exp(Ke*ue*yt)}}t.duration="duration"in t?+t.duration:1e3*qe/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const nt=v!==O,zt=k!==T,He=!d.isPaddingEqual(U),Pe=t.retainPadding===!1?d.clone():d,lt=Ke=>yt=>{const Rt=yt*qe,Yt=1/Oe(Rt);Ke.zoom=yt===1?R:y+Ke.scaleZoom(Yt),nt&&(Ke.bearing=s.ak(v,O,yt)),zt&&(Ke.pitch=s.ak(T,k,yt)),He&&(Pe.interpolatePadding(S,U,yt),$=Pe.centerPoint.add(H));const Mt=yt===1?ie:Ke.unproject(X.add(re.mult(ot(Rt))).mult(Yt));return Ke.setLocationAtPoint(Ke.renderWorldCopies?Mt.wrap():Mt,$),Ke._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Ke};if(t.preloadOnly){const Ke=this._emulate(lt,t.duration,d);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=nt,this._pitching=zt,this._padding=He,this._prepareEase(o,!1),this._ease(lt(d),(()=>this._afterEase(o)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,o)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,o,d){d.animate===!1||d.duration===0?(t(1),o()):(this._easeStart=s.o.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=s.bT(t,-180,180);const d=Math.abs(t-o);return Math.abs(t-360-o)<d&&(t-=360),Math.abs(t+360-o)<d&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const d=t.lng-o.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,d){const y=Math.ceil(15*o/1e3),v=[],T=t(d.clone());for(let S=0;S<=y;S++){const R=T(S/y);v.push(R.clone())}return v}_preloadTiles(t,o){}}class Lh{constructor(t={}){this.options=t,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ge("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=Ge("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=Ge("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const d=o.reduce(((y,v,T)=>(v.value&&(y+=`${v.key}=${v.value}${T<o.length-1?"&":""}`),y)),"?");t.href=`${s.e.FEEDBACK_URL}/${d}#${Lf(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const o=this._map.style._mergedSourceCaches;for(const y in o){const v=o[y];if(v.used){const T=v.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort(((y,v)=>y.length-v.length)),t=t.filter(((y,v)=>{for(let T=v+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yl{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ge("div","mapboxgl-ctrl");const o=Ge("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const d=t[o].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class zh{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(o=>this._onIndoorUpdate({selectedFloorId:o.selectedFloorId,floors:o.floors}))),this._container}_createButton(t,o){const d=Ge("button",t,this._container);return d.type="button",d.addEventListener("click",o),d}_createSeparator(){return Ge("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const d=t.floors.sort(((y,v)=>v.levelOrder-y.levelOrder));o?(Array.from(this._container.children).forEach((y=>y.remove())),this.addCurrentFloors(d)):this.addCurrentFloors(d)}addCurrentFloors(t){for(let o=0;o<t.length;o++){const d=t[o],y=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(d.id),this._model&&(this._model.selectedFloorId=d.id),Array.from(this._container.children).forEach((v=>{v.classList.contains("mapboxgl-ctrl-level-button")&&v.classList.remove("mapboxgl-ctrl-level-button-selected")})),y.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(y,d.shortName),this._model&&d.id===this._model.selectedFloorId&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),o<t.length-1&&this._createSeparator()}}}class ts{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const y of d)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class go{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=s.dz((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,d){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+d}}const kh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jf extends s.z{constructor(t,o,d,y){const{point:v,lngLat:T,originalEvent:S,target:R}=t;super(t.type,{point:v,lngLat:T,originalEvent:S,target:R}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=d,this.feature=y}}class dg{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=o.filter;let y=o.type;d&&this.filters.set(t,s.b6(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const v=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):v.size===0&&this.map.on(y,this.handleType),v.size===0&&this.interactionsByType.set(y,v),v.set(t,o),this.typeById.set(t,y)}get(t){const o=this.typeById.get(t);if(!o)return;const d=this.interactionsByType.get(o);return d?d.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(o);d&&(d.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const d=[];for(const[y,v]of o)v.target&&d.push({targetId:y,target:v.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const d=new Map;for(const[y,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(v.id,v);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),v=!!o;o=o||this.queryTargets(t.point,y);let T=!1;const S=new Set;for(const R of o){for(const[O,k]of y){if(!k.target)continue;const U=R.variants?R.variants[O]:null;if(U){for(const F of U){if(bo(F,R,S,O))continue;const H=new s.dt(R,F),$=Ml(F,R,O);v&&(H.state=this.map.getFeatureState(H));const W=d?this.prevHoveredFeatures.get($):null,ie=new jf(t,O,k,H),X=W?W.stop:k.handler(ie);if(d&&this.hoveredFeatures.set($,{feature:R,stop:X}),X!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[R,O]of y){const{handler:k,target:U}=O;if(!U&&k(new jf(t,R,O,null))!==!1)break}}}function pu(f,t){if(Array.isArray(f)&&Array.isArray(t)){const o=new Set(f),d=new Set(t);return o.size===d.size&&f.every((y=>d.has(y)))}return s.by(f,t)}const Nh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},p_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gp{constructor(t,o,d=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Nf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Ph({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),wi()}move(t,o){const d=this.map,y=this.mouseRotate.mousemoveWindow(t,o),v=y&&y.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,o),S=T&&T.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ai(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ke(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ke(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=We(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=We(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Wu(f,t,o){if(f=new s.aR(f.lng,f.lat),t){const d=new s.aR(f.lng-360,f.lat),y=new s.aR(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-o.center.lng)/360),T=o.locationPoint3D(f).distSqr(t),S=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(d).distSqr(t)<T&&(S||Math.abs(d.lng-o.center.lng)<v)?f=d:o.locationPoint3D(y).distSqr(t)<T&&(S||Math.abs(y.lng-o.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-o.center.lng)>180;){const d=o.locationPoint3D(f);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}const Jr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ua={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Fh extends s.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:y="#3FB1CE",scale:v=1,draggable:T=!1,clickTolerance:S=0,rotation:R=Ua.rotation,rotationAlignment:O=Ua.rotationAlignment,pitchAlignment:k=Ua.pitchAlignment,occludedOpacity:U=Ua.occludedOpacity,altitude:F=Ua.altitude}=t||{};this._anchor=d,this._color=y,this._scale=v,this._draggable=T,this._clickTolerance=S,this._rotation=R,this._rotationAlignment=O,this._pitchAlignment=k,this._occludedOpacity=U,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(W=>{W.preventDefault()})),this._element.addEventListener("mousedown",(W=>{W.preventDefault()}));const H=this._element.classList;for(const W in Jr)H.remove(`mapboxgl-marker-anchor-${W}`);H.add(`mapboxgl-marker-anchor-${this._anchor}`);const $=t&&t.className?t.className.trim().split(/\s+/):[];H.add(...$),this._popup=null}_createDefaultMarker(){const t=Ge("div"),o=Qe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=Qe("radialGradient",{id:"shadowGradient"},Qe("defs",{},o));Qe("stop",{offset:"10%","stop-opacity":.4},d),Qe("stop",{offset:"100%","stop-opacity":.05},d),Qe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Qe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Qe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Qe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aR.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ua.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,d=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,d=this._element;this._popup&&(o===d||d.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const d=t.unproject(o,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(o,this._altitude);let y;t._showingGlobe()&&s.eY(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Jr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,d=this.getPitchAlignment();if(!o||!t||d!=="map")return"";if(!o._showingGlobe()){const R=o.getPitch();return R?`rotateX(${R}deg)`:""}const y=s.cW(s.eZ(o.transform,this._lngLat)),v=t.sub(s.e_(o.transform)),T=Math.abs(v.x)+Math.abs(v.y);if(T===0)return"";const S=y/T;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(o._showingGlobe()){const v=o.project(new s.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=o.project(new s.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);d=s.cW(Math.atan2(T.y,T.x))-90}else d=-o.getBearing();else if(y==="horizon"){const v=s.ah(4,6,o.getZoom()),T=s.e_(o.transform);T.y+=v*o.transform.height;const S=t.sub(T),R=s.cW(Math.atan2(S.y,S.x));d=(R>90?R-270:R+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Wu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),o._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(t.point.dist(d)<v)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,d=this._pos;o&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ua.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ua.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ua.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ua.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const mu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ja={maxWidth:100,unit:"metric"},Ho={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$u={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jd(f=new s.P(0,0),t="bottom"){if(typeof f=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new s.P(0,f);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[t]||[0,0])}return{version:G,supported:at.supported,setRTLTextPlugin:s.f2,getRTLTextPluginStatus:s.f1,Map:class extends Ud{constructor(f){te.mark(q.create);const t=f;if((f=Object.assign({},Nh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.eW(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bo(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ts,this._domRenderTaskQueue=new ts,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},kh,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new go(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Cn(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const o=document.getElementById(f.container);if(!o)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=o}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Vd(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Ru(this),f.hash&&(this._hash=new kp(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const o=f.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Lh({customAttribution:f.customAttribution})),this._logoControl=new Yl,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new s.z(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new s.z(`${o.dataType}dataloading`,o))})),this._interactions=new dg(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=f.onAdd(this);this._controls.push(f);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),t&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map((t=>t==="auto"?navigator.language:t)):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let o;t==="globe"&&f.zoom>=s.cK?(f.setMercatorFromTransition(),o=!0):t==="mercator"&&f.zoom<s.cK&&(f.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;return t=f.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(s.aR.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(s.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,o){const d=y=>{let v=[];if(Array.isArray(t)){const T=t.filter((S=>this.getLayer(S)));v=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else v=this.queryRenderedFeatures(y,{target:t});return v};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:T=>{const S=d(T.point);S.length?y||(y=!0,o.call(this,new os(f,this,T.originalEvent,{features:S}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:S=>{d(S.point).length?y=!0:y&&(y=!1,o.call(this,new os(f,this,S.originalEvent)))},mouseout:S=>{y&&(y=!1,o.call(this,new os(f,this,S.originalEvent)))}}}}{const y=v=>{const T=d(v.point);T.length&&(v.features=T,o.call(this,v),delete v.features)};return{listener:o,targets:t,delegates:{[f]:y}}}}on(f,t,o){if(typeof t=="function"||o===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(f,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(f,t,o){if(typeof t=="function"||o===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(f,t,o);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(f,t,o){if(typeof t=="function"||o===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[f]:void 0;return d&&(y=>{for(let v=0;v<y.length;v++){const T=y[v];if(T.listener===o&&pu(T.targets,t)){for(const S in T.delegates)this.off(S,T.delegates[S]);return y.splice(v,1),this}}})(d),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const v=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return v.concat(T)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const v of t.layers)if(!this._isValidId(v)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(f,t,this.transform))),o&&(y=y.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),y}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}queryRasterValue(f,t,o){return this._isValidId(f)?this.style.queryRasterValue(f,t,o):Promise.resolve(null)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,((o,d)=>{if(o){const y=typeof o=="string"?o:o instanceof Error?o.message:o.error;s.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new La(this,o).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new La(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dm(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,o)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:o=1,sdf:d=!1,stretchX:y,stretchY:v,content:T}={}){this._lazyInitEmptyStyle();const S=s.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:R,height:O,data:k}=s.o.getImageData(t);this.style.addImage(S,{data:new s.q({width:R,height:O},k),pixelRatio:o,stretchX:y,stretchY:v,content:T,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:O}=t,k=t;this.style.addImage(S,{data:new s.q({width:R,height:O},new Uint8Array(k.data)),pixelRatio:o,stretchX:y,stretchY:v,content:T,sdf:d,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const o=s.I.from(f),d=this.style.getImage(o);if(!d)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:v,height:T,data:S}=y;if(v===void 0||T===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||T!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${v}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const R=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let O=!1;d.usvg?(d.data=new s.q({width:v,height:T},new Uint8Array(S)),d.usvg=!1,d.icon=void 0,O=!0):d.data.replace(S,R),this.style.updateImage(o,d,O)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,t){s.n(this._requestManager.transformRequest(f,s.R.Image),((o,d)=>{t(o,d instanceof HTMLImageElement?s.o.getImageData(d):d)}))}listImages(){return this.style.listImages().map((f=>f.name))}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch((o=>this.fire(new s.y(new Error("Failed to add import",o))))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,o){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,o),this._update(!0)):this}setFilter(f,t,o={}){return this._isValidId(f)?(this.style.setFilter(f,t,o),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,o,d={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,o,d),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,o,d={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,o,d),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,o){return this.style.setConfigProperty(f,t,o),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aR.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new zh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,d,y,v=this._container;for(;v&&(!d||!y);){const T=window.getComputedStyle(v).transform;T&&T!=="none"&&(o=T.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(d=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(y=o[3])),v=v.parentElement}this._containerWidth=d?Math.abs(f/d):f,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ge("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Ge("div","mapboxgl-canvas-container",f);this._canvas=Ge("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=Ge("div","mapboxgl-control-container",f),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{d[y]=Ge("div",`mapboxgl-ctrl-${y}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const o=s.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(f),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=Object.assign({},at.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(Jo(t,!0),this.painter=new tg(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new s.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,d=s.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,k=this.transform.pitch,U=s.o.now(),F=new s.ac(O,{now:U,fadeDuration:v,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(d);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,te.mark(q.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const O=s.o.now()-d;y.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{const k=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:O,gpuTime:k}))}),50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout((()=>{const k=this.painter.queryGpuTimers(O);this.fire(new s.z("gpu-timing-layer",{layerTimes:k}))}),50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const k=this.painter.queryGpuTimeDeferredRender(O);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:k}))}),50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(R||this._repaint)this.triggerRepaint();else{const O=this.idle();if(O&&(T=this._updateAverageElevation(d,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,te.mark(q.fullLoad),this._performanceMetricsCollection&&cn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const o=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const T=Math.abs(y-v);if(T>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(f)&&o(this._averageElevation.getValue(f))}_authenticate(){ur(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(f=>{if(f&&(f.message===Ue||f.status===401)){const t=this.painter.context.gl;Jo(t,!1),this._logoControl instanceof Yl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Hi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Qt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,d=o.createFramebuffer();function y(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const T=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,T),T}return o.bindFramebuffer(o.FRAMEBUFFER,d),this._canvasPixelComparison(y(f),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(f,t,o){let d=o[1]-o[0];const y=f.length/4;for(let v=0;v<t.length;v++){const T=t[v];let S=0;for(let R=0;R<T.length;R+=4)T[R]===f[R]&&T[R+1]===f[R+1]&&T[R+2]===f[R+2]&&T[R+3]===f[R+3]&&(S+=1);d+=(o[v+2]-o[v+1])*(1-S/y)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Qo.delete(this.painter.context.gl),Nn.remove(),Oi.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame((t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)})))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return s.bw(t,((o,d)=>o._preloadTiles(f,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,t){s.eX(f,t)}get version(){return G}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},p_,f),this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),Ge("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),Ge("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))})),this._compassIcon=Ge("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),o=t===f.getMaxZoom(),d=t===f.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gp(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const o=Ge("button",f,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(f,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",o),f.firstElementChild&&f.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(f={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},mu,f),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=zd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,f(o)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((o=>t(o.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),o=f.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",f)),this._finish()}}_updateCamera(f){const t=new s.aR(f.coords.longitude,f.coords.latitude),o=f.coords.accuracy,d=this._map.getBearing(),y=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),y,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new s.aR(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=s.ce(1,f._center.lat)*f.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ge("button","mapboxgl-ctrl-geolocate",this._container),Ge("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ge("div","mapboxgl-user-location"),this._dotElement.appendChild(Ge("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ge("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ge("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))}))}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&f()})).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lh,ScaleControl:class{constructor(f={}){this.options=Object.assign({},ja,f),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,d=t._containerWidth/2-f/2,y=t.unproject([d,o]),v=t.unproject([d+f,o]),T=y.distanceTo(v);if(this.options.unit==="imperial"){const S=3.2808*T;S>5280?this._setScale(f,S/5280,"mile"):this._setScale(f,S,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,t,o){this._map._requestDomTask((()=>{const d=(function(v){const T=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O})(S),T*S})(t),y=d/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(d):`${d}&nbsp;${Ho[o]}`,this._container.style.width=f*y+"px"}))}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ge("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ge("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:zh,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create($u),f),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aR.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=f;d=o.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ge("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const o=this._closeButton=Ge("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,d=this._pos;if(!t||!o||!d)return"bottom";const y=o.offsetWidth,v=o.offsetHeight,T=d.x<y/2,S=d.x>t.transform.width-y/2;if(d.y+f<v)return T?"top-left":S?"top-right":"top";if(d.y>t.transform.height-v){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let d=this._container;if(d||(d=this._container=Ge("div","mapboxgl-popup",t.getContainer()),this._tip=Ge("div","mapboxgl-popup-tip",d),d.appendChild(o)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wu(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof s.P?f:t.project(this._lngLat,this._altitude),v=jd(this.options.offset),T=this._anchor=this._getAnchor(v.y),S=jd(this.options.offset,T),R=y.add(S).round();t._requestDomTask((()=>{this._container&&T&&(this._container.style.transform=`${Jr[T]} translate(${R.x}px,${R.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const y=s.eY(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(gl);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Fh,Style:La,LngLat:s.aR,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:yf,Evented:s.E,config:s.e,prewarm:s.f0,clearPrewarmedResources:s.e$,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.f9.workerCount},set workerCount(f){s.f9.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.f8(f)},get workerUrl(){return s.f7.workerUrl},set workerUrl(f){s.f7.workerUrl=f},get workerClass(){return s.f7.workerClass},set workerClass(f){s.f7.workerClass=f},get workerParams(){return s.f7.workerParams},set workerParams(f){s.f7.workerParams=f},get dracoUrl(){return s.f6()},set dracoUrl(f){s.f5(f)},get meshoptUrl(){return s.f4()},set meshoptUrl(f){s.f3(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}}));var D=w;return D}))})(hb)),hb.exports}var aj=oj();const eh=CC(aj),GE=async()=>{try{await KN(Bc);const{setUser:u,setUserData:n,setHasProfile:l,setLoading:m}=Xa.getState();u(null),l(null),n(null),m(!1),console.log(" User successfully logged out.")}catch(u){console.error(" Logout error:",u)}},LP="pk.eyJ1IjoibWF0YWRldnMiLCJhIjoiY21mNmdhc3YyMGcxdzJrb21xZm80c3NpbCJ9.R0nU8Ip_9RCo-Q2aWxAbXA",lj=({cards:u,setSelectedBooking:n,mapRef:l})=>{const[m,w]=st.useState(0),[C,D]=st.useState({}),s=()=>{w(te=>(te+1)%u.length)};st.useEffect(()=>{const te=u[m].location?.latitude,ce=u[m].location?.longitude;te&&ce&&l.current?.easeTo({center:[ce,te],duration:300,zoom:l.current?.getZoom()??14,easing:we=>we})},[m]);const G=()=>{w(te=>(te-1+u.length)%u.length)},q=async te=>{try{const ce=te.location?.latitude,we=te.location?.longitude;return!ce||!we?"Unknown location":(await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${we},${ce}.json?access_token=${LP}`)).json()).features?.[0]?.place_name||"Address not found"}catch(ce){return console.error(ce),"Address unavailable"}};return st.useEffect(()=>{const te=async()=>{const ce={};for(const we of u){const ze=await q(we);we.id&&(ce[we.id]=ze)}D(ce)};u.length>0&&te()},[u]),Y.jsxs("div",{className:"relative w-full flex justify-center items-center h-80 overflow-hidden select-none",children:[Y.jsx("div",{className:"relative flex items-center justify-center w-full",children:u.map((te,ce)=>{const we=ce-m,ze=we<0?we+u.length:we,at=ce===m,Ge=ze===0?"translate-x-0 z-20 ":ze===1?"translate-x-[50%] scale-90 opacity-80 z-10":ze===u.length-1?"-translate-x-[50%] scale-90 opacity-80 z-10":"opacity-0 scale-75 z-0";return Y.jsx("div",{onClick:()=>{ze===0&&n(te),ze===1&&s(),ze===u.length-1&&G()},className:`absolute transition-all duration-500 ease-in-out transform ${Ge}`,children:Y.jsxs("div",{className:`w-84 h-60 rounded-2xl shadow-lg overflow-hidden bg-white ${at?"z-20":"z-10"}`,children:[Y.jsxs("div",{className:"bg-yellow-500/50 py-3 rounded-xl flex text-left pl-3",children:[Y.jsxs("div",{className:"flex flex-col flex-1",children:[Y.jsx("span",{className:"font-bold",children:"Booked"}),Y.jsxs("span",{className:"text-sm",children:[" ",te.dateSchedule?new Date(te.dateSchedule.toDate()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"No schedule"]})]}),Y.jsx("div",{className:"flex-1 font-semibold text-gray-800 text-2xl align-center self-center text-center",children:te.price?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(te.price):"0.00"})]}),Y.jsxs("div",{className:"flex flex-col px-4",children:[Y.jsxs("div",{className:"flex",children:[Y.jsxs("div",{className:"px-2 pt-7 flex flex-col",children:[Y.jsx("div",{className:"w-5 h-6 z-50 bg-yellow-500 rounded-full"}),Y.jsx("div",{className:"w-1 -mt-2 bg-black h-full mx-auto "})]}),Y.jsxs("div",{className:"flex-1 px-2 pt-4 text-center font-semibold text-gray-700",children:[C[te.id??""]||"Loading...",Y.jsx("hr",{className:"mt-4"})]})]}),Y.jsxs("div",{className:"flex",children:[Y.jsxs("div",{className:"px-2 mb-7 flex flex-col",children:[Y.jsx("div",{className:"w-1 -mt-2 bg-black h-full mx-auto "}),Y.jsx("div",{className:"w-5 h-6 z-50 bg-yellow-500 rounded-full"})]}),Y.jsx("div",{className:"flex-1 p-4 text-center font-semibold text-gray-700",children:C[te.id??""]||"Loading..."})]})]})]})},`${te.id}-${ce}`)})}),Y.jsx("button",{onClick:G,className:"absolute left-2 bg-gray-700 text-white rounded-full p-2 opacity-80 hover:opacity-100",children:""}),Y.jsx("button",{onClick:s,className:"absolute right-2 bg-gray-700 text-white rounded-full p-2 opacity-80 hover:opacity-100",children:""})]})},zP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAABaCAYAAAAfBsDqAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgtSURBVHgB7Z3PbxvXEcdn3nIptlbTdR0Z8qnULbfQBwOykiL0zTeLLVD0VvmWW+2/wPJ/IN9ys3wreqEcoEBv3gCuoyCHyLfcRAMB4thOvPlhgBbJncwsSZG7em/1uOIPidkPIGn59hf51bx58552RgA5ViCMkf161StB0ysAlBFUWdqIt3s38vjbH2ESEPzI9wl6LwIEDAjCBkEneAPnGis1P4ATklkoEWURmhUWZB0Q3+cLVUDEOJ2wcLAHRE9ZSP9nWPBHFW9koV7WV6uIzp1TLsyxENAOC/fg3drnOzbHWws1JFAV5gpqdAjuXqw92U476lihpIu9o1p3+FdwC+Ya2lZUvH3e0CVThfq2Xi0XsfUIeg55/qHGAYXXLtV2G8k9RqEyi0TwjPt/A6IveYnRT8WjEW+fePTRgUBeCOj1tsvQ3fZ49Ctzw59HuphBrILpcBuRWOUgpPAhb/khjyrcz/fgFPKivlZR0eCDVYVwg1IHISwvoFPnjcuxVt2h3z9cY5+Em2C6FKtORPcULGyfH0OMMm1e1dc2FOIdSjMEhK0LN/5/e/AyQa/L7RsvEAlU3DyLAiV5Vf9wC5H+Zdp/QJ2VfhdUyZ0utDZNJ7KV3b1Qe3JrHkQS3q09viWfybSfu+D9/nbMotKtibYvrD+5CXPIDztrdR5o1nX7FLnnxTBizrwAb9c1RtY7ITQqn8b+/XIJPP6aAlnndEjFm4StKmicfBsOJH7cjAmFqG7oL0XstI/GFsfx/NMPVgthWCU6mIpQL+tXg04Y7i7/7YvdUc4Ti2EH/wARj/grB/Ej+XloPq85AjdNTzjEvwcjsl+veE6HrhPhVETqgp6jnOvf1lfLMCIEakffDlXR5lCoNq8EaG/NoUCW+GgRShWYERjSMozIUu2xD4dLNXHa0K4MOSTUfrCQ4ClkQDlOE2aEUtnuTQQP9Xs6A6E43K9qT+b1G8jAT39w2QonM2VJBwMXig3IAC/2aXsOB6fvD5w5omH10ck0LVm55je5b2934G2VlFpWYThxX8X+pOFA0c8a5yEUGtyHNO1YKQzdZUU3oWGVM1tF7w1bLYydBhxo7YX8PQn3qoEzR8MsO6sZn01KBqPAsoJjmJfpig1pnzUS6rUx7uiuKf2W4JHvma79WIvK6RIJ1Tasy5jUnWfYV7/WtecWlYAM0XkulCW5UJbkQlmSC5WE6EddcyRU/8mTJDwCmP/IMLdg7sxPQi6UJblQluRCWZILZUkulCW5UJbkQlmSC2VJLpQluVCW5EJZkgtlSS6UJblQluRCWZILZUkulCW5UJbkQlmSC2VJLpQluVCW5EJZUoBTxIv/XFkGF5YRnCjVQtLxoQXPL/79y+cwY2YulOTKlLzlVRdxNZnlgGLwbjd1g6DtX6x9ObPEyZkK9eK/V5bxoPAPSc0gSjsSPQR3nQWrUqv971lY2Mx81DeSvtoqbPTyfy1hwVz3Y0l9hSkzE6EkoaiERxOKELHJ7+hrgNCPvng7aktCdD3yZ1Ok1/WcQPfEPneH8zABFuF3G0mRiGj3l6Dor9z0Y8JIZpMk7fD7q/bbWLwSuNJlYQvGjeF5+0goglaAmif2YQIlRV7Ur1SOdrfQv/jXXV93fO/Zb/9l/UMYFkuuIdealoOfQddzY/4FgfaWanqRhpE0MVKUSFh0puarpirU/qNqCROPajuw4FueDm/eiR8rD8BFqbhTYKpClYJm3AErfD5KColkbIEKY6HBuXNLY3cPOiKhCJT+cTxjalo2XCeRNtuhkfNsMMR4DMWRPEwB1b2XPtVM0q/glBEmBgLlFMabaSrpeBqm2vXCZjv2C6Go4MxoYOKX53RoKim5PaHMeWowRt4snQuGA0iJh0bJKO8eO7Aojr2aWcoMpGHKW4yESnOoEvDBmBBnTGE8tU0RXLcduQqJahcKJYofH2mf9bDrmTKpmtAcq59qYxiLhRSq5d97l1LFkn3f1a+uJwPVsNUeqRDEcbTgoKzfQ42BjzI8fO8a0vyzItVzkoGj4nssepc+7kbtA0SgV59efU/2qcT7kEB13KsICKHWKMSIhpOvn+mTr8dftk0Cx8Wg9R7EHHN/KWVtXWpp9tuoo7sCBj8Hxf/B2DEaRTDoeik5/zBmxFcVwN0210WQLmZafsFAzk1OnsdBWu2HofDAVN9AXy7opMgA8ovnfnJ0/mamu8LgfjKphHA0GoWzd9jZxOOH2NKmiYaE13q1SyaC3LtfSAISdVWkiGCH4GsXF3YnmTEvi4EO4le6fVJD6tBHyZv4YecDX6rbJA9kJydW5cOEGC4ksX+/WvI8iEbAIIDmJLqYDh4sbuna2Yo/k/cXc9/sSDelSJ7m+IBVXZnXGghpldhCCm8v1T7fik1hClDcMlzLIzy4D3NKWl2/gtQUhsRcr2divu4EqQEXlZ2cM+Qz8bTln/q9g0psRyIndqzlMK28JMKWCt27Z70b2tRAVtRZMQolHFef0rZi82mkW4f97QZPneTzlY0HRqU0H2/2XxprBfMI+BV1a5anwVZFOyzaZzxT2pvlX3LTkKmRkrV6hI+wGxemzl+lXN2f1p+sxNsMSBckbD3KMIVpSMGr3jQkGJ5sY9Q+froLjL2iyofLJFjurc+XR7hUJBJSeC25fJNapvsEYp1JTCIJqSuc7LD5RPcyW8UDmHeI7iEVL5sWAq3/lYBVxeYziETe/MeVzeOmaNZC9XlV/ws7w84GTyBvwBmlW4edntoINHRONroT2U4Voi+oyHIMndL/6tEXhjf3pIJrAQp7o8aBvwJCKDXRN+I9EQAAAABJRU5ErkJggg==",kP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABICAYAAABhlHJbAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAi5SURBVHgB5VxdThtJEK6aMQ4Pu4r5SaR9ijlBzFsWIsWcAOYEISeIOQHmBMAJ4pzAzgnwagMbaR8gJ8D7FGkDiSPtA9jM1Fa1Z8Cxu+2xPdPm55MS7On5LVfXz1fVgzAFnFaLuV/gchMRXyFggTflYTw0iP8FRO99COq/eZ8aYBkIlnH+YWUbCEv8MQeJghr8NJWF9aMdsAhrAvxSLeaz2K7yxwKkCH6gk0vyPVvaaEWAofAOYPypOiKo4VB2ec6rNyFlOGABM9AugzXhCTBPHW1PHakL8N/qCjsLeA2Wwc6l+LX6sggpIwMpw0V8axojoj8InHIGMifjTDcRkIvBWwLc0F+btvlPHVJEqjYwtH2n2kHCnQXvYxkSwFn15R4iaX+oFvlLaTqUVKewC62ibjuykU9KeIJF72OJNaGhG8sYtDMppCZA0T6evtu6sYDgAyQMDqa153TYhHypvshDShjbBko28StcFtlY5zmbyLNaPRbvh9fetp03Hct2rwYJQ87Jmq2ZxshmxD09r602+EuT75dtLTX5gH9Igm+gk/9g9mRpzJBnJBvIHrXgOrDO9msTxgxLZPrObxwtQQr4Vls9pfHDpRNxam0I9kaxmbEEKILjqbDLOxdhQhA53qL3Z+IaKBCv7CAdwMSgSouCnTiCHGoDzz+s7rItO05CeOJ50xKe4In3sS7XgImBm2raS94+bE/TgLJxHM0nITgU20PAYcvhHljAeXW1xBfdhQQwLLfWCjCx3JUNNV+i4sBVZc4y1fSdn8HnFNJBeEWTPgfbbZ7Sazoh9glwJOEpTxbU5VfibIA9nMP8XNBkbq45C7NNG8l8HLAwcxdwkXPByaH6hzkCv8D3XQgjiOfDz6InKPoE+K22UqUBwWdnOuJ+i7VqGgRmGhBtDeCqxNnM+iBt5Wevz28crvVsu0FIdpZNJxA370J247ZoVtIQQRK2dgcpUEDB1hPvr2tbfi3AcOoeg4kpTjB3ve04r74sQ4eI0KHp0MxSpETXYUzI2T144QnkWcVMGYZzV9AqRV+UBoqRDTqsSZ8AxUHwvF+GBwjObA5IH8Zda6HSQB982UmrfcgxEDxQIM28MQzl2tBSdjKcwoHBaJL1+O02gTWsgQZC1uX4Uv4qAaIhDiIDRfSQEJBjsoVF+S+j7B+0taVGFx7VYQoQ/i6jaDInL9QT007NSSinbnSK+heFzrlvwAlA44n3qd67vwtuPYBAcybMi+xQUVRMFvQNW3YeX6svivxQG4goBShD0V34O6j71N5/6v19AiNiaJaFsLewfrjVu/msutrgWfqsd7tPtMypYqC9WWZ4f4AFyA94xt7OQfcAOwWoAR0LmBemxMXssRwzKtM8g+13MChFJSh9rf5e0gxofywHKO/0qvL1rSLoi0EJQm52XKpMjolLOXUfM2wf5j01/gC1piPgnNox5X6BYlLSg/CMDjqTU06cesq5Yu0a45l4H83MI60ApXxhpTOhF52cG0qQFPhcMcnPvcHj1HCZ0u8/PRidVwbNBjsVwkA6FQYRFjeXh8/sGdn2YC4W5cTnZJPwozvR74UQut+rK3UfYJMP6Hlu5Kwi2NPHvSKLfupUZJeRGwTt/WPiAuyUOttGTYmoMgcye72MT0g5bTLl9NpkdtgkbPN+lUFs0Zx3JA5hJO1HgyzYTzxOvbWjG4OajCRskrRx3pD5SFbAf8oiIOBQxCDEKNEvgyVYs4Eq6DQ0GYnt4bxzLU7aqNIrmlk2dSJIIV2uBZZgTYBR8q0Dcr1hFJJW9r0iMpEcuUHXShrWBMgXSpSweMq2zJSrR4m+DVgTIGcZz3TbJyMs3IphoAiWYDMOzOs2TkJYSKKvH8H7ZwPBEG9OUqAacOy9FKAWk3hMm97WBKMAmWRoQIIw5aFXcFWAMXHFvJ5+RNFeVsBkAlZ6N0pcphp1EgUZ+LugCGMCwd3UbaeUiZBuOCIo9oRvosBUiucSl0HCYFa5rts+buAraSEawhW+Vg0sQaVyi95Rhf9UIEVk+KGYGNfRTrnAUfnxFoyAQWlhxqIArTkRCZZNFa64dFQE2deUFsoMsllJtEom+IQ7DlJRO8h01LfaSuGSgi1T05JMW0XLkzlQZj5vEywCwTIGremIwExLXdniyC4zd4forA+l5In2F7yj5IjaEGdqtRW+01ywYlUDBS5kygRtaXo0hi8iKL7h4s334b+zYnQgWwbLsB5IS/bAdJRnoqPGQYcOG43RSQpTyURCTm9NSFSYEFHYlabjoD76P7o2/LA+hSOEDPPykF48IyL6f9E7LEPqMJU9oDn1XFh68aRVjH/N93GmtQhO+hVZg5duQ8/i1DSwG6E2bspntVgG/AKnmPnuyplM9wDck+RTzOFQVUEN5IUXt0KA3QgFVIfbBE1fTGezcyNAabPgsqDEZ3mJw9rkv7kvXfiTwlQ7lyUdKsDSd2jZe3HDbUbY/vxdN8a2e045ESe0Pz8D8z5cFuGBI2x/7oPY5OseaZObDqf0A4e+/ZlCfjMUoJ6rkw71NFd733aEnKOJ9VHVRCVAF7LCn2lt3SN038EDRdb87plmVE1UApS5HDCTodtTtDBu/919QshPmmoutb6VShnI7oGpD25EwvOuY9CaQVSLbIKdru9dBw5ZqMysR20Q4XnXEWuRec+yN81yV+PypugMDUCstQJ//74IUhxl1nFeD3stnyjQ/MaR9/O2HkjgSNg+jrnK+0ReHcJEwGc+uXxuEvhNH1xlCi5gtrk05UBctGoWLpRQXPBzXAqVRdf5DsuNzznPLUKMZ73hHH9WGi3V21k3a2xifHAwCU+gpbOSJDzvOoYRtkOLDeMSnvcCMYpUsapy0RswpvEewGmg82oDKIUN6QMxUlmzI8hWSRneWG+6uEMIX9HiQ1B7GkNwEcauC4u3ls6qG/ZYORz1ShEIQwFZBkAWe/V0CF/6c736KHzhWEPWhYhzIMg0pFFzXNrufzPEFSc5DH0oAAAAAElFTkSuQmCC",NP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFMAAABECAYAAAD9YQkjAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAfMSURBVHgB7ZzPb9tkGMefx06ydmNjXVfQEFpTJIYEEnQHxGiFll650GhcJ9IL123/AM1u3NZduSxo5ynpBY4tUlu20zokOAxpDQgxsa1bJtiaJo1fnseOG9uxHSfxa6eBj9Smeu0kzrfv8/N9HYQh5nHx48uIymcQAZoQVxCGlEfFmZyKeAOiY1OFIeRhMZNOosZCHofIENWE2/BWMXN8BKpSLuRU9nYZJJOEep4e0hAxbWbO/9UU1lfkXYwoKyJ1diy7WgEJeJm3EOIHCBEFcVLYNBLltpmZgCqdoKZBGpiuGrM+dDF5IqhYX2w7IPDqyex6HkLkSXG2gGifcAkYItzMG2nGnAhZSC+GRkw2b5opXzjHUWhz/Mhx4BXYzdFIz7FgD7SCn88PJOboW5+CMjIOYu8lvLx/y7jIxCgcPvO57bwXv9zc//vIuxf1x/qz+1B7eAdk4mfeY80PfxRqeco5L0EfpECZpIcFr+OBxGzsbBvXtrdjG9eq257PMY85nyODYOaNfWcnQsCU3/FAYrrNLBZp58F3ns/xOxYmnczbDRK61BBwDwKAgGm313dDF5PLLgUVNpNIktwUqlvbpVmQhsW83dgTsPxadqMAAXhcPJdBUIOLSULyyRFWC/KIMno7UfgX+YIxGBL8zFs2Q5VndjJvExXh/JPiDARBVWBSE4FOdReTaszNhhDLEDOIeJ6uJWMfFQX6cL+5nT8R2LyRg1YuyJlBhWRcxRQgNieyG3mICU6wjymUNwqnkAzmFBSFmtCudtM0oc9URuiv40j/gC2/4wNn5kZmoQvpExAxl0IlQ2nR1aBROQGppYao0WuKHgMtVlTQlsD3PQYETkEUVK/Rn9PWce720IfIAYxAg5LzVs6HVPXAje3SzOIedblfz/5Y8nv9ZpfqMkgkdjGNRm79htM3corTEMoC+cFVy3COAscqtb8WW+0vTCcQiyRq16YfNgrEBPvF7eWZReqd3rUKidyao6iM1POcyK6tOp93ksz6xPz6FJ8DtjYemz4VA/SaEBOxiPlX8ZP5YyQiCZIHW7EgCiiSU+PZtXyn5jGfo4jkWcqRv7UdoNekWbrFZSZETKRisl98UppdSaBWBEtjgv2iJnBufH5joZsOPJ1bpqZvjkSdohldbh1hf4rkT2fvPiyeS0NEROIzLamOLQCwSdPMoi74xhL0AYtKD1PkT3N2fwrTRh8gGn8qfWZyqkMmveUU0vCLbNLrfQlphf0pveacEHjdfkRPpVZkm740Mdmk2cyoicLpzr5fZJNWRMPTLz4qfjjdj2kapr92mU3f7k9N05/Z4msDCYRu5l2mOvs080xeVUyrdO6zYqavFcym6bumUvQ+KzJMP9SZySbdbapjBiX+gGD5wBASnVIpvmYICb1YpWXLMlUWk61BUdoV2hXoEr44+4go0Br5FbcZps9gW0Wzf0F6UArTl5rQbE832t+zUhONs9AlSVCWqBFj2cfEtT+0ixkGnOq4zUQjstcu0UzhGWGvk2n2KJBYkrVBwUTOPiSXTQhh4W7SZhPDvrhl1t9jklMXfQkC1cX2tl44ePUz2dSeQ7f4zO7t5dlrzvSIRRSg5L2CUlh4BcXWhbj3R/0gS35VOCzLq59ZGs9uLECXUCrk3UoV1qAkypqRrBdAIq1ioe4bZMg/p6FLmttjbP4+sq4RrzNhszdLq4NZ6kNugiRafplEdPRFefOErLX8WFpwDdCkBRgvv5wYe1vfmbL37Fdpa/pDs6DGnShqoHC1lbaOmyIm6ZFhMWVx4MVsRWgtYx1XRk7oIh564xxExYEV0yvNYZ946PQcjJ7O0N+HIUoOnJielVOMIpoEEtPYb6OkWyOicrLDAlbY2CK0I79LnfoIjrxzITYRTTqK6ZZsc6b4tDS7Sg0E6VtR7GlOe4Q+fOYCJI6+CYNARzGF1soPHXS1/qzQAj5l9HqFNAIjgVIjo4bW05y0ddwZoQeFjmKqkMzT4n3FuXivAHbV1aEO+IIGu3lyF5udGhlea+gcoY+8d3HgRDTpKGazydp3z89s1vqd4xehR2gmjp6ObYNbIAYimnt25wcgQndDrGL6NSKMmXgwRDSJRUy/RkRy4n09Qquj43DQiFzMTo2IQQ0uQYhMzKCNiIOMdDEHqREhG2liDmIjgttvtcc/gSykidlcB98nThG16lN48fNNqEvsZTKhisk3FghH1WLCSwVclUYpJL9n9fcV+lnV7/t0g9ejICRC3dFBJWO2bb+kBV4uqKwvwq7kG1MZNufnd77W39NLSFqYus47TSAkpG1C6IRKnZ6jH3ypB6IwMdd4ZJt0OxI3IXSi8fcfUFn7So/mxi3Y/Ylq3hjLZh0Xsdfmu3/e1meRniZRk7cXWMCdB997m3NExGbmbihUQnIpmaKSMghs0i/u39JnefzEaOZuaDvb8M+9bzqaflSpTrcM5IIamz7/sKD8YxIk1YmTcDdu9YqHi+GAwmkUC8pJP38/iLbj/VUWvWzA6hXpG7d6hTehCqyvCJcvpmLx2KT9aO2ma9/GKItYN2754XPriS9sQfztgLJ30wXFI5qLsgAsQwygYTrTAU/n8lXqLmMv0LhG6911XtEc0xjDF9P1wHR/d5CHS2w3og4j/4sZEghY0c1cAzGvCAj9VpH/EBWalfl/AaNzxxgqqEYpAAAAAElFTkSuQmCC",tf=[{name:"Smartshot",Image:zP,level:"entry"},{name:"Mid Photographers",Image:kP,level:"medium"},{name:"Pro Photographers",Image:NP,level:"pro"}],cj=({booking:u,MAPBOX_TOKEN:n,onAccept:l,onClose:m})=>{const[w,C]=st.useState("Loading address...");st.useEffect(()=>{(async()=>{try{const q=u.location?.latitude,te=u.location?.longitude;if(!q||!te)return C("Unknown location");const ze=(await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${te},${q}.json?access_token=${n}`)).json()).features?.[0]?.place_name||"Address not found";C(ze)}catch(q){console.error(q),C("Address unavailable")}})()},[u.location,n]);const D=u.Client,s=tf.find(G=>G.level===u.level?.level);return Y.jsxs("div",{className:"relative bg-white rounded-3xl w-[360px] p-6 shadow-lg font-inter text-gray-800",children:[Y.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-black",onClick:m,children:""}),Y.jsxs("div",{className:"flex items-center space-x-4",children:[Y.jsx("img",{src:D?.photoURL||Mm,alt:"Profile",className:"w-16 h-16 rounded-full object-cover"}),Y.jsx("div",{children:Y.jsx("h2",{className:"font-semibold text-lg",children:D?.fullname||"Unknown Photographer"})})]}),Y.jsxs("div",{className:"mt-5",children:[Y.jsx("p",{className:"text-sm font-semibold",children:"Tier Availed"}),Y.jsx("div",{className:"flex items-center self-center align-center space-x-2 mt-1 flex-1",children:u.type=="Rush"?Y.jsxs("div",{className:"flex flex-col space-x-2 space-y-2 mx-auto ",children:[Y.jsxs("div",{className:"flex space-x-2 mx-auto ",children:[Y.jsx("img",{src:tf[0].Image,alt:"Tier",className:"w-6 h-6"}),Y.jsx("span",{className:"text-yellow-600 font-medium text-sm",children:tf[0]?.name||"N/A"})]}),Y.jsxs("div",{className:"flex space-x-2 mx-auto ",children:[Y.jsx("img",{src:tf[1].Image,alt:"Tier",className:"w-6 h-6"}),Y.jsx("span",{className:"text-yellow-600 font-medium text-sm",children:tf[1]?.name||"N/A"})]})]}):s&&Y.jsxs(Y.Fragment,{children:[Y.jsx("img",{src:s.Image,alt:"Tier",className:"w-6 h-6"}),Y.jsx("span",{className:"text-yellow-600 font-medium text-sm",children:s?.name||"N/A"})]})})]}),Y.jsxs("div",{className:"mt-5",children:[Y.jsx("p",{className:"text-sm font-semibold",children:"Request"}),Y.jsxs("div",{className:"bg-yellow-100 rounded-lg flex justify-between items-center px-4 py-3 mt-2",children:[Y.jsx("span",{className:"text-sm text-gray-700",children:u.dateSchedule?new Date(u.dateSchedule.toDate()).toLocaleString():"No schedule"}),Y.jsxs("span",{className:"text-xl font-bold text-gray-800",children:["",u.price?.toLocaleString()||"0"]})]})]}),Y.jsxs("div",{className:"mt-5",children:[Y.jsxs("div",{className:"flex items-center space-x-2",children:[Y.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),Y.jsx("p",{className:"font-semibold text-sm",children:"Pickup Location"})]}),Y.jsx("p",{className:"ml-4 text-gray-600 text-sm",children:w})]}),u.notes&&Y.jsxs("div",{className:"mt-5",children:[Y.jsx("p",{className:"text-sm font-semibold mb-1",children:"Notes"}),Y.jsx("div",{className:"bg-gray-100 text-sm text-gray-600 p-3 rounded-lg",children:u.notes})]}),Y.jsx("button",{onClick:l,className:"w-full mt-6 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-full transition",children:"Accept"})]})},uj=({activeTab:u,setActiveTab:n,bookings:l})=>{const m=["Request","Scheduled","On Going","Completed","Canceled"],w={Request:["pending"],Scheduled:["accepted"],"On Going":["active2"],Completed:["complete2"],Canceled:["cancel2","declined2"]};return Y.jsx("div",{className:"flex space-x-6 px-4 py-3 border-b bg-white",children:m.map(C=>{const D=w[C],s=l?.filter(G=>{const q=Array.isArray(D)?D.includes(G.status):G.status===D,te=G.dateSeen===void 0;return q&&te}).length;return Y.jsxs("button",{onClick:()=>n(C),className:`relative font-medium pb-2 ${u===C?"text-yellow-500 border-b-2 border-yellow-500":"text-gray-500 hover:text-yellow-500"}`,children:[C,s&&s>0&&Y.jsx("span",{className:"absolute -top-3 -right-3 flex items-center justify-center bg-yellow-500 text-white text-xs font-bold rounded-full w-5 h-5",children:s})]},C)})})},FP=6048e5,hj=864e5,pC=Symbol.for("constructDateFrom");function up(u,n){return typeof u=="function"?u(n):u&&typeof u=="object"&&pC in u?u[pC](n):u instanceof Date?new u.constructor(n):new Date(n)}function oc(u,n){return up(n||u,u)}function dj(u,n,l){const m=oc(u,l?.in);return isNaN(n)?up(u,NaN):(m.setDate(m.getDate()+n),m)}let fj={};function Bx(){return fj}function Ay(u,n){const l=Bx(),m=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,w=oc(u,n?.in),C=w.getDay(),D=(C<m?7:0)+C-m;return w.setDate(w.getDate()-D),w.setHours(0,0,0,0),w}function Nb(u,n){return Ay(u,{...n,weekStartsOn:1})}function BP(u,n){const l=oc(u,n?.in),m=l.getFullYear(),w=up(l,0);w.setFullYear(m+1,0,4),w.setHours(0,0,0,0);const C=Nb(w),D=up(l,0);D.setFullYear(m,0,4),D.setHours(0,0,0,0);const s=Nb(D);return l.getTime()>=C.getTime()?m+1:l.getTime()>=s.getTime()?m:m-1}function mC(u){const n=oc(u),l=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return l.setUTCFullYear(n.getFullYear()),+u-+l}function VP(u,...n){const l=up.bind(null,n.find(m=>typeof m=="object"));return n.map(l)}function gC(u,n){const l=oc(u,n?.in);return l.setHours(0,0,0,0),l}function pj(u,n,l){const[m,w]=VP(l?.in,u,n),C=gC(m),D=gC(w),s=+C-mC(C),G=+D-mC(D);return Math.round((s-G)/hj)}function mj(u,n){const l=BP(u,n),m=up(u,0);return m.setFullYear(l,0,4),m.setHours(0,0,0,0),Nb(m)}function gj(u){return u instanceof Date||typeof u=="object"&&Object.prototype.toString.call(u)==="[object Date]"}function _j(u){return!(!gj(u)&&typeof u!="number"||isNaN(+oc(u)))}function yj(u,n){const l=oc(u,n?.in),m=l.getMonth();return l.setFullYear(l.getFullYear(),m+1,0),l.setHours(23,59,59,999),l}function vj(u,n){const l=oc(u,n?.in);return l.setDate(1),l.setHours(0,0,0,0),l}function xj(u,n){const l=oc(u,n?.in);return l.setFullYear(l.getFullYear(),0,1),l.setHours(0,0,0,0),l}function bj(u,n){const l=Bx(),m=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,w=oc(u,n?.in),C=w.getDay(),D=(C<m?-7:0)+6-(C-m);return w.setDate(w.getDate()+D),w.setHours(23,59,59,999),w}const wj={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Tj=(u,n,l)=>{let m;const w=wj[u];return typeof w=="string"?m=w:n===1?m=w.one:m=w.other.replace("{{count}}",n.toString()),l?.addSuffix?l.comparison&&l.comparison>0?"in "+m:m+" ago":m};function $w(u){return(n={})=>{const l=n.width?String(n.width):u.defaultWidth;return u.formats[l]||u.formats[u.defaultWidth]}}const Ej={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Sj={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Aj={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ij={date:$w({formats:Ej,defaultWidth:"full"}),time:$w({formats:Sj,defaultWidth:"full"}),dateTime:$w({formats:Aj,defaultWidth:"full"})},Cj={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Rj=(u,n,l,m)=>Cj[u];function Uv(u){return(n,l)=>{const m=l?.context?String(l.context):"standalone";let w;if(m==="formatting"&&u.formattingValues){const D=u.defaultFormattingWidth||u.defaultWidth,s=l?.width?String(l.width):D;w=u.formattingValues[s]||u.formattingValues[D]}else{const D=u.defaultWidth,s=l?.width?String(l.width):u.defaultWidth;w=u.values[s]||u.values[D]}const C=u.argumentCallback?u.argumentCallback(n):n;return w[C]}}const Mj={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Pj={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Dj={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Oj={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Lj={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},zj={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},kj=(u,n)=>{const l=Number(u),m=l%100;if(m>20||m<10)switch(m%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},Nj={ordinalNumber:kj,era:Uv({values:Mj,defaultWidth:"wide"}),quarter:Uv({values:Pj,defaultWidth:"wide",argumentCallback:u=>u-1}),month:Uv({values:Dj,defaultWidth:"wide"}),day:Uv({values:Oj,defaultWidth:"wide"}),dayPeriod:Uv({values:Lj,defaultWidth:"wide",formattingValues:zj,defaultFormattingWidth:"wide"})};function jv(u){return(n,l={})=>{const m=l.width,w=m&&u.matchPatterns[m]||u.matchPatterns[u.defaultMatchWidth],C=n.match(w);if(!C)return null;const D=C[0],s=m&&u.parsePatterns[m]||u.parsePatterns[u.defaultParseWidth],G=Array.isArray(s)?Bj(s,ce=>ce.test(D)):Fj(s,ce=>ce.test(D));let q;q=u.valueCallback?u.valueCallback(G):G,q=l.valueCallback?l.valueCallback(q):q;const te=n.slice(D.length);return{value:q,rest:te}}}function Fj(u,n){for(const l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&n(u[l]))return l}function Bj(u,n){for(let l=0;l<u.length;l++)if(n(u[l]))return l}function Vj(u){return(n,l={})=>{const m=n.match(u.matchPattern);if(!m)return null;const w=m[0],C=n.match(u.parsePattern);if(!C)return null;let D=u.valueCallback?u.valueCallback(C[0]):C[0];D=l.valueCallback?l.valueCallback(D):D;const s=n.slice(w.length);return{value:D,rest:s}}}const Uj=/^(\d+)(th|st|nd|rd)?/i,jj=/\d+/i,Gj={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qj={any:[/^b/i,/^(a|c)/i]},Hj={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Wj={any:[/1/i,/2/i,/3/i,/4/i]},$j={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Zj={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Xj={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Yj={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Kj={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Qj={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Jj={ordinalNumber:Vj({matchPattern:Uj,parsePattern:jj,valueCallback:u=>parseInt(u,10)}),era:jv({matchPatterns:Gj,defaultMatchWidth:"wide",parsePatterns:qj,defaultParseWidth:"any"}),quarter:jv({matchPatterns:Hj,defaultMatchWidth:"wide",parsePatterns:Wj,defaultParseWidth:"any",valueCallback:u=>u+1}),month:jv({matchPatterns:$j,defaultMatchWidth:"wide",parsePatterns:Zj,defaultParseWidth:"any"}),day:jv({matchPatterns:Xj,defaultMatchWidth:"wide",parsePatterns:Yj,defaultParseWidth:"any"}),dayPeriod:jv({matchPatterns:Kj,defaultMatchWidth:"any",parsePatterns:Qj,defaultParseWidth:"any"})},e6={code:"en-US",formatDistance:Tj,formatLong:Ij,formatRelative:Rj,localize:Nj,match:Jj,options:{weekStartsOn:0,firstWeekContainsDate:1}};function t6(u,n){const l=oc(u,n?.in);return pj(l,xj(l))+1}function i6(u,n){const l=oc(u,n?.in),m=+Nb(l)-+mj(l);return Math.round(m/FP)+1}function UP(u,n){const l=oc(u,n?.in),m=l.getFullYear(),w=Bx(),C=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??w.firstWeekContainsDate??w.locale?.options?.firstWeekContainsDate??1,D=up(n?.in||u,0);D.setFullYear(m+1,0,C),D.setHours(0,0,0,0);const s=Ay(D,n),G=up(n?.in||u,0);G.setFullYear(m,0,C),G.setHours(0,0,0,0);const q=Ay(G,n);return+l>=+s?m+1:+l>=+q?m:m-1}function n6(u,n){const l=Bx(),m=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,w=UP(u,n),C=up(n?.in||u,0);return C.setFullYear(w,0,m),C.setHours(0,0,0,0),Ay(C,n)}function r6(u,n){const l=oc(u,n?.in),m=+Ay(l,n)-+n6(l,n);return Math.round(m/FP)+1}function _s(u,n){const l=u<0?"-":"",m=Math.abs(u).toString().padStart(n,"0");return l+m}const dm={y(u,n){const l=u.getFullYear(),m=l>0?l:1-l;return _s(n==="yy"?m%100:m,n.length)},M(u,n){const l=u.getMonth();return n==="M"?String(l+1):_s(l+1,2)},d(u,n){return _s(u.getDate(),n.length)},a(u,n){const l=u.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return l.toUpperCase();case"aaa":return l;case"aaaaa":return l[0];case"aaaa":default:return l==="am"?"a.m.":"p.m."}},h(u,n){return _s(u.getHours()%12||12,n.length)},H(u,n){return _s(u.getHours(),n.length)},m(u,n){return _s(u.getMinutes(),n.length)},s(u,n){return _s(u.getSeconds(),n.length)},S(u,n){const l=n.length,m=u.getMilliseconds(),w=Math.trunc(m*Math.pow(10,l-3));return _s(w,n.length)}},sy={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},_C={G:function(u,n,l){const m=u.getFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return l.era(m,{width:"abbreviated"});case"GGGGG":return l.era(m,{width:"narrow"});case"GGGG":default:return l.era(m,{width:"wide"})}},y:function(u,n,l){if(n==="yo"){const m=u.getFullYear(),w=m>0?m:1-m;return l.ordinalNumber(w,{unit:"year"})}return dm.y(u,n)},Y:function(u,n,l,m){const w=UP(u,m),C=w>0?w:1-w;if(n==="YY"){const D=C%100;return _s(D,2)}return n==="Yo"?l.ordinalNumber(C,{unit:"year"}):_s(C,n.length)},R:function(u,n){const l=BP(u);return _s(l,n.length)},u:function(u,n){const l=u.getFullYear();return _s(l,n.length)},Q:function(u,n,l){const m=Math.ceil((u.getMonth()+1)/3);switch(n){case"Q":return String(m);case"QQ":return _s(m,2);case"Qo":return l.ordinalNumber(m,{unit:"quarter"});case"QQQ":return l.quarter(m,{width:"abbreviated",context:"formatting"});case"QQQQQ":return l.quarter(m,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(m,{width:"wide",context:"formatting"})}},q:function(u,n,l){const m=Math.ceil((u.getMonth()+1)/3);switch(n){case"q":return String(m);case"qq":return _s(m,2);case"qo":return l.ordinalNumber(m,{unit:"quarter"});case"qqq":return l.quarter(m,{width:"abbreviated",context:"standalone"});case"qqqqq":return l.quarter(m,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(m,{width:"wide",context:"standalone"})}},M:function(u,n,l){const m=u.getMonth();switch(n){case"M":case"MM":return dm.M(u,n);case"Mo":return l.ordinalNumber(m+1,{unit:"month"});case"MMM":return l.month(m,{width:"abbreviated",context:"formatting"});case"MMMMM":return l.month(m,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(m,{width:"wide",context:"formatting"})}},L:function(u,n,l){const m=u.getMonth();switch(n){case"L":return String(m+1);case"LL":return _s(m+1,2);case"Lo":return l.ordinalNumber(m+1,{unit:"month"});case"LLL":return l.month(m,{width:"abbreviated",context:"standalone"});case"LLLLL":return l.month(m,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(m,{width:"wide",context:"standalone"})}},w:function(u,n,l,m){const w=r6(u,m);return n==="wo"?l.ordinalNumber(w,{unit:"week"}):_s(w,n.length)},I:function(u,n,l){const m=i6(u);return n==="Io"?l.ordinalNumber(m,{unit:"week"}):_s(m,n.length)},d:function(u,n,l){return n==="do"?l.ordinalNumber(u.getDate(),{unit:"date"}):dm.d(u,n)},D:function(u,n,l){const m=t6(u);return n==="Do"?l.ordinalNumber(m,{unit:"dayOfYear"}):_s(m,n.length)},E:function(u,n,l){const m=u.getDay();switch(n){case"E":case"EE":case"EEE":return l.day(m,{width:"abbreviated",context:"formatting"});case"EEEEE":return l.day(m,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(m,{width:"short",context:"formatting"});case"EEEE":default:return l.day(m,{width:"wide",context:"formatting"})}},e:function(u,n,l,m){const w=u.getDay(),C=(w-m.weekStartsOn+8)%7||7;switch(n){case"e":return String(C);case"ee":return _s(C,2);case"eo":return l.ordinalNumber(C,{unit:"day"});case"eee":return l.day(w,{width:"abbreviated",context:"formatting"});case"eeeee":return l.day(w,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(w,{width:"short",context:"formatting"});case"eeee":default:return l.day(w,{width:"wide",context:"formatting"})}},c:function(u,n,l,m){const w=u.getDay(),C=(w-m.weekStartsOn+8)%7||7;switch(n){case"c":return String(C);case"cc":return _s(C,n.length);case"co":return l.ordinalNumber(C,{unit:"day"});case"ccc":return l.day(w,{width:"abbreviated",context:"standalone"});case"ccccc":return l.day(w,{width:"narrow",context:"standalone"});case"cccccc":return l.day(w,{width:"short",context:"standalone"});case"cccc":default:return l.day(w,{width:"wide",context:"standalone"})}},i:function(u,n,l){const m=u.getDay(),w=m===0?7:m;switch(n){case"i":return String(w);case"ii":return _s(w,n.length);case"io":return l.ordinalNumber(w,{unit:"day"});case"iii":return l.day(m,{width:"abbreviated",context:"formatting"});case"iiiii":return l.day(m,{width:"narrow",context:"formatting"});case"iiiiii":return l.day(m,{width:"short",context:"formatting"});case"iiii":default:return l.day(m,{width:"wide",context:"formatting"})}},a:function(u,n,l){const w=u.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return l.dayPeriod(w,{width:"abbreviated",context:"formatting"});case"aaa":return l.dayPeriod(w,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return l.dayPeriod(w,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(w,{width:"wide",context:"formatting"})}},b:function(u,n,l){const m=u.getHours();let w;switch(m===12?w=sy.noon:m===0?w=sy.midnight:w=m/12>=1?"pm":"am",n){case"b":case"bb":return l.dayPeriod(w,{width:"abbreviated",context:"formatting"});case"bbb":return l.dayPeriod(w,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return l.dayPeriod(w,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(w,{width:"wide",context:"formatting"})}},B:function(u,n,l){const m=u.getHours();let w;switch(m>=17?w=sy.evening:m>=12?w=sy.afternoon:m>=4?w=sy.morning:w=sy.night,n){case"B":case"BB":case"BBB":return l.dayPeriod(w,{width:"abbreviated",context:"formatting"});case"BBBBB":return l.dayPeriod(w,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(w,{width:"wide",context:"formatting"})}},h:function(u,n,l){if(n==="ho"){let m=u.getHours()%12;return m===0&&(m=12),l.ordinalNumber(m,{unit:"hour"})}return dm.h(u,n)},H:function(u,n,l){return n==="Ho"?l.ordinalNumber(u.getHours(),{unit:"hour"}):dm.H(u,n)},K:function(u,n,l){const m=u.getHours()%12;return n==="Ko"?l.ordinalNumber(m,{unit:"hour"}):_s(m,n.length)},k:function(u,n,l){let m=u.getHours();return m===0&&(m=24),n==="ko"?l.ordinalNumber(m,{unit:"hour"}):_s(m,n.length)},m:function(u,n,l){return n==="mo"?l.ordinalNumber(u.getMinutes(),{unit:"minute"}):dm.m(u,n)},s:function(u,n,l){return n==="so"?l.ordinalNumber(u.getSeconds(),{unit:"second"}):dm.s(u,n)},S:function(u,n){return dm.S(u,n)},X:function(u,n,l){const m=u.getTimezoneOffset();if(m===0)return"Z";switch(n){case"X":return vC(m);case"XXXX":case"XX":return Fg(m);case"XXXXX":case"XXX":default:return Fg(m,":")}},x:function(u,n,l){const m=u.getTimezoneOffset();switch(n){case"x":return vC(m);case"xxxx":case"xx":return Fg(m);case"xxxxx":case"xxx":default:return Fg(m,":")}},O:function(u,n,l){const m=u.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+yC(m,":");case"OOOO":default:return"GMT"+Fg(m,":")}},z:function(u,n,l){const m=u.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+yC(m,":");case"zzzz":default:return"GMT"+Fg(m,":")}},t:function(u,n,l){const m=Math.trunc(+u/1e3);return _s(m,n.length)},T:function(u,n,l){return _s(+u,n.length)}};function yC(u,n=""){const l=u>0?"-":"+",m=Math.abs(u),w=Math.trunc(m/60),C=m%60;return C===0?l+String(w):l+String(w)+n+_s(C,2)}function vC(u,n){return u%60===0?(u>0?"-":"+")+_s(Math.abs(u)/60,2):Fg(u,n)}function Fg(u,n=""){const l=u>0?"-":"+",m=Math.abs(u),w=_s(Math.trunc(m/60),2),C=_s(m%60,2);return l+w+n+C}const xC=(u,n)=>{switch(u){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},jP=(u,n)=>{switch(u){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},s6=(u,n)=>{const l=u.match(/(P+)(p+)?/)||[],m=l[1],w=l[2];if(!w)return xC(u,n);let C;switch(m){case"P":C=n.dateTime({width:"short"});break;case"PP":C=n.dateTime({width:"medium"});break;case"PPP":C=n.dateTime({width:"long"});break;case"PPPP":default:C=n.dateTime({width:"full"});break}return C.replace("{{date}}",xC(m,n)).replace("{{time}}",jP(w,n))},o6={p:jP,P:s6},a6=/^D+$/,l6=/^Y+$/,c6=["D","DD","YY","YYYY"];function u6(u){return a6.test(u)}function h6(u){return l6.test(u)}function d6(u,n,l){const m=f6(u,n,l);if(console.warn(m),c6.includes(u))throw new RangeError(m)}function f6(u,n,l){const m=u[0]==="Y"?"years":"days of the month";return`Use \`${u.toLowerCase()}\` instead of \`${u}\` (in \`${n}\`) for formatting ${m} to the input \`${l}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const p6=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,m6=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,g6=/^'([^]*?)'?$/,_6=/''/g,y6=/[a-zA-Z]/;function Q0(u,n,l){const m=Bx(),w=m.locale??e6,C=m.firstWeekContainsDate??m.locale?.options?.firstWeekContainsDate??1,D=m.weekStartsOn??m.locale?.options?.weekStartsOn??0,s=oc(u,l?.in);if(!_j(s))throw new RangeError("Invalid time value");let G=n.match(m6).map(te=>{const ce=te[0];if(ce==="p"||ce==="P"){const we=o6[ce];return we(te,w.formatLong)}return te}).join("").match(p6).map(te=>{if(te==="''")return{isToken:!1,value:"'"};const ce=te[0];if(ce==="'")return{isToken:!1,value:v6(te)};if(_C[ce])return{isToken:!0,value:te};if(ce.match(y6))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ce+"`");return{isToken:!1,value:te}});w.localize.preprocessor&&(G=w.localize.preprocessor(s,G));const q={firstWeekContainsDate:C,weekStartsOn:D,locale:w};return G.map(te=>{if(!te.isToken)return te.value;const ce=te.value;(h6(ce)||u6(ce))&&d6(ce,n,String(u));const we=_C[ce[0]];return we(s,ce,w.localize,q)}).join("")}function v6(u){const n=u.match(g6);return n?n[1].replace(_6,"'"):u}function x6(u,n,l){const[m,w]=VP(l?.in,u,n);return m.getFullYear()===w.getFullYear()&&m.getMonth()===w.getMonth()}const b6=({bookings:u,selectedBooking:n,selectedDate:l,onSelectBooking:m,setSelectedDate:w,setSelectedBooking:C,weekStartsOn:D=0})=>{const[s,G]=st.useState(new Date),q=st.useMemo(()=>{const at=vj(s),Ge=yj(s),Qe=Ay(at,{weekStartsOn:D}),xt=bj(Ge,{weekStartsOn:D}),wt=[];let jt=Qe;for(;jt<=xt;)wt.push(jt),jt=dj(jt,1);return wt},[s,D]),te=st.useMemo(()=>{const at={};return u.forEach(Ge=>{if(!Ge?.dateSchedule)return;const Qe=Ge.dateSchedule.toDate?Ge.dateSchedule.toDate():new Date(Ge.dateSchedule),xt=Q0(Qe,"yyyy-MM-dd");(at[xt]||=[]).push(Ge)}),at},[u]),ce=()=>G(new Date(s.getFullYear(),s.getMonth()-1,1)),we=()=>G(new Date(s.getFullYear(),s.getMonth()+1,1)),ze=D===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return Y.jsxs("div",{className:"w-full  p-5",children:[Y.jsxs("div",{className:"flex items-center justify-between mb-4 ",children:[Y.jsx("button",{onClick:ce,className:"px-3 py-1 text-gray-600 hover:text-yellow-600",children:" Prev"}),Y.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:Q0(s,"MMMM yyyy")}),Y.jsx("button",{onClick:we,className:"px-3 py-1 text-gray-600 hover:text-yellow-600",children:"Next "})]}),Y.jsx("div",{className:"grid grid-cols-7 gap-2 text-center text-sm font-medium text-gray-600 mb-2",children:ze.map(at=>Y.jsx("div",{children:at},at))}),Y.jsx("div",{className:"grid grid-cols-7 gap-2",children:q.map(at=>{const Ge=Q0(at,"yyyy-MM-dd"),Qe=te[Ge]||[],xt=x6(at,s);return Y.jsxs("div",{onClick:()=>{w(at),C(null)},className:`border rounded-lg p-2 min-h-[56px] flex flex-col gap-1 transition
                                ${l==at?"bg-yellow-100":""}
                ${xt?"border-gray-200 hover:bg-yellow-50":"border-gray-100 bg-gray-50 opacity-70"}`,children:[Y.jsx("p",{className:`text-xs font-semibold ${xt?"text-gray-700":"text-gray-400"}`,children:Q0(at,"d")}),Y.jsxs("p",{className:"text-sm truncate",children:[Qe.length!=0&&Qe.length+" Clients"," "]})]},Ge)})})]})},bC=u=>{if(!u)return"Undefined";const[n,l]=u.split(":");let m=parseInt(n,10);const w=m>=12?"PM":"AM";return m=m%12||12,`${m}:${l} ${w}`},w6=({bookings:u,selectedBooking:n,setSelectedBooking:l})=>{const m=zy();async function w(C){if(!C)return;const D=lo(m,"bookings",C);await df(D,{dateSeen:Rm()}),console.log(" dateSeen updated to today!")}return Y.jsx("div",{className:" overflow-y-scroll h-98 bg-white border-l",children:u.map(C=>Y.jsxs("div",{onClick:()=>{l(C),w(C.id)},className:`flex  items-center justify-between  p-5 cursor-pointer border-b hover:bg-yellow-50 ${n?.id===C.id?"bg-yellow-100":""}`,children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("img",{src:C.Client?.photoURL||"/placeholder.png",className:"w-10 h-10 rounded-full object-cover"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"font-semibold text-gray-800",children:C.Client?.fullname}),Y.jsx("p",{className:"text-xs text-gray-500",children:"78 Rizal Blvd, Cebu City"})]})]}),Y.jsxs("div",{className:"text-right",children:[Y.jsxs("p",{className:"text-sm text-gray-500 flex",children:[Y.jsx("img",{src:tf.find(D=>D.level==C?.tier)?.Image,className:"w-5 mx-2"}),C.dateSchedule?`${new Date(C.dateSchedule.toDate()).toLocaleString("en-US",{month:"short",day:"numeric"})} ${bC(C.startTime)} - ${bC(C.endTime)}`:""]}),Y.jsxs("p",{className:"text-yellow-600 font-semibold text-sm",children:["",C.price?.toFixed(2)]})]})]},C.id))})};eh.accessToken="pk.eyJ1IjoibWF0YWRldnMiLCJhIjoiY21mNmdhc3YyMGcxdzJrb21xZm80c3NpbCJ9.R0nU8Ip_9RCo-Q2aWxAbXA";const T6=({selectedBooking:u})=>{const n=st.useRef(null),l=st.useRef(null),m=st.useRef([]);return st.useEffect(()=>{l.current&&!n.current&&(n.current=new eh.Map({container:l.current,style:"mapbox://styles/mapbox/light-v11",center:[123.8854,10.3157],zoom:12}))},[]),st.useEffect(()=>{u||(m.current.forEach(w=>w.remove()),m.current=[]),!(!u?.location||!n.current)&&u.location.forEach(w=>{const{latitude:C,longitude:D}=w.location;n.current?.flyTo({center:[D,C],zoom:14,speed:1.2,curve:1.5,essential:!0});const s=new eh.Marker({color:"#FBBF24"}).setLngLat([D,C]).addTo(n.current);m.current.push(s)})},[u]),Y.jsx("div",{ref:l,className:"flex-1"})},wC="pk.eyJ1IjoibWF0YWRldnMiLCJhIjoiY21mNmdhc3YyMGcxdzJrb21xZm80c3NpbCJ9.R0nU8Ip_9RCo-Q2aWxAbXA",E6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH0AAAB9CAYAAACPgGwlAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAg1SURBVHgB7Z3tkds2EIb3Mvmf6yBMBb5UYKaCOBVEqSBOBVYqsF2B5ArsVCClAtsVgKnA7uAN1qDueBJ14i5AEKT2mcH4Y85Dmi+xWOwulkSGYSyfG4oAQOV/qf248+MHPypKy2c/Gj/2Nzc3n8iYBi/0rR8v/dghL86PTfuiGbloxf6C6dnAxB8XfsB+fERZOD9ekJEe/2BrlDG7z/GKjHT4B/oC88CEF3DWe0dYMz/6cUvz4C/v4b8h4yK9onvBWWgWvKL58NWPX2xrd5nvzvw9m8uK5gW/qK/JuMjJTG/NuqP58oef7VsyztI309c0b8ypu8Cjmb6AWX6A1/Y9Gb18f/TnmnSwE/XWj0/t71PA8fw/SedbcNBmT8Zl/Ez/ADnb1tsf657WkLMEa5UHyEOtWR6uv84byJlLfGFaIKemDCBk9qSh4Dsyern33qHIWuVylvx12E+QBl1M9DN8R3oayst/JMNEP0OM6LnXTOlMr8jo5V50b0IbknGb2VlqSMZzMno5nulSE1pRPqQz/RZWXdPLsehfSEa2dbO1RNLAT03GCceifyYZFeXlX5JhzlwPx6I3JONHyovUxP9KxgmxoueeSXuSUdm6fsqx6KVvizRVMVYxe0TsTM/qIbeRuT3JMBN/xCPR24cq3bbVlBepM1fDki+P6IvI7UlG6es6syLjnj7Rpetm1shXm+SR7tfNxHdIIfrdBObzHckwE98hhehMbhP/geSYF99yIvocnDmlibcETMu51OqeZEzxQKUm/icyvpFK9CnWdamJzx0yLpZUorPgudf1hgwVvaK3aUzpup7bUTJvXMlT5VJS8/k75UVqWaQv8WJ5SvQ9ybjNWRJN8jNrqU7ezJ6UojM15WFD8gzfnozLQN42bPQTLwidpTTUZFwGoYVYMQ83QnA72zYUhONEUt7QCEQIzrwkYziQm3hpRe2Qe9hAj4OVTD1iyAkXadFCUi+eBae4fPg7xUGO6wY6E7+jBETO8G+znAwd0DX/jYqYJRCcjzZXZJww9ADjPyRH7TwhdIBckZ5DT7mGDB3QNQX4opntCM2HY2e4nWx5gkEzvS2skOavWXBNEiZGMOsaOQDJ+XRNiZImCaMV3QQfyGDR2xKlPcnggsSaZGgTI7+Z4MOQdqLQOHTSbJhWOCtzHgOlQwfpbIf++zCi6xgDga6ZnyhYg/A1CQ0OVt+eHugidEwtvM576HhPRnoQWoNKkc523q9rvx1jWbXU+Id6Bx218DqafP4BC9CkBjpny0G45kLv1DlY7D0t0Dtba+F1Ysx8kmyf0QG6WSiOySPOzNt3XVICfXJkI7xUjJln7BMfKYHOk2dq4XVizDyT+zDGcoE+SucgN/OxX4S0M+qpgC5Kx4jXW+i+8nDAcu2pQJjtDjpqEoK4Lzyb8KmA3vQ6yM18Bf1LZsKnBHoPW2Pm7xDn2PG/vco1/oYSgriP+Yk/oOevt6JwmDGGUb7GjLBssTV51v7atWYNhY7bXDuwn30BJ/ROnYOukFJ7vS5J9vEIvs0ryC3Qzo8V5ho2RpxTp0qLIs6jPxAVuYNO7D52mOMLAH1cnlGlRaEPEnX5KH3YCE5lzG7i0v1sEJxk0X1NAuJmX00KoC+86OIw8AEj3pmUwtfaITxbtgZldcJEnJl3ULzZ7TVTzbpXF66VW/CncAgWoaapQZyZZ/E0jl1K4TfoeflQluDHOIRdzXQgzsyrtmMIwqcw9YxD5yGibMG7OEzpB2CitCjSOHcHNggO1RwE7zJNvSDi06IxJ2BT7OPnzjT1BIhPi6rz4TDhmcmEjw2i1KQEcSVXS6HmZ5E09j7w4XOxYk06ok6mImTWOOpXUT4aP97Sw6nfikLDheeU/xNnjR8/U24Qt39notKiGDeCdgw7krdP3Evd/oxDPtY0BYh37KLz4Rh/nd8K76du72mPcUne8k36n4y6ecQLv8I4s2xLESBYw+5LkHSbSFOCNM5VVJUr0pv7LY1Ae5/8IvAzY4dYbRFoalBIPjzRfWwpIwgvgnhHRCWANPnwFMLH1N5taSIgfGGpFJAmZJrkCBOCCZWso1uaGAhC3VQSiIvRHxAXQpy5F571Q17ELRUABP4RlQTSpUUdEmWYEJwn13MNtgRrKgQIwtzZI3KXQAhmcNQuRV16skpXPFS38v01fnxomyoWQXt/8z2ajfSFEItvPgRB3INKBuny4Q4L70ohEV3aPDAr3nyuKCQrYqn8YOHtnPpcQNo4uVvirMdSzHsXpE+QLGrWL1J0Bulr1BwWMuuxlDX9GL/GcyECFwE0lIaKwlr/einiLxaMUwjhMHW9eARYqnk/BuMUQjjMsGHB1YjOIBRCjFGLvsGMTP5Vic4gvh0J5i4+rk30A0iTlz/HBgWLj2sVnUHY1jmMxwYFfkEC1yw6g+G58Bh497CiQsC1i34A41W7dnEowPTDRH8AeWb9gR0m6hcDE/0UjOvh98Hn4/kFyJLLh4l+HoRaMoe87DCyBcBca+Rygbwm/5hux6hkVgCCF5muGUwr/oHDS8CWQBX+RehhN5jiCiOnAGHfzTXzJcTcudiSj2JzG9Gm/f3XvuPZCJaC6wJEnTpM9A4I+25+iBWVybcXgMLLUNFpz9lBmOg9tDN/TaFxwOIw0Z+gFX9Fuu/AF4uJPgCErdaapmkZkpq3JrqQdt3nMUfT3xD37CFDxUxnv/hDCsYZ8NAwqORukmsyxgHTdIy6xJqMPCBfx6hzsOWZpjescX8Sl+PtXNL1CePDL1pvhNEcuYlACKHetaOm4Aw+o3gaP/72Dtv23A/8D/kf7Op9uCbAAAAAAElFTkSuQmCC",S6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHUAAAByCAYAAABtAZ4EAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANgSURBVHgB7d3BcdpAFIDhh5NDbnEHIRXEJcgVxKkgdGCnA6ggpoLYHZAKIBVAKjA55kYHytthSeQYASvtLtKb/5tZY4PwMPyzK4QOEoE5A4mkLMuhIJbNYDDYSEONomrAS70p/PioYyhIYeXHd408O/VJQVF9zFsddzouBTm5mevCTjTw+tCGJ0UlZueMNeyk7sGjUf2+ci4ssV2z1nG9b9ZeHHqWBr3Sm6UQtIuGOua+0TO1M9Vv7GYoy223uX2tm7Gr3R17o7Lk9s5aKktxXVS35F4J+mShUa/dLy/2qRp0JATto0LbuaOTlzNVH3gSlt2+cvvX96+q9/hZOhL01Rsdv5/N1Aj70l+CGN5Jc4u/v7lPvGUzTzoK/60TInGrpn9vg1X/yU0ZbknMdNx769/jINVPv4WEWev41OYUEQ7z7607TAl6j6tRhxJmcexsAdrzYachz6lGfSthHgW5rEI2vhD0QePlF0YQ1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqAYR1SCiGkRUg4hqEFENIqpBRDWIqP0wDNmYqP3wOWRjonZcub3OeBHyHKJ2mA/6VQK9ljPwF9K9EdRxlxD/IIEz1Ntkjaoxh3rzTZq9WJxmli2qDzqX8IvvIswkyz5Vg7rlZCkETe3BXX06eVQf1M1QLkif3sT9SBqVoFl92V0jPllUgmY11aD3uz+SRCVoVo8a9K56R/SoGrQQgubiZujo/zujRtWg7jtKgqa3ke0+9G7fg9GOU33QB0FKLuZUx70G3dRtFCUqQZP7qWMmR2LutI4aKehKti8c/6z9mJ0SsqpV1IhBr0NfOOq1iXor7c+0EDSBNp9+2wb9IQRN4lwnyd0Bc0HQNM4R9XHfATPiyR2VoBnkjErQTHJFJWhGOaJOCZpX6qiTui+dkU7KqC7oWJBdqqgEPaMUUQl6ZrGjErQDYkYlaNfoabR52dxY0D0too4F3aRx7stwY0F3aaCiDDMWdF95+hLMt0R9obEudSyPBB0JOu0PREHkE4mZEvgAAAAASUVORK5CYII=",A6=({selectedBooking:u})=>{if(!u)return Y.jsx("div",{className:"w-[300px] bg-white border-l flex items-center justify-center text-gray-400",children:"No Booking Selected"});const{setCurrentTabs:n,setSelectedClient:l,setShowCall:m}=Xa(),[w,C]=st.useState("Loading address..."),{Client:D,level:s,status:G,price:q,dateSchedule:te,location:ce,tier:we}=u,ze=zy();st.useEffect(()=>{(async()=>{try{const Qe=ce?.[0].location,xt=Qe?.latitude,wt=Qe?.longitude;if(!xt||!wt)return C("Unknown location");const Ai=(await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${wt},${xt}.json?access_token=${wC}`)).json()).features?.[0]?.place_name||"Address not found";C(Ai)}catch(Qe){console.error(Qe),C("Address unavailable")}})()},[ce,wC]);const at=async Ge=>{try{const Qe=lo(ze,"bookings",Ge);await df(Qe,{status:"accepted"}),console.log(" Booking status updated successfully!")}catch(Qe){console.error(" Error updating booking status:",Qe)}};return Y.jsxs("div",{className:"w-[300px] bg-[#FFF4CF] border-lflex flex-col text-center",children:[Y.jsx("h2",{className:"text-sm font-bold text-gray-600   p-5 ",children:"Client"}),Y.jsxs("div",{className:"flex items-center gap-3 mb-3  p-5  text-left bg-white",children:[Y.jsx("img",{src:D?.photoURL||"/placeholder.png",alt:"",className:"w-12 h-12 rounded-full object-cover"}),Y.jsxs("div",{children:[Y.jsx("p",{className:"font-semibold",children:D?.fullname}),Y.jsx("p",{className:"text-xs text-gray-600",children:D?.phoneNumber})]})]}),Y.jsxs("div",{className:"w-[300px] bg-[#FFF4CF] border-lflex flex-col text-center",children:[Y.jsx("p",{className:"text-sm font-bold text-gray-600 mb-1",children:"Tier Availed"}),Y.jsx("p",{className:"text-yellow-600 font-bold text-sm mb-3 p-3 rounded-xl bg-white mx-5 flex items-center justify-center",children:Y.jsx("img",{src:tf.find(Ge=>Ge.level==we)?.Image,className:"w-10"})}),Y.jsx("p",{className:"text-sm font-bold text-gray-600 mb-1",children:"Status"}),Y.jsx("p",{className:"text-sm mb-3 p-3 rounded-xl bg-white mx-5",children:G}),Y.jsx("p",{className:"text-sm font-bold text-gray-600 mb-1",children:"Location"}),Y.jsx("p",{className:"text-sm mb-3 p-3 rounded-xl bg-white mx-5",children:w}),Y.jsx("p",{className:"text-sm font-bold text-gray-600 mb-1",children:"Schedule"}),Y.jsx("p",{className:"text-sm mb-3 p-3 rounded-xl bg-white mx-5",children:te?new Date(te.toDate()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"N/A"}),Y.jsx("p",{className:"text-sm font-bold text-gray-600 mb-1",children:"Price"}),Y.jsxs("p",{className:"text-sm mb-3   text-gray-800 p-3 rounded-xl bg-white mx-5",children:["",q?.toLocaleString()]}),Y.jsxs("div",{className:"flex space-x-2 items-center flex-1 justify-center",children:[Y.jsx("button",{onClick:()=>{n("chat"),m(!0),l({otherUser:u.Client,lastMessage:"",lastMessageTime:new Date})},className:"p-2 bg-[#EDB03B] rounded-xl w-12 ",children:Y.jsx("img",{src:E6})}),Y.jsx("button",{onClick:()=>{n("chat"),l({otherUser:u.Client,lastMessage:"",lastMessageTime:new Date})},className:"p-2 bg-[#EDB03B] rounded-xl w-12 ",children:Y.jsx("img",{src:S6})})]}),Y.jsx("div",{className:"flex space-x-2 items-center flex-1 justify-center",children:G=="pending"&&Y.jsx("button",{onClick:()=>u.id&&at(u.id),className:"w-full mt-6 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-full transition",children:" Accept"})})]})]})},I6=({bookings:u})=>{const{activeTab:n,setActiveTab:l}=Xa(),[m,w]=st.useState(null),[C,D]=st.useState(""),[s,G]=st.useState(null),q={Request:"pending",Scheduled:"accepted","On Going":"active",Completed:"complete",Canceled:"cancel"},te=st.useMemo(()=>{if(!u)return[];const at=q[n]||"pending";return u.filter(Qe=>{if(Qe.status!==at)return!1;const xt=Qe.dateSchedule?.toDate(),wt=s;return xt&&wt&&xt.getFullYear()===wt.getFullYear()&&xt.getMonth()===wt.getMonth()&&xt.getDate()===wt.getDate()})},[n,u,s]),ce=zy(),we=async at=>{const Ge=new Date;for(const Qe of at)if(Qe.dateSchedule.toDate()<=Ge&&Qe.status!=="active")try{const wt=lo(ce,"bookings",Qe.id);await df(wt,{status:"active"}),console.log(` Booking ${Qe.id} updated to active`)}catch(wt){console.error(` Error updating booking ${Qe.id}:`,wt)}},ze=st.useMemo(()=>{if(!u)return[];const at=q[n]||"pending";return we(u),u.filter(Qe=>Qe.status===at)},[n,u]);return Y.jsxs("div",{className:"flex max-h-screen w-full bg-gray-50 font-inter",children:[Y.jsxs("div",{className:"flex flex-col flex-1",children:[Y.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-white",children:[Y.jsx("h1",{className:"text-xl font-semibold",children:"My Bookings"}),Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("input",{type:"text",placeholder:"Search Client",value:C,onChange:at=>D(at.target.value),className:"rounded-full border border-gray-300 px-4 py-2 text-sm focus:outline-none"}),Y.jsx("button",{className:"p-2 rounded-full bg-yellow-400 text-white hover:bg-yellow-500",children:""})]})]}),Y.jsx(uj,{activeTab:n,setActiveTab:l,bookings:u}),Y.jsxs("div",{className:"flex-1 flex flex-col",children:[Y.jsxs("div",{className:"flex-1 flex",children:[Y.jsx("div",{className:"flex-1 flex",children:Y.jsx(b6,{setSelectedBooking:w,setSelectedDate:G,selectedDate:s,bookings:ze,onSelectBooking:w,selectedBooking:m})}),Y.jsx("div",{className:"flex-1 flex",children:Y.jsx(T6,{selectedBooking:m})})]}),te&&Y.jsx(w6,{bookings:te,setSelectedBooking:w,selectedBooking:m})]})]}),Y.jsx(A6,{selectedBooking:m})]})},C6=({selectedClient:u,setSelectedClient:n})=>{const[l,m]=st.useState([]),[w,C]=st.useState(!0),D=zy(),s=Ax();return st.useEffect(()=>{const G=l.find(q=>q.otherUser?.uid==u?.otherUser?.uid);u!=G&&G&&n(G)},[u,l]),st.useEffect(()=>{const G=s.currentUser;if(!G)return;const q=lp(sc(D,"chats"),Ug("photographerID","==",G.uid));return cp(q,async ce=>{const we=[];console.log(ce.size);for(const ze of ce.docs){const at=ze.data(),Ge=ze.id,Qe=at.clientID===G.uid?at.photographerID:at.clientID,xt=lo(D,"users",Qe),wt=await hf(xt),jt=lp(sc(D,"chats",Ge,"messages"),Lb("createdAt","desc"),TT(1)),wi=await _x(jt);let Ai="",vi=null;if(!wi.empty){const Ve=wi.docs[0].data();Ai=Ve.text,Ve.createdAt&&Ve.createdAt.toDate&&(vi=Ve.createdAt.toDate())}we.push({...at,otherUser:wt.exists()?wt.data():void 0,lastMessage:Ai,lastMessageTime:vi})}we.sort((ze,at)=>(at.lastMessageTime?.getTime()||0)-(ze.lastMessageTime?.getTime()||0)),m(we),C(!1)})},[]),w?Y.jsx("div",{className:"w-[320px] flex items-center justify-center text-gray-500",children:"Loading chats..."}):Y.jsxs("div",{className:"w-[320px] bg-white border-x border-gray-300 flex flex-col",children:[Y.jsx("div",{className:"p-4 border-b border-gray-300",children:Y.jsx("input",{type:"text",placeholder:"Search Chat",className:"w-full bg-gray-100 rounded-full px-4 py-2 text-sm outline-none"})}),Y.jsx("div",{className:"flex-1 overflow-y-auto",children:l.length>0?l.map(G=>Y.jsxs("div",{onClick:()=>n(G),className:`flex items-center gap-3 p-3 cursor-pointer border-b hover:bg-yellow-50 ${u?.photographerID===G.photographerID&&u?.clientID===G.clientID?"bg-yellow-100":""}`,children:[Y.jsx("img",{src:G.otherUser?.photoURL||"/placeholder.png",alt:G.otherUser?.fullname,className:"w-10 h-10 rounded-full object-cover"}),Y.jsxs("div",{className:"flex-1",children:[Y.jsx("p",{className:"font-semibold text-gray-800",children:G.otherUser?.fullname||"Unknown User"}),Y.jsx("p",{className:"text-sm text-gray-500 truncate",children:G.lastMessage||"No messages yet"})]}),Y.jsx("p",{className:"text-xs text-gray-400",children:G.lastMessageTime?new Date(G.lastMessageTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):""})]},G.photographerID+G.clientID)):Y.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 text-sm",children:"No chats found"})})]})},R6=async(u,n,l)=>{try{const C=await Ax().currentUser?.getIdToken();if(!u){console.error(" No FCM token found");return}if(!l){console.error(" No body found");return}if(!C){console.error(" No ID token found  user not logged in?");return}const s=await(await fetch("http://34.171.48.119/send",{method:"POST",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"},body:JSON.stringify({token:u,title:n,body:l})})).text();console.log(" Raw response:",s);const G=JSON.parse(s);console.log(" Server response:",G)}catch(m){console.error(" Error sending push:",m)}},TC=20;function M6(u){const[n,l]=st.useState([]),[m,w]=st.useState(null),[C,D]=st.useState(null),[s,G]=st.useState(!1),[q,te]=st.useState(!0),[ce,we]=st.useState(""),ze=zy(),at=Ax(),Ge=st.useRef(null);st.useEffect(()=>u?cp(lo(ze,"chats",u),jt=>{jt.exists()?w(jt.data()):w(null)}):void 0,[u]);const Qe=async()=>{if(!ce.trim()||!u)return;const wt=at.currentUser;if(!wt)return;const jt=sc(ze,"chats",u,"messages");await cP(jt,{text:ce,senderId:wt.uid,createdAt:Rm()}),await df(lo(ze,"chats",u),{lastMessage:ce,lastMessageTime:Rm()});try{const wi=m?.clientID===wt.uid?m?.photographerID:m?.clientID;if(wi){const Ai=lo(ze,"users",wi),vi=await hf(Ai),Ve=vi?.data()?.fcmToken,ke=vi?.data()?.fullname||"New Message";console.log(Ve),Ve&&await R6(Ve,ke,ce)}}catch(wi){console.error("Push send error:",wi)}we("")};return st.useEffect(()=>{if(!u)return;const wt=sc(ze,"chats",u,"messages"),jt=lp(wt,Lb("createdAt","desc"),TT(TC)),wi=cp(jt,Ai=>{if(Ai.empty)l([]);else{const Ve=Ai.docs.map(ke=>{const We=ke.data();return{id:ke.id,text:We.text??"",senderId:We.senderId??"",createdAt:We.createdAt?.toDate?.()??""}}).reverse();D(Ai.docs[Ai.docs.length-1]),l(Ve)}});return Ge.current=wi,()=>wi()},[u]),{chatData:m,messages:n,text:ce,setText:we,sendMessage:Qe,loadMoreMessages:async()=>{if(!(!u||!C||!q||s)){G(!0);try{const wt=lp(sc(ze,"chats",u,"messages"),Lb("createdAt","desc"),_V(C),TT(TC)),jt=await _x(wt);if(jt.empty)te(!1);else{const wi=jt.docs.map(Ai=>{const vi=Ai.data();return{id:Ai.id,text:vi.text??"",senderId:vi.senderId??"",createdAt:vi.createdAt?.toDate?.()??""}});D(jt.docs[jt.docs.length-1]),l(Ai=>[...wi.reverse(),...Ai])}}catch(wt){console.error("Load more error:",wt)}G(!1)}},hasMore:q,loadingMore:s}}function P6(u){if(!u)return"";const n=u instanceof Ns?u.toDate():u,l=new Date,m=l.getTime()-n.getTime(),w=Math.floor(m/1e3),C=Math.floor(w/60),D=Math.floor(C/60),s=Math.floor(D/24);return w<60?"Just now":C<60?`${C}m ago`:D<24?`${D}h ago`:s===1?`Yesterday ${n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:s<7?`${n.toLocaleDateString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit"})}`:n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:n.getFullYear()!==l.getFullYear()?"numeric":void 0,hour:"numeric",minute:"2-digit"})}const D6=({selectedClient:u,onCallStart:n})=>{const l=`${u?.clientID}${u?.photographerID}`,m=u?.otherUser,{messages:w,text:C,setText:D,sendMessage:s}=M6(l),[G,q]=st.useState(null);return u?Y.jsxs("div",{className:"flex flex-col flex-1 bg-white border-r",children:[Y.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("button",{onClick:n,className:"text-yellow-500 text-xl",children:""}),Y.jsx("p",{className:"font-semibold",children:m?.fullname})]})}),Y.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:w.map((te,ce)=>{const we=te.senderId===Bc.currentUser?.uid,ze=te.createdAt?.toDate?.()??(te.createdAt instanceof Date?te.createdAt:null);return Y.jsxs("div",{onClick:()=>q(G===`${ce}`?null:`${ce}`),className:`my-2 flex flex-col ${we?"items-end":"items-start"}`,children:[Y.jsx("div",{className:`p-3 rounded-2xl max-w-[60%] cursor-pointer transition ${we?"bg-yellow-400 text-white":"bg-gray-200 text-gray-800"}`,children:te.text}),G===`${ce}`&&ze&&Y.jsx("p",{className:"text-xs text-gray-500 mt-1",children:P6(ze)})]},ce)})}),Y.jsxs("div",{className:"flex items-center border-t p-3",children:[Y.jsx("input",{value:C,onChange:te=>D(te.target.value),placeholder:"Type a message...",className:"flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm outline-none"}),Y.jsx("button",{onClick:s,className:"ml-2 bg-yellow-400 text-white rounded-full px-4 py-2 font-semibold hover:bg-yellow-500",children:"Send"})]})]}):Y.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:"Select a chat to start messaging."})},O6=({selectedClient:u,setUploading:n})=>{if(!u)return Y.jsx("div",{className:"w-[300px] bg-yellow-50 border-l flex items-center justify-center text-gray-400",children:"No Client Selected"});const{otherUser:l,price:m,level:w}=u;return Y.jsxs("div",{className:"w-[300px] bg-[#FFF4CF] border-l p-5 flex flex-col",children:[Y.jsxs("div",{className:"flex flex-col items-center",children:[l?.photoURL?Y.jsx("img",{src:l?.photoURL,alt:l?.fullname,className:"w-24 h-24 rounded-full object-cover"}):Y.jsx("img",{src:Mm,alt:Mm,className:"w-24 h-24 rounded-full object-cover"}),Y.jsx("p",{className:"mt-3 font-semibold text-gray-800",children:l?.fullname}),Y.jsx("p",{className:"text-gray-500 text-sm",children:l?.phoneNumber})]}),Y.jsxs("div",{className:"mt-5 space-y-2 text-center",children:[Y.jsxs("div",{children:[Y.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Tier Availed"}),Y.jsx("p",{className:"text-yellow-600 text-sm",children:w?.name||"Mid Photographer"})]}),Y.jsxs("div",{className:"",children:[Y.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Status"}),Y.jsx("p",{className:"text-sm  p-3 rounded-xl font-bold bg-[#FFFFFF]  text-[#B56600]",children:"Ongoing Session"})]}),Y.jsxs("div",{children:[Y.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Location"}),Y.jsx("p",{className:"text-sm  p-3 rounded-xl font-light bg-[#FFFFFF] text-gray-700",children:"78 Rizal Blvd, Cebu City"})]}),Y.jsxs("div",{children:[Y.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Schedule"}),Y.jsx("p",{className:"text-sm  p-3 rounded-xl font-light bg-[#FFFFFF] text-gray-700",children:"September 1, 10:20 pm"})]}),Y.jsxs("div",{children:[Y.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Price"}),Y.jsxs("p",{className:"text-lg p-3 rounded-xl font-light bg-[#FFFFFF] text-gray-700",children:["",m?.toLocaleString()||"2,000"]})]})]}),Y.jsxs("div",{className:"mt-auto",children:[Y.jsxs("div",{className:"relative bg-white p-2 rounded-2xl mx-5 text-center text-[#D68501] font-bold",children:[Y.jsx("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 bg-[#D68501] pt-1 text-center h-8 w-8 rounded-full text-white",children:"!"}),"Pending Photos"]}),Y.jsx("button",{onClick:()=>{n(!0)},className:"w-full bg-yellow-500 text-white rounded-full py-2 mt-4 font-semibold hover:bg-yellow-600",children:"Upload Photos"})]})]})};async function L6(u,n){const l=lo($s,"rooms",u),m=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});n.getTracks().forEach(te=>m.addTrack(te,n));const w=new MediaStream;m.ontrack=te=>{te.streams[0].getTracks().forEach(ce=>w.addTrack(ce))};const C=sc($s,`rooms/${u}/calleeCandidates`),D=sc($s,`rooms/${u}/callerCandidates`);m.onicecandidate=async te=>{te.candidate&&await cP(C,te.candidate.toJSON())},cp(D,te=>{te.docChanges().forEach(ce=>{if(ce.type==="added"){const we=new RTCIceCandidate(ce.doc.data());m.addIceCandidate(we)}})});const G=(await hf(l)).data();if(!G?.offer)throw new Error("No offer found");await m.setRemoteDescription(new RTCSessionDescription(G.offer));const q=await m.createAnswer();return await m.setLocalDescription(q),await df(l,{answer:{type:q.type,sdp:q.sdp},status:"ongoing"}),{pc:m,remoteStream:w}}async function z6({callId:u,pc:n,localStream:l}){try{console.log(" Ending call..."),l&&l.getTracks().forEach(s=>s.stop()),n&&(n.ontrack=null,n.onicecandidate=null,n.onconnectionstatechange=null,n.close());const m=lo($s,"rooms",u);await df(m,{status:"ended"});const w=await _x(sc($s,`rooms/${u}/callerCandidates`)),C=await _x(sc($s,`rooms/${u}/calleeCandidates`)),D=[...w.docs.map(s=>zb(s.ref)),...C.docs.map(s=>zb(s.ref))];await Promise.all(D),console.log(" Call ended and cleaned up.")}catch(m){console.error(" Error ending call:",m)}}async function k6(u){try{console.log(" Declining and deleting call:",u);const n=lo($s,"rooms",u),l=["callerCandidates","calleeCandidates"];for(const m of l){const w=sc($s,`rooms/${u}/${m}`),D=(await _x(w)).docs.map(s=>zb(s.ref));await Promise.all(D)}await zb(n),console.log(" Call declined and fully deleted from Firestore.")}catch(n){console.error(" Error declining call:",n)}}const N6=({client:u,onClose:n,onEnd:l})=>{const[m,w]=st.useState(0),C=st.useRef(null),D=st.useRef(null),[s,G]=st.useState(null),[q,te]=st.useState(null);st.useEffect(()=>{if(u?.status!=="ongoing")return;const Qe=setInterval(()=>w(xt=>xt+1),1e3);return()=>clearInterval(Qe)},[u?.status]);const ce=async()=>{const Qe=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),{pc:xt,remoteStream:wt}=await L6(u.id,Qe);C.current&&(C.current.srcObject=Qe),D.current&&(D.current.srcObject=wt)},we=async()=>{q?.close(),s?.getTracks().forEach(Qe=>Qe.stop()),u?.id&&await z6({callId:u?.id,pc:q,localStream:s}),l?.()},ze=async()=>{u?.id&&(await k6(u.id),n())},at=Qe=>`${Math.floor(Qe/60).toString().padStart(2,"0")}:${(Qe%60).toString().padStart(2,"0")}`,Ge=()=>{if(!u)return null;switch(u.status){case"calling":return Y.jsxs(Y.Fragment,{children:[Y.jsxs("p",{className:"text-gray-300 text-sm mb-8",children:["Incoming ",u.method," Call..."]}),Y.jsxs("div",{className:"flex gap-8",children:[Y.jsx("button",{onClick:ce,className:"bg-green-500 hover:bg-green-600 text-white rounded-full p-6 text-2xl shadow-lg",children:""}),Y.jsx("button",{onClick:ze,className:"bg-red-600 hover:bg-red-700 text-white rounded-full p-6 text-2xl shadow-lg",children:""})]})]});case"ongoing":return Y.jsxs(Y.Fragment,{children:[Y.jsx("p",{className:"text-gray-300 text-sm mt-1",children:at(m)}),Y.jsxs("div",{className:"flex gap-6 mt-8",children:[Y.jsx("button",{onClick:we,className:"bg-red-600 text-white rounded-full p-5 text-xl shadow-md",children:""}),Y.jsx("button",{className:"bg-gray-600 text-white rounded-full p-5 shadow-md",children:""}),Y.jsx("button",{className:"bg-gray-600 text-white rounded-full p-5 shadow-md",children:""})]})]});case"ended":return Y.jsxs(Y.Fragment,{children:[Y.jsx("p",{className:"text-gray-300 text-sm mb-8",children:"Call Ended"}),Y.jsx("button",{onClick:n,className:"bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg shadow-md",children:"Close"})]});default:return null}};return Y.jsxs("div",{className:"absolute inset-0 bg-black flex flex-col items-center justify-center z-50 text-center",children:[Y.jsx("button",{onClick:ze,className:"absolute top-5 left-5 text-white text-2xl",children:""}),Y.jsx("video",{ref:D,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),Y.jsx("video",{ref:C,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute bottom-6 right-6 w-32 h-40 rounded-lg border-2 border-yellow-400 object-cover shadow-lg"}),Y.jsxs("div",{className:"relative z-10 mt-auto mb-10",children:[u?.target?.photoURL&&u.status==="calling"&&Y.jsx("img",{src:u.target.photoURL,alt:u.target.fullname,className:"w-28 h-28 rounded-full object-cover mb-4 border-4 border-yellow-400"}),Y.jsx("p",{className:"text-white text-lg font-semibold",children:u?.target?.fullname}),Ge()]})]})},F6="/assets/image-upload-aecHhufd.png",B6=()=>{const{selectedClient:u,setSelectedClient:n,setShowCall:l}=Xa(),m=st.useRef(null),[w,C]=st.useState(!1),D=G=>{C(G)},s=()=>{m.current?.click()};return Y.jsxs("div",{className:"flex w-full h-screen bg-gray-50",children:[Y.jsx(C6,{selectedClient:u,setSelectedClient:n}),Y.jsx(D6,{selectedClient:u,onCallStart:()=>l(!0)}),Y.jsx(O6,{selectedClient:u,setUploading:D}),Y.jsx("div",{onClick:G=>{D(!1),G.stopPropagation()},className:`${w?"flex":"hidden"} items-center justify-center fixed w-full h-full bg-gray-900/50 left-0 top-0 p-5 z-30`,children:Y.jsxs("div",{onClick:G=>{G.stopPropagation()},className:"flex flex-col bg-white p-5 rounded-xl w-[60%]",children:[Y.jsxs("div",{className:"flex flex-row",children:[Y.jsx("span",{className:"flex-1",children:"Client"}),Y.jsx("span",{children:"x"})]}),Y.jsxs("div",{className:" flex flex-row items-center justify-center",children:[Y.jsx("div",{className:" p-5",children:Y.jsx("img",{src:u?.otherUser?.photoURL||Mm,className:"rounded-full h-20 w-20 z-40"})}),Y.jsxs("div",{className:"flex-1 ",children:[Y.jsx("p",{className:"font-bold",children:u?.otherUser?.fullname||"No Name"}),Y.jsx("p",{className:"",children:u?.otherUser?.phoneNumber||"No Number"})]})]}),Y.jsx("div",{className:"flex-1 flex-col",children:Y.jsxs("div",{className:"flex-1 ",children:[Y.jsx("p",{className:"font-bold",children:"Tier Availed"}),Y.jsx("p",{className:"text-[#B56600]",children:"Mid Photographer"})]})}),Y.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[Y.jsxs("div",{className:"flex-1 ",children:[Y.jsx("p",{className:"font-bold text-center",children:"No Available Photos"}),Y.jsxs("div",{onClick:s,onDragEnd:()=>{},className:"flex bg-[#F0F0F0] m-5 flex-col items-center justify-center border-dashed border-2 p-10 rounded-xl border-[#EDB03B]",children:[Y.jsx("img",{src:F6,className:"w-20 h-20"}),Y.jsx("p",{children:"Drag and drop image or browse device"}),Y.jsx("button",{className:"bg-[#1E1E1E] text-white py-2 px-8 mt-3 rounded-xl",children:"Upload Image"})]})]}),Y.jsx("input",{type:"file",className:"hidden",ref:m,accept:"image/png, image/jpeg"}),Y.jsx("button",{className:"bg-[#F7AA01] text-white py-2 px-8 mt-3 rounded-full",children:"Upload Photos"})]})]})})]})},V6="/assets/bell-DGv88CJ5.png",U6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHoAAABbCAYAAAC8qZF3AAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOBSURBVHgB7d1LUlNBFMbx73SBOJMdiEMCJbCDsAJZAqzAMFSgklu8huAKCCuQHQArAC0kM80SMsMEqo/dt4qHkLodJ+Ym5/tVoUnoMPnXvf0YJIIBXO1iUeBWBLoggkVVzICGpRN+2vFHvJ7gDuezWf68kBT9srWNKpzUFeF/Ki2BNNHzWVHwvqEv6piempIjKFZAI0Mh2dyGb/T73YvQrX3MqMopeHseSSF2s9fz60tZfot/4J4+YeTRF9ZRq1Ov5Ovz1x9CM/JYqV7vuYOnLzxe0d7VGXmMqNa+bz+usfI5Oq6u1YWrmcZK2C11ej19F+frifyVsIUa7J16Fu4BjW4X355P9vR/XIQpdtKj6kSSd+BwFU+/nsTH8DCTfG728qv4z6Nz53Xt/RZOQKXxYwd1EWkkhp1VNnTZiceHxECEE5gaI5fP3CYyiB4mhlV/7uCtC/uuwkMRhTZnt3AMKqUwjWZA8TTa1XCrV0nc5wVNUGnlayXRZtGY0HjRpSb0uPAClZrX4kaimHZI4Op6PCRD03hgaCMY2giGNoKhjWBoIxjaCIY2gqGNYGgjGNoIhjaCoY1gaCMY2giGNmIiNeB6VxQ08nhFG8HQRjC0EQxtBEMbwdBGMLQRyX10ZUMFVGpXu1h1kKOiMbyijWBoIxjaCIY2gqGNYGgjGNoIhjaCoY1gaCMY2giGNoKhjWBoIxjaCIY2gqGNYGgjGNoIhjaCoY1gaCMY2giGNoKhjWBoIxjaCIY2gqGNYGgjGNoIhjaCoY1gaCMY2giGNoKhjYihC782OH5tPKjUJoA3qTEOUhz6t2AFVGoKKW4kaDtRPUv8kVVQabX2MaNAtWiMAJcu/pMYtHi95w5ApZNHVjlNjbu5xbm76eEYiXkaqrXWrjtq1TEDKoXWNqp5ZE010ZOlDJ384x+v93AAlRrS2gI5A/w5aChCsDdxTk7drh/foNXKZ5znoS/CLWDKy0V4OA0aH2H9VdnEcnyY76OXPqHtVTPQOOl0b7F2/+ThwGR+E4de5Bg0JrQR5ub2/bO/TsZuuz7O05egkaaqjcoGvjx9re9ncf/D4ozKpeO91ua38OLO3PesO6zS1j10LZ6ogEZDWHh1e7rUL3KU/HT9/NPdRerp/RoNRTzZdGjELVTRsIG/RiFuwSY9qk6xoMpt2DCF48x2PNGMJ17xMGSQ9/wBAO8NkvQLAAsAAAAASUVORK5CYII=",j6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIqSURBVHgB7d09ctNAGIfxd5WMa98Ad0wMRbgBOQG5AUfAdAwk43gg0HIDyAngCOEEOAWmAx/BbVToZaXBiePYXn38uzy/GVteSdUz+nKzCrbm59j6vV42CuYv4nAQP33DqmmwMLWiuDg4tcv1jWF1MPuYjcx9bESsJYb9ankxOZjY/Hbdf7/Os7N4VI4NTc1D7kfLqFn5RcxOBt4LX5aD8PtTXFGEv4ZOCvfXT0/sc+ZurwydZSG8rJbm4blB4fDPB3tUXkMPDRJ5bLmf2mn4zoOhMju3b/G2c7xte7x89jNDbfHIWqT2IagYQcUIKkZQMYKKEVSMoGIEFSOoGEHFCCpGUDGCihFUjKBiBBUjqBhBxQgqRlAxgooRVIygYgQVI6gYQcUIKkZQMYKKEVSMoGIEFSOoGEHFCCpGUDGCihFUjKBiBBUjqBhBxQgqRlAxgooRVIygYgQVS87osMnsvR2H7CFOlhUGqT0aBy3neDLzsRvW+Z7NG53yTJi12/W1XdUOSswE98tnE1vUCkrMtL19G5XLZFBiprn72eM3dlX+TgYl5m5lzCcnNlmOWz02obIIhY+Gp3axurJz0Pj4NLXCp/ZAhGCLeF5/H761H5u2dwpaxsxzPyrvboZK67+exNysVVBibtc4KDF3axSUmGm1gxKznlpBiVlfMigxm9kZlJjNbQ1KzHY2BiVme/eCErObO0GJ2d1NUGJqVEGJqZMRU6x8ZZpB5h/CItcR/SF3vwAAAABJRU5ErkJggg==",G6="/assets/box-Ck4110Sy.png";function q6(){const{userData:u}=Xa(),n=[{url:j6,text:"Support",href:"/"},{url:V6,text:"Notifications",href:"/"},{url:U6,text:"Non-cash payment",href:"/"},{url:G6,text:"Promo codes",href:"/"}],l=[{text:"Partner offers",href:"/"},{text:"Share this app",href:"/"},{text:"About",href:"/"},{text:"Terms and Conditions",href:"/"},{text:"App Version 1.0",href:"/"},{text:"Delete Account",href:"/"}],m=GE;return Y.jsxs("div",{className:"flex flex-row items-center h-full text-gray-600 ",children:[Y.jsxs("div",{className:"flex flex-col flex-1 h-full text-gray-600 p-5",children:[Y.jsx("div",{className:"flex-row flex w-full",children:Y.jsx("input",{type:"text",placeholder:"Search",className:"flex-1 p-3 mt-5 bg-[#F6F6F6] rounded-full"})}),Y.jsxs("div",{className:"flex flex-row w-full px-15 pt-15 ",children:[Y.jsxs("div",{className:"flex-1 flex flex-col justify-center  ",children:[Y.jsx("img",{src:u?.photoURL,className:"rounded-full w-50 h-50"}),Y.jsx("button",{className:"m-5 bg-[#EDB03B] rounded-full p-2 text-white",children:"Edit Details"})]}),Y.jsxs("div",{className:"flex-3 flex flex-col",children:[Y.jsxs("div",{className:"flex-1 flex flex-col  px-5  ",children:[Y.jsx("p",{className:"font-bold text-xl capitalize  ",children:u?.fullname}),Y.jsx("p",{className:"font-light text-xl capitalize ",children:u?.phoneNumber}),Y.jsx("div",{className:"flex space-x-4 ",children:tf.map((w,C)=>u?.portfolio?.level?.find(s=>s==w.level)&&Y.jsx("img",{src:w.Image,className:"h-10"},C))}),Y.jsx("p",{children:u?.portfolio?.bio||"Photographers Bio"})]}),Y.jsx("div",{className:"block",children:Y.jsxs("div",{className:"px-5 m-5 p-2 bg-[#F6F6F6] rounded-full w-70 text-center flex",children:[Y.jsx("p",{className:"",children:" Price Range: "}),Y.jsxs("p",{className:"font-bold",children:[" ",`${u?.portfolio?.priceMin?.toFixed(2)}-${u?.portfolio?.priceMax?.toFixed(2)}`]})]})})]})]}),Y.jsxs("div",{className:"flex flex-1 flex-col",children:[Y.jsx("button",{className:"bg-[#EDB03B] p-3 rounded-full text-white text-xl",children:"Add Photo"}),Y.jsx("div",{className:"grid grid-cols-3 py-5",children:u?.portfolio?.images?.map((w,C)=>Y.jsx("img",{src:w.url},C))})]})]}),Y.jsx("div",{className:"flex flex-col bg-[#FFF4CF] items-center h-full text-gray-600 ",children:Y.jsxs("div",{className:"flex-col flex w-full",children:[Y.jsx("div",{className:"flex flex-row-reverse",children:Y.jsx("img",{src:UE,className:" w-40 h-40"})}),Y.jsxs("div",{className:"flex-col px-10 text-[#000000] font-bold ",children:[Y.jsx("h3",{className:"text-2xl",children:"Settings"}),n.map((w,C)=>Y.jsxs("a",{href:w.href,className:"grid grid-cols-4 p-1",children:[Y.jsx("img",{className:" items-center h-5",src:w.url}),Y.jsx("p",{className:" items-center col-span-3",children:w.text})]},C)),Y.jsx("div",{className:"my-5 border-b-2 border-[#D68501]"}),l.map((w,C)=>Y.jsx("a",{className:"grid grid-cols-4 items-center p-1",children:Y.jsx("p",{className:" items-center col-span-3",children:w.text})},C))]}),Y.jsx("button",{onClick:()=>m(),className:"bg-[#363521] my-5  w-50 p-2 rounded-full mx-auto text-[#f5f5f5]",children:"Log out"})]})})]})}const H6=(u,n)=>{const l=sc($s,"rooms"),m=lp(l,mV(Ug("ownerID","==",u),Ug("targetID","==",u)));return cp(m,async C=>{const D=C.docs.map(async G=>{const q=G.data(),te=G.id;let ce;if(q.targetID){const ze=lo($s,"users",q.targetID),at=await hf(ze);at.exists()&&(ce=at.data())}let we;if(q.ownerID){const ze=lo($s,"users",q.ownerID),at=await hf(ze);at.exists()&&(we=at.data())}return{id:te,...q,target:ce,owner:we}}),s=await Promise.all(D);n(s)})};function W6(){const[u,n]=st.useState([]);return st.useEffect(()=>{const l=Bc.currentUser?.uid;if(!l)return;const m=H6(l,w=>{n(w)});return()=>m()},[]),u}function $6({user:u,onSelect:n,selectedUser:l}){const m=async()=>{console.log(u),n(),await df(lo($s,"users",u.id),{"portfolio.reviewDate":Rm()})};return Y.jsxs("div",{onClick:m,className:`${l==u?"bg-[#979797] ":u.portfolio?.reviewDate!=null?"bg-[#FFF4CF] ":"bg-[#E1E1E1]"} flex justify-center align-middle items-center p-3 cursor-pointer border-b border-gray-200 hover:bg-gray-50 transition`,children:[Y.jsx("div",{className:"relative w-14 aspect-square px-5",children:Y.jsx("img",{src:u.photoURL||Mm,className:"absolute left-0 top-0 w-12 h-12 rounded-full object-cover"})}),Y.jsxs("div",{className:"px-2",children:[Y.jsx("p",{className:`${u.portfolio?.reviewDate!=null?"":"font-semibold"}`,children:u.fullname}),Y.jsx("p",{className:`${u.portfolio?.reviewDate!=null?"":"font-semibold"} text-xs text-[#B08930]`,children:u.portfolio?.approvedDate!=null?"Application Approved":u.portfolio?.declinedDate!=null?"Application Declined":"Pending Application Sent"})]})]})}function Z6({applicants:u,onSelect:n,selectedUser:l}){const m=u.sort();return Y.jsxs("div",{children:[Y.jsx("h2",{style:{padding:"16px",fontWeight:"bold"},children:"Applications"}),Y.jsx("div",{className:"flex flex-col",children:m.map(w=>Y.jsx($6,{user:w,onSelect:()=>n(w),selectedUser:l},w.id))})]})}async function X6(u,n,l,m){const C=await(await fetch("undefined/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:u,subject:n,text:l,html:m})})).json();console.log(C)}function Y6({user:u}){const{userData:n}=Xa(),l=async(s="Approved")=>{s=="Approved"?await df(lo($s,"users",u.id),{"portfolio.approvedDate":Rm(),userType:"Photographer",approvedBy:n?.id}):await df(lo($s,"users",u.id),{"portfolio.declinedDate":Rm(),"portfolio.reason":C,declinedBy:n?.id}),X6(u.email,`Your Application is ${s}`,"",`Hello ${u.fullname}, Your Application is ${s} by ${n?.fullname}. 
 ${s=="Approved"&&"You have now a Photographer Access.   "}`),w(!1)},[m,w]=st.useState(!1),[C,D]=st.useState(u.portfolio?.reason);return st.useEffect(()=>{w(!1)},[u]),Y.jsxs("div",{className:"p-5",children:[Y.jsxs("div",{style:{display:"flex",gap:"10px"},children:[Y.jsx("button",{className:" p-4  text-white flex-1 bg-[#EDB03B] rounded-full font-bold ",onClick:()=>l("Approved"),children:"Accept"}),Y.jsx("button",{className:" p-4 text-white flex-1 bg-[#3F3F46] rounded-full font-bold ",onClick:()=>{w(!m)},children:m?"Cancel":"Decline"})]}),m&&Y.jsxs("div",{className:" flex flex-col",children:[Y.jsx("input",{type:"text",value:C,onChange:s=>D(s.target.value),placeholder:"Enter Reason for Decline",className:"p-5 my-5"}),Y.jsx("button",{className:" p-4 text-white flex-1 bg-[#3F3F46] rounded-full font-bold ",onClick:()=>{l("Declined")},children:"Confirm"})]})]})}function K6({user:u}){const n=u.portfolio;return Y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[Y.jsx("h2",{style:{fontSize:"22px",fontWeight:"700"},children:u.fullname}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Short Bio Description"}),Y.jsx("div",{style:Qd.box,children:n.bio??"No Bio Provided"})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Photography Expertise"}),Y.jsx("div",{style:Qd.tagContainer,children:n.expertise?n.expertise.map(l=>Y.jsx("span",{style:Qd.tag,children:l},l)):Y.jsx("p",{children:"No Expertise Selected"})})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Photography Tier"}),Y.jsx("div",{style:Qd.tagContainer,children:n?.level?.length>0?tf.map(l=>n?.level?.includes(l.level)&&Y.jsx("span",{style:Qd.tag,children:l.level},l.level)):Y.jsx("p",{children:"No Tier Selected"})})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Equipment Details"}),Y.jsx("div",{style:Qd.box,children:n.equipments||"No Equipmentsc"})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Price Range"}),Y.jsxs("div",{style:Qd.box,children:["",n.priceMin," - ",n.priceMax]})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Portfolio Link"}),Y.jsx("div",{style:Qd.box,children:n.linkPortfolio?Y.jsx("a",{href:n.linkPortfolio,className:"hover:underline hover:text-blue-500",children:n.linkPortfolio}):"No URL Provided"})]}),Y.jsxs("div",{children:[Y.jsx("label",{children:"Best 5 photos"}),Y.jsx("div",{style:Qd.photoContainer,children:n.images?.map(l=>Y.jsx("img",{src:l.url,style:Qd.photo},l.url))})]}),!u.portfolio?.approvedDate&&!u.portfolio?.declinedDate&&Y.jsx(Y6,{user:u})]})}const Qd={box:{background:"#F2F2F2",padding:"12px",borderRadius:"10px"},tagContainer:{display:"flex",gap:"8px"},tag:{background:"#FFD570",padding:"6px 12px",borderRadius:"8px"},photoContainer:{display:"flex",gap:"8px"},photo:{width:"80px",height:"80px",objectFit:"cover",borderRadius:"10px"}};function Q6({user:u}){return Y.jsxs("div",{className:"  ",style:{textAlign:"center"},children:[Y.jsx("img",{src:u.photoURL,className:"justify-center mx-auto my-5 items-center align-middle",style:EC.avatar}),Y.jsx("h3",{className:"py-2",children:u.fullname}),Y.jsx("p",{style:EC.gender,children:u.gender}),Y.jsx("p",{children:u.phoneNumber}),Y.jsx("p",{children:u.email})]})}const EC={avatar:{width:"120px",height:"120px",borderRadius:"50%",objectFit:"cover"},gender:{background:"#FFCE54",borderRadius:"6px",padding:"4px 10px",fontWeight:"600"}};function J6(){const[u,n]=st.useState([]),[l,m]=st.useState(null);return st.useEffect(()=>{const w=lp(sc($s,"users"),Ug("userType","==","Client"),Ug("portfolio.applicationDate","!=",null)),C=lp(sc($s,"users"),Ug("userType","==","Photographer")),D=cp(w,G=>{const q=G.docs.map(te=>({...te.data(),id:te.id}));n(te=>[...te.filter(ce=>ce.userType!=="Client"),...q])}),s=cp(C,G=>{const q=G.docs.map(te=>({...te.data(),id:te.id}));n(te=>[...te.filter(ce=>ce.userType!=="Photographer"),...q])});return()=>{D(),s()}},[]),Y.jsxs("div",{className:"flex h-screen",children:[Y.jsx("div",{className:"flex-1 bg-[#FAF6EC] overflow-y-scroll",children:Y.jsx(Z6,{applicants:u,onSelect:m,selectedUser:l})}),Y.jsx("div",{className:"flex-[2] p-5 overflow-y-scroll",children:l&&Y.jsx(K6,{user:l})}),Y.jsx("div",{className:"flex-1 bg-[#FFF9E6] p-5",children:l&&Y.jsx(Q6,{user:l})})]})}eh.accessToken="pk.eyJ1IjoibWF0YWRldnMiLCJhIjoiY21mNmdhc3YyMGcxdzJrb21xZm80c3NpbCJ9.R0nU8Ip_9RCo-Q2aWxAbXA";const e8=()=>{const{userData:u,location:n,nearbyBookings:l,mybookings:m,bookings:w,RushBooking:C,activeTab:D,setActiveTab:s,currentTab:G,setCurrentTabs:q,setShowCall:te,showCall:ce}=Xa(),we=hp(),ze=st.useRef(null),at=st.useRef(null),Ge=st.useRef(null),Qe=st.useRef([]),[xt,wt]=st.useState(!1),jt=W6(),[wi,Ai]=st.useState(null);return st.useEffect(()=>{if(ze.current||!n)return;const vi=new eh.Map({container:"maps",style:"mapbox://styles/mapbox/streets-v12",center:[n.lng,n.lat],zoom:13,attributionControl:!1});ze.current=vi,vi.on("load",()=>{console.log(" Map fully loaded!"),wt(!0)}),vi.addControl(new eh.NavigationControl({showCompass:!0}),"bottom-right");const Ve=new eh.Marker({color:"#f59e0b"}).setLngLat([n.lng,n.lat]).addTo(vi);return at.current=Ve,()=>{vi.remove(),ze.current=null}},[n]),st.useEffect(()=>{const vi=ze.current;!vi||!n||(at.current&&at.current.setLngLat([n.lng,n.lat]),vi.easeTo({center:[n.lng,n.lat],duration:800}))},[n]),st.useEffect(()=>{jt[0]?(q("chat"),te(!0)):te(!1)},[jt,we]),st.useEffect(()=>{const vi=ze.current;if(!vi||!xt||!C?.location||!n)return;const{longitude:Ve,latitude:ke}=C.location[0].location;if(Ve===void 0||ke===void 0)return;(async()=>{const ht=`https://api.mapbox.com/directions/v5/mapbox/driving/${n.lng},${n.lat};${Ve},${ke}?geometries=geojson&access_token=${eh.accessToken}`,_t=await(await fetch(ht)).json();if(!_t.routes?.length)return;const Ue={type:"Feature",geometry:_t.routes[0].geometry,properties:{}};vi.getSource("route")?vi.getSource("route").setData(Ue):(vi.addSource("route",{type:"geojson",data:Ue}),vi.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2563eb","line-width":5}})),Ge.current?Ge.current.setLngLat([Ve,ke]):Ge.current=new eh.Marker({color:"#CC0000"}).setLngLat([Ve,ke]).addTo(vi);const Cn=new eh.LngLatBounds;Ue.geometry.coordinates.forEach(mn=>Cn.extend(mn)),vi.fitBounds(Cn,{padding:60})})()},[C,xt]),st.useEffect(()=>{const vi=ze.current;!vi||!l||(Qe.current.forEach(Ve=>Ve.remove()),Qe.current=[],l.forEach(Ve=>{if(!Ve.location)return;const ke=new eh.Marker({color:"#f32a0b"}).setLngLat([Ve.location[0].location.longitude,Ve.location[0].location.latitude]).setPopup(new eh.Popup({offset:10}).setHTML(`
            <div class="text-sm font-medium">
               <strong>${Ve.Client?.fullname||"Unknown"}</strong><br/>
              ${Ve.price?.toLocaleString("en-PH")}<br/>
              ${Ve.distanceKm?.toFixed(2)} km away
            </div>
          `)).addTo(vi);Qe.current.push(ke)}))},[l]),Y.jsxs("div",{className:"flex h-screen overflow-hidden",children:[Y.jsxs("div",{className:"w-80 bg-white flex flex-col justify-between",children:[Y.jsxs("div",{className:"flex flex-col  p-4 mt-2",children:[Y.jsx("img",{src:u?.photoURL||"https://via.placeholder.com/120",alt:"profile",className:"rounded-full mx-auto w-32 h-32 object-cover mb-3 border-4 border-white"}),Y.jsx("h3",{className:"text-lg font-semibold py-2 capitalize",children:u?.fullname||"Photographer name"}),Y.jsx("p",{className:"text-sm opacity-80 py-2",children:u?.phoneNumber?`+63 ${u.phoneNumber.replace(/^0/,"").replace(/(\d{3})(\d{3})(\d{4})/,"$1 - $2 - $3")}`:"+63 --- --- ----"}),Y.jsxs("p",{className:"text-sm opacity-80 py-2",children:["Price Range:"," ",u?.portfolio?.priceMin?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(u.portfolio.priceMin):"0.00"," ","-"," ",u?.portfolio?.priceMax?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(u.portfolio.priceMax):"0.00"]}),Y.jsx("button",{className:"bg-amber-500 text-white font-semibold text-sm rounded-full p-2 ",children:"Edit Details"})]}),Y.jsx("div",{className:"flex flex-col bg-amber-500/80 gap-3 flex-1 px-4",children:Y.jsxs("div",{className:"flex flex-col gap-3 mt-8 px-4",children:[Y.jsxs("button",{onClick:()=>q("current"),className:`flex items-center gap-3 border border-white/60 rounded-lg py-2 px-4 hover:bg-white/10 ${G=="current"&&"bg-white"}`,children:[Y.jsx("span",{children:""})," Current"]}),Y.jsxs("button",{onClick:()=>q("bookings"),className:`flex items-center gap-3 border border-white/60 rounded-lg py-2 px-4 hover:bg-white/10 ${G=="bookings"&&"bg-white"}`,children:[Y.jsx("span",{children:""})," Bookings"]}),Y.jsxs("button",{onClick:()=>q("chat"),className:`flex items-center gap-3 border border-white/60 rounded-lg py-2 px-4 hover:bg-white/10 ${G=="chat"&&"bg-white"}`,children:[Y.jsx("span",{children:""})," Chat"]}),Y.jsxs("button",{onClick:()=>q("menu"),className:`flex items-center gap-3 border border-white/60 rounded-lg py-2 px-4 hover:bg-white/10 ${G=="menu"&&"bg-white"}`,children:[Y.jsx("span",{children:""})," Menu"]}),u?.userType=="Manager"&&Y.jsxs("button",{onClick:()=>q("Requests"),className:`flex items-center gap-3 border border-white/60 rounded-lg py-2 px-4 hover:bg-white/10 ${G=="Requests"&&"bg-white"}`,children:[Y.jsx("span",{children:""})," Requests"]})]})})]}),Y.jsxs("div",{className:"flex-1 relative",children:[n?Y.jsx("div",{id:"maps",className:"absolute inset-0 w-full h-full"}):Y.jsx(PP,{}),G==="current"&&Y.jsxs("div",{className:"absolute top-5 left-1/2 transform -translate-x-1/2 bg-white rounded-full shadow-lg px-5 py-2 flex items-center w-[60%] max-w-xl z-20",children:[Y.jsx("span",{className:"mr-3 text-expedify-gold text-lg",children:""}),Y.jsx("input",{type:"text",placeholder:"Filter Location",className:"flex-1 outline-none text-gray-700 bg-transparent"})]}),G==="current"&&Y.jsxs(Y.Fragment,{children:[C?Y.jsxs("div",{className:"absolute bottom-10 left-1/2 transform -translate-x-1/2 bg-white shadow-xl rounded-2xl px-8 py-6 flex flex-col items-center text-center w-96 z-20",children:[Y.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Ongoing Booking"}),Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("img",{src:C.Client?.photoURL||Mm,alt:"Client",className:"w-16 h-16 rounded-full object-cover"}),Y.jsx("span",{className:"text-lg font-light",children:C.Client?.fullname})]}),Y.jsx("button",{onClick:()=>{q("bookings"),s("On Going")},className:"bg-expedify-gold text-black rounded-full px-6 py-2 font-semibold hover:scale-105 transition",children:"View Detailed"})]}):l?.length?Y.jsx("div",{className:"absolute -bottom-10 left-1/2 transform -translate-x-1/2 rounded-2xl px-8 py-6 flex flex-col items-center text-center w-[65%] z-20",children:Y.jsx(lj,{mapRef:ze,setSelectedBooking:Ai,cards:[...l]})}):Y.jsxs("div",{className:"absolute bottom-10 left-1/2 transform -translate-x-1/2 bg-white shadow-xl rounded-2xl px-8 py-6 flex flex-col items-center text-center w-96 z-20",children:[Y.jsx("img",{src:Mm,alt:"Expedify mascot",className:"w-16 h-auto mb-3"}),Y.jsx("h2",{className:"text-lg font-semibold mb-2",children:"No Ongoing Booking"}),Y.jsx("button",{className:"bg-expedify-gold text-black rounded-full px-6 py-2 font-semibold hover:scale-105 transition",children:"Search Clients"})]}),wi&&Y.jsx("div",{onClick:()=>Ai(null),className:"absolute inset-0 bg-black/80 flex items-center justify-center z-30",children:Y.jsx("div",{onClick:vi=>vi.stopPropagation(),className:"flex flex-col items-center text-center",children:Y.jsx(cj,{booking:wi,MAPBOX_TOKEN:LP,onAccept:()=>Ai(null),onClose:()=>Ai(null)})})})]}),Y.jsx("div",{className:`absolute inset-0 bg-white overflow-y-auto transition-opacity duration-300 z-20 ${G==="bookings"?"opacity-100 visible":"opacity-0 invisible"}`,children:Y.jsx(I6,{bookings:w})}),Y.jsx("div",{className:`absolute inset-0 bg-white transition-opacity duration-300 z-20 ${G==="chat"?"opacity-100 visible":"opacity-0 invisible"}`,children:Y.jsx(B6,{})}),Y.jsx("div",{className:`absolute inset-0 bg-white transition-opacity duration-300 z-20 ${G==="menu"?"opacity-100 visible":"opacity-0 invisible"}`,children:Y.jsx(q6,{})}),Y.jsx("div",{className:`absolute inset-0 bg-white transition-opacity duration-300 z-20 ${G==="Requests"?"opacity-100 visible":"opacity-0 invisible"}`,children:Y.jsx(J6,{})}),ce&&Y.jsx(N6,{client:jt[0],onEnd:()=>te(!1),onClose:()=>te(!1)})]})]})},t8=(u,n,l,m)=>{try{const w=n==="photographer"?"photographerId":"clientId",C=lp(sc($s,"bookings"),Ug(w,"==",u));return cp(C,async s=>{try{const G=s.docs.map(te=>({id:te.id,...te.data()})),q=await Promise.all(G.map(async te=>{try{if(!te.clientId)return{...te};const ce=lo($s,"users",te.clientId),we=await hf(ce);if(we.exists()){const ze=we.data();return{...te,Client:{id:we.id,...ze}}}else return{...te,Client:null}}catch(ce){return console.error("Error fetching client:",ce),{...te,Client:null}}}));l(q)}catch(G){console.error(" Error mapping bookings:",G),m?.(G)}},s=>{console.error(" Firestore booking listener error:",s),m?.(s)})}catch(w){return console.error(" Failed to initialize booking listener:",w),m?.(w),()=>{}}};var i8=10,dy="0123456789bcdefghjkmnpqrstuvwxyz",n8=40007860,GP=110574,rx=5,qP=22*rx,r8=6378137,s8=.00669447819799,o8=1e-12;function HP(u){return Math.log(u)/Math.log(2)}function Fb(u){var n;if(!Array.isArray(u))n="location must be an array";else if(u.length!==2)n="expected array of length 2, got length "+u.length;else{var l=u[0],m=u[1];typeof l!="number"||isNaN(l)?n="latitude must be a number":l<-90||l>90?n="latitude must be within the range [-90, 90]":typeof m!="number"||isNaN(m)?n="longitude must be a number":(m<-180||m>180)&&(n="longitude must be within the range [-180, 180]")}if(typeof n<"u")throw new Error("Invalid GeoFire location '"+u+"': "+n)}function a8(u){var n;if(typeof u!="string")n="geohash must be a string";else if(u.length===0)n="geohash cannot be the empty string";else for(var l=0,m=u;l<m.length;l++){var w=m[l];dy.indexOf(w)===-1&&(n="geohash cannot contain '"+w+"'")}if(typeof n<"u")throw new Error("Invalid GeoFire geohash '"+u+"': "+n)}function Kv(u){if(typeof u!="number"||isNaN(u))throw new Error("Error: degrees must be a number");return u*Math.PI/180}function l8(u,n){if(n===void 0&&(n=i8),Fb(u),typeof n<"u"){if(typeof n!="number"||isNaN(n))throw new Error("precision must be a number");if(n<=0)throw new Error("precision must be greater than 0");if(n>22)throw new Error("precision cannot be greater than 22");if(Math.round(n)!==n)throw new Error("precision must be an integer")}for(var l={min:-90,max:90},m={min:-180,max:180},w="",C=0,D=0,s=1;w.length<n;){var G=s?u[1]:u[0],q=s?m:l,te=(q.min+q.max)/2;G>te?(C=(C<<1)+1,q.min=te):(C=(C<<1)+0,q.max=te),s=!s,D<4?D++:(D=0,w+=dy[C],C=0)}return w}function AT(u,n){var l=Kv(n),m=Math.cos(l)*r8*Math.PI/180,w=1/Math.sqrt(1-s8*Math.sin(l)*Math.sin(l)),C=m*w;return C<o8?u>0?360:0:Math.min(360,u/C)}function SC(u,n){var l=AT(u,n);return Math.abs(l)>1e-6?Math.max(1,HP(360/l)):1}function c8(u){return Math.min(HP(n8/2/u),qP)}function oy(u){if(u<=180&&u>=-180)return u;var n=u+180;return n>0?n%360-180:180- -n%360}function u8(u,n){var l=n/GP,m=Math.min(90,u[0]+l),w=Math.max(-90,u[0]-l),C=Math.floor(c8(n))*2,D=Math.floor(SC(n,m))*2-1,s=Math.floor(SC(n,w))*2-1;return Math.min(C,D,s,qP)}function h8(u,n){var l=n/GP,m=Math.min(90,u[0]+l),w=Math.max(-90,u[0]-l),C=AT(n,m),D=AT(n,w),s=Math.max(C,D);return[[u[0],u[1]],[u[0],oy(u[1]-s)],[u[0],oy(u[1]+s)],[m,u[1]],[m,oy(u[1]-s)],[m,oy(u[1]+s)],[w,u[1]],[w,oy(u[1]-s)],[w,oy(u[1]+s)]]}function d8(u,n){a8(u);var l=Math.ceil(n/rx);if(u.length<l)return[u,u+"~"];u=u.substring(0,l);var m=u.substring(0,u.length-1),w=dy.indexOf(u.charAt(u.length-1)),C=n-m.length*rx,D=rx-C,s=w>>D<<D,G=s+(1<<D);return G>31?[m+dy[s],m+"~"]:[m+dy[s],m+dy[G]]}function f8(u,n){Fb(u);var l=Math.max(1,u8(u,n)),m=Math.ceil(l/rx),w=h8(u,n),C=w.map(function(D){return d8(l8(D,m),l)});return C.filter(function(D,s){return!C.some(function(G,q){return s>q&&D[0]===G[0]&&D[1]===G[1]})})}function p8(u,n){Fb(u),Fb(n);var l=6371,m=Kv(n[0]-u[0]),w=Kv(n[1]-u[1]),C=Math.sin(m/2)*Math.sin(m/2)+Math.cos(Kv(u[0]))*Math.cos(Kv(n[0]))*Math.sin(w/2)*Math.sin(w/2),D=2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C));return l*D}function m8(u,n,l,m=500){const w=[u,n],C=f8(w,m),D=[];return C.forEach(s=>{const G=lp(sc($s,"bookings"),Lb("geohash"),gV(s[0]),yV(s[1])),q=cp(G,async te=>{const ce=[];for(const we of te.docs){const ze=we.data();if(ze.type!=="Rush"||ze.status!=="pending")continue;const at=ze.location?.latitude,Ge=ze.location?.longitude;if(at!=null&&Ge!=null){const Qe=p8(w,[at,Ge]);if(Qe*1e3<=m){let wt;if(ze.clientId){const jt=lo($s,"users",ze.clientId),wi=await hf(jt);wi.exists()&&(wt={...wi.data(),uid:wi.id})}ce.push({...ze,id:we.id,Client:wt,distanceKm:Qe})}}}l(ce)});D.push(q)}),()=>D.forEach(s=>s())}function g8(){const{notifPermission:u}=Xa(),[n,l]=st.useState(null);return st.useEffect(()=>{if(!navigator.geolocation){console.error("Geolocation is not supported by this browser.");return}if(u=="denied"){console.error("Geolocation is access denied in this browser.");return}const m=navigator.geolocation.watchPosition(w=>{l({lat:w.coords.latitude,lng:w.coords.longitude})},w=>{console.error("Location error:",w)},{enableHighAccuracy:!0,maximumAge:1e3,timeout:3e4});return()=>navigator.geolocation.clearWatch(m)},[]),n}const Zw=({children:u})=>{const n=Bc.currentUser,{locationPermission:l,notifPermission:m}=Xa(),w=rh(),C=l!=="granted"&&m!=="granted";if(!n){const D=w.pathname+w.search+w.hash;return Y.jsx(Yw,{to:"/signin",replace:!0,state:{from:D}})}if(C){const D=w.pathname+w.search+w.hash;return Y.jsx(Yw,{to:"/permissions",replace:!0,state:{from:D}})}return Y.jsx(Y.Fragment,{children:u})},Gv=({children:u})=>{const n=Bc.currentUser,{userData:l,user:m}=Xa(),w=rh(),{locationPermission:C,notifPermission:D}=Xa();if((n||l&&m)&&(C==="granted"&&D==="granted")){const G=w.state?.from||"/dashboard";return Y.jsx(Yw,{to:G,replace:!0})}return Y.jsx(Y.Fragment,{children:u})},WP="/assets/appgallery-BHt0mVzS.png",$P="/assets/appstore-B8YHBNYO.png",ZP="/assets/playstore-DuFuB-PN.png";function XP(){const u=[{src:WP,url:"/",label:"App Gallery"},{src:$P,url:"/",label:"App Store"},{src:ZP,url:"/",label:"Play Store"}];return Y.jsx("footer",{className:"bg-[#000000] text-white z-40 px-4 py-3",children:Y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center text-center md:text-left",children:[Y.jsx("a",{href:"/terms",className:"hover:opacity-70 transition cursor-pointer",children:"Terms and Policies"}),Y.jsx("p",{className:"opacity-90 text-center font-bold",children:" Expedify 2025"}),Y.jsx("div",{className:"flex justify-center md:justify-end gap-4",children:u.map((n,l)=>Y.jsxs("a",{href:n.url,className:"group relative","aria-label":n.label,children:[Y.jsx("img",{src:n.src,alt:n.label,className:" h-10 cursor-pointer transition-transform duration-300 group-hover:scale-110"}),Y.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 px-2 py-1 text-xs bg-black text-white rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap",children:n.label})]},l))})]})})}const _8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAuCAYAAABap1twAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMBSURBVHgB7ZhBchJBFIbfa8BsQVbuhhOI25CqTNYugBMknsB4AskJEk8QPMHACSBVStyJJ3CyskrF4DLEmWc3Azo9zJDXQ2sqVXxVKTI9vO5/Xvd0P36EDbj23DKIm0MidAGwTgCOakcAX374iNCFMLiotD/4kBOEnEy8vQ4ivZSiyrB2APKJxNtq+10HcmAsUGbNIbz1pLC6SZwSihQemGbTSOBC3GA5labkESnAgEXmnETzFJA6okROtfUe1V9A9Ey1QbQW/8YDygcsnIMB7Ax+93aPEPFcD6beT3r0otYeTtNivsiM7+DsVApraTcofFVtX56BTYE/eo3P8ewpcY9bozYzVi0LN9Y0FVSqVTIeLA5rilX29Kkl/0ZmAZggldSDxMWUA3Hb5MSyBAqEZGfDJwYLfZ4pJG1KkcjlxDJfEnS0IEFdMCQMxUWiyWWE8QSu7HnBzicwpAjFsd6CDifOaJtZwlncNmIUXIFa5/Mz2JCUGJZglkBMbLiBmO2DIQEEbvxaLpsxJ467BodaEOExGIIYajsB2hQYEvbj12rT/ebtucBk8d0jbWAR9jixJieJdhpwD/70AoP8amtUAwbstzggPIlfRwe/GFz3G4dZMSpzUtzHZIEhCr9awMSo3Jr0d1/Lkqaz2oksSmX1TCFcza8Rn8qO65S2Gcsqp9ocnQAT44J10mucyg/jlyQazUzcPARykJXJ9SOFx9Xm5RswJNdJorIwk+WS/Ld713fVFqUK2DziFLl/NC1RRWkBZm5BrjsCKked4lRWQONpWOrXch5xW7ZsYZL5Fmf5LhYH9oHh36QK5Poutljn32gC8/outkirkDAhbmB7Kk1Jiiwub6zxXc5EEbqV56MrsMhXb7deELQPJFTh4fzRAehA5N8cRIIhn+9ii7v8m7nATXwXW2T5N2JT38UWWf6N2NR3sUWWfyNs+C62SPNvhA3fxRZp/s1KRV25xwIzbexcJf//ZCtwUx6EwNjCJB/uH02PICJ1avjqBqHhj/F/QFLPb7FUjr5Qf6jjAAAAAElFTkSuQmCC",y8="/assets/logo1-CaiArtjY.png";function YP(){const[u,n]=st.useState(!1),l=st.useRef(null),{user:m}=Xa();return st.useEffect(()=>{const w=C=>{l.current&&!l.current.contains(C.target)&&n(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]),Y.jsxs("header",{className:"flex justify-between items-center sticky top-0 bg-white z-40 px-4 py-2 shadow-sm",children:[Y.jsx("a",{href:"/",className:"flex items-center",children:Y.jsx("img",{src:y8,className:"h-10"})}),Y.jsxs("div",{className:"relative",ref:l,children:[Y.jsx("button",{onClick:()=>n(!u),className:"group",children:Y.jsx("img",{src:_8,alt:"Profile",className:"h-8 transition-transform group-hover:scale-110"})}),u&&Y.jsx("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-gray-200 shadow-md rounded-lg overflow-hidden animate-fadeIn",children:m?Y.jsxs(Y.Fragment,{children:[Y.jsx("a",{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Profile"}),Y.jsx("button",{onClick:()=>GE(),className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:"Logout"})]}):Y.jsx("a",{href:"/signin",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Login"})})]})]})}const v8="/assets/MobilePreview-CQrSnVHp.png";function KP(){const u=[{src:WP,url:"/",label:"App Gallery"},{src:$P,url:"/",label:"App Store"},{src:ZP,url:"/",label:"Play Store"}];return Y.jsx("section",{className:"w-full text-center py-16 px-5",children:Y.jsxs("div",{className:"flex p-12",children:[Y.jsxs("div",{className:"flex flex-col flex-1 items-start px-5",children:[Y.jsx("img",{className:"max-w-60 border-b-4 border-[#F5AB00] my-5",src:jE}),Y.jsx("h1",{className:"text-[#CA7F00] text-4xl text-left",children:"Book Trusted Filipino Photographers in an Instant."}),Y.jsx("div",{className:"flex justify-center md:justify-end gap-4 pt-5",children:u.map((n,l)=>Y.jsxs("a",{href:n.url,className:"group relative","aria-label":n.label,children:[Y.jsx("img",{src:n.src,alt:n.label,className:"h-10 cursor-pointer transition-transform duration-300 group-hover:scale-110"}),Y.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 px-2 py-1 text-xs bg-black text-white rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap",children:n.label})]},l))})]}),Y.jsx("div",{children:Y.jsx("img",{className:"max-w-70 p-5",src:v8})})]})})}function x8(){return Y.jsx("div",{className:"bg-black p-3 text-white text-center text-2xl font-bold",children:"Shot by Expedify Photographers"})}function b8(){return Y.jsx("div",{className:"bg-[#EDB03B]  flex flex-1 relative",children:Y.jsxs("div",{className:"flex-1 grid-cols-3 grid relative",children:[Y.jsx("div",{className:"h-150 relative",children:Y.jsx("img",{src:jE,className:"w-80 absolute bottom-0"})}),Y.jsxs("div",{className:"p-5 h-150 relative flex flex-col items-center justify-center",children:[Y.jsx("h3",{className:"text-4xl text-white font-bold",children:"How can we help you?"}),Y.jsxs("div",{className:"flex bg-white rounded-full m-5",children:[Y.jsx("p",{className:"flex p-2 text-[#EDB03B]",children:Y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true",children:Y.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-4.35-4.35m1.35-5.65a7 7 0 11-14 0 7 7 0 0114 0z"})})}),Y.jsx("input",{type:"text",className:"p-5 text-[#EDB03B] w-100 text-2xl",placeholder:"Search"})]})]}),Y.jsx("div",{className:"h-150 relative",children:Y.jsx("img",{src:UE,className:"w-100 absolute top-0 right-0"})})]})})}function w8(){const[u,n]=st.useState("Clients"),l=[{img:zP,title:"Smartshot",header:"Snap and go",description:"Quick, budget-friendly sessions powered by smartphone creators."},{img:kP,title:"Hobbyist",header:"Shoot with passion",description:"Emerging photographers bringing creativity and heart to every frame."},{img:NP,title:"Pro-Photographers",header:"Go big",description:"Quick, budget-friendly sessions powered by smartphone creators."}];return Y.jsxs("main",{className:"w-full min-h-screen flex flex-col",children:[Y.jsx(YP,{}),Y.jsx(KP,{}),Y.jsx(x8,{}),Y.jsxs("div",{className:"flex items-center flex-col flex-1 justify-center",children:[Y.jsx("img",{className:" items-center w-90 ",src:DP}),Y.jsx("div",{className:"text-[#B56600] text-2xl w-200 text-center",children:"Connect with Filipino photographers who bring your vision to life wherever you are, whenever youre ready."}),Y.jsxs("div",{className:"flex",children:[Y.jsx("button",{className:"border-[#B56600] border-2 rounded-full p-5 m-5 text-[#B56600]  min-w-80",children:"Download Expedify App Now"}),Y.jsx("button",{className:"bg-[#EDB03B] rounded-full p-5 m-5 text-white min-w-80",children:"Join As A Creator"})]})]}),Y.jsxs("div",{className:"flex items-center flex-col flex-1 justify-center",children:[Y.jsxs("div",{className:"flex items-center flex-1 m-5 w-full",children:[Y.jsx("button",{className:`flex-1 ${u==="Clients"?"border-[#EDB03B] text-[#EDB03B]":"border-[#EAEAEC] text-[#848484]"}   border-b-2 p-5 text-2xl`,onClick:()=>n("Clients"),children:"For Clients"}),Y.jsx("button",{className:`flex-1 ${u==="Photographer"?"border-[#EDB03B] text-[#EDB03B]":"border-[#EAEAEC] text-[#848484]"}  border-b-2 p-5 text-2xl`,onClick:()=>n("Photographer"),children:"For Creators"})]}),Y.jsxs("div",{className:"flex items-center flex-col flex-1 justify-center p-5",children:[Y.jsx("h3",{className:"text-[#EDB03B] text-4xl p-4",children:"Beautiful Moments Deserves the Right Creator"}),Y.jsx("h4",{className:"text-[#B56600] text-2xl p-4",children:"Expedify helps you find the perfect match for your budget and vision."}),Y.jsx("div",{className:"flex",children:l.map(m=>Y.jsxs("div",{className:"flex-col flex p-5 items-center justify-center",children:[Y.jsx("img",{src:m.img}),Y.jsx("p",{className:"text-[#EDB03B] text-lg",children:m.title}),Y.jsx("p",{className:"p-2 text-3xl text-[#B56600] font-bold",children:m.header}),Y.jsx("p",{className:"w-70 text-center text-[#B56600]",children:m.description})]}))}),Y.jsx("div",{className:"flex-1 flex items-center justify-center p-5",children:Y.jsx("button",{className:"border-[#EDB03B] text-[#EDB03B] rounded-full border-2 p-3 text-lg w-69",children:"Book a Creator Now"})})]})]}),Y.jsx(b8,{}),Y.jsx(XP,{})]})}function T8({images:u,setImages:n,setFiles:l,progress:m,disabled:w}){const C=st.useRef([]),D=G=>{C.current[G]?.click()},s=(G,q)=>{const te=G.target.files?.[0];if(!te)return;l(we=>{const ze=[...we];return ze[q]=te,ze});const ce=new FileReader;ce.onload=()=>{n(we=>{const ze=[...we];return ze[q]=ce.result,ze})},ce.readAsDataURL(te)};return Y.jsx("div",{className:"flex gap-4",children:u.map((G,q)=>Y.jsxs("div",{className:`relative w-[140px] h-[160px] bg-[#FFF5D9] border-2 border-dashed border-[#C07900] rounded ${w?" cursor-not-allowed":"cursor-pointer"} overflow-hidden flex items-center justify-center`,onClick:()=>D(q),children:[G?Y.jsx("img",{src:G,className:"w-full h-full object-cover"}):Y.jsx("div",{className:"text-3xl font-bold text-[#C07900]",children:"+"}),m[q]>0&&m[q]<100&&Y.jsx("div",{className:"absolute bottom-0 left-0 bg-yellow-600 h-2",style:{width:`${m[q]}%`}}),Y.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:te=>{C.current[q]=te},disabled:w,onChange:te=>s(te,q)})]},q))})}function AC(u,n,l){return new Promise((m,w)=>{const C=zU(UU,n),D=OU(C,u);D.on("state_changed",s=>{const G=s.bytesTransferred/s.totalBytes*100;l(Math.round(G))},s=>w(s),async()=>{const s=await LU(D.snapshot.ref);m(s)})})}const IC=[{id:1,min:1e3,max:3999},{id:2,min:4e3,max:7999},{id:3,min:8e3,max:11999},{id:4,min:12e3,max:16e3}],E8=["Portrait & People","Landscape & Travel","Product & Commercial","Events","Documentary & Street","Architectural & Real Estate","Specialized & Technical"];function S8({userData:u}){const[n,l]=st.useState(u.fullname),[m,w]=st.useState(u.address),[C,D]=st.useState(u.portfolio?.bio),[s,G]=st.useState(u.portfolio?.expertise||[]),[q,te]=st.useState(u.portfolio?.level||[]),[ce,we]=st.useState(null),[ze,at]=st.useState(u.portfolio?.linkPortfolio);st.useEffect(()=>{u.portfolio?.priceMin&&we(IC.find(Qt=>Qt.min==u.portfolio?.priceMin&&Qt.max==u.portfolio?.priceMax)||null)},[u]);const[Ge,Qe]=st.useState(null),[xt,wt]=st.useState(u.portfolio?.equipments||""),[jt,wi]=st.useState(null),[Ai,vi]=st.useState(0),[Ve,ke]=st.useState(Array(5).fill(null)),[We,ht]=st.useState(Array(5).fill(null)),[$e,_t]=st.useState(Array(5).fill(0)),[Ue,Cn]=st.useState(!1),[mn,Pt]=st.useState(null),Si=st.useRef(null);st.useEffect(()=>{u?.portfolio?.images&&ke(u.portfolio.images.map(Qt=>Qt.url))},[u]);const fn=Qt=>{G(Li=>Li.includes(Qt)?Li.filter(cn=>cn!==Qt):[...Li,Qt])},jn=Qt=>{te(Li=>Li.includes(Qt)?Li.filter(cn=>cn!==Qt):[...Li,Qt])},Wn=Qt=>{we(Qt)},et=()=>Si.current?.click(),Kt=Qt=>{const Li=Qt.target.files?.[0];if(!Li)return;wi(Li);const cn=new FileReader;cn.onload=()=>Qe(cn.result),cn.readAsDataURL(Li)},Oi=Qt=>{Qt.preventDefault();const Li=Qt.dataTransfer.files?.[0];if(!Li)return;wi(Li);const cn=new FileReader;cn.onload=()=>Qe(cn.result),cn.readAsDataURL(Li)},Hi=Qt=>Qt.preventDefault(),bn=async Qt=>{if(!n||!m||!ce||s.length<1){alert("Please fill all required fields.");return}if(Qt.preventDefault(),q.length==0){Pt({type:"error",message:"Tier Required"});return}Cn(!0);try{let Li=null;jt&&(Li=await AC(jt,`users/${u.id}/profile.jpg`,Nn=>vi(Nn)));const cn=[];for(let Nn=0;Nn<We.length;Nn++){const ur=We[Nn];if(!ur)continue;const Qo=await AC(ur,`users/${u.id}/portfolio/img_${Nn+1}.jpg`,Jo=>_t(Ya=>{const ys=[...Ya];return ys[Nn]=Jo,ys}));cn.push({isHighlighted:!0,url:Qo})}console.log("uploadedPortfolio",cn.length),await df(lo($s,"users",u.id),{portfolio:{id:u.portfolio?.id,applicationDate:Rm(),declinedDate:null,level:q,priceMin:ce.min,priceMax:ce.max,expertise:s,bio:C,images:cn.length>0?cn:u.portfolio?.images,equipments:xt,linkPortfolio:ze||""},address:m,photoURL:Li||u.photoURL}),Pt({type:"success",message:"Application Sent Successfuly"}),Cn(!1)}catch(Li){console.error(Li),Pt({type:"error",message:"Application Error:"+Li}),Cn(!1)}};return st.useEffect(()=>{if(!mn)return;const Qt=setTimeout(()=>{Pt(null)},2e3);return()=>clearTimeout(Qt)},[mn]),Y.jsxs("form",{className:"flex flex-1 flex-row w-[80%] mx-auto",onSubmit:bn,children:[mn&&Y.jsxs("div",{className:`${mn?.type=="error"?" bg-red-800":" bg-green-700"} p-3 fixed bottom-20 right-5 z-50 text-white font-bold rounded-xl animate-bounce`,children:["Message:",mn?.message]}),Ge||u.photoURL?Y.jsxs("div",{className:"relative",children:[Y.jsx("img",{onClick:et,src:Ge||u.photoURL,className:`w-50 h-50 mt-20 rounded-full ${Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null?" cursor-not-allowed":"cursor-pointer"} `}),Ai>0&&Ai<100&&Y.jsx("div",{className:"absolute bottom-0 left-0 bg-yellow-600 h-2",style:{width:`${Ai}%`}})]}):Y.jsx("div",{onClick:et,onDrop:Oi,onDragOver:Hi,className:"w-50 h-50 mt-20 rounded-full bg-[#FFF4CF] text-center flex items-center justify-center cursor-pointer",children:Y.jsx("p",{className:"text-[#B56600] text-2xl",children:"Add Photo"})}),Y.jsx("input",{ref:Si,type:"file",accept:"image/*",className:"hidden",disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,onChange:Kt}),Y.jsxs("div",{className:"w-full max-w-2xl mx-auto p-6 bg-white rounded-lg",children:[Y.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Join As A Creator"}),u.portfolio?.declinedDate&&Y.jsxs("div",{className:"bg-amber-700 p-5 text-white my-5 rounded-xl ",children:[Y.jsx("p",{children:"Application Declined"}),Y.jsxs("p",{children:["Reason:",Y.jsxs("b",{className:" capitalize",children:[" ",u.portfolio?.reason]})]})]}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"Name"}),Y.jsx("input",{value:n,onChange:Qt=>l(Qt.target.value),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:"border rounded-md p-2 w-full mb-4",required:!0}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"Location"}),Y.jsx("input",{value:m,onChange:Qt=>w(Qt.target.value),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:"border rounded-md p-2 w-full mb-4",required:!0}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"About"}),Y.jsx("textarea",{value:C,onChange:Qt=>D(Qt.target.value),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:"border rounded-md p-2 w-full mb-4",required:!0}),Y.jsx("label",{className:"block mb-3 font-semibold",children:"Photography Expertise"}),Y.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:E8.map(Qt=>Y.jsx("button",{type:"button",onClick:()=>fn(Qt),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:`${Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null?" cursor-not-allowed":"cursor-pointer hover:scale-105"} transition-all px-4 py-2 rounded-full border ${s.includes(Qt)?"bg-[#FFF4CF]":"bg-[#FFF4CF] border-transparent"}`,children:Qt},Qt))}),Y.jsx("label",{className:"block mb-3 font-semibold",children:"Photography Tier"}),Y.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:tf.map(Qt=>Y.jsxs("button",{type:"button",onClick:()=>jn(Qt.level),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:`flex flex-col items-center w-50 px-4 aspect-square py-2 capitalize rounded-2xl ${Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null?" cursor-not-allowed":"cursor-pointer hover:scale-105"} transition-all border 
              ${q.includes(Qt.level)?"bg-[#FFF4CF]":"bg-[#FFF4CF] border-transparent"}`,children:[Y.jsx("img",{src:Qt.Image,className:" h-30 "}),Y.jsx("p",{className:"flex-1 flex items-center justify-center",children:Qt.level})]},Qt.level))}),Y.jsx("label",{className:"block mb-3 font-semibold",children:"Select your Price Range"}),Y.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:IC.map(Qt=>Y.jsxs("button",{type:"button",onClick:()=>Wn(Qt),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:`px-4 py-2 rounded-full ${Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null?" cursor-not-allowed":"cursor-pointer hover:scale-105"} transition-all border ${ce?.id===Qt.id?"bg-[#FFF4CF]":"bg-[#FFF4CF] border-transparent"}`,children:["",Qt.min,"-",Qt.max]},Qt.id))}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"Equipments"}),Y.jsx("input",{type:"text",value:xt,onChange:Qt=>wt(Qt.target.value),disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:"border rounded-md p-2 w-full mb-4"}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"Upload your 5 best photos"}),Y.jsx(T8,{images:Ve,setImages:ke,setFiles:ht,progress:$e,disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null}),Y.jsx("label",{className:"block mb-2 font-semibold",children:"Link to your portfolio (optional)"}),Y.jsx("input",{type:"text",value:ze,disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,onChange:Qt=>at(Qt.target.value),className:"border rounded-md p-2 w-full mb-4"}),Y.jsx("button",{type:"submit",disabled:Ue||!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null,className:`w-full py-3 ${!u.portfolio?.declinedDate&&u.portfolio?.applicationDate!=null?"bg-yellow-600/60 cursor-not-allowed":"bg-yellow-600 hover:opacity-90"} text-white rounded-lg `,children:Ue?"Submitting...":u.portfolio?.declinedDate?"Resubmit":u.portfolio?.applicationDate?"Waiting for Approval":"Submit"})]})]})}function A8(){const u=rh(),{userData:n,setUserData:l,setUser:m,user:w}=Xa(),C=new URLSearchParams(u.search),D=C.get("id");C.get("user");const[s,G]=st.useState(!1);return n?Y.jsxs("main",{className:"w-full min-h-screen flex flex-col",children:[Y.jsx(YP,{}),Y.jsx(KP,{}),Y.jsxs("section",{className:"w-full text-center py-16",children:[Y.jsx("h1",{className:"text-4xl font-bold text-yellow-600",children:"Join As A Creator"}),Y.jsx("p",{className:"mt-4 text-gray-600",children:"Become part of the Expedify community."})]}),n.portfolio?.id!=D?Y.jsxs("div",{className:"flex flex-1 flex-col items-center py-15 my-15",children:[Y.jsx("h2",{className:"p-5 text-5xl",children:"Invalid Application URL"}),Y.jsx("h3",{className:"p-5 text-4xl",children:"Your Application URL not matched in current account"}),Y.jsx("h3",{className:"p-5 text-4xl",children:"Please Change Your Account To Proceed this Application"}),Y.jsx("button",{onClick:GE,className:"p-3 bg-white text-red-700  text-3xl cursor-pointer hover:font-bold",children:"Logout?"})]}):n.portfolio?.approvedDate?Y.jsxs("div",{className:"flex flex-1 flex-col items-center py-15 my-15",children:[Y.jsx("h2",{className:"p-5 text-5xl",children:"Application Approved"}),Y.jsx("h3",{className:"p-5 text-4xl",children:"You have now photographer access "})]}):Y.jsx(S8,{userData:n}),Y.jsx(XP,{})]}):s&&Y.jsx("div",{className:"flex flex-1 items-center justify-center h-screen",children:Y.jsx("h1",{className:"text-3xl",children:"Page Expired"})})}function I8(){const u=hp(),n=st.useRef(!1),[l,m]=st.useState("loading");return st.useEffect(()=>{if(n.current)return;n.current=!0;const C=new URLSearchParams(window.location.search).get("oobCode");if(!C){m("error");return}const D=Ax();HN(D,C).then(async()=>{await D.currentUser?.reload(),m("success"),setTimeout(()=>{u("/signin",{replace:!0})},2500)}).catch(s=>{console.error(s),m("error")})},[u]),Y.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center"},children:Y.jsxs("div",{style:{textAlign:"center"},children:[l==="loading"&&Y.jsxs(Y.Fragment,{children:[Y.jsx("h2",{children:"Verifying your email"}),Y.jsx("p",{children:"Please wait a moment"})]}),l==="success"&&Y.jsxs(Y.Fragment,{children:[Y.jsx("h2",{style:{color:"green"},children:"Email verified "}),Y.jsx("p",{children:"Redirecting you to login"})]}),l==="error"&&Y.jsxs(Y.Fragment,{children:[Y.jsx("h2",{style:{color:"red"},children:"Verification failed"}),Y.jsx("p",{children:"This link may be expired or already used."})]})]})})}const C8=4e3,R8=()=>{const{user:u,setUser:n,onboardingDone:l,setHasProfile:m,hasProfile:w,loading:C,setLoading:D,locationPermission:s,notifPermission:G,setLocationPermission:q,setNotifPermission:te,setUserData:ce,setBookings:we,setNearbyBookings:ze,location:at,setLocation:Ge,setMyBookings:Qe,setRushBooking:xt}=Xa(),wt=g8();st.useEffect(()=>{wt&&Ge(wt)},[wt]),st.useEffect(()=>{const Ai=YN(Bc,async vi=>{if(n(vi),vi)try{const Ve=lo($s,"users",vi.uid),ke=await hf(Ve);m(ke.exists()),ke.exists()&&ce({...ke.data(),id:ke.id})}catch(Ve){console.error("Error fetching user profile:",Ve),m(!1)}else m(null);D(!1)});if(Bc.currentUser)return()=>Ai();n(null)},[n,m,D,Bc]),st.useEffect(()=>{if(!u?.uid)return;const Ai=t8(u.uid,"photographer",vi=>{console.log("data",vi);const Ve=vi.filter(ke=>ke.status==="active")[0];we(vi),xt(Ve),console.log("res",Ve)},vi=>console.error(vi));return()=>Ai()},[u?.uid]),st.useEffect(()=>{if(!Bc.currentUser)return;if(!at){console.warn("Error Location",at);return}const Ai=m8(at.lat,at.lng,vi=>{ze(vi)},C8);return()=>Ai()},[at]);const jt=async()=>{try{return(await navigator.permissions.query({name:"geolocation"})).state}catch(Ai){return console.error("Location permission error:",Ai),"denied"}},wi=()=>"Notification"in window?Notification.permission:"denied";return st.useEffect(()=>{(async()=>{const vi=await jt();q(vi)})();const Ai=wi();te(Ai)},[]),C?Y.jsx(PP,{}):Y.jsx(Qz,{children:Y.jsxs(Rz,{children:[Y.jsx(Xh,{path:"/Onboarding",element:Y.jsx(Gv,{children:Y.jsx(tj,{})})}),Y.jsx(Xh,{path:"/",element:Y.jsx(w8,{})}),Y.jsx(Xh,{path:"/confirm/email",element:Y.jsx(I8,{})}),Y.jsx(Xh,{path:"/application",element:Y.jsx(Zw,{children:Y.jsx(A8,{})})}),Y.jsx(Xh,{path:"/signin",element:Y.jsx(Gv,{children:Y.jsx(KU,{})})}),Y.jsx(Xh,{path:"/signup",element:Y.jsx(Gv,{children:Y.jsx(QU,{})})}),Y.jsx(Xh,{path:"/forgot",element:Y.jsx(Gv,{children:Y.jsx(JU,{})})}),Y.jsx(Xh,{path:"/permissions",element:Y.jsx(Gv,{children:Y.jsx(rj,{})})}),Y.jsx(Xh,{path:"/create-profile",element:Y.jsx(Zw,{children:Y.jsx(ij,{})})}),Y.jsx(Xh,{path:"/dashboard",element:Y.jsx(Zw,{children:Y.jsx(e8,{})})})]})})};BL.createRoot(document.getElementById("root")).render(Y.jsx(qv.StrictMode,{children:Y.jsx(R8,{})}));
